(function(a){a.util||(a.util={});a.util.typeOf=function(b){return Object.prototype.toString.call(b).match(/(\w+)\]$/)[1].toLowerCase()};a.util.merge=function(g){for(var c=1;c<arguments.length;c++){var e=arguments[c];if(!e){continue}g||(g=(a.util.typeOf(e)==="array")?[]:{});for(var b in e){var f=e[b];if(e.hasOwnProperty(b)&&a.util.typeOf(f)!=="undefined"){var d=a.util.typeOf(f);if(d==="string"||d==="number"||d==="boolean"||d==="function"||f===null){g[b]=f;continue}g[b]=a.util.merge(g[b],f)}}}return g}}(ta));(function(a){a.util||(a.util={});a.util.ajax=function(f){f||(f={});try{if(f.trackEvent&&a.analytics){var k=a.analytics._toEvtParams(f.trackEvent);f.data=a.util.merge(f.data||{},k)}}catch(i){if(a.util&&a.util.error&&a.util.error.record){a.util.error.record(i,"ta.util.ajax.initialize.trackEvent")}}var d=a.util.Deferred();var h=function(e){};var j,c;var g={onComplete:typeof f.onComplete=="function"?f.onComplete:h,onSuccess:typeof f.onSuccess=="function"?f.onSuccess:h,onFailure:typeof f.onFailure=="function"?f.onFailure:h,onReadOnly:f.onReadOnly||h,onRedirect:f.onRedirect||h};f.onComplete=function(){var l;try{l=JSON.decode?JSON.decode(j.responseText):JSON.parse(j.responseText)}catch(m){l={text:j.responseText}}l||(l={text:j.responseText});if(!l.code){l.code=j.status||0}try{if(f&&f.trackEvent&&a.analytics){a.analytics._trackEventAfterAjax(this.options.trackEvent)}}catch(m){if(a&&a.util&&a.util.error&&a.util.error.record){a.util.error.record(m,"ta.util.ajax.onComplete.trackEventAfterAjax")}}if(l.code>=200&&l.code<300){l.status="ok";d.resolve(l)}else{if(l.code===301||l.code===302){l.status="redirect";d.reject(l)}else{l.status||(l.status="error");d.reject(l)}}};f.onCancel=function(){d.reject({code:0,status:"abort"})};f.onTimeout=function(){d.reject({code:0,status:"timeout"})};delete f.onLoadStart;delete f.onProgress;delete f.onException;delete f.onSuccess;delete f.onFailure;j=b(f);return d.promise().always(function(e){g.onComplete.call(j,e);if(e.status==="redirect"){g.onRedirect.call(j,e)}else{if(e.status==="readonly"){g.onReadOnly.call(j,e)}else{if(~["abort","timeout","error"].indexOf(e.status)){g.onFailure.call(j,e)}else{g.onSuccess.call(j,e)}}}})};function b(d){if(typeof MooTools!=="undefined"&&typeof Request!=="undefined"){return(new Request(d).send()).xhr}var h=new XMLHttpRequest();var j=h.abort.bind(h);var i=d.method.toUpperCase()||"GET";var g=d.url||"/";var c=[];var f,e;h.onreadystatechange=function(){if(this.readyState===4){clearTimeout(f);d.onComplete()}};h.abort=function(){j();d.onCancel()};if(d.timeout){f=setTimeout(function(){j();d.onTimeout()},d.timeout)}d.data||(d.data={});for(e in d.data){if(d.data.hasOwnProperty(e)&&d.data[e]!==null){c.push(e+"="+encodeURIComponent(d.data[e]))}}if(/GET/.test(d.method)){g+=(/\?/.test(g)?"&":"?")+c.join("&")}if(/POST/.test(d.method)){d.headers||(d.headers={});d.headers["Content-Type"]="application/x-www-form-urlencoded; charset=utf-8"}h.open(d.method,g);for(e in d.headers){h.setRequestHeader(e,d.headers[e])}d.onRequest&&d.onRequest.call(h);h.send(/POST/.test(d.method)?c.join("&"):null);return h}}(ta));modules={component:{},civ:{model:{},collection:{}},common:{model:{},collection:{}},membercenter:{model:{},collection:{}},travelmap:{model:{},collection:{}},livestream:{model:{},collection:{}},triplist:{model:{},collection:{}}};/*
 * THIS FILE WAS GENERATED IN AN EXTERNAL REPOSITORY. DO NOT MODIFY.
 *
 * Ox@0.0.1 distributed on 2014-01-28
 */
window.ox=(function(){var d=/\.entity\./;var b=/\.collection\./;var f=/\.model\./;var a=true;try{Object.defineProperty({},"ES5GetterSupport",{get:function(){return 0}})}catch(e){a=false}var c={mixin:{},config:function(g){for(var h in g){if(g.hasOwnProperty(h)){this.config[h]=g[h]}}},store:function(k,g){var h=[];var q=[];var w=[];var j;var v;var r;var t;for(j in k){var m=c.config.resolveTypeByName(j);if(c.Entity.isTypeOf(m)){h.push(j)}else{if(c.Collection.isTypeOf(m)){q.push(j)}else{if(c.Model.isTypeOf(m)){w.push(j)}else{throw new Error("Could not resolve type of "+j)}}}}h.sort();if(c.config.blockStoreEvents&&g){g._notifyBlocked=true;if(typeof g._notifyQueue==="undefined"){g._notifyQueue=[]}}for(t=0;t<h.length;t++){j=h[t];var x=c.util.resolvePath(j)||c.Entity.extend(j);if(!c.Entity.isTypeOf(x)){throw new Error(j+" must extend ox.Entity")}x.propStore=k[j]}for(t=0;t<h.length;t++){j=h[t];var x=c.util.resolvePath(j)||c.Entity.extend(j);if(!c.Entity.isTypeOf(x)){throw new Error(j+" must extend ox.Entity")}v=k[j];for(r in v){if(v.hasOwnProperty(r)){new x(r,v[r])}}x.propStore=null}for(t=0;t<q.length;t++){j=q[t];var z=c.util.resolvePath(j)||c.Collection.extend(j);if(!c.Collection.isTypeOf(z)){throw new Error(j+" must extend ox.Collection")}v=k[j];for(r in v){if(v.hasOwnProperty(r)){if(z.store&&z.store[r]){var l=new z(v[r],false);var p=z.store[r];var u=p.update(l);if(!u){p=p.reset(l)}}else{new z(v[r])}}}}for(t=0;t<w.length;t++){j=w[t];var n=c.util.resolvePath(j)||c.Model.extend(j);if(!c.Model.isTypeOf(n)){throw new Error(j+" must extend ox.Model")}v=k[j];for(r in v){if(v.hasOwnProperty(r)){new n(v[r])}}}if(c.config.blockStoreEvents&&g){g._notifyBlocked=false;while(g._notifyQueue.length>0){var o=g._notifyQueue.shift();var y=o[0];var s=o[1];y.notify.call(y,s)}}},invalidate:function(j){for(var h in j){var g=c.util.resolvePath(h);if(g&&g.store){var i=new RegExp(j[h]);for(var k in g.store){if(i.test(k)&&!g.store[k]._connections.length){delete g.store[k]}}}}},"export":(function(){function h(n,q){if(n==null){return null}else{if(n[c.config.typeKey]!=null&&n[c.config.idKey]!=null){var p=n[c.config.typeKey];var j=n[c.config.idKey];if(q[p]&&q[p][j]){var l=q[p][j];if(l.$collection){var o=h(l.items,q);o.__offset__=l.params.offset;return o}if(l.$model){return h(l.properties,q)}return h(l,q)}return null}}var k=c.util.typeOf(n);if(k=="object"){for(var r in n){if(n.hasOwnProperty(r)){(function(i){var s=n[i];Object.defineProperty(n,i,{configurable:true,enumerable:true,get:function(){var t=h(s,q);Object.defineProperty(n,i,{value:t});return t}})}(r))}}}else{if(k=="array"){for(var m=0;m<n.length;m++){n[m]=h(n[m],q)}}}return n}function g(n,q){if(n==null){return null}else{if(n[c.config.typeKey]!=null&&n[c.config.idKey]!=null){var p=n[c.config.typeKey];var j=n[c.config.idKey];if(q[p]&&q[p][j]){var l=q[p][j];if(l.$collection){return l.items}if(l.$model){return l.properties}return l}return null}}var k=c.util.typeOf(n);if(k=="object"){if(n.$collection){var o=g(n.items,q);o.__offset__=n.params.offset}else{if(n.$model){g(n.properties,q)}else{for(var r in n){if(n.hasOwnProperty(r)){n[r]=g(n[r],q)}}}}}else{if(k=="array"){for(var m=0;m<n.length;m++){n[m]=g(n[m],q)}}}return n}return function(j,i){i=!!i&&a;if(i){return h(j.context,j.store)}else{return g(j,j.store).context}}}()),log:function(){if(c.config.debug&&typeof console!="undefined"&&console.log){console.log.apply(console,arguments)}},logDetailed:function(){if(c.config.debug>=c.log.DETAILED&&typeof console!="undefined"&&console.log){console.log.apply(console,arguments)}},warn:function(){if(c.config.debug&&typeof console!="undefined"&&console.warn){console.warn.apply(console,arguments)}},error:function(){if(c.config.debug&&typeof console!="undefined"&&console.error){console.error.apply(console,arguments)}},call:function(m,l,k){var h=[];for(var j=3;j<arguments.length;j++){h.push(arguments[j])}try{return l.apply(k,h)}catch(g){c.config.error(g,m,h);return null}}};c.log.NONE=0;c.log.BASIC=1;c.log.DETAILED=2;c.config({debug:c.log.NONE,typeKey:"$type",idKey:"$id",blockStoreEvents:false,error:function(h,i,g){throw h},validateTypeName:function(g,h){},resolveTypeByName:function(g){if(d.test(g)){return c.Entity}if(b.test(g)){return c.Collection}if(f.test(g)){return c.Model}return null}});return c}());(function(c){var k=Array.prototype;var l=k.slice;var j=k.push;var h=k.forEach;var a=k.map;var b=k.filter;var m=k.some;var f={};var i=/(\w+)\]$/;var e=/^\[/;var d=0;var g=c.util={uniqueId:function(n){return""+(n!=null?n:"")+d++},typeOf:function(n){return Object.prototype.toString.call(n).match(i)[1].toLowerCase()},isInteger:function(n){return parseInt(n,10)==n},slice:function(n){return l.call(n,arguments[1],arguments[2])},pushAll:function(o,n){return j.apply(o,n)},each:function(t,s,r){if(t==null){return}var n;if(h&&t.forEach==h){t.forEach(s,r)}else{if(t.length===+t.length){for(var q=0,o=t.length;q<o;q++){n=s.call(r,t[q],q,t);if(n==f){break}}}else{for(var p in t){if(t.hasOwnProperty(p)){n=s.call(r,t[p],p,t);if(n==f){break}}}}}},map:function(q,p,o){if(q==null){throw new TypeError("Method 'map' called on null or undefined")}if(a&&q.map==a){return q.map(p,o)}var n=[];g.each(q,function(t,r,s){n[n.length]=p.call(o,t,r,s)});return n},filter:function(q,p,o){if(q==null){throw new TypeError("Method 'filter' called on null or undefined")}if(b&&q.filter==b){return q.filter(p,o)}var n=[];g.each(q,function(t,r,s){if(p.call(o,t,r,s)){n.push(t)}});return n},some:function(q,p,o){if(q==null){throw new TypeError("Method 'some' called on null or undefined")}if(m&&q.some==m){return q.some(p,o)}var n=false;g.each(q,function(t,r,s){if(p.call(o,t,r,s)){n=true;return f}});return n},find:function(q,p,o){var n=false;g.some(q,function(t,r,s){if(p.call(o,t,r,s)){n=t;return true}});return n},extend:function(q){for(var o=1;o<arguments.length;o++){var p=arguments[o];for(var n in p){var r=p[n];if(r!==undefined){q[n]=r}}}return q},numericSort:function(o,n){return o-n},resolveType:function(q){if(q instanceof c.AbstractData){return q.constructor}var o=g.typeOf(q);if(o=="object"){if(q[c.config.typeKey]!=null&&q[c.config.idKey]!=null){var n=g.resolvePath(q[c.config.typeKey]);if(n){return n}var p=c.config.resolveTypeByName(q[c.config.typeKey]);if(!p){throw new Error("Could not resolve type "+q[c.config.typeKey])}return p.extend(q[c.config.typeKey])}else{return c.Map}}if(o=="array"){if(!q.length){return c.ProxyCollection}else{if(g.typeOf(q[0])=="object"){if(q[0] instanceof c.Entity||q[0][c.config.typeKey]!=null&&q[0][c.config.idKey]!=null){return c.AnonymousCollection}else{return c.Maps}}else{return c.Flags}}}if(q){return q.constructor}return null},resolvePath:function(q){var n=window;var p=q.split(".");for(var o=0;o<p.length;o++){var r=p[o];n=n[r];if(!n){c.warn("Could not resolve path "+q);return n}}return n},createPath:function(q,o){var p=q.split(".");q=window;for(var n=0;n<p.length-1;n++){var r=p[n];if(!q[r]){q[r]={}}q=q[r]}q[p[n]]=o;return o},joinDataPathComponents:function(p){var o=p[0]||"";for(var n=1;n<p.length;n++){var q=p[n];o+=(e.test(q)?"":".")+q}return o},topParent:function(n){while(n&&n._connections&&n._connections.length){n=n._connections[0]._target}return n}}}(ox));(function(b,a){b.domutil={wrap:function(c){if(c){return $(c)}return null},unwrap:function(c){if(c instanceof Element){return c}else{if(c){return c[0]}}return null},html:function(c,d){c.html(d)},is:function(d,c){return d.is(c)},on:function(d,e,c,f){d.on.apply(d,a.slice(arguments,1))},off:function(c){c.off.apply(c,a.slice(arguments,1))},find:function(d,c){return d.find(c)},after:function(d,c){$(d).after(c)},replace:function(c,d){c.replaceWith(d)},transition:{FADE_DURATION:350,fadeIn:function(d,c){d.css("opacity",0);c();d.animate({opacity:1},b.domutil.transition.FADE_DURATION)},fadeOut:function(d,c){d.animate({opacity:0},b.domutil.transition.FADE_DURATION,"linear",c)}}}}(ox,ox.util));(function(ox,util){function Ctor(Child){this.constructor=Child}ox.Object=function(){};ox.Object.extend=function extend(name){var Parent=this;var childPrototype={};var validate;var Child;var obj;var key;var i;var L=arguments.length;if(typeof arguments[1]=="boolean"){validate=arguments[1];i=2}else{validate=true;i=1}for(;i<L;i++){obj=arguments[i];for(key in obj){if(obj.hasOwnProperty(key)){childPrototype[key]=obj[key]}}if(obj.hasOwnProperty("constructor")){childPrototype.constructor=obj.constructor}}Child=childPrototype.hasOwnProperty("constructor")?childPrototype.constructor:eval("(function() {return function "+name.match(/[^.:]*$/)[0]+"() {return Parent.apply(this, arguments);};}());");Ctor.prototype=Parent.prototype;Child.prototype=new Ctor(Child);Child.prototype.name=name;for(key in childPrototype){Child.prototype[key]=childPrototype[key]}Child.extend=extend;Child.isTypeOf=ox.Object.isTypeOf;if(validate){ox.config.validateTypeName(Child,name)}if(typeof util.resolvePath(name)!="undefined"){throw new Error("Path "+name+" already defined")}return util.createPath(name,Child)};ox.Object.isTypeOf=function(Child){return Child&&(Child.prototype instanceof this||Child==this)}}(ox,ox.util));(function(c,f){var a={};var j={};function h(l,m,n,k,o){c.logDetailed("Adding context event subscription",arguments);if(!k){throw new Error("Cannot add subscription to "+n+"with null selector")}a[l][m][n]||(a[l][m][n]=[]);i(a[l][m][n],k,o);j[m][n]||(j[m][n]=[]);i(j[m][n],k,o)}function i(n,k,r){var q=k.length;var p=-1;var o=0;for(var m=0;m<n.length;m++){var l=n[m].selector;if(l==k){p=m;break}else{if(l.length>q){o=m+1}}}if(~p){n[p].callbacks.push(r)}else{n.splice(o,0,{selector:k,callbacks:[r]})}}function g(k,n){for(var o in a[k][n]){if(a[k][n].hasOwnProperty(o)){var m=a[k][n][o];var l=m.length;while(l--){d(k,n,o,m[l].selector)}}}delete a[k][n]}function d(m,p,q,k){var o=a[m][p][q];var r=-1;var n=o.length;while(n--){if(o[n].selector==k){r=n;var l=o[n].callbacks.length;while(l--){b(m,p,q,k,o[n].callbacks[l])}}}}function b(l,m,n,k,o){e(a[l][m][n],k,o);e(j[m][n],k,o)}function e(m,k,p){var n;var o=-1;var l;for(l=0;l<m.length;l++){if(m[l].selector==k){n=m[l].callbacks;o=l;break}}if(!n){return}l=n.length;while(l--){if(n[l]==p){n.splice(l,1)}}if(!n.length){m.splice(o,1)}}c.mixin.ContextEventPublisher={publish:function(n){if(!j[this.cid]){return}var l=j[this.cid][n.type];if(!l){return}var m=[];var k;for(k=0;k<l.length;k++){if(n.test(n.type,l[k].selector)){f.pushAll(m,l[k].callbacks)}}for(k=0;k<m.length;k++){m[k](n)}return this}};c.mixin.ContextEventSubscriber={subscribe:function(n,k,o){a[this.cid]||(a[this.cid]={});a[this.cid][n.cid]||(a[this.cid][n.cid]={});j[n.cid]||(j[n.cid]={});var l=k.match(/^(\w+) *(.*) *$/);var m=l[1];h(this.cid,n.cid,m,l[2],o);return this},unsubscribe:function(p,k,q){var m=this.cid;var n=p&&p.cid;if(!p){for(n in a[m]){g(m,n)}delete a[m]}else{if(!k){g(m,n)}else{var l=k.match(/^(\w+) *(.*) *$/);var o=l[1];if(!q){d(m,n,o,l[2])}else{b(m,n,o,l[2],q)}}}return this}}}(ox,ox.util));(function(a){a.Object.extend("ox.DataDescriptor",{constructor:function b(c){this.value=c.value;this.writeable=!!c.writeable}})}(ox));(function(a){a.Object.extend("ox.AccessDescriptor",{constructor:function b(c){this.get=c.get;this.set=c.set}})}(ox));(function(b,a){var d=/^\[/;b.Object.extend("ox.AbstractDataEvent",{constructor:function c(g,e,f){this.target=g;this.type=e;this.targetPath=null;this.targetPathComponents=[];this.keys=f;this.separator=""},unshiftPathComponent:function(e){if(this.targetPath==null){this.targetPath=""}if(e==+e){this.targetPath="["+e+"]"+this.separator+this.targetPath;this.targetPathComponents.unshift("["+e+"]");this.separator=""}else{if(d.test(e)){this.targetPath=e+this.separator+this.targetPath;this.targetPathComponents.unshift(e);this.separator=""}else{this.targetPath=e+this.separator+this.targetPath;this.targetPathComponents.unshift(e);this.separator="."}}return this},test:function(e){throw new Error("Cannot invoke abstract method test()")}})}(ox,ox.util));(function(b,a){var e="*";var g=/\[\]/g;var c=/\[\d+\]/g;var f=/\*$/;b.AbstractDataEvent.extend("ox.MapEvent",{constructor:function d(l,j,k,i){if(arguments[0] instanceof b.MapEvent){var h=arguments[0];var m=new b.MapEvent(h.target,h.type,h.keys,h.properties);m.targetPath=h.targetPath;m.targetPathComponents=h.targetPathComponents.slice();m.separator=h.separator;return m}if(j!="set"&&j!="change"){throw new Error("MapEvent must be 'set' or 'change'")}b.AbstractDataEvent.call(this,l,j,k);this.properties=i},test:function(m,h){if(m!=this.type){return false}var n=this.targetPath?this.targetPath.replace(c,"[]")+".":"";h=h.replace(g,"\\[\\]");var j;if(h==e){j=new RegExp("^.+")}else{if(f.test(h)){j=new RegExp("^"+h.slice(0,h.length-2)+"(?:\\.|\\[\\]).+")}else{j=new RegExp("^"+h+"$")}}for(var l=0;l<this.keys.length;l++){var k=this.keys[l];if(j.test(n+k)){return true}}return false}})}(ox,ox.util));(function(b,a){var d="*";var f=/\[\]/g;var c=/\[\d+\]/g;var e=/\*$/;b.AbstractDataEvent.extend("ox.CollectionEvent",{constructor:function g(m,k,l,i,h){if(arguments[0] instanceof b.CollectionEvent){var j=arguments[0];var n=new b.CollectionEvent(j.target,j.type,j.keys,j.items);n.targetPath=j.targetPath;n.targetPathComponents=j.targetPathComponents.slice();n.separator=j.separator;return n}if(k!="add"&&k!="remove"&&k!="move"){throw new Error("CollectionEvent must be 'add', 'remove', or 'move'")}b.AbstractDataEvent.call(this,m,k,l);this.items=i;if(k=="move"){this.origin=h}},test:function(j,h){if(j!=this.type){return false}var k=this.targetPath.replace(c,"[]");h=h.replace(f,"\\[\\]");var i;if(h==d){i=new RegExp("^.+")}else{if(e.test(h)){i=new RegExp("^"+h.slice(0,h.length-2)+"(?:\\.|\\[\\]).+")}else{i=new RegExp("^"+h+"$")}}if(i.test(k)){return true}return false}})}(ox,ox.util));(function(a){a.Object.extend("ox.Connection",{constructor:function b(e,d,c,f){this._target=e;this._key=d;this._bubbler=c;this._resetter=f},equals:function(c){return c._target==this._target&&c._key==this._key},bubble:function(c,d){return this._bubbler.call(c,d)},reset:function(d,c){return this._resetter(d,c)}})}(ox));(function(b,a){b.mixin.Parameterizable={getId:function(){var f=[];var e=this._idKeys.length;for(var d=0;d<e;d++){var c=this._idKeys[d];if(this._params[c]!=null){f.push(c+":"+this._params[c])}}return f.join(",")},getIdKeys:function(){return this._idKeys},getParam:function(c){return this._params[c]},setParam:function(c,e){if(~this._idKeys.indexOf(c)){throw new Error("Cannot set identity parameter '"+c+"'")}var d=a.typeOf(e);if(d!="string"&&d!="number"&&d!="boolean"){throw new Error("Parameter value must be a string, number, or boolean")}this._params[c]=e;return this},getParams:function(){var c={};a.each(this._params,function(e,d){c[d]=e});return c}}}(ox,ox.util));(function(b,a){b.Object.extend("ox.AbstractData",{connect:function(c){var e=false;for(var d=0;d<this._connections.length;d++){if(this._connections[d].equals(c)){e=true;break}}if(!e){this._connections.push(c)}return this},disconnect:function(d,c){throw new Error("Method 'disconnect' is not implemented")},notify:function(f){if(b.config.blockStoreEvents){var c=a.topParent(this);if(c&&c._notifyBlocked){c._notifyQueue.push([this,f]);return this}}if(this._connections.length){var e=[f];for(var d=1;d<this._connections.length;d++){e.push(f instanceof b.MapEvent?new b.MapEvent(f):new b.CollectionEvent(f))}for(d=0;d<e.length;d++){this._connections[d].bubble(this,e[d])}}return this},toJSON:function(){throw new Error("Method 'toJSON' is not implemented")}})}(ox,ox.util));(function(c,a){c.AbstractData.extend("ox.AbstractMap",{Types:{},defaults:{},constructor:function b(e){if(this.constructor==c.AbstractMap){throw new Error("Cannot initialize instance of abstract type "+this.name)}if(this.cid==null){this.cid=a.uniqueId(this.constructor.name?this.constructor.name.toLowerCase():"")}this._connections=[];this._properties={};e||(e={});for(var d in this.defaults){if(this.defaults.hasOwnProperty(d)){var f=this.defaults[d];if(a.typeOf(f)!="function"&&e[d]==null){e[d]=f}}}this.set(e,false);this.initialize()},initialize:function(){},has:function(d){try{return this.get(d)!=null}catch(f){return false}},get:function(d){var f=a.typeOf(d)=="array"?d:d.split(".");if(f.length<=1){return this._properties[d]}else{var e=this._properties[f[0]];if(!e){return undefined}return e.get(f.slice(1))}},set:function(){var d=[];var j={};var e=[];var i={};var h;if(a.typeOf(arguments[0])=="object"){var g=arguments[0];h=arguments[1]!==false;for(var f in g){if(g.hasOwnProperty(f)){this._setOne(f,g[f],d,j,e,i)}}}else{if(arguments[0]){h=arguments[2]!==false;this._setOne(arguments[0],arguments[1],d,j,e,i)}}if(e.length&&this.defaults){a.each(this.defaults,function(l,k){if(a.typeOf(l)=="function"&&!(l.prototype instanceof c.AbstractData)){this._setOne(k,l.call(this),d,j,e,i)}},this)}if(this.notifyOnSet&&d.length&&h){this.notify(new c.MapEvent(this,"set",d,j))}if(e.length&&h){this.notify(new c.MapEvent(this,"change",e,i))}return this},_setOne:function(n,l,j,f,k,h){c.logDetailed('Setting key "%s", value %o',n,l);if(this.prefilter(n,l)){return this}if(typeof l=="undefined"){return this}var m=this._properties[n];var e=false;if(m!==l){var d;if(l==null||l instanceof c.AccessDescriptor||l instanceof c.DataDescriptor){this._properties[n]=l;e=true}else{if(l instanceof c.AbstractData){d=this.Types[n];if(d&&!(l instanceof d)){throw new TypeError("Expected "+d.prototype.name+" for property "+n+" but encountered an object of type "+l.name)}this._properties[n]=l;l.connect(this._createConnection(n,l));e=true}else{d=this.Types[n];if(d){var g=a.resolveType(l);if(c.ProxyCollection.isTypeOf(g)){if(!d.prototype.setProxy){throw new TypeError("Expected "+d.prototype.name+" for property "+n+" but encountered an object of type "+c.AbstractData.isTypeOf(g)?g.prototype.name:g?g.name:null)}}else{if(d!=g){throw new TypeError("Expected "+d.prototype.name+" for property "+n+" but encountered an object of type "+c.AbstractData.isTypeOf(g)?g.prototype.name:g?g.name:null)}}}else{d=a.resolveType(l)}if(c.AbstractData.isTypeOf(d)){if(l[c.config.typeKey]!=null&&l[c.config.idKey]!=null){l=this._properties[n]=new d(l[c.config.idKey])}else{if(c.Entity.isTypeOf(d)){l=this._properties[n]=new d(l)}else{if(c.Map.isTypeOf(d)){if(m instanceof d){l=this._properties[n]=m.set(l)}else{l=this._properties[n]=new d(l)}}else{if(c.AbstractCollection.isTypeOf(d)){var i=m&&m.update(new d(l,false));if(i){l=this._properties[n]=m}else{l=this._properties[n]=new d(l)}}else{throw new Error("Illegal type: "+d.prototype.name)}}}}if(m!==l){l.connect(this._createConnection(n,l));e=true}}else{this._properties[n]=l;e=true}}}}j.push(n);f[n]=l;if(e){if(m instanceof c.AbstractData){m.disconnect(this,n)}k.push(n);h[n]=l}return this},prefilter:function(d,e){return false},connect:function(d){var f=false;for(var e=0;e<this._connections.length;e++){if(this._connections[e].equals(d)){f=true;break}}if(!f){this._connections.push(d)}return this},disconnect:function(g,e){for(var d=0;d<this._connections.length;d++){if(this._connections[d]._target==g&&this._connections[d]._key==e){this._connections.splice(d,1);break}}if(!this._connections.length){for(e in this._properties){if(this._properties.hasOwnProperty(e)){var f=this._properties[e];if(f instanceof c.AbstractData){f.disconnect(this,e)}}}}return this},_createConnection:function(f,g){var e=this;var d=function(i){i.unshiftPathComponent(f);e.notify(i)};var h;if(g instanceof c.Model||g instanceof c.Collection){h=function(j,i){e.set(f,j,i);return e.get(f)}}return new c.Connection(this,f,d,h)},toJSON:function(d){var g={};for(var e in this._properties){if(this._properties.hasOwnProperty(e)){var f=this._properties[e];g[e]=f instanceof c.AbstractData?f.toJSON(d):f}}return g}});c.AbstractMap.extend=function(){var f=c.AbstractData.extend.apply(this,arguments);for(var e in f.prototype.Types){var d=f.prototype.Types[e];if(f.prototype.Types.hasOwnProperty(e)&&!c.AbstractData.isTypeOf(d)&&d!=String&&d!=Number&&d!=Boolean){throw new Error("Type declaration for property "+e+" must be String, Number, Boolean, or a subclass of ox.AbstractData")}}f.extend=this.extend;return f}}(ox,ox.util));(function(b,a){b.AbstractMap.extend("ox.Map")}(ox,ox.util));(function(b,a){b.AbstractMap.extend("ox.Entity",{constructor:function c(){if(this.constructor==b.Entity){throw new Error("Cannot initialize instance of abstract type "+this.name)}this.constructor.store||(this.constructor.store={});var g;var f;if(a.typeOf(arguments[0])=="object"){f=arguments[0]}else{g=arguments[0];f=arguments[1]}if(g==null){g=this.identify(f)}var e=a.typeOf(g);if(!(g==null||e=="string"||e=="number")){throw new Error("Invalid entity id "+this.id+" in "+this.name)}if(g!=null){this.id=""+g;var d=this.constructor.store[this.id];if(d){d.set(f);return d}}this.cid=a.uniqueId("entity");if(f==null&&this.constructor.propStore){f=this.constructor.propStore[this.id]}this.constructor.store[this.id!=null?this.id:this.cid]=this;b.AbstractMap.call(this,f)},initialize:function(){},identify:function(d){return null},toJSON:function(d){var g=false;if(!d){d={};g=true}var e=d[this.name]=d[this.name]||{};var h=this.id!=null?this.id:this.cid;if(!e[h]){e[h]=true;e[h]=b.AbstractMap.prototype.toJSON.call(this,d)}var f={};f[b.config.typeKey]=this.name;f[b.config.idKey]=h;return g?{store:d}:f},fetch:function(e,d){throw new Error("Method 'fetch' is not implemented")},save:function(d){throw new Error("Method 'save' is not implemented")},destroy:function(){throw new Error("Method 'destroy' is not implemented")}});b.Entity.fetch=function(f,e,d){throw new Error("Method 'fetch' is not implemented")};b.Entity.save=function(d){throw new Error("Method 'save' is not implemented")};b.Entity.destroy=function(d){throw new Error("Method 'destroy' is not implemented")}}(ox,ox.util));(function(b,a){b.AbstractMap.extend("ox.Model",b.mixin.Parameterizable,{cache:false,constructor:function c(){if(this.constructor==b.Model){throw new Error("Cannot initialize instance of abstract type "+this.name)}this.constructor.store||(this.constructor.store={});var f=arguments[0];var g;if(a.typeOf(f)=="string"||a.typeOf(f)=="number"){g=f}else{if(f){if(!f.idKeys||!f.params){throw new Error("Constructor for "+this.name+" requires a valid id or JSONified representation of a model")}this._idKeys=f.idKeys;this._params=f.params;g=this.getId()}}if(g==null){throw new Error("Model "+this.name+" requires a non-null id")}var d=this.constructor.store[g];var e=f.properties||{};if(d){if(this._idKeys&&this._params){d._idKeys=this._idKeys;d._params=this._params}d.set(e);return d}this.constructor.store[g]=this;b.AbstractMap.call(this,e)},reset:function(d,f){if(!(d instanceof this.constructor)){throw new Error("Cannot reset model of type "+this.name+" to object of type "+d.name)}var e=this._connections.length;while(e--){this._connections[e].reset(d,f)}return d},fetch:function(e,d){throw new Error("Method 'fetch' is not implemented")},disconnect:function(e,d){b.AbstractMap.prototype.disconnect.call(this,e,d);if(!this.cache&&!this._connections.length&&this.constructor.store[this.getId()]==this){delete this.constructor.store[this.getId()]}return this},toJSON:function(d){var g=false;var f={};if(!d){d={};g=true}var h=this.getId();var e=d[this.name]=d[this.name]||{};if(!e[h]){e[h]=true;e[h]={$model:true,idKeys:this.getIdKeys(),params:this.getParams(),properties:b.AbstractMap.prototype.toJSON.call(this,d)}}f[b.config.typeKey]=this.name;f[b.config.idKey]=h;return g?{store:d}:f}})}(ox,ox.util));(function(b,a){b.mixin.ProxyableCollection={setProxy:function(d,c){throw new Error("Method 'setProxy' is not implemented")}}}(ox,ox.util));(function(b,a){b.AbstractData.extend("ox.AbstractCollection",{Type:null,constructor:function c(d){if(this.constructor==b.AbstractCollection){throw new Error("Cannot initialize instance of abstract type "+this.name)}this.cid=a.uniqueId(this.constructor.name?this.constructor.name.toLowerCase():"");this.length=0;this._items=[];this._connections=[];this.add(d||[],false);this.initialize()},initialize:function(){},get:function(d){return this._items[d]},indexOf:function(d){return this._items.indexOf(d)},contains:function(d){return !!~this.indexOf(d)},validate:function(d){return a.resolveType(d)==this.Type},add:function(){throw new Error("Cannot call abstract method 'add'")},remove:function(){throw new Error("Cannot call abstract method 'remove'")},empty:function(d){d=d!==false;this.remove(this.map(function(e){return(e)}),d)},toArray:function(){return this.map(function(d){return(d)})},update:function(d){throw new Error("Cannot call abstract method 'update'")},disconnect:function(g,e){var d;for(d=0;d<this._connections.length;d++){if(this._connections[d]._target==g&&this._connections[d]._key==e){this._connections.splice(d,1);break}}if(!this._connections.length){for(d=0;d<this._items.length;d++){var f=this._items[d];if(f instanceof b.AbstractData){f.disconnect(this)}}}return this},_createConnection:function(){var e=this;var d=function(f){f.unshiftPathComponent(e._items.indexOf(this));e.notify(f)};return new b.Connection(this,null,d)},toJSON:function(d){return b.AbstractData.isTypeOf(this.Type)?a.map(this._items,function(e){return e.toJSON(d)}):this._items}});b.AbstractCollection.ITERATION_METHODS=["each","map","filter","some","find"];a.each(b.AbstractCollection.ITERATION_METHODS,function(d){b.AbstractCollection.prototype[d]=function(f,e){return a[d](this._items,f,e||this)}})}(ox,ox.util));(function(b,a){b.AbstractCollection.extend("ox.Flags",b.mixin.ProxyableCollection,{Type:String,validate:function(d){var c=a.typeOf(d);return(c=="string"&&d!=="")||(c=="number"&&!isNaN(d))},add:function(c,e){e=e!==false;if(!c){throw new Error("Cannot add a null or empty string to flags in "+this.name)}c=[].concat(c);if(!c.length){return this}var g=[];for(var d=0;d<c.length;d++){var f=c[d];if(!this.validate(f)){throw new TypeError("Item must be of type "+this.Type.name+" to be added to collection of type "+this.name)}c[d]=f=""+f;if(!this.contains(f)){g.push(this._items.push(f));this.length++;if(this._proxy){this._proxy.length++}}}if(e&&g.length){this.notify(new b.CollectionEvent(this,"add",g,c))}return this},remove:function(c,f){f=f!==false;var h=[];var j=[];var e;var g;c=[].concat(c);for(e=0;e<c.length;e++){g=""+c[e];var d=this.indexOf(g);if(~d){h.push(d)}}h.sort(a.numericSort);e=h.length;while(e--){g=this._items[e];j.unshift(this._items.splice(h[e],1)[0]);this.length--;if(this._proxy){this._proxy.length--}}if(f&&h.length){this.notify(new b.CollectionEvent(this,"remove",h,j))}return this},update:function(e){if(!(e instanceof this.constructor||e instanceof b.ProxyCollection)){throw new Error("Cannot update collection of type "+this.name+" to object of type "+e.name)}var d=[];e.each(function(g,f){if(!this.contains(g)){d.push(g)}},this);this.add(d);var c=[];this.each(function(f){if(!e.contains(f)){c.push(f)}});this.remove(c);return true},setProxy:function(d,c){this._proxy=d;return this}})}(ox,ox.util));(function(b,a){b.AbstractCollection.extend("ox.GenericCollection",{constructor:function c(d,e){if(this.constructor==b.GenericCollection){throw new Error("Cannot initialize instance of abstract type "+this.name)}this._cidMap={};this._connected=e!==false;b.AbstractCollection.call(this,d)},contains:function(d){return !!(d&&this._cidMap[d.cid])},move:function(k,h){h=h!==false;var g;var d=[];var j=[];var f={};for(g=0;g<this.length;g++){if(k.hasOwnProperty(g)){d[k[g]]=this._items[g];j.push(k[g]);f[k[g]]=+g}else{d[g]=this._items[g]}}if(h&&j.length){this._items=d;j.sort(a.numericSort);g=j.length;var e=[];while(g--){e.unshift(this._items[j[g]])}this.notify(new b.CollectionEvent(this,"move",j,e,f))}return this},connect:function(d){b.AbstractCollection.prototype.connect.call(this,d);if(!this._connected){for(var e=0;e<this._items.length;e++){this._items[e].connect(this._createConnection())}this._connected=true}return this}})}(ox,ox.util));(function(b,a){b.GenericCollection.extend("ox.Maps",b.mixin.ProxyableCollection,{Type:b.Map,add:function(){var c;var d;var f;if(typeof arguments[0]=="boolean"){c=[{}];d=this._items.length;f=arguments[0]!==false}else{c=[].concat(arguments[0]!=null?arguments[0]:{});if(a.isInteger(arguments[1])){d=+arguments[1];f=arguments[2]!==false}else{d=this._items.length;f=arguments[1]!==false}}if(!c.length){return}if(d<0){throw new Error("Cannot add items at a negative index in "+this.name)}if(d>this.length){throw new Error("Cannot add items at a non-contiguous index in "+this.name)}var h=[];for(var e=0;e<c.length;e++){var g=c[e];if(!this.validate(g)){throw new TypeError("Item must be of type "+this.Type.name+" to be added to collection of type "+this.name)}if(!(g instanceof this.Type)){g=c[e]=new this.Type(g)}if(this.contains(g)){throw new Error("Items must be unique in collection "+this.name)}if(this._connected){g.connect(this._createConnection())}this._items.splice(d+e,0,g);this._cidMap[g.cid]=g;h.push(d+e);this.length++;if(this._proxy){this._proxy.length++}}if(f&&h.length){this.notify(new b.CollectionEvent(this,"add",h,c))}return this},addAtIndices:function(c,d){throw new Error("Method 'addAtIndices' has not yet been implemented for "+this.name)},remove:function(c,f){f=f!==false;var h=[];var j=[];var g;var e;c=[].concat(c);for(e=0;e<c.length;e++){g=c[e];if(a.isInteger(g)){g=+g;if(g>=0&&g<this._items.length){h.push(g)}}else{var d=this.indexOf(g);if(~d){h.push(d)}}}h.sort(a.numericSort);e=h.length;while(e--){g=this._items[h[e]];delete this._cidMap[g.cid];j.unshift(this._items.splice(h[e],1)[0]);this.length--;if(this._proxy){this._proxy.length--}}for(e=0;e<j.length;e++){j[e].disconnect(this)}if(f&&h.length){this.notify(new b.CollectionEvent(this,"remove",h,j))}return this},update:function(c){if(!(c instanceof this.constructor||c instanceof b.ProxyCollection)){throw new Error("Cannot update collection of type "+this.name+" to object of type "+c.name)}return false},setProxy:function(d,c){this._proxy=d;d.move=c(this.move);return this}})}(ox,ox.util));(function(b,a){b.GenericCollection.extend("ox.EntityCollection",{constructor:function c(d,e){if(this.constructor==b.EntityCollection){throw new Error("Cannot initialize instance of abstract type "+this.name)}this._unsyncedMap={};this._isSynced=true;this._idMap={};b.GenericCollection.call(this,d,e)},get:function(d){return this._items[d-this.getOffset()]},getById:function(d){return this._idMap[d]},getByCid:function(d){return this._cidMap[d]},getUnsynced:function(){var d=[];for(var e in this._unsyncedMap){if(this._unsyncedMap.hasOwnProperty(e)){d.push(this.getByCid(e))}}return d},getOffset:function(){return 0},isSynced:function(d){return this.contains(d)&&!this._unsyncedMap[d.cid]},indexOf:function(e){var d=this._items.indexOf(e);return ~d?d+this.getOffset():d},validate:function(e){var d=a.resolveType(e);if(d==b.Map&&!(e instanceof b.AbstractData)){return true}return d===this.Type},add:function(){var d;var e;var j;if(typeof arguments[0]=="boolean"){d=[{}];e=this.length+this.getOffset();j=arguments[0]!==false}else{d=[].concat(arguments[0]!=null?arguments[0]:{});if(a.isInteger(arguments[1])){e=+arguments[1];j=arguments[2]!==false}else{e=this.length+this.getOffset();j=arguments[1]!==false}}if(!d.length){return}var h;var k=[];var g=[];var l=a.map(d,function(n,m){return m+e});this._validateAddKeys(l);if(!this.constructor.prototype.Type){this._setType(d[0])}for(var f=0;f<d.length;f++){h=l[f];g.push(this._addOne(d[f],h));k.push(h)}if(j&&k.length){this.notify(new b.CollectionEvent(this,"add",k,g))}return this},addAtIndices:function(d,h){h=h!==false;var g;var j=[];var k=[];var f=[];for(g in d){if(d.hasOwnProperty(g)&&a.isInteger(g)){k.push(+g)}}k.sort(a.numericSort);if(!k.length){return}this._validateAddKeys(k);if(!this.constructor.prototype.Type){this._setType(d[k[0]])}for(var e=0;e<k.length;e++){g=+k[e];f.push(this._addOne(d[g],g));j.push(g)}if(h&&j.length){this.notify(new b.CollectionEvent(this,"add",j,f))}},_validateAddKeys:function(m){var d=this.length;var f=this.getOffset();var k=[];var h=0;var j=0;var n=[];var l;var g;for(g=0;g<m.length;g++){l=m[g];if(l<f){k.push(l);h++}else{n.push(l);j++}}if(j){for(g=0;g<j;g++){l=n[g];if(l>f+d+g){throw new Error("Cannot add items at a non-contiguous index in "+this.name)}}}if(h){var o=k[0];for(g=1;g<h;g++){var e=k[g];if(e!=o+1){throw new Error("Cannot add items at a non-contiguous index in "+this.name)}o=e}if(k[h-1]<0){throw new Error("Cannot add items at a negative index in "+this.name)}if(k[h-1]!=f-1){throw new Error("Cannot add items at a non-contiguous index in "+this.name)}this._items=new Array(h).concat(this._items);this.setParam("offset",this.getOffset()-h)}return this},_setType:function(e){var d=a.resolveType(e);if(!d||!(b.Entity.isTypeOf(d)||d==b.Map&&!(e instanceof b.AbstractData))){throw new Error("Cannot set item type of collection "+this.name+" to "+d)}if(d==b.Map&&!(e instanceof b.AbstractData)){this.constructor.prototype.Type=b.Entity.extend(this.name+".Entity",false)}else{this.constructor.prototype.Type=d}return this},_addOne:function(f,e){if(!this.validate(f)){throw new TypeError("Item must be of type "+this.Type.name+" to be added to entity collection "+this.name)}if(f[b.config.typeKey]!=null&&f[b.config.idKey]!=null){f=new this.Type(f[b.config.idKey])}else{if(!(f instanceof this.Type)){f=new this.Type(f)}}if(this.contains(f)){throw new Error("Items must be unique in collection "+this.name)}if(this._connected){f.connect(this._createConnection())}var d=e-this.getOffset();if(!this._items[d]){this._items[d]=f}else{this._items.splice(d,0,f)}this._cidMap[f.cid]=f;if(f.id!=null){this._idMap[f.id]=f}else{this.unsync(f)}this.length++;if(this._proxy){this._proxy.length++}return f},remove:function(d,g){g=g!==false;var j=[];var k=[];var l=this.getOffset();var h;var f;d=[].concat(d);for(f=0;f<d.length;f++){h=d[f];if(a.isInteger(h)){h=+h;if(h>=l&&h<this.length+l){j.push(h)}}else{var e=this.indexOf(h);if(~e){j.push(e)}}}j.sort(a.numericSort);f=j.length;while(f--){h=this._items[j[f]-l];delete this._idMap[h.id];delete this._cidMap[h.cid];delete this._unsyncedMap[h.cid];k.unshift(this._items.splice(j[f]-l,1)[0]);this.length--;if(this._proxy){this._proxy.length--}}for(f=0;f<k.length;f++){k[f].disconnect(this)}if(g&&j.length){this.notify(new b.CollectionEvent(this,"remove",j,k))}return this},sync:function(d){if(!(d&&d.id!=null)){throw new Error("Cannot sync an unidentified entity in "+this.name)}delete this._unsyncedMap[d.cid];this._isSynced=true;for(var e in this._unsyncedMap){if(this._unsyncedMap.hasOwnProperty(e)){this._isSynced=false;break}}return this},unsync:function(d){if(this.contains(d)){this._unsyncedMap[d.cid]=true;this._isSynced=false}return this},update:function(m){if(!(m instanceof this.constructor)&&!(this.setProxy&&m instanceof b.ProxyCollection)){throw new Error("Cannot update collection of type "+this.name+" to object of type "+m.name)}if(this._idKeys&&this._params){this._idKeys=m._idKeys;this._params=m._params}var g={};m.each(function(k,j){if(!this.contains(k)){g[j]=k}},this);this.addAtIndices(g);var p=[];this.each(function(i){if(this._unsyncedMap[i.cid]||m.contains(i)){return}p.push(i)});this.remove(p);var f={};if(this._isSynced){this.each(function(k,j){if(this.get(j)!=m.get(j)){f[j]=m.indexOf(k)}})}else{for(var l=0,h=0;l<this.length;l++){var o=this.get(l);if(this._unsyncedMap[o.cid]){continue}if(this.get(l)!=m.get(h)){var n=m.indexOf(o);var d=0;for(var e=0;e<n;e++){if(!this.isSynced(this.get(e).cid)){d++}}while(1){o=this.get(e+1);if(o&&!this.isSynced(o)){d++;e++}else{break}}f[l]=n+d}h++}}this.move(f);return true}})}(ox,ox.util));(function(b,a){b.EntityCollection.extend("ox.AnonymousCollection",b.mixin.ProxyableCollection,{_setType:function(d){var c=a.resolveType(d);if(!c||!b.Entity.isTypeOf(c)){throw new Error("Cannot set item type of collection "+this.name+" to "+c)}this.Type=c;return this},setProxy:function(d,c){this._proxy=d;d.getById=c(this.getById);d.getByCid=c(this.getByCid);d.getUnsynced=c(this.getUnsynced);d.getOffset=c(this.getOffset);d.isSynced=c(this.isSynced);d.addAtIndices=c(this.addAtIndices);d.move=c(this.move);d.sync=c(this.sync);d.unsync=c(this.unsync);return this}})}(ox,ox.util));(function(b,a){b.EntityCollection.extend("ox.Collection",b.mixin.Parameterizable,{cache:false,constructor:function c(){if(this.constructor==b.Collection||this.constructor==b.SortedCollection||this.constructor==b.Stream){throw new Error("Cannot initialize instance of abstract type "+this.name)}this.constructor.store||(this.constructor.store={});if(a.typeOf(arguments[0])=="string"||a.typeOf(arguments[0])=="number"){if(!this.constructor.store[arguments[0]]){throw new Error("Collection with id "+arguments[0]+" of type "+this.name+" does not exist")}return this.constructor.store[arguments[0]]}var f=arguments[0];var d=f.items;var e=arguments[1]!==false;if(!f.idKeys||!f.params){throw new Error("Constructor for "+this.name+" requires a valid id or JSONified representation of a collection")}this._idKeys=f.idKeys||[];this._params=f.params||{};if(e){if(this.constructor.store[this.getId()]){throw new Error("Collection with id "+this.getId()+" of type "+this.name+" already exists in store")}this.constructor.store[this.getId()]=this}b.EntityCollection.call(this,d,e)},reset:function(f,e){if(!(f instanceof this.constructor)){throw new Error("Cannot reset collection of type "+this.name+" to object of type "+f.name)}var d=this._connections.length;e=e!==false;while(d--){this._connections[d].reset(f,e)}return f},fetch:function(e,d){throw new Error("Method 'fetch' is not implemented")},connect:function(d){b.EntityCollection.prototype.connect.call(this,d);this.constructor.store[this.getId()]=this;return this},disconnect:function(e,d){b.EntityCollection.prototype.disconnect.call(this,e,d);if(!this._connections.length&&!this.cache&&this.constructor.store[this.getId()]==this){delete this.constructor.store[this.getId()]}return this},toJSON:function(e){var h=false;var g={};if(!e){e={};h=true}var i=this.getId();var f=e[this.name]=e[this.name]||{};if(!f[i]){f[i]=true;var d=b.AbstractCollection.prototype.toJSON.call(this,e);d.__offset__=this.getOffset();f[i]={$collection:true,idKeys:this.getIdKeys(),params:this.getParams(),items:d}}g[b.config.typeKey]=this.name;g[b.config.idKey]=i;return h?{store:e}:g}})}(ox,ox.util));(function(b,a){b.Collection.extend("ox.SortedCollection",{sort:function(e,d){var c=[e.id,d.id];c.sort();return c[0]==e.id?-1:1},add:function(d,g){g=g!==false;if(a.typeOf(d)!="array"){d=[d||{}]}if(!d.length){return this}if(!this.Type){var c=a.resolveType(d[0]);if(!c||!b.Entity.isTypeOf(c)){throw new Error("Invalid collecion type "+c.name+" in "+this.name)}this.Type=c}var k=[];for(var f=0;f<d.length;f++){var h=d[f];if(!this.validate(h)){throw new TypeError("Expected "+this.Type.name+" in "+this.name)}if(h[b.config.typeKey]!=null&&h[b.config.idKey]!=null){d[f]=h=new this.Type(null,h[b.config.idKey])}else{if(!(h instanceof this.Type)){d[f]=h=new this.Type(h)}}if(this._connected){h.connect(this._createConnection())}for(var e=0;e<this._items.length;e++){if(this.sort(h,this._items[e])==1){break}}this._items.splice(e,0,h);if(h.id!=null){this._idMap[h.id]=h}this._cidMap[h.cid]=h;if(h.id==null){this.unsync(h)}k.push(e);this.length++}if(g&&k.length){this.notify(new b.CollectionEvent(this,"add",k,d))}return this},move:function(){throw new Error("Cannot move items in sorted collection "+this.name)},update:function(e){var d=[];e.each(function(g,f){if(!this.getById(g.id)){d.push(g)}},this);this.add(d);var c=[];this.each(function(f){if(f.id==null||e.getById(f.id)){return}c.push(f)});this.remove(c);return true}})}(ox,ox.util));(function(b,a){b.Collection.extend("ox.Stream",{offsetParam:"offset",limitParam:"limit",getOffset:function(){return +(this.getParam(this.offsetParam)||0)},getLimit:function(){return +(this.getParam(this.limitParam)||0)},indexOf:function(d){var c=this._items.indexOf(d);return ~c?c+this.getOffset():-1},move:function(){throw new Error("Cannot move items in stream "+this.name)},update:function(h){if(!(h instanceof this.constructor)){throw new Error("Cannot update collection of type "+this.name+" to object of type "+h.name)}var f=this.getOffset();var c=this.length;var i=h.getOffset();var g=h.getLimit();var e=h.length;if(h.length===0&&g!=null&&i===0&&g>0){var d=[];this.each(function(j){if(this.isSynced(j)){d.push(j)}});this.remove(d);this.setParam(this.offsetParam,0);return true}if(i+e==f||i==f+c-this.getUnsynced().length){return this._updateAdjacent(h)}if(i<f+c&&i+e>f){return this._updateOverlap(h)}return false},_updateAdjacent:function(g){var h=g.getOffset();var e=g.length;var f=[];for(var c=h;c<h+e;c++){var d=g.get(c);if(this.contains(d)){return false}f.push(d)}this.add(f,h+this.getUnsynced().length);return true},_updateOverlap:function(v){var h=this.getOffset();var f=this.length;var c=v.getOffset();var C=v.length;var s=Math.min(h,c);var D={};var n;var B;var x;var A;for(A=c;A<c+C;A++){B=v.get(A);if(this.contains(B)){n=B;break}}if(!n){return false}var r=A;var e=this.indexOf(n);var p=e;var t=0;var q=0;for(A=h;A<e;A++){if(!this.isSynced(this.get(A))){if(A<c){t++}q++}}if(c>h&&e-q>c){return false}if(r<e-q&&c>0&&h!=c){return false}var o=t;for(A=c;A<c+o;A++){x=this.get(A);if(x&&!this.isSynced(x)){o++}}var w=c+o;var z=Math.max(h,c+o);for(A=c;A<c+C;A++){while(1){x=this.get(z);if(x&&!this.isSynced(x)){w++;z++}else{break}}B=v.get(A);if(this.contains(B)){var d=false;for(var y=z;y<h+f;y++){if(this.get(y)==B){d=true;break}}if(d){p=y;w+=y+1-z;z=y+1;continue}return false}D[w++]=B}this.addAtIndices(D);f=this.length;h=this.getOffset();var g=Math.max(c+C,p+1);var u=[];for(A=c+o;A<g;A++){x=this.get(A);if(x&&!v.contains(x)&&this.isSynced(x)){u.push(x)}}if(h+f>c+C&&C<v.getParam("limit")){var l=h;var m=h;for(A=h;A<h+f;A++){l++;x=this.get(A);if(this.isSynced(x)){m++}if(m==c+C){break}}for(A=l;A<h+f;A++){x=this.get(A);if(!v.contains(x)){~u.indexOf(x)||u.push(x)}}}this.remove(u);this.setParam(this.offsetParam,s);return true}})}(ox,ox.util));(function(b,a){b.AbstractCollection.extend("ox.ProxyCollection",{constructor:function c(){this._collection=null;b.AbstractCollection.call(this)},initialize:function(){if(this._collection){this._collection.initialize.apply(this._collection,arguments)}return this},getCollection:function(){return this._collection},get:function(){if(this._collection){return this._collection.get.apply(this._collection,arguments)}return void 0},indexOf:function(){if(this._collection){return this._collection.indexOf.apply(this._collection,arguments)}return -1},contains:function(){if(this._collection){return this._collection.contains.apply(this._collection,arguments)}return false},validate:function(){if(this._collection){return this._collection.validate.apply(this._collection,arguments)}return false},add:function(e){if(this._collection){this._collection.add.apply(this._collection,arguments);return this}if(e==null){throw new Error("Cannot infer default item to add to an empty proxy collection")}e=[].concat(e);if(!e.length){return this}var h=e[0];var g=a.typeOf(h);var f;if(g=="string"){f=b.Flags}else{if(g=="object"){if(h instanceof b.Entity||h[b.config.typeKey]!=null&&h[b.config.idKey]!=null){f=b.util.resolveType(e)}else{f=b.Maps}}else{throw new Error("Cannot add item of type "+g+" to an instance of "+this.name)}}var d=this;var i=this._collection=new f();i.connect(new b.Connection(this,null,function(j){if(j.target==d._collection){j.target=d}d.notify(j)}));i.setProxy(this,function(j){return j.bind(i)});this.cid=i.cid;i.add.apply(i,arguments);return this},remove:function(){if(this._collection){this._collection.remove.apply(this._collection,arguments)}return this},update:function(e,d){if(this._collection){return this._collection.update.apply(this._collection,arguments)}this.add(e._items,d);return true},toJSON:function(d){if(this._collection){return this._collection.toJSON.apply(this._collection,arguments)}return[]}});a.each(b.AbstractCollection.ITERATION_METHODS,function(d){b.ProxyCollection.prototype[d]=function(){if(this._collection){return this._collection[d].apply(this._collection,arguments)}return b.AbstractCollection.prototype[d].apply(this,arguments)}})}(ox,ox.util));(function(b,a){b.Object.extend("ox.ContextTransformation",{constructor:function c(i,d,h){var g={};if(d){g[d]={key:i,value:h}}else{var f=/(?:^|,) *([$_\w][$_\w.]*)(?: *as *([$_\w]+))?/g;var e;while(!!(e=f.exec(i))){g[e[1]]={key:e[2]||e[1]}}}return g}})}(ox,ox.util));(function(c,a){c.AbstractMap.extend("ox.Context",c.mixin.ContextEventPublisher,{constructor:function b(d,e){this._parent=e;this._children=[];c.AbstractMap.call(this,d)},createChild:function(h,e){var g=this;var f={};a.each(h,function(l,i){var j=l.key;if("value" in l){f[j]=new c.DataDescriptor({value:l.value,writeable:false})}else{var k=g.get(i);if(k instanceof c.AccessDescriptor){f[j]=k}else{f[j]=new c.AccessDescriptor({get:function(){return g.get(i)},set:function(n){var o=g;var p=i.split(".");var m;while((m=p.shift()),p.length){o=o.get(m)}o.set(m,n)}})}}});var d=new c.Context(f,e?g:null);this._children.push({context:d,transformation:h});return d},destroyChild:function(d){for(var e=0;e<this._children.length;e++){if(this._children[e].context==d){this._children.splice(e,1);break}}return this},destroyChildren:function(){this._children=[];return this},has:function(d){try{return this.get(d)!=null}catch(f){return false}},get:function(d){var h=a.typeOf(d)=="array"?d:d.split(".");if(!(h[0] in this._properties)){if(this._parent){return this._parent.get(h)}else{var e=[];a.each(this._properties,function(j,i){e.push("'"+i+"'")});throw new Error("Invalid context key '"+d+"'. Valid keys: "+(e.join(", ")||"(none)")+".")}}var g=this._properties[h[0]];var f;if(g instanceof c.AccessDescriptor){f=g.get()}else{if(g instanceof c.DataDescriptor){f=g.value}else{f=g}}return h.length>1?f.get(h.slice(1)):f},set:function(){var e={};var d;if(a.typeOf(arguments[0])=="object"){d=arguments[1]!==false;e=arguments[0]}else{if(arguments[0]){d=arguments[2]!==false;e[arguments[0]]=arguments[1]}}a.each(e,function(g,f){var h=this._properties[f];if(h instanceof c.AccessDescriptor){h.set(g)}else{if(h instanceof c.DataDescriptor&&!h.writeable){throw new Error("Property "+f+" is not writeable")}c.AbstractMap.prototype.set.call(this,f,g,d)}},this);return this},notify:function(s){if(c.config.blockStoreEvents){var w=a.topParent(this);if(w&&w._notifyBlocked){w._notifyQueue.push([this,s]);return this}}var d=s.targetPathComponents;for(var t=0;t<this._children.length;t++){var n=this._children[t];var p=n.context;var m=n.transformation;var f;for(var r=0;r<d.length;r++){var e=d.slice(0,r+1);var x=a.joinDataPathComponents(e);var g=m[x];if(!g){continue}var l=g.key;if("value" in g){var v=g.value;var q=d[r+1]&&+(d[r+1].match(/\d+/)[0]);if(q==null){continue}var k=this.get(x).get(q);if(v!=k){continue}}if(s instanceof c.MapEvent){f=new c.MapEvent(s.target,s.type,s.keys,s.properties)}else{f=new c.CollectionEvent(s.target,s.type,s.keys,s.items)}var u;if("value" in g){u=[l].concat(d.slice(r+2))}else{u=[l].concat(d.slice(r+1))}while(u.length){f.unshiftPathComponent(u.pop())}p.notify(f)}if(s instanceof c.MapEvent){var o=[];var h={};a.each(s.properties,function(j,i){var y=m[(s.targetPath?s.targetPath+".":"")+i];if(y&&!("value" in y)){o.push(y.key);h[y.key]=j}});if(o.length){f=new c.MapEvent(s.target,s.type,o,h);p.notify(f)}}}c.log("%cPublished context event","color:#58d",s);this.publish(s);return this},toJSON:function(d){var f=false;if(!d){d={};f=true}var e={};a.each(this._properties,function(h,g){while(h instanceof c.DataDescriptor||h instanceof c.AccessDescriptor){if(h instanceof c.DataDescriptor){h=h.value}else{h=h.get()}}e[g]=h instanceof c.AbstractData?h.toJSON(d):h});return f?{store:d,context:e}:e},"export":function(d){return c["export"](this.toJSON(),d)},getParams:function(){var f={};for(var d in this._properties){if(this._properties.hasOwnProperty(d)){var e=this._properties[d];if(e&&e.getParams==c.mixin.Parameterizable.getParams){f[e.name]||(f[e.name]=[]);f[e.name].push(e.getParams())}}}return f}})}(ox,ox.util));(function(e,b,r){var j="data-ox-name";var f="data-ox-context";var p="data-ox-id";var o=/^ *@oxEach */;var k=/^ *\/oxEach *$/;var i=/^(\w+) *(.*?) *(\$)? *$/;var a=/^ *(\w+) *> *(.*) *$/;var h=/^ *| *(?= |$)/g;var n="change *";var d="add *";var m="remove *";var q=1;var g=3;var c=8;e.Object.extend("ox.View",e.mixin.ContextEventSubscriber,{autoRender:null,events:null,contextEvents:null,constructor:function l(s){if(this.constructor==e.View){throw new Error("Cannot initialize instance of abstract type "+this.name)}this.cid=b.uniqueId("view");this.context=s.context;this.autoRender=this.autoRender!=null?!!this.autoRender:!!s.autoRender;this._subviews={};this._subviewOptions=s.subviewOptions||{};this._autoRenderEnabled=false;this._activeBindings={};this._subviewBindings={};this._windowEvents=[];var u=r.unwrap(s.element);u.oxView=this;this.element=r.wrap(s.element);for(var t in this.events){if(this.events.hasOwnProperty(t)){b.each(t.split("|"),function(v){this.addEvent(v.trim(),this.events[t])},this)}}if(this.autoRender){this.enableAutoRender()}e.log("%cCreated view","color:#B3974D",r.unwrap(this.element));this._initialize(true)},template:function(){throw new Error("Cannot call abstract method template()")},render:function(u,y){e.log("%cRendering %c"+this.name,"font-weight:600","font-weight:600;color:#A38531");if(typeof u==="undefined"){this._unloadSubviews()}var w=this.template();if(w){w="<br/>"+w}if(typeof u==="undefined"){r.html(this.element,w);var v=r.unwrap(this.element);if(v.childNodes.length){v.removeChild(v.childNodes[0])}this._initialize()}else{var s=document.createElement("div");r.html(r.wrap(s),w);var x='[data-ox-section-name="'+u+'"]';if(y){x+='[data-ox-section-id="'+y+'"]'}var t=r.find(s,x);b.each(t,function(B,z){var A='[data-ox-section-name="'+u+'"]';var D=B.getAttribute("data-ox-section-id");if(D){A+='[data-ox-section-id="'+D+'"]'}var C=r.find(this.element,A)[0];if(!C){e.warn("Couldn't find target for child node during render section: "+A);return}r.replace(C,B)},this);if(this.initializeSection){this.initializeSection(t,u,y)}}return this},_initialize:function(){this._subviews=this._buildSubviews(r.unwrap(this.element).childNodes);for(var s in this.contextEvents){if(this.contextEvents.hasOwnProperty(s)){b.each(s.split("|"),function(t){this.addContextEvent(t.trim(),this.contextEvents[s])},this)}}this.initialize();return this},initialize:function(){},_buildSubviews:function(u){var t={};var s=u;while(s&&s.length){s=this._buildSubviewsInner(s,t)}return t},_buildSubviewsInner:function(t,C){var z=[];for(var F=0;F<t.length;F++){var u=t[F];var L=undefined;var E=undefined;if(u.nodeType==q&&u.getAttribute(j)){var y=new e.ContextTransformation(u.getAttribute(f));var I=this.context.createChild(y);L=u.getAttribute(j);var x=b.resolvePath(L);if(x&&!(e.View.isTypeOf(x))){throw new Error("Type "+L+" must resolve to a subclass of ox.View")}if(!x){x=e.View.extend(L)}e.call(L+" init",function(){var M=new x(b.extend({element:u,context:I},this._subviewOptions));if(!C[L]){C[L]=[]}C[L].push(M)},this)}else{if(u.nodeType==c&&o.test(u.nodeValue)){var w=undefined;var G=undefined;var A=undefined;var J=/ *name="([^"]*)"| *context="(\w+) in ([a-zA-Z_$][\w$.]*)"| *begin="(\d+)"| *end="(\d+)"/g;var D=[];var K=false;var B=u;var H=undefined;var v=undefined;while(!!(w=J.exec(B.nodeValue))){if(w[1]){L=w[1]}else{if(w[2]){G=w[2];A=w[3]}else{if(w[4]){H=+w[4]}else{if(w[5]){v=+w[5]}}}}}while(!!(B=B.nextSibling)&&!(B.nodeType==c&&k.test(B.nodeValue))){F++;if(B.nodeType==q&&!/\bvelocityMarkup\b/.test(B.className)){D.push(B)}if(B.getAttribute&&B.getAttribute(p)!=null){K=true}}if(K){E=D.length;while(E--){if(D[E].getAttribute(p)==null){z.push(D.splice(E,1)[0])}}}e.call(L+" init",function(){var M=new e.ViewCollection(b.extend({name:this.name.replace(/(:.*)?$/,":"+L),element:u,nodes:D,context:this.context,collectionKey:A,itemKey:G,begin:H,end:v,explicitId:K},this._subviewOptions));if(!C[L]){C[L]=[]}C[L].push(M)},this)}else{if(u.childNodes){var s=[];for(E=0;E<u.childNodes.length;E++){s.push(u.childNodes[E])}Array.prototype.push.apply(z,s)}}}}return z},getSubview:function(s){var t=this.getSubviews(s);return t?t[0]:null},getSubviews:function(s){var t=this._subviews[s];return t&&t.length?t:null},addContextEvent:function(s,y,t){if(b.typeOf(y)!="function"){throw new Error("Argument 'callback' is not a function")}t||(t=this);var v=s.match(a);if(v){var x=this._subviews[v[1]];if(x){for(var w=0;w<x.length;w++){x[w].addContextEvent(v[2],y,t)}}else{e.warn("No subview with name "+v[1])}return this}s=s.replace(h,"");this.removeContextEvent(s);var u=this;if(y==this._cachedAutoRenderCallback){this.subscribe(this.context,s,y)}else{this.subscribe(this.context,s,function(z){e.log("%cTriggered %c"+s+"%c in "+u.name,"font-weight:600","font-weight:600;color:#039","font-weight:600");e.call(u.name+"-"+s,y,t,z,u==t?undefined:u)})}this._activeBindings[s]=true;return this},removeContextEvent:function(s,w){var t=s.match(a);if(t){var v=this._subviews[t[1]];if(v){for(var u=0;u<v.length;u++){v[u].removeContextEvent(t[2],w)}}else{e.warn("No subview with name "+t[1])}return this}if(this._activeBindings[s]){this.unsubscribe(this.context,s,w);delete this._activeBindings[s]}return this},enableAutoRender:function(){var s=this;if(!this._autoRenderEnabled){var t=this._cachedAutoRenderCallback=function(u){s._autoRenderCallback(u)};this.addContextEvent(n,t);this.addContextEvent(d,t);this.addContextEvent(m,t);this._autoRenderEnabled=true}return this},disableAutoRender:function(){if(this._autoRenderEnabled){this.removeContextEvent(n,this._cachedAutoRenderCallback);this.removeContextEvent(d,this._cachedAutoRenderCallback);this.removeContextEvent(m,this._cachedAutoRenderCallback);this._autoRenderEnabled=false}return this},_autoRenderCallback:function(t){var u;var s;for(u in this._activeBindings){if(this._activeBindings.hasOwnProperty(u)){if(u==n||u==d||u==m){continue}s=u.split(/ (?=\S*$)/);if(t.test(s[0],s[1])){return}}}this._computeSubviewBindings();for(u in this._subviewBindings){if(this._subviewBindings.hasOwnProperty(u)){s=u.split(/ (?=\S*$)/);if(t.test(s[0],s[1])){return}}}e.log("%cAuto-rendering %c"+this.name,"font-weight:600","font-weight:600;color:#A38531");this.render()},_computeSubviewBindings:function(){var t=this;var s;var u;var v;this._subviewBindings={};for(u in this._subviews){if(this._subviews.hasOwnProperty(u)){var x=this._subviews[u];for(v=0;v<x.length;v++){var y=x[v];var w=y._getBindings();for(s in w){if(w.hasOwnProperty(s)){if(y instanceof e.ViewCollection){this._subviewBindings[s]||(this._subviewBindings[s]=0);this._subviewBindings[s]+=w[s]}else{throw new Error("Subview support not yet implemented")}}}}}}return this},_getBindings:function(){this._computeSubviewBindings();var t={};var s;for(s in this._activeBindings){if(this._activeBindings.hasOwnProperty(s)){t[s]=1}}for(s in this._subviewBindings){if(this._subviewBindings.hasOwnProperty(s)){t[s]||(t[s]=1);t[s]+=this._subviewBindings[s]}}return t},addEvent:function(s,x){var t=this;var u=s.match(i);if(!u){throw new Error("Invalid event selector "+s)}var v=u[1];s=u[2];var w=u[3];if(b.typeOf(x)=="string"){if(t[x]){x=t[x]}else{throw new Error("View does not have a method '"+x+"'")}}if(!s||r.is(this.element,s)){r.on(this.element,v,function(y){return e.call(t.name+"-"+v+" "+s,x,t,y)})}else{if(s=="window"){r.on(r.wrap(window),v,function(y){return e.call(t.name+"-"+v+" "+s,x,t,y,r.wrap(window))});this._windowEvents.push({eventType:v,callback:x})}else{r.on(this.element,v,s,function(C){e.log("%cTriggered %c"+v+" "+s+"%c in "+t.name,"font-weight:600","font-weight:600;color:#A38531","font-weight:600");var y=r.unwrap(t.element);var z=r.find(t.element,s);var B=C.target;var D;var A;do{if(~z.indexOf(B)){A=B}if(A&&B.oxView){D=B.oxView;break}}while(!!(B=B.parentNode)&&B!=y);if(!w||A==C.target){return e.call(t.name+"-"+v+" "+s,x,t,C,r.wrap(A),D)}})}}return this},removeEvent:function(s){var t=s.match(i);if(!t){throw new Error("Invalid event selector "+s)}if(t[2]=="window"){var u=this._windowEvents.length;while(u--){if(this._windowEvents[u].eventType==t[1]){r.off(window,this._windowEvents[u].eventType,this._windowEvents[u].callback);this._windowEvents.splice(u,1)}}}else{r.off(this.element,t[1],t[2])}return this},unload:function(){this._unloadSubviews();r.unwrap(this.element).oxView=null;this.unsubscribe();r.off(this.element);if(this._windowEvents){for(var s=0;s<this._windowEvents.length;s++){r.off(window,this._windowEvents[s].eventType,this._windowEvents[s].callback)}this._windowEvents=[]}return this},_unloadSubviews:function(){for(var s in this._subviews){if(this._subviews.hasOwnProperty(s)){var u=this._subviews[s];for(var t=0;t<u.length;t++){u[t].unload()}}}this.context.destroyChildren();this._subviews={};return this}})}(ox,ox.util,ox.domutil));(function(b,a,c){var d="data-ox-id";b.Object.extend("ox.ViewCollection",b.mixin.ContextEventSubscriber,{constructor:function e(g){this.cid=a.uniqueId("viewCollection");this.name=g.name;this.element=g.element;this.context=g.context;this._exportedContext=null;this._itemKey=g.itemKey;this._itemKeyRegExp=new RegExp("^(\\w+ )"+this._itemKey+"\\b");this._collectionKey=g.collectionKey;this._begin=g.begin||0;this._end=g.end;this._explicitId=g.explicitId||!g.nodes.length;this._autoSizeEnabled=false;this._subviews={};this._subviewOptions=g.subviewOptions||{};this._activeBindings={};this._subviewBindings={};this._bindingsToAdd={};this._validateIndices();var f=a.resolvePath(this.name);if(f&&!(b.ViewCollectionItem.isTypeOf(f))){throw new Error("Type "+name+" must resolve to a subclass of ox.ViewCollectionItem")}if(!f){f=b.ViewCollectionItem.extend(this.name)}this._Type=f;b.log("%cCreated view collection","color:#B3974D",c.unwrap(this.element));this._subviews[this.name]=this.children=this._buildSubviews(g.nodes);this._addEvictionBindings()},render:function(f,h){var k;for(k=0;k<this.children.length;k++){var l=c.unwrap(this.children[k].element);if(l.parentNode){l.parentNode.removeChild(l)}}this._unloadSubviews();if(f!=null||h!=null){this._begin=f!=null?+f:0;this._end=h!=null?+h:h}this._validateIndices();var m=this.context.get(this._collectionKey);var j=m instanceof b.EntityCollection?m.getOffset():0;var g=m.length+j;var n=Math.max(this._begin,j);var o=Math.min(this._end||g,g);for(k=n;k<o;k++){this.add(m.get(k))}return this},_validateIndices:function(){if(this._end!=null&&this._begin>this._end){throw new Error("Begin index ("+this._begin+") cannot exceed end index ("+this._end+") in view collection "+this.name)}if(this._begin<0){throw new Error("Begin index ("+this._begin+") cannot be negative in "+this.name)}},enableAutoSize:function(f){f||(f={});if(!this._autoSizeEnabled){if(f.allowAdd!==false){this.addContextEvent("add "+this._collectionKey+"",this._autoSizeAdd,this)}if(f.allowRemove!==false){this.addContextEvent("remove "+this._collectionKey+"",this._autoSizeRemove,this)}this._autoSizeEnabled=true}if(a.typeOf(f.add)=="function"){this._addElement=f.add}if(a.typeOf(f.remove)=="function"){this._removeElement=f.remove}return this},disableAutoSize:function(){if(this._autoSizeEnabled){this.removeContextEvent("add "+this._collectionKey+"");this.removeContextEvent("remove "+this._collectionKey+"");this._autoSizeEnabled=false}this._addElement=b.ViewCollection.prototype._addElement;this._removeElement=b.ViewCollection.prototype._removeElement;return this},_autoSizeAdd:function(h){var j=this.context.get(this._collectionKey);if(h.target!=j&&!(j instanceof b.ProxyCollection&&h.target==j.getCollection())){throw new Error("ViewCollection "+this.name+" is out of sync")}for(var g=0;g<h.keys.length;g++){var f=h.keys[g];if(f>=this._begin&&(this._end==null||f<this._end)){this.add(h.items[g])}}return this},_autoSizeRemove:function(l){var m=this.context.get(this._collectionKey);if(l.target!=m&&!(m instanceof b.ProxyCollection&&l.target==m.getCollection())){throw new Error("ViewCollection "+this.name+" is out of sync")}var h;for(h=0;h<l.keys.length;h++){var g=l.keys[h];if(g>=this._begin&&(this._end==null||g<this._end)){this.remove(l.items[h])}}if(this._end!=null){for(h=this._begin;h<this._end;h++){var k=m.get(h);if(!k){continue}var n=false;for(var f=0;f<this.children.length;f++){if(this.children[f].context.get(this._itemKey)==k){n=true;break}}if(!n){this.add(k)}}}return this},_computeSubviewBindings:function(){this._subviewBindings={};for(var g=0,k=this.children.length;g<k;g++){var l=this.children[g];var h=l._getBindings();for(var f in h){if(h.hasOwnProperty(f)){var j=f.replace(this._itemKeyRegExp,"$1"+this._collectionKey+"[]");this._subviewBindings[j]||(this._subviewBindings[j]=0);this._subviewBindings[j]+=h[f]}}}return this},_getBindings:b.View.prototype._getBindings,_buildSubviews:function(f){var o=[];var p;var l;this._validateNodes(f);var k=0;var m=this.context.get(this._collectionKey);for(l=0;l<f.length;l++){var j=f[l];p=this._explicitId?m.getById(j.getAttribute(d)):m.get(this._begin+k++);var g=new b.ContextTransformation(this._itemKey,this._collectionKey,p);var h=this.context.createChild(g,true);var n=new this._Type(a.extend({element:j,context:h,collection:m,item:p,getExportedContext:this._getExportedContext.bind(this)},this._subviewOptions));o.push(n)}return o},_addEvictionBindings:function(){this.addContextEvent("add *",this._evictExportedContext,this,false);this.addContextEvent("move *",this._evictExportedContext,this,false);this.addContextEvent("change *",this._evictExportedContext,this,false);this.addContextEvent("remove *",this._evictExportedContext,this,false)},_evictExportedContext:function(){b.log("Evicting cached exported context for %c%s","color:#039",this._collectionKey);this._exportedContext=null},_getExportedContext:function(f){if(b.config.debug){var j=Date.now()}if(this._exportedContext==null){this._exportedContext=this.context["export"](true)}var i=f?f["export"]():{};for(var g in i){if(i.hasOwnProperty(g)){this._exportedContext[g]=i[g]}}if(b.config.debug){var h=Date.now()-j;b.logDetailed("%cExport context timing %c"+h+" ms"+(h<200?"":" (slow)"),"font-weight:600;","font-weight:600;color:"+((h<200)?"#00b200":"#c00"))}return this._exportedContext},_validateNodes:function(g){var p=this.context.get(this._collectionKey);var m=p instanceof b.EntityCollection?p.getOffset():0;var k=p.length+m;var q=Math.max(this._begin,m);var t=Math.min(this._end||k,k);if(this._explicitId){var o=q;for(var n=0;n<g.length;n++){var h=g[n].getAttribute(d);var s=p.getById(h);if(!s){throw new Error("View collection node with "+d+" "+h+" is not present in collection of type "+p.name)}var f=-1;for(var l=o;l<t;l++){if(p.get(l)==s){f=l;break}}if(!~f){throw new Error("View collection node with "+d+" "+h+" is either misordered or out-of-bounds")}o=f}}else{var r=Math.max(t-q,0);if(g.length>r){throw new Error("Too many nodes in view collection "+this.name+". This may have occurred if the body of the corresponding oxEach loop has more than one root DOM node. To fix, ensure that each iteration of the oxEach loop only creates one root DOM node (i.e. no siblings).")}if(g.length<r){throw new Error("Too few nodes in view collection "+this.name+". This may have occurred if items were skipped in the corresponding oxEach loop. To fix, if items need to be skipped, set a 'data-ox-id' attribute on the root DOM node of each section of markup that corresponds to a single item.")}}return this},getSubview:b.View.prototype.getSubview,getSubviews:b.View.prototype.getSubviews,addContextEvent:function(f,k,g,j){if(a.typeOf(k)!="function"){throw new Error("Argument 'callback' is not a function")}j=j!==false;g||(g=this);if(!f.match(this._itemKeyRegExp)){this.subscribe(this.context,f,function(i){if(k==this._autoSizeAdd||k==this._autoSizeRemove){b.log("%cAuto-sizing on %c"+f+"%c in "+this.name,"font-weight:600","font-weight:600;color:#039","font-weight:600")}else{b.log("%cTriggered %c"+f+"%c in "+this.name,"font-weight:600","font-weight:600;color:#039","font-weight:600")}b.call(this.name+"-"+f,k,g,i)}.bind(this));if(j){this._activeBindings[f]=true}}else{for(var h=0;h<this.children.length;h++){this.children[h].addContextEvent(f,k,g,j)}this._bindingsToAdd[f]={callback:k,thisArg:g}}return this},removeContextEvent:b.View.prototype.removeContextEvent,add:function(q){var k=this.context.get(this._collectionKey);if(!k.contains(q)){throw new Error("Cannot add subview to view collection "+this.name+" because the underlying collection does not contain the given item")}var l=k.indexOf(q);if(l<this._begin){throw new Error("Cannot add subview to view collection "+this.name+" because the index ("+l+") of the given item is less than the begin index ("+this._begin+")")}if(this._end!=null&&l>=this._end){throw new Error("Cannot add subview to view collection "+this.name+" because the index ("+l+") of the given item is greater than the end index ("+this._end+")")}var r=this;var o=new b.ContextTransformation(this._itemKey,this._collectionKey,q);var g=this.context.createChild(o,true);var f;try{f=new this._Type(a.extend({context:g,collection:k,item:q,getExportedContext:this._getExportedContext.bind(this)},this._subviewOptions))}catch(m){if(m instanceof b.ViewCollectionItem.MissingElementError){return false}throw m}for(var h in this._bindingsToAdd){if(this._bindingsToAdd.hasOwnProperty(h)){var n=this._bindingsToAdd[h];f.addContextEvent(h,n.callback,n.thisArg)}}for(var j=0;j<this.children.length;j++){if(k.indexOf(this.children[j].context.get(this._itemKey))>l){break}}this.children.splice(j,0,f);this._addElement(f.element,function(){var i;l=r.children.indexOf(f);while(l--){i=r.children[l];if(c.unwrap(i.element).parentNode){break}}if(l>-1){c.after(i.element,f.element)}else{c.after(r.element,f.element)}});if(this._end!=null){var p=this.children[this.children.length-1].context.get(this._itemKey);if(k.indexOf(p)>=this._end){this.remove(p)}}return true},remove:function(g){var h=this.context.get(this._collectionKey);if(h.contains(g)){throw new Error("Cannot remove subview from view collection "+this.name+" because the underlying collection still contains the given item")}var j;for(var f=0;f<this.children.length;f++){if(this.children[f].context.get(this._itemKey)==g){j=this.children.splice(f,1)[0];break}}if(!j){return false}this.context.destroyChild(j.context);this._removeElement(j.element,function(){var i=c.unwrap(j.element);if(i.parentNode){i.parentNode.removeChild(i)}});j.unload();return true},_addElement:function(g,f){f()},_removeElement:function(g,f){f()},unload:function(){for(var f=0;f<this.children.length;f++){this.children[f].unload()}this.unsubscribe();this._exportedContext=null;return this},_unloadSubviews:function(){for(var f=0;f<this.children.length;f++){this.children[f].unload();this.context.destroyChild(this.children[f].context)}this._subviews={};this._subviews[this.name]=this.children=[];return this}})}(ox,ox.util,ox.domutil));(function(c,a,d){var f="data-ox-name";var e="data-ox-id";c.Object.extend("ox.ViewCollectionItem",c.mixin.ContextEventSubscriber,{constructor:function b(g){if(this.constructor==c.ViewCollectionItem){throw new Error("Cannot initialize instance of abstract type "+this.name)}if(g.getExportedContext==null||g.context==null){throw new Error("No context or no exporter!")}this.cid=a.uniqueId("viewCollectionItem");this.element=g.element;this.context=g.context;this._collection=g.collection;this._getExportedContext=g.getExportedContext;this._item=g.item;this._subviews={};this._subviewOptions=g.subviewOptions||{};this._activeBindings={};this._subviewBindings={};if(g.element){this.element=d.wrap(g.element);this._initialize()}else{this.render()}c.log("%cCreated view collection item","color:#B3974D",d.unwrap(this.element))},render:function(){this._unloadSubviews();if(this.element){d.unwrap(this.element).oxView=null;d.off(this.element);c.log("%cRendering %c"+this.name,"font-weight:600","font-weight:600;color:#A38531")}var j=this.template();if(j){j="<br/>"+j}var g=document.createElement("div");var k=0;var l;d.html(d.wrap(g),j);for(var h=0;h<g.childNodes.length;h++){if(g.childNodes[h].nodeType==1){k++}if(k==2){l=d.wrap(g.childNodes[h]);break}}if(this.element&&l){d.replace(this.element,l)}this.element=l;if(!d.unwrap(this.element)){throw new c.ViewCollectionItem.MissingElementError()}this._initialize();return this},_initialize:function(){var g=d.unwrap(this.element);g.setAttribute(f,this.name);if(this._collection instanceof c.GenericCollection){g.setAttribute(e,this._item.id!=null?this._item.id:this._item.cid)}g.oxView=this;this._subviews=this._buildSubviews(g.childNodes);return this},_computeSubviewBindings:c.View.prototype._computeSubviewBindings,_getBindings:c.View.prototype._getBindings,_buildSubviews:c.View.prototype._buildSubviews,_buildSubviewsInner:c.View.prototype._buildSubviewsInner,getSubview:c.View.prototype.getSubview,getSubviews:c.View.prototype.getSubviews,addContextEvent:c.View.prototype.addContextEvent,removeContextEvent:c.View.prototype.removeContextEvent,unload:c.View.prototype.unload,_unloadSubviews:c.View.prototype._unloadSubviews});c.Object.extend.call(Error,"ox.ViewCollectionItem.MissingElementError",{constructor:function(){this.message="ox.ViewCollectionItem requires an element"}})}(ox,ox.util,ox.domutil));(function(b,a){b.View.extend("ox.App",{Context:null,constructor:function c(e){var g;if(b.config.debug){g=Date.now()}var d=this.Context||b.Context;this.context=new d(e.context);b.log("%cApp context","font-weight:600",this.context);b.View.call(this,{name:null,context:this.context,element:e.element,subviewOptions:{autoRender:true}});b.log("%cApp views","font-weight:600",this._subviews);if(g){var f=Date.now()-g;b.log("%cApp timing %c"+f+" ms"+(f<200?"":" (slow)"),"font-weight:600;","font-weight:600;color:"+((f<200)?"#00b200":"#c00"))}},render:function(){for(var e in this._subviews){if(this._subviews.hasOwnProperty(e)){for(var d=0;d<this._subviews[e].length;d++){this._subviews[e][d].render()}}}return this}})}(ox,ox.util));/*
 * THIS FILE WAS GENERATED IN AN EXTERNAL REPOSITORY. DO NOT MODIFY.
 */
(function(a,b){a.View.prototype.template=function(){var c=this.context["export"]();return a.dust(this.name,c)};a.ViewCollectionItem.prototype.template=function(){var c=this._getExportedContext(this.context);c.$idx=this._collection.indexOf(this._item);c.$idx1=c.$idx+1;return a.dust(this.name,c)};a.dust=function(d,e){var c;b.render(d,e,function(g,f){if(g){throw g}c=f});return c||""}}(ox,dust));(function(b,c){var g=/modules\.[a-z][a-z0-9]*\.[A-Z][0-9a-zA-Z]*$/;var e=/modules\.[a-z][a-z0-9]*\.entity\.[A-Z][0-9a-zA-Z]*$/;var a=/modules\.[a-z][a-z0-9]*\.collection\.[A-Z][0-9a-zA-Z]*$/;var f=/modules\.[a-z][a-z0-9]*\.model\.[A-Z][0-9a-zA-Z]*$/;var d=/[mM]odel$/;b.config({typeKey:"$t",idKey:"$i",error:function(i,j,h){if(c){console.dir(arguments);throw i}ta.util.error.record(i,j,null,h)},validateTypeName:function(h,i){if(b.View.isTypeOf(h)){if(!g.test(i)){throw new Error("TA naming error - View name "+i+" should match "+g)}}else{if(b.Entity.isTypeOf(h)){if(!e.test(i)){throw new Error("TA naming error - Entity name "+i+" should match "+e)}if(d.test(i)){throw new Error("TA naming error - Entity name '"+i+" should not be suffixed with 'Model'")}}else{if(b.AbstractCollection.isTypeOf(h)){if(!a.test(i)){throw new Error("TA naming error - Collection name "+i+" should match "+a)}if(d.test(i)){throw new Error("TA naming error - Collection name "+i+" should not be suffixed with 'Model'")}}else{if(b.Model.isTypeOf(h)){if(!f.test(i)){throw new Error("TA naming error - Model name "+i+" should match "+f)}}}}}}})}(ox,typeof IS_DEBUG!="undefined"?IS_DEBUG:false));(function(b,c,a){c.wrap=function(d){return a.id(d)};c.unwrap=function(d){return d};c.html=function(d,e){d.set("html",e)};c.is=function(e,d){return e.match(d)};c.on=function(d,e){if(typeof arguments[2]=="function"){if(c.unwrap(d)==window&&e!="scroll"&&(Browser.ie6||Browser.ie7||Browser.ie8)){$(a).addEvent(e,arguments[2])}else{d.addEvent(e,arguments[2])}}else{d.addEvent(e+":relay("+arguments[2]+")",arguments[3])}};c.off=function(e,f){if(f){if(typeof arguments[2]=="function"){var g=arguments[2];e.removeEvent(f,g)}else{var d=arguments[2];e.removeEvent(f+(d?":relay("+d+")":""))}}else{e.removeEvents()}};c.find=function(e,d){return e.getElements(d)};c.after=function(e,d){Element.prototype.grab.call(e,d,"after")};c.replace=function(d,e){e.replaces(d)};c.transition.fadeIn=function(e,d){e.setStyle("opacity",0);d();e.set("tween",{duration:c.transition.FADE_DURATION,property:"opacity"}).tween(1)};c.transition.fadeOut=function(e,d){e.set("tween",{duration:c.transition.FADE_DURATION,property:"opacity",onComplete:d}).tween(0)}}(ox,ox.domutil,document));ta.servlet||(ta.servlet={});(function(f,a){var b="clientaction";var l=20;var o=1000;var e=/^SUCCESS/;var m=/^PENDING/;var j=/^FAILURE\.(?:[A-Z0-9_]+\.)*READ_ONLY(?:\.[A-Z0-9_]+)*$/;var h=(function(){var p=0;return function(){return b+p++}}());var i=function(r,s,t){for(var q=0,p=r.length;q<p;q++){if(q in r){s.call(t,r[q],q,r)}}};var n=function(q){for(var p in q){if(q.hasOwnProperty(p)){if(q[p]===+q[p]){q[p]=+q[p].toPrecision(15)}}}};function g(q){this.context=q.context;this.actions=[];this.modules=[];this.authenticator=q.authenticator||"";this.version=q.version||0;this.url=q.url||"/";this.data={};this.defaults=q.defaults||{};this.token=q.token||"";var p=q.modules||[];var s=q.actions||[];var r;for(r=0;r<p.length;r++){this.register(p[r])}if(typeof JSON!="undefined"&&JSON.parse&&JSON.stringify){this.pageLoadActions=JSON.parse(JSON.stringify(s))}for(r=0;r<s.length;r++){this._processAction(s[r],{},null)}setTimeout(function(){this.commit()}.bind(this),o)}g.timing=false;g.prototype.register=function(p){this.modules.push(p);return this};g.prototype.fetch=function(p,t,r,s){n(t);var q=new d({name:"FETCH",resource:p,force:r===true,params:t||{}});a.log("%cFetching %c"+p,"font-weight:600;","font-weight:600;color:#00b200",t);this.enqueue(q,s!==false);return q.deferred.promise().success(function(w,u){var v=a.util.resolvePath(w.resource).store[w.data];if(!v){return new f.util.Deferred().reject()}return f.util.Deferred().resolve(v)})};g.prototype.save=function(p,u,t){n(u);var r=new d({name:"SAVE",resource:p,params:u||{}});a.log("%cSaving %c"+p,"font-weight:600;","font-weight:600;color:#00b200",u);var q=this.enqueue(r,t!==false);var s=r.deferred.promise().success(function(y,w){var v=a.util.resolvePath(y.resource);var x=v.store[y.data];if(!x){return new f.util.Deferred().reject()}return new f.util.Deferred().resolve(x)});if(q){if(s.cancel){a.error("Overwriting existing promise.cancel method!")}s.cancel=q.cancel}return s};g.prototype.fire=function(p,r){a.log("%cFiring %c"+p,"font-weight:600;","font-weight:600;color:#00b200",r);var q=new d({name:p,params:r});this.enqueue(q);return q.deferred.promise()};g.prototype.enqueue=function(p,q){this.actions.push(p);if(q!==false){return this.commit()}};g.prototype.request=function(p,q){this.data=f.util.merge(this.data,p);if(q!==false){return this.commit()}return this};g.prototype.commit=function(){if(!this.actions.length){return}var t=this.actions;this.actions=[];var q={};i(t,function(v){q[v.properties.id]=v});var u;var r;if(g.timing||a.config.debug){u=Date.now()}var p=false;var s=f.util.ajax({method:"POST",url:this.url,data:f.util.merge({},this.defaults,this.data,{actions:JSON.stringify(t.map(function(v){return v.properties})),context:JSON.stringify(this.context.getParams()),authenticator:this.authenticator,version:this.version,token:this.token})}).always(function(v){if(g.timing||a.config.debug){r=Date.now();var w=r-u;console.log("%cNetwork timing %c"+w+" ms"+(w<200?"":" (slow)"),"font-weight:600;","font-weight:600;color:"+((w<200)?"#00b200":"#c00"))}if(/^3/.test(v.code)){window.location=v.location}this.data={}},this).success(function(x){if(!x||!x.version){c();if(f.util.error){var y={name:"Null ModuleAjax response",message:"Null or invalid response from the server"};var w="ModuleAjax response";var A={response:x};var v="WARN";f.util.error.record(y,w,null,A,v)}return new f.util.Deferred().reject(x)}if(!k(this.version,x)){return new f.util.Deferred().reject(x)}if(p){if(typeof p==="function"){p(x)}return}a.store(x.store,(a.config.blockStoreEvents?this.context:null));this.context.set(x.context);a.invalidate(x.invalidate);if(g.timing||a.config.debug){var z=Date.now()-r;console.log("%cOx timing %c"+z+" ms"+(z<200?"":"(slow)"),"font-weight:600;","font-weight:600;color:"+((z<200)?"#00b200":"#c00"))}i(x.actions,function(B){this._processAction(B,q,x)},this);if(this.actions.length){setTimeout(function(){this.commit()}.bind(this),o)}},this);s.cancel=function(v){p=v||true};return s};g.prototype._processAction=function(r,p,q){var s=p[r.id];if(s){if(m.test(r.status)&&s.attempts<l){this.enqueue(new d(s),false);return}if(e.test(r.status)){if(r.pipe){r.pipe.id=r.id;this._processAction(r.pipe,p,q)}else{s.deferred.resolve(r,q)}return}if(j.test(r.status)){c(modules.message.UNDER_MAINTENANCE,{showCloseButton:true,attachCloseEvent:true})}s.deferred.reject(r,q);return}if(m.test(r.status)){this.enqueue(new d(r),false)}};function d(){if(arguments[0] instanceof d){var p=arguments[0];p.attempts++;return p}this.properties=f.util.merge({params:{}},arguments[0],{id:h()});delete this.properties.status;delete this.properties.data;this.deferred=new f.util.Deferred();this.attempts=1}function k(u,s){var q=s&&s.version;if(u==q){return true}if(f.util.error){var t={name:"Mismatched modules API version",message:"Expected version "+u+" but received "+q};var r="ModuleAjax response";var v={response:s};var p="WARN";f.util.error.record(t,r,null,v,p)}c();return false}function c(r,q){r||(r=modules.message.GENERIC_ERROR);q||(q={});if(!f.overlays&&!f.overlays.CenteredOverlay){return}var p=new f.overlays.CenteredOverlay(f.util.merge({content:r,showCloseButton:false,backdrop:1,fontSize:"1em",autoShow:false,attachCloseEvent:false,yOffset:280,buttonVersion:"alt"},q)).addEvent("onShow",function(s){s.container.setStyles({position:"fixed",font:"14px Helvetica, Arial, sans-serif"});s.backdrop.setStyle("height",$(document.body).getScrollSize().y)});p.show()}f.servlet.ModuleAjax=g}(ta,ox));(function(c,b){var a=c.Entity.extend;var d=c.dust;c.Entity.prototype.fetch=function(h,e){h||(h={});e||(e={});var f=!!e.force;var g=e.commit!==false;return this.moduleAjax.fetch(this.name,h,f,g)};c.Entity.prototype.save=function(){var e;var f=true;if(b.typeOf(arguments[0])=="object"){e=arguments[0];f=arguments[1]!==false}else{e=this["export"]()}return this.moduleAjax.save(this.name,e,f)};c.Entity.prototype.destroy=function(){throw new Error("Method 'destroy' will be implemented in a forthcoming patch")};c.Entity.fetch=function(h,e){h||(h={});e||(e={});var f=!!e.force;var g=e.commit!==false;return this.prototype.moduleAjax.fetch(this.prototype.name,h,f,g)};c.Entity.save=function(e){return this.prototype.moduleAjax.save(this.prototype.name,e)};c.Entity.prototype.commit=function(){return this.prototype.moduleAjax.commit()};c.Entity.commit=function(){return this.prototype.moduleAjax.commit()};c.Entity.destroy=function(){throw new Error("Method 'destroy' will be implemented in a forthcoming patch")};c.Entity.extend=function(){var e=a.apply(this,arguments);e.fetch=this.fetch;e.save=this.save;e.commit=this.commit;e.destroy=this.destroy;return e};c.Model.prototype.fetch=function(j,e){var h=this.getParams();c.util.each(j,function(l,k){h[k]=l});e||(e={});var g=!!e.force;var i=e.commit!==false;var f=e.reset!==false;return this.moduleAjax.fetch(this.name,h,g,i).success(function(k){if(k!=this){if(f){this.reset(k)}return new ta.util.Deferred().resolve(k)}},this)};c.Collection.prototype.fetch=function(j,e){var h=this.getParams();c.util.each(j,function(l,k){h[k]=l});e||(e={});var g=!!e.force;var i=e.commit!==false;var f=e.reset!==false;return this.moduleAjax.fetch(this.name,h,g,i).success(function(k){if(k!=this){if(f){this.reset(k)}return new ta.util.Deferred().resolve(k)}},this)};c.dust=function(e,f){e=DUST_GLOBAL.LOCALE+e;f=dust.makeBase(DUST_GLOBAL).rebase(f);return d.call(this,e,f)}}(ox,ox.util));(function(b,a){b.View.prototype.record=function(f,d){var c=typeof ta!="undefined"&&ta.util&&ta.util.action&&ta.util.action.record;if(typeof ta!="undefined"&&(c||ta.trackEventOnPage)){d||(d={});d.module=d.module||this.name;d.action=d.action||f;if(typeof IS_DEBUG!=="undefined"&&IS_DEBUG){var e="ox.View.record: "+document.title+" > "+d.module+" > "+d.action;if(d.context){e+=" > "+d.context}if(d.value){e+=" > #"+d.value}if(d.noninteraction){e+=" (noninteraction)"}console.log(e)}if(c){return ta.util.action.record(d.module+"_"+d.action,null,d)}else{return ta.trackEventOnPage(d.module,d.action,d.context,d.value,d.noninteraction)}}};b.View.prototype.recordLink=function(e,f,c){if(typeof ta!="undefined"&&ta.setEvtCookie){c||(c={});c.module=c.module||this.name;c.action=c.action||f;if(typeof IS_DEBUG!=="undefined"&&IS_DEBUG){var d="ox.View.recordLink: "+document.title+" > "+c.module+" > "+c.action;if(c.context){d+=" > "+c.context}if(c.value){d+=" > #"+c.value}if(c.noninteraction){d+=" (noninteraction)"}console.log(d)}return ta.setEvtCookie(c.module,c.action,c.context,c.value,e)}else{window.location=e}};b.View.prototype.render=(function(c){return function(){c.apply(this,arguments);var d=ta.retrieve("viewTracker");if(typeof d!=="undefined"){d.trackImpressions()}}})(b.View.prototype.render);b.View.prototype.trackImpression=function(){this.record("seen",{module:this.name,noninteraction:true})};b.View.prototype.trackVisibility=function(){return this.element&&this.element.isVisible()&&this.element.getChildren().length>0}}(ox,ox.util));if(typeof JSON!=="object"){JSON={}}(function(){function f(n){return n<10?"0"+n:n}if(typeof Date.prototype.toJSON!=="function"){Date.prototype.toJSON=function(key){return isFinite(this.valueOf())?this.getUTCFullYear()+"-"+f(this.getUTCMonth()+1)+"-"+f(this.getUTCDate())+"T"+f(this.getUTCHours())+":"+f(this.getUTCMinutes())+":"+f(this.getUTCSeconds())+"Z":null};String.prototype.toJSON=Number.prototype.toJSON=Boolean.prototype.toJSON=function(key){return this.valueOf()}}var cx=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,escapable=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,gap,indent,meta={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},rep;function quote(string){escapable.lastIndex=0;return escapable.test(string)?'"'+string.replace(escapable,function(a){var c=meta[a];return typeof c==="string"?c:"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+string+'"'}function str(key,holder){var i,k,v,length,mind=gap,partial,value=holder[key];if(value&&typeof value==="object"&&typeof value.toJSON==="function"){value=value.toJSON(key)}if(typeof rep==="function"){value=rep.call(holder,key,value)}switch(typeof value){case"string":return quote(value);case"number":return isFinite(value)?String(value):"null";case"boolean":case"null":return String(value);case"object":if(!value){return"null"}gap+=indent;partial=[];if(Object.prototype.toString.apply(value)==="[object Array]"){length=value.length;for(i=0;i<length;i+=1){partial[i]=str(i,value)||"null"}v=partial.length===0?"[]":gap?"[\n"+gap+partial.join(",\n"+gap)+"\n"+mind+"]":"["+partial.join(",")+"]";gap=mind;return v}if(rep&&typeof rep==="object"){length=rep.length;for(i=0;i<length;i+=1){if(typeof rep[i]==="string"){k=rep[i];v=str(k,value);if(v){partial.push(quote(k)+(gap?": ":":")+v)}}}}else{for(k in value){if(Object.prototype.hasOwnProperty.call(value,k)){v=str(k,value);if(v){partial.push(quote(k)+(gap?": ":":")+v)}}}}v=partial.length===0?"{}":gap?"{\n"+gap+partial.join(",\n"+gap)+"\n"+mind+"}":"{"+partial.join(",")+"}";gap=mind;return v}}if(typeof JSON.stringify!=="function"){JSON.stringify=function(value,replacer,space){var i;gap="";indent="";if(typeof space==="number"){for(i=0;i<space;i+=1){indent+=" "}}else{if(typeof space==="string"){indent=space}}rep=replacer;if(replacer&&typeof replacer!=="function"&&(typeof replacer!=="object"||typeof replacer.length!=="number")){throw new Error("JSON.stringify")}return str("",{"":value})}}if(typeof JSON.parse!=="function"){JSON.parse=function(text,reviver){var j;function walk(holder,key){var k,v,value=holder[key];if(value&&typeof value==="object"){for(k in value){if(Object.prototype.hasOwnProperty.call(value,k)){v=walk(value,k);if(v!==undefined){value[k]=v}else{delete value[k]}}}}return reviver.call(holder,key,value)}text=String(text);cx.lastIndex=0;if(cx.test(text)){text=text.replace(cx,function(a){return"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)})}if(/^[\],:{}\s]*$/.test(text.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,""))){j=eval("("+text+")");return typeof reviver==="function"?walk({"":j},""):j}throw new SyntaxError("JSON.parse")}}}());(function(a){a.util||(a.util={});a.util.createMoveMap=function(d,f){var c={};for(var b=0;b<d.length;b++){if(d[b]===undefined){continue}var e=f.indexOf(d[b]);if(e==-1){continue}c[b]=e}return c};a.util.renderLater=(function(){var b={};return function(){if(b[this.name]===undefined){b[this.name]=ta.util.debounce(this.render.bind(this),0)}b[this.name]()}})();a.util.render=function(){this.render.call(this)}})(ox);ta.travelmap||(ta.travelmap={});ta.travelmap.component||(ta.travelmap.component={});ta.travelmap.component.Counter=new Class({minDigits:2,initialize:function(d,g){var b=this.digits=g.toString().split("");var k;var e;var c;if(!d){ta.util.error.record(null,"Counter initialize passed invalid element, skipping.");return}this.el=d;this.queue=[];this.count=g;this.height=this.el.getSize().y-this.el.getStyle("border-top-width").toInt()-this.el.getStyle("border-bottom-width").toInt();k=this.minDigits-b.length;if(k>0){while(k--){b.unshift(0)}}var f=this.el.getElements(".digit").length;var l=b.length;var j=f>l;k=Math.abs(f-l);while(k--){j?this.shift():this.unshift(b[k])}c=this.el.getElements(".digit");for(e=0;e<c.length;e++){var a=c[e];if(!a.getParent("digit-strip")){var h=new Element("div",{"class":"digit-strip",styles:{display:"inline-block","vertical-align":"top",width:a.getSize().x}});h.set("html",'<div class="digit prev"></div><div class="digit current"></div><div class="digit next"></div>');h.replaces(a)}}c=this.el.getElements(".digit-strip");for(e=0;e<c.length;e++){this.render(c[e],b[e])}},update:function(e){var c=this;var a=this.height;var g=this.digits;var f=+g.join("");var h=Math.abs(e-f);var d=e-f>0?1:-1;if(!h||e<0){this.dequeue();return}(function b(n){var r=[];var o=ta.util.Deferred();var l=2*Math.pow(Math.E/1.5,-1*n)*1000;for(var m=g.length;m--;){var q=ta.util.Deferred();var k=false;r.push(q);g[m]=(+g[m]+10+d)%10;if(!g[m]&&!m){if(d==1){g.unshift(0);c.unshift(0);m++}else{if(d==-1&&g.length>c.minDigits){g.shift();k=true}}}var j=c.el.getElements(".digit-strip");if(j[m]){var p=new Fx.Tween(j[m],{duration:l,property:"margin-top",onComplete:(function(t,s,i){return function(v){if(s){c.shift()}c.render(v,t);i.resolve();for(var u=0;u<r.length;u++){if(r[u].promise().status()=="pending"){return}}o.resolve()}}(g[m],k,q))});p.start((d+1)*-1*a)}if(!m||d==1&&g[m]!=0||d==-1&&g[m]!=9){break}}o.promise().success(function(){--n?b(n):c.dequeue()})}(h))},enqueue:function(a){this.queue.unshift(a);if(this.queue.length==1){this.update(a)}this.count=a},dequeue:function(){this.queue.pop();if(this.queue.length){this.update(this.queue[this.queue.length-1])}},render:function(b,d){b=$(b);d=+d;var c=b.getElement(".prev");if(c){c.set("html",(d+9)%10)}var e=b.getElement(".current");if(e){e.set("html",d)}var a=b.getElement(".next");if(a){a.set("html",(d+1)%10)}b.setStyle("margin-top",-1*this.height)},shift:function(){this.el.getChildren()[0].dispose()},unshift:function(a){var c=this.el.getChildren()[0].clone();var b=c.match(".digit-strip")?c:c.getElement(".digit-strip");this.render(b,a);this.el.grab(c,"top")}});window.ta||(window.ta={});(function(a){a.util||(a.util={});a.util.debounce=function(b,d){var c;return function(){var f=this;var e=arguments;var g=function(){c=null;b.apply(f,e)};clearTimeout(c);c=setTimeout(g,d)}}}(ta));ta.common.sendmessage={getMessageCode:function(){var e=new Date().getTime();var b="ABCDEFGHIJKLMNOPQRSTUVWXYZ123456";var f=[];for(var a=0;a<32;a++){f[a]=((e&(1<<a))!=0)?1:0}var c=[[],[],[],[],[],[]];for(var a=0;a<30;a++){c[a%(c.length)].push(f[f.length-1-a])}var d="";for(var a=0;a<c.length;a++){d+=b.substr(parseInt(c[a].reverse().join(""),2),1)}return d},communityLightbox:function(e,d){if(!communityEnabled){window.callback_communityLightboxEnable=function(){communityEnabled=true;var g=ta.retrieve("overlays.sendmessage");if(g){g.hide()}ta.common.sendmessage.communityLightbox(e,d)};var a=new StringBuffer();a.append('<p id="inviteStatusField" style="display: none; color: red;"></p>');a.append("<p>"+JS_mem_travelnet_friends_disabledM2M+".</p>");a.append('<p><a href="javascript:void(0)" onclick="ta.common.sendmessage.enableCommunity(window[\'callback_communityLightboxEnable\'], true); return false;">'+JS_common_Clickhere+"</a> "+JS_mem_travelnet_friends_turnOn+".</p>");var f=ta.overlays.showInLightbox(a.toString(),{backdrop:ta.overlays.BACKDROP_NEVER,onHide:ta.common.sendmessage.cancel.bind(this),noScroll:$("vrWideOverview")});f.container.setStyle("z-index","9997");if($("vrWideOverview")&&ta.has("vrShowCaptcha")){f.closeBtn.addEvent("click",function(){ta.vr.showRecaptcha()})}ta.store("overlays.sendmessage",f);return}if(d){var b=function(g){var h=ta.overlays.showInLightbox(g,{backdrop:ta.overlays.BACKDROP_NEVER,permanent:true,onHide:ta.common.sendmessage.cancel.bind(this),noScroll:$("vrWideOverview")});h.container.setStyle("z-index","9997");if($("vrWideOverview")&&ta.has("vrShowCaptcha")){h.closeBtn.addEvent("click",function(){ta.vr.showRecaptcha()})}ta.store("overlays.sendmessage",h);var i=window[d];if(i&&typeOf(i)=="function"){i()}}}else{var b=function(g){var h=ta.overlays.showInLightbox(g,{backdrop:ta.overlays.BACKDROP_NEVER,permanent:true,onHide:ta.common.sendmessage.cancel.bind(this),noScroll:$("vrWideOverview")});h.container.setStyle("z-index","9998");if($("vrWideOverview")&&ta.has("vrShowCaptcha")){h.closeBtn.addEvent("click",function(){ta.vr.showRecaptcha()})}ta.store("overlays.sendmessage",h)}}var c={url:e,onSuccess:b,evalScripts:true,onFailure:ta.util.error.ajaxFailure.partial("SendMessage:communityLightbox")};new Request(c).send()},enableCommunity:function(c,a){var b=c;if(!a){b=function(d){ta.common.sendmessage.enableCommunityResponse(d,c)}}if(typeof(JS_SECURITY_TOKEN)=="undefined"){JS_SECURITY_TOKEN=""}new Request({url:"/MemberSubscriptionsController",data:{Action:"ChangeM2M",set:"on",token:JS_SECURITY_TOKEN},onSuccess:b,onFailure:ta.util.error.ajaxFailure.partial("SendMessage:enableCommunity")}).send()},enableCommunityResponse:function(res,callback){if(txt.match(/^{/)){var data=eval("("+txt+")");if(data.ERROR){document.getElementById("inviteStatusField").innerHTML=data.ERROR;document.getElementById("inviteStatusField").style.display="block"}}else{document.getElementById("inviteStatusField").innerHTML=JS_community_on;document.getElementById("inviteStatusField").style.display="block"}},submitSendMessage:function(h,b){h.stop();b.onclick=null;var a=b.className.match(/LSO_(\w+)/)[1];$("LsoId").value=footprintGetWithSet(a);$("screenWidth").value=screen.width;$("screenHeight").value=screen.height;if(!b.className.match(/\bform_(\w+)\b/)){return}var e=$(RegExp.$1);var d={url:b.href,data:e,evalScripts:true,onFailure:ta.util.error.ajaxFailure.partial("SendMessage:submitSendMessage")};var g=window["callback_"+e.name];if(b.className.match(/method_(\w+)\b/)){d.method=RegExp["$1"]}if(b.className.match(/\btgt_(\w+)\b/)){d.update=RegExp["$1"]}else{d.onComplete=function(k,i){if(ta.retrieve("messaging.isiframe")&&ta.id("PAGE")){ta.id("PAGE").set("html",k);if(ta.id("SUCCESS")){window.top.location.href="/Messages?f=512&o=0&cnt=25&j=-3&oo=0&oj=-3"}}else{var j=ta.overlays.showInLightbox(k,{backdrop:ta.overlays.BACKDROP_NEVER,permanent:true,onHide:ta.common.sendmessage.cancel.bind(this),noScroll:$("vrWideOverview")});ta.store("overlays.sendmessage",j)}if(g&&typeOf(g)=="function"){g()}}}var c=window["validate"+e.id];if(c&&typeOf(c)=="function"&&c.apply(e)==false){return}if(b.className.match(/\bevalScripts\b/)){d.evalScripts=true}var f=ta.retrieve("overlays.sendmessage");if(f&&f.options&&f.options.permanent){f.options.permanent=false}new Request(d).send()},cancel:function(a){if(a){return}var b=ta.retrieve("overlays.sendmessage");if(b){ta.remove("overlays.sendmessage")}if(ta.has("community.needsReload")){window.location.reload()}},closeSendMessage:function(c,a){if(c&&c.stop){c.stop()}if(a){a.onclick=null}var b=ta.retrieve("overlays.sendmessage");if(b){b.hide(c)}if($("vrWideOverview")&&ta.has("vrShowCaptcha")){ta.vr.showRecaptcha()}}};var SUB_OVERLAY=null;(function(){ta.servlet.MemberProfile={fbAccepted:false,signOut:function(event,elt){var soLnk=$("SIGNOUT_LINK");if(soLnk.onclick){soLnk.onclick()}else{window.location=soLnk.href}},getAddBox:function(event,elt){if(elt.hasClass("active")){return}elt.removeProperty("checked");new Event(event).stop();var nlType=elt.className.match(/type_(\w+)/);if(nlType&&(nlType[1].match(/farewatch/))){showDHTMLPopup("AirWatchAlertDhtmlPopup","/AirWatchAlertDhtmlPopup?pid=1768&nl="+nlType[1]+"&fromServlet=MemberProfile",true)}else{ta.store("member.sub.type",nlType);var isRentalWatch=nlType[1].match(/rw/)?true:false;new Request({url:"/MemberSubscriptionsController",data:{Action:"GetAddDest",token:JS_SECURITY_TOKEN,isRentalWatch:isRentalWatch},onFailure:ta.util.error.ajaxFailure.partial("MemberProfile:getAddBox"),onSuccess:function(txt,xml){if(ta.servlet.MemberProfile.checkForErrors(txt,true)){return}SUB_OVERLAY=ta.overlays.showInLightbox(txt);$("NL_TYPE").value=nlType[1];if(isRentalWatch){$("RENTAL_WATCH").show()}}}).send()}},addTWDest:function(event,elt){var nlType=$("NL_TYPE").value;var beds=0;var inDay=null;var inMonth=null;var outDay=null;var outMonth=null;if(nlType.match(/rw/)){beds=$("addTW_beds").selectedIndex+1;inDay=$("addTW_inDay").value;inMonth=$("addTW_inMonth").value;outDay=$("addTW_outDay").value;outMonth=$("addTW_outMonth").value}new Request({url:"/MemberSubscriptionsController",data:{Action:"AddTWLoc",nl:nlType,geo:$("ADD_TW_DEST_ID").value,beds:beds,inDay:inDay,inMonth:inMonth,outDay:outDay,outMonth:outMonth,token:JS_SECURITY_TOKEN},keepScripts:true,onFailure:ta.util.error.ajaxFailure.partial("MemberProfile:addTWDest"),onSuccess:function(txt,xml){var errorMsg=ta.servlet.MemberProfile.checkForErrors(txt,false);if(errorMsg){if($("ADD_TW_ERROR")){$("ADD_TW_ERROR").set("html",errorMsg)}else{new Element("div",{"class":"error",id:"ADD_TW_ERROR"}).set("html",errorMsg).inject($("ADD_TW_BOX"))}return}$("CONTAINER_"+nlType).set("html",txt);ta.servlet.MemberProfile.switchRadioStates($("SUB_"+nlType),$("UNSUB_"+nlType));SUB_OVERLAY.hide();ta.servlet.MemberProfile.showSaved()}}).send()},removeTWDest:function(event,elt){var gid=elt.className.match(/g(\d+)/);var nlType=elt.className.match(/type_(\w+)/);if(gid&&gid[1]){new Request({url:"/MemberSubscriptionsController",data:{Action:"RemoveTWLoc",nl:nlType[1],geo:gid[1],token:JS_SECURITY_TOKEN},evalScripts:true,onFailure:ta.util.error.ajaxFailure.partial("MemberProfile:removeTWDest"),onSuccess:function(txt,xml){if(ta.servlet.MemberProfile.checkForErrors(txt,true)){return}if(txt.match(/id="TRIPWATCH"/)){$("SUB_SECTION").set("html",txt)}else{$("CONTAINER_"+nlType[1]).set("html",txt);if(typeof UNSUB_BY_REMOVE!="undefined"&&UNSUB_BY_REMOVE){ta.servlet.MemberProfile.switchRadioStates($("UNSUB_"+nlType[1]),$("SUB_"+nlType[1]))}}ta.servlet.MemberProfile.showSaved()}}).send()}},changeTNNotif:function(event,elt){var level=elt.checked?2:4;new Request({url:"/MemberSubscriptionsController?Action=ChangeTNNotif&cat="+elt.value+"&set="+level,onFailure:ta.util.error.ajaxFailure.partial("MemberProfile:changeTNNotif"),onSuccess:function(txt,xml){if(ta.servlet.MemberProfile.checkForErrors(txt,true)){return}ta.servlet.MemberProfile.showSaved()}}).send()},changeSub:function(event,elt){if(elt.hasClass("active")){return}elt.removeProperty("checked");event.stop();var nlType=elt.className.match(/type_(\w+)/)[1];var action=elt.className.match(/action_(\w+)/)[1];var radioSub=$("SUB_"+nlType);var radioUnsub=$("UNSUB_"+nlType);new Request({url:"/MemberSubscriptionsController",data:{Action:action,nl:nlType,token:JS_SECURITY_TOKEN},onFailure:ta.util.error.ajaxFailure.partial("MemberProfile:changeSub"),onSuccess:function(txt,xml){if(ta.servlet.MemberProfile.checkForErrors(txt,true)){return}if(action=="GetUnsub"){SUB_OVERLAY=ta.overlays.showInLightbox(txt);$("NL_TYPE").value=nlType;$("UNSUB_LINK").addClass("type_"+nlType)}else{if(action=="Subscribe"){ta.servlet.MemberProfile.switchRadioStates(radioSub,radioUnsub);ta.servlet.MemberProfile.showSaved()}else{if(action=="Unsubscribe"){if(txt.match(/id="TRIPWATCH"/)){$("SUB_SECTION").set("html",txt)}else{if(nlType=="original"||nlType.match(/tw_/)||nlType.match(/rw_/)||nlType.match(/farewatch/)){if(SUB_OVERLAY){SUB_OVERLAY.hide()}$("CONTAINER_"+nlType).set("html",txt)}ta.servlet.MemberProfile.switchRadioStates(radioUnsub,radioSub)}ta.servlet.MemberProfile.showSaved()}}}}}).send()},removeAWRoute:function(event,elt){var nlType=elt.className.match(/type_(\w+)/);var pairId=elt.className.match(/pair_(\d+)/);if(pairId&&pairId[1]){new Request({url:"/MemberSubscriptionsController",data:{Action:"RemoveAWRoute",id:pairId[1],nl:nlType[1],token:JS_SECURITY_TOKEN},onFailure:ta.util.error.ajaxFailure.partial("MemberProfile:removeAWRoute"),evalScripts:true,onSuccess:function(txt,xml){if(ta.servlet.MemberProfile.checkForErrors(txt,true)){return}$("CONTAINER_"+nlType[1]).set("html",txt);if(typeof UNSUB_BY_REMOVE!="undefined"&&UNSUB_BY_REMOVE){ta.servlet.MemberProfile.switchRadioStates($("UNSUB_"+nlType[1]),$("SUB_"+nlType[1]))}ta.servlet.MemberProfile.showSaved()}}).send()}},changeNLFormat:function(event,elt){if(elt.hasClass("active")){return}elt.removeProperty("checked");event.stop();var nlf=elt.className.match(/nlf_(\w+)/);if(nlf==null){return}else{nlf=nlf[1]}var radioHtml=$("fmtHTML");var radioText=$("fmtText");new Request({url:"/MemberSubscriptionsController",data:{Action:"ChangeNLFormat",letterformat:nlf,token:JS_SECURITY_TOKEN},onFailure:ta.util.error.ajaxFailure.partial("MemberProfile:changeNLFormat"),onSuccess:function(txt,xml){if(ta.servlet.MemberProfile.checkForErrors(txt,true)){return}if(nlf=="html"){ta.servlet.MemberProfile.switchRadioStates(radioHtml,radioText)}else{if(nlf=="text"){ta.servlet.MemberProfile.switchRadioStates(radioText,radioHtml)}}ta.servlet.MemberProfile.showSaved()}}).send()},changeM2M:function(event,elt){if(elt.hasClass("active")){return}elt.removeProperty("checked");event.stop();var setting=elt.className.match(/setting_(\w+)/);if(setting==null){return}else{setting=setting[1]}var radioOn=$("ON_m2m");var radioOff=$("OFF_m2m");new Request({url:"/MemberSubscriptionsController",data:{Action:"ChangeM2M",set:setting,token:JS_SECURITY_TOKEN},onFailure:ta.util.error.ajaxFailure.partial("MemberProfile:changeM2M"),onSuccess:function(txt,xml){if(ta.servlet.MemberProfile.checkForErrors(txt,true)){return}var m2mFreqOpts=$("m2mFreqOpts");if(setting=="on"){ta.servlet.MemberProfile.switchRadioStates(radioOn,radioOff);$$("input.type_pm").each(function(i){i.removeProperty("disabled")});if(m2mFreqOpts){m2mFreqOpts.className="m2mEnabled"}}else{if(setting=="off"){ta.servlet.MemberProfile.switchRadioStates(radioOff,radioOn);$$("input.type_pm").each(function(i){i.setProperty("disabled",true)});if(m2mFreqOpts){m2mFreqOpts.className="m2mDisabled"}if(pageServlet=="MemberProfile"){window.location.href=window.location.href}}}if(pageServlet!="MemberProfile"){ta.servlet.MemberProfile.showSaved()}}}).send()},changeUpdateRate:function(event,elt){if(elt.hasClass("active")){return}elt.removeProperty("checked");event.stop();var type=elt.className.match(/type_(\w+)/);var rate=elt.className.match(/rate_(-{0,1}\d)/);if(type==null||rate==null){return}else{type=type[1];rate=rate[1]}var radioNew=(elt.get("tag")=="input")?elt:elt.getElements("input")[0];if(radioNew.disabled){return}var radioCurrent;$$("input.type_"+type).each(function(i){if(i.hasClass("active")){radioCurrent=i}});var dataObj;if(type=="pm"){dataObj={Action:"ChangePMNotif",nfrequency:rate,token:JS_SECURITY_TOKEN}}else{if(type=="fun"){dataObj={Action:"ChangeTNNotif",cat:101,set:rate,token:JS_SECURITY_TOKEN}}}new Request({url:"/MemberSubscriptionsController",data:dataObj,onFailure:ta.util.error.ajaxFailure.partial("MemberProfile:changeUpdateRate"),onSuccess:function(txt,xml){if(ta.servlet.MemberProfile.checkForErrors(txt,true)){return}ta.servlet.MemberProfile.switchRadioStates(radioNew,radioCurrent);ta.servlet.MemberProfile.showSaved()}}).send()},switchRadioStates:function(radioToBeActive,radioToBeInactive){radioToBeActive.setProperty("checked","checked");radioToBeActive.addClass("active");radioToBeInactive.removeClass("active");radioToBeInactive.removeProperty("checked");var lblTBA=(radioToBeActive.getParent().get("tag")=="label")?radioToBeActive.getParent():false;var lblTBI=(radioToBeInactive.getParent().get("tag")=="label")?radioToBeInactive.getParent():false;if(lblTBA&&lblTBI){lblTBA.addClass("active");lblTBI.removeClass("active")}},emailAutoLoginOptChange:function(event,elt){if(!elt||elt.hasClass("active")){return}elt.addClass("active");var optedOut=!elt.checked;new Request({url:"/MemberSubscriptionsController",data:{Action:"ChangeEmailAutoLogin",optOut:optedOut,token:JS_SECURITY_TOKEN},onFailure:function(txt,xml){elt.removeClass("active");ta.util.error.ajaxFailure.partial("MemberProfile:emailAutoLoginOptChange")},onSuccess:function(txt,xml){elt.removeClass("active");elt.set("value",optedOut);ta.servlet.MemberProfile.showSaved()}}).send()},showSaved:function(){ta.servlet.MemberProfile.closeSaved();window.mpSavedOL=new ta.overlays.CenteredOverlay({backdrop:ta.overlays.BACKDROP_NEVER,style:"mpSaved",showCloseButton:false}).loadRemoteSuccess(JS_CHANGES_SAVED);ta.store("overlays.current",window.mpSavedOL);window.mpSavedOL.show();setTimeout("ta.servlet.MemberProfile.closeSaved()",1500)},closeSaved:function(){var lb=ta.retrieve("overlays.current");if(lb&&lb){lb.hide()}ta.remove("overlays.current")},selectAll:function(checkBoxes){if(!checkBoxes.length){checkBoxes.checked=true}else{for(var i=0;i<checkBoxes.length;i++){checkBoxes[i].checked=true}}},unselectAll:function(checkBoxes){if(!checkBoxes.length){checkBoxes.checked=false}else{for(var i=0;i<checkBoxes.length;i++){checkBoxes[i].checked=false}}},forumSelectAll:function(event,elt){ta.servlet.MemberProfile.selectAll($("FORUM").elements.ft)},forumUnselectAll:function(event,elt){ta.servlet.MemberProfile.unselectAll($("FORUM").elements.ft)},removeForumNotif:function(event,elt){new Request({url:"/MemberSubscriptionsController",data:$("FORUM"),onFailure:ta.util.error.ajaxFailure.partial("MemberProfile:removeForumNotif"),onSuccess:function(txt,xml){if(ta.servlet.MemberProfile.checkForErrors(txt,true)){return}ta.servlet.MemberProfile.showSaved();$("FORUM_SECTION").set("html",txt)}}).send()},nexusGeoSelectAll:function(event,elt){ta.servlet.MemberProfile.selectAll($("NEXUS_GEO").elements.unsubspace)},nexusGeoUnselectAll:function(event,elt){ta.servlet.MemberProfile.unselectAll($("NEXUS_GEO").elements.unsubspace)},nexusDocSelectAll:function(event,elt){ta.servlet.MemberProfile.selectAll($("NEXUS_DOC").elements.unsubdoc)},nexusDocUnselectAll:function(event,elt){ta.servlet.MemberProfile.unselectAll($("NEXUS_DOC").elements.unsubdoc)},removeNexusGeoNotif:function(event,elt){new Request({url:"/MemberSubscriptionsController",data:$("NEXUS_GEO"),onFailure:ta.util.error.ajaxFailure.partial("MemberProfile:removeNexusGeoNotif"),onSuccess:function(txt,xml){if(ta.servlet.MemberProfile.checkForErrors(txt,true)){return}ta.servlet.MemberProfile.showSaved();$("NEXUS_SECTION").set("html",txt)}}).send()},removeNexusDocNotif:function(event,elt){new Request({url:"/MemberSubscriptionsController",data:$("NEXUS_DOC"),onFailure:ta.util.error.ajaxFailure.partial("MemberProfile:removeNexusDocNotif"),onSuccess:function(txt,xml){if(ta.servlet.MemberProfile.checkForErrors(txt,true)){return}ta.servlet.MemberProfile.showSaved();$("NEXUS_SECTION").set("html",txt)}}).send()},unsubscribeAll:function(event,elt){new Request({url:"/MemberSubscriptionsController",data:{Action:"UnsubscribeAll",token:JS_SECURITY_TOKEN},onFailure:ta.util.error.ajaxFailure.partial("MemberProfile:unsubscribeAll"),onSuccess:function(txt,xml){if(ta.servlet.MemberProfile.checkForErrors(txt,true)){return}ta.servlet.MemberProfile.showSaved();$("SUB_SECTION").set("html",txt)}}).send()},checkForErrors:function(txt,handleDisplay){if(txt.match(/^{/)){var data=eval("("+txt+")");if(data.ERROR){if(handleDisplay){ta.overlays.showInLightbox(data.ERROR,{style:"typeO OverlayAjaxError"});return true}return data.ERROR}else{if(data.ALERT){if(handleDisplay){ta.overlays.showInLightbox(data.ALERT,{style:"typeO OverlayAjaxError",onHide:function(){window.location.reload()}});return true}return data.ALERT}else{if(data.REDIRECT){window.location=data.REDIRECT;return true}}}}if(handleDisplay){return false}return null},setAvatar:function(event,elt){event.preventDefault();var cid=elt.className.match(/cid_(\w+)/)[1];var avid=elt.className.match(/avid_(\d+)/)[1];new Request({url:"/MemberProfileController",data:{Action:"SetAvatar",avid:avid,token:JS_SECURITY_TOKEN},onFailure:ta.util.error.ajaxFailure.partial("MemberProfile:setAvatar"),onSuccess:function(txt,xml){if(ta.servlet.MemberProfile.checkForErrors(txt,true)){return}$("BODYCON").set("html",txt);ta.servlet.MemberProfile.showSaved()}}).send()},setAvatarNew:function(avatar,fileInputName,callback){function success(txt){var json;try{json=eval("("+txt+")")}catch(e){}if(callback){callback(json)}}if(window.FormData&&typeof avatar=="object"){var data=new FormData();data.append("Action","SetAvatar");data.append("Format","json");data.append("token",JS_SECURITY_TOKEN);data.append(fileInputName,avatar);var request=new XMLHttpRequest();request.open("POST","/MemberProfileController",true);request.onload=function(){if(request.status=="200"){success(request.responseText)}else{callback(null)}};request.send(data)}else{var data={Action:"SetAvatar",Format:"json",token:JS_SECURITY_TOKEN};if(typeof avatar=="object"){data[fileInputName]=avatar}else{data.avid=avatar}new Request({url:"/MemberProfileController",data:data,onFailure:ta.util.error.ajaxFailure.partial("MemberProfile:setAvatar"),onSuccess:success}).send()}},clearAvatar:function(){new Request({url:"/MemberProfileController",data:{Action:"SetAvatar",avid:0},onFailure:ta.util.error.ajaxFailure.partial("MemberProfile:clearAvatar"),onSuccess:function(txt,xml){if(ta.servlet.MemberProfile.checkForErrors(txt,true)){return}$("BODYCON").set("html",txt);ta.servlet.MemberProfile.showSaved()}}).send()},addEmail:function(){var emailBoxCount=$$("div[id^=addEmail_]").length;var lastAdded=$("addEmail_"+(emailBoxCount-1));if($(lastAdded.getFirst()).get("value")==""){ta.servlet.MemberProfile.showError(JS_err_invalid_email);return}var elmt=lastAdded.clone(true,true);elmt.set({id:"addEmail_"+emailBoxCount,"class":"newEmail email"});elmt.getElement("input").set({id:"email_"+emailBoxCount,value:"",name:"email_"+emailBoxCount});elmt.getElement("span[id^=del_]").set({id:"del_"+emailBoxCount});elmt.getElement("span[id^=prim_]").set({id:"prim_"+emailBoxCount});var primary=elmt.getElement("span[id=primary]");if(primary){primary.dispose()}elmt.getElement(".actions").setStyle("display","inline");elmt.show();elmt.inject(lastAdded,"after");lastAdded=elmt;emailBoxCount++},showError:function(msg){var elmt=new Element("li",{"class":"error"}).set("text",msg);elmt.inject($("errors"));(function(){elmt.dispose()}).delay(2500)},deleteEmail:function(elmt){var emailBoxCount=$$("div[id^=addEmail_]").length;var id=$(elmt).getProperty("id");var index=/del_(\d+)/.test(id)?RegExp.$1:false;if(index){var box=$("addEmail_"+index);if(box.hasClass("newEmail")){confirmBubble(elmt,0,0,0,"",function(){if(index==emailBoxCount-1){emailBoxCount--}box.dispose()})}else{var alias=$("email_"+index).get("value");confirmBubble(elmt,0,0,0,"",function(){new Request({url:"/CommunityAjax",data:{action:"RemoveEmail",email:alias},onSuccess:function(){box.dispose()},onFailure:function(e){ta.servlet.MemberProfile.showError("Cannot remove email: "+e)}}).send()})}}},makePrimaryEmail:function(elmt){var id=$(elmt).getProperty("id");var index=/prim_(\d+)/.test(id)?RegExp.$1:false;if(index){if(!$("email_"+index).get("value")){ta.servlet.MemberProfile.showError(JS_err_invalid_email);return}var box=$("addEmail_"+index);var elmt=$("primaryEmail");elmt.set({value:"email_"+index});$("emailList").getElements("div").each(function(child){if(child.hasClass("email")){child.getElement(".actions").setStyle("display","inline")}});box.getElement(".actions").setStyle("display","none");var primary=$("primary");primary.clone(true,true).inject(box.getElement(".actions"),"after");primary.dispose()}},submitProfileForm:function(form,toUpdate,event){new Event(event||window.event).stop();$(form).set("send",{onSuccess:function(txt){if(ta.servlet.MemberProfile.checkForErrors(txt,true)){return}var elt=new Element("div").set("html",txt).getElement(".errors");if(elt&&elt.hasClass("errors")){if($("errors")){elt.replaces($("errors"))}else{elt.inject(toUpdate,"top")}}else{$(toUpdate).empty();$(toUpdate).getParent().innerHTML=txt;ta.servlet.MemberProfile.showSaved()}if(form=="base"){var newName=$("displayName").get("value");if(newName&&newName!=""){var mastheadName=ta.id("MASTHEAD_SUBSCRIBER");if(mastheadName){mastheadName.set("text",newName)}}}else{if(form=="aboutme"){var newLoc=$("displayLocation").get("value");if(ta.id("LEFTNAV")){var update=$("LEFTNAV").getElement(".mbrLocation");if(update!=null){update.set("text",newLoc)}}}}}}).send();return false},cancelProfileForm:function(action,toUpdate){new Request({url:"/MemberProfileController",method:"post",data:{Action:action},onSuccess:function(txt){$(toUpdate).empty();$(toUpdate).getParent().innerHTML=txt}}).send()},memberSetting:function(event,obj,setting){if(setting=="ALLOW_OPEN_GRAPH_POSTS"&&obj.checked&&!ta.servlet.MemberProfile.fbAccepted){FB.login(function(response){FB.api("/me/permissions",function(response){if(response&&response.data&&response.data.length){var permissions=response.data.shift();if(permissions.publish_actions){ta.servlet.MemberProfile.fbAccepted=true;ta.servlet.MemberProfile.memberSetting(event,obj,setting)}else{ta.servlet.MemberProfile.fbAccepted=false;ta.id("ALLOW_OPEN_GRAPH_POSTS").checked=false}}})},{scope:"publish_actions"});return}new Request({url:"/MemberProfileController",method:"post",evalScripts:true,data:{Action:"UpdateSetting",setting:setting,token:JS_SECURITY_TOKEN,value:obj.checked},onSuccess:function(data){if(data.match(/^{/)){var response=eval("("+data+")");if(response.ERROR){ta.overlays.showInLightbox(response.ERROR)}else{if(response.ALERT){ta.overlays.showInLightbox(response.ALERT)}else{if(response.REDIRECT){ta.servlet.MemberProfile.showSaved();window.location=response.REDIRECT}}}}else{ta.servlet.MemberProfile.showSaved();if(ta.id("PROFILE_CONTENT")){var oldElmt=$("PROFILE_CONTENT").getElement(".facebook_settings");var newElmt=new Element("div").set("html",data).getElement(".facebook_settings");newElmt.replaces(oldElmt)}}},onFailure:function(data){if(data.match(/^{/)){var response=eval("("+data+")");ta.overlays.showInLightbox(response.ERROR)}}}).send()},fillDisplayName:function(name,event,elmt){ta.id("mbrSNEdit").set("value",name);if(ta.id(elmt).get("id")=="TOGGLE_SN"){ta.id("TOGGLE_RN").setStyle("display","inline-block")}else{ta.id("TOGGLE_SN").setStyle("display","inline-block")}ta.id(elmt).hide()},updateRealName:function(){if(!ta.id("TOGGLE_RN").isDisplayed()&&!ta.id("TOGGLE_SN").isDisplayed()){ta.id("TOGGLE_SN").setStyle("display","inline")}var realName=ta.id("firstname").value.trim();if(realName.length>15){realName=realName.substring(0,15)+"..."}if(realName){var lastName=ta.id("lastname").value.trim();if(lastName){realName=ta.retrieve("isDaoDao")?(lastName+realName):(realName+" "+lastName.charAt(0))}if(ta.id("RN_DISPLAY")){ta.id("RN_DISPLAY").set("html",realName)}if(ta.id("mbrSNEdit")&&!ta.id("TOGGLE_RN").isDisplayed()){ta.id("mbrSNEdit").set("value",realName)}}},recordMemberQuickRating:function(detail,token,pid,rating){try{new Request({url:"/RatingAjax",data:{d:detail,rating:rating,token:token,app:"ta",pid:pid},onSuccess:function(){var addreviewlink=ta.id("link_d"+detail);if(addreviewlink&&addreviewlink.href){addreviewlink.href=addreviewlink.href.replace(/qid10\.\d+-/,"qid10."+rating+"-")}}}).send()}catch(e){ta.util.error.record(e,"MemberProfile - recordMemberQuickRating")}},dynamizeMemberQuickRating:function(evnt,elmt){try{if(elmt){var bubbles=elmt.getElement(".rate"),parent=bubbles.getParent("td"),detail=elmt.getElement(".detail").get("text"),token=elmt.getElement(".token").get("text"),pid=elmt.getElement(".productId").get("text");var dynamicRating=new DynamicRating(bubbles,{clickFn:ta.servlet.MemberProfile.recordMemberQuickRating.partial(detail,token,pid)});elmt.onmouseover=null;dynamicRating.enter()}}catch(e){ta.util.error.record(e,"MemberProfile - dynamizeMemberQuickRating")}},initializeSavesMap:function(){var elmt=ta.id("SAVES_MAP");elmt.map=new ta.maps.Map(elmt,{origLat:0,origLng:0,zoom:0,typeControl:false,scaleControl:false,homeIcon:false,enableInfoWindows:true})},changeSavesMapMarkers:function(markers,lat,lng){ta.id("SAVES_MAP").map.reset();if(lat!=0&&lng!=0){ta.id("SAVES_MAP").map.setZoom(15)}ta.id("SAVES_MAP").map.replaceMarkers(markers,"location",ta.maps.MARKER_HOTEL);if(lat!=0&&lng!=0){ta.id("SAVES_MAP").map.setCenter(lat,lng);ta.id("SAVES_MAP").map.zoomAndPanToFit(lat,lng)}Array.each(markers,function(marker){ta.id("SAVES_MAP").map.zoomAndPanToFit(marker.lat,marker.lng)})},switchSavesGeo:function(element,markers,toggle,lat,lng){element=ta.id(element);if(element.hasClass("expanded")){return}$$(".expanded").removeClass("expanded");element.addClass("expanded");$$(".sprite-toggle_header_on").addClass("sprite-toggle_header");$$(".sprite-toggle_header_on").removeClass("sprite-toggle_header_on");ta.id(toggle).removeClass("sprite-toggle_header");ta.id(toggle).addClass("sprite-toggle_header_on");ta.servlet.MemberProfile.changeSavesMapMarkers(markers,lat,lng)},unsave:function(itemid,folderid,elmt){var params={a:"delete",e:itemid,i:folderid};new Request({url:"/SavesController",data:params,onSuccess:function(response){ta.id(elmt).hide()}}).send()},selectSubTab:function(event,tabs,subs){var elmt=event.target;if(elmt.hasClass("activeTab")){return}var tabName=elmt.className.match(/(tab_\w+)/)[1];ta.select(tabs,".activeTab").removeClass("activeTab");elmt.addClass("activeTab");subs.set("class",tabName)},savePreferredLang:function(event,elmt){var lang=elmt.options[elmt.selectedIndex].value;elmt.blur();if(!lang){return}new Request({url:"/MemberSubscriptionsController",data:{Action:"ChangePrefLang",prefLang:lang,token:JS_SECURITY_TOKEN},onFailure:ta.util.error.ajaxFailure.partial("MemberProfile:savePreferredLang"),onSuccess:function(response){if(ta.servlet.MemberProfile.checkForErrors(response,true)){return}ta.servlet.MemberProfile.showSaved()}}).send()},startAmexSync:function(syncURL){var params=new StringBuffer();params.append("&response_type=").append("code");params.append("&client_id=").append("64610262");params.append("&redirect_uri=").append(syncURL);params.append("&cid=").append("18254");var uri="https://"+document.location.host+"/OAuthRegistrationPage?"+params.toString();window.location=uri},doAmexUnsync:function(unsyncURL){var params=new StringBuffer();params.append("&response_type=").append("code");params.append("&client_id=").append("64610262");params.append("&redirect_uri=").append(unsyncURL);var uri="https://"+document.location.host+"/OAuthRegistrationPage?"+params.toString();window.location=uri},toggleAmexAttribution:function(){new Request({url:"/MemberProfileController",evalScripts:true,data:{Action:"ToggleAmexAttribution"},onFailure:ta.util.error.ajaxFailure.partial("MemberProfile:toggleAmexAttribution"),onSuccess:function(txt,xml){if(ta.servlet.MemberProfile.checkForErrors(txt,true)){return}ta.servlet.MemberProfile.showSaved()}}).post()},makeAvatarCreator:function(){return new AvatarCreator()}};function AvatarCreator(){var WEBCAM_CONNECT_TIMEOUT=30000;var m_didInit={};var m_container;var m_mode,m_prevMode;var m_fileInput;var m_form;var m_imgFromList;var MAX_WIDTH=1024;var MIN_WIDTH=300;var m_cropCircle;var m_featureSupport={};var m_videoStream;var m_avatarPreview;var m_pauseVideo=false;var m_stopVideo=false;var m_isFb=false;var m_cropCircleJs=null;this.init=function(isFb,container,optionsElt,form,fileInput,cropCircleJs,loadImageJs){m_isFb=isFb;m_container=container;m_form=form;m_fileInput=fileInput;m_cropCircleJs=cropCircleJs;if(!m_container||!m_form||!m_fileInput||!optionsElt){return}if(m_didInit.global){return}m_didInit.global=true;ta.trackEventOnPage("MemberAvatar","avatar_creation_pageload");if(!navigator.getUserMedia){navigator.getUserMedia=navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia||navigator.oGetUserMedia;if(!navigator.getUserMedia){m_container.addClass("noWebcam")}}var cropCircleMightExist=m_cropCircleJs||ta.widgets.CropCircle;m_featureSupport={canvas:!!window.HTMLCanvasElement,fileReader:!!window.FormData&&!!window.FileReader&&cropCircleMightExist,webcam:!!navigator.getUserMedia};m_avatarPreview=m_container.getElement(".uploadAvatarPopup .avatarPreview .circularAvatar");if(!m_avatarPreview){return}optionsElt.show();optionsElt.getElement(".optionUpload").addEvent("click",showUploadPopup);optionsElt.getElement(".optionWebcam").addEvent("click",showWebcamPopup);if(optionsElt.getElement(".optionList")){optionsElt.getElement(".optionList").addEvent("click",showListPopup)}m_container.getElement(".btnOk").addEvent("click",function(){if(this.hasClass("disabled")){ta.trackEventOnPage("MemberAvatar","avatar_creation_error",m_mode+"_ok_disabled")}else{ta.trackEventOnPage("MemberAvatar","avatar_creation_ok",m_mode);try{upload()}catch(e){ta.util.error.record(e,"MemberProfile - avatar upload exception")}hidePopup("ok")}});m_container.getElement(".btnCancel").addEvent("click",function(){ta.trackEventOnPage("MemberAvatar","avatar_creation_cancel",m_mode);hidePopup("cancel")});window.addEvent("beforeunload",function(){if(m_container.getElement(".uploadAvatarPopup").isDisplayed()){ta.trackEventOnPage("MemberAvatar","avatar_creation_unload",m_mode)}});if(!window.loadImage){Asset.javascript(loadImageJs)}};function upload(){if(m_mode=="webcam"){var file=canvasToFile(m_container.getElement(".photo"));if(file){changeAvatarOnServer(file)}else{ta.trackEventOnPage("MemberAvatar","avatar_creation_error","webcam_no_fileapi")}}else{if(m_mode=="list"){ta.util.cookie.setPIDCookie(5093);changeAvatarOnServer(m_imgFromList)}else{if(m_mode=="upload"){if(m_featureSupport.fileReader&&m_cropCircle){var file=dataURLToFile(m_cropCircle.getImageData());if(file){changeAvatarOnServer(file)}else{changeAvatarOnServer(m_fileInput.files[0])}}else{m_form.submit()}}}}}function showPopup(mode){m_mode=mode;m_container.getElements(".commonBtn").show();m_container.getElement(".btnOk").addClass("disabled");m_container.getElements(".instructions").hide();m_container.getElement(".uploadAvatarPopup").show();m_avatarPreview.src=m_container.getElement(".currentAvatar .circularAvatar").src;ta.trackEventOnPage("MemberAvatar","avatar_creation_start",m_mode)}function hidePopup(reason){m_container.getElement(".uploadAvatarPopup").hide();m_container.getElements(".creatingAvatar, .avatarBtn").hide();if(m_mode=="upload"&&m_cropCircle){m_cropCircle.toggleDrag(false)}if(m_mode=="webcam"&&m_videoStream){m_stopVideo=true;try{if(m_videoStream.stop){m_videoStream.stop()}var video=m_container.getElement("video");video.pause();video.src="";video.mozSrcObject=null}catch(e){}}m_prevMode=m_mode;m_mode=null}function showUploadPopup(){showPopup("upload");if(!m_featureSupport.fileReader){m_container.getElement(".instructions.oldBrowser").show()}m_container.getElements(".uploadBtn").show();m_fileInput.show();m_container.getElement(".uploadImgCropper").hide();m_container.getElement(".creatingAvatar.fromUpload").show();var file=m_fileInput.clone();file.name=m_fileInput.name;file.cloneEvents(m_fileInput);file.replaces(m_fileInput);m_fileInput=file;if(m_didInit.upload){return}m_didInit.upload=true;if(m_featureSupport.fileReader){if(m_cropCircleJs&&!ta.widgets.CropCircle){new Asset.javascript(m_cropCircleJs)}function onImgReady(img){if(!m_cropCircle){m_cropCircle=new ta.widgets.CropCircle();m_cropCircle.setCallbacks({changed:function(){m_avatarPreview.src=m_cropCircle.getImageData(m_avatarPreview.getWidth())}})}m_container.getElement(".instructions.newBrowser").show();var cropContainer=m_container.getElement(".uploadImgCropper");var onPageImg=cropContainer.getElement(".cropImg");var maxW=parseInt(cropContainer.getStyle("max-width"))||500;var maxH=parseInt(cropContainer.getStyle("max-height"))||500;var containerAspect=maxW/maxH;var origW=img.width,origH=img.height;var imgAspect=origW/origH;if(containerAspect>imgAspect){onPageImg.height=maxH;onPageImg.width=maxH*imgAspect}else{onPageImg.width=maxW;onPageImg.height=maxW/imgAspect}onPageImg.src=img.src;m_container.getElement(".uploadImgCropper").style.display="";m_container.getElement(".instructions.loadingUpload").hide();m_cropCircle.render(cropContainer,img,{origW:origW,origH:origH,borderW:1});m_cropCircle.toggleDrag(true);m_container.getElement(".btnOk").removeClass("disabled")}m_fileInput.addEvent("change",function(){if(!this.files||!this.files.length){return}var file=this.files[0];function onCodeReady(){loadImage.parseMetaData(file,function(imgData){var orientation=imgData.exif?imgData.exif.get("Orientation"):1;loadImage(file,function(canvas){if(canvas.type!="error"){waitFor(function(){return ta.widgets&&ta.widgets.CropCircle},function(){var img=new Image();img.onload=function(){onImgReady(this);m_avatarPreview.src=m_cropCircle.getImageData(m_avatarPreview.getWidth())};img.src=canvas.toDataURL()},300,500)}else{var error=ta.retrieve("member.avatar.errors").invalid_image;ta.overlays.showInLightbox(error,{style:"typeO OverlayAjaxError"});m_fileInput.show();m_container.getElement(".instructions.loadingUpload").hide()}},{canvas:true,maxWidth:MAX_WIDTH,minWidth:MIN_WIDTH,orientation:orientation})});m_fileInput.hide();m_container.getElement(".instructions.loadingUpload").show()}waitFor(function(){return"loadImage" in window},onCodeReady,300,200)})}else{m_fileInput.addEvent("change",function(e){m_container.getElement(".btnOk").removeClass("disabled")});m_container.getElement(".avatarPreview").hide()}}function showListPopup(){showPopup("list");m_container.getElement(".creatingAvatar.fromList").show();m_container.getElements(".listBtn").show();if(m_didInit.list){return}m_didInit.list=true;var current=null;m_container.getElements(".avatarList .circularAvWrap").each(function(avatar){var img=avatar.getElement(".circularAvatar");if(m_container.getElement(".currentAvatar .circularAvatar").src==img.src){current=avatar;current.addClass("current");var list=m_container.getElement(".avatarList");var y=current.getPosition(list).y;list.scrollTop=Math.max(y-12,0)}avatar.addEvent("click",function(e){m_imgFromList=img.get("data-imageId");m_avatarPreview.src=img.src;m_container.getElement(".btnOk").removeClass("disabled");if(current){current.removeClass("current")}current=avatar;current.addClass("current")})});if(!m_featureSupport.fileReader){m_container.getElement(".avatarPreview").show()}}function showWebcamPopup(){showPopup("webcam");var takePicture=m_container.getElement(".avatarBtn.takePicture");var video=m_container.getElement("video");var popup=m_container.getElement(".creatingAvatar.fromWebcam");var canvas=m_container.getElement(".photo");var context=canvas.getContext("2d");var width,height;popup.show();takePicture.show();canvas.show();video.autoplay=true;navigator.getUserMedia({video:true},handleVideo,videoError);var timeout=setTimeout(videoError,WEBCAM_CONNECT_TIMEOUT);popup.getElement(".instructions.videoLoading").show();popup.getElement(".videoCircleWrapper").hide();popup.getElement(".takePicture").addClass("disabled");var frameNum=0;function updateCanvas(){if(m_stopVideo){return}if(frameNum++%2==0&&!m_pauseVideo){width=video.getWidth();height=video.getHeight();canvas.width=canvas.height=height;try{context.drawImage(video,(height-width)/2,0,width,height)}catch(e){}}requestAnimationFrame(updateCanvas)}function videoGood(){if(timeout){clearTimeout(timeout)}timeout=0;m_pauseVideo=m_stopVideo=false;video.play();updateCanvas();popup.getElement(".instructions.videoLoading").hide();popup.getElement(".videoCircleWrapper").show();popup.getElement(".takePicture").removeClass("disabled")}function handleVideo(stream){m_videoStream=stream;if(stream.constructor.toString().indexOf("function MediaStream")==0){video.addEventListener("loadeddata",videoGood,false);video.src=(window.URL||window.webkitURL).createObjectURL(stream)}else{if(navigator.mozGetUserMedia){video.mozSrcObject=stream;video.addEventListener("loadeddata",videoGood,false)}else{videoError()}}}function videoError(){if(timeout){clearTimeout(timeout);ta.trackEventOnPage("MemberAvatar","avatar_creation_error","webcam_init_timeout")}else{ta.trackEventOnPage("MemberAvatar","avatar_creation_error","webcam_init_failed")}timeout=0;popup.getElement(".instructions.videoLoading").hide();popup.getElement(".instructions.videoFailed").show()}if(m_didInit.video){return}m_didInit.video=true;var retakePicture=popup.getElement(".avatarBtn.retakePicture");takePicture.addEvent("click",function(e){if(this.hasClass("disabled")){ta.trackEventOnPage("MemberAvatar","avatar_creation_error","webcam_take_disabled");return}ta.trackEventOnPage("MemberAvatar","avatar_creation_take_picture");m_pauseVideo=true;m_avatarPreview.src=canvas.toDataURL();m_container.getElement(".btnOk").removeClass("disabled");canvas.show();takePicture.hide();retakePicture.show();canvas.style.transition="";canvas.style.opacity=0;setTimeout(function(){canvas.style.transition="opacity 300ms ease-in";canvas.style.opacity=1},1)});retakePicture.addEvent("click",function(e){if(this.hasClass("disabled")){ta.trackEventOnPage("MemberAvatar","avatar_creation_error","webcam_retake_disabled");return}ta.trackEventOnPage("MemberAvatar","avatar_creation_retake_picture");m_container.getElement(".btnOk").addClass("disabled");m_pauseVideo=false;takePicture.show();retakePicture.hide()});popup.getElement(".videoFailed .tryAgain").addEvent("click",function(e){showWebcamPopup()});popup.getElement(".videoFailed .cancel").addEvent("click",function(e){ta.trackEventOnPage("MemberAvatar","avatar_creation_cancel",m_mode);hidePopup("cancel")})}function canvasToFile(canvas){if(canvas.mozGetAsFile){return canvas.mozGetAsFile("avatar.png")}else{return dataURLToFile(canvas.toDataURL())}}function dataURLToFile(dataURL){var hasBlobConstructor=window.Blob&&(function(){try{return Boolean(new Blob())}catch(e){return false}}());if(window.atob&&(window.BlobBuilder||window.Blob)){var dataParts=dataURL.split(/data:|[;,]/,4);var mimeType=dataParts[1];var data=atob(dataParts[3]);var buffer=new ArrayBuffer(data.length);var ia=new Uint8Array(buffer);for(var i=0;i<data.length;i++){ia[i]=data.charCodeAt(i)}if(hasBlobConstructor){return new Blob([buffer],{type:mimeType})}else{var builder=new BlobBuilder();builder.append(buffer);return builder.getBlob(mimeString)}}return false}function changeAvatarOnServer(avatar){if(!avatar){return}var currentAvWrap=m_container.getElement(".currentAvatar .circularAvWrap");currentAvWrap.addClass("loading");ta.run("ta.servlet.MemberProfile.setAvatarNew",null,avatar,m_fileInput.name,function(json){var error=null;if(!json||json.error){error=ta.retrieve("member.avatar.errors")[json?json.error:"upload_failed"]}else{if(json.ERROR){error=json.ERROR}else{if(!json.avatarUrl||!json.avatarId){error=ta.retrieve("member.avatar.errors").upload_failed}}}if(error){ta.overlays.showInLightbox(error,{style:"typeO OverlayAjaxError"});currentAvWrap.removeClass("loading");ta.trackEventOnPage("MemberAvatar","avatar_creation_failed",m_prevMode);return}var randParam="";loadImage(60,500);function loadImage(triesLeft,interval){if(triesLeft>0){var img=new Image();img.onload=function(){updateImage(img)};img.onerror=function(){setTimeout(function(){randParam="?noCacheRandParam="+Math.random();loadImage(triesLeft-1,interval)},interval)};img.src=json.avatarUrl.replace(/\/photo-[^/]*\//,"/photo-l/")+randParam}else{var error=alert(ta.retrieve("member.avatar.errors").update_timeout);ta.overlays.showInLightbox(error,{style:"typeO OverlayAjaxError"})}}function updateHeaderAvatars(img,randParam){document.getElement(".member-avatar").src=img.src+randParam;document.getElement(".masthead .prfs .circularAvatar").src=img.src+randParam}function updateImage(img){var current=m_container.getElement(".currentAvatar .circularAvatar");current.onload=function(){currentAvWrap.removeClass("loading")};setTimeout(function(){currentAvWrap.removeClass("loading")},1000);current.src=img.src.replace(/\/photo-[^/]*\//,"/photo-s/")+randParam;m_avatarPreview.src=img.src+randParam;if(!m_isFb){updateHeaderAvatars(img,randParam)}else{FB.getLoginStatus(function(response){if(response.status!=="connected"){updateHeaderAvatars(img,randParam)}})}}})}function waitFor(test,callback,interval,maxChecks){if(maxChecks!==0){if(test()){callback()}else{setTimeout(function(){waitFor(test,callback,interval,(maxChecks||Number.MAX_VALUE)-1)},interval||300)}}}}})();ta.overlays.BACKDROP_NEVER=0;ta.overlays.BACKDROP_ALWAYS=1;ta.overlays.Overlay=new Class({Implements:[Options,Events],Binds:["_hide","show","hide","destroy","hideByClickOnDocument"],options:{requestData:null,showCloseButton:false,noPadding:false,noCpu:false,closeButtonClass:"close",closeLink:"",showArrow:false,arrowClassLeft:null,arrowClassRight:null,arrowClass:"ttarrow",style:"typeO",innerDivClass:"inner",backdrop:ta.overlays.BACKDROP_NEVER,backdropZIndex:"default",permanent:false,permanent_except_same:false,type:"",isChild:false,remoteContent:null,maintainCrPageServlet:false,keepElementInDocument:false,requestMethod:"get",zIndex:1001,positionType:"absolute",draggable:false,draggingClass:"dragging",title:null,onscroll:null,noScroll:false,noScrollY:false,backdropClickClose:false,backdropColor:"#000",backdropOpacity:0.6,offsetRight:0,offsetLeft:0,offsetTop:0,offsetBottom:0,closeOnDocumentClick:false,track:false,positionByOffsets:false,useTransparentOverlayPadding:false,transparentOverlayPaddingValue:0},initialize:function(i,b){this.noScroll=i.noScroll||i.noScrollY;if(i.noScroll){this.overflowToHide="overflow"}else{if(i.noScrollY){this.overflowToHide="overflow-Y"}}if(this.noScroll){var a=i.onShow;i.onShow=function(){if(a){a()}ta.find("body").setStyle(this.overflowToHide,"hidden")};var h=i.onClose;i.onClose=function(){if(h){h()}ta.find("body").setStyle(this.overflowToHide,"")}}this.setOptions(i);this.source=ta.id(b);this.visible=false;this.backdropOn=false;this.closedByDocClick=false;var f=this.options.style+" overlay";if(this.options.backdrop==ta.overlays.BACKDROP_ALWAYS){f+=" withBackdrop"}else{f+=" noBackdrop"}this.container=new Element("div",{styles:{position:this.options.positionType,left:"-999em",top:"-999em",fontSize:this.options.fontSize||".75em",zIndex:this.options.zIndex},"class":f});if(i.blockSelect){this.container.onselectstart=function(){return false}}this.container.store("overlay",this);this.container.overlay=this;ta.store("overlays.current",this);this._useIframeShim=Browser.ie6;if(this.options.title){this.header=new Element("h1",{"class":"title",html:this.options.title}).inject(this.container);if(this.options.draggable){var g=this.options.draggingClass;var d=function(){};if(this._useIframeShim){d=this.positionShim.bind(this)}if(this.options.useTransparentOverlayPadding){d=this.transparentOverlayPadding.bind(this)}this.drag=new Drag(this.container,{handle:this.header,preventDefault:true,stopPropagation:true,onSnap:function(j){j.addClass(g)},onDrag:d,onComplete:function(j){j.removeClass(g)}})}}this.inner=new Element("div",{"class":this.options.innerDivClass}).inject(this.container);this.inner.id="overlayInnerDiv";var e=this;if(e.options.onscroll){e.inner.addEvent("scroll",function(){e.options.onscroll(e.inner)})}if(this._useIframeShim){this.shim=new IframeShim(this.container,{browsers:true})}if(this.options.useTransparentOverlayPadding){this.transparentOverlayPadding=new Element("div",{"class":"overlayPadding",styles:{position:"absolute","z-index":this.options.zIndex-1}});this.transparentOverlayPaddingValue=this.options.transparentOverlayPaddingValue}var c;if(this.options.content){this.inner.setContent(this.options.content)}else{if(this.options.remoteContent){this.loadRemoteContent(this.options.remoteContent)}else{if(this.source&&(c=this.source.getElement(".overlayContents"))){if(c){this.inner.set("html",c.innerHTML);c.dispose();this.runBehaviorOnFirstShow=true}}}}if(this.options.showCloseButton){this.addCloseButton()}else{if(this.options.setCloseButton){this.setCloseButton()}}if(this.options.showArrow){this.arrow=new Element("div",{styles:{position:"absolute"},"class":this.options.arrowClass}).inject(this.container);if(this.header){this.container.addClass("withClose")}else{this.inner.addClass("withClose")}}if(this.options.noPadding){if(this.header){this.container.addClass("noPad")}else{this.inner.addClass("noPad")}}if(this.options.noCpu){if(this.header){this.container.addClass("no_cpu")}else{this.inner.addClass("no_cpu")}}this.container.addEvent("trash",this.destroy)},addCloseButton:function(){var a=this.options.closeButtonClass;if(ta.has("checkrates.add_holding_windows")){a+=" no_cpu"}this.closeBtn=new Element("div",{styles:{position:"absolute",fontSize:"92.5%",cursor:"pointer"},html:this.options.closeLink,"class":a,events:{click:(function(){this.fireEvent("onClose",this)}).bind(this)}}).inject(this.container);if(this.header){this.container.addClass("withClose")}else{this.inner.addClass("withClose")}},setCloseButton:function(){if(this.options.closeButtonClass){this.closeBtn=this.container.getElement("."+this.options.closeButtonClass);if(this.closeBtn){this.closeBtn.addEvents({click:(function(){this.fireEvent("onClose",this);this.hide()}).bind(this)})}}},destroy:function(){this.container.overlay=null;if(this.shim){this.shim.destroy();this.shim=null}if(this.transparentOverlayPadding){this.transparentOverlayPadding.destroy();this.transparentOverlayPadding=null}},position:function(){if(this.shim){(function(){this.positionShim()}).delay(10,this)}if(this.transparentOverlayPadding){(function(){this.positionTransparentOverlayPadding()}).delay(10,this)}},positionTransparentOverlayPadding:function(){var b=this.container.getCoordinates();if(!b||!b.left){return}var a=this.transparentOverlayPaddingValue;this.transparentOverlayPadding.setStyles({left:b.left-a,top:b.top-a})},positionShim:function(){var a=this.container.getCoordinates();if(!a||!a.left){return}this.shim.shim.setStyles({left:a.left,top:a.top})},show:function(a){if(typeof(overlayCss)!="undefined"&&!ta.retrieve("ta.overlayCssAsset")){if(this.options.waitForCss){ta.store("ta.overlayCssAsset",ta.css(overlayCss,{onLoad:function(){this._show(a)}.bind(this)}))}else{ta.store("ta.overlayCssAsset",ta.css(overlayCss));this._show(a)}}else{this._show(a)}},_show:function(f){if(this.visible){return}if(f){new Event(f).preventDefault()}this.closedByDocClick=false;var a=ta.util.URL.parse(this.options.remoteContent);if(!this.options.maintainCrPageServlet&&typeof crPageServlet!=="undefined"&&a&&a.test(/\/{1}(\w*)$/)){ta.store("crPageServlet_orig",crPageServlet);crPageServlet=RegExp.$1}$$(".overlay").each(function(c){if(c.overlay){if(c.overlay==this){return}if(this.parentOverlay&&c.overlay==this.parentOverlay){return}if(c.overlay.options.permanent){return}if(c.overlay.options.permanent_except_same&&c.overlay.options.type!=this.options.type){return}c.overlay.hide(f)}},this);var d=ta.id(this.options.parentContainer||document.body);d.adopt(this.container);if(this.shim&&this.shim.shim){d.adopt(this.shim.shim);var e=this.container.getCoordinates();if(e){this.shim.shim.setStyles({display:"block",width:e.width,height:e.height})}}if(this.transparentOverlayPadding){d.adopt(this.transparentOverlayPadding);var e=this.container.getCoordinates();if(e){var b=this.transparentOverlayPaddingValue*2;this.transparentOverlayPadding.setStyles({display:"block",width:e.width+b,height:e.height+b})}}if(this.options.backdrop==ta.overlays.BACKDROP_ALWAYS){this.enableBackdrop()}this.position();if(this.options.closeOnDocumentClick){document.addEvent("click",this._hide.bind(this))}this.visible=true;this.fireEvent("onShow",this);window.fireEvent("onOverlayShow",this);if(ta.has("overlay.onShow")){ta.remove("overlay.onShow").each(function(c){c.call(this)},this)}return this},_setPosition:function(a){if(this.options.parentContainer){var c=Math.abs(this.container.getPosition().x-this.container.offsetLeft);var d=Math.abs(this.container.getPosition().y-this.container.offsetTop);var b={};if(a.left!==undefined){b.left=Math.abs(a.left-c)}if(a.top!==undefined){b.top=Math.abs(a.top-d)}if(a.bottom!==undefined){b.right=Math.abs(a.right-c)}if(a.right!==undefined){b.bottom=Math.abs(a.bottom-d)}this.container.setStyles(Object.merge(a,b))}else{this.container.setStyles(a)}},_hide:function(b){if(this.noScroll){ta.find("body").setStyle(this.overflowToHide,"")}if(!b||this.container.containsEvent(b)){return}if(this.options.pinnable==ta.overlays.PINNABLE_HOVER||this.options.pinnable==ta.overlays.PINNABLE_CLICK_WITH_DOC_CLOSE){var a=b.target;while(a){if(a==this.source){return}else{a=a.parentElement}}}document.removeEvent("click",this._hide);this.hide(b)},hideByClickOnDocument:function(a){if(ta.retrieve("overlay.dontCloseOnClick")||this.options.dontCloseOnClick){return}this.closedByDocClick=true;this.hide(a)},hide:function(a){if(window.flyout){window.flyout.hide()}if(this.backdropOn){this.disableBackdrop()}if((this.options.keepElementInDocument&&this.container.style.left=="-999em")||(!this.options.keepElementInDocument&&!this.container.inDocument())){return this}if(this.shim){this.shim.hide().dispose()}if(this.transparentOverlayPadding){this.transparentOverlayPadding.hide().dispose()}this.container.setStyles({left:"-999em",top:"-999em"});if(!this.options.keepElementInDocument){this.container.dispose()}this.visible=false;this.fireEvent("onHide",!a);window.fireEvent("onOverlayClose",this);if(!this.options.maintainCrPageServlet&&ta.has("crPageServlet_orig")){ta.run("ta.meta.linkTracking.restoreCRPageServlet")}if(this.noScroll){ta.find("body").setStyle(this.overflowToHide,"")}return this},calculateBackdropHeight:function(){return Math.max(window.innerHeight?window.innerHeight:(document.documentElement.clientHeight?document.documentElement.clientHeight:document.body.offsetHeight),document.body.scrollHeight)},configureBackdrop:function(){var b={"class":"overlayBG"};var a;if(this.options.backdropZIndex==="behindOverlay"){a=this.options.zIndex-1}else{if(ta.retrieve("tablet_calendar_update.enabled")){b.events={click:function(d){this.fireEvent("backdropClick",d)}.bind(this)};if(document.getElement(".overlayBG")){this.options.backdropOpacity=0.01}var c=document.getElements(".overlay").length;a+=c*2}else{a=this.options.isChild?10000:9997}}this.backdrop=new Element("div",b);this.backdrop.setStyles({position:"fixed",left:0,top:0,width:"100%",height:this.calculateBackdropHeight(),backgroundColor:this.options.backdropColor,zIndex:a,opacity:this.options.backdropOpacity,filter:"alpha(opacity="+Math.floor(this.options.backdropOpacity*100)+")"});if(this.options.backdropClickClose){this.backdrop.addEvent("click",function(){this.fireEvent("onClose",this);this.hide()}.bind(this))}},updateBackdrop:function(){this.backdrop.setStyles({width:"100%",height:this.calculateBackdropHeight()})},enableBackdrop:function(){try{if(this.backdropOn){return}if(!this.backdrop){this.configureBackdrop()}if(Browser.ie6){var a=this.container;$$("select").each(function(d){if(!a.contains(d)){d.setStyle("visibility","hidden")}else{d.setStyle("visibility","visible")}})}ta.store("overlays.current",this);this.updateBackdrop();if(this.container.inDocument()){this.backdrop.inject(this.container,"before")}else{this.backdrop.inject(document.body)}this.backdropOn=true;if(this.options.backdropZIndex==="behindOverlay"){}else{if(ta.retrieve("tablet_calendar_update.enabled")){var b=document.getElements(".overlay").length;this.container.setStyle("z-index",parseInt(this.backdrop.getStyle("z-index"))+1)}else{this.container.setStyle("z-index",this.options.isChild?"10002":"9998")}}if(ta.isDHTMLCRRedesign2012()&&this.container.getElement(".check_availability")){if(Browser.ie7||Browser.ie8){this.container.setStyle("border","5px solid #424242")}else{this.container.setStyle("border","5px solid rgba(64,64,64,0.8)")}}}catch(c){ta.util.error.record(c,"Error setting the border property - enableBackdrop")}},disableBackdrop:function(){try{if(!this.backdropOn){return}this.backdrop.dispose();if(ta.retrieve("overlays.current")==this){ta.remove("overlays.current");if(Browser.ie6){$$("select").setStyle("visibility","visible")}}else{if(Browser.ie6&&ta.retrieve("overlays.current")&&!ta.retrieve("overlays.current").backdropOn){$$("select").setStyle("visibility","visible")}}this.backdropOn=false;this.container.setStyle("z-index","1001");if(ta.isDHTMLCRRedesign2012()&&this.container.getElement(".check_availability")){if(Browser.ie7||Browser.ie8){this.container.setStyle("border","5px solid #b2b2b2")}else{this.container.setStyle("border","5px solid rgba(128,128,128,0.6)")}}}catch(a){ta.util.error.record(a,"Error unsetting the border property - disableBackdrop")}},loadRemoteContent:function(c,a){var b={url:ta.util.URL.parse(c),method:this.options.requestMethod,data:this.options.requestData,onSuccess:this.loadRemoteSuccess.bind(this),onFailure:this.loadRemoteFailure.bind(this),evalScripts:true};this.options.track&&(b.trackEvent=this.options.track);if(!a&&!this.options.hideSpinner){new Asset.image(CDNHOST+"/img2/generic/site/loop.gif",{onload:this.position.bind(this),"class":"anim_loop"}).inject(this.inner)}new Request(b).send();return this},loadRemoteSuccess:function(b){if(typeof b==="string"){var a=document.head||ta.select("head")[0];b=b.replace(new RegExp("<style.*?>((.|\n)*?)</style.*?>","g"),function(c,d){var e=document.createElement("style");e.type="text/css";if(e.styleSheet){e.styleSheet.cssText=d}else{e.appendChild(document.createTextNode(d))}a.appendChild(e);return""})}this.cachedWidth=null;this.inner.setContent(b);this.position();if(typeof behavior!="undefined"&&behavior&&behavior.apply){behavior.apply(this.inner)}this.fireEvent("onLoad",this);this.cachedWidth=this.container.getSize().x;if(this.backdropOn){this.updateBackdrop()}return this},loadRemoteFailure:function(a){this.inner.addClass("ajax_failed");this.inner.setStyle("width","383px");this.inner.setStyle("padding","14px 24px 14px 14px");this.inner.set("text",JS_Ajax_failed);this.fireEvent("onLoadRemoteFailure",a)}});ta.overlays.getCurrent=function(){var a=$$(".overlay").shift();return a&&a.retrieve("overlay")};ta.overlays.safeCloseCurrent=function(){var a=ta.overlays.getCurrent();return a&&a.hide()};ta.overlays.safeCloseFromDom=function(c){c=ta.id(c);var a=c&&c.getParent(".overlay");var b=a&&a.retrieve("overlay");return b&&b.hide()};(function(){var b;function f(h){if(!h){return null}if(h.get("tag")=="a"){return h.href}var g=h.getElement("a");if(g){return g.href}g=h.getElement(".overlaySrc");if(g){return g.get("text")}return null}var e={left:ta.overlays.RelativeOverlayLeft,right:ta.overlays.RelativeOverlayRight,above:ta.overlays.RelativeOverlayAbove,below:ta.overlays.RelativeOverlayBelow};function d(n,q,j,r){if(q||window.event){new Event(q||window.event).preventDefault()}var p=n.hyphenate().split("-"),l=p.indexOf("h")>=0,i=p.indexOf("lb")>=0,g=p.indexOf("remote")>=0,o=p.indexOf("click")>=0,h=Object.merge({showCloseButton:true},r),m=null,k;switch(p.shift()){case"rel":m=e[p.shift().toLowerCase()];if(i){h.pinnable=ta.overlays.PINNABLE_ALWAYS}break;case"center":m=ta.overlays.CenteredOverlay;break}if(m===null){return null}if(l){h.activate=ta.overlays.ACTIVATE_HOVER}else{if(o){h.activate=ta.overlays.ACTIVATE_CLICK}}if(i){h.backdrop=ta.overlays.BACKDROP_ALWAYS}if(g){h.remoteContent=f(j)}k=new m(h,j);if(j){j.store("overlay",k)}return k}b=function(g){var m,q,j,l,n,o,h,k,i,p;m=g||window.event;if(!m){return}if(!m.origin||(0!==m.origin.indexOf("https"))||(-1===m.origin.indexOf("tripadvisor"))){return}if(!m.data||(-1===m.data.indexOf("action"))){return}try{q=JSON.parse(m.data)}catch(m){}j=q.hasOwnProperty("action")?q.action:null;if(!j){return}switch(j){case"successClose":ta.overlays.Factory.closeOverlayRegistration();k=ta.retrieve("overlay_registration_onsuccess");if(k&&"function"===typeof(k)){k();ta.remove("overlay_registration_onsuccess")}break;case"fwdToRegistration":l=q.hasOwnProperty("curUrl")?q.curUrl:null;n=q.hasOwnProperty("partnerKey")?q.partnerKey:null;o=q.hasOwnProperty("urlKey")?q.urlKey:null;h="/Register?product=MASTHEAD&flow=MASTHEAD&action=SIGNIN";if(l&&(0!==l.length)&&n&&(0!==n.length)&&o&&(0!==o.length)){h=h+"&url="+l+"&partnerKey="+n+"&urlKey="+o}window.location=ta.util.URL.https(h);break;case"resizeFrame":i=ta.id("overlayRegFrame");if(i){p=q.hasOwnProperty("height")?q.height:null;if(p){i.style.height=p+"px"}}break;default:return}};function a(){ta.store("member_gating_cta_shown",true)}function c(){return ta.retrieve("member_gating_cta_shown")}ta.overlays.Factory={_magic:d,relRightRemoteHLB:function(g,h){h=ta.id(h);if(h.get("tag")!="div"){h=h.getParent()}var i=f(h);if(i==null){return}new ta.overlays.RelativeOverlayRight({activate:ta.overlays.ACTIVATE_HOVER,pinnable:ta.overlays.PINNABLE_CLICK,backdrop:ta.overlays.BACKDROP_PINNED,style:"commerceOverlay rgba_flyout",showCloseButton:true},h)},relRightRemoteHLB_Commerce:function(i,g){if(i||window.event){new Event(i||window.event).preventDefault()}g=ta.id(g);var h=f(g);if(h==null){return}g.onmouseover=null;new ta.overlays.RelativeOverlayRight({activate:ta.overlays.ACTIVATE_CLICK,pinnable:ta.overlays.PINNABLE_ALWAYS,backdrop:ta.overlays.BACKDROP_ALWAYS,style:"commerceOverlay rgba_flyout",showCloseButton:true},g)},relBelowRemoteHLB_Commerce:function(i,g){g=ta.id(g);if(i||window.event){new Event(i||window.event).preventDefault()}var h=f(g);if(h==null){return}g.onclick=null;new ta.overlays.RelativeOverlayBelow({activate:ta.overlays.ACTIVATE_CLICK,pinnable:ta.overlays.PINNABLE_ALWAYS,backdrop:ta.overlays.BACKDROP_ALWAYS,style:"commerceOverlay rgba_flyout",showCloseButton:true},g)},relBelowRemoteHLB_CommCopy:function(i,g){g=ta.id(g);if(i||window.event){new Event(i||window.event).preventDefault()}var h=f(g);if(h==null){return}g.onclick=null;new ta.overlays.RelativeOverlayBelow({activate:ta.overlays.ACTIVATE_CLICK,pinnable:ta.overlays.PINNABLE_ALWAYS,backdrop:ta.overlays.BACKDROP_ALWAYS,style:"commerceOverlay rgba_flyout",showCloseButton:true,onLoad:function(){if(ta.meta&&ta.meta.update){ta.meta.update.updateCRForm("_pop")}else{ta.commerce.checkrates.updateCRForm("_pop")}}},g)},relBelowS4Dg:function(h,g){if(h){h.stop()}g.onclick=null;new ta.overlays.RelativeOverlayBelow({showCloseButton:true,style:"s4 dg",activate:ta.overlays.ACTIVATE_CLICK},g)},relBelowRGBA:function(k,h){if(k){k.stop()}var i="rgba_flyout";var j=true;var g="rgba_arrow";g=g+" rgba_arrow_png24";h.onclick=null;new ta.overlays.RelativeOverlayBelow({activate:ta.overlays.ACTIVATE_CLICK,style:i,showArrow:j,arrowClass:g,showCloseButton:true},h)},relAboveH_Disclaimer:function(h,g){g=ta.id(g);h.stop();g.onmouseover=null;new ta.overlays.RelativeOverlayAbove({showCloseButton:false,activate:ta.overlays.ACTIVATE_HOVER,pointArrowToSource:true,centered:true,showArrow:true,style:"typeLD",arrowClass:"ldarrow",arrowWidth:15,flipPadding:5,waitForCss:true,fontSize:".7em"},g)},relBelow_Disclaimer:function(h,g){g=ta.id(g);h.stop();g.onclick=null;new ta.overlays.RelativeOverlayBelow({showCloseButton:false,activate:ta.overlays.ACTIVATE_CLICK,pointArrowToSource:true,justify:"right",showArrow:true,style:"typeLD",arrowClass:"ldarrow",arrowWidth:20,yoffset:5,flipPadding:15,waitForCss:true,fontSize:".7em"},g)},relBelow_Disclaimer_left:function(h,g){g=ta.id(g);h.stop();g.onclick=null;new ta.overlays.RelativeOverlayBelow({showCloseButton:false,activate:ta.overlays.ACTIVATE_CLICK,pointArrowToSource:true,justify:"left",showArrow:true,style:"typeLD",arrowClass:"ldarrow",arrowWidth:20,yoffset:5,flipPadding:15,waitForCss:true,fontSize:".7em"},g)},relAboveH_PriceSaverRibbon:function(h,g){g=ta.id(g);h.stop();g.onmouseover=null;new ta.overlays.RelativeOverlayAbove({showCloseButton:false,activate:ta.overlays.ACTIVATE_HOVER,centered:true,showArrow:true,style:"typePS aboveRibbon",arrowClass:"ldarrow",arrowWidth:20,yoffset:5,flipPadding:15,waitForCss:true,fontSize:".7em"},g)},relBelowH_PriceSaverRibbon:function(h,g){g=ta.id(g);h.stop();g.onmouseover=null;new ta.overlays.RelativeOverlayBelow({showCloseButton:false,activate:ta.overlays.ACTIVATE_HOVER,centered:true,style:"typePS belowRibbon",yoffset:5,flipPadding:15,waitForCss:true,fontSize:".7em"},g)},relAboveH_PriceSaver:function(h,g){g=ta.id(g);h.stop();g.onmouseover=null;new ta.overlays.RelativeOverlayAbove({showCloseButton:false,activate:ta.overlays.ACTIVATE_HOVER,centered:true,showArrow:true,style:"typePS",arrowClass:"ldarrow",arrowWidth:20,yoffset:5,flipPadding:15,waitForCss:true,fontSize:".7em"},g)},relRight_SavingsAlert:function(i,h){h=ta.id(h);i.stop();h.onclick=null;var g={showCloseButton:false,activate:ta.overlays.ACTIVATE_CLICK,showArrow:true,arrowClass:"arrow",style:"typeSA",waitForCss:true,fontSize:".7em",allowBelowBottomEdge:true};if(ta.util.i18n.isRtl()){new ta.overlays.RelativeOverlayLeft(g,h)}else{new ta.overlays.RelativeOverlayRight(g,h)}},relRightH_SavingsAlert:function(k,h,j){h=ta.id(h);k.stop();h.onmouseover=null;var i="typeSA";if(j){i+=" ie8"}var g={showCloseButton:false,activate:ta.overlays.ACTIVATE_HOVER,showArrow:true,arrowClass:"arrow",style:i,waitForCss:true,fontSize:".7em",allowBelowBottomEdge:true};if(ta.util.i18n.isRtl()){new ta.overlays.RelativeOverlayLeft(g,h)}else{new ta.overlays.RelativeOverlayRight(g,h)}},relRightH_AddCartInfo:function(i,h){h=ta.id(h);i.stop();h.onmouseover=null;var g={showCloseButton:false,activate:ta.overlays.ACTIVATE_HOVER,showArrow:true,arrowClass:"arrow",style:"typeAC",waitForCss:true,fontSize:".8em",allowBelowBottomEdge:true};if(ta.util.i18n.isRtl()){new ta.overlays.RelativeOverlayLeft(g,h)}else{new ta.overlays.RelativeOverlayRight(g,h)}},relBelow:function(h,g){if(h){h.stop()}g.onclick=null;new ta.overlays.RelativeOverlayBelow({showCloseButton:true,activate:ta.overlays.ACTIVATE_CLICK},g)},relAbove:function(h,g){if(h){h.stop()}g.onclick=null;new ta.overlays.RelativeOverlayAbove({showCloseButton:true,activate:ta.overlays.ACTIVATE_CLICK},g)},relRight:function(h,g){if(h){h.stop()}g.onclick=null;new ta.overlays.RelativeOverlayRight({showCloseButton:true,activate:ta.overlays.ACTIVATE_CLICK},g)},relLeft:function(h,g){if(h){h.stop()}g.onclick=null;new ta.overlays.RelativeOverlayLeft({showCloseButton:true,activate:ta.overlays.ACTIVATE_CLICK},g)},relBelowH_Media:function(h,g){if(h){h.stop()}g.onmouseover=null;new ta.overlays.RelativeOverlayBelow({activate:ta.overlays.ACTIVATE_HOVER,style:"typeO mediaBox"},g)},relAboveH_Media:function(h,g){if(h){h.stop()}g.onmouseover=null;new ta.overlays.RelativeOverlayAbove({activate:ta.overlays.ACTIVATE_HOVER,style:"typeO mediaBox"},g)},relAboveH:function(h,g){g.onmouseover=null;new ta.overlays.RelativeOverlayAbove({activate:ta.overlays.ACTIVATE_HOVER},g)},relAboveTAMGFooter:function(i,g){g.onmouseover=null;var h=ta.id("PAGE");if(h){new ta.overlays.RelativeOverlayAbove({activate:ta.overlays.ACTIVATE_HOVER,style:"s3 vdg ovrFooter "+g.className},g)}},relRightH:function(h,g){g.onmouseover=null;new ta.overlays.RelativeOverlayRight({activate:ta.overlays.ACTIVATE_HOVER},g)},relLeftH:function(h,g){g.onmouseover=null;new ta.overlays.RelativeOverlayLeft({activate:ta.overlays.ACTIVATE_HOVER},g)},imageLightbox:function(j,g){g.onclick=null;var h="<div><img src="+g.getAttribute("href")+"></div>";var i=new ta.overlays.CenteredOverlay({showCloseButton:true,backdrop:ta.overlays.BACKDROP_ALWAYS}).loadRemoteSuccess(h);g.addEvent("click",i.show)},microMetaOverlay:function(t,j,n,i,q,v,k,u){try{j.onmouseover=null;j.onclick=null;if(t){t.stop()}var g="";if(ta.meta&&ta.meta.update){g=ta.meta.update.buildUrl("MicroMetaAjax",n,true,false,"QC_Meta_Micro|Button")}else{if(typeof(dd)!=="undefined"&&dd.commerce&&dd.commerce.checkrates){g=dd.commerce.checkrates.getMicroMetaUrl(t,n)}else{ta.util.error.record(null,"microMetaOverlay : no meta js");return}}g+="&lowContentID="+i;if(k){g+="&xSellPlacement="+k}var p=j.className.match(/noDelayFirst/);var s=j.className.match(/delayOpen/);var o=ta.retrieve("delayedFirst");var h=!s||(p&&!o);var l="Above Fold Also Viewed";if(ta.id(j).getParent("#prodp13n_single_category_recs_xsell")){l="prodp13n_single_category_recs_xsell"}else{if(ta.id(j).getParent("#similarHotelBetweenReview")){l="prodp13n_between_reviews_cross_sell"}else{if(ta.id(j).getParent("#MMXS_LIST")){l="State Opt Also Viewed"}else{if(ta.id(j).getParent("#HORIZONTAL_CROSS_SELL_LIST")){l="HorizXSell"}else{if(ta.id(j).getParent("#hotel_flyout")){l="Scooter"}else{if(ta.id(j).getParent("#HSCS_ROW")){l="prodp13n_hr_similar_xsell"}else{if(window.mapDivId&&ta.id(j).getParent("#"+window.mapDivId)){l="Maps"}}}}}}}if(l=="Scooter"){g+="&from="+l}var w={activate:(v)?ta.overlays.ACTIVATE_CLICK:ta.overlays.ACTIVATE_HOVER_DELAY,pinnable:(v)?ta.overlays.PINNABLE_CLICK_WITH_DOC_CLOSE:ta.overlays.PINNABLE_CLICK,backdrop:(v)?ta.overlays.BACKDROP_NEVER:ta.overlays.BACKDROP_PINNED,showCloseButton:!v,closeOnDocumentClick:v,positionByOffsets:false,positionType:"absolute",offsetTop:0,offsetRight:"",offsetBottom:"",offsetLeft:155};Object.merge(w,u);var m=new ta.overlays.RelativeOverlayBelow({style:"micro_meta_flyout gray",activate:w.activate,pinnable:w.pinnable,backdrop:w.backdrop,autoShow:h,delayShow:s,showCloseButton:w.showCloseButton,closeOnDocumentClick:w.closeOnDocumentClick,closeButtonClass:"roundOuterClose",onShow:function(){if(ta.util&&ta.util.element){ta.util.element.makeTextFitOneLine(".micro_meta_price_with_fee",true)}if(v){ta.trk("Meta_Micro_Providers_Displayed")}else{ta.trackEventOnPage("Meta_Micro_Providers_Displayed",l,q)}ta.overlays.Factory.logTrackingTree();if(w.onshow){w.onshow()}},onHide:w.onhide,positionByOffsets:w.positionByOffsets,positionType:w.positionType,offsetTop:w.offsetTop,offsetRight:w.offsetRight,offsetBottom:w.offsetBottom,offsetLeft:w.offsetLeft,trigger:j,onLoad:function(){window.fireEvent("MicroMetaHacComplete");if(w.onload){w.onload()}}},j);m.loadRemoteContent(g,false);ta.store("delayedFirst",true)}catch(r){ta.util.error.record(r,"micro meta overlay")}},microMetaExpandedSize:0,microMetaMore:function(l,m,h){try{var i=ta.id("micro_meta_remaining_"+m);if(!i){return}i.removeClass("hidden");function k(){var n=ta.id("micro_meta_more");if(!n){return}n.addClass("invisible")}if(h){k()}else{ta.meta.linkTracking.actionRecord("MICRO_META_EXPAND_MORE");if(i.getSize().y!=ta.overlays.Factory.microMetaExpandedSize){i.addClass("expanding");ta.overlays.Factory.microMetaExpandedSize=i.getSize().y;i.removeClass("expanding")}i.addClass("show");new Fx.Tween(i,{duration:"long",property:"height"}).start(0,ta.overlays.Factory.microMetaExpandedSize);window.setTimeout(k,1000);if(ta.retrieve("ibdm_impression_tracking")){var g=document.getElement(".micro_meta_first_block");if(g&&ta.meta&&ta.meta.treeTrack&&ta.meta.treeTrack.hasTrackingTree(g)){ta.trk("n_more_sites",false,g)}}}}catch(j){ta.util.error.record(j,"Micro meta expand failed.")}},isOverlayCreatedAlready:function(h,g){if(typeof g!="undefined"){var i=h.getElement(".overlaySrc");if(i){i.dispose();return false}else{return true}}return false},relRightRemoteHLB_optionalDelay_showArrow:function(s,q,w,v){try{q=ta.id(q);if(q.get("tag")!="div"){q=q.getParent()}var k=null;if(typeof w!="undefined"){k=w}if(null==k){k=f(q)}if(k==null&&ta.widgets.calendar.hasPageDates()){ta.widgets.calendar.clearCalendarFlyouts();k=f(q)}if(k==null){return}var r=q.getElement(".overlaySrc");var u=k.match(/-d(\d+)\?/);if(u){u=u[1]}if(ta.has("meta.session_dates")||ta.widgets.calendar.hasPageDates()){try{if(!ta.retrieve("date.picker.calendarflyout.allCleared")){ta.widgets.calendar.clearCalendarFlyouts()}if(s&&s.type=="mouseover"&&q){if(!q.hasClass("datedClickAdded")){q.addEvent("click",ta.overlays.Factory.relRightRemoteHLB_optionalDelay_showArrow.bind(this,null,q,k));q.addClass("datedClickAdded")}return}var n=ta.retrieve("scooterObj");if(n){n.slideOut()}if(u){ta.overlays.Factory.metaCheckRatesOverlay_allProviders(u,q)}return}catch(A){ta.util.error.record(A,"meta session dates parse issue")}}if(ta.overlays.Factory.isOverlayCreatedAlready(q,w)){return}var i=q.className.match(/noDelayFirst/),m=q.className.match(/delayOpen/),h=ta.retrieve("delayedFirst"),x=!m||(i&&!h),l="rgba_flyout",o=true,g="rgba_arrow",p="close",j;if(ta.has("hotels.redesignEnabled")&&(pageServlet==="Hotels"||pageServlet==="HACSearch")){l+=" gray";g="rgba_arrow_gray_lft_png24";p="roundOuterClose"}if(ta.has("daodao_noPop_single_cr_button")){l+=" no_cpu"}if(typeof(dhtml_cr_redesign_basic)!="undefined"&&!this.crDHTML_BASIC){this.crDHTML_BASIC=Asset.css(dhtml_cr_redesign_basic)}if(typeof(dhtml_cr_redesign_png24)!="undefined"&&!this.crDHTML_PNG24){this.crDHTML_PNG24=Asset.css(dhtml_cr_redesign_png24)}if(this.crDHTML_PNG24){j=g+" rgba_arrow_png24_right";g=g+" rgba_arrow_png24"}var y=ta.overlays.BACKDROP_PINNED;if(ta.has("daodao_ror_backdrop_type")){y=ta.retrieve("daodao_ror_backdrop_type")}var B=(m?ta.overlays.ACTIVATE_HOVER_DELAY:ta.overlays.ACTIVATE_HOVER);if(ta.retrieve("daodao_show_cr_flyout_only_on_click")){B=ta.overlays.ACTIVATE_CLICK}var t={};if(ta.meta&&ta.meta.update){t=ta.commerce.meta.getMetaParams()}var z=new ta.overlays.RelativeOverlayRight({activate:B,pinnable:ta.overlays.PINNABLE_CLICK,backdrop:y,style:l,showArrow:o,arrowClass:g,arrowClassLeft:g,arrowClassRight:j,closeButtonClass:p,showCloseButton:true,autoShow:x,delayShow:!x,smartCloseButton:ta.isMetaHotels2013(),remoteLink:w,requestData:t,onLoad:function(){if(u&&v){var C=this.inner.getElementById("CHECK_RATE_FLYOUT");if(C){var D=C.get("onclick");C.set("onclick",v+";"+D)}}if(!ta.has("metaDatePickerEnabled")){if(ta.meta&&ta.meta.update){ta.meta.update.updateCRForm("_pop")}else{ta.commerce.checkrates.updateCRForm("_pop")}}},onShow:function(){if(ta.has("metaDatePickerEnabled")){ta.widgets.calendar.syncAllDatePickers()}else{if(ta.meta&&ta.meta.update){ta.meta.update.updateCRForm("_pop")}else{ta.commerce.checkrates.updateCRForm("_pop");ta.commerce.checkrates.checkCRLimitsHelper(z)}}if(ta.retrieve("meta_guests_field_v2.enabled")){ta.commerce.meta.updateAdultsText()}ta.store("ta.hlb_el",q)},onHide:function(){ta.widgets.calendar.closeCalendarWidgets();if(ta.retrieve("meta_guests_field_v2.enabled")){ta.commerce.meta.disableAdultsPicker(this)}ta.store("ta.hlb_el",null)}},q);ta.store("delayedFirst",true);ta.widgets.calendar.trackCalendarFlyout(q,z,r)}catch(A){ta.util.error.record(A,"relRightRemoteHLB_optionalDelay_showArrow: Factory")}},relLeftRemoteHLB_optionalDelay_helper:function(u,i,q,v){try{i=ta.id(i);if(i.get("tag")!="div"){i=i.getParent()}var j=null;if(typeof v!="undefined"){j=v}if(null==j){j=f(i)}if(j==null&&ta.widgets.calendar.hasPageDates()){ta.widgets.calendar.clearCalendarFlyouts();j=f(i)}if(j==null){return}var t=i.getElement(".overlaySrc");var n=j.match(/-d(\d+)\?/);if(n){n=n[1]}if(ta.has("meta.session_dates")||ta.widgets.calendar.hasPageDates()){try{if(!ta.retrieve("date.picker.calendarflyout.allCleared")){ta.widgets.calendar.clearCalendarFlyouts()}if(u&&u.type=="mouseover"){if(!i.hasClass("datedClickAdded")){i.addEvent("click",ta.overlays.Factory.relLeftRemoteHLB_optionalDelay_helper.bind(this,null,i,q,j));i.addClass("datedClickAdded")}return}var h=ta.retrieve("scooterObj");if(h){h.slideOut()}if(n){ta.overlays.Factory.metaCheckRatesOverlay_allProviders(n,i)}return}catch(r){ta.util.error.record(r,"meta session dates parse issue")}}if(ta.overlays.Factory.isOverlayCreatedAlready(i,v)){return}var p=i.className.match(/noDelayFirst/);var s=i.className.match(/delayOpen/);var o=ta.retrieve("delayedFirst");var g=!s||(p&&!o);var l=ta.has("daodao_ror_backdrop_type")?ta.retrieve("daodao_ror_backdrop_type"):ta.overlays.BACKDROP_PINNED;var k=(s?ta.overlays.ACTIVATE_HOVER_DELAY:ta.overlays.ACTIVATE_HOVER);if(ta.retrieve("daodao_show_cr_flyout_only_on_click")){k=ta.overlays.ACTIVATE_CLICK}var m=new ta.overlays.RelativeOverlayLeft({activate:k,pinnable:ta.overlays.PINNABLE_CLICK,backdrop:l,style:"rgba_flyout gray",showArrow:q,arrowClass:"rgba_arrow_gray_rgt_png24",arrowClassLeft:"rgba_arrow_gray_lft_png24",showCloseButton:true,closeButtonClass:"roundOuterClose",autoShow:g,delayShow:!g,smartCloseButton:ta.isMetaHotels2013(),remoteLink:v,onLoad:function(){if(!ta.has("metaDatePickerEnabled")){if(ta.meta&&ta.meta.update){ta.meta.update.updateCRForm("_pop")}else{ta.commerce.checkrates.updateCRForm("_pop")}}},onShow:function(){ta.store("overlay.lastElmt.className",i.className);if(ta.has("metaDatePickerEnabled")){ta.widgets.calendar.syncAllDatePickers()}else{if(ta.meta&&ta.meta.update){ta.meta.update.updateCRForm("_pop")}else{ta.commerce.checkrates.updateCRForm("_pop");ta.commerce.checkrates.checkCRLimitsHelper(m)}}if(ta.retrieve("meta_guests_field_v2.enabled")){ta.commerce.meta.updateAdultsText()}},onHide:function(){ta.widgets.calendar.closeCalendarWidgets();if(ta.retrieve("meta_guests_field_v2.enabled")){ta.commerce.meta.disableAdultsPicker(this)}}},i);ta.store("delayedFirst",true);ta.widgets.calendar.trackCalendarFlyout(i,m,t)}catch(r){ta.util.error.record(r,"relLeftRemoteHLB_optionalDelay_showArrow: Factory")}},relLeftRemoteHLB_optionalDelay_showArrow:function(h,i,g){ta.overlays.Factory.relLeftRemoteHLB_optionalDelay_helper(h,i,true,g)},hotelsMapCROverlay:function(h,i,g){ta.overlays.Factory.relLeftRemoteHLB_optionalDelay_helper(h,i,false,g)},fbFriendOverlay:function(g){g.onclick=null;new ta.overlays.RelativeOverlayBelow({activate:ta.overlays.ACTIVATE_CLICK,showCloseButton:true,style:"s2 mg"},g)},albumsLB:function(t,r,w,y,s,E,D,F,o,g,p){if(t||window.event){new Event(t||window.event).preventDefault()}if(ta.has("oyster_location_data")){ta.trackEventOnPage("OysterPhotoImpact","lightboxWouldHaveOysterPhotos",ta.retrieve("oyster_location_data").hasOyster[w])}r=ta.id(r);var q=ta.util.sessionStorage.canUseSessionStore();try{var i="";var n="/LocationPhotoAlbum?";if(!y||!w){ta.util.error.record(null,"LocationPhotoAlbum request missing arguments",null,{geoId:y,locId:w});return}var u={detail:w,geo:y};if(F){u.showProPhotos=true}if(typeof o!=="undefined"){u.defaultToOysterTab=o}if(s){u.filter=s}if(E){u.ff=E;u.albumid=101;u.albumViewMode="hero";u.albumPartialsToUpdate="full";u.thumbnailMinWidth=50;u.cnt=30;u.offset=-5;u.baseMediaId=E;u.extraAlbumCoverCount=2}if(D){u.albumid=D;u.albumViewMode="images";u.albumPartialsToUpdate="full";u.extraAlbumCoverCount=4}if(p){u.lbShowRac=true}i="QC_Meta_Mini|Photo_Lightbox";u.area=i;if(ta.meta&&ta.meta.update&&window.pageServlet){Object.merge(u,ta.commerce.meta.getMetaParams())}n=n+Object.toQueryString(u);var x=n;try{n=ta.commerce.meta.tracking.updateUrlWithTiming(n,i)}catch(B){ta.util.error.record(B,"problem updating url with timing in Factory.photosLB");n=x}function m(){if(ta.photos.albumViewer){ta.photos.albumViewer.onResize(z)}if(g&&g.onResize){g.onResize()}}function h(){ta.store("photo.viewer.albumsLB",z);ta.photos.albumViewer.onResize(z);ta.photos.albumViewer.init(y,w,ta.retrieve("album.mediaId"),ta.retrieve("album.tracking"),ta.retrieve("album.view"),ta.retrieve("album.showTabCat"),ta.retrieve("album.showProPhotos"));ta.photos.albumViewer.tracking.recordImpressionIfDmo();if(q){window.sessionStorage.isAlbumViewerLbOpen=true}this.position();window.addEvent("resize",m);if(ta.isTabletAlbumViewer()&&ta.photos&&ta.photos.albumViewer){window.addEvent("orientationchange",ta.photos.albumViewer.onOrientationChange)}m();if(ta.photos.albumViewer){ta.photos.albumViewer.resetNumHeroPhotosClicked()}var H=ta.id("meta_on_photo_viewer");if(H){window.fireEvent("photoLightBoxLoad",H)}ta.store("locationPhotoAlbumOverlayResizeHack",function(){var M=document.getElement(".overlay.metaCheckRatesOverlay");if(!M){return}var I=document.getElement(".overlay.metaCheckRatesOverlay #overlayInnerDiv");var J=parseInt(M.getStyle("top").replace("px",""),10)-window.getScrollTop();var L=window.getSize().y;var K=L-(J+90);if(!I){return}I.setStyle("overflow","auto");I.setStyle("max-height",K+"px")});if(this.inner){setTimeout(ta.fireEvent.bind(this,"refreshedDOMContent",this.inner),50)}if(g&&g.onLoad){g.onLoad()}var G=ta.retrieve("oyster_location_data");if(G&&G.hasOyster&&G.hasOyster[w]){ta.run("ta.photos.oysterTracking.trackCandidateSession",null,null,null,"LB_OPEN")}else{if(!G||!G.hasOyster||!(w in G.hasOyster)){ta.util.error.record(null,"no oyster data for this location",null,{locationId:w},"WARN")}}}var A="";function v(){if(ta.retrieve("checkrates.meta_ui_post_click_prices")&&ta.retrieve("meta.baseLocationId")){ta.commerce.meta.updateProvAreaFromLightBox(ta.retrieve("meta.baseLocationId"))}if(q){window.sessionStorage.isAlbumViewerLbOpen=true}if(g&&g.onShow){g.onShow()}if(ta.isTabletAlbumViewer()){document.body.addClass("stop-scrolling");if(ta.retrieve("tabletRacOnPhotoViewer")){ta.remove("RASCalendar");if(ta.restaurantAvailabilitySearch){A=ta.restaurantAvailabilitySearch.getContainerSelector()}}}}function l(){if(ta.isTabletAlbumViewer()){document.body.removeClass("stop-scrolling")}var G=ta.retrieve("metaCheckRatesOverlay");if(G){G.hide();ta.remove("metaCheckRatesOverlay")}z.hide();if(q){window.sessionStorage.removeItem("isAlbumViewerLbOpen")}ta.photos.albumViewer.tracking.recordTimeInLB();ta.photos.albumViewer.saveVisitedAlbumsToSession();ta.meta.linkTracking.restoreCRPageServlet();document.removeEvent("keydown",ta.remove("photo.viewer.keydownListener"));if(ta.retrieve("photo.viewer.refreshOnClose")){window.location=window.location}if(ta.has("translationOverlay")){ta.retrieve("translationOverlay").hide()}if(ta.retrieve("hotels.redesignEnabled")&&ta.retrieve("hotels.datesChanged")&&ta.isMetaHotelsRequest&&ta.isMetaHotelsRequest()){ta.commerce.minimeta.doMetaDateSearch();ta.remove("hotels.datesChanged")}else{if(ta.retrieve("hotels.redesignEnabled")&&ta.retrieve("hotels.datesChanged")){ta.commerce.minimeta.ajax.resetAjaxCall();ta.commerce.minimeta.ajax.send(false,true);ta.remove("hotels.datesChanged")}}ta.widgets.calendar.closeCalendarWidgets();window.removeEvent("resize",m);if(ta.isTabletAlbumViewer()){if(ta.photos&&ta.photos.albumViewer){window.removeEvent("orientationchange",ta.photos.albumViewer.onOrientationChange)}if(ta.retrieve("tabletRacOnPhotoViewer")){ta.remove("RASCalendar");if(ta.restaurantAvailabilitySearch){ta.restaurantAvailabilitySearch.setContainerSelector(A)}}}ta.remove("locationPhotoAlbumOverlayResizeHack");if(g&&g.onHide){g.onHide()}if(ta.isTabletAlbumViewerCTA()&&ta.photos.tabletAlbumViewer){ta.photos.tabletAlbumViewer.removeAlbumViewerCTAEvents()}window.fireEvent("photoLightBoxHidden")}function k(){if(g&&g.onClose){g.onClose()}ta.remove("meta.requestFromArea");document.removeEvent("keyup",ta.retrieve("photo.viewer.albumsLB.keyupPhotoChangeHandle"));ta.overlays.Factory.albumsLBHandleHashLocation();if(ta.retrieve("tabletAlbumPhotolbSwiping.enabled")){window.removeEvent("orientationchange",ta.photos.tabletAlbumViewer.updateHiddenHeroPhotos)}}var z;ta.overlays.Factory._albumsLBLoadAssets();var C=1;function j(){if(C>16){C=1;try{(function(){z.hide()}).delay(2000,this)}catch(I){}}else{if(!ta.retrieve("album.viewer_extended.jsAssetsLoaded")){C++;j.delay(500)}else{var H=ta.isTabletAlbumViewer()?0:20;var G={backdrop:ta.overlays.BACKDROP_ALWAYS,style:"s3 dg albumLightbox",backdropClickClose:true,noScrollY:false,innerDivClass:"inner",content:'<div class="js_footerPocket"></div>',onLoad:h,onShow:v,onHide:l,backdropOpacity:0.6,permanent:true,onClose:k,requestData:{heroMinWidth:window.getSize().x-H*2,heroMinHeight:window.getSize().y-H*2}};z=new ta.overlays.FooterPocketWithInsertOverlay(G,null,H);z.loadRemoteContent(n);ta.commerce.meta.tracking.resetTimingLockForNavArea(i);C=1}}}j()}catch(B){ta.util.error.record(B,"photo gallery overlay",null,{photoUrl:n});ta.commerce.meta.tracking.resetTimingLockForNavArea(i)}return false},addAlbumsLBHashHandler:function(){if(this._isHistorySupported()&&!ta.isTabletAlbumViewer()){var g={state:true};history.pushState(g,"title","#photos");window.onpopstate=function(){ta.overlays.Factory.albumsLBHandleHashLocation()}}},albumsLBHandleHashLocation:function(){if(this._isHistorySupported()&&!ta.isTabletAlbumViewer()){var h=ta.retrieve("photo.viewer.albumsLB");var g=ta.retrieve("albumsLBAutoOpen");ta.store("albumsLBAutoOpen",false);if(window.sessionStorage.isAlbumViewerLbOpen&&window.location.hash=="#photos"&&h&&!g){window.history.back()}else{if(window.sessionStorage.isAlbumViewerLbOpen&&window.location.hash==""&&h){h.hide()}}}},_isHistorySupported:function(){return !!(window.history&&window.history.pushState)},photosLB:function(g,k){try{if(g||window.event){new Event(g||window.event).preventDefault()}k=ta.id(k);if(k.get("tag")!="a"){if(k.hasClass("fkASDF")&&(k.get("tag")=="span"||k.get("tag")=="div"||k.get("tag")=="li")){k=ta.id(k)}else{k=k.getParent("a")}}var j="";if(k.className){j=k.className.match(/u_([^ ]*)/)[1]}else{if(k.href.match(/\/?LocationPhoto.*/)){j=k.href}}ta.overlays.Factory._mediaLBLoadAssets();var h="QC_Meta_Mini";if(ta.has("photo.viewer.jsAssetsLoaded")){j=j.replace(/\/LocationPhotos\-/,"/LocationPhotosLightbox-");j=j.replace(/\/LocationPhotoDirectLink\-/,"/LocationPhotosLightbox-");j=j.replace(/\#/,"?ff=");if(screen.availHeight<768||screen.availWidth<1024){if(j.match(/\?/)){j=j+"&small=true"}else{j=j+"?small=true"}}j=j+"&area="+h;var l=j;try{j=ta.commerce.meta.tracking.updateUrlWithTiming(j,h)}catch(m){ta.util.error.record(m,"problem updating url with timing in Factory.photosLB");j=l}if(ta.meta&&ta.meta.update&&window.pageServlet){j=j+"&metaReferer="+window.pageServlet}var i=ta.overlays.Factory._mediaLBCreateOverlay(ta.overlays.Factory.photoLBHelper,k);i.loadRemoteContent(j);ta.store("photo.viewer.lightbox",i);ta.commerce.meta.tracking.resetTimingLockForNavArea(h)}else{ta.util.error.record(null,"photo gallery - no assets to load");ta.overlays.Factory.viewerFallback.delay(2000,this,[null,k])}}catch(m){ta.util.error.record(m,"photo gallery overlay",null,{photoUrl:j});ta.commerce.meta.tracking.resetTimingLockForNavArea(h)}return false},viewerFallback:function(h){var g=ta.remove("photo.viewer.lightbox");if(g){g.hide()}if(h&&h.href&&h.href.match(/LocationPhotos/)){window.location=h.href}else{return ta.servlet.Popup.photoGallery(null,h)}},photoLBCounter:1,photoLBHelper:function(h){var g=ta.retrieve("photo.viewer.initData");if(ta.overlays.Factory.photoLBCounter>16){ta.overlays.Factory.photoLBCounter=1;try{ta.overlays.Factory.viewerFallback.delay(2000,this,h)}catch(i){}return}if(!g||!ta.photos.viewer){ta.overlays.Factory.photoLBCounter++;ta.overlays.Factory.photoLBHelper.delay(500)}else{ta.overlays.Factory.photoLBCounter=1;if(ta.retrieve("ta.photos.viewer.initializeOnSecondTab")){ta.store("photo.viewer.secondaryView",true);ta.photos.viewer.photoViewerInit(ta.retrieve("photo.viewer.secondaryViewer.data"))}else{ta.photos.viewer.photoViewerInit(g)}}},mediaLBAutoOpen:function(h){try{ta.overlays.Factory._mediaLBLoadAssets();if(!ta.has("photo.viewer.jsAssetsLoaded")){ta.util.error.record(null,"auto-open media lightbox - no assets to load")}else{h=h.replace(/\/LocationPhotos\-/,"/LocationPhotosLightbox-");h=h.replace(/\/LocationPhotoDirectLink\-/,"/LocationPhotosLightbox-");h=h.replace(/\#/,"?ff=");if(screen.availHeight<768||screen.availWidth<1024){if(h.match(/\?/)){h=h+"&small=true"}else{h=h+"?small=true"}}var g=ta.overlays.Factory._mediaLBCreateOverlay(ta.overlays.Factory.mediaLBAutoOpenHelper,h);g.loadRemoteContent(h);ta.store("photo.viewer.lightbox",g)}}catch(i){ta.util.error.record(i,"ta.overlays.factory.autoOpenMediaLB failed",null,{photoUrl:h})}return false},mediaLBAutoOpenHelper:function(i){var g=ta.retrieve("photo.viewer.initData");var h=16;if(ta.overlays.Factory.photoLBCounter>h){ta.overlays.Factory.photoLBCounter=1;ta.util.error.record(null,"ta.overlays.factory.autoOpenMediaLBHelper is giving up after "+h+" attempts.",null,{photoUrl:i});return}if(!g||!ta.photos.viewer){ta.overlays.Factory.photoLBCounter++;ta.overlays.Factory.mediaLBAutoOpenHelper.delay(500,this,i)}else{ta.overlays.Factory.photoLBCounter=1;ta.photos.viewer.photoViewerInit(g)}},_mediaLBLoadAssets:function(){if(!ta.has("photo.viewer.jsAssetsLoaded")&&typeof cssPhotoViewerAsset!="undefined"&&typeof jsPhotoViewerAsset!="undefined"){ta.store("photo.viewer.jsAssetsLoaded",true);Asset.css(cssPhotoViewerAsset,{media:"screen, print"});if(!ta.photos.viewer){Asset.javascript(jsPhotoViewerAsset)}if(typeof TALSO=="undefined"){Asset.javascript(jsPhotoViewerTALSOAsset)}if(typeof jsPhotosAsset!="undefined"&&!ta.servlet.Photos){Asset.javascript(jsPhotosAsset)}if(!ta.media.JWPlayer){Asset.javascript(jsJWPlayerHelperAsset)}}},_albumsLBLoadAssets:function(){if(!ta.has("album.viewer_extended.jsAssetsLoaded")){if(!ta.has("album.viewer.cssAssetsLoaded")&&window.cssAlbumViewerAsset){Asset.css(cssAlbumViewerAsset,{media:"screen, print"});if(ta.isTabletAlbumViewer()&&getCssAlbumPhotoLBIconAsset){var g=getCssAlbumPhotoLBIconAsset();if(g){Asset.css(g,{media:"screen, print"})}}ta.store("album.viewer.cssAssetsLoaded",true)}if(typeof cssAlbumViewerAssetHotels!="undefined"){Asset.css(cssAlbumViewerAssetHotels,{media:"screen, print"})}if(typeof jsAlbumViewerExtendedAsset!="undefined"&&!ta.retrieve("album.viewer_extended.jsAssetsLoaded")){Asset.javascript(jsAlbumViewerExtendedAsset,{onLoad:function(){ta.store("album.viewer_extended.jsAssetsLoaded",true)}})}}},_mediaLBCreateOverlay:function(h,j){var i={backdrop:ta.overlays.BACKDROP_ALWAYS,style:"s3 dg",backdropClickClose:true,onLoad:function(){this.position();if(h){h(j)}},onHide:function(){var k=ta.remove("photo.viewer.lightbox");if(k){k.hide()}ta.meta.linkTracking.restoreCRPageServlet();document.removeEvent("keydown",ta.remove("photo.viewer.keydownListener"));if(ta.retrieve("photo.viewer.refreshOnClose")){window.location=window.location}if(ta.has("translationOverlay")){ta.retrieve("translationOverlay").hide()}if(ta.retrieve("hotels.datesChanged")&&(ta.has("meta.mini_meta_on_accommodations")||(ta.retrieve("hotels.redesignEnabled")&&ta.isMetaHotelsRequest&&ta.isMetaHotelsRequest()))){ta.commerce.minimeta.doMetaDateSearch();ta.remove("hotels.datesChanged")}else{if(ta.retrieve("hotels.redesignEnabled")&&ta.retrieve("hotels.datesChanged")){ta.commerce.minimeta.ajax.resetAjaxCall();ta.commerce.minimeta.ajax.send(false,true);ta.remove("hotels.datesChanged")}}ta.widgets.calendar.closeCalendarWidgets()},permanent:true};if(ta.retrieve("checkrates.meta_ui_post_click_prices")){i.onShow=function(){var k=ta.retrieve("meta.baseLocationId");if(k){ta.commerce.meta.updateProvAreaFromLightBox(k)}}}var g=new ta.overlays.CenteredOverlay(i);return g},AccDetail:function(m,j,g){if(m){m.stop()}j=j.getParent();var l=location.pathname;if(l.length>0){if(l.charAt(0)=="/"){l=l.substring(1)}var k=l.indexOf("-");if(k>=0){l=l.substring(0,k)}}var i=g;var h=function(){var n=ta.id("overlay_description").get("text");if(n.length>1000){ta.id("overlay_description").setStyle("height",210)}};if(memoverlayCSS&&!ta.retrieve("ta.memoverlayCSS")){ta.store("ta.memoverlayCSS",new Asset.css(memoverlayCSS))}new ta.overlays.CoverOverlay({yOff:35,onLoad:h,style:"s3 dg rgba_gry",activate:ta.overlays.ACTIVATE_HOVER_DELAY,pinnable:ta.overlays.PINNABLE_CLICK,showCloseButton:true,delayShow:true,requestData:{d:i,tab:"descript",from:l},remoteContent:"/LocationTab"},j);return false},memberOverlay:function(i,h,g){ta.overlays.Factory.memberOverlayWOffset(i,h,g,0,0);return false},memberOverlayWOffset:function(w,k,u,s,t){if(w){w.stop()}k.onclick=null;k.onmouseover=null;var r="";var g="";var o="";var p=false;var j=false;var h=true;var q="rgba_arrow_png24";if(k.id&&k.id!=""){var m=k.id.split("-");for(var n=0;n<m.length;n++){var l=m[n];if(l.match(/\bUID_([0-9A-F]+)\b/)){r=RegExp.$1}else{if(l.match(/\bSRC_(\d+)\b/)){g=RegExp.$1}else{if(l.match(/\bCATID_(\d+)\b/)){o=RegExp.$1}else{if(l.match("FUS")){p=true}else{if(l.match("PATT")){j=true}}}}}}}else{ta.util.error.record(null,"memberOverlay - elmt.id check",null,{passedElement:ta.util.error.getSelectorString(k)})}var v="";if(typeof(footprintGet)!="undefined"){v=footprintGet()}if(memoverlayCSS&&!ta.retrieve("ta.memoverlayCSS")){ta.store("ta.memoverlayCSS",new Asset.css(memoverlayCSS))}new ta.overlays.RelativeOverlayRight({style:u||"typeO",activate:ta.overlays.ACTIVATE_HOVER_DELAY,pinnable:ta.overlays.PINNABLE_CLICK,showArrow:h,arrowClass:q,showCloseButton:true,autoShow:false,delayShow:true,offsetRight:t,offsetTop:s,remoteContent:"/MemberOverlay?uid="+r+"&c="+o+"&src="+g+"&fus="+p+"&partner="+j+"&LsoId="+v},k);return false},memberOverlayBelow:function(w,k,u,s,t){if(w){w.stop()}k.onclick=null;k.onmouseover=null;var r="";var g="";var o="";var p=false;var j=false;var h=true;var q="rgba_arrow_up_png24";if(k.id&&k.id!=""){var m=k.id.split("-");for(var n=0;n<m.length;n++){var l=m[n];if(l.match(/\bUID_([0-9A-F]+)\b/)){r=RegExp.$1}else{if(l.match(/\bSRC_(\d+)\b/)){g=RegExp.$1}else{if(l.match(/\bCATID_(\d+)\b/)){o=RegExp.$1}else{if(l.match("FUS")){p=true}else{if(l.match("PATT")){j=true}}}}}}}else{ta.util.error.record(null,"memberOverlay - elmt.id check",null,{passedElement:ta.util.error.getSelectorString(k)})}var v="";if(typeof(footprintGet)!="undefined"){v=footprintGet()}if(memoverlayCSS&&!ta.retrieve("ta.memoverlayCSS")){ta.store("ta.memoverlayCSS",new Asset.css(memoverlayCSS))}new ta.overlays.RelativeOverlayBelow({style:u||"typeO",activate:ta.overlays.ACTIVATE_HOVER_DELAY,pinnable:ta.overlays.PINNABLE_CLICK,showArrow:h,arrowClass:q,allowFlip:false,showCloseButton:true,autoShow:false,delayShow:true,offsetRight:t,offsetTop:s,remoteContent:"/MemberOverlay?uid="+r+"&c="+o+"&src="+g+"&fus="+p+"&partner="+j+"&LsoId="+v},k);return false},dropdownMiniMetaOverlayHotel:function(g,i,o,k){var n="hotel_"+k;var j=ta.id(n);if(j){var l=j.getElement(".chevron");if(l){i=l}var m=j.getElement(".dropdownMiniMeta");if(m){m=m.clone();m.set("class","dropdownMiniMeta");var h={offsetLeft:260,trigger:i};if(ta.util.i18n.isRtl()){h={offsetLeft:4}}ta.store("meta.dropdownHotelsActive",n);ta.overlays.Factory.dropdownMiniMetaOverlay(g,i,o,m,h)}}},dropdownMiniMetaOverlayHotelReview:function(h,g,l,k){var m=document.getElement(".skv3 .dropdownMiniMeta");if(!m){m=document.getElement(".dropdownMiniMeta")}if(!m){ta.trackEventOnPage("LP_Chevron_Dropdown_No_Data","0");var j=document.getElement(".LowestPrice.minOffer");if(j){j.click();return false}}m=m.clone();m.set("class","dropdownMiniMeta");if(!k){k=22}var i={offsetLeft:k};ta.overlays.Factory.dropdownMiniMetaOverlay(h,g,l,m,i)},dropdownMiniMetaOverlay:function(h,g,j,k,i){if(dropdownMetaCSS&&!ta.retrieve("ta.dropdownMetaCSS")){ta.store("ta.dropdownMetaCSS",new Asset.css(dropdownMetaCSS))}if(h){h.stop()}if(k){ta.overlays.Factory.createDropdownMiniMetaOverlay(h,g,j,k,i);ta.store("pcr.disabled",true);return true}return false},loadDropdownCSS:function(){if(window.dropdownMetaCSS&&!ta.retrieve("ta.dropdownMetaCSS")){ta.store("ta.dropdownMetaCSS",new Asset.css(dropdownMetaCSS))}},createDropdownMiniMetaOverlay:function(g,k,o,n,i){var h="rgba_flyout gray dropdownMiniMeta";var m=true;var j=-5;switch(ta.commerce.meta.getNavAreaContextFromDom(k)){case"PCR":m=false;h+=" pcrLightBox";j=-45;break;case"Photo_Lightbox":m=false;h+=" photoAmenitiesLightBox";break;case"Amenities_Lightbox":m=false;break;default:h+=" miniMetaLightBox"}var l=0;if(i){if(i.offsetLeft){l=i.offsetLeft}if(i.offsetTop){j=i.offsetTop}}new ta.overlays.RelativeOverlayBelow(Object.merge(i,{style:h,activate:ta.overlays.ACTIVATE_CLICK,pinnable:ta.overlays.PINNABLE_CLICK,showArrow:m,showCloseButton:o,closeButtonClass:"roundOuterClose",arrowClass:"rgba_gray_arrow_up",offsetTop:j,offsetLeft:l,allowFlip:false,closeOnDocumentClick:true,content:n}),k)},createFacebookCTACallout:function(n,h,m,l,j,i){try{h.removePropertyEvent("mouseover","ta.overlays.Factory.createFacebookCTACallout")}catch(k){h.onmouseover=function(){}}var o=(Browser.ie7||Browser.ie8)?" ie78":"";var g={activate:ta.overlays.ACTIVATE_HOVER_DELAY,style:"s4 dg rgba_gry update2012 facebookCTAFlyout"+o,showArrow:true,centered:true,pointArrowToSource:true,showCloseButton:false,delayShow:true,innerDivClass:"inner",hoverDelayTime:0,noPadding:true,content:"<div class='onsite_cta_overlay_content'><b>"+m+"</b><br />"+j+"<br /><br /><b>"+l+"</b><br />"+i+"</div>"};new ta.overlays.RelativeOverlayBelow(g,h)},tcNavDetailOverlay:function(i,h,g){if(i){i.stop()}new ta.overlays.RelativeOverlayBelow({style:g||"typeO",activate:ta.overlays.ACTIVATE_CLICK,pinnable:ta.overlays.PINNABLE_NEVER,showArrow:true,arrowClass:"rgba_arrow_png24",showCloseButton:true,content:ta.id("INLINE_NAV_DETAIL").innerHTML},h);return false},amexHotSpotOverlay:function(l,k,g,h,j){if(l){l.stop()}var i;if(ta.has(j)){i=ta.retrieve(j);i.inner.setContent(ta.id(h).innerHTML);i.show()}else{i=new ta.overlays.RelativeOverlayBelow({style:g,activate:ta.overlays.ACTIVATE_CLICK,pinnable:ta.overlays.PINNABLE_NEVER,showArrow:true,arrowClass:"rgba_arrow_png24",showCloseButton:false,content:ta.id(h).innerHTML},k);ta.store(j,i)}return false},amexSettingsOverlay:function(n,l,g,h,j,k,m){if(n){n.stop()}var i;if(ta.has(j)){i=ta.retrieve(j);i.inner.setContent(ta.id(h).innerHTML);i.show()}else{i=new ta.overlays.RelativeOverlayBelow({style:g,activate:ta.overlays.ACTIVATE_CLICK,pinnable:ta.overlays.PINNABLE_NEVER,showArrow:true,arrowClass:"rgba_arrow_png24",showCloseButton:false,content:ta.id(h).innerHTML,offsetLeft:k,offsetTop:m,allowFlip:false},l);ta.store(j,i)}return false},menuBLimps:function(h,g){var l=$(h);if(l){if(!l.getAttribute("blimped")){var k=l.getChildren();if(k){for(var j=0;j<k.length;j++){var m=k[j].getAttribute("data-imp");if(m){ta.t4b.bl_imp_tracking.queueImpression(m,g)}}ta.t4b.bl_imp_tracking.flushImpressions();l.setAttribute("blimped",true)}}}},mcNavOverlay:function(o,h,n,m,g,p,k,j,l){var i;if(o){o.stop()}if(ta.has(g)){i=ta.retrieve(g);i.inner.setContent(ta.id(m).innerHTML);i.show()}else{if(!(ta.util.i18n.isRtl()^j)){i=new ta.overlays.RelativeOverlayLeft({style:n,activate:ta.overlays.ACTIVATE_BOTH,pinnable:ta.overlays.PINNABLE_NEVER,showArrow:true,arrowClass:"rgba_arrow_png24",showCloseButton:false,hoverDelayTime:250,content:ta.id(m).innerHTML,offsetLeft:-p,offsetTop:k,allowFlip:false,showFunction:function(){ta.overlays.Factory.menuBLimps(m,l)}},h);ta.store(g,i)}else{i=new ta.overlays.RelativeOverlayRight({style:n,activate:ta.overlays.ACTIVATE_BOTH,pinnable:ta.overlays.PINNABLE_NEVER,showArrow:true,arrowClass:"rgba_arrow_png24",showCloseButton:false,hoverDelayTime:250,content:ta.id(m).innerHTML,offsetRight:p,offsetTop:k,allowFlip:false,showFunction:function(){ta.overlays.Factory.menuBLimps(m,l)}},h);ta.store(g,i)}}return false},createPairedCalendar:function(i,h,g){return ta.overlays.createPairedCalendar(i,h,g)},createPairedCalendarGeo:function(){},_injectAd:function(g){if(ta.has("ads.gptEnabled")){return}var h=ta.id(g);try{if(h){injectAdsTargeted(h)}}catch(i){ta.util.error.record(i,"AlsoViewedLB: error injecting ad into elemId="+g)}},createDatedPairedCalendar:function(j,h,g){if(!g){g={}}if(j){new Event(j).preventDefault()}h=ta.id(h);var i=h.getParent("form");g.validate=true;g.overlayOptions={onShow:function(){ta.overlays.toggleOffSearchAll(i)}};new ta.overlays.PairedCalendar(h,g);ta.overlays.toggleOffSearchAll(i)},recordVRCrossSell:function(){try{var h=ta.id("VR_CROSS_SELL");if(h){var g=h.innerHTML.indexOf("setPID");var j=h.innerHTML.substr(g+7,5);new Request({url:"/ActionRecord?action=VR_CROSS_SELL_"+j}).send()}}catch(i){ta.util.error.record(i,"VR Cross Sell - ActionRecord failed")}},launchAVLBCompleteFn:function(h){ta.overlays.Factory._loadAVCSS();var g=function(){ta.overlays.Factory._injectAd("ALSO_VIEWED_AD")};var i=function(l){var j="alsoViewedTest avStandalone";if(ta.has("ta.avlb_hero_photos")){j="avlb_hero_photos"}var k;k=new ta.overlays.CenteredOverlay({backdrop:ta.overlays.BACKDROP_ALWAYS,style:j,onShow:g.delay(100),onLoad:ta.overlays.Factory.recordVRCrossSell}).loadRemoteSuccess(l);var n=false;if(k.inner){var m=ta.id("emptyAlsoViewed");if(m){n=true}else{ta.store("alsoViewedLB",true)}}else{n=true}if(n){k.hide();ta.store("commerce.pwrOverlay",k)}if(ta.meta&&ta.meta.cr){ta.meta.cr.removePCR()}else{ta.commerce.checkrates.removePCR()}};new Request({url:h,onSuccess:i,evalScripts:true}).send()},_loadAVCSS:function(){if(typeof(avlbCss)!="undefined"&&!ta.retrieve("ta.avlbCss")){ta.store("ta.avlbCss",Asset.css(avlbCss))}if(typeof(avlbTestCss)!="undefined"&&!ta.retrieve("ta.avlbTestCss")){ta.store("ta.avlbTestCss",Asset.css(avlbTestCss))}if(typeof(VRCrossSellCss)!="undefined"&&!ta.retrieve("ta.VRCrossSellCss")){ta.store("ta.VRCrossSellCss",Asset.css(VRCrossSellCss))}if(typeof(avlb_hero_photos)!="undefined"&&!ta.retrieve("ta.avlb_hero_photos")){ta.store("ta.avlb_hero_photos",Asset.css(avlb_hero_photos))}},_loadChkMoreCSS:function(){ta.overlays.Factory._loadAVCSS();if(typeof(chkMoreCss)!="undefined"&&!ta.retrieve("ta.chkMoreCss")){ta.store("ta.chkMoreCss",Asset.css(chkMoreCss))}if(typeof(chkMoreSpritesCss)!="undefined"&&!ta.retrieve("ta.chkMoreSpriteCss")){ta.store("ta.chkMoreSpriteCss",Asset.css(chkMoreSpritesCss))}},loadGeoCrAutoBroadenOverlay:function(g,j){var i=ta.retrieve("gcrab.cssPath");if(i&&!ta.retrieve("gcrab.css")){ta.store("gcrab.css",Asset.css(i))}var h=new ta.overlays.CenteredOverlay({permanent:true,style:"gcrabLb",noPadding:true,absoluteOffset:true,yOffset:(Math.max(20,window.getHeight()-540)/2)+window.getScrollTop(),xOffset:Math.max(5,window.getWidth()-965)/2,backdrop:ta.overlays.BACKDROP_ALWAYS,closeButtonClass:"roundOuterClose",content:'<div style="background-color:#EEE;"><img style="padding:150px;display:block;width:79px;margin:auto;" src="'+ta.util.imageServer("/img2/meta_sprites/loadingAnim.gif")+'"></div>',onClose:function(){ta.trackEventOnPage("MetaGeoLightBox","unload","CloseButton",0,false)}},g);ta.commerce.meta.loadGeoCrAutoBroadenContents(h,j)},loadCheckRatesLBOverlay:function(s,i,l){try{var o={};if(ta.meta&&ta.meta.update){o=ta.commerce.meta.getMetaParams()}var j=Object.merge({d:l.detail,s:crPageServlet,a:l.area},o);if(ta.retrieve("checkrates.meta_ui_post_click_prices")){var m="QC_Meta_Mini|Photo_LB";var p;try{p=ta.commerce.meta.tracking.setTimingForNavArea(m);j.metaRequestTiming=p}catch(n){ta.util.error.record(n,"problem locking timing for QC_Meta_Mini|Photo_LB")}}var q="CalendarLightbox";if(l&&l.gaContext){q=l.gaContext}var g=ta.widgets.calendar.getCheckRatesData();if(g){j=Object.merge(j,g)}var r="s3 dg cr_lb_overlay lb_overlay_post_date_close";var h={backdrop:ta.overlays.BACKDROP_ALWAYS,style:r,requestData:j,remoteContent:"/CheckRatesLB",showCloseButton:true,permanent:true,onLoad:function(){if(!g){ta.overlays.Factory.loadDatePicker(s,this,l.detail,"_cro",ta.widgets.calendar.launchCRLBUpdate)}},onHide:function(){ta.remove("meta.prof_photo_lb.post_date_close.overlay")}};h.closeButtonClass="roundOuterClose";h.onClose=function(){ta.trackEventOnPage("CalendarLightbox","unload","CloseButton")};ta.store("meta.prof_photo_lb.post_date_close.overlay",new ta.overlays.CenteredOverlay(h,i));if(typeof(checkRatesLBCss)!="undefined"&&!ta.retrieve("ta.checkRatesLBCss")){ta.store("ta.checkRatesLBCss",Asset.css(checkRatesLBCss))}}catch(k){ta.util.error.record(k,"check rates leave behind")}},tryToHideCROverlayPostDatesClose:function(){var g=ta.retrieve("meta.prof_photo_lb.post_date_close.overlay");if(g){g.hide()}},tamgShowLightbox:function(i,h,j){var g="tripadvisor.com";if(typeof cookieDomain!="undefined"){g=cookieDomain.substring(1,cookieDomain.length)}new Asset.css(j);new Request({url:"/TAMGFooterAjax",onSuccess:function(k){ta.overlays.showInLightbox(k,{style:"s0 TAMG_All"})},data:{a:"SHOW_GROUP_OVERLAY",dom:g},evalScripts:true,method:"get"}).send()},currencyPickerPopup:function(j,h,g){if(j){j.stop()}h.onclick=null;var i="/StaticVelocityPage?t=currency_picker.vm";new Asset.css(globalCurrencyPickerCSS);if(ta.retrieve("currency_format_using_icu4j_cldr.featureEnabled")=="true"){new ta.overlays.RelativeOverlayBelow({showCloseButton:false,activate:ta.overlays.ACTIVATE_CLICK,remoteContent:i,style:"global_currency_picker_overlay currency_format_using_icu4j_cldr dropMenu_refresh"},h)}else{new ta.overlays.RelativeOverlayBelow({showCloseButton:false,activate:ta.overlays.ACTIVATE_CLICK,remoteContent:i,style:"global_currency_picker_overlay dropMenu_refresh"},h)}ta.trackEventOnPage("CurrencyPicker","Open",g);return false},intlPopup:function(m,i){if(m){m.stop()}i.onclick=null;flagsUrl=document.location.pathname;var j="/StaticVelocityPage?t=intSitesFly.vm&lt=evt&footerFlagFormat="+footerFlagFormat+"&flagsURL="+encodeURIComponent(flagsUrl);if(document.location.search!=""){j+=encodeURIComponent(document.location.search)}if(document.location.hash!=""){j+=encodeURIComponent(document.location.hash)}if(window.modelGeoId){j+="&geo="+modelGeoId}if(window.flagsSettings){for(var g=0;g<flagsSettings.length;g++){j+="&"+flagsSettings[g]+"=true"}}if(window.pageFeature){j+="&pageFeature="+pageFeature}new Asset.css(flagsFlyoutCSS);var h=ta.isFall2013MastheadRefresh()?"dropMenu_refresh":"typeO";var l=ta.overlays.ACTIVATE_CLICK;new Request({url:j,onSuccess:function(k){var n=new Element("div",{html:k});ta.overlays.Factory.fixFlagsFlyout(n);new ta.overlays.RelativeOverlayBelow({showCloseButton:true,activate:l,content:n,style:h},i)}}).send();return false},fixFlagsFlyout:function(h){if(ta.retrieve("flag_flyout_link_fixing.featureEnabled")=="true"){var g=h.getElements("a.flag_link");g.forEach(function(j){var l=document.getElement("link[hreflang="+(j.get("hreflang"))+"]");if(l!=null){var k=l.get("href");if(typeof(k)=="string"){j.href=k}else{j.parentNode.style.display="none"}}else{j.parentNode.style.display="none"}});var i=h.getElements("li.region");i.forEach(function(j){var k=j.getElements("li.flag_item");var l=j.style.display;j.style.display="none";k.forEach(function(m){if(m.style.display!="none"){j.style.display=l}})})}},showRecentLocationEmailOverlay:function(){setPID(3833);if(typeof(recentViewedCSS)!="undefined"&&!ta.retrieve("ta.recentViewedCssAsset")){ta.store("ta.recentViewedCssAsset",Asset.css(recentViewedCSS))}new Request({url:"/RecentlyViewedAjax",onSuccess:function(g){if(!g.match("emptyRecentlyViewed")){ta.overlays.showInLightbox(g,{style:"dg s4 RecentlyViewedOverlay"})}},data:{a:"share_overlay"},evalScripts:true,method:"get"}).send()},expandRecentlyViewed:function(){for(var g=4;g<7;g++){var j=ta.id("recently_viewed_"+g);if(j&&j.hasClass("hidden")){j.removeClass("hidden")}}var h=ta.id("RECENTLY_VIEWED_MORE");if(h){h.addClass("hidden")}},showRecentlyViewedCompareOverLay:function(){ta.util.cookie.setPIDCookie(4898);var h=window.location.protocol+"//"+window.location.hostname+"/CompareHotels?detail=",g=0,j;for(g=0;g<7;g++){j=ta.id("recently_viewed_"+g);if(j){h=h+j.get("locid");g+=1;break}}for(;g<7;g++){j=ta.id("recently_viewed_"+g);if(j){h=h+"&compareHotelId="+j.get("locid")}}if(typeof(compareHotelCSS)!="undefined"&&!ta.retrieve("ta.compareHotelCssAsset")){ta.store("ta.compareHotelCssAsset",Asset.css(compareHotelCSS))}new Request({url:h,onSuccess:function(i){new ta.overlays.CenteredOverlay({activate:ta.overlays.ACTIVATE_CLICK,backdrop:ta.overlays.BACKDROP_ALWAYS,style:"compareHotel",content:i})}}).send()},clearRecentLocations:function(){var h=ta.id("RECENTLY_VIEWED_LIST");if(h){var g=h.getNext(".bxDivider");h.dispose();if(g){g.dispose()}}new Request({url:"/RecentlyViewedAjax?a=clear"}).send()},removeParticularLocation:function(g,h,r){var k=ta.id("recently_viewed_"+r);if(k){var q=k.get("locid");k.dispose();new Request({url:"/RecentlyViewedAjax?a=remove&locID="+q}).send();for(;r<7;++r){k=ta.id("recently_viewed_"+r);if(k&&k.hasClass("hidden")){k.removeClass("hidden");break}}for(;r<7;++r){k=ta.id("recently_viewed_"+r);if(k&&k.hasClass("hidden")){return}}var l=ta.id("RECENTLY_VIEWED_MORE");if(l&&!l.hasClass("hidden")){l.addClass("hidden")}var p=$$("li.rv_item");var o=0;var j=false;if(p){o=p.length;for(var m=0;m<o;m++){if(!p[m].hasClass("geoItem")){j=true}}}if(!j){var n=ta.id("RV_SAVE");if(n){n.dispose()}}if(o===0){k=ta.id("RECENTLY_VIEWED_LIST");if(k){k.dispose()}}else{if(o===1){k=ta.id("COMPARE_HOTELS");if(k){k.getParent().addClass("hidden")}}}}},showSendMessage:function(m,h){var g;if(m){m.preventDefault()}if(h){h=ta.id(h)}if(h){if(ta.has("overlays.sendmessage.loading")){return}else{ta.store("overlays.sendmessage.loading",true);ta.remove.delay(500,null,"overlays.sendmessage.loading")}if(typeof(privateMsgCSS)!="undefined"&&!ta.retrieve("ta.privateMsgCssAsset")){ta.store("ta.privateMsgCssAsset",Asset.css(privateMsgCSS))}var i;if(h.get("tag")=="span"&&h.hasClass("fkASDF")){i=h.className.match(/u_([^ ]*)/)[1]}else{i=h.href}if(i){var j=ta.retrieve("overlays.sendmessage");if(j&&i.match(/notyou=1/)){window.location="/NewsletterSignOut-e__2F__MemberSignIn"}else{if(j){return}}var l=parseInt(g,10)==1?"cc":"cm";var n=l=="cm"&&typeof(footprintGet)!="undefined"?footprintGet():null;if(n){i+="&LsoId="+n}var o={popup:true,product:"SEND_MESSAGE"};g=h.get("id");if(g){o.successAction="ta.overlays.Factory.showSendMessage||"+g}if(ta.registration.register(o)){var k;if(h.hasClass("callback_ShowRecaptcha")){new Asset.javascript(window.location.protocol+"//www.google.com/recaptcha/api/js/recaptcha_ajax.js");k="callback_ShowRecaptcha"}ta.common.sendmessage.communityLightbox(i,k)}}}},showConnectOverlay:function(i,g,h,k,j){ta.overlays.registration.connect(h,k,j)},showLoginOverlay:function(i,h,j,k,g){if(typeof(regflowCss)!="undefined"&&!ta.retrieve("ta.regflowCssAsset")){ta.store("ta.regflowCssAsset",Asset.css(regflowCss))}ta.overlays.registration.request(j,k,g)},showOverlayRegistration:function(h,i,p){var j,l,o,g,n,m;window.addEventListener("message",b,false);ta.on("metaFocusShow",ta.overlays.Factory.closeOverlayRegistration());ta.on("preMetaFocusShow",ta.overlays.Factory.closeOverlayRegistration());if(p&&p.hasOwnProperty("onSuccess")&&"function"===typeof(p.onSuccess)){ta.store("overlay_registration_onsuccess",p.onSuccess)}n={source:"OverlayRegistration",flow:p.flow,action:p.action,pid:p.pid,category:p.category,detail:p.locationId,geo:p.geoId,curUrl:p.curUrl};o=ta.util.URL.https("/Registration?"+Object.toQueryString(n));g=true;function k(){ta.store("ta.overlay.overlayRegistration",new ta.overlays.CenteredOverlay({backdrop:ta.overlays.BACKDROP_ALWAYS,style:"wide",yoffset:320,showCloseButton:g,closeButtonClass:"xCloseGreen",noPadding:true,waitForCss:true,content:'<div id="overlayRegFrameWrap"></div>',onShow:function(){var r,q;r=ta.id("overlayRegFrameWrap");if(r){new Asset.image(CDNHOST+"/img2/generic/site/loop.gif",{onload:this.position.bind(this),style:"margin: 40px 0 40px 300px","class":"anim_loop"}).inject(r)}ta.trackEventOnPage(p.category,"show_overlay","",p.pid,false);ta.util.recordInterruption("gate",p.category);j=document.createElement("iframe");j.src=o;j.id="overlayRegFrame";j.className="overlayRegFrame";j.width="640";j.height="0";j.style.visibility="hidden";l=ta.id("overlayRegFrameWrap");if(!l){ta.util.error.record(null,"The registration iframe wrapper was missing.");return}l.appendChild(j);q=ta.id("overlayRegFrame");if(q){q.addEvent("load",function(){if(r&&r.getElement(".anim_loop")){r.getElement(".anim_loop").hide()}q.style.visibility="visible"})}},onClose:function(){ta.trackEventOnPage(p.category,"closed","",p.pid,false)},onHide:function(){ta.remove("ta.overlay.overlayRegistration")}}))}if(!c()){a();k()}else{m=ta.retrieve("overlay_registration_onsuccess");if(m&&"function"===typeof(m)){m();ta.remove("overlay_registration_onsuccess")}}},closeOverlayRegistration:function(){var g=ta.retrieve("ta.overlay.overlayRegistration");if(g){g.hide();ta.remove("ta.overlay.overlayRegistration")}ta.overlays.safeCloseCurrent()},showRoomTipsOverlay:function(j,i,m){try{ta.util.cookie.setPIDCookie(4840);var h="/AccommodationTips?d="+modelLocId;if(m){h=h+"&filterLang="+m}var k=false;var g=new ta.overlays.CenteredOverlay({backdrop:ta.overlays.BACKDROP_NEVER,style:"s3 dg nopadding",permanent:true,zIndex:"9997",showCloseButton:true,remoteContent:h,onLoad:function(){if(g.inner){var n=ta.id("emptyTips");if(n){k=true}}else{k=true}if(k){g.hide()}}},i)}catch(l){ta.util.error.record(l,"showRoomTipsOverlay")}},_loadSummaryCss:function(){if(typeof(conceptsCss)!="undefined"&&!ta.retrieve("ta.conceptsCssAsset")){ta.store("ta.conceptsCssAsset",Asset.css(conceptsCss))}},showReviewSummary:function(m,j,l,h){if(l&&h){ta.overlays.Factory.showSummaryTranslation(m,j,l);return}var k=null;var i=null;var g=null;if(m){m.stop()}if(j.id&&j.id!=""){k=j.id.replace("concept_","").replace(/_/g," ");ta.store("topconcepts.lastconcept",k);g="/HotelSummary?d="+modelLocId+"&geo="+modelGeoId+"&concept="+k;if(l){g+="&autotrans=true"}}else{ta.util.error.record(null,"showReviewSummary - elmt.id check");return}ta.overlays.Factory._loadSummaryCss();i=new ta.overlays.CenteredOverlay({style:"s3 dg nopadding",autoShow:false,permanent:true,showCloseButton:true,remoteContent:g,onLoad:function(){ta.store("topconcepts.overlay."+k,this);this.show()}},j);j.onclick=i.show;return false},showSummaryTranslation:function(n,j,m){ta.util.cookie.setPIDCookie(16007);if(n){n.stop()}var h="s3 dg nopadding";ta.overlays.Factory._loadSummaryCss();var l="/MachineTranslation?";var k;if(j.id&&j.id!=""){if(j.id.indexOf("trans_")!=-1){k=j.id.replace("trans_","").replace(/_/g," ")}else{k=j.id.replace("concept_","").replace(/_/g," ")}ta.store("topconcepts.lastconcept",k);l+="page=summary&";l+="d="+modelLocId+"&";l+="concept="+k;l+="&sl=en&tl="+m}var g="topconcepts.overlay."+k;var i=ta.retrieve(g);if(i){i.hide()}i=new ta.overlays.CenteredOverlay({style:h,showCloseButton:true,remoteContent:l,onLoad:function(){ta.store(g,this);this.show()}},j)},toggleConceptSnippetTranslation:function(o,j){var n=null;var l=null;var m=null;var k=null;var g=null;if(o){o.stop()}if(j){ta.util.cookie.setPIDCookie(4111);m=j.id.replace(/[^_]*_(.*)/,"$1");n=ta.id("SUMMARYOVERLAY_"+m);if(n){l=n.getElements(".snippetText");for(var h=0;h<l.length;h++){if(l[h].isDisplayed()){l[h].hide()}else{l[h].show("inline")}}}k=ta.id("trans_"+m);g=ta.id("en_"+m);if(k.hasClass("activeButton")){k.removeClass("activeButton");k.addClass("inactiveButton")}else{k.removeClass("inactiveButton");k.addClass("activeButton")}if(g.hasClass("activeButton")){g.removeClass("activeButton");g.addClass("inactiveButton")}else{g.removeClass("inactiveButton");g.addClass("activeButton")}if(ta.overlays.Factory.storeReviewSummaryContent){ta.overlays.Factory.storeReviewSummaryContent(m.replace(/_/g," "),n.getParent().get("html"))}}},confirmGetVerified:function(i,h,g){ta.load("travel-answers-unverified.js",null);ta.trackEventOnPage("answers_faq_owner_get_verified","answer_form_click",g);if(i){i.stop()}ta.load("travel-answers-unverified.js",null);new ta.overlays.CenteredOverlay({style:"typeO",isOverlay:true,backdrop:ta.overlays.BACKDROP_ALWAYS,remoteContent:"/AnswersAjax?act=sgv&detail="+g},h);return false},questionToolTip:function(i,h,g){if(i){i.stop()}if(ta.has("questionTTShown")){return false}ta.store("questionTTShown",true);new Request({url:"/AnswersAjax",data:{act:"sqtt"},onSuccess:function(j){if(j==="true"){h.onclick=null;h.onmouseover=null;var k={style:"s3 dg rgba_gry update2012",activate:ta.overlays.ACTIVATE_NEVER,pinnable:ta.overlays.PINNABLE_NEVER,showArrow:true,allowRightArrowPos:true,pointArrowToSource:true,arrowHeight:32,arrowTopForce:40,arrowClass:"rgba_arrow_png24",showCloseButton:false,autoShow:false,delayShow:true,offsetRight:0,offsetTop:11,remoteContent:"/AnswersAjax?act=fqtt&geoId="+g};var l=new ta.overlays.RelativeOverlayRight(k,h);document.addEvent("click",l.hideByClickOnDocument.bind(l))}}}).send();return false},answersGuidelines:function(i,h,g){if(i){i.stop()}new ta.overlays.RelativeOverlayAbove({style:"typeO",isOverlay:true,showCloseButton:true,centered:true,backdrop:ta.overlays.BACKDROP_ALWAYS,remoteContent:"/AnswersAjax",requestData:{act:"sp",detail:g}},h);return false},questionForm:function(k,i,j,h){if(k){k.stop}if(!h){ta.util.error.record(new TypeError("pid required for questionForm overlay"),"Question and Answers - questionForm",null,null,"WARN")}ta.store("answers.pid.overlayType",h);var g=ta.overlays.getCurrent();if(g){g.hide()}new ta.overlays.CenteredOverlay({style:"answersOverlay verywide s7trans",closeButtonClass:"roundOuterClose",showCloseButton:true,remoteContent:"/AnswersAjax",requestData:{act:"saqo",lcid:j,altsessid:ta.retrieve("altsessid")||""},waitForCss:true,onLoad:function(){this.show()},onClose:function(){ta.remove("answers.pid.overlayType")}})},askReviewerIntercept:function(g,j,l,q,p,i,h,o,k){if(g){g.stop()}if(ta.registration.isAuthorized("SAVE_QUESTION")&&ta.registration.isAuthorized("SEND_MESSAGE")){ta.store("answers.pid.overlayType",k);new ta.overlays.CenteredOverlay({style:"answersOverlay verywide s7trans",closeButtonClass:"roundOuterClose",showCloseButton:true,remoteContent:"/AnswersAjax",requestData:{act:"ari",lcid:l,altsessid:ta.retrieve("altsessid")||"",screenname:q,reviewid:h,memberid:p,lang:i,subject:o},waitForCss:true,onLoad:function(){this.show()},onClose:function(){ta.remove("answers.messageTabLoaded");ta.remove("answers.pid.overlayType")}})}else{if(!j){ta.registration.getSuccessActionCookie();return false}var n=window.fullScreen||(window.screenTop===0&&window.screenY===0);var m={popup:!n,product:"SAVE_QUESTION",successAction:["ta.overlays.Factory.askReviewerIntercept",null,null,l,q,p,i,h,o].join("|")};ta.registration.register(m)}},showConfirmation:function(i){var g=ta.overlays.safeCloseCurrent();if(g){ta.store("confirmation.current",g)}var k=i.data;var j="answers."+k.type+".confirm";if(ta.has(j)){var h=ta.retrieve(j);h.onConfirm=i.onConfirm;h.onCancel=i.onCancel;h.show()}else{new ta.overlays.CenteredOverlay({backdrop:ta.overlays.BACKDROP_ALWAYS,style:"s4 dg confirmationPrompt medium",showCloseButton:false,remoteContent:"/AnswersAjax",requestData:k,onLoad:function(){var l=this;ta.retrieveOrStore(j,this);this.onConfirm=i.onConfirm;this.onCancel=i.onCancel;this.inner.getElement(".cancelBtn").addEvent("click",function(){if(l.onCancel&&typeof l.onCancel==="function"){l.onCancel()}ta.overlays.safeCloseFromDom(this);if(ta.has("confirmation.current")){ta.retrieve("confirmation.current").show();ta.remove("confirmation.current")}return false});this.inner.getElement(".confirmBtn").addEvent("click",function(){if(l.onConfirm&&typeof l.onConfirm==="function"){l.onConfirm()}ta.overlays.safeCloseFromDom(this);return true})},onHide:function(){this.onConfirm=null;this.onCancel=null}})}},reviewTranslate:function(l,j,h){ta.util.cookie.setPIDCookie(16009);ta.overlays.Factory._loadSummaryCss();var i=ta.has("photo.viewer.lightbox");var k=1001;if(i){k=10001}var g=new ta.overlays.CenteredOverlay({style:"s4 dg",zIndex:k,showCloseButton:true,remoteContent:h,onLoad:function(){this.show()}});ta.store("translationOverlay",g)},reviewTranslateEdit:function(j,h,i){var g=new ta.overlays.CenteredOverlay({backdrop:ta.overlays.BACKDROP_ALWAYS,style:"mtedit_overlay",fontSize:".9em",noPadding:true,showCloseButton:true,closeButtonClass:"roundOuterClose",remoteContent:"/MachineTranslationEdit?r="+i,onLoad:function(){try{var k=ta.id("mtedit_mt").getElements(".mtedit_text")[0];k.style.height=ta.id("mtedit_english").clientHeight+ta.id("mtedit_mt").offsetTop-k.offsetTop+"px"}catch(l){ta.util.error.record(l,"reviewTranslateEdit:onLoad")}}});ta.store("translationEditOverlay",g)},reviewTranslateEditGuidelines:function(h,g){new ta.overlays.RelativeOverlayAbove({content:g.getParent().getElement(".overlayContents").innerHTML,activate:ta.overlays.ACTIVATE_HOVER,style:"mtedit_guidelines_overlay"},g)},showRecentLocationSaveOverlay:function(){setPID(3832);if(typeof(recentViewedCSS)!="undefined"&&!ta.retrieve("ta.recentViewedCssAsset")){ta.store("ta.recentViewedCssAsset",Asset.css(recentViewedCSS))}new Request({url:"/RecentlyViewedAjax",onSuccess:function(g){if(!g.match("emptyRecentlyViewed")){ta.overlays.showInLightbox(g,{style:"dg s4 RecentlyViewedOverlay"})}},data:{a:"save_overlay"},evalScripts:true,method:"get"}).send()},createIPPinOverlay:function(h,j){var g;new ta.overlays.RelativeOverlayBelow({activate:ta.overlays.ACTIVATE_HOVER,style:"s2 mg",onShow:function(){if(typeof(friendStripMouseoverPageAction)=="undefined"||!friendStripMouseoverPageAction){return}g=setTimeout(function(){new Request({url:"/ActionRecord?action="+friendStripMouseoverPageAction}).send();friendStripMouseoverPageAction=null},400)},onHide:function(){clearTimeout(g)},content:j},h)},createFriendActivityOverlay:function(h,j,k){var g;return new ta.overlays.RelativeOverlayBelow({activate:ta.overlays.ACTIVATE_HOVER,style:"s2 mg",onShow:function(){k&&ta.util.pending.lock("friendActivityOverlay.pageAction",function(){g=setTimeout(function(){new Request({url:"/ActionRecord?action="+k}).send()},400)})},onHide:function(){clearTimeout(g)},content:j},h)},createFriendActivityLightbox:function(g){return new ta.overlays.CenteredOverlay({activate:ta.overlays.ACTIVATE_CLICK,backdrop:ta.overlays.BACKDROP_ALWAYS,style:"s4 mg friendActivity",content:g})},createCouponAnnouncementOverlayRedirect:function(h,m,g,o,l,i,j,n,k){ta.overlays.Factory.createCouponAnnouncementOverlay(null,null,h,m,g,o,l,i,j,n,k)},createCouponAnnouncementOverlay:function(h,k,l,s,i,u,r,o,n,t,q,j){ta.util.cookie.setPIDCookie(o);ta.css(r);var g={};g.act=l;if(n){g.act+="-"+n}else{if(window.pageServlet){g.act+="-"+pageServlet}}var p;if(q&&q!="false"){p="amex"}else{p="couponDetail"}ta.trackEventOnPage("SpecialOffer","click",window.pageServlet);var m="/CouponAjax?"+(s?"couponId="+s+"&":"")+(i?"announcementId="+i+"&":"")+(t?"locale="+t+"&":"")+(q?"isAmex="+q+"&":"")+(j?"showLocs="+j+"&":"")+"locationId="+u+"&listing=true";new Request({url:m,data:g,onSuccess:function(w){var v=ta.overlays.showCouponInLightbox(w,{closeButtonClass:"roundOuterClose",style:p,delayedPosition:true});v.closeBtn.addEvent("click",ta.servlet.blcoupons.closeHandler)},evalScripts:true}).send()},newCreateCouponAnnouncementOverlay:function(m,l,g,j,i){ta.util.cookie.setPIDCookie(j);ta.css(g);var h="couponDetail";var n=ta.id(i);var k=ta.overlays.showCouponInLightbox(n.innerHTML,{closeButtonClass:"roundOuterClose",style:h,delayedPosition:true});k.closeBtn.addEvent("click",ta.servlet.blcoupons.closeHandler)},postVideoLogin:function(h,g,i){if(i){ta.util.cookie.setPIDCookie(i)}ta.overlays.registration.connect({flow:"POST_VIDEO"},"SIGNIN")},fbLogin:function(){ta.support.Facebook.login()},createAmenitiesLightbox:function(i){var l=location.pathname;if(l.length>0){if(l.charAt(0)=="/"){l=l.substring(1)}var k=l.indexOf("-");if(k>=0){l=l.substring(0,k)}}var g=i.id,h;if(g.indexOf("amenity_")==0){h=g.substring(8)}var j=false;if(ta.remove("amenities.suppressLinks")){j=true}new ta.overlays.RelativeOverlayBelow({autoShow:true,style:"s3 dg",showCloseButton:true,activate:ta.overlays.ACTIVATE_CLICK,requestData:{d:h,tab:"amenities",from:l,suppressLinks:j},remoteContent:"/LocationTab"},i)},createAmenitiesLightboxFull:function(s,h,l,i){var r,m;if(s){s.stop()}if(typeof(amenityLightboxCss)!="undefined"&&!ta.retrieve("ta.amenityLightboxCss")){ta.store("ta.amenityLightboxCss",Asset.css(amenityLightboxCss))}if(l&&l>0){setPID(l)}var k=h.id;if(k.indexOf("amenity_")==0){r=k.substring(8)}ta.setEvtCookie("HotelContactInfo","Amenities",r,1,"/LocationTab");var q={};if(ta.meta&&ta.meta.update){q=ta.commerce.meta.getMetaParams()}var o=Object.merge({d:r,tab:"amenities_lightbox",from:window.pageServlet},q);var g={backdrop:ta.overlays.BACKDROP_ALWAYS,style:"s3 dg",onLoad:function(){this.position();if(ta.meta&&ta.meta.update){ta.meta.update.updateCRForm("_amo")}else{ta.commerce.checkrates.updateCRForm("_amo")}if(ta.has("ads.gptEnabled")){ta.common.ads.injectAjaxAds("locationtab","#gpt-ad-728x90-locationtab",true)}else{injectAdsTargeted(ta.id("AMENITY_LIGHTBOX"))}var t=ta.id("AMENITY_LIGHTBOX");if(i){var u=ta.select(".amenities_balance")[0];var v=ta.select(t,".bottom_margin")[1];var x=ta.select(".amenitiesRDV1")[0];if(u&&v&&x){var w=x.cloneNode(true);u.insertBefore(w,v)}}this.position()},showCloseButton:true,permanent:!ta.has("isDaoDao"),requestData:o,remoteContent:"/LocationTab",maintainCrPageServlet:true,onClose:function(){ta.remove("meta.requestFromArea")}};if(ta.retrieve("checkrates.meta_ui_post_click_prices")){m="QC_Meta_Mini|Amenities_Lightbox";var p;try{p=ta.commerce.meta.tracking.setTimingForNavArea(m)}catch(n){ta.util.error.record(n,"problem locking timing in ta.commerce.meta.loadBestPriceXsell")}g.onShow=function(){var t=ta.retrieve("meta.baseLocationId");if(t){try{ta.commerce.meta.tracking.setTimingForNavArea(m)}catch(u){ta.util.error.record(u,"problem locking timing in ta.commerce.meta.loadBestPriceXsell")}ta.commerce.meta.updateProvAreaFromLightBox(t)}};if(p){g.requestData=Object.merge(g.requestData,{area:m,metaRequestTiming:p})}else{g.requestData=Object.merge(g.requestData,{area:m})}}var j=new ta.overlays.CenteredOverlay(g,h);j.show();h.onclick=function(){j.show();if(ta.has("ads.gptEnabled")){ta.common.ads.injectAjaxAds("locationtab","#gpt-ad-728x90-locationtab",true)}else{ta.common.ads.injectAdsTargeted(ta.id("AMENITY_LIGHTBOX"))}if(ta.meta&&ta.meta.update){ta.meta.update.updateCRForm("_amo")}else{ta.commerce.checkrates.updateCRForm("_amo")}};ta.commerce.meta.tracking.resetTimingLockForNavArea(m);ta.store("ta.amenityLightboxOverlay",j);return false},iapFlyout:function(j,i,h){h.elmt=i;ta.store("iapFlyoutOptions",h);var g=i.get("id")+","+h.contentId+","+h.voteContentType;if(ta.registration.register({popup:true,product:"IAP_VOTE",successAction:"ta.overlays.Factory.iapFlyoutHelper|"+g})){ta.overlays.Factory.iapFlyoutHelper(g)}},iapTooltip:function(h,g){new ta.overlays.RelativeOverlayAbove({style:"tooltip ttWhite",showArrow:true,arrowClass:"arrow arrowDown",reverseIfRtl:true,showCloseButton:false,backdropClickClose:true,backdrop:ta.overlays.BACKDROP_NEVER,content:g.getElement(".ulBlueLinks").innerHTML,offsetTop:10,offsetLeft:80,activate:ta.overlays.ACTIVATE_HOVER,permanent:false,waitForCss:true},g.getElement(".reportTxt"))},rtrTooltip:function(h,g){new ta.overlays.RelativeOverlayAbove({style:"tooltip ttWhite",showArrow:true,arrowClass:"arrow arrowDown",reverseIfRtl:true,showCloseButton:false,backdropClickClose:true,backdrop:ta.overlays.BACKDROP_NEVER,content:g.getElement(".ulBlueLinks").innerHTML,offsetTop:10,offsetLeft:140,activate:ta.overlays.ACTIVATE_HOVER,permanent:false,waitForCss:true},g.getElement(".respondTxt"))},iapAlbumFlyout:function(j,i,h){h.elmt=i;ta.store("iapFlyoutOptions",h);var g=i.get("id")+","+h.contentId+","+h.voteContentType;if(ta.registration.register({popup:true,product:"IAP_VOTE",successAction:"ta.overlays.Factory.iapAlbumFlyoutHelper|"+g})){ta.overlays.Factory.iapAlbumFlyoutHelper(g)}},iapAlbumFlyoutHelper:function(k,o){var j=k.split(",");var n=j[0];var g=parseInt(j[1],10);var i=j[2];var l=ta.retrieve("iapFlyout");if(l){l.hide()}var h=ta.id(n);if(h){if(o){window.scrollTo(0,h.getPosition().y)}var m=new ta.overlays.CenteredOverlay({showCloseButton:true,permanent:true,remoteContent:"/ReportIAP?action=reportIAP&step=START&contentId="+g+"&voteContentType="+i,backdrop:ta.overlays.BACKDROP_ALWAYS,style:"s3 dg iapFlyout"});ta.store("iapFlyout",m)}},iapFlyoutHelper:function(k,o){var j=k.split(",");var n=j[0];var g=parseInt(j[1],10);var i=j[2];var l=ta.retrieve("iapFlyout");if(l){l.hide()}var h=ta.id(n);if(h){if(o){window.scrollTo(0,h.getPosition().y)}var m=new ta.overlays.RelativeOverlayBelow({showCloseButton:true,permanent:true,remoteContent:"/ReportIAP?action=reportIAP&step=START&contentId="+g+"&voteContentType="+i,style:"s3 dg iapFlyout"},h);ta.store("iapFlyout",m)}},iapOwnerFlyout:function(j,i,h){var g=i.get("id")+","+h.reviewid+","+h.isGeo+","+h.locationid;if(ta.registration.register({popup:true,product:"IAP_VOTE",successAction:"ta.overlays.Factory.iapOwnerFlyoutHelper|"+g})){ta.overlays.Factory.iapOwnerFlyoutHelper(g)}},iapOwnerFlyoutHelper:function(j,o){var h=j.split(",");var m=h[0];var p=parseInt(h[1],10);var i=h[2];var n=parseInt(h[3],10);var k=ta.retrieve("iapOwnerFlyout");if(k){k.hide()}var g=ta.id(m);if(g){if(o){window.scrollTo(0,g.getPosition().y)}var l=new ta.overlays.RelativeOverlayBelow({showCloseButton:true,permanent:true,remoteContent:"/ReportIAP?action=explain&reason=21&reviewid="+p+"&isGeo="+i+"&locationid="+n,style:"s3 dg iapFlyout"},g);ta.store("iapOwnerFlyout",l)}},openSavesRegflow:function(){ta.widgets.Saves.openSavesRegflow()},openSavesHoverRegflow:function(){ta.widgets.Saves.openSavesHoverRegflow()},openMastheadRegflow:function(){ta.widgets.Saves.openMastheadRegflow()},createGuideOverlay:function(){ta.overlays.registration.connect({flow:"DESTINATION_GUIDE"},"SIGNUP")},createPostPhotosOverlay:function(){ta.overlays.registration.connect({flow:"POST_PHOTOS"},"SIGNUP")},relBelowOverlaySolidGreenBorder:function(h,g){g.onmouseover=null;new ta.overlays.RelativeOverlayBelow({activate:ta.overlays.ACTIVATE_HOVER,style:"s3 dg"},g)},createDropDown:function(o,h,k){h=ta.id(h);h.onmouseover=null;var g=ta.isFall2013MastheadRefresh()?"dropMenu_refresh":"dropMenu";var l=ta.isFall2013MastheadRefresh()?"sprite-arrow_dropdown_wht_refresh_show":"sprite-arrow_dropdown_wht_show";var i,n,m=ta.id("HEAD");if(m){n=m.getStyle("z-index")||204}else{n=204}try{i=new ta.overlays.RelativeOverlayBelow({content:k,style:g,fontSize:"12px",zIndex:n,activate:ta.overlays.ACTIVATE_HOVER,pinnable:ta.overlays.PINNABLE_CLICK,noPadding:ta.isFall2013MastheadRefresh(),onShow:function(){h.addClass("tabLinkShown");h.addClass("arwLinkShown");h.getParent().addClass("tabItemShown");h.getElement("img").addClass(l)},onHide:function(){h.removeClass("tabLinkShown");h.removeClass("arwLinkShown");h.getParent().removeClass("tabItemShown");h.getElement("img").removeClass(l);var p=k.getElements(".text");Array.each(p,function(q){var r=q.retrieve("typeAhead");if(r){r.hideChoices()}})}},h)}catch(j){return}i.pinAndSetUnpin=function(){i.pin();document.addEvent("click",i.unpinAndSetPin)};i.unpinAndSetPin=function(p){p=new Event(p);if(!i.container.containsEvent(p)&&!p.target.hasClass("dropSelect")){i.hide();i.unpin();document.removeEvent("click",i.unpinAndSetPin);i.container.addEvent("click",i.pinAndSetUnpin)}};i.container.addEvent("click",function(p){i.pinAndSetUnpin(p)})},createEmptyOverlay:function(k,h,j){h=ta.id(h);var g="";if(j){g="typeO"}try{new ta.overlays.RelativeOverlayBelow({noPadding:true,style:g,activate:ta.overlays.ACTIVATE_HOVER},h)}catch(i){return}},popConditionsOverlay:function(){var g=ta.id("CONDITIONS");if(g){ta.overlays.showInLightbox(g.innerHTML)}},cancelCreateWARList:function(h){h.stopPropagation();var g=ta.retrieve("war.todolist.showOverlay");if(g){window.clearTimeout(g);ta.store("war.todolist.showOverlay",false)}},createWARToDoListOverlay:function(h){ta.trackEventOnPageOnce("WAR","GLOBAL_NAV_WAR_HOVER");var j=ta.id("WAR_TODO_LOADING");if(j){var i=h?{d:h}:{};var g=ta.id("WAR_NOTIFICATION_FLAG")||ta.id("NO_WAR_NOTIFICATION_FLAG");j.removeClass("hidden");new Request({url:"/UserReviewToDoListAjax",data:i,method:"get",onSuccess:function(n){var m=new Element("div",{html:n});var k=m.getElement("#WAR_NOTIFICATION_FLAG_NEW");var o=m.getElement("#WAR_MORE_TO_DO_ITEMS");if(o){o.replaces(j)}if(g){if(k){k.replaces(g);k.setProperty("id","WAR_NOTIFICATION_FLAG")}else{var l=m.getElement("#NO_WAR_NOTIFICATION_FLAG");if(l){g.dispose()}}}}}).send()}},showCompareOverLay:function(g,l,h){var k="/CompareHotels?detail="+h;for(var j=0;j<3;j++){var m=ta.id("compare_hotels_"+j);if(m&&m.checked==true){k=k+"&compareHotelId="+m.value}}new Asset.css(compareHotelCSS);new Request({url:k,onSuccess:function(i){new ta.overlays.CenteredOverlay({activate:ta.overlays.ACTIVATE_CLICK,backdrop:ta.overlays.BACKDROP_ALWAYS,style:"compareHotel",content:i})}}).send()},createNeighborhoodOverlay:function(l,j,g){if(ta.has("nbhdOverlay")){if(j){j.onclick=null}ta.retrieve("nbhdOverlay").show();return}var h=new ta.overlays.RelativeOverlayBelow({showCloseButton:true,permanent:true,zIndex:"997",style:"nbhdOverlay typeO",activate:ta.overlays.ACTIVATE_CLICK,pinnable:ta.overlays.PINNABLE_ALWAYS,onShow:function(){if(g){ta.servlet.HACSearch.filter.update()}},onHide:function(){if(g){ta.servlet.HACSearch.filter.update()}}},"NEIGHBORHOOD_OVERLAY");var i=h.inner;var k=ta.id("NEIGHBORHOOD_FORM");if(i&&k){k.inject(i,"top");k.removeClass("hidden");ta.store("neighborhoodOverlayForm",k)}ta.store("nbhdOverlay",h)},createHACProgressOverlay:function(){try{if(ta.has("ta.hac.progress.overlay")){return ta.retrieve("ta.hac.progress.overlay")}var j=ta.id("HAC_PROGRESS_CONTAINER").dispose();var g=j.get("html");var i=new ta.overlays.CenteredOverlay({style:"s3 dg rgba_gry",showCloseButton:false,permanent:true,content:g});ta.store("ta.hac.progress.overlay",i);return i}catch(h){ta.util.error.record(h,"createHACProgressOverlay")}},getFilterWaitOverlay:function(){var h=ta.retrieve("filters.waitDialog");if(!h){var g="mg s1 fatNotice";if(ta.isHotelsRedesign2011()||ta.has("hotels.redesignEnabled")){g=g+" fatNotice_2011"}h=new ta.overlays.CenteredOverlay({style:g,showCloseButton:false,autoShow:false,delayedPosition:true});h.inner.set("html","<b>"+JS_UpdatingYourResults+"</b>");ta.store("filters.waitDialog",h)}return h},showFilterWaitOverlay:function(h){var g=ta.overlays.Factory.getFilterWaitOverlay();if(g){if(h){g.show();g.position(false)}else{g.hide()}}},showUpdatingMessage:function(){var h=ta.overlays.Factory.getFilterWaitOverlay();h.show();if(ta.remove("filter.map")){h.container.setStyles({left:-9999,top:-9999});var i=ta.id(ta.retrieve("maps.container")).getCoordinates();var g=h.container.getCoordinates();h.container.setStyles({left:i.left+(i.width-g.width)/2,top:i.top+(i.height-g.height)/2})}if(ta.remove("filter.lockout")){h.enableBackdrop()}},createPhotoUploaderOverlay:function(g){var h=new ta.overlays.CenteredOverlay({backdrop:ta.overlays.BACKDROP_ALWAYS,autoShow:false,style:"s2 dg",innerDivClass:"noPadMarg",attachCloseEvent:true,permanent:true,onLoad:ta.media.uploader.onLoadOverlayHandler,onClose:function(){if(ta.has("tipsOverlay")&&ta.retrieve("tipsOverlay").hide){ta.retrieve("tipsOverlay").hide();ta.remove("tipsOverlay")}}});h.loadRemoteContent(g,true);ta.store("ta.media.uploader.photoUploaderOverlay",h)},createIpDeauthOverlay:function(h,g){new Request({url:"/ActionRecordPlus?action=DEAUTH_IP&id="+h,onSuccess:function(i){new ta.overlays.CenteredOverlay({backdrop:ta.overlays.BACKDROP_ALWAYS,showCloseButton:false}).loadRemoteSuccess(i);if(g){ta.support.Facebook.ipRevoke(10000)}},onFailure:ta.util.error.ajaxFailure.partial("partials:ip_disable")}).send()},createHotelStyleCategoryDescriptionOverlayAbove:function(j,h,g){var i=ta.id(g);h.onmouseover=null;if(i){new ta.overlays.RelativeOverlayRight({showCloseButton:false,activate:ta.overlays.ACTIVATE_HOVER,style:"ryokanOverlay",showArrow:true,pointArrowToSource:true,allowRightArrowPos:true,arrowHeight:29,arrowClass:"ryokanArrow",fontSize:".7em",offsetRight:-14,offsetTop:-10,waitForCss:true,content:new Element("div",{style:"width:300px; padding:12px;",html:i.getChildren()[0].get("html")})},h)}},updateAllGuestsRoomsButtons:function(){var i=ta.widgets.calendar.getGuestsRoomsPickerData(),h=$$(".roomsButton .grp-rooms-value"),g=$$(".guestsButton .grp-guests-value");if(h&&h.length>0){h.each(function(j){j.set("html",i.rooms)})}if(g&&g.length>0){g.each(function(j){j.set("html",i.guests)})}},kinderOverlay:function(j,h){try{h.onclick=null;var i={style:"s4 dg kinder",showCloseButton:true,isChild:true,activate:ta.overlays.ACTIVATE_CLICK};var g=document.getElement(".overlay");if(g){i.onShow=function(){var l=g.overlay;if(!l.pinned){l.unpinOnHide=true;l.pin()}},i.onHide=function(){var l=g.overlay;if(l.unpinOnHide){l.unpinOnHide=false;l.unpin()}}}new ta.overlays.RelativeOverlayBelow(i,h)}catch(k){ta.util.error.record(k,"Error: kinderOverlay")}},loadBLSlideshowOverlay:function(j,i,h,g){if(window.t4bSlideshowCSS&&!ta.retrieve("ta.t4bSlideshowCSS")){ta.store("ta.t4bSlideshowCSS",new Asset.css(t4bSlideshowCSS))}new Request({url:"/BusinessListingsAjax",onSuccess:function(k){ta.overlays.showInLightbox(k,{backdrop:ta.overlays.BACKDROP_ALWAYS,style:"g s10px np"})},data:{act:"slideshow",detail:h,pid:g,servletName:pageServlet,flash:(Browser.Plugins.Flash.version>=10)},evalScripts:true,method:"get"}).send()},showPartnerAttributionTip:function(i,g,h){new ta.overlays.RelativeOverlayBelow({showCloseButton:true,style:"s3 dg update2012 rgba_gry partner_attrib",content:h},g)},accountMenuFlyout:function(l,h){try{h.removePropertyEvent("onmouseover","ta.overlays.Factory.accountMenuFlyout");h.removePropertyEvent("onclick","ta.overlays.Factory.accountMenuFlyout");l.stop();var g=ta.isFall2013MastheadRefresh()?"dropMenu dropMenu_refresh accountMenuFlyout":"dropMenu accountMenuFlyout";var i=ta.isFall2013MastheadRefresh()?ta.overlays.ACTIVATE_CLICK:ta.overlays.ACTIVATE_HOVER;var k=new ta.overlays.RelativeOverlayBelow({activate:i,style:g,noPadding:true,onShow:function(){if(!ta.isFall2013MastheadRefresh()){this.container.setStyle("margin-left","19px")}},onHide:function(){this.container.setStyle("margin-left","0")}},h);ta.store("accountMenuFlyout",k)}catch(j){ta.util.error.record(j,"Error: ta.overlays.Factory.accountMenuFlyout")}},messageMenuFlyout:function(i,g){if(i){i.stop()}try{new ta.overlays.RelativeOverlayBelow({activate:ta.overlays.ACTIVATE_CLICK,style:"messageMenuOverlay",innerDivClass:"",content:ta.id("MESSAGE_MENU").innerHTML,offsetLeft:23,offsetTop:2,showCloseButton:false},g)}catch(h){ta.util.error.record(h,"Error: ta.overlays.Factor.messageMenuFlyout")}},ratingMenuFlyout:function(j,g){g.onmouseover=null;try{var i=new ta.overlays.RelativeOverlayBelow({activate:ta.overlays.ACTIVATE_HOVER,style:"dropMenu ja_ratingMenuFlyout"},g);ta.store("ratingMenuFlyout",i)}catch(h){ta.util.error.record(h,"Error: ta.overlays.Factory.ratingMenuFlyout")}},bizListingsMenuFlyout:function(l,h){h.onmouseover=null;try{var j=h.getNext("div"),i=ta.retrieve("accountMenuFlyout");if(j){j=j.get("html")}var g=ta.isFall2013MastheadRefresh()?"dropMenu dropMenu_refresh bizListingsMenuFlyout":"dropMenu bizListingsMenuFlyout";new ta.overlays.RelativeOverlayRight({content:j,zIndex:2000,style:g,offsetTop:ta.isFall2013MastheadRefresh()?-6:0,activate:ta.overlays.ACTIVATE_HOVER,onShow:function(){if(i){i.pin().show();var m=this;this.container.addEvent("mouseleave",function(n){if(!i.container.containsEvent(n)){i.hide();m.hide();m.container.onmouseleave=null}})}},onHide:function(){if(i){i.unpin()}}},h)}catch(k){ta.util.error.record(k,"Error: ta.overlays.Factory.bizListingsMenuFlyout")}},createDrop:function(j,g){g.onmouseover=null;try{var h=g.getNext().getElement(".subNav");ta.run("ta.overlays.Factory.createDropDown",{},j,g,h)}catch(i){ta.util.error.record(i,"Error: ta.overlays.Factory.createDrop")}},createFriendOfFriendOverlay:function(g,h){g.onclick=null;if(h){new ta.overlays.RelativeOverlayAbove({activate:ta.overlays.ACTIVATE_CLICK,style:"s2 mg",showCloseButton:true,content:h},g)}if(lazyImgs!=null){window.setupLazyLoad()}},CLOSE_BTN_RIGHT_OFFSET:15,ratingsFlyout:function(p,g,i,l){if(p){p.stop()}try{var k=g.get("class").match("rating(\\d)")[1];var m=ta.id("ratingsFlyout"+k).get("html");var o=null;var h="";if(i){o=ta.servlet.Reviews.ratingFlyoutScroll}var j="ratingOverlay dg s3 rgba_gry";if(l){h=" fixedHeight";j=j+" overlayWithScroll"}new ta.overlays.RelativeOverlayAbove({showCloseButton:true,activate:ta.overlays.ACTIVATE_CLICK,content:m,innerDivClass:"ratingFlyout inner"+h,style:j,onscroll:o},g);new Request({url:"/ActionRecord?action=ratingsFlyout&pid=4304"}).send()}catch(n){ta.util.error.record(n,"showRatingsFlyout")}},getWhiteFlyout:function(o,i,l,m,h){if(o){o.stop()}if(!i||!l){return}var j="whiteFlyOut";var g=true;var k="flyout_white_arrow";var n="flyout_icon_close";new ta.overlays.RelativeOverlayRight({style:j,pinnable:ta.overlays.PINNABLE_CLICK,showArrow:g,arrowClass:k,pointArrowToSource:true,showCloseButton:true,closeButtonClass:n,content:l,offsetRight:m,offsetLeft:-m,onRight:ta.util.i18n.isRtl()?false:true,offsetTop:h},i)},firstToReviewFlyout:function(m,g,l){try{var h=ta.id("locationId"+l);var i=h.getElement(".firstToReviewFlyout").innerHTML;var j=h.getElement(".propName");ta.overlays.Factory.getWhiteFlyout(m,j,i,-12,-20)}catch(k){ta.util.error.record(k,"ta.overlays.factory.firstToReviewFlyout")}},openTourismDescription:function(g){ta.servlet.Tourism.showGeoDescription(g)},memberPassportStampOverlay:function(i,g,h){if(!ta.has("passportStampsCSS")){ta.store("passportStampsCSS",new Asset.css(passportStampsCSS))}h.geos=h.geos.join(",");new ta.overlays.RelativeOverlayRight({style:"s3 dg rgba_gry memberPassportStamps",activate:ta.overlays.ACTIVATE_CLICK,showCloseButton:true,onLoad:function(){this.show()},remoteContent:"/MemberPassportStamps",requestData:h},g);ta.trackEventOnPage("Reviews","reviews_in_cities");new Request({url:"/ActionRecord?action="+h.actionRecord}).send()},relRightLocalContent:function(i,g,h){g.onmouseover=null;new ta.overlays.RelativeOverlayRight({activate:ta.overlays.ACTIVATE_HOVER,style:"s2 og",content:ta.id(h).innerHTML},g)},relRightLocalContentSimple:function(n,h,l,i,k){var m=true;var g="flyout_arrow";var j="flyout_icon_close";new ta.overlays.RelativeOverlayRight({pinnable:ta.overlays.PINNABLE_CLICK,noPadding:false,style:"s5",offsetRight:-8,innerDivClass:"balloon_holder",showArrow:m,arrowClass:g,arrowClassRight:g,showCloseButton:true,closeButtonClass:j,content:ta.id(l).innerHTML,onClose:function(){i(k)}},h)},centerLocalAddress:function(i,g,h){new ta.overlays.CenteredOverlay({style:"s3 dg help_center",showCloseButton:true,backdropClickClose:true,backdrop:ta.overlays.BACKDROP_ALWAYS,content:ta.id(h).innerHTML},g)},cookieSettingsPanel:function(j,g){if(j){j.stop()}if(g&&g.onclick){g.onclick=null}var h={};h.en=451;h.en_UK=834;h.en_IE=835;h.en_ZA=2635;h.sv=720;h.no=721;h.da=1199;h.fr=1197;h.de=1201;h.de_AT=2719;h.el=1198;h.it=1202;h.es=1200;h.pl=1208;h.nl=1209;h.fi=2968;h.hu=3049;h.cs=3128;h.sk=3233;h["default"]=451;var i;if(posLocale in h){i="//info.evidon.com/pub_info/"+h[posLocale]+"?v=1&nt=0"}else{i="//info.evidon.com/pub_info/"+h["default"]+"?v=1&nt=0"}new ta.overlays.RelativeOverlayBelow({showCloseButton:true,noPadding:true,activate:ta.overlays.ACTIVATE_CLICK,content:new Element("iframe",{src:i,height:562,width:731,styles:{margin:"0"}})},g)},loadJFYHotelsFilter:function(s,z,q){if(s){s.stop()}var x=ta.retrieve("ta.p13n.filterOnHover");var K=ta.retrieve("ta.p13n.prodp13nIsTablet");if(typeof(x)!=="boolean"||typeof(K)!=="boolean"){return}function B(){var i;if(document.getElement(".horizontal_filters_wrap")){var P=document.getElement(".jfy_filter_bar_top");if(P){i=P.getElement(".options_size_limiter");if(i&&i.scrollHeight>95){var R=P.getElement(".resizer_footer.hidden");if(R){R.removeClass("hidden")}}}}else{if(q==="neighborhood"){ta.overlays.Factory.fixLocationFilterFooter()}else{i=$$(".jfy_filter_bar .jfy_filter_bar_"+q+"_inner");if(i.length>0&&i[0].scrollHeight>95){var Q=$$(".jfy_filter_bar .jfy_filter_"+q+"_footer.hidden");if(Q.length>0){Q[0].removeClass("hidden")}}}}}var u={};if(ta.retrieve("ta.p13n.jfyFilterSet")&&typeof ta.retrieve("ta.p13n.jfyFilterSet")==="object"){u=ta.retrieve("ta.p13n.jfyFilterSet")}var H=null;var N=(q==="price"&&!ta.widgets.calendar.hasPageDates()&&(pageServlet!="Restaurants"));var k;if(N){k=ta.retrieve("ta.p13n.priceFilterWithCalender.content");if(!k){k=$("jfy_filter_bar_price_predates");ta.store("ta.p13n.priceFilterWithCalender.content",k);k.parentNode.removeChild(k)}}else{k=ta.id("jfy_filter_bar_"+q)}if(!k){return}var y=undefined;var F=ta.id("EATERY_FILTERS_CONT");if(F||q!=="sort"){var m=document.createElement("div");m.className="jfy_filter_bar_top_arrow";y=document.createElement("div");y.className="jfy_filter_bar_top_spacer";y.insertBefore(m,null)}var A=document.createElement("div");var t="jfy_filter_bar jfy_filter_bar_"+q;A.className=t;var v=k.getElements(".all");if(v&&v.length>0){v.removeClass("hidden")}var L=k.getElements(".less");if(L&&L.length>0){L.removeClass("hidden");L.addClass("hidden")}var D=k.getElements(".sprite-tag_list_expand");if(D&&D.length>0){D.removeClass("hidden")}var p=k.getElements(".sprite-tag_list_compress");if(p&&p.length>0){p.removeClass("hidden");p.addClass("hidden")}if(q!=="price"&&q!=="hotel_class"){var O=k.getElementsByTagName("DIV")[0];O=ta.id(O);if(q==="neighborhood"){O=k.getElements(".jfy_filter_bar_neighborhood_inner")[0]}var o=false;var w=false;var n=[];var j=0;var I;if(O){var l=O.getElements(".jfy_tag_style");if(l){for(I=0;I<l.length;I++){if(l[I].hasClass("selected")){if(w){o=true;break}}else{w=true}}if(o){for(I=0;I<l.length;I++){if(l[I].hasClass("selected")){l[I].dispose();n[j]=l[I];j++}}for(I=n.length;I>0;I--){O.insertBefore(n[I-1],O.firstChild)}}}}}A.innerHTML=k.get("html");var C=document.createElement("div");if(y){C.insertBefore(y,null)}C.insertBefore(A,null);if(!u[q]){var J=ta.overlays.ACTIVATE_CLICK_ALTERNATE;var G=true;var M=1500;if(x){J=ta.overlays.ACTIVATE_BOTH_DELAY;if(!K){G=false;M=250}else{if(q==="sort"){G=false}}}var E=(q==="price")?ta.overlays.PINNABLE_CLICK:ta.overlays.PINNABLE_NEVER;var g=function(){B();if(q==="price"){if(ta.has("metaDatePickerEnabled")){ta.widgets.calendar.syncAllDatePickers()}}else{if(q==="sort"){if(ta&&ta.p13n&&ta.p13n.wizard&&typeof(ta.p13n.wizard.justifyRightSortOption)=="function"){ta.p13n.wizard.justifyRightSortOption()}}}};var r=ta.retrieve("ta.p13n.header_placement_overlay_class")||"";var h="jfy_filter_bar_top dg jfy_filter_bar_top_"+q+" "+r;if(F){h=h+" restaurants_filter_overlay"}if(ta.retrieve("left_hotels_filters")){h=h+" left_hotels_filters"}H=new ta.overlays.RelativeOverlayBelow({pinnable:E,style:h,activate:J,showCloseButton:G,noPadding:true,content:C.innerHTML,centered:true,allowFlip:false,closeOnDocumentClick:true,activateHoverDelayTime:150,hoverDelayTime:M,autoShow:false,ignoreFirstClickAfterHover:x,ignoreFirstClick:x,onShow:g},z);H.adjustEdge=function(T,Q){var S=ta.id("JFY_hotel_filters")||ta.id("EATERY_FILTERS_CONT");if(S&&S.getCoordinates){var R=S.getCoordinates();var P=T;if(T<R.left){P=R.left}else{if(T+Q>=R.right){var i=this._styleValueToPixel(this.container.getStyle("margin-right"));P=R.right-Q-i-1}}var U=T-P;this.setJfyArrowOffset=function(){this.inner.getElements(".jfy_filter_bar_top_arrow").setStyle("left",U+"px")};this.setJfyArrowOffset();return P}};if(x){H.showWithDelay()}else{H.show()}u[q]=H}else{H=u[q];H.inner.innerHTML=C.innerHTML;H.container.removeClass("expanded");if(H.visible){B();H.setJfyArrowOffset()}if(N){if(ta.has("metaDatePickerEnabled")){ta.widgets.calendar.syncAllDatePickers()}}H.enable()}if(K){ta.id("PAGE").addEvent("click",H.hide)}ta.store("ta.p13n.jfyFilterSet",u);if(!ta.retrieve("ta.p13n.filterOnHover")){ta.trk(q,false,s.target?s.target:s.srcElement)}},fixLocationFilterFooter:function(){var l=$$(".jfy_filter_bar .location_popular .jfy_filter_bar_neighborhood_inner");if(l.length>0&&l[0].scrollHeight>95){var i=$$(".jfy_filter_bar .location_popular .jfy_filter_neighborhood_footer.hidden");if(i.length>0){i[0].removeClass("hidden");$$("#jfy_filter_bar_neighborhood .location_popular .jfy_filter_neighborhood_footer.hidden").removeClass("hidden")}}var j=$$(".jfy_filter_bar .location_neighborhood .jfy_filter_bar_neighborhood_inner");if(j.length>0){if(j[0].scrollHeight>95){var h=$$(".jfy_filter_bar .location_neighborhood .jfy_filter_neighborhood_footer.hidden");if(h.length>0){h.removeClass("hidden");$$("#jfy_filter_bar_neighborhood .location_neighborhood .jfy_filter_neighborhood_footer.hidden").removeClass("hidden")}}if(l.length>0){$$(".jfy_filter_bar .location_neighborhood").addClass("hidden")}}var g=$$(".jfy_filter_bar .location_attraction .jfy_filter_bar_neighborhood_inner");if(g.length>0){if(g[0].scrollHeight>95){var k=$$(".jfy_filter_bar .location_attraction .jfy_filter_neighborhood_footer.hidden");if(k.length>0){k.removeClass("hidden");$$("#jfy_filter_bar_neighborhood .location_attraction .jfy_filter_neighborhood_footer.hidden").removeClass("hidden")}}if(l.length>0&&j.length>0){$$(".jfy_filter_bar .location_attraction").addClass("hidden")}}},loadJFYFilterPulldown:function(j,h){if(!ta.retrieve("ta.p13n.jfyFilterPulldown")){var i="p13n_filter_pulldown";var g=new ta.overlays.RelativeOverlayBelow({content:ta.id(i).innerHTML,activate:ta.overlays.ACTIVATE_CLICK_ALTERNATE,closeOnDocumentClick:true,style:"",noPadding:true},h);ta.store("ta.p13n.jfyFilterPulldown",g)}},adjustJFYOverlayPositions:function(){var h=ta.retrieve("ta.p13n.jfyFilterSet");var g=Object.values(h||{});Object.each(g,function(i){if(i.visible){i.hideNow();i.show()}})},loadMetaHotelsFilter:function(j,g,h,i){ta.hac.filters.loadMetaHotelsFilter(j,g,h,i)},loadGuestsRoomsOverlay:function(k,i,j,l){var h=ta.retrieve("ta.overlay.guests_rooms_overlay");if(ta.has("guests_rooms_picker_3.enabled")){l.input=document.getElement(".calendar_wrapper .guests_rooms_picker_container")}else{l.input=document.getElement(".guests_rooms_picker_container")}l.findTargetFunction=function(m){if(ta.has("guests_rooms_picker_3.enabled")&&!ta.has("guests_rooms_picker_4.enabled")&&!ta.has("hotels_rgpicker_outofcalendar")){return document.getElement(".date_picker_calendar.overlay .wrapper_header .roomsGuests")}else{if(m&&m.target){return ta.id(m.target).getParent(".roomsGuests")}}};var g={style:"date_picker_calendar guests_rooms_overlay",moreOptions:l};if(!h){h=new ta.overlays.GuestsRoomsOverlay(g,i);ta.store("ta.overlay.guests_rooms_overlay",h)}h.show(k)},updateMetaHotelsFiltersFromBreadcrumbs:function(j,h,g,i){ta.hac.filters.updateMetaHotelsFiltersFromBreadcrumbs(g,i)},closeAllActiveFilters:function(){ta.hac.filters.closeAllActiveFilters()},hideFilterOverlay:function(k,g,h){var i=ta.retrieve("ta.filters.overlaySet");if(i&&i[h]){var j=i[h];if(j.visible){j.hide()}}},simulateDatePickerClick:function(l,h,k,i,j,g){if(ta.retrieve("datepicker_autoadvance")&&document.getElement(".date_picker_calendar.overlay")){return false}ta.overlays.Factory.loadDatePicker(l,h,k,i,j,g);l.stopPropagation();l.preventDefault();return false},loadVRDatePicker:function(m,h,k,i,j,g){if(!g){g={}}var l=Object.merge({calendarOptions:{isVR:true}},g);ta.overlays.Factory.loadDatePicker(m,h,k,i,j,l)},setDatePickersAsText:function(){var g=ta.id("DEALS");if(g&&g.toggleClass("date_pickers_as_text",true)){g.addClass("date_pickers_as_text")}},unsetDatePickersAsText:function(){var g=ta.id("DEALS");if(g&&g.toggleClass("date_pickers_as_text",false)){g.removeClass("date_pickers_as_text")}},loadDatePicker:function(q,h,j,g,l,r){if(!r){r={}}new Asset.image(CDNHOST+"/img2/generic/site/loading_anim_gry_sml.gif");if(ta.has("isHotelsLander")||ta.isMetaHomepageIntegration2013()||ta.has("widget.customHotel")||ta.has("isDaoDaoHomePageUnforkCalendar")){if(ta.has("isHotelsLander")||j==1||ta.has("isDaoDaoHomePageUnforkCalendar")){r=Object.merge({calendarOptions:{selectionStartClass:"start",selectionEndClass:"end",postContent:function(){var s=Elements.from('<div id="SKIP_DATES"><span class="skip_dates_text"><span class="taLnk">'+ta.retrieve("multiDP.skipDates")+"</span></span></div>")[0];s.getElement(".taLnk").addEvent("click",function(){var u=ta.overlays.getCurrent(),v=u&&u.calendar;v&&v.clear();var t=ta.id("SUBMIT_HOTELS");if(t){t.focus()}ta.widgets.calendar.clearSessionDates(null,function(){if(ta.has("widget.customHotel")){ta.widget.hotels.changeDates()}});if(ta.has("isHotelsLander")){ta.overlays.Factory.trackSkipDatesEvent("Hotels_Lander","Calendar","Skip dates",0)}else{ta.overlays.Factory.trackSkipDatesEvent("Meta_Homepage","Calendar","Skip dates",0)}});return s},onSelect:function(t){if(!t.oneSelected){var s=ta.id("SUBMIT_HOTELS");s&&s.focus()}}}},r)}if(j==1&&ta.has("widget.customHotel")){r.calendarOptions=r.calendarOptions||{};r.calendarOptions.wrapper=Elements.from('<div class="calendar_wrapper"><div class="wrapper_header">'+ta.retrieve("multiDP.header")+'</div><div class="wrapper_inner"></div><div class="wrapper_footer">'+ta.retrieve("multiDP.footer")+"</div>")[0]}if(j==1||j=="vr"){r.calendarOptions=r.calendarOptions||{};r.calendarOptions.submitOnEnter=ta.retrieve("widget.customHotel")?ta.widget.CustomHotelsWidget.validate:ta.pages.home.validate}}else{if(ta.retrieve("checkrates.meta_ui_sk_box_v3")){r=Object.merge({calendarOptions:{selectionStartClass:"start",selectionEndClass:"end"}},r)}}h=ta.id(h);if((ta.has("guests_rooms_picker_3.enabled")&&!ta.has("guests_rooms_picker_4.enabled")&&!ta.has("hotels_rgpicker_outofcalendar")&&!ta.has("hotels_left_filters_redesign"))&&h&&!h.getParent(".geoChkRates")&&(h.getParent(".jfy_header_dates_holder")||h.getParent(".filterControls")||h.getParent(".meta_chevron_module_2014")||h.getParent("#HotelDateSearch")||h.getParent(".HotelHighlight"))){try{ta.meta.update.clearDatesBumpedMessage();r.calendarOptions=r.calendarOptions||{};var n,k,i;if(ta.has("guests_rooms_picker_3.enabled")){k=ta.id(document.getElement(".guestsRoomsDatePickerHeaderForInject.hidden"));n=k?new Element("div").adopt(k.clone()).get("html"):""}k=ta.id(document.getElement(".showPricesForInject.hidden"));i=k?new Element("div").adopt(k.clone()).get("html"):"";r.calendarOptions.wrapper=Elements.from('<div class="calendar_wrapper"><div class="wrapper_header">'+n+'</div><div class="wrapper_inner"></div><div class="wrapper_footer">'+i+"</div>")[0];r.calendarOptions.isGuestsRoomsCalendar=true}catch(m){ta.util.error.record(m,"error building content for guests rooms datepicker wrapper")}}if(!r.calendarOptions){r.calendarOptions={}}if(ta.has("calendar.default.postcontent")&&!r.calendarOptions.postContent){r.calendarOptions.postContent=ta.retrieve("calendar.default.postcontent")}if(r.calendarOptions.isholidayEnable){r.calendarOptions.holidaysOnCalendar=ta.retrieve("calendar.holidays")}r.calendarOptions.classicStyling=true;r.calendarOptions.flights=r.flights;r.calendarOptions.oneWayFlight=r.oneWayFlight;r.calendarOptions.multiCityFlight=r.multiCityFlight;if(r.oneWayFlight||r.multiCityFlight){r.calendarOptions.onSelect="ta.overlays.calendar.select";r.calendarOptions.oneWayStyling=true}if(r.flights){var p=new Date();p.setDate(p.getDate()+ta.util.date.MAX_DAYS_BEFORE_RETURN_FLIGHT);r.calendarOptions.lastDate=p}window.fireEvent("onCalendarSelect",h);r.calendarOptions.onChangeDates=ta.widgets.calendar.onCalendarChangeDates;r.calendarOptions.onRangeSelect=ta.widgets.calendar.onCalendarRangeSelect;if(j=="vr"){var o=new Date();o.setMonth(o.getMonth()+18);o.setDate(1);r.calendarOptions.lastDate=o}ta.overlays.Factory.destroyAnimatedDateCTA();ta.overlays.Factory._loadAvailDateWidget(q,j,"calendar",g,l,r);if(ta.retrieve("load_date_picker_buttons")){return false}},destroyAnimatedDateCTA:function(){if(ta.isMetaHotels2013()||(ta.retrieve("hh_short_cell.enabled")&&ta.widgets.calendar.hasPageDates())){var g;if(ta.retrieve("animate_date_reformat")){g=ta.id("ANIMATED_DATE_CTA_REFORMAT")}else{g=ta.id("ANIMATED_DATE_CTA")}if(g){ta.servlet.HACSearch.destroyAnimatedDateCTA()}}},trackSkipDatesEvent:function(h,i,g,k){try{ta.trackEventOnPage(h,i,g,k,false)}catch(j){}},loadAdultsField:function(l,h,k,i,j,g){if(!g){g={}}if(!g.calendarOptions){g.calendarOptions={}}ta.overlays.Factory._loadAvailDateWidget(l,k,"adults",i,j,g)},_loadAvailDateWidget:function(o,i,h,g,k,p){var m="in",j,n;if(o){o=new Event(o)}if(o&&o.target&&ta.id(o.target).hasClass&&(ta.id(o.target).hasClass("out_date")||(ta.has("guests_rooms_picker_3.enabled")&&ta.id(o.target).hasClass("outDateTrigger")))){m="out"}p.calendarOptions.pickerOption=m;n=ta.widgets.calendar.getCalendarObjectKey(i,g,m);j=ta.retrieve(n);if(j&&j.calendar.positionElement&&ta.id(j.calendar.positionElement).getParent("#PAGE")){j.show(h)}else{try{j=new ta.commerce.AvailDataWidget(o,i,h,g,k,p)}catch(l){ta.util.error.record(l,"load availDateWidget init error")}}},onClickMetaCheckRatesOverlay_allProviders:function(j,h,i,g){ta.overlays.Factory.metaCheckRatesOverlay_allProviders(i,g)},metaCheckRatesOverlay_allProviders:function(m,h){ta.overlays.Factory._recordLBOpen();ta.commerce.meta.clearStoredMiniData();if(ta.retrieve("assisted_booking_desktop_entry.logTreePoll")&&ta.id(h).getParents){var q=ta.id(h).getParents();q.each(function(r){if(r.hasClass("premium_offers_area")){if(ta.meta&&ta.meta.treeTrack&&ta.meta.treeTrack.hasTrackingTree(r)){ta.trk("n_more_sites",false,r)}}else{if(r.hasClass("metaPriceInfo")||(r.hasClass("illisting")&&ta.retrieve("servlet.smartdeals"))){if(ta.meta&&ta.meta.treeTrack){ta.meta.treeTrack.logTreeImpression();ta.trk("n_more_sites",false,r)}}}})}if(ta.retrieve("metaCheckRatesOverlay")){ta.retrieve("metaCheckRatesOverlay").hide()}ta.remove("metaCheckRatesOverlay");if(!ta.has("metaCheckRatesCSS")){ta.store("metaCheckRatesCSS",new Asset.css(metaCheckRatesCSS))}var o=ta.retrieve("pcr.overlay");if(o&&o.visible){o.hide()}var g="";if(ta.meta&&ta.meta.update){g=ta.meta.update.buildUrl("MetaCheckRatesAjax",m,false)}else{g=ta.commerce.checkrates.buildMetaHacUrl_allProviders(m,false,"lb_allProviders",true)}var p="metaCheckRatesOverlay";if(ta.retrieve("meta_lightbox_v3.enabled")){p+=" meta_lightbox_v3"}p+=" metaLightBoxChevron marketingTextLightBox";var j=window.location.hash==="#MAPVIEW"||(ta.id("map0Div")&&ta.id("map0Div").innerHTML!=="");if(j&&ta.retrieve("meta_lightbox_v3.enabled")){p+=" wide"}var k={style:p,backdropClickClose:true,backdrop:ta.overlays.BACKDROP_ALWAYS,closeButtonClass:ta.retrieve("meta_lightbox_v3.enabled")?"closeOverlayLarge":"roundOuterClose",remoteContent:g,onLoad:function(){var w=false,s,v;ta.store("isLightboxOpen",true);try{if(!ta.meta||!ta.meta.update){var t="meta_lb_checkrates";w=new ta.commerce.CheckRatesData({type:t,evnt:null},m,m,true);ta.store("ta.commerce.MetaHacOverlay.crData."+w.vendorSetId,w);v=w.getVendorSet().getAllVendorIds();s=w.getVendorSet().getCheckedVendor();ta.commerce.checkrates.updateMetaProviders(w)}var r=document.getElement(".metaCheckRatesOverlay .roundOuterClose");if(r&&!r.hasClass("no_cpu")){r.className+=" no_cpu"}ta.util.element.makeSameWidth(".metaCheckRatesOverlay .priceBlock");if(this.inner){ta.fireEvent("refreshedDOMContent",this.inner)}}catch(u){ta.util.error.record(u,"meta all providers overlay load issue")}if(ta.meta&&ta.meta.update){ta.meta.update.overlayRequest(m)}else{ta.commerce.checkrates.metaHacRequest(w,v,s)}},evalScripts:true,onClose:function(){ta.store("isLightboxOpen",false);var x="meta_lightbox",w,t;x="meta_lightbox_chevron";ta.trackEventOnPage(x,"close","");if(ta.retrieve("checkrates.meta_ui_post_click_prices")){var A=ta.retrieve("meta.baseLocationId");if(A&&m==A){if(ta.meta&&ta.meta.update){ta.meta.update.request(m)}else{if(t){ta.commerce.meta.updateProvAreaFromLightBox(t.vendorSetId)}}if(ta.has("metaCheckRatesUpdateDivInline")){ta.commerce.meta.updateInlineMeta(m)}}else{if(A){if(ta.has("ta.meta.navArea")){w=ta.retrieve("ta.meta.navArea")}var s=ta.id("MetaPricesTab");var u=false;if(s!=null&&s.hasClass("sprite-tab-active")){u=true}var C=ta.id("LOC_PHOTOS"),B=ta.id("AMENITY_LIGHTBOX"),r=false;if(C||B){r=true}var z=false;if(ta.has("metaCheckRatesUpdateDivInline")){if(u){if(!r){ta.commerce.meta.updateNavArea("QC_Meta_Inline");ta.commerce.meta.updateInlineMeta(A);z=true}else{try{ta.commerce.meta.tracking.setTimingForNavArea("QC_Meta_Inline")}catch(y){ta.util.error.record(y,"problem locking timing in Factory.metaCheckRatesOverlay_allProviders for QC_Meta_Inline")}try{ta.commerce.meta.tracking.setTimingForNavArea("QC_Meta_Mini")}catch(y){ta.util.error.record(y,"problem locking timing in Factory.metaCheckRatesOverlay_allProviders for QC_Meta_Mini")}ta.commerce.meta.updateNavArea("QC_Meta_Mini");if(ta.meta&&ta.meta.update){ta.meta.update.request(m)}else{t=ta.retrieve("ta.commerce.MetaHacOverlay.crData."+A);if(t){ta.commerce.meta.miniMetaAjax(null,t,1000)}}z=true;ta.commerce.meta.tracking.suppressImpressionsForArea("QC_Meta_Inline");ta.commerce.meta.tracking.suppressImpressionsForArea("QC_Meta_Mini");ta.commerce.meta.updateNavArea("QC_Meta_Inline");ta.commerce.meta.updateInlineMeta(A);ta.commerce.meta.tracking.removeSuppressedArea("QC_Meta_Inline");ta.commerce.meta.tracking.removeSuppressedArea("QC_Meta_Mini");try{ta.commerce.meta.tracking.resetTimingLockForNavArea("QC_Meta_Inline")}catch(y){ta.util.error.record(y,"problem un-locking timing in Factory.metaCheckRatesOverlay_allProviders for QC_Meta_Inline")}try{ta.commerce.meta.tracking.resetTimingLockForNavArea("QC_Meta_Mini")}catch(y){ta.util.error.record(y,"problem un-locking timing in Factory.metaCheckRatesOverlay_allProviders for QC_Meta_Mini")}}}else{if(ta.meta&&ta.meta.update){ta.meta.update.request(A)}else{t=ta.retrieve("ta.commerce.MetaHacOverlay.crData."+A);if(t!=null){ta.commerce.meta.updateNavArea("QC_Meta_Mini");ta.commerce.meta.miniMetaAjax(null,t,1000);z=true}}}}if(!ta.meta||!ta.meta.update){t=ta.retrieve("ta.commerce.MetaHacOverlay.crData."+A);if(t!=null&&!z){ta.commerce.meta.updateNavArea("QC_Meta_Mini");ta.commerce.meta.miniMetaAjax(null,t,1000)}}ta.commerce.meta.updateNavArea(w)}}}if(ta.retrieve("metaCheckRatesOverlay")){ta.retrieve("metaCheckRatesOverlay").destroy()}ta.remove("metaCheckRatesOverlay");ta.widgets.calendar.removeMetaCalendarFromSync(m);ta.widgets.calendar.closeCalendarWidgets();if(!ta.retrieve("meta.isDeals")&&(!ta.servlet.hotelsMap||!ta.servlet.hotelsMap.isMapOpen())){if(ta.retrieve("hotels.redesignEnabled")&&ta.retrieve("hotels.shouldIssueAjax")){ta.remove("hotels.shouldIssueAjax");ta.commerce.minimeta.ajax.send()}if(ta.retrieve("hotels.redesignEnabled")&&ta.retrieve("hotels.datesChanged")){ta.commerce.minimeta.doMetaDateSearch()}if(ta.retrieve("hotels.redesignEnabled")&&ta.retrieve("hotels.shouldHideClassicPrices")){var v=document.getElements(".classicPrice");v.each(function(D){D.hide()})}}}};if(ta.retrieve("checkrates.meta_ui_sk_box")||ta.retrieve("checkrates.meta_ui_sk_box_v2")||ta.retrieve("checkrates.meta_ui_sk_box_v3")){k.absoluteOffset=true;if(ta.retrieve("tablet_maps_v1")&&(window.innerHeight>window.innerWidth)){var n=72;var i=ta.find(".flexCard");if(i){n=i.clientHeight+80}k.yOffset=n+window.getScrollTop()}else{k.yOffset=72+window.getScrollTop()}}k.trigger=h;var l=new ta.overlays.CenteredOverlay(k,null);ta.store("metaCheckRatesOverlay",l);if(ta.has("locationPhotoAlbumOverlayResizeHack")){ta.retrieve("locationPhotoAlbumOverlayResizeHack")()}},metaCheckRatesOverlay:function(h,g,q,l){ta.overlays.Factory._recordLBOpen();ta.commerce.meta.clearStoredMiniData();ta.store("metaCheckRatesOverlay",null);if(!ta.has("metaCheckRatesCSS")){ta.store("metaCheckRatesCSS",new Asset.css(metaCheckRatesCSS))}var n=ta.retrieve("pcr.overlay");if(n&&n.visible){n.hide()}var p="";if(ta.meta&&ta.meta.update){if(!ta.has("ta.meta.request.locId")){return}p=ta.meta.update.buildUrl("MetaCheckRatesAjax",ta.retrieve("ta.meta.request.locId"),false)}else{p=ta.commerce.checkrates.buildMetaHacUrl(h,g,q,false)}var o="metaCheckRatesOverlay";if(ta.retrieve("meta_lightbox_v3.enabled")){o+=" meta_lightbox_v3"}o+=" metaLightBoxChevron";var i=window.location.hash==="#MAPVIEW"||(ta.id("map0Div")&&ta.id("map0Div").innerHTML!=="");if(i&&ta.retrieve("meta_lightbox_v3.enabled")){o+=" wide"}var j={style:o,backdropClickClose:true,backdrop:ta.overlays.BACKDROP_ALWAYS,closeButtonClass:ta.retrieve("meta_lightbox_v3.enabled")?"closeOverlayLarge":"roundOuterClose",remoteContent:p,onLoad:function(){if(ta.meta&&ta.meta.update){if(!ta.has("ta.meta.request.locId")){return}ta.meta.update.overlayRequest(ta.retrieve("ta.meta.request.locId"))}else{ta.commerce.checkrates.updateMetaProviders(h);ta.commerce.checkrates.metaHacRequest(h,g,q)}var r=document.getElement(".metaCheckRatesOverlay .roundOuterClose");if(r){r.className+=" no_cpu"}},evalScripts:true,onClose:function(){var s=this.source&&this.source.getParent(".gcrabLb");var r="meta_lightbox_chevron";ta.trackEventOnPage(r,"close","");if(!s){ta.overlays.Factory.updateMiniMetaPlacements(h)}k.destroy();if(!s){ta.store("metaCheckRatesOverlay",null);if(ta.meta&&ta.meta.update){if(!ta.has("ta.meta.request.locId")){return}ta.widgets.calendar.removeMetaCalendarFromSync(ta.retrieve("ta.meta.request.locId"))}else{ta.widgets.calendar.removeMetaCalendarFromSync(h.vendorSetId)}ta.widgets.calendar.closeCalendarWidgets();if(ta.retrieve("hotels.redesignEnabled")&&ta.retrieve("hotels.shouldIssueAjax")){ta.remove("hotels.shouldIssueAjax");ta.commerce.minimeta.ajax.send()}if(ta.retrieve("hotels.redesignEnabled")&&ta.retrieve("hotels.datesChanged")&&!ta.id("LOC_PHOTOS")&&pageServlet!="SmartDeals"){ta.commerce.minimeta.doMetaDateSearch();ta.remove("hotels.datesChanged")}if(ta.retrieve("hotels.redesignEnabled")&&ta.retrieve("hotels.shouldHideClassicPrices")){var t=document.getElements(".classicPrice");t.each(function(u){u.hide()})}}}};if(!j.trigger){var m=ta.retrieve("ta.hlb_el");if(m){j.trigger=m}}if(ta.retrieve("checkrates.meta_ui_sk_box")||ta.retrieve("checkrates.meta_ui_sk_box_v2")||ta.retrieve("checkrates.meta_ui_sk_box_v3")){j.absoluteOffset=true;j.yOffset=72+window.getScrollTop()}var k=new ta.overlays.CenteredOverlay(j,l);ta.store("metaCheckRatesOverlay",k);if(ta.has("locationPhotoAlbumOverlayResizeHack")){ta.retrieve("locationPhotoAlbumOverlayResizeHack")()}},updateMiniMetaPlacements:function(j){var o=ta.retrieve("meta.baseLocationId"),l;if(!o&&ta.id("LOC_PHOTOS")){var s=ta.id("LOC_PHOTOS").getElement("#CHECK_RATE");if(s&&/id_(\d+)/.test(s.className)){o=RegExp.$1}}if(ta.has("ta.meta.navArea")){l=ta.retrieve("ta.meta.navArea")}if(o){var i=ta.id("MetaPricesTab");var k=false;if(i!=null&&i.hasClass("sprite-tab-active")){k=true}var t=ta.id("LOC_PHOTOS");var q=ta.id("AMENITY_LIGHTBOX");var h=ta.id("CHECK_RATES_LB");var g=false;if(t||q||h){g=true}var n=false;if(ta.has("metaCheckRatesUpdateDivInline")){if(k){if(g){try{ta.commerce.meta.tracking.setTimingForNavArea("QC_Meta_Inline")}catch(m){ta.util.error.record(m,"problem locking timing in Factory.metaCheckRatesOverlay for QC_Meta_Inline")}try{ta.commerce.meta.tracking.setTimingForNavArea("QC_Meta_Mini")}catch(m){ta.util.error.record(m,"problem locking timing in Factory.metaCheckRatesOverlay for QC_Meta_Mini")}ta.commerce.meta.updateNavArea("QC_Meta_Mini");if(ta.meta&&ta.meta.update){ta.meta.update.request(o)}else{if(typeof(dd)!=="undefined"&&dd.commerce&&dd.commerce.checkrates){dd.commerce.checkrates.checkRatesMiniMeta(null,document.getElementById("CHECK_RATE"),o,"checkrates")}}n=true;ta.commerce.meta.tracking.suppressImpressionsForArea("QC_Meta_Inline");ta.commerce.meta.tracking.suppressImpressionsForArea("QC_Meta_Mini");ta.commerce.meta.updateNavArea("QC_Meta_Inline");ta.commerce.meta.updateInlineMeta(o);ta.commerce.meta.tracking.removeSuppressedArea("QC_Meta_Inline");ta.commerce.meta.tracking.removeSuppressedArea("QC_Meta_Mini");try{ta.commerce.meta.tracking.resetTimingLockForNavArea("QC_Meta_Inline")}catch(m){ta.util.error.record(m,"problem un-locking timing in Factory.metaCheckRatesOverlay_allProviders for QC_Meta_Inline")}try{ta.commerce.meta.tracking.resetTimingLockForNavArea("QC_Meta_Mini")}catch(m){ta.util.error.record(m,"problem un-locking timing in Factory.metaCheckRatesOverlay_allProviders for QC_Meta_Mini")}}else{if(ta.retrieve("checkrates.meta_ui_post_click_prices")&&ta.widgets.calendar.datesExist()){ta.commerce.meta.updateNavArea("QC_Meta_Inline");ta.commerce.meta.updateInlineMeta(o);n=true}}}else{if(ta.retrieve("checkrates.meta_ui_post_click_prices")&&ta.widgets.calendar.datesExist()){ta.commerce.meta.updateNavArea("QC_Meta_Mini");if(ta.meta&&ta.meta.update){ta.meta.update.request(o)}else{if(typeof(dd)!=="undefined"&&dd.commerce&&dd.commerce.checkrates){dd.commerce.checkrates.checkRatesMiniMeta(null,document.getElementById("CHECK_RATE"),o,"checkrates")}}n=true}}}if((ta.retrieve("checkrates.meta_ui_post_click_prices")||t)&&ta.widgets.calendar.datesExist()&&!n){ta.commerce.meta.updateNavArea("QC_Meta_Mini");var p=document.getElementById("CHECK_RATE");if(!ta.retrieve("checkrates.meta_ui_post_click_prices")&&t){p=t.getElement("#CHECK_RATE");if(ta.retrieve("hotels.redesignEnabled")&&ta.retrieve("hotels.datesChanged")){var r=t.getParent(".overlay");if(r&&r.overlay){r.overlay.addEvent("onHide",function(){ta.commerce.minimeta.doMetaDateSearch()})}}}if(ta.meta&&ta.meta.update){ta.meta.update.request(o)}else{if(typeof(dd)!=="undefined"&&dd.commerce&&dd.commerce.checkrates){dd.commerce.checkrates.checkRatesMiniMeta(null,p,o,"checkrates",true)}}}}else{if(j){ta.commerce.meta.updateInlineMeta(j.vendorSetId)}}ta.commerce.meta.updateNavArea(l)},createPersistentFilterOverlay:function(){var h=document.getElement(".filterControls");if(!h){return}var g={toWindow:false,autoShow:false,yOffset:-60,permanent:true,showCloseButton:false,style:"persistentFilterOverlay",positionType:"fixed",innerDivClass:h.className,onShow:function(){ta.util.element.moveContent(h,this.inner)},onHide:function(){ta.util.element.moveContent(this.inner,h)}};ta.store("persistentFiltersOverlay",new ta.overlays.AbsoluteOverlay(g));window.addEvent("scroll",ta.servlet.HACSearch.showPersistentFilters)},_recordLBOpen:function(){if(!ta.remove("skipLBGARecord")){var g=ta.remove("meta.lightboxOpener")||(ta.retrieve("meta.calendarCR")?"calendar":"button");var h="meta_lightbox_chevron";ta.trackEventOnPage(h,"open",g)}},createTAListingPolicyOverlay:function(h,g,j,i){var k=ta.id(j);if(k!=null){new ta.overlays.CenteredOverlay({style:"s3 dg rgba_gry",backdrop:ta.overlays.BACKDROP_ALWAYS,content:k.get("html"),isChild:i},null)}},greenLeaderTrack:function(m){var l=window.location.href.match(/\/\/.*?\/([^-?]+)/)[1];var k=m.target.className;var g=m.target.id;if(l){var i="GreenLeaders";var j;var h;if(l==="Hotels"||l==="HACSearch"){j="HOTELS"}else{if(l==="Hotel_Review"||l==="ShowUserReviews"){j="HR"}else{if(l==="UserReviewEdit"){j="REVIEW_FORM"}}}if(k.match("seeFullLnk")){h="SEE_ALL"}else{if(k.match("greenLeaderLabelLnk")){h="GREEN_LEADERS_BADGE"}else{if(g.match("ReportIAP")){h="REPORT_PROBLEM"}}}if(i&&j&&h){ta.trackEventOnPage(i,j,h)}}},greenLeaderOverlay:function(l,j,i,k){if(l||window.event){new Event(l||window.event).preventDefault()}ta.overlays.Factory.greenLeaderTrack(new Event(l));var g="/GreenLeaderAjax?locationId="+i+"&showSummary="+k;if(ta.retrieve("greenLeaderOverlay")){ta.retrieve("greenLeaderOverlay").loadRemoteContent(g,true)}else{var h=new ta.overlays.CenteredOverlay({style:"tooltip ttWhite big",autoShow:false,delayedPosition:true,backdrop:ta.overlays.BACKDROP_ALWAYS,permanent:true,showCloseButton:true,backdropClickClose:true,zIndex:2001,onLoad:function(){if(ta.retrieve("greenLeaderOverlay")){this.show()}else{this.show.delay(200,this);ta.store("greenLeaderOverlay",this)}}},j);h.loadRemoteContent(g,true)}},certificateOfExcellenceOverlay:function(j,h,g){if(j||window.event){new Event(j||window.event).preventDefault()}ta.trackEventOnPage("CertificatOfExcellence",g,"Certificate_Of_Excellence_Badge");var i=ta.id("COE_OVERLAY_CONTENTS");if(i){return new ta.overlays.CenteredOverlay({style:"tooltip ttWhite big coeOverlay",backdrop:ta.overlays.BACKDROP_ALWAYS,delayedPosition:true,showCloseButton:true,backdropClickClose:true,zIndex:2001},h).loadRemoteSuccess(i.innerHTML)}return null},miniMetaCrossSellMicroOverlay:function(s,j,n,i){try{j.onmouseover=null;j.onclick=null;var g;if(ta.meta&&ta.meta.update){g=ta.meta.update.buildUrl("MicroMetaAjax",n,true,false,"QC_Meta_Mini|Related_XSell")}else{var l=new ta.commerce.CheckRatesData({type:"checkrates",evnt:s},j,n,true);var k=l.getVendorSet().getCheckedContentID();var u=l.getVendorSet().getCheckedVendor();var t=ta.retrieve("meta.travelData");t=ta.commerce.checkrates.getTravelDataFromDOM();g=ta.commerce.checkrates.buildVarMetaHacUrl("MicroMetaAjax",l,k,u,true,null,"QC_Meta_Mini|Related_XSell",t)}g+="&lowContentID="+i;g+="&drop=true";var p=j.className.match(/noDelayFirst/);var r=j.className.match(/delayOpen/);var o=ta.retrieve("delayedFirst");var h=!r||(p&&!o);var m=new ta.overlays.RelativeOverlayBelow({style:"",allowFlip:false,activate:ta.overlays.ACTIVATE_HOVER_DELAY,autoShow:h,delayShow:r,offsetLeft:0,offsetTop:-20,showCloseButton:false},j);m.loadRemoteContent(g,false);ta.store("delayedFirst",true)}catch(q){ta.util.error.record(q,"ta.overlays.factory.miniMetaCrossSellMicroOverlay")}},helpCenterLB:function(g,h){try{if(g||window.event){new Event(g||window.event).preventDefault()}new ta.overlays.CenteredOverlay({style:"s3 dg help_center",showCloseButton:true,backdropClickClose:true,backdrop:ta.overlays.BACKDROP_ALWAYS,remoteContent:"/uvpages/helpCenterOverlay.html"},h)}catch(i){ta.util.error.record(i,"ta.overlays.factory.helpCenterLB")}return false},installmentRateTip:function(h,g){g=ta.id(g);new ta.overlays.RelativeOverlayAbove({style:"",innerDivClass:"installmentRateTipOverlay",activate:ta.overlays.ACTIVATE_HOVER,pinnable:ta.overlays.PINNABLE_CLICK,allowFlip:true,content:"<span>"+ta.retrieve("meta.paymentsTipText")+"</span>"},g)},jfyMoreTagOverlay:function(h,g,j){if(h){new Event(h).stop()}var i=ta.id(j);i=i.clone();new ta.overlays.RelativeOverlayAbove({style:"moreTagOverlay",activate:ta.overlays.ACTIVATE_HOVER,showCloseButton:false,content:i.innerHTML},g)},starAttributionOverlay:function(h,g){ta.common.flyout.starAttribution(h,g)},tripTypeSelectOverlay:function(i,g){if(!g||!i){return}g.onclick=null;i.stop();ta.trackEventOnPage("Reviews_Controls","filter_dropdown","");var h=document.getElement(".tripTypeOverlayContents");if(!h){return}h.show();new ta.overlays.RelativeOverlayBelow({style:"tripTypeSelectOverlay",activate:ta.overlays.ACTIVATE_CLICK,showCloseButton:false,content:h,offsetTop:3},g)},languageFilterSelectOverlay:function(i,g){if(!g||!i){return}g.onclick=null;i.stop();var h=document.getElement(".languageList");if(!h){return}h.show();new ta.overlays.RelativeOverlayRight({style:"tripTypeSelectOverlay",activate:ta.overlays.ACTIVATE_HOVER,showCloseButton:false,content:h,offsetLeft:-13},g)},reviewLanguageOverlay:function(i,g){if(!g||!i){return}g.onclick=null;i.stop();var h=document.getElement(".languageList");if(!h){return}var j=g.getSize().x-16;new ta.overlays.RelativeOverlayBelow({style:"reviewLanguageOverlay",activate:ta.overlays.ACTIVATE_CLICK,showCloseButton:false,content:h,offsetTop:1,offsetLeft:j},g)},reviewSeasonOverlay:function(i,g){if(!g||!i){return}g.onclick=null;i.stop();var h=document.getElement(".seasonList");if(!h){return}new ta.overlays.RelativeOverlayBelow({style:"reviewLanguageOverlay",activate:ta.overlays.ACTIVATE_CLICK_TOGGLE,showCloseButton:false,content:h,offsetTop:1},g)},topDestinationsOverlay:function(i,g){if(!g||!i){return}g.onclick=null;i.stop();var h=document.getElement(".topDestinationsList");if(!h){return}new ta.overlays.RelativeOverlayBelow({style:"topDestinationsOverlay",activate:ta.overlays.ACTIVATE_CLICK_TOGGLE,showCloseButton:false,content:h,offsetTop:1},g)},translationRatingsOverlay:function(j,g){if(!g||!j){return}g.onclick=null;j.stop();var i=g.getParent("form");if(i){var h=i.getElement(".ratingList");if(!h){return}new ta.overlays.RelativeOverlayBelow({style:"mtRatingOverlay",noPadding:true,activate:ta.overlays.ACTIVATE_CLICK,showCloseButton:false,content:h},g)}},installExitInterrupter:function(){ta.servlet.HotelReview.installExitInterrupter()},ipLearnMoreMenu:function(h,g){if(!g||!h){return}g.onclick=null;h.stop();new ta.overlays.RelativeOverlayBelow({activate:ta.overlays.ACTIVATE_CLICK,style:"dropMenu dropMenu_refresh"},g);new Request({url:"/ActionRecord?action=FBIP-PersistentHeader-Flyout"}).send()},logTrackingTree:function(){var g=document.getElement(".micro_meta_flyout");if(g){var h=g.getElement(".impressionTrackingTree");if(h){ta.trkImpTree(h)}}},loadDatePickerOverlay:function(i,h,g){ta.call("ta.p13n.wizard.loadDatePickerOverlay",i,h,g)},racLBDelegates:function(){function g(){}function h(){}return{onLoad:g,onClose:h}},racGeoSearchDelegates:function(g){return{onLoad:function(){ta.restaurantAvailabilitySearch.init(g)}}},createSearchPageScopeSelect:function(g,h){if(!g||!h){return}return new ta.overlays.RelativeOverlayBelow({style:"geo_select_flyout",closeOnDocumentClick:true,content:h},g)},rrBaselineSurveyOverlay:function(){var h=new ta.overlays.CenteredOverlay({showCloseButton:false,backdrop:ta.overlays.BACKDROP_ALWAYS,style:"rrBaselineSurveyOverlay",onShow:function(){localStorage.setItem("rrBaselineSurveySeen",true);ta.trackEventOnPage("rrsat_survey","offered","")}});var i=new Element("h1").set("text",ta.retrieve("r_survey_title"));var n=new Element("p").set("text",ta.retrieve("rr_survey_p1"));var m=new Element("p").set("text",ta.retrieve("rr_survey_p2"));var g=new Element("div").set("text",ta.retrieve("rr_survey_yes")).addClass("rndBtn rndBtnGreen rndBtnLarge yesButton");g.addEvent("click",function(){var p="http://tripadvisor.fluidsurveys.com/s/rrsat/";var r=window.posLocale&&window.posLocale.substr(0,2);if(r==="en"||r==="el"){r="eng"}else{if(r==="iw"){r="he"}}if(r){p+="lang"+r+"/"}var q={};if(ta.has("rr_survey_session")){q.sid=ta.retrieve("rr_survey_session")}if(ta.has("rr_survey_pgps")){q.pgps=ta.retrieve("rr_survey_pgps")}p+="?"+Object.toQueryString(q);ta.trackEventOnPage("rrsat_survey","accepted","");window.open(p,"rr_baseline_survey","menubar=no,location=no,resizable=yes,scrollbars=yes,status=yes,width=800,height=500");h.hide()});var o=new Element("div").set("text",ta.retrieve("rr_survey_no")).addClass("rndBtn rndBtnLarge noButton");o.addEvent("click",function(){h.hide();ta.trackEventOnPage("rrsat_survey","declined","")});var l=new Element("div").addClass("buttons");l.adopt(g,o);var j=new Element("div");j.adopt(i,n,m,l);h.inner.setContent(j);h.show();var k=function(p){if(p.keyCode==27){h.hide();document.removeEvent("keyup",k)}};document.addEvent("keyup",k)},loadingMostRecentDraftOverlay:function(h,i){if(h){var g=new ta.overlays.CenteredOverlay({showCloseButton:false,backdrop:ta.overlays.BACKDROP_ALWAYS,content:h.innerHTML,backdropColor:"#FFF",backdropOpacity:0.8,style:"loadingMostRecentDraftOverlay"});i();setTimeout(function(){g.hide()},3000)}},taSupportOverlay:function(g){if(!g){return}new ta.overlays.CenteredOverlay({showCloseButton:true,content:g.innerHTML,backdrop:ta.overlays.BACKDROP_ALWAYS,style:"taSupportOverlay",closeButtonClass:"xCloseGreen"})}}})();ta.maps.PinSet=(function(b){return new Class({Implements:[Options,Events],options:{autoDeselect:false,autoResetOutOfBounds:false,addPinIcons:function(){this.map.addIcon("SocialBlue",Object.merge(b.maps.MARKER_SOCIAL_PIN,{name:"SocialBlue"}));this.map.addIcon("SocialGreen",Object.merge(b.maps.MARKER_SOCIAL_PIN,{name:"SocialGreen"}));this.map.addIcon("SocialPink",Object.merge(b.maps.MARKER_SOCIAL_PIN,{name:"SocialPink"}));this.map.addIcon("SocialGray",Object.merge(b.maps.MARKER_SOCIAL_PIN,{name:"SocialGray"}))},choosePinIcon:function(k,m,l,j){if(k&&(m||l||j)){return"SocialGray"}if(j){return"SocialPink"}if(l){return"SocialGreen"}if(m){return"SocialBlue"}return null}},map:null,selectedLocId:null,initialize:function c(k,j){this.setOptions(j);this.pins={};this.map=k;this.map.addEvent("onMarkerClick",this._clickMarker.bind(this));this.options.addPinIcons.bind(this)()},_clickMarker:function i(j){this.selectPin(j.lid,true)},addPin:function a(p,o,l,n){var m=this.pins[p];if(m){if(m.marker){this.map.removeMarker(m.marker,m.type)}}if(!n){n={been:1,want:0,fave:0}}if(n.fave===1){n.been=1}var k=null;var j=null;if(this.options.choosePinIcon){j=this.options.choosePinIcon(this.selectedLocId==p,n.been,n.want,n.fave);if(j){k=this.map.createMarker({lat:o,lng:l},j,{typeName:"mapPinHover"});if(k){k.lid=p;this.pins[p]={marker:k,type:j,types:n,lat:o,lng:l};this.map.addMarker(k,j);if(this.options.autoResetOutOfBounds&&!this.map.mapBounds().containsLatLng(new b.maps.Location(o,l))){this.map.reset()}}}}},delPin:function h(k){var j=this.pins[k];if(j){if(j.marker){this.map.removeMarker(j.marker,j.type)}delete this.pins[k];if(this.selectedLocId==k){this.selectPin()}}},deleteAllPins:function f(){for(var j in this.pins){if(this.pins.hasOwnProperty(j)){this.delPin(j)}}},modPin:function g(o,l,m){var k=this.pins[o];if(k){var n=k.lat;var j=k.lng;if(l){if(m=="del"){k.types[l]=0;if(l==="been"){k.types.fave=0}}else{k.types[l]=1;if(l==="fave"){k.types.been=1}}}if(this.selectedLocId==o&&k.types.been==0&&k.types.want==0&&k.types.fave==0&&this.options.autoDeselect){this.selectPin()}this.addPin(o,k.lat,k.lng,k.types)}},hasPin:function e(j){return !!this.pins[j]},selectPin:function d(l,k){var j=this.selectedLocId;if(l==j){return}this.selectedLocId=l;if(j){this.modPin(j);this.fireEvent("onDeselect",j)}if(l){this.modPin(l);this.fireEvent("onSelect",l)}this.fireEvent("onSelectedPinChange",{oldLocationId:j,newLocationId:l,userClick:k})}})}(ta));var Observer=new Class({Implements:[Options,Events],options:{periodical:false,delay:1000},initialize:function(c,a,b){this.setOptions(b);this.addEvent("onFired",a);this.element=$(c);this.listener=this.fired.bind(this);this.value=this.element.get("value");if(this.options.periodical){this.timer=this.listener.periodical(this.options.periodical)}else{this.element.addEvent("keyup",this.listener)}},fired:function(){var a=this.element.get("value");if(this.value==a){return}this.clear();this.value=a;this.timeout=this.fireEvent("onFired",[a],this.options.delay)},clear:function(){clearTimeout(this.timeout);return this}});var Autocompleter={Ajax:{}};Autocompleter.Base=new Class({Implements:[Options,Events],options:{minLength:1,useSelection:true,markQuery:true,inheritWidth:true,maxChoices:10,injectChoice:null,onSelect:function(){},onShow:function(){},onHide:function(){},customTarget:null,className:"autocompleter-choices",zIndex:997,observerOptions:{},fxOptions:{},overflown:null,selectOnBlur:false,delayHide:false,choiceStyles:{}},initialize:function(b,a){if(typeof(autocompleteCss)!=="undefined"&&!ta.has("ta.autocompleteCss")){ta.store("ta.autocompleteCss",Asset.css(autocompleteCss))}this.setOptions(a);this.options.choiceStyles.zIndex=this.options.zIndex;this.element=$(b);this.build();this.observer=new Observer(this.element,this.prefetch.bind(this),Object.merge({delay:100},this.options.observerOptions));this.value=this.observer.value;this.queryValue=null},build:function(){if($(this.options.customTarget)){this.choices=this.options.customTarget}else{this.choices=new Element("ul",{"class":this.options.className,styles:this.options.choiceStyles}).inject(document.body)}this.fix=new OverlayFix(this.choices);this.fx=new Fx.Tween(this.choices,Object.merge({property:"opacity",link:"cancel",duration:200},this.options.fxOptions));this.fx.addEvent("complete",function(){if(this.fx.now){return}if(this.choices.get("opacity")==1){this.fix.show()}else{this.fix.hide()}}.bind(this));if(this.choices&&this.choices.set){this.choices.set("opacity",0)}this.element.setProperty("autocomplete","off").addEvent(Browser.ie||Browser.safari||Browser.chrome?"keydown":"keypress",this.onCommand.bind(this)).addEvent("mousedown",this.onCommand.bind(this).partial(Function._,true)).addEvent("focus",this.toggleFocus.bind(this,true)).addEvent("blur",this.toggleFocus.bind(this,false)).addEvent("trash",this.destroy.bind(this))},destroy:function(){this.choices.dispose()},toggleFocus:function(a){if(!a&&this.focussed&&this.options.selectOnBlur&&this.selected&&this.visible){this.choiceSelect(this.selected)}this.focussed=a;if(!a){this.hideChoices()}},onCommand:function(b,a){if(a&&this.focussed){this.prefetch()}if(b.key&&!b.shift){switch(b.key){case"enter":if(this.selected&&this.visible){this.choiceSelect(this.selected);b.stop()}return;case"up":case"down":if(this.observer.value!=(this.value||this.queryValue)){this.prefetch()}else{if(this.queryValue===null){break}else{if(!this.visible){this.showChoices()}else{this.choiceOver((b.key=="up")?this.selected.getPrevious()||this.choices.getLast():this.selected.getNext()||this.choices.getFirst());this.setSelection()}}}b.stop();return;case"esc":this.hideChoices();return}}this.value=false},setSelection:function(){var c=this.getValue();if(!this.options.useSelection){return}var b=this.queryValue.length;if(c.indexOf(this.queryValue)!=0){return}var a=this.selected.inputValue.substr(b);this.value=this.observer.value=this.getValue()},hideChoices:function(){if(!this.visible){return}this.visible=this.value=false;this.observer.clear();if(!this.options.delayHide){this.fx.start(0)}this.fireEvent("onHide",[this.element,this.choices])},showChoices:function(){if(this.visible||!this.choices.getFirst()){return}this.visible=true;var b=this.element.getCoordinates(this.options.overflown);var a=b.left;if(ta.util.i18n.isRtl()){a=Window.getWidth()-b.right;this.choices.setStyles({right:a,top:b.bottom})}else{this.choices.setStyles({left:a,top:b.bottom})}if(this.options.inheritWidth){this.choices.setStyle("width",b.width)}this.fx.cancel();this.fx.start(1);this.choiceOver(this.choices.getFirst());this.fireEvent("onShow",[this.element,this.choices])},isCJKLocale:function(){var a=window.cookieDomain;return ta.has("isDaoDao")||".tripadvisor.com.tw"==a||".tripadvisor.jp"==a||".tripadvisor.co.kr"==a},isCJKString:function(b){for(var a=0;a<b.length;a++){var d=b.charCodeAt(a);if(d>=19968&&d<=40959){return true}else{if(d>=12352&&d<=12543){return true}else{if(d>=44032&&d<=55295){return true}}}}return false},prefetch:function(){var a=this.getValue();if(a.length<this.options.minLength&&false==this.isCJKLocale()){this.hideChoices()}else{if(this.isCJKLocale()&&false==this.isCJKString(a)&&a.length<this.options.minLength){this.hideChoices()}else{if(a==this.queryValue){this.showChoices()}else{this.query()}}}},updateChoices:function(a){this.choices.empty();this.selected=null;if(!a||!a.length){return}if(this.options.maxChoices<a.length){a.length=this.options.maxChoices}a.each(this.options.injectChoice||function(b,c){var d=new Element("li").set("html",this.markQueryValue(b));d.inputValue=b;this.addChoiceEvents(d).inject(this.choices)},this);this.showChoices()},choiceOver:function(a){if(this.selected){this.selected.removeClass("autocompleter-selected")}this.selected=a.addClass("autocompleter-selected")},choiceOff:function(a){if(this.selected){this.selected.removeClass("autocompleter-selected")}this.selected=null},choiceSelect:function(a){this.observer.value=this.element.value=a.inputValue;this.hideChoices();this.fireEvent("onSelect",[this.element],20)},getValue:function(){return this.element.value.stripTags()},markQueryValue:function(a){return(this.options.markQuery&&this.queryValue)?a.replace(new RegExp("("+this.queryValue.escapeRegExp()+")","i"),'<span class="autocompleter-queried">$1</span>'):a},addChoiceEvents:function(a){return a.addEvents({mouseover:this.choiceOver.bind(this,a),mousedown:this.choiceSelect.bind(this,a),mouseout:this.choiceOff.bind(this,a)})}});Autocompleter.Local=new Class({Extends:Autocompleter.Base,options:{minLength:0,filterTokens:null},initialize:function(b,c,a){this.parent(b,a);this.tokens=c;if(this.options.filterTokens){this.filterTokens=this.options.filterTokens.bind(this)}},query:function(){this.hideChoices();this.queryValue=this.getValue();this.updateChoices(this.filterTokens())},filterTokens:function(a){var b=new RegExp("^"+this.queryValue.escapeRegExp(),"i");return this.tokens.filter(function(c){return b.test(c)})}});Autocompleter.Ajax.Base=new Class({Extends:Autocompleter.Base,options:{postVar:"value",postData:{},ajaxOptions:{},onRequest:function(){},onComplete:function(){}},lastQueryRequested:null,lastQueryExecuted:null,ajaxRequest:null,initialize:function(d,b,a){this.parent(d,a);this.ajax=new Request(Object.merge({url:b,autoCancel:true},this.options.ajaxOptions));this.ajax.addEvent("onComplete",this.queryResponse.bind(this));this.ajax.addEvent("onFailure",this.queryResponse.bind(this,false));var c=b.match("action=(\\w+)");if(c&&c[1]){this.action=c[1]}},query:function(){var b=this.getValue();if(this.options.typeaheadPrefix){b=this.options.typeaheadPrefix+b}if(this.ajaxRequest&&this.ajaxRequest.isRunning()){this.lastQueryRequested=b}else{this.lastQueryRequested=null;this.lastQueryExecuted=b;var a=Object.append({},this.options.postData);a[this.options.postVar]=b;this.fireEvent("onRequest",[this.element,this.ajax]);this.ajaxRequest=this.ajax.send({data:a})}},queryResponse:function(a){if(this.lastQueryRequested&&(!this.lastQueryExecuted||this.lastQueryExecuted!=this.lastQueryRequested)){this.query();return}this.value=this.queryValue=this.getValue();this.selected=false;this.hideChoices();this.fireEvent(a?"onComplete":"onFailure",[this.element,this.ajax],20)}});Autocompleter.Ajax.Json=new Class({Extends:Autocompleter.Ajax.Base,queryResponse:function(a){this.parent(a);var b=JSON.decode(a||false);if(!b||!b.length){return}this.updateChoices(b)}});Autocompleter.Ajax.Xhtml=new Class({Extends:Autocompleter.Ajax.Base,options:{parseChoices:null},queryResponse:function(a){this.parent(a);if(!a){return}this.choices.set("html",a).getChildren().each(this.options.parseChoices||this.parseChoices,this);this.showChoices()},parseChoices:function(a){var b=a.innerHTML;a.inputValue=b;a.set("html",this.markQueryValue(b))}});var OverlayFix=new Class({initialize:function(a){this.element=$(a);if(Browser.ie6){this.element.addEvent("trash",this.destroy.bind(this));this.fix=new IFrame({frameborder:"0",scrolling:"no",src:"javascript:false;",styles:{position:"absolute",border:"none",display:"none",filter:"progid:DXImageTransform.Microsoft.Alpha(opacity=0)"}}).inject(this.element,"after")}},show:function(){if(this.fix){var a=this.element.getSize();var b=this.element.getPosition();this.fix.setStyles({width:a.x,height:a.y,left:b.x,top:b.y,display:"block",zIndex:(this.element.getStyle("zIndex")||1)-1})}return this},hide:function(){if(this.fix){this.fix.setStyle("display","none")}return this},destroy:function(){this.fix.dispose()}});(function(b,c,a){b.Entity.extend("modules.travelmap.entity.Pin",{defaults:{flags:[]},flagToOGAction:{been:"pin",want:"going",fave:"favorite"},fetch:function(){var d={memberId:this.get("member"),locationId:this.get("location.id")};return b.Entity.prototype.fetch.call(this,d)},toggleFlag:function(f,i,h,j,g){if(this.locked){return new a.util.Deferred().reject()}var e=this.get("flags");var d=this.get("flags").indexOf(f)==-1;this.locked=true;this.set("loading",true,false);if(d){e.add(f=="fave"&&!e.contains("been")?["been","fave"]:f)}else{e.remove(f=="been"&&e.contains("fave")?["been","fave"]:f)}return this.save(f,i,d,h,j,g).failure(function(){if(d){e.remove(f)}else{e.add(f)}}).always(function(){this.locked=false;this.set("loading",false,false)},this)},save:function(l,d,h,e,j,m){var i=e+"_"+l+"-"+(h?"pin":"unpin");var n=null;var f={module:e,action:l+"-"+(h?"pin":"unpin"),context:(typeof m==="undefined")?null:m};a.util.action.record(i,n,f);var g=this.get("flags");var k={locationId:this.get("location.id"),source:d,currentFlags:g.toJSON()};k[l]=h;return b.Entity.prototype.save.call(this,k).success(function(){if(j){this.ogPublish(l,h)}},this)},ogPublish:function(f,d){var i=a.retrieve("graphTAUser");if(!i){return}var h={type:this.get("location.type"),url:this.get("location.url"),redistributable:this.get("location.redistributable"),lat:this.get("location.lat"),lng:this.get("location.lng")};var e=[this.flagToOGAction[f]];var g={suppressFeed:false,suppressMap:false};i.updateMap();if(d){return i.pin(h,e,g)}return i.removePin(h,e)}})}(ox,modules,ta));(function(a,b){a.Entity.extend("modules.membercenter.entity.CityTile",{prefilter:function(c,d){if(c=="attractions"&&this.get(c)!=null){return true}return false}})}(ox,modules));(function(a,b){a.Stream.extend("modules.membercenter.collection.CityTiles",{initialize:function(){this.resetting=false},update:function(c){if(c.getOffset()==this.getOffset()&&c.length==this.length){return true}return a.Stream.prototype.update.apply(this,arguments)},arrayEach:function(e,f,g){for(var d=0,c=e.length;d<c;d++){if(d in e){f.call(g,e[d],d,e)}}},reset:function(e,c){var d=!this.resetting;this.arrayEach(this.getIdKeys(),function(g){d=d&&this.getParam(g)==e.getParam(g)},this);if(!d){return a.Stream.prototype.reset.apply(this,arguments)}this.resetting=true;var f=this.getParams();f.limit=e.getParam("offset")+e.getParam("limit");f.offset=0;this.fetch(f).success(function(){this.resetting=false}.bind(this));return e}})}(ox,modules));(function(a,b){a.Model.extend("modules.common.model.ListViewModel",{defaults:{begin:function(){return(this.get("page")-1)*+this.get("itemsPerPage")},end:function(c){return this.get("page")*+this.get("itemsPerPage")}},next:function(){this.set("page",+this.get("page")+1);return this},previous:function(){var c=+this.get("page");if(c>1){this.set("page",c-1)}return this}})}(ox,modules));(function(a,b){b.common.model.ListViewModel.extend("modules.travelmap.model.PinnableListModel")}(ox,modules));(function(a,b){a.Model.extend("modules.travelmap.model.TravelMapModel",{notifyOnSet:true})}(ox,modules));(function(a,b){a.App.extend("modules.travelmap.App",{events:{"click .content-link":function(c,e){var d=this.getSubview("modules.membercenter.ContentStream");if(!d){return}c.preventDefault();new Fx.Scroll(window,{duration:500,transition:"quart:out"}).toElement(d.element,"y");var f=e.get("data-filter");if(!f){return}this.context.get("MemberCenter_ContentStreamComposite").fetch({filter:f,offset:0})},"click .sign-in":function(){this.record("FBCRMOverlay_sign-in");var d=ta.retrieve("fbcOverlay.returnToUrl");var c={module:this.name,action:"FBCRMOverlay_complete"};ta.support.Facebook.login(null,function(){ta.util.action.record(c.module+"_"+c.action,null,c)},null,null,"FBC_NAVIGATE",true,{url:d})},"click .no-thanks":function(){this.record("FBCRMOverlay_no-thanks");if(this.fbcOverlay){this.fbcOverlay.hide()}},"click .tripcollectiveinfo":function(g,e){var f=e.get("data-info-id");var h=e.get("data-info-layout");var c=this.context.get("Member.data.isLoggedInMember")?"OwnProfile":"OtherUserProfile";var d=e.get("data-info-context");this.getSubview("modules.membercenter.TripCollectiveInfo")&&this.getSubview("modules.membercenter.TripCollectiveInfo").show(e,f,{type:h,openTracking:"Open-"+c,closeTracking:"Close-"+c,trackingContext:d})},"click .badgeContents .action":function(d,c){this.record("ProfileBadgeFlyout",{context:"WarCTA"})},click:function(d,e){var c=this.element.getElement(".cs-points-bonus-description");if(c&&!c.hasClass("hidden")){c.addClass("hidden")}}},contextEvents:{"change RatingOverlay.locationId":function(){var d=this.context.get("RatingOverlay.locationId");if(d>0){var c=this.context.get("LoggedInMember.data").id;this.context.get("TravelMap_CityUnpinnedAttractions").fetch({geoId:d,memberId:c,limit:50,offset:0},{commit:false});this.context.get("PinModel").fetch({locationId:d,memberId:c}).success(function(){this.context.get("RatingOverlay").set("visible",true);if(this.getSubview("modules.common.RatingOverlayHeader")){this.getSubview("modules.common.RatingOverlayHeader").render();this.getSubview("modules.common.RatingOverlayAttractions").render()}else{this.getSubview("modules.common.LWRatingOverlayHeader").render();this.getSubview("modules.common.LWRatingOverlayAttractions").render()}}.bind(this))}},"change RatingOverlay.visible":function(){if(this.context.get("RatingOverlay.visible")){this.ratingOverlay.show()}else{this.getSubview("modules.membercenter.CityTiles").render();this.ratingOverlay.hide()}}},messages:{},initialize:function(){ta.keep("facebook.onSessionAvail",function(){if(!ta.retrieve("graphTAUser")){ta.store("graphTAUser",new ta.fb.graph.TAUser({id:ta.retrieve("fb.auth.userId"),accessToken:ta.retrieve("fb.auth.token")},{hostname:window.location.hostname,appName:ta.retrieve("facebook.appName"),ref:"TRIPADVISOR:Module:Travelmap"}))}});var c=this.element.getElement("#RATING_OVERLAY");if(c){this.ratingOverlay=new ta.overlays.CenteredOverlay({content:c,backdrop:1,autoShow:false}).addEvents({onClose:function(e){this.context.get("RatingOverlay").set({locationId:-1,visible:false})}.bind(this)})}if(ta.retrieve("crm.friend_update_referral")){this.record("FBCRM_referral")}this.fbcOverlay=this.element.getElement("#FBC_WRAPPER");if(this.fbcOverlay){this.record("FBCRMOverlay_show")}var d=this.getSubview("modules.membercenter.ContentStream");if(d){if(this.context.get("MemberCenter_ContentStreamComposite.contributionsRequested")){new Fx.Scroll(window,{duration:500,transition:"quart:out"}).toElement(d.element,"y")}}}})}(ox,modules));(function(b,c,a){b.View.extend("modules.travelmap.Travelmap",{autoRender:false,map:null,pinSet:null,source:"MODULE_TRAVELMAP",events:{"click .dropdown-all":function(e,d){this.selectDropdown("all")},"click .dropdown-been":function(e,d){this.selectDropdown("been")},"click .dropdown-want":function(e,d){this.selectDropdown("want")},"click .dropdown-fave":function(e,d){this.selectDropdown("fave")},"click .dropdown-button":function(e,d){this.toggleDropdown()}},updateDropdownCounts:function(){var d;if(this.context.get("TravelMap_TravelMapModel.selectedFriend")){d=this.context.get("TravelMap_FriendPinCounts")}else{d=this.context.get("TravelMap_PinCounts")}this.element.getElements(".pc_all").set("html","("+d.get("total")+")");this.element.getElements(".pc_been").set("html","("+d.get("city")+")");this.element.getElements(".pc_want").set("html","("+d.get("want")+")");this.element.getElements(".pc_fave").set("html","("+d.get("fave")+")")},contextEvents:{"change TravelMap_PinCounts":function(d){this.updateDropdownCounts()},"change TravelMap_PinCounts *":function(d){this.updateDropdownCounts()},"change TravelMap_FriendPinCounts":function(d){this.updateDropdownCounts()},"change TravelMap_TravelMapModel.selectedFriend":function(d){this.updateDropdownCounts()},"change TravelMap_TravelMapModel.selectedPin":function(d){if(!d.properties.selectedPin){this.pinSet.selectPin()}else{this.pinSet.selectPin(d.properties.selectedPin.get("location.id"))}},"set TravelMap_TravelMapModel.selectedDropdown":function(e){var d=e.properties.selectedDropdown;var f=this.element.getElement(".dropdown-"+d).get("html");this.closeDropdown(f);this.renderPins()},"change TravelMap_TravelMapModel.selectedDropdown":function(d){this.renderPins()},"change TravelMap_TravelMapModel.selectedBounds":function(i){if(this.rectangle){this.map.removePolyline(this.rectangle);this.rectangle=null}this.context.get("TravelMap_TravelMapModel").set("selectedPin",null);var h=this.context.get("TravelMap_TravelMapModel.selectedBounds");var d=this.context.get("TravelMap_PinsByLongitude");if(h&&d&&this.context.get("LoggedInMember.data.id")==d.getParam("memberId")){var k=h.get("minLat");var g=h.get("minLng");var j=h.get("maxLat");var e=h.get("maxLng");var f=[{lat:j,lng:e},{lat:k,lng:e},{lat:k,lng:g},{lat:j,lng:g},{lat:j,lng:e}];this.rectangle=this.map.addPolyline({latlngs:f,width:2,color:"#ff0000"})}},"add TravelMap_PinsByLongitude":function(e){if(this.pinSet){var d;e.items.each(function(g){var h=g.get("location");if(!h.get("lat")||!h.get("lng")){return}var f={};g.get("flags").each(function(i){f[i]=1});if(g.get("flags").indexOf(this.context.get("TravelMap_TravelMapModel.selectedDropdown"))<0&&this.context.get("TravelMap_TravelMapModel.selectedDropdown")!="all"){this.context.get("TravelMap_TravelMapModel").set("selectedDropdown","all")}this.pinSet.addPin(h.get("id"),h.get("lat"),h.get("lng"),f);d=g}.bind(this));if(!this.context.get("TravelMap_TravelMapModel.selectedBounds")){this.onPinSelect(d.get("location.id"))}}},"remove TravelMap_PinsByLongitude":function(d){d.items.each(function(e){this.pinSet.delPin(e.get("location.id"))}.bind(this));this.context.get("TravelMap_TravelMapModel").set("selectedPin",null)},"change TravelMap_PinsByLongitude":function(d){this.renderPins()},"add TravelMap_PinsByLongitude[].flags":function(f){var d=+f.targetPath.match(/\[(\d+)\]/)[1];var e=this.context.get("TravelMap_PinsByLongitude").get(d);f.items.each(function(g){this.pinSet.modPin(e.get("location.id"),g,"add")}.bind(this));if(!this.context.get("TravelMap_TravelMapModel.selectedBounds")){if(e.get("flags").indexOf(this.context.get("TravelMap_TravelMapModel.selectedDropdown"))<0&&this.context.get("TravelMap_TravelMapModel.selectedDropdown")!="all"){this.context.get("TravelMap_TravelMapModel").set("selectedDropdown","all")}this.context.get("TravelMap_TravelMapModel").set("selectedPin",e)}},"remove TravelMap_PinsByLongitude[].flags":function(f){var d=+f.targetPath.match(/\[(\d+)\]/)[1];var e=this.context.get("TravelMap_PinsByLongitude").get(d);f.items.each(function(g){this.pinSet.modPin(e.get("location.id"),g,"del");if(e.get("flags").length&&e.get("flags").indexOf(this.context.get("TravelMap_TravelMapModel.selectedDropdown"))<0&&this.context.get("TravelMap_TravelMapModel.selectedDropdown")!="all"){this.context.get("TravelMap_TravelMapModel").set("selectedDropdown","all")}}.bind(this))},"change TravelMap_TravelMapModel.mapCenter *":function(){var d=this.context.get("TravelMap_TravelMapModel.mapCenter");this.map.panToWithOffset(d.get("lat"),d.get("lng"),d.get("x"),d.get("y"),true)},"change TravelMap_TravelMapModel.mapZoom":function(){this.closeDropdown();this.pinSet.selectPin();this.context.get("TravelMap_TravelMapModel").set("selectedBounds",null);var d=this.context.get("TravelMap_TravelMapModel.mapZoom");if(this.map.getZoom()!=d){this.map.setZoom(d);this.context.get("TravelMap_TravelMapBounds").set(this.getBounds())}},"set TravelMap_TravelMapModel.selectedPinId":function(){var d=this.context.get("TravelMap_TravelMapModel.selectedPinId");if(this.pinSet.hasPin(d)){this.pinSet.selectPin(d)}},"set TravelMap_TravelMapModel.selectedPinScroll":function(){var e=this.context.get("TravelMap_TravelMapModel.selectedPin");if(!e){return}var f=this.context.get("TravelMap_TravelMapModel.selectedPinScroll");if(f!=1&&f!=-1){return}var g=this.context.get("TravelMap_TravelMapModel.selectedDropdown");var k=this.context.get("TravelMap_PinsByLongitude");var d=k.length;var j=k.indexOf(e);while(true){j+=f;j=j==d?0:j<0?d-1:j;var h=k.get(j);if(g=="all"||~h.get("flags").indexOf(g)){this.pinSet.selectPin(h.get("location.id"));return}}}},initialize:function(){this.$dropdown=this.element.getElement(".dropdown-contents");this.$dropdownButtonText=this.element.getElement(".dropdown-button .text");var d=this.context;a.util.load.maps(function(){var e=this.element.getElement(".map-container");this.map=new a.maps.Map(e,{origLat:this.context.get("TravelMap_TravelMapModel.mapCenter.lat"),origLng:this.context.get("TravelMap_TravelMapModel.mapCenter.lng"),zoom:this.context.get("TravelMap_TravelMapModel.mapZoom"),homeIcon:false,attachClickEvent:true,staticMap:false,enableScrollZoom:true,eventTrackingName:this.getTrackingCategory()});this.pinSet=new a.maps.PinSet(this.map,{addPinIcons:function(){this.map.addIcon("Been",Object.merge(a.maps.MARKER_TRAVELMAP_PIN,{name:"been_pin_icon_border",iconHover:"_hover"}));this.map.addIcon("Want",Object.merge(a.maps.MARKER_TRAVELMAP_PIN,{name:"want_pin_icon_border",iconHover:"_hover"}));this.map.addIcon("Gray",Object.merge(a.maps.MARKER_TRAVELMAP_PIN,{name:"been_pin_icon_border_hover",iconHover:"",zIndex:2}));this.map.addIcon("Fave",Object.merge(a.maps.MARKER_TRAVELMAP_PIN,{name:"fave_pin_icon_border",iconHover:"_hover",iconWidth:17,iconHeight:20,iconAnchorX:2,iconAnchorY:20,zIndex:1}));this.map.addIcon("GrayFave",Object.merge(a.maps.MARKER_TRAVELMAP_PIN,{name:"fave_pin_icon_border_hover",iconHover:"",iconWidth:17,iconHeight:20,iconAnchorX:2,iconAnchorY:20,zIndex:1}))},choosePinIcon:function(h,j,i,g){var k=d.get("TravelMap_TravelMapModel.selectedDropdown");if(h&&g&&(k=="all"||k=="fave")){return"GrayFave"}if(h&&(j||i)&&(k=="all"||k=="been"||k=="want")){return"Gray"}if(g&&(k=="all"||k=="fave")){return"Fave"}if(i&&(k=="all"||k=="want")){return"Want"}if(j&&(k=="all"||k=="been")){return"Been"}return null}});this.pinSet.addEvent("onSelectedPinChange",function(g){if(g.newLocationId){this.context.get("TravelMap_TravelMapModel").set("selectedBounds",null);this.onPinSelect(g.newLocationId);if(g.userClick){this.record("click-pin")}}else{this.context.get("TravelMap_TravelMapModel").set("selectedPin",null)}}.bind(this));this.map.addEvent("beforeMove",function(){this.closeDropdown()}.bind(this));var f=function(i,h){var g=this.map.fromLatLngToContainerPixel(i,h);g.x-=this.map.mapWidth()/2;g.y-=this.map.mapHeight()/2;return g}.bind(this);this.map.addEvent("singleClick",function(h){this.record("click-map");this.pinSet.selectPin();var j=Math.min(this.map.mapWidth(),this.map.mapHeight())/16;var i=this.map.computeLatLngPlusPixelOffset(h.lat(),h.lng(),-j,j);var g=this.map.computeLatLngPlusPixelOffset(h.lat(),h.lng(),j,-j);var k=f(i.lat(),i.lng());var l=f(g.lat(),g.lng());this.context.get("TravelMap_TravelMapModel").set("selectedBounds",{minLat:i.lat(),minLng:i.lng(),maxLat:g.lat(),maxLng:g.lng(),minX:k.x,minY:k.y,maxX:l.x,maxY:l.y})}.bind(this));this.map.addEvent("move",function(){this.context.get("TravelMap_TravelMapModel").set({selectedBounds:null});this.pinSet.selectPin();this.context.get("TravelMap_TravelMapBounds").set(this.getBounds())}.bind(this));this.map.addEvent("zoom",function(){this.context.get("TravelMap_TravelMapModel").set("mapZoom",this.map.getZoom())}.bind(this));this.context.get("TravelMap_TravelMapModel").set("mapSize",{width:this.map.mapWidth(),height:this.map.mapHeight()});this.renderPins()}.bind(this))},toggleDropdown:function(){this.$dropdown.toggleClass("hidden");this.record("dropdown-toggle");return this},closeDropdown:function(d){this.$dropdown.addClass("hidden");if(d){this.$dropdownButtonText.set("html",d)}return this},selectDropdown:function(d){this.context.get("TravelMap_TravelMapModel").set("selectedDropdown",d);this.record("dropdown-"+d)},getBounds:function(){var e=this.map.mapBounds();var d={minLat:e.getSouthWest().lat(),maxLat:e.getNorthEast().lat(),minLng:e.getSouthWest().lng(),maxLng:e.getNorthEast().lng()};if(d.maxLng<d.minLng){d.maxLng+=360}return d},renderPins:function(){if(!this.pinSet){return this}this.pinSet.deleteAllPins();this.context.get("TravelMap_PinsByLongitude").each(function(f){var g=f.get("location");if(g){if(!g.get("lat")||!g.get("lng")){return}var d;f.get("flags").each(function(h){d=d||{};d[h]=1});var e=this.context.get("TravelMap_TravelMapModel.selectedDropdown");if(e=="all"||d[e]==1){this.pinSet.addPin(g.get("id"),g.get("lat"),g.get("lng"),d)}}}.bind(this))},onPinSelect:function(g){var e=this.pinSet.pins[g].marker.getAnchor();var f=this.context.get("TravelMap_PinsByLongitude");var d=f.find(function(h){return h.get("location.id")==g});e.x-=this.map.mapWidth()/2;e.y-=this.map.mapHeight()/2;this.context.get("TravelMap_TravelMapModel").set({selectedPin:d,selectedPoint:e})},record:function(e,d){d||(d={});d.module=d.module||this.getTrackingCategory();return b.View.prototype.record(e,d)},getTrackingCategory:function(){if(this.context.get("features.mc_pinning.enabled")){return this.context.get("Member.isLoggedInMember")?"modules.travelmap.YourMap":"modules.travelmap.PublicMap"}else{return this.name}}})}(ox,modules,ta));(function(b,c,a){b.View.extend("modules.travelmap.LWTravelmap",{autoRender:false,map:null,pinSet:null,source:"MODULE_TRAVELMAP",events:{"click .dropdown-all":function(e,d){this.selectDropdown("all")},"click .dropdown-been":function(e,d){this.selectDropdown("been")},"click .dropdown-want":function(e,d){this.selectDropdown("want")},"click .dropdown-fave":function(e,d){this.selectDropdown("fave")},"click .dropdown-button":function(e,d){this.toggleDropdown()}},updateDropdownCounts:function(){var d;if(this.context.get("TravelMap_TravelMapModel.selectedFriend")){d=this.context.get("TravelMap_FriendPinCounts")}else{d=this.context.get("TravelMap_PinCounts")}this.element.getElements(".pc_all").set("html","("+d.get("total")+")");this.element.getElements(".pc_been").set("html","("+d.get("city")+")");this.element.getElements(".pc_want").set("html","("+d.get("want")+")");this.element.getElements(".pc_fave").set("html","("+d.get("fave")+")")},contextEvents:{"change TravelMap_PinCounts":function(d){this.updateDropdownCounts()},"change TravelMap_PinCounts *":function(d){this.updateDropdownCounts()},"change TravelMap_FriendPinCounts":function(d){this.updateDropdownCounts()},"change TravelMap_TravelMapModel.selectedFriend":function(d){this.updateDropdownCounts()},"change TravelMap_TravelMapModel.selectedPin":function(d){if(!d.properties.selectedPin){this.pinSet.selectPin()}else{this.pinSet.selectPin(d.properties.selectedPin.get("location.id"))}},"set TravelMap_TravelMapModel.selectedDropdown":function(e){var d=e.properties.selectedDropdown;var f=this.element.getElement(".dropdown-"+d).get("html");this.closeDropdown(f);this.renderPins()},"change TravelMap_TravelMapModel.selectedDropdown":function(d){this.renderPins()},"change TravelMap_TravelMapModel.selectedBounds":function(i){if(this.rectangle){this.map.removePolyline(this.rectangle);this.rectangle=null}this.context.get("TravelMap_TravelMapModel").set("selectedPin",null);var h=this.context.get("TravelMap_TravelMapModel.selectedBounds");var d=this.context.get("TravelMap_LWPinsByLongitude");if(h&&d&&this.context.get("LoggedInMember.data.id")==d.getParam("memberId")){var k=h.get("minLat");var g=h.get("minLng");var j=h.get("maxLat");var e=h.get("maxLng");var f=[{lat:j,lng:e},{lat:k,lng:e},{lat:k,lng:g},{lat:j,lng:g},{lat:j,lng:e}];this.rectangle=this.map.addPolyline({latlngs:f,width:2,color:"#ff0000"})}},"add TravelMap_LWPinsByLongitude":function(e){if(this.pinSet){var d;e.items.each(function(g){if(!g.get("lat")||!g.get("lng")){return}var f={};g.get("flags").each(function(h){f[h]=1});if(g.get("flags").indexOf(this.context.get("TravelMap_TravelMapModel.selectedDropdown"))<0&&this.context.get("TravelMap_TravelMapModel.selectedDropdown")!="all"){this.context.get("TravelMap_TravelMapModel").set("selectedDropdown","all")}this.pinSet.addPin(g.get("lid"),g.get("lat"),g.get("lng"),f);d=g}.bind(this));if(!this.context.get("TravelMap_TravelMapModel.selectedBounds")){this.onPinSelect(d.get("lid"))}}},"remove TravelMap_LWPinsByLongitude":function(d){d.items.each(function(e){this.pinSet.delPin(e.get("lid"))}.bind(this));this.context.get("TravelMap_TravelMapModel").set("selectedPin",null)},"change TravelMap_LWPinsByLongitude":function(d){this.renderPins()},"add TravelMap_LWPinsByLongitude[].flags":function(g){var e=+g.targetPath.match(/\[(\d+)\]/)[1];var f=this.context.get("TravelMap_LWPinsByLongitude").get(e);g.items.each(function(h){this.pinSet.modPin(f.get("lid"),h,"add")}.bind(this));if(!this.context.get("TravelMap_TravelMapModel.selectedBounds")){if(f.get("flags").indexOf(this.context.get("TravelMap_TravelMapModel.selectedDropdown"))<0&&this.context.get("TravelMap_TravelMapModel.selectedDropdown")!="all"){this.context.get("TravelMap_TravelMapModel").set("selectedDropdown","all")}var d=this.context;d.get("TravelMap_Pin").fetch({locationId:f.get("lid")},{commit:true}).success(function(){var h=d.get("TravelMap_Pin.data");d.get("TravelMap_TravelMapModel").set("selectedPin",h)})}},"remove TravelMap_LWPinsByLongitude[].flags":function(f){var d=+f.targetPath.match(/\[(\d+)\]/)[1];var e=this.context.get("TravelMap_LWPinsByLongitude").get(d);f.items.each(function(g){this.pinSet.modPin(e.get("lid"),g,"del");if(e.get("flags").length&&e.get("flags").indexOf(this.context.get("TravelMap_TravelMapModel.selectedDropdown"))<0&&this.context.get("TravelMap_TravelMapModel.selectedDropdown")!="all"){this.context.get("TravelMap_TravelMapModel").set("selectedDropdown","all")}}.bind(this))},"change TravelMap_TravelMapModel.mapCenter *":function(){var d=this.context.get("TravelMap_TravelMapModel.mapCenter");this.map.panToWithOffset(d.get("lat"),d.get("lng"),d.get("x"),d.get("y"),true)},"change TravelMap_TravelMapModel.mapZoom":function(){this.closeDropdown();this.pinSet.selectPin();this.context.get("TravelMap_TravelMapModel").set("selectedBounds",null);var d=this.context.get("TravelMap_TravelMapModel.mapZoom");if(this.map.getZoom()!=d){this.map.setZoom(d);this.context.get("TravelMap_TravelMapBounds").set(this.getBounds())}},"set TravelMap_TravelMapModel.selectedPinId":function(){var d=this.context.get("TravelMap_TravelMapModel.selectedPinId");if(this.pinSet.hasPin(d)){this.pinSet.selectPin(d)}},"set TravelMap_TravelMapModel.selectedPinScroll":function(){var e=this.context.get("TravelMap_TravelMapModel.selectedPin");if(!e){return}var f=this.context.get("TravelMap_TravelMapModel.selectedPinScroll");if(f!=1&&f!=-1){return}var g=this.context.get("TravelMap_TravelMapModel.selectedDropdown");var k=this.context.get("TravelMap_LWPinsByLongitude");var d=k.length;var j=0;var l=0;k.each(function(i){if(i.id==e.id){j=l}l++});while(true){j+=f;j=j==d?0:j<0?d-1:j;var h=k.get(j);if(g=="all"||~h.get("flags").indexOf(g)){this.pinSet.selectPin(h.get("lid"));return}}}},initialize:function(){this.$dropdown=this.element.getElement(".dropdown-contents");this.$dropdownButtonText=this.element.getElement(".dropdown-button .text");var d=this.context;a.util.load.maps(function(){var e=this.element.getElement(".map-container");this.map=new a.maps.Map(e,{origLat:this.context.get("TravelMap_TravelMapModel.mapCenter.lat"),origLng:this.context.get("TravelMap_TravelMapModel.mapCenter.lng"),zoom:this.context.get("TravelMap_TravelMapModel.mapZoom"),homeIcon:false,attachClickEvent:true,staticMap:false,enableScrollZoom:true,minZoom:1,disableMapTypeControl:true,disableStreetViewControl:true,eventTrackingName:this.getTrackingCategory()});this.pinSet=new a.maps.PinSet(this.map,{addPinIcons:function(){this.map.addIcon("Been",Object.merge(a.maps.MARKER_TRAVELMAP_PIN,{name:"been_pin_icon_border",iconHover:"_hover"}));this.map.addIcon("Want",Object.merge(a.maps.MARKER_TRAVELMAP_PIN,{name:"want_pin_icon_border",iconHover:"_hover"}));this.map.addIcon("Gray",Object.merge(a.maps.MARKER_TRAVELMAP_PIN,{name:"been_pin_icon_border_hover",iconHover:"",zIndex:2}));this.map.addIcon("Fave",Object.merge(a.maps.MARKER_TRAVELMAP_PIN,{name:"fave_pin_icon_border",iconHover:"_hover",iconWidth:17,iconHeight:20,iconAnchorX:2,iconAnchorY:20,zIndex:1}));this.map.addIcon("GrayFave",Object.merge(a.maps.MARKER_TRAVELMAP_PIN,{name:"fave_pin_icon_border_hover",iconHover:"",iconWidth:17,iconHeight:20,iconAnchorX:2,iconAnchorY:20,zIndex:1}))},choosePinIcon:function(h,j,i,g){var k=d.get("TravelMap_TravelMapModel.selectedDropdown");if(h&&g&&(k=="all"||k=="fave")){return"GrayFave"}if(h&&(j||i)&&(k=="all"||k=="been"||k=="want")){return"Gray"}if(g&&(k=="all"||k=="fave")){return"Fave"}if(i&&(k=="all"||k=="want")){return"Want"}if(j&&(k=="all"||k=="been")){return"Been"}return null}});this.pinSet.addEvent("onSelectedPinChange",function(g){if(g.newLocationId){this.context.get("TravelMap_TravelMapModel").set("selectedBounds",null);this.onPinSelect(g.newLocationId);if(g.userClick){this.record("click-pin")}}else{this.context.get("TravelMap_TravelMapModel").set("selectedPin",null)}}.bind(this));this.map.addEvent("beforeMove",function(){this.closeDropdown()}.bind(this));var f=function(i,h){var g=this.map.fromLatLngToContainerPixel(i,h);g.x-=this.map.mapWidth()/2;g.y-=this.map.mapHeight()/2;return g}.bind(this);this.map.addEvent("singleClick",function(h){if(this.$justZoomed){delete this.$justZoomed;return}this.record("click-map");this.pinSet.selectPin();var j=Math.min(this.map.mapWidth(),this.map.mapHeight())/16;var i=this.map.computeLatLngPlusPixelOffset(h.lat(),h.lng(),-j,j);var g=this.map.computeLatLngPlusPixelOffset(h.lat(),h.lng(),j,-j);var k=f(i.lat(),i.lng());var l=f(g.lat(),g.lng());this.context.get("TravelMap_TravelMapModel").set("selectedBounds",{minLat:i.lat(),minLng:i.lng(),maxLat:g.lat(),maxLng:g.lng(),minX:k.x,minY:k.y,maxX:l.x,maxY:l.y})}.bind(this));this.map.addEvent("move",function(){this.context.get("TravelMap_TravelMapModel").set({selectedBounds:null});this.pinSet.selectPin();this.context.get("TravelMap_TravelMapBounds").set(this.getBounds())}.bind(this));this.map.addEvent("zoom",function(){this.$justZoomed=true;setTimeout(function(){delete this.$justZoomed}.bind(this),500);this.context.get("TravelMap_TravelMapModel").set("mapZoom",this.map.getZoom())}.bind(this));this.context.get("TravelMap_TravelMapModel").set("mapSize",{width:this.map.mapWidth(),height:this.map.mapHeight()});this.renderPins()}.bind(this))},toggleDropdown:function(){this.$dropdown.toggleClass("hidden");this.record("dropdown-toggle");return this},closeDropdown:function(d){this.$dropdown.addClass("hidden");if(d){this.$dropdownButtonText.set("html",d)}return this},selectDropdown:function(d){this.context.get("TravelMap_TravelMapModel").set("selectedDropdown",d);this.record("dropdown-"+d)},getBounds:function(){var e=this.map.mapBounds();var d={minLat:e.getSouthWest().lat(),maxLat:e.getNorthEast().lat(),minLng:e.getSouthWest().lng(),maxLng:e.getNorthEast().lng()};if(d.maxLng<d.minLng){d.maxLng+=360}return d},renderPins:function(){if(!this.pinSet){return this}this.pinSet.deleteAllPins();var d=new Date().getTime();this.context.get("TravelMap_LWPinsByLongitude").some(function(h,e){if((e+1)%250===0&&(new Date().getTime())-d>4000){return true}if(!h.get("lat")||!h.get("lng")){return}var f;h.get("flags").each(function(i){f=f||{};f[i]=1});var g=this.context.get("TravelMap_TravelMapModel.selectedDropdown");if(g=="all"||f[g]==1){this.pinSet.addPin(h.get("lid"),h.get("lat"),h.get("lng"),f)}}.bind(this))},onPinSelect:function(g){var d=this.pinSet.pins[g].marker.getAnchor();var e=this.context;var f=this.map;e.get("TravelMap_Pin").fetch({locationId:g},{commit:true}).success(function(){var h=e.get("TravelMap_Pin.data");d.x-=f.mapWidth()/2;d.y-=f.mapHeight()/2;e.get("TravelMap_TravelMapModel").set({selectedPin:h,selectedPoint:d})})},record:function(e,d){d||(d={});d.module=d.module||this.getTrackingCategory();return b.View.prototype.record(e,d)},getTrackingCategory:function(){if(this.context.get("features.mc_pinning.enabled")){return this.context.get("Member.isLoggedInMember")?"modules.travelmap.YourMap":"modules.travelmap.PublicMap"}else{return this.name}},visibilityChanged:function(d){if(d){if(this.map){this.map.checkResize();this.map.setCenter(0,0)}}}})}(ox,modules,ta));(function(b,c,a){b.View.extend("modules.travelmap.MultiPinFlyout",{autoRender:false,source:"MODULE_MULTIPINFLYOUT",events:{"click .been":function(e,d,f){f.context.get("pin").toggleFlag("been",this.source,this.name,this.context.get("features.module_publish_to_og.enabled"),this.getType())},"click .want":function(e,d,f){f.context.get("pin").toggleFlag("want",this.source,this.name,this.context.get("features.module_publish_to_og.enabled"),this.getType())},"click .fave":function(e,d,f){f.context.get("pin").toggleFlag("fave",this.source,this.name,this.context.get("features.module_publish_to_og.enabled"),this.getType())},"click .sprite-close":function(){this.context.get("TravelMap_TravelMapModel").set("selectedBounds",null);this.record("close")},"click .done":function(){this.context.get("TravelMap_TravelMapModel").set("selectedBounds",null);this.record("done")},"click .zoom":function(){var d=this.context.get("TravelMap_TravelMapModel.selectedBounds");if(d!=null){this.context.get("TravelMap_TravelMapModel").set("mapCenter",{lat:(d.get("minLat")+d.get("maxLat"))/2,lng:(d.get("minLng")+d.get("maxLng"))/2,x:0,y:0})}this.context.get("TravelMap_TravelMapModel").set("mapZoom",+this.context.get("TravelMap_TravelMapModel.mapZoom")+1);this.record("zoom")},"mouseover .flag-icon":function(e,d,f){["been","want","fave"].some(function(g){if(d.hasClass("sprite-"+g+"Unset")){d.removeClass("sprite-"+g+"Unset").addClass("sprite-"+g+"Set");return true}})},"mouseout .flag-icon":function(f,e,g){var d=g.context.get("pin");["been","want","fave"].some(function(h){if(e.hasClass("sprite-"+h+"Set")&&!~d.get("flags").indexOf(h)){e.removeClass("sprite-"+h+"Set").addClass("sprite-"+h+"Unset");return true}})}},contextEvents:{"eachPin > add pin.flags":function(d,e){e.render()},"eachPin > remove pin.flags":function(d,e){e.render()},"change TravelMap_TravelMapModel.selectedBounds":function(f){var e=f.properties.selectedBounds;if(e==null){this.render();return}var d=this.context.get("TravelMap_TravelMapModel.selectedPinType");this.context.get("TravelMap_MultiPinFlyoutPins").fetch({minLat:e.get("minLat"),minLng:e.get("minLng"),maxLat:e.get("maxLat"),maxLng:e.get("maxLng"),selectedPinType:d,selectionExpansion:5})},"change TravelMap_MultiPinFlyoutPins":function(d){this.render()}},initialize:function(){var g=this.context.get("TravelMap_TravelMapModel.selectedBounds");if(g==null){return}var i=(g.get("minX")+g.get("maxX"))/2;var h=(g.get("minY")+g.get("maxY"))/2;var s=this.element.getElement(".pin-multiflyout-container");if(!s){return}var r=$(document).getElement(".map-container").getSize().x;var n=$(document).getElement(".map-container").getSize().y;var f=s.getSize().x;var m=s.getSize().y;var d=r/2-f/2;var p=n/2-m/2;s.setStyle("left",d);s.setStyle("top",p);var o=-m/2-40;var t=m/2+40;var l=f/2-30;var u=".arrowPointUp";var j=".arrowPointDown";var q=f/2-10;var k=j;var e=u;if(h>0){h=t}else{h=o;k=u;e=j}if(i<-l){i=-l}else{if(i>l){i=l}}this.context.get("TravelMap_TravelMapModel").set("mapCenter",{lat:(g.get("minLat")+g.get("maxLat"))/2,lng:(g.get("minLng")+g.get("maxLng"))/2,x:-i,y:-h});if(this.element.getElement(k)){this.element.getElement(k).removeClass("hidden");this.element.getElement(k).setStyle("left",i+q)}if(this.element.getElement(e)){this.element.getElement(e).addClass("hidden")}},getType:function(){if(typeof oxapp==="undefined"||!oxapp.context.has("TravelMap_PinnableListModel")){return""}return oxapp.context.get("TravelMap_PinnableListModel.showCities")?"City":"Place"},record:function(e,d){d||(d={});d.module=this.name;if(typeof oxapp!=="undefined"&&oxapp.context.has("TravelMap_PinnableListModel")){if(d.context){d.context+="_"}else{d.context=""}d.context+=this.getType()}return b.View.prototype.record(e,d)}})}(ox,modules,ta));(function(a,b){a.View.extend("modules.travelmap.PinFlyout",{autoRender:false,source:"MODULE_PINFLYOUT",events:{"click .sprite-close":function(){this.context.get("TravelMap_TravelMapModel").set("selectedPin",null);this.record("PinFlyoutClose")},"click .prev-Pin":function(){this.previous()},"click .next-Pin":function(){this.next()},"click .active .been":function(){this.context.get("TravelMap_TravelMapModel.selectedPin").toggleFlag("been",this.source,this.name,this.context.get("features.module_publish_to_og.enabled"),this.getType())},"click .active .want":function(){this.context.get("TravelMap_TravelMapModel.selectedPin").toggleFlag("want",this.source,this.name,this.context.get("features.module_publish_to_og.enabled"),this.getType())},"click .active .fave":function(){this.context.get("TravelMap_TravelMapModel.selectedPin").toggleFlag("fave",this.source,this.name,this.context.get("features.module_publish_to_og.enabled"),this.getType())},"mouseover .active .flag-icon":function(d,c){["been","want","fave"].some(function(e){if(c.hasClass("sprite-"+e+"Unset")){c.removeClass("sprite-"+e+"Unset").addClass("sprite-"+e+"Set");return true}}.bind(this))},"mouseout .active .flag-icon":function(d,c){["been","want","fave"].some(function(e){if(!~this.context.get("TravelMap_TravelMapModel.selectedPin.flags").indexOf(e)&&c.hasClass("sprite-"+e+"Set")){c.removeClass("sprite-"+e+"Set").addClass("sprite-"+e+"Unset");return true}}.bind(this))},"click .active .been-li":function(){this.context.get("PinModel.PinModel.data").toggleFlag("been",this.source,this.name,this.context.get("features.module_publish_to_og.enabled"),this.getType())},"click .active .want-li":function(){this.context.get("PinModel.PinModel.data").toggleFlag("want",this.source,this.name,this.context.get("features.module_publish_to_og.enabled"),this.getType())},"mouseover .active .flag-icon-li":function(d,c){["been","want","fave"].some(function(e){if(c.hasClass("sprite-"+e+"Unset")){c.removeClass("sprite-"+e+"Unset").addClass("sprite-"+e+"Set");return true}}.bind(this))},"mouseout .active .flag-icon-li":function(d,c){["been","want","fave"].some(function(e){if(!~this.context.get("PinModel.PinModel.data.flags").indexOf(e)&&c.hasClass("sprite-"+e+"Set")){c.removeClass("sprite-"+e+"Set").addClass("sprite-"+e+"Unset");return true}}.bind(this))},"click .mcCityPageLink":function(e,d){var f=this.context.get("TravelMap_TravelMapModel.selectedPin.location.id");if(this.context.get("Member.data.link").indexOf("MemberProfile")==-1){var c=this.context.get("Member.data.link").replace("members","members-citypage")+"/g"+f}else{var c=this.context.get("Member.data.link")+"-ccc-g"+f}if(e.target.hasClass("hero_photo")){this.record("CityPhotoClick")}else{this.record("CityNameClick")}window.location=c},"click .civCityPageLink":function(e){var d=this.context.get("TravelMap_TravelMapModel.selectedPin.location.id");var c;if(e.target.hasClass("hero_photo")){c="Photo"}else{c="Name"}this.record("CityPageLinkClick",{context:c,value:d})}},contextEvents:{"add TravelMap_TravelMapModel.selectedPin.flags":function(){this.render()},"remove TravelMap_TravelMapModel.selectedPin.flags":function(){this.render()},"change TravelMap_TravelMapModel.selectedPin":function(e){var c=e.properties.selectedPin;var g=this.context.get("PinModel");var d=this.context.get("Member.data.id");var f;if(c&&!c.get("location.thumb.url")){f=c.get("location.id");g.fetch({memberId:d,locationId:f}).success(function(){this.render()},this)}else{if(c){f=c.get("location.id");g.fetch({memberId:d,locationId:f},{commit:true}).success(function(){this.render()},this)}else{this.render()}}}},initialize:function(){var g=this.context.get("TravelMap_TravelMapModel.selectedPin");var r=this.context.get("TravelMap_TravelMapModel.selectedPoint");if(!g||!r){return}var j=r.get("x");var i=r.get("y");var v=0;var f=0;var w=this.element.getElement(".pin-flyout-container");var h=$(document).getElement(".map-container");var u=h.getSize().x;var q=h.getSize().y;var e=w.getSize().x;var o=w.getSize().y;var c=f+u/2-e/2;var t=v+q/2-o/2;w.setStyle("left",c);w.setStyle("top",t);var s=-o/2-13;var z=o/2+32;var m=e/2-30;var A=".arrowPointUp";var k=".arrowPointDown";var p=e/2-10;var n=e/2-8;var l=k;var d=A;if(i>0){i=z}else{i=s;l=A;d=k}if(j<-m){j=-m}else{if(j>m){j=m}}this.context.get("TravelMap_TravelMapModel").set("mapCenter",{lat:g.get("location.lat"),lng:g.get("location.lng"),x:-j,y:-i});if(this.element.getElement(l)){this.element.getElement(l).removeClass("hidden");this.element.getElement(l).setStyle("left",j+(i<0?p:n))}if(this.element.getElement(d)){this.element.getElement(d).addClass("hidden")}},previous:function(){this.context.get("TravelMap_TravelMapModel").set("selectedPinScroll",-1);this.record("Previous")},next:function(){this.context.get("TravelMap_TravelMapModel").set("selectedPinScroll",1);this.record("Next")},getType:function(){if(typeof oxapp==="undefined"||!oxapp.context.has("TravelMap_PinnableListModel")){return""}return oxapp.context.get("TravelMap_PinnableListModel.showCities")?"City":"Place"},record:function(d,c){c||(c={});c.module=this.name;if(typeof oxapp!=="undefined"&&oxapp.context.has("TravelMap_PinnableListModel")){if(c.context){c.context+="_"}else{c.context=""}c.context+=this.getType()}return a.View.prototype.record(d,c)}})}(ox,modules));(function(a,b){a.View.extend("modules.travelmap.PinnableList",{autoRender:false,source:"MODULE_TOPCITIES",events:{"mouseover .flag-icon":function(d,c){["been","want","fave"].some(function(e){if(c.hasClass("sprite-"+e+"Unset")){c.removeClass("sprite-"+e+"Unset").addClass("sprite-"+e+"Set");return true}})},"mouseout .flag-icon":function(d,c,e){["been","want","fave"].some(function(f){if(!~e.context.get("pin.flags").indexOf(f)&&c.hasClass("sprite-"+f+"Set")){c.removeClass("sprite-"+f+"Set").addClass("sprite-"+f+"Unset");return true}})},"click .flag-icon":function(f,e,g){var d=g.context.get("pin");var c=e.hasClass("been")?"been":e.hasClass("want")?"want":e.hasClass("fave")?"fave":null;d.toggleFlag(c,this.source,this.name,this.context.get("features.module_publish_to_og.enabled"),this.context.get("TravelMap_PinnableListModel.showCities")?"City":"Place")},"click .previousTop":function(){this.context.get("TravelMap_PinnableListModel").previous();this.record("prev-button")},"click .nextTop":function(){var c=this.context.get("TravelMap_PinnableListModel");var e=(c.get("showCities"))?this.context.get("TravelMap_TopUnpinnedCities"):this.context.get("TravelMap_TopUnpinnedAttractions");var d=c.get("begin");if(e.length-d>=c.get("itemsPerPage")){c.next();this.record("next-button")}},"click .tmDone":function(){this.record("done")}},contextEvents:{"change TravelMap_TopUnpinnedCities":function(){this.render()},"add TravelMap_TopUnpinnedCities[].flags":function(d){var c=+d.targetPath.match(/\[(\d+)\]/)[1];this.addFlag(c,"TravelMap_TopUnpinnedCities")},"remove TravelMap_TopUnpinnedCities[].flags":function(d){var c=+d.targetPath.match(/\[(\d+)\]/)[1];this.removeFlag(c,"TravelMap_TopUnpinnedCities")},"change TravelMap_TopUnpinnedAttractions":function(){this.render()},"add TravelMap_TopUnpinnedAttractions[].flags":function(d){var c=+d.targetPath.match(/\[(\d+)\]/)[1];this.addFlag(c,"TravelMap_TopUnpinnedAttractions")},"remove TravelMap_TopUnpinnedAttractions[].flags":function(d){var c=+d.targetPath.match(/\[(\d+)\]/)[1];this.removeFlag(c,"TravelMap_TopUnpinnedAttractions")},"change TravelMap_PinnableListModel *":function(f){var d=(this.context.get("TravelMap_PinnableListModel.showCities"))?"TravelMap_TopUnpinnedCities":"TravelMap_TopUnpinnedAttractions";var g=this.context.get(d);var c=this.context.get("TravelMap_PinnableListModel");var i=f.properties.hasOwnProperty("showCities");if(i||g.length<c.get("end")){var e=this.context.get("TravelMap_TravelMapBounds");var h={minLat:e.get("minLat"),minLng:e.get("minLng"),maxLat:e.get("maxLat"),maxLng:e.get("maxLng"),limit:c.get("itemsPerPage"),offset:i?c.get("begin"):g.length-g.getUnsynced().length};this.context.get(d).fetch(h).success(this.render,this)}else{this.render()}},"change TravelMap_TravelMapBounds *":function(f){var d=(this.context.get("TravelMap_PinnableListModel.showCities"))?"TravelMap_TopUnpinnedCities":"TravelMap_TopUnpinnedAttractions";var e=this.context.get("TravelMap_TravelMapBounds");var c=this.context.get("TravelMap_PinnableListModel");c.set("page",1,false);this.context.get(d).fetch({minLat:e.get("minLat"),minLng:e.get("minLng"),maxLat:e.get("maxLat"),maxLng:e.get("maxLng"),limit:c.get("itemsPerPage"),offset:c.get("begin")})}},addFlag:function(d,e){var g=this.context.get(e);var c=g.get(d);this.context.get(e).unsync(c);var f;this.getSubview("eachPin").children.some(function(h){if(h.context.get("pin")==c){f=h;return true}});if(f){f.render()}},removeFlag:function(d,e){var g=this.context.get(e);var c=g.get(d);if(!c.get("flags").length){this.context.get(e).sync(c)}var f;this.getSubview("eachPin").children.some(function(h){if(h.context.get("pin")==c){f=h;return true}});if(f){f.render()}},record:function(d,c){c||(c={});c.module=this.name;if(c.context){c.context+="_"}else{c.context=""}c.context+=this.context.get("TravelMap_PinnableListModel.showCities")?"City":"Place";return a.View.prototype.record(d,c)}})}(ox,modules));(function(b,c,a){b.View.extend("modules.travelmap.Typeahead",{autoRender:false,source:"MODULE_TYPEAHEAD",contextEvents:{"change TravelMap_TravelMapModel.selectedPinType":function(){var d=this.$input.retrieve("typeAhead").ajax.options.url;var e=this.context.get("TravelMap_TravelMapModel.selectedPinType");if(e=="cities"){d=d.replace(/action=[A-Z]+/,"action=GEO");d=d.replace(/types=[a-z]+/,"types=geo")}else{if(e=="attractions"){d=d.replace(/action=[A-Z]+/,"action=SITEWIDE");d=d.replace(/types=[a-z]+/,"types=attr")}}this.$input.retrieve("typeAhead").ajax.options.url=d}},events:{"click .typeahead-button":function(){this.submit();this.record("submit")}},initialize:function(){this.resize();this.$input=this.element.getElement(".typeahead-input").addEvent("focus",function(e){a.common.search.clearOnFocus(e,this)}).addEvent("keydown",function(e){e=new Event(e);if(e.key=="enter"){this.submit()}}.bind(this)).addEvent("blur",function(e){a.common.search.defaultOnBlur(e,this)});var d={unifiedOptions:{types:"geo"},maxChoices:16,minLength:3,showOnlyTypedChoices:true,noSearchPrompt:false,showPrompt:false};a.widgets.typeahead.factory.global(null,this.$input,"API",this.select.bind(this),d)},resize:function(){var d=291-this.element.getElement(".typeahead-button").getSize().x;if(!Browser.ie){this.element.getElement(".typeahead-input").setStyle("width",d+"px")}else{this.element.getElement(".typeahead-input").setStyle("width",(d-10)+"px")}},select:function(e,f){if(f.value!=null&&f.value>0){var d={memberId:this.context.get("Member.data.id"),locationId:f.value,been:true,source:this.source,currentFlags:["been"]};c.travelmap.entity.Pin.save(d).success(function(g){this.record("been-pin");if(this.context.get("features.module_publish_to_og.enabled")){g.ogPublish("been",true)}this.context.get("TravelMap_TravelMapModel").set("selectedPinId",g.get("location.id"))},this)}this.$input.value="";this.$input.focus();return this},submit:function(){if(this.$input.value&&this.$input.value!=this.$input.defaultValue){var e=this.$input.retrieve("typeAhead");if(e&&e.choices){var d=e.choices.getElement(".autocompleter-selected");if(!d){d=e.choices.firstChild}if(d){e.choiceSelect(d)}}}return this},record:function(e,d){d||(d={});d.module=this.name;if(typeof oxapp!=="undefined"&&oxapp.context.has("TravelMap_PinnableListModel")){if(d.context){d.context+="_"}else{d.context=""}d.context+=oxapp.context.get("TravelMap_PinnableListModel.showCities")?"City":"Place"}return b.View.prototype.record(e,d)}})}(ox,modules,ta));(function(a,b){var c=10;a.View.extend("modules.membercenter.CityTiles",{autoRender:false,events:{"scroll window":function(){this.loadTiles()},"click .dropdown":function(f,e,h){var d=true;var g=e.getElement(".dropdownOptions");if(!g.hasClass("hidden")){d=false}this.closeDropdowns();if(d){this.openDropdown(e)}f.stopPropagation()},"click .dropdownSelection":function(e,d,f){this.context.get("MemberCenter_CityTilesView").set("sort",d.get("name"));this.record(d.get("name")=="1"?"ContributionCountSort":d.get("name")=="2"?"AlphabeticalSort":d.get("name")=="3"?"ContinentSort":"DatePostedSort")},"click window":function(e,d){this.closeDropdowns()},"click .contributionViewOption":function(e,d,f){if(d.hasClass("selected")){return}this.context.get("MemberCenter_CityTilesView").set("view",d.get("name"));this.record(d.get("name")=="1"?"gridView":"listView")},"click .bubble":function(f,e,g){if(this.locked){return}this.locked=true;var d=this.context.get("MemberCenter_CityTiles");d.setParam("limit",d.length);this.record("rating_added");this.removeRatingBlock(g.context.get("attraction"),g.context.get("tile.attractions"),g.context.get("tile").id,g.context.get("tile.member.id"));this.saveRating(e,g.context.get("attraction").id,g.context.get("attraction").get("url"),g.context.get("attraction").get("redistributable")).always(function(){this.locked=false;d=this.context.get("MemberCenter_CityTiles");if(d.length%this.context.get("MemberCenter_CityTilesView.itemsPerPage")){d.setParam("limit",Math.max(d.length+1,this.context.get("MemberCenter_CityTilesView.itemsPerPage")))}},this)},"click .ratingBlock .close":function(e,d,f){if(!f.context.has("attraction")){return}this.record("ratingClose");this.removeRatingBlock(f.context.get("attraction"),f.context.get("tile.attractions"),f.context.get("tile").id,f.context.get("tile.member.id"))},"mouseover .bubble":function(g,f,h){var d=f.getParent().getElements(".bubble");var e=d.indexOf(f);d.each(function(j,k){$$(j)[e>=k?"addClass":"removeClass"]("filled")},this)},"mouseout .bubbles":function(f,e,g){var d=e.getElements(".bubble");d.each(function(h){h.removeClass("filled")})},"click .seeAll":function(f,e,g){this.record("SeeAllAttractionsButton");var d=g.context.get("tile").id;this.context.get("RatingOverlay").set("locationId",d)},"mouseover .viBeenWant .flag-icon":function(e,d){["been","want","fave"].some(function(f){if(d.hasClass("sprite-"+f+"Unset")){d.removeClass("sprite-"+f+"Unset").addClass("sprite-"+f+"Set");return true}})},"mouseout .viBeenWant .flag-icon":function(e,d,f){["been","want","fave"].some(function(g){if(!d.hasClass("clicked")&&d.hasClass("sprite-"+g+"Set")){d.removeClass("sprite-"+g+"Set").addClass("sprite-"+g+"Unset");return true}})},"click .viBeenWant .flag-icon":function(g,e,h){var d=e.hasClass("been")?"been":e.hasClass("want")?"want":e.hasClass("fave")?"fave":null;h.context.get("tile.loggedInPin").toggleFlag(d,"MODULE_CITYTILES",this.name,this.context.get("features.module_publish_to_og.enabled"));if(d=="been"){var i=e.getParent().getParent();var f=i.getElement(".want");if(e.hasClass("clicked")){e.removeClass("clicked");e.getParent().getElement(".visitText").removeClass("selectedText");f.removeClass("hidden")}else{e.addClass("clicked");e.getParent().getElement(".visitText").addClass("selectedText");f.addClass("hidden")}}else{if(d=="want"){if(e.hasClass("clicked")){e.removeClass("clicked");e.getParent().getElement(".visitText").removeClass("selectedText")}else{e.addClass("clicked");e.getParent().getElement(".visitText").addClass("selectedText")}}}},"mouseover .gridTile":function(e,d){d.addClass("hover")},"mouseout .gridTile":function(e,d){d.removeClass("hover")}},contextEvents:{"add MemberCenter_CityTiles":function(f){var d=this.context.get("MemberCenter_CityTiles");if(d.length%this.context.get("MemberCenter_CityTilesView.itemsPerPage")){d.setParam("limit",Math.max(d.length+1,this.context.get("MemberCenter_CityTilesView.itemsPerPage")))}else{this._hasAll=false}var e=this.context.get("MemberCenter_CityTilesView.view")=="1"?"GridView":"ListView";if(d.length==1||e=="ListView"){this.render()}setTimeout(function(){this.setAnimations()}.bind(this),0)},"remove MemberCenter_CityTiles":function(d){if(this.context.get("MemberCenter_CityTiles").length==0){this.render()}},"change MemberCenter_CityTiles":function(d){this.render()},"change MemberCenter_CityTilesView.sort":function(d){this.context.get("MemberCenter_CityTiles").fetch({sortOrderId:+d.properties.sort,requestedTile:null})},"change MemberCenter_CityTilesView.view":function(){this.render()},"remove RatingOverlay.data.attractions":function(){this.render()},"change TravelMap_PinCounts *":function(){this._hasAll=false}},initialize:function(){this.$loading=this.element.getElement(".loading");this._loading=false;this._hasAll=false;this.shownAttractions={};this.recordAttractions();if(this.getSubview("eachTile")){this.getSubview("eachTile").enableAutoSize({add:a.domutil.transition.fadeIn,remove:a.domutil.transition.fadeOut})}this.setAnimations()},loadTiles:function(){var h=this;var f=this.context.get("MemberCenter_CityTilesView.itemsPerPage");var d=this.context.get("MemberCenter_CityTiles");var g=window.getScroll().y+window.getSize().y;var e=this.element.getCoordinates().bottom+50;var i=d.length;if(this._loading||this._hasAll||g<e){return this}this._loading=true;if(this.$loading){this.$loading.removeClass("hidden")}d.fetch({limit:f-i%f,offset:i}).always(function(){if(d.length%f){d.setParam("limit",Math.max(d.length+1,f))}else{d.setParam("limit",Math.max(d.length,f))}if(h.$loading){h.$loading.addClass("hidden")}h.setAnimations();this.recordAttractions();if(i==d.length){h._hasAll=true}setTimeout(function(){h._loading=false;if(window.getScroll().y+window.getSize().y>e){h.loadTiles()}},1000)}.bind(this));return this},record:function(f){var d=this.context.get("MemberCenter_CityTilesView.view")=="1"?"GridView":"ListView";var e=(this.context.get("Member.data.isLoggedInMember"))?"modules.membercenter.YourCityTiles":"modules.membercenter.PublicCityTiles";return ta.util.action.record(e+"_"+f,null,{module:e,action:f,value:d})},recordAttractions:function(){var d=this.context.get("MemberCenter_CityTiles");if(d){d.each(function(e){var f=e.get("attractions");if(f){f.each(function(g){this.shownAttractions[g.id]=true}.bind(this))}}.bind(this))}},setAnimations:function(){if(this.getSubview("eachTile")){this.getSubview("eachTile").children.each(function(d){if(d.getSubview("eachAttraction")){d.getSubview("eachAttraction").enableAutoSize({add:a.domutil.transition.fadeIn,remove:a.domutil.transition.fadeOut})}})}},renderEmptyTiles:function(d){if(d.length<=0){this.getSubview("eachTile").children.each(function(e){if(e.getSubview("eachAttraction")&&!e.getSubview("eachAttraction").children.length){e.render()}})}},removeRatingBlock:function(e,g,f,d){var h=this.getOffSet(g);g.remove(e);if(g.length<5){this.addMoreAttractions(f,d,g,h)}},getOffSet:function(d){var e=d.offset;if(!e){e=d.length+1;d.offset=e}return e},addMoreAttractions:function(e,d,f,g){this.context.get("TravelMap_CityUnpinnedAttractions").fetch({geoId:e,memberId:d,offset:g,limit:c}).success(function(){setTimeout(function(){f.offset=g+c;var i=this.context.get("TravelMap_CityUnpinnedAttractions");var h=[];i.each(function(j){if(!this.shownAttractions[j.id]){if(!f.contains(j)){h.push(j)}this.shownAttractions[j.id]=true}}.bind(this));f.add(h);if(f.length<=0){this.renderEmptyTiles(f)}}.bind(this),350)},this)},saveRating:function(j,i,g,k){var e=this.context.get("MemberCenter_ContributionCounts.rating");this.context.get("MemberCenter_ContributionCounts").set("rating",e+1);var d=j.getParent().getElements(".bubble");var f=d.indexOf(j)+1;ta.util.cookie.setPIDCookie(36388);var h={locationId:i,url:g,redistributable:k,value:f,source:"MODULE_CITYTILES",type:"QUICKRATE",pid:36388};return b.common.entity.Rating.save(h)},openDropdowns:[],openDropdown:function(d){d.getElement(".dropdownOptions").removeClass("hidden");this.openDropdowns.combine([d])},closeDropdown:function(d){d.getElement(".dropdownOptions").addClass("hidden");this.openDropdowns.erase(d)},closeDropdowns:function(){this.openDropdowns.each(function(d){this.closeDropdown(d)},this)}})}(ox,modules));(function(b,c,a){b.Entity.extend("modules.common.entity.Rating",{});c.common.entity.Rating.ogPublish=function(e){var d=a.retrieve("graphTAUser");if(!d){return}d.rate(e)}}(ox,modules,ta));(function(b,c,a){b.View.extend("modules.common.RatingOverlayHeader",{autoRender:false,events:{"click .dropdown":function(e,d){this.$dropdown.style.width=d.clientWidth+"px";this.$dropdown.toggleClass("hidden");if(this.$dropdown.hasClass("hidden")){this.record("DropdownClose")}else{this.record("DropdownOpen")}return this},"click .dropdown-city":function(g,f,h){this.record("dropdownSelect");var d=h.context.get("pin");var e=d.get("location").id;this.context.get("RatingOverlay").set("locationId",e)},"mouseover .dropdown-city":function(e,d,f){d.removeClass("css_gradient_gry")},"mouseout .dropdown-city":function(e,d,f){d.addClass("css_gradient_gry")}},contextEvents:{"remove Social_Badges.unearned":function(){this.setBadgeView();this.render()},"change CompleteContributionCounts.ratings":function(){this.setBadgeView();this.render()}},initialize:function(){this.setBadgeView();this.$dropdown=this.element.getElement(".dropdown-contents")},setBadgeView:function(){var e=this.context.get("Social_Badges.unearned");var g=this.context.get("Social_Badges.ratings");var d=this.context.get("CompleteContributionCounts.ratings");var f=false;g.each(function(h){if(!f&&e.indexOf(h)>-1){this.context.get("RatingOverlay").set("badge",h);var i=h.get("value")-d;this.context.get("RatingOverlay").set("left",i);f=true}},this);if(!f){this.context.get("RatingOverlay").set("badge",null)}}})}(ox,modules,ta));(function(b,c,a){var d=36382;b.View.extend("modules.common.RatingOverlayAttractions",{autoRender:false,events:{"click .bubble":function(f,g,j){if(j){this.record("rating_added");var m=j.context.get("attraction");this.context.get("TravelMap_CityUnpinnedAttractions").remove(m);var e=this.context.get("CompleteContributionCounts.ratings");this.context.get("CompleteContributionCounts").set("ratings",e+1);var l=this.context.get("features.civ_module_rating.enabled")?"QUICKRATECIV":"QUICKRATE";var h=g.getParent().getElements(".bubble");var i=h.indexOf(g)+1;var k={locationId:j.context.get("attraction").id,url:j.context.get("attraction").get("url"),redistributable:j.context.get("attraction").get("redistributable"),value:i,source:"MODULE_RATINGOVERLAY",type:l,pid:d};this.offset--;a.util.cookie.setPIDCookie(d);c.common.entity.Rating.save(k).success(function(){c.common.entity.Rating.ogPublish(k)});if(!this.context.get("TravelMap_CityUnpinnedAttractions").length){this.loadNextCity()}}},"click .ratingBlock .closeButton":function(g,f,h){if(h){this.record("ratingClose");var e=h.context.get("attraction");this.context.get("TravelMap_CityUnpinnedAttractions").remove(e);if(!this.context.get("TravelMap_CityUnpinnedAttractions").length){this.loadNextCity()}}},"click .doneButton":function(f,e,g){this.record("Done");this.context.get("RatingOverlay").set({locationId:-1,visible:false})},"mouseover .bubble":function(h,g,i){var e=g.parentNode.getElements(".bubble");var f=e.indexOf(g);e.each(function(j,k){$$(j)[f>=k?"addClass":"removeClass"]("filled")},this)},"mouseout .bubbles":function(g,f,h){var e=f.getElements(".bubble");e.each(function(i){i.removeClass("filled")})}},contextEvents:{"change RatingOverlay.locationId":function(g){var f=this.context.get("RatingOverlay.locationId");var e=this.context.get("LoggedInMember.data").id;this.render()}},initialize:function(){var e=this.getSubview("eachAttraction");if(e){e.enableAutoSize({add:b.domutil.transition.fadeIn,remove:b.domutil.transition.fadeOut})}},loadNextCity:function(){var g=this.context.get("TravelMap_PinsByName");var f=this.context.get("RatingOverlay.locationId");var e=g.find(function(h,k,l){var j=(l.length+k-1)%l.length;return(l[j].get("location.id")==f)});if(e&&e.get("location.id")>0){this.element.getElement(".loading").removeClass("hidden");this.element.getElement(".ratings").addClass("hidden");setTimeout(function(){this.context.get("RatingOverlay").set("locationId",e.get("location.id"))}.bind(this),1000)}}})}(ox,modules,ta));(function(b,c,a){b.View.extend("modules.common.LWRatingOverlayHeader",{autoRender:false,events:{"click .dropdown":function(e,d){this.$dropdown.style.width=d.clientWidth+"px";this.$dropdown.toggleClass("hidden");if(this.$dropdown.hasClass("hidden")){this.record("DropdownClose")}else{this.record("DropdownOpen")}return this},"click .dropdown-city":function(f,e,g){this.record("dropdownSelect");var d=g.context.get("pin.lid");this.context.get("RatingOverlay").set("locationId",d)},"mouseover .dropdown-city":function(e,d,f){d.removeClass("css_gradient_gry")},"mouseout .dropdown-city":function(e,d,f){d.addClass("css_gradient_gry")}},contextEvents:{"remove Social_Badges.unearned":function(){this.setBadgeView();this.render()},"change CompleteContributionCounts.ratings":function(){this.setBadgeView();this.render()}},initialize:function(){this.setBadgeView();this.$dropdown=this.element.getElement(".dropdown-contents")},setBadgeView:function(){var e=this.context.get("Social_Badges.unearned");var g=this.context.get("Social_Badges.ratings");var d=this.context.get("CompleteContributionCounts.ratings");var f=false;g.each(function(h){if(!f&&e.indexOf(h)>-1){this.context.get("RatingOverlay").set("badge",h);var i=h.get("value")-d;this.context.get("RatingOverlay").set("left",i);f=true}},this);if(!f){this.context.get("RatingOverlay").set("badge",null)}}})}(ox,modules,ta));(function(b,c,a){var d=36382;b.View.extend("modules.common.LWRatingOverlayAttractions",{autoRender:false,events:{"click .bubble":function(f,g,j){if(j){this.record("rating_added");var m=j.context.get("attraction");this.context.get("TravelMap_CityUnpinnedAttractions").remove(m);var e=this.context.get("CompleteContributionCounts.ratings");this.context.get("CompleteContributionCounts").set("ratings",e+1);var l=this.context.get("features.civ_module_rating.enabled")?"QUICKRATECIV":"QUICKRATE";var h=g.getParent().getElements(".bubble");var i=h.indexOf(g)+1;var k={locationId:j.context.get("attraction").id,url:j.context.get("attraction").get("url"),redistributable:j.context.get("attraction").get("redistributable"),value:i,source:"MODULE_RATINGOVERLAY",type:l,pid:d};this.offset--;a.util.cookie.setPIDCookie(d);c.common.entity.Rating.save(k).success(function(){c.common.entity.Rating.ogPublish(k)});if(!this.context.get("TravelMap_CityUnpinnedAttractions").length){this.loadNextCity()}}},"click .ratingBlock .closeButton":function(g,f,h){if(h){this.record("ratingClose");var e=h.context.get("attraction");this.context.get("TravelMap_CityUnpinnedAttractions").remove(e);if(!this.context.get("TravelMap_CityUnpinnedAttractions").length){this.loadNextCity()}}},"click .doneButton":function(f,e,g){this.record("Done");this.context.get("RatingOverlay").set({locationId:-1,visible:false})},"mouseover .bubble":function(h,g,i){var e=g.parentNode.getElements(".bubble");var f=e.indexOf(g);e.each(function(j,k){$$(j)[f>=k?"addClass":"removeClass"]("filled")},this)},"mouseout .bubbles":function(g,f,h){var e=f.getElements(".bubble");e.each(function(i){i.removeClass("filled")})}},contextEvents:{"change RatingOverlay.locationId":function(g){var f=this.context.get("RatingOverlay.locationId");var e=this.context.get("LoggedInMember.data").id;this.render()}},initialize:function(){var e=this.getSubview("eachAttraction");if(e){e.enableAutoSize({add:b.domutil.transition.fadeIn,remove:b.domutil.transition.fadeOut})}},loadNextCity:function(){var g=this.context.get("TravelMap_LWPinsByName");var f=this.context.get("RatingOverlay.locationId");var e=g.find(function(h,k,l){var j=(l.length+k-1)%l.length;return(l[j].get("lid")==f)});if(e&&e.get("lid")>0){this.element.getElement(".loading").removeClass("hidden");this.element.getElement(".ratings").addClass("hidden");setTimeout(function(){this.context.get("RatingOverlay").set("locationId",e.get("lid"))}.bind(this),1000)}}})}(ox,modules,ta));(function(a,b){a.View.extend("modules.common.BackToTop",{scrollBoundary:86,source:"MODULE_BACK_TO_TOP_COMMON",autoRender:false,events:{"scroll window":function(){this.style();this.positionButton()},"resize window":function(){this.positionButton()},click:function(d,c){window.scrollTo(0,this.scrollBoundary);this.record("BackToTopClick")}},contextEvents:{},style:function(){if(window.getScroll().y>this.scrollBoundary){if(this.$overlay.hasClass("btt-hidden")){this.record("seen");this.$overlay.removeClass("btt-hidden")}}else{this.$overlay.addClass("btt-hidden")}},positionButton:function(){var c=ta.id("CIV");var e=true;if(!c){c=ta.id("MC_MODULES");e=false}if(!c){c=ta.id("PROFILE_CONTENT");e=false}if(!c){c=ta.id("MODULES_MEMBER_CENTER");e=false}var g=e?"-2px":"-1px";var f=((window.getSize().x-c.getSize().x)/2)-(e?0:2);var h=document.id(document.body).getElements(".btt-padding")[0].getSize().x;if(f<h){this.$overlay.setStyle("right",f+"px");this.$overlay.removeClass("wide-page");this.$overlay.addClass("narrow-page")}else{this.$overlay.setStyle("right",(f-h+2)+"px");this.$overlay.addClass("wide-page");this.$overlay.removeClass("narrow-page")}var d=this.bottomOfPage();if(!e&&(d<234)){this.$overlay.setStyle("bottom",(234-d)+"px")}else{if(e&&(d<8)){this.$overlay.setStyle("bottom",(0-d)+"px")}else{this.$overlay.setStyle("bottom",g)}}},bottomOfPage:function(){var f,d,e;if(document.documentElement.scrollTop){d=document.documentElement.scrollTop}else{d=document.body.scrollTop}f=document.body.offsetHeight;e=document.documentElement.clientHeight;var c=(f-(d+e));return c},initialize:function(){this.$overlay=this.element.getElement(".btt-padding");this.style();this.positionButton()},trackImpression:function(){}})}(ox,modules));(function(a,b){a.View.extend("modules.common.PinCounts",{autoRender:false,events:{"click a":function(d,c,e){this.record(c.get("name"))}},contextEvents:{"change TravelMap_FriendPinCounts *":function(){var c=this.context.get("TravelMap_FriendPinCounts");if(c&&this.counters.city&&this.counters.country){if(c.get("city")==0){this.render()}else{this.counters.city.enqueue(c.get("city"));this.counters.country.enqueue(c.get("country"))}}else{this.render()}}},initialize:function(){this.counters={};if(this.context.get("TravelMap_FriendPinCounts")&&this.context.get("TravelMap_FriendPinCounts.city")&&this.context.get("TravelMap_FriendPinCounts.country")){this.counters={city:new ta.travelmap.component.Counter(this.element.getElement("#counter-city-common"),this.context.get("TravelMap_FriendPinCounts.city")),country:new ta.travelmap.component.Counter(this.element.getElement("#counter-country-common"),this.context.get("TravelMap_FriendPinCounts.country"))}}},record:function(c){return ta.util.action.record(this.name+"_"+c,null,{module:this.name,action:c})}})}(ox,modules));(function(a,b){a.View.extend("modules.membercenter.AboutMe",{autoRender:false,initialize:function(){this.initPlaceholder(ta.id("aboutMe"))},events:{"click .toggleDescription":function(d,c,e){var f=!this.context.get("MemberCenter_ProfileData.data.showSnippet");this.context.get("MemberCenter_ProfileData.data").set("showSnippet",f);this.render();if(f){this.record("read-less")}else{this.record("read-more")}},"click .edit":function(){this.context.get("MemberCenter_ProfileData").set("edit",true);this.record("edit");this.render()},"click .save":function(){this.showSaving();var f=this.context.get("MemberCenter_ProfileData.data");var h=ta.id("hometown");var e=ta.id("gender");var c=ta.id("age");var d=ta.id("aboutMe");var i="";if(d){i=d.get("value");if(i==d.get("placeholder")){i=""}}if(h){f.set("hometown",h.get("value"))}if(e){f.set("genderLetter",e.get("value"))}if(c){f.set("age",c.get("value"))}if(d){f.set("aboutMe",i)}var g={hometown:f.get("hometown"),gender:f.get("genderLetter"),age:f.get("age"),aboutMe:f.get("aboutMe")};f.save(g).success(function(j){this.hideSaving();this.context.get("MemberCenter_ProfileData").set("edit",false);this.render()},this).failure(function(j){this.hideSaving();this.showErrors()},this)}},showSaving:function(){var c=this;this.savingTimeout=setTimeout(function(d){if(d.element){d.element.addClass("saving")}},500,this)},hideSaving:function(){clearTimeout(this.savingTimeout);if(this.element){this.element.removeClass("saving")}},showErrors:function(){var e=this.element.getElement(".info");if(e){var c=e.getElement(".errors, .errorMsg");if(c){c.dispose()}var f=this.context.get("Errors.SaveProfileDataAction");if(f.length){var d=f.length>1?"errors":"errorMsg";c=new Element("ul",{"class":d});f.each(function(g){c.adopt(new Element("li",{html:g}))});e.grab(c,"top")}}},initPlaceholder:function(d){var c=function(g,f){if(f){if(g.get("value")==g.get("placeholder")){g.set("value","");g.removeClass("placeholder")}}else{if(!g.get("value").trim()){g.set("value",g.get("placeholder"));g.addClass("placeholder")}}};var e=("placeholder" in document.createElement("input"));if(d&&!e){if(d.hasAttribute("placeholder")){c(d,false);d.addEvent("blur",function(){c(d,false)});d.addEvent("focus",function(){c(d,true)})}}},record:function(d){var c=this.context.get("Member.data.isLoggedInMember")?"modules.membercenter.YourAboutMe":"modules.membercenter.PublicAboutMe";return ta.util.action.record(c+"_"+d,null,{module:c,action:d})}})}(ox,modules));(function(a,b){a.View.extend("modules.membercenter.MemberProfileLinks",{autoRender:true,events:{"click .add-cities":function(d,c,e){this.record("click-add-cities");window.location="/TravelMapHome"},"click .message":function(d,c,e){this.record("send-message");ta.util.cookie.setPIDCookie(271);ta.call("ta.overlays.Factory.showSendMessage",d,c)}},contextEvents:{},initialize:function(){},record:function(c){return ta.util.action.record(this.name+"_"+c,null,{module:this.name,action:c})}})}(ox,modules));(function(a,b){a.View.extend("modules.membercenter.DestinationExpert",{autoRender:false,events:{"click .moreLnk":function(e,c,f){this.record("view-more-DE");var d=this.context.get("MemberCenter_DestinationExpert").length;this.context.get("MemberCenter_AboutMeView").set("DEDisplayCount",d);this.render()}},contextEvents:{},initialize:function(){},record:function(d){var c=(this.context.get("Member.data.isLoggedInMember"))?"modules.membercenter.YourDestinationExpert":"modules.membercenter.PublicDestinationExpert";return ta.util.action.record(c+"_"+d,null,{module:c,action:d})}})}(ox,modules));(function(a,b){a.View.extend("modules.membercenter.PublicHeader",{autoRender:false,events:{"click .viewProfile":function(d,c,e){this.record("view-profile")},"click .returnToLink":function(d,c,e){this.record("continue-browsing")},"click .contributionLink":function(d,c,e){this.record("contribution-link-"+c.get("name"))},"mouseover .picture":function(g,f){var e=f.getParent().getElements(".friendName");if(e[0]){e.removeClass("hidden");var j=e.getSize()[0].x;var d=f.getParent().getElement(".picture").getSize().x;var i=e.getStyle("padding")[0].toInt();var c=e.getStyle("border-radius")[0];if(c){c=c.toInt()}else{c=0}var h=-1*(j+d)/2;e.setStyle("margin-left",h);e.setStyle("margin-right",h)}},"mouseout .picture":function(e,d){var c=d.getParent().getElements(".friendName");if(c){c.addClass("hidden")}},"click .clickablePicture":function(d,c,e){this.record("YourAvatarClick");window.location="/TravelMapHome"},"click .friend":function(d,c,e){this.record("FriendAvatarClick");window.location=e.context.get("friend.member.link")+"?offset="+this.context.get("Social_FriendCarouselModel.begin")},"click .leftCarouselArrow.enable":function(d,c){this.record("FriendCarouselLeftArrow");this.context.get("Social_FriendCarouselModel").previous()},"click .rightCarouselArrow.enable":function(d,c){this.record("FriendCarouselRightArrow");this.context.get("Social_FriendCarouselModel").next()}},contextEvents:{"add MemberCenter_FriendsByContributionCount":function(){this.render()},"change MemberCenter_FriendCount.TAFriendCount":function(){this.render()},"change Social_SocialUser.data":function(){this.render()},"change Social_FriendCarouselModel *":function(){var d=this.context.get("MemberCenter_FriendsByContributionCount").getOffset();var c=this.context.get("MemberCenter_FriendsByContributionCount").length;if(d>this.context.get("Social_FriendCarouselModel.begin")||d+c<=this.context.get("Social_FriendCarouselModel.begin")){this.context.get("MemberCenter_FriendsByContributionCount").fetch({memberId:this.context.get("Member.data.id"),locationId:1,offset:this.context.get("Social_FriendCarouselModel.begin")})}else{this.render()}}},initialize:function(){},record:function(c){return ta.util.action.record(this.name+"_"+c,null,{module:this.name,action:c})}})}(ox,modules));(function(a,b){a.View.extend("modules.membercenter.FriendCarousel",{autoRender:false,events:{"mouseover .picture":function(g,f){var e=f.getParent().getElements(".friendName");if(e[0]){e.removeClass("hidden");var j=e.getSize()[0].x;var d=f.getParent().getElement(".picture").getSize().x;var i=e.getStyle("padding")[0].toInt();var c=e.getStyle("border-radius")[0];if(c){c=c.toInt()}else{c=0}var h=-1*(j+d)/2;e.setStyle("margin-left",h);e.setStyle("margin-right",h)}},"mouseout .picture":function(e,d){var c=d.getParent().getElements(".friendName");if(c){c.addClass("hidden")}},"click .yourPicture":function(d,c,e){this.record("YourAvatarClick");if(this.context.get("MemberCenter_AboutMeView.isAboutMe")){window.location=this.context.get("LoggedInMember.data.profileLink")}else{window.location="/TravelMapHome"}},"click .friend":function(d,c,e){this.record("FriendAvatarClick");window.location=e.context.get("friend.member.link")+"?offset="+this.context.get("Social_FriendCarouselModel.begin")},"click .leftCarouselArrow.enable":function(d,c){this.record("FriendCarouselLeftArrow");this.context.get("Social_FriendCarouselModel").previous()},"click .rightCarouselArrow.enable":function(d,c){this.record("FriendCarouselRightArrow");this.context.get("Social_FriendCarouselModel").next()}},contextEvents:{"add MemberCenter_FriendsByContributionCount":function(){this.render()},"change Social_FriendCarouselModel *":function(){if(this.context.get("MemberCenter_FriendsByContributionCount").length<this.context.get("Social_FriendCarouselModel.end")){this.context.get("MemberCenter_FriendsByContributionCount").fetch({memberId:this.context.get("LoggedInMember.data.id"),locationId:1,offset:this.context.get("Social_FriendCarouselModel.begin")})}else{this.render()}}},initialize:function(){}})}(ox,modules));(function(a,b){b.common.model.ListViewModel.extend("modules.social.model.FriendCarouselModel")}(ox,modules));(function(a,b){a.Stream.extend("modules.membercenter.collection.FriendsByContributionCount")}(ox,modules));(function(a,b){a.View.extend("modules.membercenter.ReviewBadges",{events:{"click .badges-container.collapsable":function(c,e){if(c.target.nodeName==="A"){return}var d=e.hasClass("badges-expanded")?"Hide":"Show";e.toggleClass("badges-expanded");this.record("ToggleBadgeView",{context:d})},"click .badge-FirstToReviewBadge":function(c,d){this.record("ShowDiscoveryLightbox");this.$BACKDROP.removeClass("hidden");this.$BACKDROPCLOSE.removeClass("hidden");this.$LIGHTBOX_DISCOVERY.removeClass("hidden");$$("body").setStyle("overflow","hidden")},"click .badge-TcReviewerBadge":function(c,d){this.record("ShowTcReviewerLightbox");this.$BACKDROP.removeClass("hidden");this.$BACKDROPCLOSE.removeClass("hidden");this.$LIGHTBOX_TC_REVIEWER.removeClass("hidden");$$("body").setStyle("overflow","hidden")},"click .badgeLightboxBackdrop, .badgeLightboxBackdropClose":function(c,e){this.$BACKDROP.addClass("hidden");this.$BACKDROPCLOSE.addClass("hidden");this.$LIGHTBOX_DISCOVERY.addClass("hidden");this.$LIGHTBOX_TC_REVIEWER.addClass("hidden");$$("body").setStyle("overflow","auto");var d=e.hasClass("badgeLightboxBackdropClose")?"CloseButton":"Backdrop";this.record("CloseBadgeLightbox",{context:d})},"click .badgeLightbox a":function(c,d){this.record("ClickDiscoveryReview");window.open(d.href);c.preventDefault()}},initialize:function(){this.$BACKDROP=this.element.getElement(".badgeLightboxBackdrop");this.$BACKDROPCLOSE=this.element.getElement(".badgeLightboxBackdropClose");this.$LIGHTBOX_DISCOVERY=this.element.getElement(".discoveryBadgeLightbox");this.$LIGHTBOX_TC_REVIEWER=this.element.getElement(".tchBadgeLightbox")}})}(ox,modules));(function(a){function b(c){this.oxapp=c;this.impressionState={};this.trackImpressions()}b.prototype.trackImpressions=ta.util.debounce(function(){for(var c in this.oxapp._subviews){var d=this.oxapp.getSubview(c);var e=d.trackVisibility();if(e&&!this.impressionState[c]){d.trackImpression()}this.impressionState[c]=e}},50);a.component.ViewTracker=b})(modules);(function(a,b){a.View.extend("modules.membercenter.MemberTag",{taggingOverlay:null,taggedItems:[],pid:ta.retrieve("tagPid"),events:{"click .editTags":function(d,c,e){this.record(c.get("name"));this.displayTagLB()},"click .tagBubble":function(e,d,f){if(!this.context.get("Member.data.isLoggedInMember")){return}if(!d.get("name")){this.record("add_tags")}else{this.record(d.get("name"))}if(this.context.get("MemberCenter_MemberTags")&&this.context.get("MemberCenter_MemberTags")._items&&this.context.get("MemberCenter_MemberTags")._items.length==0){var c=d.get("id");if(c){this.taggedItems.push(+c)}}this.displayTagLB()},"click .expansionControl":function(d,c,e){this.context.get("MemberCenter_MemberTagsView").set("expanded",!this.context.get("MemberCenter_MemberTagsView.expanded"));ta.find(".modules-membercenter-member-tag .separator").setStyle("height",(0.8*ta.find(".modules-membercenter-member-tag .tagBlock").getSize().y)+"px")}},initialize:function(){if(!this.taggingOverlay){this.taggingOverlay=new ta.overlays.CenteredOverlay({content:ta.id("tagPrompt"),backdrop:ta.overlays.BACKDROP_ALWAYS,autoShow:false,style:"taggingOverlay",noPadding:true,showCloseButton:false})}this.taggedItems=[];for(var c=0;c<this.context.get("MemberCenter_MemberTags")._items.length;c++){if(this.context.get("MemberCenter_MemberTags")._items[c].get("isTagged")){this.taggedItems.push(this.context.get("MemberCenter_MemberTags")._items[c].get("id"))}}var f=ta.id("tagSuggest");var d=ta.id("tagDisplay");var e=ta.id("tagHeader");if(f&&d&&e&&f.getStyle("width")>d.getStyle("max-width")){f.setStyle("font-size","12px");ta.select(".tagBubble").each(function(g){g.setStyle("font-size","12px")});e.setStyle("font-size","16px")}},displayTagLB:function(){this.taggingOverlay.show();ta.servlet.Registration.activateMemberTagSubmit(true);var c=ta.select(".tagSelection");for(var d=0;d<c.length;d++){var e=c[d].value;if(c[d].checked!=this.taggedItems.contains(+e)){ta.servlet.Registration.toggleTagged(e,this.context.get("MemberCenter_MemberTagsView.requiredTagCount"),true,this.context.get("MemberCenter_MemberTagsView.progressTestType"))}}},record:function(c){if(this.pid){c=this.pid+"_"+c}return a.View.prototype.record(c,{module:this.name})}})}(ox,modules));(function(a,b){a.View.extend("modules.membercenter.MemberProfile",{autoRender:false,events:{"click .profileLinks":function(f,e){var g=ta.find(".profLinksArrowDown");var d=ta.find(".profLinksArrowUp");var c=e.retrieve("profOverlay");if(!c){c=new ta.overlays.RelativeOverlayBelow({style:"profileLinksDropdown",autoShow:false,closeOnDocumentClick:true,justify:"right",offsetLeft:-25},e);c.addEvent("onShow",function(){g&&g.removeClass("hidden");d&&d.addClass("hidden")});c.addEvent("onHide",function(){g&&g.addClass("hidden");d&&d.removeClass("hidden")});e.store("profOverlay",c);this.record("ProfileOverlay",{context:"open"});setTimeout(function(){c.show()},0)}else{if(d.hasClass("hidden")){this.record("ProfileOverlay",{context:"close"});c.hide()}else{this.record("ProfileOverlay",{context:"open"});setTimeout(function(){c.show()},0)}}},"click .message":function(d,c,e){this.record("send-message");ta.util.cookie.setPIDCookie(271);ta.call("ta.overlays.Factory.showSendMessage",d,c)}},initialize:function(){if(window.getComputedStyle){var g=".nameContent .name";var f=".nameText";var c=ta.find(".nameContent .nameText");if(!c){return}var d=window.getComputedStyle(c,null).getPropertyValue("font-size");var e=parseFloat(d)||28;c.removeClass("stylesToRemove");ta.util.element.makeTextFit(g,f,e)}}})}(ox,modules));(function(a,b){a.View.extend("modules.membercenter.BadgeCollection",{autoRender:false,events:{"click .memberBadges":function(f,d,c){if(f.target&&(f.target.hasClass("cta")||f.target.getParent().hasClass("cta"))){this.record("BadgeCollection",{context:"CTA"});return}var e=ta.util.i18n.isRtl()?-195:175;var g=-25;if(d.hasClass("CTACont")){e=350}this.record("BadgeCollection",{context:c._item.get("type")});this.context.get("Achievements_BadgeFlyoutView").set("selected",{item:d,id:d.get("data-ox-id"),xOffset:e,yOffset:g})},"click .war_cta a":function(e,d,c){this.record("BadgeCollection_war_cta")}}})})(ox,modules);(function(a,b){a.View.extend("modules.membercenter.NextAchievement",{events:{"click .content":function(d,c){this.record("ClickNextAskCTA")}}})}(ox,modules));(function(a,b){a.View.extend("modules.membercenter.LevelProgress",{initialize:function(){setTimeout(function(){var d=this.element.getElement(".progress");if(!d){return}var c=this.context.get("Achievements_LevelProgress.data.percent_complete");d.setStyle("width",c+"%")}.bind(this),800)}})}(ox,modules));(function(a,b){a.View.extend("modules.membercenter.EarnPointsCTA",{events:{"click .cta_url":function(e,d){var c=d.get("data-action-type")||"undefined_action";this.record("CTAClick",{context:c})}}})}(ox,modules));(function(a,b){a.View.extend("modules.membercenter.BadgeFlyout",{autoRender:false,initialize:function(){this.context.get("Achievements_BadgeFlyoutView").notifyOnSet=true},contextEvents:{"set Achievements_BadgeFlyoutView.selected":function(g){var e=this.context.get("Achievements_BadgeFlyoutView.selected");if(!e){return}var j=e.get("id");var f=e.get("item");var d=e.get("xOffset");var i=e.get("yOffset");var c=f.retrieve("descOverlay");if(!c){var h=this.element.getElement('[data-ox-id="'+j+'"]');if(!h){return}c=new ta.overlays.RelativeOverlayIn({style:"badgeDesc",autoShow:false,closeOnDocumentClick:true,center:true,xOffset:d,yOffset:i,content:h.innerHTML},f);c.inner.getElement(".closeBtn").addEvent("click",function(){c.hide();this.record("CloseBadgeFlyout")}.bind(this));f.store("descOverlay",c)}setTimeout(function(){c.show()},0)}}})}(ox,modules));(function(a,b){a.View.extend("modules.membercenter.BadgeTeaser",{autoRender:false,events:{"click .clickableBadge":function(e,d){var c=this.context.get("Member.data.isLoggedInMember")?"OwnProfile":"OtherUserProfile";var f=d.hasClass("currentBadge")?"CurrentBadge":"Badge";this.record("ClickBadgeTeaser-"+c,{context:f});this.context.get("Achievements_BadgeFlyoutView").set("selected",{item:d,id:d.get("data-badge-id"),xOffset:ta.util.i18n.isRtl()?-150:150,yOffset:-15})},"click .header .name .totalBadges":function(d,c){var e=this.context.get("Member.data.isLoggedInMember")?"OwnProfile":"OtherUserProfile";this.record("TotalBadges",{context:e}).success(function(){window.location=c.href});d.preventDefault()},"click .header .trophyCase":function(d,c){var e=this.context.get("Member.data.isLoggedInMember")?"OwnProfile":"OtherUserProfile";this.record("ViewCollection",{context:e}).success(function(){window.location=c.href});d.preventDefault()}}})}(ox,modules));(function(a,b){a.View.extend("modules.membercenter.ContentSummary",{events:{"click .content-link":function(d,c,e){this.record("ContentSummary",{context:c.get("name")})}}})}(ox,modules));(function(a,b){a.View.extend("modules.membercenter.ProgressHeader",{events:{"click .link":function(d,c,e){this.record("TripCollective",{context:"MemberProfile"})}}})}(ox,modules));(function(b,c){var d="FlyoutRight";var g="FlyoutLeft";var f="OpenTripCollectiveInfo";var e="Flyout";var a="CloseTripCollectiveInfo";b.View.extend("modules.membercenter.TripCollectiveInfo",{autoRender:false,show:function(h,j,p){p=p||{};var l=this.element.getElement('[data-info-id="'+j+'"]');var o=this.getType(p.type);var i=p.openTracking||f+"_"+j;var n=p.closeTracking||a+"_"+j;var k=p.trackingContext||e;if(o===d){var m=new ta.overlays.RelativeOverlayRight({style:"infoFlyout "+j,autoShow:p.autoShow||false,showArrow:true,arrowClass:"arrow_left",arrowClassRight:"arrow_right",closeOnDocumentClick:true,pointArrowToSource:true,arrowHeight:p.arrowHeight||10,allowRightArrowPos:true,content:l.innerHTML},h)}else{if(o===g){var m=new ta.overlays.RelativeOverlayLeft({style:"infoFlyout "+j,autoShow:p.autoShow||false,showArrow:true,arrowClass:"arrow_right",arrowClassRight:"arrow_left",closeOnDocumentClick:true,pointArrowToSource:true,arrowHeight:p.arrowHeight||10,allowRightArrowPos:true,content:l.innerHTML},h)}}m.inner.getElement(".closeBtn").addEvent("click",function(){m.hide();this.record(n,{context:k})}.bind(this));setTimeout(function(){this.record(i,{context:k});m.show()}.bind(this),0)},getType:function(h){h=h||d;if(h===d&&ta.util.i18n.isRtl()){h=g}else{if(h===g&&ta.util.i18n.isRtl()){h=d}}return h}})}(ox,modules));(function(a,b){a.App.extend("modules.membercenter.BadgeCollectionApp",{events:{"click .badgeContents .action":function(d,c){this.record("BadgeCollectionFlyout",{context:"WarCTA"})},"click .listLoc .loc a":function(d,c){this.record("BadgeCollectionFlyout",{context:"ShowUserReviewLink"})}}})}(ox,modules));(function(a,b){a.View.extend("modules.membercenter.ContentStream",{events:{"click .cs-contribution-bar li":function(c,d){var e=d.get("data-filter");this.context.get("MemberCenter_ContentStreamComposite").fetch({filter:e,offset:0});this.record("ClickTab",{context:e})},"click .cs-filter-bar li":function(c,d){var e=d.get("data-filter");this.context.get("MemberCenter_ContentStreamComposite").fetch({filter:e,offset:0});this.record("ClickFilter",{context:e})},"click a":function(c,d){if(d.get("href").indexOf("PostPhotos")>=0){this.record("ClickAddPhotos")}},"click .cs-filter-bar a, .cs-contribution-bar a":function(c,d){c.preventDefault()},"click .cs-filter-bar li, .cs-contribution-bar li":function(c,d){var d=d.getChildren("a")[0];if(!d){return}if(history&&history.pushState){history.pushState({},"",d.href)}},"click #cs-paginate-previous":function(c,e){if(e.hasClass("disabled")){return}var d=this.context.get("MemberCenter_ContentStreamComposite");d.fetch({offset:Math.max(d.get("offset")-d.get("limit"),0)}).success(function(){new Fx.Scroll(window,{duration:500,transition:"quart:out"}).toElement(this.element,"y")}.bind(this));var f=this.context.get("MemberCenter_ContentStreamComposite.filter");this.record("ClickPrevious_"+f,{context:d.get("offset")})},"click #cs-paginate-next":function(c,e){if(e.hasClass("disabled")){return}var d=this.context.get("MemberCenter_ContentStreamComposite");d.fetch({offset:d.get("offset")+d.get("limit")}).success(function(){new Fx.Scroll(window,{duration:500,transition:"quart:out"}).toElement(this.element,"y")}.bind(this));var f=this.context.get("MemberCenter_ContentStreamComposite.filter");this.record("ClickNext_"+f,{context:d.get("offset")})},"click .cs-paginate-goto":function(d,f){var c=+f.get("text");var e=this.context.get("MemberCenter_ContentStreamComposite");e.fetch({offset:(c-1)*e.get("limit")}).success(function(){new Fx.Scroll(window,{duration:500,transition:"quart:out"}).toElement(this.element,"y")}.bind(this));var g=this.context.get("MemberCenter_ContentStreamComposite.filter");this.record("ClickPageNum_"+g,{context:c})},"click .cs-photo-thumb a":function(c,d){this.record("ClickPhotoThumb");Cookie.write("PhotoPop",0,{domain:cookieDomain,path:"/"});var e=ta.servlet.Popup.open(d.href,"media",780,800);c.preventDefault()},"click .cs-points-bonus":function(d,e){var c=this.element.getElement(".cs-points-bonus-description");c.removeClass("hidden");c.position({relativeTo:e,position:"centerTop",edge:"bottom",offset:{y:-21}});d.stopPropagation()}},record:function(e,d){var c=this.context.get("MemberCenter_ContentStreamComposite.isLoggedInMember")?"Self_":"Other_";d.module=this.name;return a.View.prototype.record(c+e,d)}})}(ox,modules));function findPos(a){var b=curtop=0;if(a.offsetParent){b=a.offsetLeft;curtop=a.offsetTop;while(a=a.offsetParent){b+=a.offsetLeft;curtop+=a.offsetTop}}return[b,curtop]}function getEventPosition(b){if(!b&&window.event){b=window.event}var a=y=0;if(b.clientX){a=b.clientX;y=b.clientY}else{if(b.pageX){a=b.pageX;y=b.pageY}}return[a,y]}function confirmBubbleForm(o,c,m,k,b,d){var h=confirmBubbleForm.arguments;var f=new Array();for(i=6;i<h.length;i++){f[i-6]=h[i]}var j=findPos(ta.id(o));var e=j[0];var n=j[1];if(e!=0&&n!=0){var g=e+m-14;var a=n+k+19;if(ta.id("confirmBubbleForm").style.display=="block"){ta.id("confirmBubbleForm").style.display="none"}else{ta.id("confirmBubbleForm").style.display="block";ta.id("confirmBubbleForm").style.position="absolute";ta.id("confirmBubbleForm").style.left=g+"px";ta.id("confirmBubbleForm").style.top=a+"px";ta.id("bubbleQuestion").innerHTML=b;document.body.appendChild(ta.id("confirmBubbleForm"));ta.id("confirmBubbleNo").onclick=function(){hideConfirmBubbleForm()};ta.id("confirmBubbleYes").onclick=function(){d.apply(this,f)}}}}function hideConfirmBubbleForm(){document.getElementById("confirmBubbleForm").style.display="none"}function confirmBubble(p,b,n,m,a,c){var g=$("confirmBubble");if(g){g.parentNode.removeChild(g)}var f=confirmBubble.arguments;var e=new Array();if(a==""){a=JS_common__207f}if(c){confirmBubbleFunc=c;if(typeof confirmDeleteFriend=="function"&&c==confirmDeleteFriend){e[0]=f[6];e[1]="'"+f[7]+"'"}else{for(i=6;i<f.length;i++){e[i-6]=f[i]}}}else{confirmBubbleFunc=function(){}}var j=findPos($(p));var d=j[0];var o=j[1];if(d!=0&&o!=0){var k=new Element("div",{id:"confirmBubble","class":"navigationPopBox",styles:{display:"block",position:"absolute",left:d+n-14,top:o+m+19}});var h=new StringBuffer();h.append('<div class="saveShadow"><div class="saveShell">');h.append('<div class="navigationPopPoint" style=" top: -5px; left: 20px;">');h.append('<img src="'+cdnHost+'/img/m2m/arrowPointUpEdit.gif" width="13" height="7" border="0"/>');h.append("</div>");h.append('<div class="saveBodyFluid">');h.append(a+"<br /><br />");if(b==1){h.append('<div class="m2m_link_gold" style="margin-right: 20px;"><div style="cursor: pointer;" onclick="$(\'confirmBubble\').parentNode.removeChild($(\'confirmBubble\'));"><div class="m2m_copy"><img src="'+cdnHost+'/img/m2m/m2m_leftBG_Gold.gif" alt="'+JS_common_No+'" align="absmiddle" border="0" height="20" width="5" /><strong>'+JS_common_No+"</strong></div></div></div>");h.append('<div class="m2m_link"><div style="cursor: pointer;" onclick="confirmBubbleFunc('+e+");$('confirmBubble').parentNode.removeChild($('confirmBubble'));\"><div class=\"m2m_copy\"><img src=\""+cdnHost+'/img/m2m/m2m_leftBG.gif" alt="'+JS_common_Yes+'" align="absmiddle" border="0" height="20" width="5" />'+JS_common_Yes+"</div></div></div>")}else{h.append('<div class="m2m_link" style="margin-right: 20px;"><div style="cursor: pointer;" onclick="$(\'confirmBubble\').parentNode.removeChild($(\'confirmBubble\'));"><div class="m2m_copy"><img src="'+cdnHost+'/img/m2m/m2m_leftBG.gif" alt="'+JS_common_No+'" align="absmiddle" border="0" height="20" width="5" />'+JS_common_No+"</div></div></div>");h.append('<div class="m2m_link_gold"><div style="cursor: pointer;" onclick="confirmBubbleFunc('+e+");$('confirmBubble').parentNode.removeChild($('confirmBubble'));\"><div class=\"m2m_copy\"><img src=\""+cdnHost+'/img/m2m/m2m_leftBG_Gold.gif" alt="'+JS_common_Yes+'" align="absmiddle" border="0" height="20" width="5" /><strong>'+JS_common_Yes+"</strong></div></div></div>")}h.append("<br /><br />");h.append("</div>");h.append("</div></div>");k.set("html",h);document.body.appendChild(k)}}function dialogBubble(m,j,h,b,g,a){closeDialogBubble();if(b==null){b=""}if(g==null||g==""){g=0}g=g+20;var e=findPos($(m));var c=e[0];var k=e[1];if(c!=0&&k!=0){var f=new Element("div",{id:"confirmBubble","class":"navigationPopBox",styles:{display:"block",position:"absolute",left:c+j+6-g,top:k+h+19,"z-index":5120}});if(a!=""&&a!=null){f.setStyle("width",a)}var d=new StringBuffer();d.append('<div class="saveShadow"><div class="saveShell">');d.append('<div class="navigationPopPoint" style="top: -5px; left: '+g+'px;">');d.append('<img src="'+cdnHost+'/img/m2m/arrowPointUpEdit.gif" width="13" height="7" border="0"/>');d.append("</div>");d.append('<div class="saveBodyFluid">');d.append(b);d.append('<div style="text-align: right;"><a href="javascript:void(0)" onclick="closeDialogBubble();">'+JS_close+"</a></div>");d.append("</div>");d.append("</div></div>");f.set("html",d);document.body.appendChild(f)}}function closeDialogBubble(){var a=$("confirmBubble");if(a){a.parentNode.removeChild(a)}}var floater;function FloatingDialog(b){var c=floater;if(c==null){var c=new Element("div",{"class":"memberProfile"});floater=c}var a=getScrollOffset();c.setProperty("id","floater");c.setStyles({width:"400px",position:"absolute","z-index":5120,left:"-5000px",top:a[1],display:"block"});c.set("html",b);document.body.appendChild(c);c.centerOnScreen()}function closeFloater(){if(floater){hide(floater)}if($("floaterIframe")){document.body.removeChild($("floaterIframe"))}return false}function centerMe(e){var g=e;var a=getWindowSize();var c=getScrollOffset();var d=getSize(g);var b=(Math.round((a.width-d[0])/2)+c[0]);var f=(Math.round((a.height-d[1])/2)+c[1]);g.setStyles({left:b,right:f});return[b,f,d[0],d[1]]}function getWindowSize(){var a=0,b=0;if(typeof(window.innerWidth)=="number"){a=window.innerWidth;b=window.innerHeight}else{if(document.documentElement&&(document.documentElement.clientWidth||document.documentElement.clientHeight)){a=document.documentElement.clientWidth;b=document.documentElement.clientHeight}else{if(document.body&&(document.body.clientWidth||document.body.clientHeight)){a=document.body.clientWidth;b=document.body.clientHeight}}}return{width:a,height:b}}function showPrivacyPolicy(){var a="http://"+document.location.host+"/pages/privacy.html";window.open(a,"PrivacyPolicy","toolbar=0,resizable=1,menubar=0,location=0,status=0,scrollbars=3,width=800,height=600,screenX=30,screenY=25,left=30,top=25")}function selectAll(d,c){var b=document.getElementById(d).elements;for(var a=0;a<b.length;a++){b[a].checked=c}return false}function allSelected(d){var b=document.getElementById(d).elements;for(var a=0;a<b.length;a++){var c=b[a];if(c.type=="checkbox"&&c.checked==false){return false}}return true}var AjaxRequest=function(a,d,c,b){new Request({url:a,data:c,evalScripts:true,onSuccess:b}).send()};var AjaxResponseDialog=function(a){FloatingDialog(a)};var bRecaptchaSetup=false;function AjaxSendMessage(e,b){if(typeof(b)=="undefined"){b=true}var c=function(){new Request({url:"/SendMessage",data:e,evalScripts:true,onSuccess:sendMessageAjaxResponseDialog}).send()};if(!bRecaptchaSetup&&b){var a=document.getElementsByTagName("head")[0];var d=document.createElement("script");d.type="text/javascript";d.onload=c;d.onreadystatechange=function(){if(this.readyState=="loaded"||this.readyState=="complete"){c()}};d.src="http://www.google.com/recaptcha/api/js/recaptcha_ajax.js";a.appendChild(d);bRecaptchaSetup=true}else{new Request({url:"/SendMessage",data:e,evalScripts:true,onSuccess:sendMessageAjaxResponseDialog}).send()}}var sendMessageAjaxResponseDialog=function(a){FloatingDialog(a);if(typeof window.callback_ShowRecaptcha!="undefined"){var b=window.callback_ShowRecaptcha;b()}};var serializeForm=function(a){return $(a)};var messageSettings=function(b){if(b=="away"){var a={t:"op",op:4,token:JS_SECURITY_TOKEN}}else{if(b=="block"){var a={t:"bl",token:JS_SECURITY_TOKEN}}}new Request({url:"/MessagingOptions",data:a,evalScripts:true,onSuccess:function(c,d){FloatingDialog(c)}}).send()};var openUrlFromIframe=function(a,b){new Event(b).preventDefault();document.location=a};function setSelRange(c,d,a){if(!a){a=d}c.focus();if(c.setSelectionRange){c.setSelectionRange(d,a)}else{if(c.createTextRange){var b=c.createTextRange();b.collapse(true);b.moveEnd("character",a);b.moveStart("character",d);b.select()}}}function getElementsByClassName(b,f,a){var e=(f=="*"&&b.all)?b.all:b.getElementsByTagName(f);var h=new Array();a=a.replace(/-/g,"-");var g=new RegExp("(^|\\s)"+a+"(\\s|$)");var d;for(var c=0;c<e.length;c++){d=e[c];if(g.test(d.className)){h.push(d)}}return h}function cssButton(b,a){button='<div class="m2m_link"><div style="cursor: pointer;"><div class="m2m_copy"><img src="'+cdnHost+'/img/m2m/m2m_leftBG.gif" alt="';button+=b;button+='" align="absmiddle" border="0" height="20" width="5" />';if(a!=""){button+='<img src="'+a+'" alt="" align="absmiddle" style="padding-right:3px;" />'}button+=b;button+="</div></div></div>";return button}function cssButtonG(b,a){button='<div class="m2m_link_gold"><div style="cursor: pointer;"><div class="m2m_copy"><img src="'+cdnHost+'/img/m2m/m2m_leftBG_Gold.gif" alt="';button+=b;button+='" align="absmiddle" border="0" height="20" width="5" />';if(a!=""){button+='<img src="'+a+'" alt="" align="absmiddle" style="padding-right:3px;" />'}button+="<strong>"+b+"</strong>";button+="</div></div></div>";return button}function scaleImage(a,c){$(a).setStyle("visibility","hidden");var b=new Asset.image($(a).src,{onload:function(){scaleImageDims(b,a,c)}})}function scaleImageDims(d,b,e){if(d.width>d.height){var c=e;var a=c*d.height/d.width}else{var a=e;var c=a*d.width/d.height}$(b).setStyles({height:a,width:c,visibility:"visible"})}function isNotMax(d){var c=d.getAttribute("maxlength");var a=d.value.length<=c;if(!a){d.value=d.value.slice(0,c)}return a}function showPhotoPopup(a){var c=a.match(/#([0-9]+)/)[1];if(!c){c="1"}Cookie.write("PhotoPop",c,{domain:cookieDomain,path:"/"});var b=ta.servlet.Popup.open(a,"media",780,800);if(b!=null){b.focus()}if(b&&b.showImage){b.showImage(c)}return false};(function(a,b){a.View.extend("modules.membercenter.PersistentHeaderAchievements",{events:{"mousemove .settings":function(f,d){var c=ta.find("li.settings");var e=ta.find(".settingsDropDown");if(c&&e){c.addClass("arrow");e.setStyle("display","block")}},"mouseleave .settings":function(f,d){var c=ta.find("li.settings");var e=ta.find(".settingsDropDown");if(c&&e){c.removeClass("arrow");e.setStyle("display","none")}}},initialize:function(){var c=this.context.get("MemberCenter_ContributionView").get("activeTab");var d=ta.id(c);if(d){d.addClass("active")}}})}(ox,modules));(function(a){a.component.DynamicGrid=function(b,d,e,c){this.originalColPos=e?e.slice(0):[];this.currentColPos=e;this.className=d;this.colWidths=c;this.container=b;while(this.colWidths.length<this.originalColPos.length){this.colWidths.push(this.colWidths[this.colWidths.length-1])}this.formatTiles(true)};a.component.DynamicGrid.prototype.resetTiles=function(){var b=$$(this.className);var c;for(c=0;c<b.length;c++){b[c].removeClass("positioned")}this.currentColPos=this.originalColPos.slice(0)};a.component.DynamicGrid.prototype.formatTiles=function(h){if(this.colWidths.length<this.originalColPos.length){this.initialize(this.colWidths,this.originalColPos.length)}if(h){this.resetTiles()}var k=$$(this.className);var d=this.currentColPos.length;var g;var f;for(g=0;g<k.length;g++){if(!k[g].hasClass("positioned")){var c=g%d;this.currentColPos[c]+=parseInt(k[g].getStyle("padding"))+parseInt(k[g].getStyle("margin"));k[g].setStyle("top",this.currentColPos[c]);f=0;var e=parseInt(k[g].getStyle("padding"))+parseInt(k[g].getStyle("margin"));while(f<c){e+=this.colWidths[f++]}k[g].setStyle("left",e);this.currentColPos[c]=this.currentColPos[c]+k[g].getHeight()+parseInt(k[g].getStyle("padding"))+parseInt(k[g].getStyle("margin"));k[g].addClass("positioned")}}f=0;var l=this.currentColPos[f];while(f<this.currentColPos.length){l=Math.max(this.currentColPos[f++],l)}f=0;var b=0;while(f<this.colWidths.length){b+=this.colWidths[f++]}if(ta.id(this.container)){ta.id(this.container).setStyle("height",l);ta.id(this.container).setStyle("width",b)}}}(modules));(function(a,b){a.Entity.extend("modules.common.entity.LoggedInMember",{saveMember:function(c,d){var f=[];this.get("all_emails").each(function(g){f.push(g.get("value"))});var e={firstname:this.get("firstname"),lastname:this.get("lastname"),username:this.get("username"),homeairport:ta.id("homeairport").get("value"),homeairport_complete:ta.id("homeairport").get("value"),homeairport_code:ta.id("homeairport_code").get("value"),primaryEmail:this.get("primaryEmail"),emails:f,currentPwd:c,thirdParty:d};return this.save(e)}})}(ox,modules));(function(a,b){a.Stream.extend("modules.membercenter.collection.FriendsByName")}(ox,modules));ta.media.uploader={start:function(k,b,d){try{ta.store("ta.media.uploader.params",d);if(!ta.retrieve("ta.media.uploader.cssAsset")){ta.store("ta.media.uploader.cssAsset",Asset.css("/css2/overlays/media_uploader.css"))}var a=Aurigma.ImageUploaderFlash.flashDetector.detectVersion();if(ta.retrieve("war_html_photo_uploader")||(!d.noFlash&&a[0]>=10)){var i="photo_only";if(d.isOwner){i="owner"}else{if(d.isGetListedRequest){i="GET_LISTED"}else{if(ta.retrieve("ta.media.uploader.flow")=="war"){i="WAR"}}}ta.trackEventOnPage("FlashPhotoUploader","create_overlay",i,1,false);ta.run("ta.overlays.Factory.createPhotoUploaderOverlay",null,ta.media.uploader.getServletUrl()+"?"+ta.media.uploader.getServletParams(d,"SHELL"))}else{if(ta.retrieve("ta.media.uploader.flow")=="war"){ta.store("ta.media.uploader.old",true);var j=document.getElement("#PPBTN");if(j){j.show()}new Request({url:"/uvpages/oldWARPhotoUploader.html?flashReplacementType="+(d.flashReplacementType?d.flashReplacementType:"hotel"),onSuccess:function(m){var l=ta.id("qid203");if(l){l.dispose()}var e=document.getElement(".addMorePhotos");if(e){e.innerHTML=m}if(d.noFlashLoaded){d.noFlashLoaded()}},onFailure:function(){ta.util.error.record(null,"war uploader - start no flash");if(d.oldPhotoUploadPID&&d.oldPhotoUploadPID.length>0){ta.util.cookie.setPIDCookie(d.oldPhotoUploadPID)}ta.util.ASDF.asdf(d.oldPhotoUploadURL)}}).send()}else{if(ta.retrieve("ta.media.uploader.flow")=="getlisted"){var g=ta.id("GETLISTED_PHOTO_UPLOADER");if(g!=null){g.addClass("hidden");var h=ta.id("LISTING_IMAGE_UPLOADER");if(h!=null){h.removeClass("hidden")}}}else{if(d.oldPhotoUploadPID&&d.oldPhotoUploadPID.length>0){ta.util.cookie.setPIDCookie(d.oldPhotoUploadPID)}var c=ta.util.ASDF.asdfDcd(d.oldPhotoUploadURL);if(d.noFlash){c=c+"?noFlash=true"}window.location=c}}}}catch(f){ta.util.error.record(f,"flash media uploader start")}},show:function(d,b,c,a){if(a){ta.store("ta.media.uploader.flow",a)}if(ta.has("ta.media.uploader.viewed")&&!ta.has("ta.media.uploader.old")){ta.store("ta.media.uploader.params",c);ta.media.uploader.reload()}else{ta.store("ta.media.uploader.viewed",true);ta.media.uploader.start(d,b,c)}},onLoadOverlayHandler:function(){try{var a=ta.retrieve("ta.media.uploader.photoUploaderOverlay");if(a){a.show()}else{ta.util.error.record(null,"onLoadOverlayHandler - photoUploaderOverlay does not exist")}var d=ta.retrieve("ta.media.uploader.params");if(d.locationId>1){var c=ta.id("photoUploaderSpinnerDiv");if(c){c.style.display="inline"}ta.media.uploader.createPhotoUploaderFlashObj(d);ta.media.uploader.insertPhotoUploader("photoUploaderDiv")}else{ta.media.uploader.insertLocationTypeahead()}}catch(b){ta.util.error.record(b,"onLoadOverlayHandler")}},insertLocationTypeahead:function(){new Request({url:ta.media.uploader.getServletUrl(),data:{flowaction:"LOCATION",isPhotoWall:true},method:"get",onSuccess:function(a,b){ta.id("photoUploaderDiv").innerHTML=a}}).send()},submitPhotosDescribeAjax:function(c){var b=ta.retrieve("ta.media.uploader.photoUploaderTranslations");var d=ta.id(c);var a=new Request({url:d.action,data:d,method:"post",onSuccess:ta.media.uploader.submitPhotosDescribeSuccessHandler,onFailure:function(){ta.util.error.record(null,"submitPhotosDescribeAjax")}});a.send()},submitPhotosDescribeSuccessHandler:function(n){var f=ta.retrieve("ta.media.uploader.params");var p="unknown";var b=1;try{b=document.getElement("div.numPhotosDiv span.numPhotosText span").innerHTML}catch(j){ta.util.error.record(j,"submitPhotosDescribeSuccessHandler - no photo count")}if((ta.media.uploader.isWARUploader()||f.isOwner||f.isGetListedRequest)&&n&&n.indexOf("UPLOAD_SUCCESS")!=-1){if(f.isOwner){p="owner";var h=ta.id("PHOTO");if(h){h.innerHTML=n+h.innerHTML}if(f.saveCallback){f.saveCallback()}ta.media.uploader.updateAddButtonText(false)}else{p=f.isGetListedRequest?"GET_LISTED":"WAR";var h=document.getElement(".photoUploadSet");if(h){if((new Element(document.body)).hasClass("war_looks_like_published")){var l=null;try{l=Elements.from(n)}catch(j){ta.util.error.record(null,"submitPhotosDescribeSuccessHandler - Invalid AJAX response");return}var a=l.clone();var g=ta.select(".noPhotoYet",h);g.pop();while(g.length>0&&l.length>0){l.shift().replaces(g.shift())}while(l.length>0){h.grab(l.shift(),"top")}if(f&&f.imageAdded){setTimeout(function(){f.imageAdded(a)},1)}}else{var i;if(f.isGetListedRequest){i=ta.id("GETLISTED_PHOTO_UPLOADER")}else{i=document.getElement(".warUploader")}if(!i||!i.innerHTML){ta.util.error.record(null,"submitPhotosDescribeSuccessHandler - no inlineDiv");return}h.addClass("fullUploadSet");h.innerHTML=h.innerHTML+n;var o=h.getElement(".firstOne");if(!o){h.getElement("li").addClass("firstOne")}var d=h.getElements("li");if(d.length>5){h.addClass("maxUploadSet")}else{h.removeClass("maxUploadSet")}ta.media.uploader.updateAddButtonText(false)}var k=ta.id("PPRESULT");if(k){k.show()}}}ta.media.uploader.close()}else{p="photo_only";var c=ta.id("photoUploaderDiv");c.set("html",n);if(ta.id("photosUploadedThanks")){var m=ta.retrieve("ta.media.uploader.photoUploaderTranslations");ta.media.uploader.updateHeaderText(m.flash_uploader_thank_you_10d8)}ta.media.uploader.logStatusErrors()}ta.trackEventOnPage("FlashPhotoUploader","success",p,b,false);var q=document.getElement("#PPBTN");if(q){q.show()}},updateAddButtonText:function(c){var a=document.getElements(".buttonTextDefault");var b=document.getElement(".buttonTextMore");if(a&&b){if(c){a.removeClass("hidden");b.addClass("hidden")}else{a.addClass("hidden");b.removeClass("hidden")}}},updateHeaderText:function(c,a){var b=ta.id("photoUploadHeader");if(b){b.set("text",c);if(a){b.addClass("error")}else{b.removeClass("error")}}},reload:function(){try{var a=ta.retrieve("ta.media.uploader.photoUploaderOverlay");if(a){a.hide();a.loadRemoteContent(ta.media.uploader.getServletUrl()+"?"+ta.media.uploader.getServletParams(ta.retrieve("ta.media.uploader.params"),"SHELL"));a.hide()}else{ta.util.error.record(null,"reload - photoUploaderOverlay does not exist")}}catch(b){ta.util.error.record(b,"flash media uploader reload")}},close:function(){var a=ta.retrieve("ta.media.uploader.photoUploaderOverlay");if(a){a.hide()}else{TA.util.error.record(null,"close - photoUploaderOverlay does not exist")}},removePhoto:function(j,c){var d=ta.retrieve("ta.media.uploader.params");if(d&&d.imageRemoved){d.imageRemoved(c)}var b=c.getParent("li");if(b){b.dispose()}var f=document.getElement(".photoUploadSet");if(f){if((new Element(document.body)).hasClass("war_looks_like_published")){var g=ta.find(".noPhotoYet",f);if(g){g.grab(g.clone(),"after")}}else{var a=f.getElements("li");if(!a||a.length<1){f.removeClass("fullUploadSet");ta.media.uploader.updateAddButtonText(true);var i=document.getElement("#PPBTN");if(i){i.hide();ta.id("PPRESULT").hide();var e=document.getElement(".uploadButtons");if(e){e.removeClass("hidden")}var h=ta.id("PPERROR");if(h){h.dispose()}}}}}},checkCaptionLength:function(a,b){b.onkeyup=ta.media.uploader.checkCapLength.partial(b);b.onpaste=ta.media.uploader.checkCapLength.partial(b);ta.media.uploader.checkCapLength(b)},checkCapLength:function(a){if(a&&a.value.length<101){return}a.value=a.value.substr(0,100)},tipsOverlay:function(b,a){if(b){b.stop()}a.onclick=null;ta.store("tipsOverlay",new ta.overlays.RelativeOverlayBelow({showCloseButton:true,activate:ta.overlays.ACTIVATE_CLICK,style:"s2 dg",innerDivClass:"noPadMarg",isChild:true,onClose:function(){ta.remove("tipsOverlay")}},a))},flashUploadOverlay:function(d,b){var c=ta.retrieve("ta.media.uploader.params");var a=ta.id("PhotoUploadLocation");if(a){if(a.locationId.value==""){if(ta.id("location")&&ta.id("locErrMsg")){ta.id("location").style.color="red";ta.id("locErrMsg").classList.remove("hidden")}}else{c.locationId=a.locationId.value;ta.store("ta.media.uploader.params",c);ta.media.uploader.reload()}}else{c.locationId=1;ta.store("ta.media.uploader.params",c);ta.media.uploader.reload()}},validatePhotoForm:function(q,f){try{var l=ta.id("photoIdList");var p=ta.id("PostPhotosDescribe");var b=true;if(l&&p){var r=l.getElementsByTagName("li");for(var h=0;h<r.length;h++){var d=r[h].innerHTML.replace(/^\s+|\s+$/g,"");var o="cat_"+d;var a=false;for(var g=1;g<=p.elements[o].length;g++){var n="catid_"+d+"_"+g;var k=ta.id(n);if(k&&k.checked){a=true}}var c="catlabel_"+d;if(ta.id(c)){if(a){ta.id(c).style.color="black"}else{ta.id(c).style.color="red";b=false}}}}if(b){ta.media.uploader.signInOverlay(q,f)}else{return false}}catch(m){return false}},signInOverlay:function(d,b){var c=ta.retrieve("ta.media.uploader.params");var a=ta.id("PostPhotosDescribe");if(c.isDetailPage){if(a){a.flowaction.value="THANKS";ta.media.uploader.postSignIn()}}else{if(ta.media.uploader.isWARUploader()||c.isOwner||c.isGetListedRequest){if(a){a.flowaction.value="PROCESSONLY";ta.media.uploader.postSignIn()}}else{ta.run("ta.overlays.registration.connect",null,{flow:"PHOTO_UPLOAD",completeCallback:ta.media.uploader.signInOnCloseHandler,customOverlayOptions:{isChild:true,onShow:ta.media.uploader.signInOnShowHandler}},"SIGNIN")}}},signInOnShowHandler:function(){var a=ta.retrieve("ta.media.uploader.photoUploaderOverlay");if(a){a.disableBackdrop()}},signInOnCloseHandler:function(){var a=ta.retrieve("ta.media.uploader.photoUploaderOverlay");if(a){a.enableBackdrop()}},postSignIn:function(){ta.media.uploader.submitPhotosDescribeAjax("PostPhotosDescribe")},descriptionOnFocus:function(c,a){var b=ta.retrieve("ta.media.uploader.photoUploaderTranslations");labelStr="*"+b.flash_uploader_description_label_10d8;if(a.value==labelStr){a.value="";a.style.color="black"}},descriptionOnBlur:function(c,a){var b=ta.retrieve("ta.media.uploader.photoUploaderTranslations");labelStr="*"+b.flash_uploader_description_label_10d8;if(a.value.trim().length==0){a.value=labelStr;a.style.color="gray"}},locationOnFocus:function(b,a){if(a.value==a.defaultValue||a.style.color=="red"){a.value="";a.style.color="black"}},locationOnBlur:function(b,a){if(a.value==""){a.value=a.defaultValue;a.style.color="gray"}},isWARUploader:function(){if(!ta.has("ta.media.uploader.isWARUploader")){ta.store("ta.media.uploader.isWARUploader",(document.getElement(".warUploader")?true:false))}return ta.retrieve("ta.media.uploader.isWARUploader")},WMODE:"opaque",NEW_IE_WMODE:"window",getWMode:function(){return(Browser.ie&&Browser.version>8)?ta.media.uploader.NEW_IE_WMODE:ta.media.uploader.WMODE},startTimeout:function(){params=ta.retrieve("ta.media.uploader.params");var a={name:"uploader.js",message:"Photo Uploader Flash timeout for location "+params.detailId};ta.util.error.record(a,"flash media uploader startTimeout",null,null,"WARN");params.noFlash=true;ta.media.uploader.close();ta.media.uploader.start(null,null,params)},createPhotoUploaderFlashObj:function(b){try{var j=ta.retrieve("ta.media.uploader.photoUploaderTranslations");var d=ta.retrieve("ta.media.uploader.locationFullAddr");var a=j.flash_uploader_remove_all_10d8;var c=j.flash_uploader_or_10d8;if(ta.media.uploader.isWARUploader()){a="";c=""}if(!MEDIA_HTTP_BASE){MEDIA_HTTP_BASE="http://media-cdn.tripadvisor.com/media/"}if(ta.has("isDaoDao")&&MEDIA_HTTP_BASE.indexOf("media/")==-1){MEDIA_HTTP_BASE+="media/"}var k=ta.retrieve("war_html_photo_uploader");var i={id:"photoUploaderFlash",type:k?"html|flash":"flash",width:k?"798px":"800px",height:"453px",enableAutoRotation:true,locale:b.locale,flashControl:{codeBase:MEDIA_HTTP_BASE+"thirdpartyflash/photoupload/aurigma.imageuploaderflash_8.0.59.swf",themeUrl:MEDIA_HTTP_BASE+"thirdpartyflash/photoupload/AurigmaThemeTA_v2.0.1.swf",bgColor:"#F3F3F3",wmode:ta.media.uploader.getWMode()},converters:[{mode:"*.*=Thumbnail",thumbnailWidth:2000,thumbnailHeight:1500,thumbnailCopyExif:true,thumbnailCopyIptc:true,thumbnailFitMode:"Fit",thumbnailJpegQuality:100}],events:{initComplete:[ta.media.uploader.initCompleteEventHandler],beforePackageUpload:[ta.media.uploader.beforePkgUploadEventHandler],afterPackageUpload:[ta.media.uploader.afterPkgUploadEventHandler],afterUpload:[ta.media.uploader.afterUploadEventHandler],restrictionFailed:[ta.media.uploader.restrictionFailedEventHandler],error:[ta.media.uploader.errorEventHandler]},uploadSettings:{actionUrl:ta.media.uploader.getServletUrl()},restrictions:{fileMask:[["Images (*.jpg; *.jpeg; *.png; *.gif)","*.jpg;*.jpeg;*.png;*.gif"]],maxFileCount:50,maxTotalFileSize:100000000,minImageWidth:150,minImageHeight:150},metadata:{additionalFormName:"postPhotosFlashForm",exif:"ExifGpsLatitude;ExifGpsLatitudeRef;ExifGpsLongitude;ExifGpsLongitudeRef"},uploadPane:{viewMode:"Tiles",addFilesButtonText:j.flash_uploader_add_files_button_10d8},topPane:{titleText:d,addFilesHyperlinkText:j.flash_uploader_add_files_10d8,clearAllHyperlinkText:a,orText:c,showViewComboBox:false,viewComboBox:[j.flash_uploader_combo_box_tiles_10d8,j.flash_uploader_combo_box_thumbnails_10d8,j.flash_uploader_combo_box_icons_10d8],viewComboBoxText:j.flash_uploader_combo_box_text_10d8},paneItem:{toolbarAlwaysVisible:true,enableDisproportionalExifThumbnails:false,descriptionEditorIconTooltip:j.flash_uploader_tip_description_10d8,imageTooltip:j.flash_uploader_tip_image_10d8,itemTooltip:j.flash_uploader_tip_item_10d8,removalIconTooltip:j.flash_uploader_tip_remove_10d8,rotationIconTooltip:j.flash_uploader_tip_rotate_10d8},addFilesProgressDialog:{text:j.flash_uploader_progress_dialog_10d8},commonDialog:{cancelButtonText:j.flash_uploader_cancel_10d8,okButtonText:j.flash_uploader_ok_10d8},descriptionEditor:{cancelButtonText:j.flash_uploader_cancel_10d8,saveButtonText:j.flash_uploader_save_10d8},imagePreviewWindow:{closePreviewTooltip:j.flash_uploader_tip_close_10d8},statusPane:{dataUploadedText:j.flash_uploader_status_data_uploaded_10d8,filesPreparedText:j.flash_uploader_status_files_prepared_10d8,filesToUploadText:j.flash_uploader_status_files_to_upload_10d8,filesUploadedText:j.flash_uploader_status_files_uploaded_10d8,noFilesToUploadText:j.flash_uploader_status_no_files_to_upload_10d8,preparingText:j.flash_uploader_status_preparing_10d8,sendingText:j.flash_uploader_status_uploading_10d8},cancelUploadButtonText:j.flash_uploader_cancel_10d8,uploadButtonText:j.flash_uploader_upload_button_10d8,uploadErrorDialog:{hideDetailsButtonText:j.flash_uploader_hide_button_10d8,showDetailsButtonText:j.flash_uploader_details_button_10d8,title:j.flash_uploader_upload_error_10d8,message:j.flash_uploader_upload_msg_24c},messages:{cannotReadFile:j.flash_uploader_msg_cannot_read_file_10d8,dimensionsTooLarge:j.flash_uploader_msg_dimensions_too_large_10d8,dimensionsTooSmall:j.flash_uploader_msg_dimensions_too_small_10d8,fileSizeTooSmall:j.flash_uploader_msg_file_size_too_small_10d8,filesNotAdded:j.flash_uploader_msg_files_not_added_10d8,maxFileCountExceeded:j.flash_uploader_msg_max_file_count_exceeded_10d8,maxFileSizeExceeded:j.flash_uploader_msg_max_file_size_exceeded_10d8,maxTotalFileSizeExceeded:j.flash_uploader_msg_max_total_file_size_exceeded_10d8,memoryLimitReached:j.flash_uploader_msg_memory_limit_reached_10d8,previewNotAvailable:j.flash_uploader_msg_preview_not_available_10d8,tooFewFiles:j.flash_uploader_msg_too_few_files_10d8,tooManyFilesSelectedToOpen:j.flash_uploader_msg_too_many_files_selected_10d8},enableDescriptionEditor:false};var f=Aurigma.ImageUploaderFlash.imageUploaderFlash(i);var h=setTimeout(function(){ta.media.uploader.startTimeout()},30000);ta.store("ta.media.uploader.flashUploaderTimeout",h);f.metadata().addCustomField("flowaction","POSTPHOTOS",false);f.metadata().addCustomField("geo",b.locationId,false);if(b.detailId!="0"){f.metadata().addCustomField("detail",b.detailId,false)}if(b.isOwner){f.metadata().addCustomField("isOwner",true,false)}if(b.isGetListedRequest){f.metadata().addCustomField("isGetListedRequest",true,false)}if(b.isTourismServlet){f.metadata().addCustomField("isTourismServlet",true,false)}if(b.isPhotoWall){f.metadata().addCustomField("isPhotoWall",true,false)}if(b.isDetailPage){f.metadata().addCustomField("isDetailPage",true,false)}if(b.backendPreviewGeneration){f.metadata().addCustomField("backendPreviewGeneration",true,false)}ta.store("ta.media.uploader.aurigmaFlashObj",f)}catch(g){ta.util.error.record(g,"createPhotoUploaderFlashObj")}},insertPhotoUploader:function(b){try{var a=ta.retrieve("ta.media.uploader.aurigmaFlashObj");if(a){var d=ta.id(b);if(d){d.set("html",a.getHtml())}}}catch(c){ta.util.error.record(c,"insertPhotoUploader")}},initCompleteEventHandler:function(){var a=ta.retrieve("ta.media.uploader.flashUploaderTimeout");var b=ta.retrieve("war_html_photo_uploader");clearTimeout(a);ta.id("photoUploaderSpinnerDiv").style.display="none";if(!b){ta.id("photoUploaderDiv").addEvent("mousedown",ta.media.uploader.flashObjOnMouseDownHandler);ta.media.uploader.showOllie.delay(750,this)}},showOllie:function(){if(ta.media.uploader.getWMode()==ta.media.uploader.NEW_IE_WMODE){return}var a=ta.id("photoUploaderOllieDiv");if(a){a.setStyle("opacity",0);a.setStyle("display","inline");a.tween("opacity",1)}},flashObjOnMouseDownHandler:function(){var a=ta.id("photoUploaderOllieDiv");if(a){a.tween("opacity",0);a.dispose()}ta.id("photoUploaderDiv").removeEvent("mousedown",ta.media.uploader.flashObjOnMouseDownHandler)},beforePkgUploadEventHandler:function(b){var a=ta.retrieve("ta.media.uploader.aurigmaFlashObj");if(a){if(a.files().count()==1){a.metadata().addCustomField("flowaction","DESCRIBE",false)}}},afterPkgUploadEventHandler:function(b,h){try{var a=ta.retrieve("ta.media.uploader.aurigmaFlashObj");if(a.files().count()>1){var f=ta.id("photoUploaderHiddenRenderer");f.set("html",h);var c=ta.id("photoUploadStatusForm");if(c&&a){for(var d=0;d<c.elements.length;++d){a.metadata().addCustomField(c.elements[d].name,c.elements[d].value,false)}}ta.media.uploader.logStatusErrors();f.set("html","")}}catch(g){ta.util.error.record(g,"afterPkgUploadEventHandler")}},afterUploadEventHandler:function(f){try{var b=ta.retrieve("ta.media.uploader.photoUploaderTranslations");var a=ta.id("photoUploadTipsLink");if(a){a.style.display="none"}ta.id("photoUploaderDiv").set("html",f);var d=ta.id("unableToUploadErrorMsg");if(!d){ta.media.uploader.updateHeaderText(b.flash_uploader_describe_10d8);ta.id("photorelease").focus()}else{ta.media.uploader.updateHeaderText(d.get("text"),true)}ta.media.previews.requestPreviews();ta.media.uploader.logStatusErrors()}catch(c){ta.util.error.record(c,"afterUploadEventHandler")}},logStatusErrors:function(){var a=ta.id("statusErrorMsgs");if(a){ta.util.error.record(null,"flash media uploader logStatusErrors",null,{statusError:"Error(s) occurred saving an image: "+a.get("text")},"INFO")}},errorEventHandler:function(d,a,e,c){var b="INFO";if(d==4||d==0){b="ERROR"}ta.util.error.record(null,"flash media uploader errorEventHandler - error code "+d,null,{additionalInfo:c,httpResponseCode:a,errorPage:e},b)},restrictionFailedEventHandler:function(b,c,a){ta.util.error.record(null,"flash media uploader restrictionFailedEventHandler - error code "+b,null,{message:a,fileName:c},"INFO")},getServletParams:function(b,a){return Object.toQueryString({flowaction:a,detail:b.detailId,geo:b.locationId,pid:b.oldPhotoUploadPID,isOwner:!!b.isOwner,isGetListedRequest:!!b.isGetListedRequest,isTourismServlet:!!ta.retrieve("photoUploadTourism"),isPhotoWall:!!b.isPhotoWall,backendPreviewGeneration:!!b.backendPreviewGeneration,isDetailPage:!!b.isDetailPage})},getServletUrl:function(){return"/PhotoUpload";return"/PhotoUploadTool-a_mid.837458"},promptForLoginAndOpen:function(b,c,f,e,a){ta.media.uploader.loadAssetsAndOpenPhotoUploader=function(){delete ta.media.uploader.loadAssetsAndOpenPhotoUploader;var h=false;var g=false;if(e){Asset.css(e,{onload:function(){h=true;if(g){ta.media.uploader.show(b,c,f)}}})}else{h=true}if(a){Asset.javascript(a,{onload:function(){g=true;if(h){ta.media.uploader.show(b,c,f)}}})}else{g=true}if(g&&h){ta.media.uploader.show(b,c,f)}};var d=ta.registration.register({product:"ADD_PHOTO",popup:true,successAction:"ta.media.uploader.loadAssetsAndOpenPhotoUploader"});if(d){ta.media.uploader.loadAssetsAndOpenPhotoUploader()}}};(function(j,f){var g=(j.Aurigma||(j.Aurigma={__namespace:true}))&&(j.Aurigma.ImageUploaderFlash||(j.Aurigma.ImageUploaderFlash={__namespace:true}));var k=g;var l={_cache:{},_uid:0,put:function(v){if(typeof v!="undefined"){var w=v.id();if(!w){w="_obj"+(++this._uid);v.id(w)}v._cacheId=w;this._cache[w]=v}},get:function(y){var x=this._cache;if(x[y]){return x[y]}else{for(var w=0,v=x.length;w<v;w++){if(x[w]&&x[w].id()===y){return x[w]}}return null}}},i=function(v){g.debug().showInfo(v)},e=function(v){g.debug().showError(v)},n=function(x){if(x&&typeof x.replace==="function"){var w=[['"',"&#34;"],["'","&#39;"],["&","&#38;"],["<","&#60;"],[">","&#62;"]];var v=/\"|\'|&|<|>/g;return x.replace(v,function(A){for(var z=0,y=w.length;z<y;z++){if(A==w[z][0]){return w[z][1]}}return A})}else{return x}},d=j.getCurrentUrl=function(){return document.location.href},b=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(y){var x=Math.random()*16|0,w=y=="x"?x:(x&3|8);return w.toString(16)})},t=[],q=function(w,v){return t[w.id()+"_"+v]||(t[w.id()+"_"+v]="__"+v+"_"+b().replace(/-/g,""))},r=function(x){var z=[],w,v,y;if(this._simpleProperties&&this._simpleProperties.length>0){for(w=0,v=this._simpleProperties.length;w<v;w++){if(this._simpleProperties.hasOwnProperty(w)&&!this._simpleProperties[w].isAttribute||x==="html"){y=this[this._simpleProperties[w].name]()+"";if(y!="null"&&y!="undefined"){z.push({name:this._simpleProperties[w].render||this._simpleProperties[w].name,value:y})}}}}if(this._objectProperties&&this._objectProperties.length>0){for(w=0,v=this._objectProperties.length;w<v;w++){y=this[this._objectProperties[w].name]();if(typeof y.getParams==="function"){z=z.concat(y.getParams())}}}return z},s=function(y,x,v){var w,z,A;if(typeof y!=="object"&&Object.prototype.toString.call(y)!=="[object Function]"){y={}}if(x!=null){for(w in x){z=y[w];A=x[w];if(y===A){continue}if(v&&(typeof A==="object")){if(!z){if(Object.prototype.toString.call(A)==="[object Array]"){z=[]}else{z={}}}y[w]=s(z,A,v)}else{if(A!==f){y[w]=A}}}}return y};var u=g.browser=new (function(){var v=navigator.userAgent.toLowerCase();this.isOpera=(v.indexOf("opera")>-1);this.isKonq=(v.indexOf("konqueror")>-1);this.isChrome=(v.indexOf("chrome")>-1);this.isSafari=(v.indexOf("safari")>-1)&&!this.isChrome;this.isKhtml=this.isSafari||this.isKonq||this.isChrome;this.isIE=(v.indexOf("msie")!=-1)&&!this.isOpera;this.isIE6XPSP2=this.isIE&&(v.indexOf("sv1")>-1);this.isIE7=this.isIE&&(v.indexOf("msie 7.0")>-1);this.isIE8=this.isIE&&(v.indexOf("msie 8.0")>-1);this.isBeforeIE6XPSP2=this.isIE&&!this.isIE6XPSP2&&!this.isIE7&&!this.isIE8;this.isWinIE=this.isIE&&(v.indexOf("mac")==-1);this.isIE64=this.isIE&&(v.indexOf("win64")>-1);this.isFF=(v.indexOf("firefox")>-1);this.isWindowsOS=(navigator.platform.indexOf("Win")>-1);this.isMobile=v.indexOf("iphone")>-1||v.indexOf("ipad")>-1||v.indexOf("android")>-1;this.isHtmlUploaderSupported=function(){return g.Control&&g.Control.isHtmlUploaderSupported()};this.isThumbnailConverterSupported=function(){return g.Control&&g.Control.isThumbnailCreationSupported()};this.isImageRestrictionsSupported=function(){return g.Control&&g.Control.isImageRestrictionsSupported()}})();var a={createSimpleProperty:function(x,v){if(typeof v.name==="string"){var w="_"+v.name;x[w]=v.defaultValue;x[v.name]=function(){if(arguments.length>0){this[w]=arguments[0]}else{return this[w]}}}},createObjectProperty:function(z,w,y){var A=new w.type();var x="_"+w.name;z[x]=A;if(typeof w.type.init==="function"){w.type.init(A,y)}else{var v="Can not create property '"+w.name+"'. 'init' method is not a function.";e(v);throw v}z[w.name]=function(){if(arguments.length>0){var B=arguments[0];for(var C in B){if(typeof this[x][C]==="function"){this[x][C](B[C])}else{e("Control have not "+C+" propery")}}}else{return this[x]}}},createControlProperty:function(z,G){if(typeof G.name==="string"&&!G.renderOnly){try{var F="_"+G.name,v=z[F],C=z._uploader,D=C.type(),A=C.getControl();var E=G.getter,y=G.setter;var B=G.render||G.name;B=B.charAt(0).toUpperCase()+B.substring(1);if(E===1){E="get"+B}if(y===1){y="set"+B}if(D==="html"){if(E&&A[E]==null){i('"'+E+'" is undefined.')}if(E&&A[y]==null){i('"'+y+'" is undefined.')}z[G.name]=function(){if(arguments.length>0){return A[y](arguments[0])}else{return A[E](B)}}}else{if(D==="flash"){z[G.name]=function(){if(arguments.length>0){return A.callFlash(y,arguments[0])}else{return A.callFlash(E)}}}else{throw new Error("Not supported: "+D)}}if(v!==f&&y){z[G.name](v)}}catch(x){var w="Can't create property '"+G.name+"'.\r\n";if(typeof x==="string"){x=w+x}else{x.message=w+(x.message||x.description||x)}throw x}}},createAttributeProperty:function(y,v){var x=y._uploader;if(x.type()==="html"){a.createControlProperty(y,v)}else{if(x.type()==="flash"){var w=x.getControl();y[v.name]=function(){if(arguments.length>0){return w[v.name]=arguments[0]}else{return w[v.name]}}}}},createMethod:function(z,A){var y=z._uploader,w=y.type(),x=y.getControl();var v=A.controlMethodName||A.name;if(w==="html"){z[A.name]=function(){return x[v].apply(x,arguments)}}else{if(w==="flash"){z[A.name]=function(){var B=arguments;switch(B.length){case 0:return x.callFlash(v);case 1:return x.callFlash(v,B[0]);case 2:return x.callFlash(v,B[0],B[1]);case 3:return x.callFlash(v,B[0],B[1],B[2]);case 4:return x.callFlash(v,B[0],B[1],B[2],B[3]);case 5:return x.callFlash(v,B[0],B[1],B[2],B[3],B[4])}}}else{throw new Error("Not supported: "+w)}}},_typicalInit:function(y,x){y._uploader=x;if(y._simpleProperties){for(var w=0,v=y._simpleProperties.length;w<v;w++){if(y._simpleProperties.hasOwnProperty(w)){a.createSimpleProperty(y,y._simpleProperties[w])}}}if(y._objectProperties){for(var w=0,v=y._objectProperties.length;w<v;w++){if(y._objectProperties.hasOwnProperty(w)){a.createObjectProperty(y,y._objectProperties[w],x)}}}},_typicalReinit:function(y){if(y._simpleProperties){for(var w=0,v=y._simpleProperties.length;w<v;w++){if(y._simpleProperties.hasOwnProperty(w)){var x=y._simpleProperties[w];if(!x.isAttribute){a.createControlProperty(y,x)}}}}if(y._objectProperties){for(var w=0,v=y._objectProperties.length;w<v;w++){if(y._objectProperties.hasOwnProperty(w)){var x=y._objectProperties[w];if(x.type&&typeof x.type.reinit==="function"){x.type.reinit(y[x.name]())}}}}if(y._methods&&y._methods.length>0){for(var w=0,v=y._methods.length;w<v;w++){a.createMethod(y,y._methods[w])}}}};g.flashDetector={detectVersion:function(){var B=null,x=navigator.plugins,w;if(x&&typeof((w=x["Shockwave Flash 2.0"]||x["Shockwave Flash"]))!=="undefined"){var D=w.description;var y=/^.+\s+(\d+).(\d+)\s+\w(\d+)$/.exec(D);var v=parseInt(y[1],10)||0;var E=parseInt(y[2],10)||0;var F=parseInt(y[3],10)||0;B=[v,E,F]}else{if(j.ActiveXObject){try{var z=new ActiveXObject("ShockwaveFlash.ShockwaveFlash.7")}catch(A){try{z=new ActiveXObject("ShockwaveFlash.ShockwaveFlash.6");B=[6,0,21];z.AllowScriptAccess="always"}catch(A){}}if(z){try{var C=z.GetVariable("$version");y=/^\S+\s+(\d+),(\d+),(\d+)(,\d+)?$/.exec(C);v=parseInt(y[1],10)||0;E=parseInt(y[2],10)||0;F=parseInt(y[3],10)||0;B=[v,E,F]}catch(A){}}}}if(!B){B=[-1,-1,-1]}return B}};g.debug=function(){if(!g.debug._instance){var v=function(){this.constructor=g.debug};v.prototype=g.debug.prototype;g.debug._instance=new v()}return g.debug._instance};g.debug.prototype={__class:true,_level:0,_mode:["popup","console","alert"],version:function(){return g.Control.Uploader.prototype.getVersion()},buildDate:function(){return g.Control.Uploader.prototype.getBuildDate()},mode:function(x){if(arguments.length>0){var w=arguments[0];if(w instanceof Array){this._mode=arguments[0]}else{this._mode=[arguments[0]]}}else{return this._mode}},level:function(v){if(arguments.length>0){this._level=arguments[0]}else{return this._level}},showError:function(v){this.showMessage(v,1)},_showUploaderMessage:function(v){this.showMessage(v,2)},showInfo:function(v){this.showMessage(v,3)},showMessage:function(x,v){if(v>this._level){return}for(var A=0,z=this._mode.length;A<z;A++){switch(this._mode[A]){case"console":if(typeof j.console!="undefined"&&console.log){console.log(x);return}break;case"popup":if(!this._popupWindow||this._popupWindow.closed){this._popupWindow=j.open("","UploadSuiteDebugWindow","width=300,height=200,menubar=1,status=1,scrollbars=1,resizable=1");if(!this._popupWindow){break}var C=this._popupWindow.document.getElementsByTagName("ol");if(!C||C.length==0){var B=[];B.push('<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">\n');B.push('<html xmlns="http://www.w3.org/1999/xhtml">\n');B.push("<head>");B.push("<title>Aurigma Upload Suite Log Window</title>");B.push('<style type="text/css">* { margin:0; padding: 0; font-family: "Lucida Console", Monaco, monospace; } li { border-bottom:1px solid #aaa; padding: 10px; } li:nth-child(odd) { background-color: #fafafa; }</style>');B.push("</head>");B.push("<body>");B.push('<input type="button" value="Clear" onclick=\'document.getElementsByTagName("ol")[0].innerHTML = "";\' />');B.push("<ol>");B.push("</ol>");B.push('<input type="button" value="Clear" onclick=\'document.getElementsByTagName("ol")[0].innerHTML = "";\' />');B.push("</body>");B.push("</html>");this._popupWindow.document.write(B.join(""))}}var w=this._popupWindow.document.createElement("li"),y=this._popupWindow.document.createElement("pre"),D=this._popupWindow.document.createTextNode(x);y.appendChild(D);w.appendChild(y);this._popupWindow.document.getElementsByTagName("ol")[0].appendChild(w);return;case"alert":alert(x);return}}}};var m=(function(){function w(x){var z=x.name,H=x.type,I=x.tagName.toLowerCase();if(!z||x.disabled||H=="reset"||H=="button"||H=="file"||H=="submit"||H=="image"||(H=="checkbox"||H=="radio")&&!x.checked||I=="select"&&x.selectedIndex==-1){return null}if(I=="select"){var D=x.selectedIndex;if(D<0){return null}var F=[],y=x.options;var B=(H=="select-one");var E=(B?D+1:y.length);for(var A=(B?D:0);A<E;A++){var C=y[A];if(C.selected){var G=C.value;if(!G){G=(C.attributes&&C.attributes.value&&!(C.attributes.value.specified))?C.text:C.value}if(B){return G}F.push(G)}}return F}return x.value}function v(y){var F=[];var D=y.elements;if(!D){return F}for(var E=0,B=D.length;E<B;E++){var z=D[E];var A=z.name;if(!A){continue}var G=w(z);if(G&&G.constructor==Array){for(var C=0,x=G.length;C<x;C++){F.push({name:A,value:G[C],array:true,first:(C===0)})}}else{if(G!==null&&typeof G!="undefined"){F.push({name:A,value:G})}}}return F}return{formToArray:v}})();function h(){this._simpleProperties=[{name:"id",getter:1,setter:1,isAttribute:true}]}h.prototype={__class:true,type:function(){function w(D){var F=(D+"").split("|");for(var E=0,B=F.length-1;E<B;E++){var G=F[E].toLowerCase();if(G==="html"){if(u.isHtmlUploaderSupported()){var y=true;if(y&&!u.isImageRestrictionsSupported()){var z=this.restrictions();y=!(z.minImageWidth()>0||z.minImageHeight()>0||z.maxImageWidth()>0||z.maxImageHeight()>0)}if(y&&!u.isThumbnailConverterSupported()){var H=this.converters();for(var C=0,x=H.count();C<x;C++){var A=H.get(C);if(A&&/=thumbnail/i.test(A.mode())){y=false;break}}}if(y){return G}}}else{if(G==="flash"){if(this.flashControl().isFlashSupported()){return G}}}}return F[F.length-1]}if(arguments.length>0){this._platform=w.call(this,arguments[0])}else{if(!this._platform){var v="html|flash";this._platform=w.call(this,v)}return this._platform}},state:function(){if(arguments.length>0){this._state=arguments[0]}else{return this._state}},set:function(w){for(var v in w){if(typeof this[v]==="function"){this[v](w[v])}else{e("Uploader haven't "+v+" property.")}}},render:function(E){var G=this,w=this.id(),F=this.events();var D=function(I,H){return function(Q){var N=true;if(I._handlers&&I._handlers.length>0){var K;switch(H){case"restrictionFailed":K=[Q.code];break;case"beforePackageUpload":K=[Q.index];break;case"afterPackageUpload":K=[Q.index,Q.response];break;case"afterUpload":K=[Q.response];break;case"error":K=[Q.errorCode,Q.httpStatus,Q.response,Q.additionalInfo];break;case"progress":K=[Q.percent,Q.uploadedFiles,Q.totalFiles,Q.uploadedBytes,Q.totalBytes];break;case"trace":K=[Q.log];break;case"uploadFileCountChange":K=[Q.cause];break;case"selectionChange":K=[Q.select];break;case"ImageEditorClose":K=[Q.index,Q.result,Q.guid];break}for(var M=0,L=I._handlers.length;M<L;M++){try{var O=I._handlers[M];var J;if(typeof O==="function"){J=O.apply(G,K)}else{if(typeof j[O]==="function"){J=j[O].apply(G,K)}else{e(H+' error:\n "'+O+'" handler is not defined.')}}if(H==="beforeUpload"||H==="afterPackageUpload"){if(!N){J=N}else{if(J!==f){N=(J===false||J===0?false:true)}}}}catch(P){e(H+" error:\n"+(P.message||P.description||P));throw P}}}return J}};if(F.preRender().count()>0){(D(F.preRender(),"preRender"))()}if(g.debug().level()>=2&&F.trace){F.trace().add(function(H){g.debug()._showUploaderMessage(H)})}var C=this.getParams();var x={};for(var A=0,y=C.length;A<y;++A){var B=C[A].name;if(/listener$/.test(B)){continue}B=B.substring(0,1).toUpperCase()+B.substring(1);x[B]=C[A].value}var z=this._htmlUploaderControl=new g.Control.Uploader(x);for(var A in F){if(A!="getParams"&&A!="preRender"){var v=F[A];if(typeof v==="function"&&v() instanceof g.event&&v().count()>0){z.addEventListener(A,D(v(),A))}}}z.render(E)},writeHtml:function(v){var w=this.type();if(w==="html"){var y;if(!v){y="au_uploader_placeholder"+((Math.random()*1000000)|0);document.write('<div style="display: none;" id="'+y+'"></div>')}this.render(v);if(y){y=document.getElementById(y);var x=document.getElementById(this.id());y.parentNode.replaceChild(x,y)}}else{if(w==="flash"){j.document.write(this._getFlashHtml())}else{throw new Error("Not supported: "+w)}}},getHtml:function(){var v=this.type();if(v==="html"){return this._getHtmlHtml()}else{if(v==="flash"){return this._getFlashHtml()}else{throw new Error("Not supported: "+v)}}},_getFlashHtml:function(){if(!this.flashControl().isFlashSupported()&&u.isMobile){var A=[];var C=this.width();C=/^\d+$/.test(C)?C+"px":C;var z=this.height();z=/^\d+$/.test(z)?z+"px":z;A.push('<div style="position: relative; z-index: 1000; background-color: #f7f7f7; overflow: hidden; width: '+C+"; height: "+z+'">');A.push('<div style="text-align:center; margin-top: 10px;"> Browser is not supported. </div>');A.push("</div>");return A.join("")}var E=this,x=this.id(),D=this.events();var B=function(F,w){return function(){var J=true;if(F._handlers&&F._handlers.length>0){for(var I=0,H=F._handlers.length;I<H;I++){try{var K=F._handlers[I];var G;if(typeof K==="function"){G=K.apply(E,arguments)}else{if(typeof j[K]==="function"){G=j[K].apply(E,arguments)}else{e(w+' error:\n "'+K+'" handler is not defined.')}}if(w==="beforeUpload"||w==="afterPackageUpload"){if(!J){G=J}else{if(G!==f){J=(G===false||G===0?false:true)}}}}catch(L){e(w+" error:\n"+(L.message||L.description||L));throw L}}}return G}};if(D.preRender().count()>0){(B(D.preRender(),"preRender"))()}if(g.debug().level()>=2&&D.trace){D.trace().add(function(w){g.debug()._showUploaderMessage(w)})}for(var y in D){if(y!="getParams"&&y!="preRender"){var v=D[y];if(typeof v==="function"&&v() instanceof g.event&&v().count()>0){j[q(this,y)]=B(v(),y)}}}return c(this).html()},_getHtmlHtml:function(){var v=this;var x=(Math.random()*100000)|0;var z="__"+v.id()+"_initElement"+x;var w=("__"+v.id()+"_initFunction"+x).replace(/\W+/g,"");var y=false;j[w]=function(){if(y){return}y=true;setTimeout(function(){var B=document.getElementById(z);if(!B){return}v.render(B);var A=B.parentNode;while(B.hasChildNodes()){A.insertBefore(B.firstChild,B)}A.removeChild(B.nextSibling);A.removeChild(B);delete j[w]},0)};return'<div id="'+z+'"></div><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onload="'+w+'();" />'},getElement:function(){return this.getControl()},getControl:function(){var v=this.type();if(v==="html"){return this._htmlUploaderControl}else{if(v==="flash"){return j.document.getElementById(this.id())}}},getParams:function(){var v=r.call(this,this.type());v.push({name:"debugMode",value:(g.debug().level()>=2)});v.push({name:"traceToJS",value:true});return v},registerCallback:function(v,x,w){this._clbs=this._clbs||{};this._clbs[v]=this._clbs[v]||[];this._clbs[v].push({func:x,ctx:w})},_invokeCallback:function(x,w){if(!this._clbs||!this._clbs[x]){return}var v=this._clbs[x];for(var z=0,y=v.length;z<y;z++){var A=v[z];A.func.apply(A.ctx,w)}},id:function(v){}};function p(v){this._eventNames=["initComplete","preRender"]}p.prototype={__class:true,initComplete:function(){},preRender:function(){},getParams:function(){var z=[];for(var y=0,x=this._eventNames.length;y<x;y++){var w=this._eventNames[y],v=this[w];if(typeof v==="function"&&v().count()>0){z.push({name:w.toLowerCase()+"listener",value:q(this._uploader,w)})}}return z}};p.init=function(A,z){A._uploader=z;var x=A._eventNames;var y=function(){var B=new g.event();return function(){if(arguments.length>0){B.add(arguments[0])}return B}};for(var w=0,v=x.length;w<v;w++){A[x[w]]=y()}};p.prototype.constructor=p;g.commonDialog=function(){};g.commonDialog.prototype={__class:true,_simpleProperties:[{name:"cancelButtonText",getter:1,setter:1,render:"CommonDialogCancelButtonText"},{name:"okButtonText",getter:1,setter:1,render:"CommonDialogOkButtonText"}],getParams:r,cancelButtonText:function(v){},okButtonText:function(v){}};g.commonDialog.init=a._typicalInit;g.commonDialog.reinit=a._typicalReinit;g.converter=function(v){if(g.converter.init){g.converter.init()}this.mode("*.*=SourceFile");if(v){this.set(v)}};g.converter.init=function(){var x=g.converter.prototype;if(x._simpleProperties){for(var w=0,v=x._simpleProperties.length;w<v;w++){if(x._simpleProperties.hasOwnProperty(w)){var y=x._simpleProperties[w];a.createSimpleProperty(x,y)}}}delete g.converter.init};g.converter.prototype={__class:true,_simpleProperties:[{name:"thumbnailBgColor",getter:1,setter:1,render:"ConverterThumbnailBgColor"},{name:"thumbnailCopyExif",getter:1,setter:1,render:"ConverterThumbnailCopyExif"},{name:"thumbnailCopyIptc",getter:1,setter:1,render:"ConverterThumbnailCopyIptc"},{name:"thumbnailFitMode",getter:1,setter:1,render:"ConverterThumbnailFitMode"},{name:"thumbnailHeight",getter:1,setter:1,render:"ConverterThumbnailHeight"},{name:"thumbnailJpegQuality",getter:1,setter:1,render:"ConverterThumbnailJpegQuality"},{name:"thumbnailWatermark",getter:1,setter:1,render:"ConverterThumbnailWatermark"},{name:"thumbnailWidth",getter:1,setter:1,render:"ConverterThumbnailWidth"},{name:"thumbnailApplyCrop",getter:1,setter:1,render:"ConverterThumbnailApplyCrop"},{name:"thumbnailApplyDrawTool",getter:1,setter:1,render:"ConverterThumbnailApplyDrawTool"},{name:"getThumbnailWatermarkPreview",render:"getConverterThumbnailWatermarkPreview"}],mode:function(){if(arguments.length>0){if(arguments[0]){this._validateMode(arguments[0]);this._mode=arguments[0]}}else{return this._mode}},thumbnailBgColor:function(v){},thumbnailCopyExif:function(v){},thumbnailCopyIptc:function(v){},thumbnailFitMode:function(v){},thumbnailHeight:function(v){},thumbnailJpegQuality:function(v){},thumbnailWidth:function(v){},thumbnailWatermark:function(v){},getThumbnailWatermarkPreview:function(v){},thumbnailApplyCrop:function(v){},thumbnailApplyDrawTool:function(v){},set:function(v){if(v){if(typeof v.toJson=="function"){v=v.toJson()}for(var w in v){if(!v.hasOwnProperty||v.hasOwnProperty(w)){if(typeof this[w]==="function"&&v[w]!=null){this[w](v[w])}}}}},toJson:function(){var y={},x,z;if(this.mode()){y.mode=this.mode()}if(this._simpleProperties){for(var w=0,v=this._simpleProperties.length;w<v;w++){if(this._simpleProperties.hasOwnProperty(w)){z=this._simpleProperties[w];x=this[z.name]();if(x!=null){y[z.name]=x}}}}return y},_validateMode:function(w){var v=/^((.*=)?(SourceFile|Thumbnail|Icon|None|Zip);)*(.*=)?(SourceFile|Thumbnail|Icon|None|Zip);?$/i;if(v.test(w)){return true}else{e("Converter mode string is not valid.\n"+w);return false}}};g.converter.prototype.constructor=g.converter;g.converter.reinit=function(y,A,x){if(x==="html"){y.mode=function(){if(arguments.length>0){if(arguments[0]){this._validateMode(arguments[0]);A.setConverterMode(this._index,arguments[0])}}else{return A.getConverterMode(this._index)}};if(y._simpleProperties){for(var w=0,v=y._simpleProperties.length;w<v;w++){var z=y._simpleProperties[w];if(y._simpleProperties.hasOwnProperty(w)&&!z.isAttribute){(function(C){var B=C.getter,E=C.setter;if(B===1||E===1){var D=C.render||C.name;D=D.charAt(0).toUpperCase()+D.substring(1);if(B===1){B="get"+D}if(E===1){E="set"+D}}else{if(!B&&!E){E=B=C.render||C.name}}y[C.name]=function(){if(arguments.length>0){if(arguments[0]!=null){return A[E](this._index,arguments[0])}}else{return A[B](this._index)}}})(z)}}}}else{if(x==="flash"){y.mode=function(){if(arguments.length>0){if(arguments[0]){this._validateMode(arguments[0]);A.callFlash("setConverterMode",this._index,arguments[0])}}else{return A.callFlash("getConverterMode",this._index)}};y.mode.isUploaderProperty=true;if(y._simpleProperties){for(var w=0,v=y._simpleProperties.length;w<v;w++){var z=y._simpleProperties[w];if(y._simpleProperties.hasOwnProperty(w)&&!z.isAttribute){(function(C){var B=C.getter,E=C.setter;if(B===1||E===1){var D=C.render||C.name;D=D.charAt(0).toUpperCase()+D.substring(1);if(B===1){B="get"+D}if(E===1){E="set"+D}}y[C.name]=function(){if(arguments.length>0){if(arguments[0]!=null){return A.callFlash(E,this._index,arguments[0])}}else{return A.callFlash(B,this._index)}};y[C.name].isUploaderProperty=true})(z)}}}}else{throw new Error("Not supported: "+x)}}};g.converters=function(){};g.converters.prototype={__class:true,add:function(){var v;if(arguments[0] instanceof g.converter){v=arguments[0]}else{v=new g.converter(arguments[0])}this._converters.push(v);return v},count:function(){return this._converters.length},get:function(v){return this._converters[v]},remove:function(v){this._converters.splice(v,1)},removeAll:function(){this._converters.length=0;while(this.count()>0){this.remove(0)}}};g.converters.init=function(w,v){w._uploader=v;w._converters=[new g.converter({mode:"*.*=SourceFile"})]};g.converters.reinit=function(D){try{i("Reinit converters.");var A=D._uploader;var C=A.type();var x=A.getControl();var B=[],y,v;for(y=0,v=D._converters.length;y<v;y++){var z=D._converters[y];B.push(z.toJson())}D._items=[];D.get=function(E){if(E<this.count()){if(this._items&&this._items[E]){return this._items[E]}else{this._items=this._items||[];var F=new g.converter();F._index=E;g.converter.reinit(F,x,C);this._items[E]=F;return F}}else{return null}};if(C==="html"){while(x.getConverterCount()>0){x.removeConverter(0)}D.add=function(){var E=x.addConverter("*.*=SourceFile");if(E>=0){if(arguments[0]){var G=this.get(E);try{G.set(arguments[0])}catch(F){j.console.error(F.stack)}return G}}else{e("Converter hasn't been added.");return null}};D.count=function(){return x.getConverterCount()};D.remove=function(E){x.removeConverter(E);this._items.splice(E,1);for(var G=0,F=this._items.length;G<F;G++){this._items[G]._index=G}}}else{if(C==="flash"){while(x.callFlash("getConverterCount")>0){x.callFlash("removeConverter",0)}D.add=function(){var E=x.callFlash("addConverter","*.*=None");if(E>=0){if(arguments[0]){var F=this.get(E);F.set(arguments[0]);return F}}else{e("Converter hasn't been added.");return null}};D.count=function(){return x.callFlash("getConverterCount")};D.remove=function(E){x.callFlash("removeConverter",E);this._items.splice(E,1);for(var G=0,F=this._items.length;G<F;G++){this._items[G]._index=G}}}else{throw new Error("Not supported: "+C)}}for(y=0,v=B.length;y<v;y++){D.add(B[y])}}catch(w){e("Converters initialization failed.\n"+(w.message||w.description||w));throw w}};g.descriptionEditor=function(){};g.descriptionEditor.prototype={__class:true,_simpleProperties:[{name:"cancelButtonText",getter:1,setter:1,render:"DescriptionEditorCancelButtonText"},{name:"saveButtonText",getter:1,setter:1,render:"DescriptionEditorSaveButtonText"}],getParams:r,cancelButtonText:function(v){},saveButtonText:function(v){}};g.descriptionEditor.init=a._typicalInit;g.descriptionEditor.reinit=a._typicalReinit;g.events=function(v){};g.events.prototype=new p();s(g.events.prototype,{_eventNames:[f,f,"beforeUpload","afterUpload","beforePackageUpload","afterPackageUpload","progress","error","restrictionFailed","addingFiles","trace","uploadFileCountChange","selectionChange","ImageEditorClose"],beforeUpload:function(){},afterUpload:function(){},beforePackageUpload:function(){},afterPackageUpload:function(){},progress:function(){},error:function(){},restrictionFailed:function(){},addingFiles:function(){},trace:function(){},uploadFileCountChange:function(){},selectionChange:function(){},ImageEditorClose:function(){},},true);g.events.init=p.init;g.events.prototype.constructor=g.events;g.file=function(v){if(v){this.set(v)}this.constructor=g.file.prototype};g.file.prototype={__class:true,angle:function(v){},description:function(v){},height:function(){},name:function(){},selected:function(v){},size:function(){},width:function(){},remove:function(){},guid:function(){},getPreview:function(){},onUpload:function(){},iconCssClass:function(){},tag:function(){},showImageEditor:function(){},cropBounds:function(){}};g.file.reinit=function(x,w,v){if(v=="html"){w.angle=function(y){if(y||y===0){x.setUploadFileAngle(this._index,y)}else{return x.getUploadFileAngle(this._index)}};w.description=function(y){if(typeof y!=="undefined"){x.setUploadFileDescription(this._index,y)}else{return x.getUploadFileDescription(this._index)}};w.height=function(){return x.getUploadFileHeight(this._index)};w.guid=function(){return x.getUploadFileGuid(this._index)};w.name=function(){return x.getUploadFileName(this._index)};w.size=function(){return x.getUploadFileSize(this._index)};w.width=function(){return x.getUploadFileWidth(this._index)};w.remove=function(){return x.uploadFileRemoveAt(this._index)};w.selected=function(y){if(typeof y=="undefined"){return x.getUploadFileSelectionAt(this._index)}else{x.setUploadFileSelectionAt(this._index,y)}};w.iconCssClass=function(){return x.getUploadFileIconCssClassAt(this._index)};w.getPreview=function(y){return x.getUploadFilePreviewSrcAt(this._index,y.callback.bind(w),y.size)};w.onUpload=function(y){return x.uploadFileOnUpdateAt(this._index,y.bind(w))};w.tag=function(y){if(typeof y=="undefined"){return x.getUploadFileTagAt(this._index)}else{x.setUploadFileTagAt(this._index,y)}};w.showImageEditor=function(){x.showImageEditorById(this.guid())};w.cropBounds=function(y){if(typeof y=="undefined"){return x.getUploadFileCropBounds(this._index)}else{if(arguments.length==4){x.setUploadFileCropBounds(this._index,arguments)}else{if(y instanceof Array||y==null){x.setUploadFileCropBounds(this._index,y)}}}}}else{if(v==="flash"){w.angle=function(y){if(y||y===0){x.callFlash("setUploadFileAngle",this._index,y)}else{return x.callFlash("getUploadFileAngle",this._index)}};w.description=function(y){if(y!==f){x.callFlash("setUploadFileDescription",this._index,y)}else{return x.callFlash("getUploadFileDescription",this._index)}};w.height=function(){return x.callFlash("getUploadFileHeight",this._index)};w.name=function(){return x.callFlash("getUploadFileName",this._index)};w.selected=function(y){if(y!==f){x.callFlash("setUploadFileSelected",this._index,y)}else{return x.callFlash("getUploadFileSelected",this._index)}};w.size=function(){return x.callFlash("getUploadFileSize",this._index)};w.width=function(){return x.callFlash("getUploadFileWidth",this._index)};w.remove=function(){return x.callFlash("removeAt",this._index,true)};w.guid=function(){return x.callFlash("getUploadFileGuid",this._index)}}else{throw new Error("Not supported: "+v)}}};g.files=function(){};g.files.prototype={__class:true,count:function(){return 0},get:function(v){return null},remove:function(v){},add:function(v,w){}};g.files.init=a._typicalInit;g.files.reinit=function(y){i("Reinit files API.");var x=y._uploader,v=x.type(),w=x.getControl();y.get=function(z){if(z<this.count()){if(this._items&&this._items[z]){return this._items[z]}else{this._items=this._items||[];var A=new g.file();g.file.reinit(w,A,v);A._index=z;this._items[z]=A;return A}}else{return null}};if(v==="html"){y.count=function(){return w.getUploadFileCount()};y.removeAll=function(){return w.uploadFileRemoveAll()};y.remove=function(z){return w.uploadFileRemoveAt(z)};y.add=function(z,A){if(typeof A=="string"){w.addUploadFilesAsBase64([[z,A]])}else{if(z,A){w.addUploadFilesAsBlob([[z,A]])}}}}else{if(v==="flash"){y.count=function(){return w.callFlash("getUploadFileCount")};y.removeAll=function(){return w.callFlash("removeAll")};y.remove=function(A){var z=A&&A.constructor&&A.constructor===Array;if(z){return w.callFlash("removeItems",A)}else{return w.callFlash("removeAt",A,true)}}}else{throw new Error("Not supported: "+v)}}};g.flashControl=function(){};g.flashControl.prototype={_simpleProperties:[{name:"codeBase",defaultValue:"Scripts/aurigma.imageuploaderflash.swf",isAttribute:true},{name:"themeUrl",getter:1,setter:1,renderOnly:true},{name:"ipServiceUrl",getter:1,setter:1,renderOnly:true},{name:"bgColor",isAttribute:true},{name:"wmode",isAttribute:true},{name:"quality",isAttribute:true},{name:"maxFileToLoadSize",getter:1,setter:1},{name:"version",isAttribute:true},{name:"actualVersion",getter:1},{name:"actualReleaseDate",getter:1},{name:"topPaneVisibility",getter:1,setter:1},{name:"statusPaneVisibility",getter:1,setter:1}],flashVersionRequired:[10,1,0],codeBase:function(v){},maxFileToLoadSize:function(){},themeUrl:function(){},bgColor:function(){},wmode:function(v){},quality:function(v){},isFlashSupported:function(){var w=g.flashDetector.detectVersion();var z=this.flashVersionRequired;for(var y=0,x=z.length;y<x;y++){if(w[y]<z[y]){return false}else{if(w[y]>z[y]){return true}}}return true},getParams:r};g.flashControl.init=a._typicalInit;g.flashControl.reinit=a._typicalReinit;g.imagePreviewWindow=function(){};g.imagePreviewWindow.prototype={_simpleProperties:[{name:"closePreviewTooltip",getter:1,setter:1}],closePreviewTooltip:function(v){}};g.imagePreviewWindow.init=a._typicalInit;g.imagePreviewWindow.reinit=a._typicalReinit;g.informationBar=function(){};g.informationBar.prototype={__class:true,_simpleProperties:[],_methods:[{name:"show",controlMethodName:"showInformationBar"}],getParams:r,show:function(v){}};g.informationBar.init=a._typicalInit;g.informationBar.reinit=a._typicalReinit;g.informationBar.prototype.constructor=g.informationBar;g.uploadPane=function(){};g.uploadPane.prototype={_simpleProperties:[{name:"addFilesButtonText",getter:1,setter:1},{name:"addFolderButtonText",getter:1,setter:1},{name:"iconItemWidth",getter:1,setter:1},{name:"iconSize",getter:1,setter:1},{name:"tileItemWidth",getter:1,setter:1},{name:"tilePreviewSize",getter:1,setter:1},{name:"thumbnailPreviewSize",getter:1,setter:1},{name:"viewMode",getter:1,setter:1},{name:"dropFilesHereText",getter:1,setter:1}],dropFilesHereText:function(v){},addFolder:function(){if(this._uploader.type()==="html"){this._uploader.getControl().addFiles(true)}},addFolders:function(){this.addFolder()},addFiles:function(){if(this._uploader.type()==="html"){this._uploader.getControl().addFiles()}},addFilesButtonText:function(v){},addFolderButtonText:function(v){},iconItemWidth:function(v){},iconSize:function(v){},tileItemWidth:function(v){},tilePreviewSize:function(v){},thumbnailPreviewSize:function(v){},viewMode:function(v){}};g.uploadPane.init=a._typicalInit;g.uploadPane.reinit=a._typicalReinit;g.messages=function(){};g.messages.prototype={__class:true,_simpleProperties:[{name:"cannotReadFile",getter:1,setter:1},{name:"dimensionsTooLarge",getter:1,setter:1},{name:"dimensionsTooSmall",getter:1,setter:1},{name:"fileNameNotAllowed",getter:1,setter:1,render:"FileNameNotAllowedMessage"},{name:"fileSizeTooSmall",getter:1,setter:1},{name:"filesNotAdded",getter:1,setter:1},{name:"maxFileCountExceeded",getter:1,setter:1},{name:"maxFileSizeExceeded",getter:1,setter:1},{name:"maxTotalFileSizeExceeded",getter:1,setter:1},{name:"memoryLimitReached",getter:1,setter:1},{name:"previewNotAvailable",getter:1,setter:1},{name:"tooFewFiles",getter:1,setter:1},{name:"tooManyFilesSelectedToOpen",getter:1,setter:1},{name:"dndFolderFileLimitExceeded",getter:1,setter:1}],dndFolderFileLimitExceeded:function(v){},cannotReadFile:function(v){},dimensionsTooLarge:function(v){},dimensionsTooSmall:function(v){},fileNameNotAllowed:function(v){},fileSizeTooSmall:function(v){},filesNotAdded:function(v){},maxFileCountExceeded:function(v){},maxFileSizeExceeded:function(v){},maxTotalFileSizeExceeded:function(v){},memoryLimitReached:function(v){},previewNotAvailable:function(v){},tooFewFiles:function(v){},tooManyFilesSelectedToOpen:function(v){}};g.messages.init=a._typicalInit;g.messages.reinit=a._typicalReinit;g.metadata=function(){};g.metadata.prototype={__class:true,_simpleProperties:[{name:"exif",getter:1,setter:1,render:"ExtractExif"},{name:"iptc",getter:1,setter:1,render:"ExtractIptc"},{name:"valueSeparator",getter:1,setter:1,render:"MetadataValueSeparator"},{name:"enableAllStandardFields",getter:1,setter:1,render:"EnableAllStandardFields"}],addCustomField:function(v,w,x){this._customFields=this._customFields||[];if(v&&w!=null){this._customFields.push({action:"add",name:v,value:w,add:x})}},removeCustomField:function(v){this._customFields=this._customFields||[];if(v){this._customFields.push({action:"remove",name:v})}},additionalFormName:function(v){if(arguments.length==0){return this._formName}else{if(this._beforeUploadHandler){this._uploader.events().beforeUpload().remove(this._beforeUploadHandler);delete this._beforeUploadHandler;delete this._formName}if(v){this._formName=v;this._beforeUploadHandler=function(){var z=this.metadata();var A=document.forms[z._formName];if(A){var w=m.formToArray(A),y=w.length;if(y>0){for(var x=0;x<y;x++){var B=w[x];if(!B.array||B.first){z.addCustomField(B.name,B.value)}else{z.addCustomField(B.name,B.value,true)}}}}};this._uploader.events().beforeUpload().add(this._beforeUploadHandler)}}},getParams:r,exif:function(v){},iptc:function(v){},valueSeparator:function(v){}};g.metadata.init=a._typicalInit;g.metadata.reinit=function(B){i("Reinit metadata.");var A=B._uploader,x=A.type(),z=A.getControl();if(x==="html"){B.addCustomField=function(C,D,E){if(C){z.addCustomField(C,D,!!E)}};B.removeCustomField=function(C){if(C!=null){z.removeCustomField(C)}};B.exif=function(C){z.setExtractExif(C)};if(typeof B._exif!="undefined"){z.setExtractExif(B._exif)}B.iptc=function(C){z.setExtractIptc(C)};if(typeof B._iptc!="undefined"){z.setExtractIptc(B._iptc)}B.valueSeparator=function(C){z.setMetadataValueSeparator(C)};if(typeof B._valueSeparator!="undefined"){z.setMetadataValueSeparator(B._valueSeparator)}}else{if(x==="flash"){B.addCustomField=function(C,D,E){z.callFlash("addCustomField",C,D,!!E)};B.removeCustomField=function(C){if(C!=null){z.callFlash("removeCustomField",C)}}}else{throw new Error("Not supported: "+x)}}if(B._customFields&&B._customFields.length>0){for(var w=0,v=B._customFields.length;w<v;w++){var y=B._customFields[w];switch(y.action){case"add":B.addCustomField(y.name,y.value,y.add);break;case"remove":B.removeCustomField(y.name);break}}}a._typicalReinit(B)};g.restrictions=function(){};g.restrictions.prototype={__class:true,_simpleProperties:[{name:"fileMask",getter:1,setter:1},{name:"deniedFileMask",getter:1,setter:1},{name:"maxFileCount",getter:1,setter:1},{name:"maxFileSize",getter:1,setter:1},{name:"maxImageHeight",getter:1,setter:1},{name:"maxImageWidth",getter:1,setter:1},{name:"maxTotalFileSize",getter:1,setter:1},{name:"minFileCount",getter:1,setter:1},{name:"minFileSize",getter:1,setter:1},{name:"minImageHeight",getter:1,setter:1},{name:"minImageWidth",getter:1,setter:1},{name:"minImageWidthHeightLogic",getter:1,setter:1}],getParams:r,fileMask:function(){},deniedFileMask:function(v){},maxFileCount:function(v){},maxFileSize:function(){},maxImageHeight:function(){},maxImageWidth:function(){},maxTotalFileSize:function(){},minFileCount:function(v){},minFileSize:function(){},minImageHeight:function(){},minImageWidth:function(){},minImageWidthHeightLogic:function(){}};g.restrictions.init=a._typicalInit;g.restrictions.reinit=a._typicalReinit;g.statusPane=function(){};g.statusPane.prototype={_simpleProperties:[{name:"dataUploadedText",getter:1,setter:1,render:"StatusPaneDataUploadedText"},{name:"filesPreparedText",getter:1,setter:1,render:"StatusPaneFilesPreparedText"},{name:"filesToUploadText",getter:1,setter:1},{name:"filesUploadedText",getter:1,setter:1,render:"StatusPaneFilesUploadedText"},{name:"noFilesToUploadText",getter:1,setter:1},{name:"preparingText",getter:1,setter:1,render:"StatusPanePreparingText"},{name:"sendingText",getter:1,setter:1,render:"StatusPaneSendingText"},{name:"visible",getter:1,setter:1,render:"StatusPaneVisibility"},],visible:function(v){},dataUploadedText:function(v){},filesPreparedText:function(v){},filesToUploadText:function(v){},filesUploadedText:function(v){},noFilesToUploadText:function(v){},preparingText:function(v){},sendingText:function(v){}};g.statusPane.init=a._typicalInit;g.statusPane.reinit=a._typicalReinit;g.topPane=function(){};g.topPane.prototype={_simpleProperties:[{name:"addFilesHyperlinkText",getter:1,setter:1},{name:"addFolderHyperlinkText",getter:1,setter:1},{name:"clearAllHyperlinkText",getter:1,setter:1},{name:"orText",getter:1,setter:1},{name:"showViewComboBox",getter:1,setter:1},{name:"titleText",getter:1,setter:1},{name:"viewComboBox",getter:1,setter:1},{name:"viewComboBoxText",getter:1,setter:1},{name:"visible",getter:1,setter:1,render:"TopPaneVisibility"}],visible:function(v){},addFolderHyperlinkText:function(v){},addFilesHyperlinkText:function(v){},clearAllHyperlinkText:function(v){},orText:function(v){},showViewComboBox:function(v){},titleText:function(v){},viewComboBox:function(v){},viewComboBoxText:function(v){}};g.topPane.init=a._typicalInit;g.topPane.reinit=a._typicalReinit;g.uploadSettings=function(){};g.uploadSettings.prototype={__class:true,_simpleProperties:[{name:"_actionInternal",getter:1,setter:1,render:"actionUrl",defaultValue:document.location.href},{name:"chunkSize",getter:1,setter:1},{name:"progressBytesMode",getter:1,setter:1},{name:"enableInstantUpload",getter:1,setter:1},{name:"urlEncodedFilenames",getter:1,setter:1,render:"filenamesUrlEncoded"},],enableInstantUpload:function(v){if(typeof v!="undefined"){this.enableInstantUpload(v)}else{return this.enableInstantUpload()}},actionUrl:function(v){if(v){if(v=="."||v=="./"){v=document.location.href}return this._actionInternal(v)}else{return this._actionInternal()}},chunkSize:function(v){},progressBytesMode:function(v){},redirectUrl:function(w){if(arguments.length>0){this._redirectUrl=arguments[0];var y=false;var v=this._uploader.events().afterUpload()._handlers;for(var x=0;v.length;x++){if(v[x]==this._afterUpload){y=true;break}}if(!y){this._afterUpload=function(){setTimeout(function(){if(!!this._redirectUrl){j.location=this._redirectUrl}}.bind(this),100)}.bind(this);this._uploader.events().afterUpload().add(this._afterUpload)}}else{return this._redirectUrl}},getParams:r};g.uploadSettings.init=function(w,v){a._typicalInit(w,v);w.redirectUrl(w.redirectUrl())};g.uploadSettings.reinit=a._typicalReinit;g.paneItem=function(){};g.paneItem.prototype={__class:true,_simpleProperties:[{name:"descriptionEditorIconTooltip",getter:1,setter:1},{name:"enableDisproportionalExifThumbnails",getter:1,setter:1},{name:"imageTooltip",getter:1,setter:1},{name:"itemTooltip",getter:1,setter:1},{name:"removalIconTooltip",getter:1,setter:1},{name:"rotationIconTooltip",getter:1,setter:1},{name:"toolbarAlwaysVisible",getter:1,setter:1,render:"paneItemToolbarAlwaysVisible"}],getParams:r,descriptionEditorIconTooltip:function(v){},enableDisproportionalExifThumbnails:function(v){},imageTooltip:function(v){},itemTooltip:function(v){},removalIconTooltip:function(v){},rotationIconTooltip:function(v){},toolbarAlwaysVisible:function(v){}};g.paneItem.init=a._typicalInit;g.paneItem.reinit=a._typicalReinit;g.uploadErrorDialog=function(){};g.uploadErrorDialog.prototype={_simpleProperties:[{name:"hideDetailsButtonText",getter:1,setter:1,render:"UploadErrorDialogHideDetailsButtonText"},{name:"message",getter:1,setter:1,render:"UploadErrorDialogMessage"},{name:"showDetailsButtonText",getter:1,setter:1,render:"UploadErrorDialogShowDetailsButtonText"},{name:"title",getter:1,setter:1,render:"UploadErrorDialogTitle"}],hideDetailsButtonText:function(v){},message:function(v){},showDetailsButtonText:function(v){},title:function(v){},getParams:r};g.uploadErrorDialog.init=a._typicalInit;g.uploadErrorDialog.reinit=a._typicalReinit;g.addFilesProgressDialog=function(){};g.addFilesProgressDialog.prototype={_simpleProperties:[{name:"text",getter:1,setter:1,render:"AddFilesProgressDialogText"},{name:"waitText",getter:1,setter:1,render:"AddFilesProgressDialogWaitText"}],text:function(v){}};g.addFilesProgressDialog.init=a._typicalInit;g.addFilesProgressDialog.reinit=a._typicalReinit;g.imageEditor=function(){};g.imageEditor.prototype={_simpleProperties:[{name:"enableCrop",getter:1,setter:1,render:"ImageEditorEnableCrop"},{name:"enableDrawTool",getter:1,setter:1,render:"ImageEditorEnableDrawTool"},{name:"cropRatio",getter:1,setter:1,render:"ImageEditorCropRatio"},{name:"cropMinSize",getter:1,setter:1,render:"ImageEditorCropMinSize"},{name:"drawTool",getter:1,setter:1,render:"ImageEditorDrawTool"},{name:"defaultTool",getter:1,setter:1,render:"ImageEditorDefaultTool"}],_methods:[{name:"show",controlMethodName:"showImageEditorById"}],};g.imageEditor.init=a._typicalInit;g.imageEditor.reinit=a._typicalReinit;g.imageUploaderFlash=function(v){return new g.imageUploaderFlash.fn.init(v)};g.imageUploaderFlash.fn=g.imageUploaderFlash.prototype=new h();s(g.imageUploaderFlash.fn,{_simpleProperties:[f,{name:"cancelUploadButtonText",getter:1,setter:1},{name:"enableAddingFiles",getter:1,setter:1},{name:"enableAutoRotation",getter:1,setter:1},{name:"enableDescriptionEditor",getter:1,setter:1},{name:"enableRotation",getter:1,setter:1},{name:"enableInstantUpload",getter:1,setter:1},{name:"height",getter:1,setter:1,defaultValue:"400px",isAttribute:true},{name:"licenseKey",getter:1,setter:1,renderOnly:true},{name:"uploadButtonText",getter:1,setter:1},{name:"locale",getter:1,setter:1},{name:"width",getter:1,setter:1,defaultValue:"600px",isAttribute:true},{name:"folderProcessingMode",getter:1,setter:1,defaultValue:"none",isAttribute:true},{name:"enableImageEditor",getter:1,setter:1,render:"EnableImageEditor"},{name:"enableExifPreview",getter:1,setter:1,render:"EnableExifPreview"}],_objectProperties:[{name:"addFilesProgressDialog",type:g.addFilesProgressDialog},{name:"imageEditor",type:g.imageEditor},{name:"commonDialog",type:g.commonDialog},{name:"converters",type:g.converters},{name:"descriptionEditor",type:g.descriptionEditor},{name:"events",type:g.events},{name:"files",type:g.files},{name:"flashControl",type:g.flashControl},{name:"imagePreviewWindow",type:g.imagePreviewWindow},{name:"informationBar",type:g.informationBar},{name:"messages",type:g.messages},{name:"metadata",type:g.metadata},{name:"paneItem",type:g.paneItem},{name:"restrictions",type:g.restrictions},{name:"statusPane",type:g.statusPane},{name:"topPane",type:g.topPane},{name:"uploadErrorDialog",type:g.uploadErrorDialog},{name:"uploadPane",type:g.uploadPane},{name:"uploadSettings",type:g.uploadSettings}],_methods:[{name:"upload",controlMethodName:"upload"},{name:"cancelUpload",controlMethodName:"cancelUpload"}],init:function(w){if(typeof w==="string"){return l.get(w)}this._uploader=this;for(var y=0,x=this._simpleProperties.length;y<x;y++){if(this._simpleProperties.hasOwnProperty(y)){a.createSimpleProperty(this,this._simpleProperties[y])}}for(var y=0,x=this._objectProperties.length;y<x;y++){var z=this._objectProperties[y];if(z.type===g.converters){var v=new g.converters();g.converters.init(v,this);this[z.name]=function(){var C=arguments[0];if(C instanceof Array){v._converters.length=0;while(v.count()>0){v.remove(0)}for(var B=0,A=C.length;B<A;B++){v.add(C[B])}}else{return v}}}else{a.createObjectProperty(this,z,this)}}this.events().initComplete(function(){this.reinit()});i("Start apply uploader init object.");this.set(w);i("Finish apply uploader init object.");l.put(this);return this},reinit:function(){i("Start control re-initialization.");if(this.type()=="flash"){var y=document.getElementById(this.id()),x,w;var A=function(B){if(typeof B.preventDefault==="function"){B.preventDefault()}if(typeof B.stopPropagation==="function"){B.stopPropagation()}B.returnValue=false;return false};if(typeof y.addEventListener==="function"){y.addEventListener("DOMMouseScroll",A,false);y.addEventListener("mousewheel",A,false)}else{if(typeof y.attachEvent==="function"){y.attachEvent("onmousewheel",A)}}}i("Reinit control properties.");if(this._simpleProperties){for(var x=0,v=this._simpleProperties.length;x<v;x++){var z=this._simpleProperties[x];if(this._simpleProperties.hasOwnProperty(x)){if(!z.isAttribute){a.createControlProperty(this,z)}else{a.createAttributeProperty(this,z)}}}}if(this._objectProperties){for(var x=0,v=this._objectProperties.length;x<v;x++){var z=this._objectProperties[x];if(this._objectProperties.hasOwnProperty(x)&&z.type&&typeof z.type.reinit==="function"){z.type.reinit(this[z.name]())}}}i("Creating methods.");if(this._methods&&this._methods.length>0){for(var x=0,v=this._methods.length;x<v;x++){a.createMethod(this,this._methods[x])}}i("Control re-initialization completed.");this.state(1)},cancelUploadButtonText:function(v){},enableAddingFiles:function(v){},enableAutoRotation:function(v){},enableDescriptionEditor:function(v){},enableRotation:function(v){},height:function(v){},licenseKey:function(v){},locale:function(v){},uploadButtonText:function(v){},width:function(v){},version:function(){if(this.type()==="html"){return this.getControl().getVersion()}else{if(this.type()==="flash"){return this.flashControl().actualVersion()}}return""},buildDate:function(){if(this.type()==="html"){return this.getControl().getBuildDate()}else{if(this.type()==="flash"){return this.flashControl().actualReleaseDate()}}return""},addFilesProgressDialog:g.addFilesProgressDialog,imageEditor:g.imageEditor,commonDialog:g.commonDialog,converters:g.converters,descriptionEditor:g.descriptionEditor,events:g.events,files:g.files,flashControl:g.flashControl,imagePreviewWindow:g.imagePreviewWindow,informationBar:g.informationBar,messages:g.messages,metadata:g.metadata,paneItem:g.paneItem,restrictions:g.restrictions,statusPane:g.statusPane,topPane:g.topPane,uploadErrorDialog:g.uploadErrorDialog,uploadPane:g.uploadPane,uploadSettings:g.uploadSettings,upload:function(){},cancelUpload:function(){}},true);g.imageUploaderFlash.__class=true;g.imageUploaderFlash.prototype.constructor=g.imageUploaderFlash;g.imageUploaderFlash.fn.init.prototype=g.imageUploaderFlash.fn;g.event=function o(){this._handlers=this._handlers||[]};g.event.prototype={__class:true,add:function(x){if(x instanceof Array){for(var w=0,v=x.length;w<v;w++){this._handlers.push(x[w])}}else{this._handlers.push(x)}},remove:function(w){for(var v in this._handlers){if(this._handlers[v]===w){this._handlers.splice(v,1);return true}}return false},clear:function(){this._handlers=[]},count:function(){return this._handlers.length}};g.event.prototype.constructor=g.event;var c=function(w){if(!w){return}var v=function(){function D(){var N=w.getParams();for(var P=0,O=N.length;P<O;P++){N[P]=N[P].name+"="+N[P].value}return N.join("&")+"&controlId="+w.id()}var I=w.flashControl().codeBase();var J=w.flashControl().version();if(J){if(I.indexOf("?")>-1){I=I+"&version="+J}else{I+="?version="+J}}var G=[],F,A,z=w.id(),H=w.flashControl().flashVersionRequired.join(",");var E={id:z,name:z,width:w.width(),height:w.height()};if(j.ActiveXObject){E.classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000";E.codebase=j.location.protocol+"//download.macromedia.com/pub/shockwave/cabs/flash/swflash.cab#version="+H}else{E.data=I;E.type="application/x-shockwave-flash"}var L=w.flashControl();var K={quality:L.quality()||"high",bgcolor:L.bgColor()||"#869ca7",wmode:L.wmode()||"window",allowScriptAccess:"always",flashvars:D()};if(j.ActiveXObject){K.movie=I}var y=[w,{resultHtml:""}],M;w._invokeCallback("flashBeforeOpenTagRender",y);if(M=y[1].resultHtml){G.push(M)}var A="object";G.push("<"+A+" ");var C=[w,{resultHtml:""}],M;w._invokeCallback("flashRenderStyleAttribute",C);if(M=C[1].resultHtml){G.push(' style="'+M+'" ')}for(var F in E){if(!E.hasOwnProperty||E.hasOwnProperty(F)){G.push(F+'="'+n(E[F])+'" ')}}G.push(">");for(var F in K){if(!K.hasOwnProperty||K.hasOwnProperty(F)){G.push('<param name="'+F+'" value="'+n(K[F])+'" /> ')}}var B=[w,{resultHtml:""}],M;w._invokeCallback("flashBeforeCloseTagRender",B);if(M=B[1].resultHtml){G.push(M)}G.push("</"+A+">");var x=[w,{resultHtml:""}],M;w._invokeCallback("flashAfterCloseTagRender",x);if(M=x[1].resultHtml){G.push(M)}return G.join("")};return{html:v,write:function(){document.write(this.html())}}};if(!j.$au&&typeof k!="undefined"){j.$au=k}if(j.$au){j.$au.imageUploaderFlash=k.imageUploaderFlash}})(window);var COMPILED=false;var goog=goog||{};goog.global=this;goog.global.CLOSURE_UNCOMPILED_DEFINES;goog.global.CLOSURE_DEFINES;goog.isDef=function(a){return a!==void 0};goog.exportPath_=function(c,a,f){var d=c.split(".");var e=f||goog.global;if(!(d[0] in e)&&e.execScript){e.execScript("var "+d[0])}for(var b;d.length&&(b=d.shift());){if(!d.length&&goog.isDef(a)){e[b]=a}else{if(e[b]){e=e[b]}else{e=e[b]={}}}}};goog.define=function(b,a){var c=a;if(!COMPILED){if(goog.global.CLOSURE_UNCOMPILED_DEFINES&&Object.prototype.hasOwnProperty.call(goog.global.CLOSURE_UNCOMPILED_DEFINES,b)){c=goog.global.CLOSURE_UNCOMPILED_DEFINES[b]}else{if(goog.global.CLOSURE_DEFINES&&Object.prototype.hasOwnProperty.call(goog.global.CLOSURE_DEFINES,b)){c=goog.global.CLOSURE_DEFINES[b]}}}goog.exportPath_(b,c)};goog.define("goog.DEBUG",true);goog.define("goog.LOCALE","en");goog.define("goog.TRUSTED_SITE",true);goog.define("goog.STRICT_MODE_COMPATIBLE",false);goog.define("goog.DISALLOW_TEST_ONLY_CODE",COMPILED&&!goog.DEBUG);goog.provide=function(a){if(!COMPILED){if(goog.isProvided_(a)){throw Error('Namespace "'+a+'" already declared.')}}goog.constructNamespace_(a)};goog.constructNamespace_=function(a,c){if(!COMPILED){delete goog.implicitNamespaces_[a];var b=a;while((b=b.substring(0,b.lastIndexOf(".")))){if(goog.getObjectByName(b)){break}goog.implicitNamespaces_[b]=true}}goog.exportPath_(a,c)};goog.VALID_MODULE_RE_=/^[a-zA-Z_$][a-zA-Z0-9._$]*$/;goog.module=function(a){if(!goog.isString(a)||!a||a.search(goog.VALID_MODULE_RE_)==-1){throw Error("Invalid module identifier")}if(!goog.isInModuleLoader_()){throw Error("Module "+a+" has been loaded incorrectly.")}if(goog.moduleLoaderState_.moduleName){throw Error("goog.module may only be called once per module.")}goog.moduleLoaderState_.moduleName=a;if(!COMPILED){if(goog.isProvided_(a)){throw Error('Namespace "'+a+'" already declared.')}delete goog.implicitNamespaces_[a]}};goog.module.get=function(a){return goog.module.getInternal_(a)};goog.module.getInternal_=function(a){if(!COMPILED){if(goog.isProvided_(a)){return a in goog.loadedModules_?goog.loadedModules_[a]:goog.getObjectByName(a)}else{return null}}};goog.moduleLoaderState_=null;goog.isInModuleLoader_=function(){return goog.moduleLoaderState_!=null};goog.module.declareTestMethods=function(){if(!goog.isInModuleLoader_()){throw new Error("goog.module.declareTestMethods must be called from within a goog.module")}goog.moduleLoaderState_.declareTestMethods=true};goog.module.declareLegacyNamespace=function(){if(!COMPILED&&!goog.isInModuleLoader_()){throw new Error("goog.module.declareLegacyNamespace must be called from within a goog.module")}if(!COMPILED&&!goog.moduleLoaderState_.moduleName){throw Error("goog.module must be called prior to goog.module.declareLegacyNamespace.")}goog.moduleLoaderState_.declareLegacyNamespace=true};goog.setTestOnly=function(a){if(goog.DISALLOW_TEST_ONLY_CODE){a=a||"";throw Error("Importing test-only code into non-debug environment"+(a?": "+a:"."))}};goog.forwardDeclare=function(a){};if(!COMPILED){goog.isProvided_=function(a){return(a in goog.loadedModules_)||(!goog.implicitNamespaces_[a]&&goog.isDefAndNotNull(goog.getObjectByName(a)))};goog.implicitNamespaces_={"goog.module":true}}goog.getObjectByName=function(b,c){var d=b.split(".");var e=c||goog.global;for(var a;a=d.shift();){if(goog.isDefAndNotNull(e[a])){e=e[a]}else{return null}}return e};goog.globalize=function(d,b){var c=b||goog.global;for(var a in d){c[a]=d[a]}};goog.addDependency=function(f,e,l,d){if(goog.DEPENDENCIES_ENABLED){var g,a;var k=f.replace(/\\/g,"/");var h=goog.dependencies_;for(var c=0;g=e[c];c++){h.nameToPath[g]=k;h.pathIsModule[k]=!!d}for(var b=0;a=l[b];b++){if(!(k in h.requires)){h.requires[k]={}}h.requires[k][a]=true}}};goog.define("goog.ENABLE_DEBUG_LOADER",true);goog.logToConsole_=function(a){if(goog.global.console){goog.global.console.error(a)}};goog.require=function(b){if(!COMPILED){if(goog.ENABLE_DEBUG_LOADER&&goog.IS_OLD_IE_){goog.maybeProcessDeferredDep_(b)}if(goog.isProvided_(b)){if(goog.isInModuleLoader_()){return goog.module.getInternal_(b)}else{return null}}if(goog.ENABLE_DEBUG_LOADER){var c=goog.getPathFromDeps_(b);if(c){goog.included_[c]=true;goog.writeScripts_();return null}}var a="goog.require could not find: "+b;goog.logToConsole_(a);throw Error(a)}};goog.basePath="";goog.global.CLOSURE_BASE_PATH;goog.global.CLOSURE_NO_DEPS=true;goog.global.CLOSURE_IMPORT_SCRIPT;goog.nullFunction=function(){};goog.identityFunction=function(b,a){return b};goog.abstractMethod=function(){throw Error("unimplemented abstract method")};goog.addSingletonGetter=function(a){a.getInstance=function(){if(a.instance_){return a.instance_}if(goog.DEBUG){goog.instantiatedSingletons_[goog.instantiatedSingletons_.length]=a}return a.instance_=new a}};goog.instantiatedSingletons_=[];goog.define("goog.LOAD_MODULE_USING_EVAL",true);goog.define("goog.SEAL_MODULE_EXPORTS",goog.DEBUG);goog.loadedModules_={};goog.DEPENDENCIES_ENABLED=!COMPILED&&goog.ENABLE_DEBUG_LOADER;if(goog.DEPENDENCIES_ENABLED){goog.included_={};goog.dependencies_={pathIsModule:{},nameToPath:{},requires:{},visited:{},written:{},deferred:{}};goog.inHtmlDocument_=function(){var a=goog.global.document;return typeof a!="undefined"&&"write" in a};goog.findBasePath_=function(){if(goog.isDef(goog.global.CLOSURE_BASE_PATH)){goog.basePath=goog.global.CLOSURE_BASE_PATH;return}else{if(!goog.inHtmlDocument_()){return}}var f=goog.global.document;var a=f.getElementsByTagName("script");for(var d=a.length-1;d>=0;--d){var c=(a[d]);var g=c.src;var e=g.lastIndexOf("?");var b=e==-1?g.length:e;if(g.substr(b-7,7)=="base.js"){goog.basePath=g.substr(0,b-7);return}}};goog.importScript_=function(c,a){var b=goog.global.CLOSURE_IMPORT_SCRIPT||goog.writeScriptTag_;if(b(c,a)){goog.dependencies_.written[c]=true}};goog.IS_OLD_IE_=!goog.global.atob&&goog.global.document&&goog.global.document.all;goog.importModule_=function(b){var a='goog.retrieveAndExecModule_("'+b+'");';if(goog.importScript_("",a)){goog.dependencies_.written[b]=true}};goog.queuedModules_=[];goog.wrapModule_=function(b,a){if(!goog.LOAD_MODULE_USING_EVAL||!goog.isDef(goog.global.JSON)){return'goog.loadModule(function(exports) {"use strict";'+a+"\n;return exports});\n//# sourceURL="+b+"\n"}else{return"goog.loadModule("+goog.global.JSON.stringify(a+"\n//# sourceURL="+b+"\n")+");"}};goog.loadQueuedModules_=function(){var c=goog.queuedModules_.length;if(c>0){var a=goog.queuedModules_;goog.queuedModules_=[];for(var b=0;b<c;b++){var d=a[b];goog.maybeProcessDeferredPath_(d)}}};goog.maybeProcessDeferredDep_=function(a){if(goog.isDeferredModule_(a)&&goog.allDepsAreAvailable_(a)){var b=goog.getPathFromDeps_(a);goog.maybeProcessDeferredPath_(goog.basePath+b)}};goog.isDeferredModule_=function(a){var c=goog.getPathFromDeps_(a);if(c&&goog.dependencies_.pathIsModule[c]){var b=goog.basePath+c;return(b) in goog.dependencies_.deferred}return false};goog.allDepsAreAvailable_=function(a){var b=goog.getPathFromDeps_(a);if(b&&(b in goog.dependencies_.requires)){for(var c in goog.dependencies_.requires[b]){if(!goog.isProvided_(c)&&!goog.isDeferredModule_(c)){return false}}}return true};goog.maybeProcessDeferredPath_=function(a){if(a in goog.dependencies_.deferred){var b=goog.dependencies_.deferred[a];delete goog.dependencies_.deferred[a];goog.globalEval(b)}};goog.loadModule=function(d){var a=goog.moduleLoaderState_;try{goog.moduleLoaderState_={moduleName:undefined,declareTestMethods:false};var b;if(goog.isFunction(d)){b=d.call(goog.global,{})}else{if(goog.isString(d)){b=goog.loadModuleFromSource_.call(goog.global,d)}else{throw Error("Invalid module definition")}}var c=goog.moduleLoaderState_.moduleName;if(!goog.isString(c)||!c){throw Error('Invalid module name "'+c+'"')}if(goog.moduleLoaderState_.declareLegacyNamespace){goog.constructNamespace_(c,b)}else{if(goog.SEAL_MODULE_EXPORTS&&Object.seal){Object.seal(b)}}goog.loadedModules_[c]=b;if(goog.moduleLoaderState_.declareTestMethods){for(var e in b){if(e.indexOf("test",0)===0||e=="tearDown"||e=="setUp"||e=="setUpPage"||e=="tearDownPage"){goog.global[e]=b[e]}}}}finally{goog.moduleLoaderState_=a}};goog.loadModuleFromSource_=function(source){var exports={};eval(arguments[0]);return exports};goog.writeScriptTag_=function(e,b){if(goog.inHtmlDocument_()){var c=goog.global.document;if(c.readyState=="complete"){var f=/\bdeps.js$/.test(e);if(f){return false}else{throw Error('Cannot write "'+e+'" after document load')}}var d=goog.IS_OLD_IE_;if(b===undefined){if(!d){c.write('<script type="text/javascript" src="'+e+'"><\/script>')}else{var a=" onreadystatechange='goog.onScriptLoad_(this, "+ ++goog.lastNonModuleScriptIndex_+")' ";c.write('<script type="text/javascript" src="'+e+'"'+a+"><\/script>")}}else{c.write('<script type="text/javascript">'+b+"<\/script>")}return true}else{return false}};goog.lastNonModuleScriptIndex_=0;goog.onScriptLoad_=function(a,b){if(a.readyState=="complete"&&goog.lastNonModuleScriptIndex_==b){goog.loadQueuedModules_()}return true};goog.writeScripts_=function(){var a=[];var b={};var g=goog.dependencies_;function e(i){if(i in g.written){return}if(i in g.visited){if(!(i in b)){b[i]=true;a.push(i)}return}g.visited[i]=true;if(i in g.requires){for(var j in g.requires[i]){if(!goog.isProvided_(j)){if(j in g.nameToPath){e(g.nameToPath[j])}else{throw Error("Undefined nameToPath for "+j)}}}}if(!(i in b)){b[i]=true;a.push(i)}}for(var d in goog.included_){if(!g.written[d]){e(d)}}for(var c=0;c<a.length;c++){var d=a[c];goog.dependencies_.written[d]=true}var h=goog.moduleLoaderState_;goog.moduleLoaderState_=null;var f=false;for(var c=0;c<a.length;c++){var d=a[c];if(d){if(!g.pathIsModule[d]){goog.importScript_(goog.basePath+d)}else{f=true;goog.importModule_(goog.basePath+d)}}else{goog.moduleLoaderState_=h;throw Error("Undefined script input")}}goog.moduleLoaderState_=h};goog.getPathFromDeps_=function(a){if(a in goog.dependencies_.nameToPath){return goog.dependencies_.nameToPath[a]}else{return null}};goog.findBasePath_();if(!goog.global.CLOSURE_NO_DEPS){goog.importScript_(goog.basePath+"deps.js")}}goog.normalizePath_=function(c){var b=c.split("/");var a=0;while(a<b.length){if(b[a]=="."){b.splice(a,1)}else{if(a&&b[a]==".."&&b[a-1]&&b[a-1]!=".."){b.splice(--a,2)}else{a++}}}return b.join("/")};goog.retrieveAndExecModule_=function(g){if(!COMPILED){var d=g;g=goog.normalizePath_(g);var c=goog.global.CLOSURE_IMPORT_SCRIPT||goog.writeScriptTag_;var b=null;var f=new goog.global.XMLHttpRequest();f.onload=function(){b=this.responseText};f.open("get",g,false);f.send();b=f.responseText;if(b!=null){var a=goog.wrapModule_(g,b);var e=goog.IS_OLD_IE_;if(e){goog.dependencies_.deferred[d]=a;goog.queuedModules_.push(d)}else{c(g,a)}}else{throw new Error("load of "+g+"failed")}}};goog.typeOf=function(c){var b=typeof c;if(b=="object"){if(c){if(c instanceof Array){return"array"}else{if(c instanceof Object){return b}}var a=Object.prototype.toString.call((c));if(a=="[object Window]"){return"object"}if((a=="[object Array]"||typeof c.length=="number"&&typeof c.splice!="undefined"&&typeof c.propertyIsEnumerable!="undefined"&&!c.propertyIsEnumerable("splice"))){return"array"}if((a=="[object Function]"||typeof c.call!="undefined"&&typeof c.propertyIsEnumerable!="undefined"&&!c.propertyIsEnumerable("call"))){return"function"}}else{return"null"}}else{if(b=="function"&&typeof c.call=="undefined"){return"object"}}return b};goog.isNull=function(a){return a===null};goog.isDefAndNotNull=function(a){return a!=null};goog.isArray=function(a){return goog.typeOf(a)=="array"};goog.isArrayLike=function(b){var a=goog.typeOf(b);return a=="array"||a=="object"&&typeof b.length=="number"};goog.isDateLike=function(a){return goog.isObject(a)&&typeof a.getFullYear=="function"};goog.isString=function(a){return typeof a=="string"};goog.isBoolean=function(a){return typeof a=="boolean"};goog.isNumber=function(a){return typeof a=="number"};goog.isFunction=function(a){return goog.typeOf(a)=="function"};goog.isObject=function(b){var a=typeof b;return a=="object"&&b!=null||a=="function"};goog.getUid=function(a){return a[goog.UID_PROPERTY_]||(a[goog.UID_PROPERTY_]=++goog.uidCounter_)};goog.hasUid=function(a){return !!a[goog.UID_PROPERTY_]};goog.removeUid=function(b){if("removeAttribute" in b){b.removeAttribute(goog.UID_PROPERTY_)}try{delete b[goog.UID_PROPERTY_]}catch(a){}};goog.UID_PROPERTY_="closure_uid_"+((Math.random()*1000000000)>>>0);goog.uidCounter_=0;goog.getHashCode=goog.getUid;goog.removeHashCode=goog.removeUid;goog.cloneObject=function(c){var b=goog.typeOf(c);if(b=="object"||b=="array"){if(c.clone){return c.clone()}var d=b=="array"?[]:{};for(var a in c){d[a]=goog.cloneObject(c[a])}return d}return c};goog.bindNative_=function(a,c,b){return(a.call.apply(a.bind,arguments))};goog.bindJs_=function(a,d,b){if(!a){throw new Error()}if(arguments.length>2){var c=Array.prototype.slice.call(arguments,2);return function(){var e=Array.prototype.slice.call(arguments);Array.prototype.unshift.apply(e,c);return a.apply(d,e)}}else{return function(){return a.apply(d,arguments)}}};goog.bind=function(a,c,b){if(Function.prototype.bind&&Function.prototype.bind.toString().indexOf("native code")!=-1){goog.bind=goog.bindNative_}else{goog.bind=goog.bindJs_}return goog.bind.apply(null,arguments)};goog.partial=function(b,c){var a=Array.prototype.slice.call(arguments,1);return function(){var d=a.slice();d.push.apply(d,arguments);return b.apply(this,d)}};goog.mixin=function(c,b){for(var a in b){c[a]=b[a]}};goog.now=(goog.TRUSTED_SITE&&Date.now)||(function(){return +new Date()});goog.globalEval=function(script){if(goog.global.execScript){goog.global.execScript(script,"JavaScript")}else{if(goog.global.eval){if(goog.evalWorksForGlobals_==null){goog.global.eval("var _et_ = 1;");if(typeof goog.global._et_!="undefined"){delete goog.global._et_;goog.evalWorksForGlobals_=true}else{goog.evalWorksForGlobals_=false}}if(goog.evalWorksForGlobals_){goog.global.eval(script)}else{var doc=goog.global.document;var scriptElt=doc.createElement("script");scriptElt.type="text/javascript";scriptElt.defer=false;scriptElt.appendChild(doc.createTextNode(script));doc.body.appendChild(scriptElt);doc.body.removeChild(scriptElt)}}else{throw Error("goog.globalEval not available")}}};goog.evalWorksForGlobals_=null;goog.cssNameMapping_;goog.cssNameMappingStyle_;goog.getCssName=function(e,c){var d=function(f){return goog.cssNameMapping_[f]||f};var b=function(j){var h=j.split("-");var f=[];for(var g=0;g<h.length;g++){f.push(d(h[g]))}return f.join("-")};var a;if(goog.cssNameMapping_){a=goog.cssNameMappingStyle_=="BY_WHOLE"?d:b}else{a=function(f){return f}}if(c){return e+"-"+a(c)}else{return a(e)}};goog.setCssNameMapping=function(b,a){goog.cssNameMapping_=b;goog.cssNameMappingStyle_=a};goog.global.CLOSURE_CSS_NAME_MAPPING;if(!COMPILED&&goog.global.CLOSURE_CSS_NAME_MAPPING){goog.cssNameMapping_=goog.global.CLOSURE_CSS_NAME_MAPPING}goog.getMsg=function(a,b){if(b){a=a.replace(/\{\$([^}]+)}/g,function(c,d){return d in b?b[d]:c})}return a};goog.getMsgWithFallback=function(d,c){return d};goog.exportSymbol=function(b,a,c){goog.exportPath_(b,a,c)};goog.exportProperty=function(b,a,c){b[a]=c};goog.inherits=function(b,a){function c(){}c.prototype=a.prototype;b.superClass_=a.prototype;b.prototype=new c();b.prototype.constructor=b;b.base=function(g,d,h){var e=new Array(arguments.length-2);for(var f=2;f<arguments.length;f++){e[f-2]=arguments[f]}return a.prototype[d].apply(g,e)}};goog.base=function(g,c,j){var a=arguments.callee.caller;if(goog.STRICT_MODE_COMPATIBLE||(goog.DEBUG&&!a)){throw Error("arguments.caller not defined.  goog.base() cannot be used with strict mode code. See http://www.ecma-international.org/ecma-262/5.1/#sec-C")}if(a.superClass_){var b=new Array(arguments.length-1);for(var e=1;e<arguments.length;e++){b[e-1]=arguments[e]}return a.superClass_.constructor.apply(g,b)}var f=new Array(arguments.length-2);for(var e=2;e<arguments.length;e++){f[e-2]=arguments[e]}var d=false;for(var h=g.constructor;h;h=h.superClass_&&h.superClass_.constructor){if(h.prototype[c]===a){d=true}else{if(d){return h.prototype[c].apply(g,f)}}}if(g[c]===a){return g.constructor.prototype[c].apply(g,f)}else{throw Error("goog.base called from a method of one name to a method of a different name")}};goog.scope=function(a){a.call(goog.global)};if(!COMPILED){goog.global.COMPILED=COMPILED}goog.defineClass=function(c,d){var b=d.constructor;var e=d.statics;if(!b||b==Object.prototype.constructor){b=function(){throw Error("cannot instantiate an interface (no constructor defined).")}}var a=goog.defineClass.createSealingConstructor_(b,c);if(c){goog.inherits(a,c)}delete d.constructor;delete d.statics;goog.defineClass.applyProperties_(a.prototype,d);if(e!=null){if(e instanceof Function){e(a)}else{goog.defineClass.applyProperties_(a,e)}}return a};goog.defineClass.ClassDescriptor;goog.define("goog.defineClass.SEAL_CLASS_INSTANCES",goog.DEBUG);goog.defineClass.createSealingConstructor_=function(c,b){if(goog.defineClass.SEAL_CLASS_INSTANCES&&Object.seal instanceof Function){if(b&&b.prototype&&b.prototype[goog.UNSEALABLE_CONSTRUCTOR_PROPERTY_]){return c}var a=function(){var d=c.apply(this,arguments)||this;d[goog.UID_PROPERTY_]=d[goog.UID_PROPERTY_];if(this.constructor===a){Object.seal(d)}return d};return a}return c};goog.defineClass.OBJECT_PROTOTYPE_FIELDS_=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"];goog.defineClass.applyProperties_=function(d,c){var b;for(b in c){if(Object.prototype.hasOwnProperty.call(c,b)){d[b]=c[b]}}for(var a=0;a<goog.defineClass.OBJECT_PROTOTYPE_FIELDS_.length;a++){b=goog.defineClass.OBJECT_PROTOTYPE_FIELDS_[a];if(Object.prototype.hasOwnProperty.call(c,b)){d[b]=c[b]}}};goog.tagUnsealableClass=function(a){if(!COMPILED&&goog.defineClass.SEAL_CLASS_INSTANCES){a.prototype[goog.UNSEALABLE_CONSTRUCTOR_PROPERTY_]=true}};goog.UNSEALABLE_CONSTRUCTOR_PROPERTY_="goog_defineClass_legacy_unsealable";goog.provide("goog.object");goog.object.forEach=function(d,c,b){for(var a in d){c.call(b,d[a],a,d)}};goog.object.filter=function(e,d,c){var b={};for(var a in e){if(d.call(c,e[a],a,e)){b[a]=e[a]}}return b};goog.object.map=function(e,d,c){var b={};for(var a in e){b[a]=d.call(c,e[a],a,e)}return b};goog.object.some=function(d,c,b){for(var a in d){if(c.call(b,d[a],a,d)){return true}}return false};goog.object.every=function(d,c,b){for(var a in d){if(!c.call(b,d[a],a,d)){return false}}return true};goog.object.getCount=function(b){var c=0;for(var a in b){c++}return c};goog.object.getAnyKey=function(b){for(var a in b){return a}};goog.object.getAnyValue=function(b){for(var a in b){return b[a]}};goog.object.contains=function(a,b){return goog.object.containsValue(a,b)};goog.object.getValues=function(d){var c=[];var b=0;for(var a in d){c[b++]=d[a]}return c};goog.object.getKeys=function(d){var c=[];var b=0;for(var a in d){c[b++]=a}return c};goog.object.getValueByKeys=function(d,e){var a=goog.isArrayLike(e);var c=a?e:arguments;for(var b=a?0:1;b<c.length;b++){d=d[c[b]];if(!goog.isDef(d)){break}}return d};goog.object.containsKey=function(b,a){return a in b};goog.object.containsValue=function(b,c){for(var a in b){if(b[a]==c){return true}}return false};goog.object.findKey=function(d,c,b){for(var a in d){if(c.call(b,d[a],a,d)){return a}}return undefined};goog.object.findValue=function(d,c,b){var a=goog.object.findKey(d,c,b);return a&&d[a]};goog.object.isEmpty=function(b){for(var a in b){return false}return true};goog.object.clear=function(b){for(var a in b){delete b[a]}};goog.object.remove=function(b,a){var c;if((c=a in b)){delete b[a]}return c};goog.object.add=function(b,a,c){if(a in b){throw Error('The object already contains the key "'+a+'"')}goog.object.set(b,a,c)};goog.object.get=function(c,a,b){if(a in c){return c[a]}return b};goog.object.set=function(c,a,b){c[a]=b};goog.object.setIfUndefined=function(c,a,b){return a in c?c[a]:(c[a]=b)};goog.object.setWithReturnValueIfNotSet=function(c,a,b){if(a in c){return c[a]}var d=b();c[a]=d;return d};goog.object.equals=function(d,c){for(var e in d){if(!(e in c)||d[e]!==c[e]){return false}}for(var e in c){if(!(e in d)){return false}}return true};goog.object.clone=function(c){var b={};for(var a in c){b[a]=c[a]}return b};goog.object.unsafeClone=function(c){var b=goog.typeOf(c);if(b=="object"||b=="array"){if(c.clone){return c.clone()}var d=b=="array"?[]:{};for(var a in c){d[a]=goog.object.unsafeClone(c[a])}return d}return c};goog.object.transpose=function(c){var b={};for(var a in c){b[c[a]]=a}return b};goog.object.PROTOTYPE_FIELDS_=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"];goog.object.extend=function(e,f){var c,d;for(var b=1;b<arguments.length;b++){d=arguments[b];for(c in d){e[c]=d[c]}for(var a=0;a<goog.object.PROTOTYPE_FIELDS_.length;a++){c=goog.object.PROTOTYPE_FIELDS_[a];if(Object.prototype.hasOwnProperty.call(d,c)){e[c]=d[c]}}}};goog.object.create=function(b){var d=arguments.length;if(d==1&&goog.isArray(arguments[0])){return goog.object.create.apply(null,arguments[0])}if(d%2){throw Error("Uneven number of arguments")}var c={};for(var a=0;a<d;a+=2){c[arguments[a]]=arguments[a+1]}return c};goog.object.createSet=function(b){var d=arguments.length;if(d==1&&goog.isArray(arguments[0])){return goog.object.createSet.apply(null,arguments[0])}var c={};for(var a=0;a<d;a++){c[arguments[a]]=true}return c};goog.object.createImmutableView=function(b){var a=b;if(Object.isFrozen&&!Object.isFrozen(b)){a=Object.create(b);Object.freeze(a)}return a};goog.object.isImmutableView=function(a){return !!Object.isFrozen&&Object.isFrozen(a)};goog.provide("goog.string");goog.provide("goog.string.Unicode");goog.define("goog.string.DETECT_DOUBLE_ESCAPING",false);goog.define("goog.string.FORCE_NON_DOM_HTML_UNESCAPING",false);goog.string.Unicode={NBSP:"\xa0"};goog.string.startsWith=function(b,a){return b.lastIndexOf(a,0)==0};goog.string.endsWith=function(c,b){var a=c.length-b.length;return a>=0&&c.indexOf(b,a)==a};goog.string.caseInsensitiveStartsWith=function(b,a){return goog.string.caseInsensitiveCompare(a,b.substr(0,a.length))==0};goog.string.caseInsensitiveEndsWith=function(b,a){return goog.string.caseInsensitiveCompare(a,b.substr(b.length-a.length,a.length))==0};goog.string.caseInsensitiveEquals=function(b,a){return b.toLowerCase()==a.toLowerCase()};goog.string.subs=function(e,d){var b=e.split("%s");var a="";var c=Array.prototype.slice.call(arguments,1);while(c.length&&b.length>1){a+=b.shift()+c.shift()}return a+b.join("%s")};goog.string.collapseWhitespace=function(a){return a.replace(/[\s\xa0]+/g," ").replace(/^\s+|\s+$/g,"")};goog.string.isEmptyOrWhitespace=function(a){return/^[\s\xa0]*$/.test(a)};goog.string.isEmptyString=function(a){return a.length==0};goog.string.isEmpty=goog.string.isEmptyOrWhitespace;goog.string.isEmptyOrWhitespaceSafe=function(a){return goog.string.isEmptyOrWhitespace(goog.string.makeSafe(a))};goog.string.isEmptySafe=goog.string.isEmptyOrWhitespaceSafe;goog.string.isBreakingWhitespace=function(a){return !/[^\t\n\r ]/.test(a)};goog.string.isAlpha=function(a){return !/[^a-zA-Z]/.test(a)};goog.string.isNumeric=function(a){return !/[^0-9]/.test(a)};goog.string.isAlphaNumeric=function(a){return !/[^a-zA-Z0-9]/.test(a)};goog.string.isSpace=function(a){return a==" "};goog.string.isUnicodeChar=function(a){return a.length==1&&a>=" "&&a<="~"||a>="\u0080"&&a<="\uFFFD"};goog.string.stripNewlines=function(a){return a.replace(/(\r\n|\r|\n)+/g," ")};goog.string.canonicalizeNewlines=function(a){return a.replace(/(\r\n|\r|\n)/g,"\n")};goog.string.normalizeWhitespace=function(a){return a.replace(/\xa0|\s/g," ")};goog.string.normalizeSpaces=function(a){return a.replace(/\xa0|[ \t]+/g," ")};goog.string.collapseBreakingSpaces=function(a){return a.replace(/[\t\r\n ]+/g," ").replace(/^[\t\r\n ]+|[\t\r\n ]+$/g,"")};goog.string.trim=(goog.TRUSTED_SITE&&String.prototype.trim)?function(a){return a.trim()}:function(a){return a.replace(/^[\s\xa0]+|[\s\xa0]+$/g,"")};goog.string.trimLeft=function(a){return a.replace(/^[\s\xa0]+/,"")};goog.string.trimRight=function(a){return a.replace(/[\s\xa0]+$/,"")};goog.string.caseInsensitiveCompare=function(d,c){var b=String(d).toLowerCase();var a=String(c).toLowerCase();if(b<a){return -1}else{if(b==a){return 0}else{return 1}}};goog.string.numerateCompareRegExp_=/(\.\d+)|(\d+)|(\D+)/g;goog.string.numerateCompare=function(f,e){if(f==e){return 0}if(!f){return -1}if(!e){return 1}var d=f.toLowerCase().match(goog.string.numerateCompareRegExp_);var c=e.toLowerCase().match(goog.string.numerateCompareRegExp_);var h=Math.min(d.length,c.length);for(var g=0;g<h;g++){var m=d[g];var l=c[g];if(m!=l){var k=parseInt(m,10);if(!isNaN(k)){var j=parseInt(l,10);if(!isNaN(j)&&k-j){return k-j}}return m<l?-1:1}}if(d.length!=c.length){return d.length-c.length}return f<e?-1:1};goog.string.urlEncode=function(a){return encodeURIComponent(String(a))};goog.string.urlDecode=function(a){return decodeURIComponent(a.replace(/\+/g," "))};goog.string.newLineToBr=function(b,a){return b.replace(/(\r\n|\r|\n)/g,a?"<br />":"<br>")};goog.string.htmlEscape=function(b,a){if(a){b=b.replace(goog.string.AMP_RE_,"&amp;").replace(goog.string.LT_RE_,"&lt;").replace(goog.string.GT_RE_,"&gt;").replace(goog.string.QUOT_RE_,"&quot;").replace(goog.string.SINGLE_QUOTE_RE_,"&#39;").replace(goog.string.NULL_RE_,"&#0;");if(goog.string.DETECT_DOUBLE_ESCAPING){b=b.replace(goog.string.E_RE_,"&#101;")}return b}else{if(!goog.string.ALL_RE_.test(b)){return b}if(b.indexOf("&")!=-1){b=b.replace(goog.string.AMP_RE_,"&amp;")}if(b.indexOf("<")!=-1){b=b.replace(goog.string.LT_RE_,"&lt;")}if(b.indexOf(">")!=-1){b=b.replace(goog.string.GT_RE_,"&gt;")}if(b.indexOf('"')!=-1){b=b.replace(goog.string.QUOT_RE_,"&quot;")}if(b.indexOf("'")!=-1){b=b.replace(goog.string.SINGLE_QUOTE_RE_,"&#39;")}if(b.indexOf("\x00")!=-1){b=b.replace(goog.string.NULL_RE_,"&#0;")}if(goog.string.DETECT_DOUBLE_ESCAPING&&b.indexOf("e")!=-1){b=b.replace(goog.string.E_RE_,"&#101;")}return b}};goog.string.AMP_RE_=/&/g;goog.string.LT_RE_=/</g;goog.string.GT_RE_=/>/g;goog.string.QUOT_RE_=/"/g;goog.string.SINGLE_QUOTE_RE_=/'/g;goog.string.NULL_RE_=/\x00/g;goog.string.E_RE_=/e/g;goog.string.ALL_RE_=(goog.string.DETECT_DOUBLE_ESCAPING?/[\x00&<>"'e]/:/[\x00&<>"']/);goog.string.unescapeEntities=function(a){if(goog.string.contains(a,"&")){if(!goog.string.FORCE_NON_DOM_HTML_UNESCAPING&&"document" in goog.global){return goog.string.unescapeEntitiesUsingDom_(a)}else{return goog.string.unescapePureXmlEntities_(a)}}return a};goog.string.unescapeEntitiesWithDocument=function(b,a){if(goog.string.contains(b,"&")){return goog.string.unescapeEntitiesUsingDom_(b,a)}return b};goog.string.unescapeEntitiesUsingDom_=function(c,a){var b={"&amp;":"&","&lt;":"<","&gt;":">","&quot;":'"'};var d;if(a){d=a.createElement("div")}else{d=goog.global.document.createElement("div")}return c.replace(goog.string.HTML_ENTITY_PATTERN_,function(f,e){var g=b[f];if(g){return g}if(e.charAt(0)=="#"){var h=Number("0"+e.substr(1));if(!isNaN(h)){g=String.fromCharCode(h)}}if(!g){d.innerHTML=f+" ";g=d.firstChild.nodeValue.slice(0,-1)}return b[f]=g})};goog.string.unescapePureXmlEntities_=function(a){return a.replace(/&([^;]+);/g,function(c,b){switch(b){case"amp":return"&";case"lt":return"<";case"gt":return">";case"quot":return'"';default:if(b.charAt(0)=="#"){var d=Number("0"+b.substr(1));if(!isNaN(d)){return String.fromCharCode(d)}}return c}})};goog.string.HTML_ENTITY_PATTERN_=/&([^;\s<&]+);?/g;goog.string.whitespaceEscape=function(b,a){return goog.string.newLineToBr(b.replace(/  /g," &#160;"),a)};goog.string.preserveSpaces=function(a){return a.replace(/(^|[\n ]) /g,"$1"+goog.string.Unicode.NBSP)};goog.string.stripQuotes=function(e,a){var d=a.length;for(var c=0;c<d;c++){var b=d==1?a:a.charAt(c);if(e.charAt(0)==b&&e.charAt(e.length-1)==b){return e.substring(1,e.length-1)}}return e};goog.string.truncate=function(c,b,a){if(a){c=goog.string.unescapeEntities(c)}if(c.length>b){c=c.substring(0,b-3)+"..."}if(a){c=goog.string.htmlEscape(c)}return c};goog.string.truncateMiddle=function(h,f,e,a){if(e){h=goog.string.unescapeEntities(h)}if(a&&h.length>f){if(a>f){a=f}var c=h.length-a;var d=f-a;h=h.substring(0,d)+"..."+h.substring(c)}else{if(h.length>f){var g=Math.floor(f/2);var b=h.length-g;g+=f%2;h=h.substring(0,g)+"..."+h.substring(b)}}if(e){h=goog.string.htmlEscape(h)}return h};goog.string.specialEscapeChars_={"\0":"\\0","\b":"\\b","\f":"\\f","\n":"\\n","\r":"\\r","\t":"\\t","\x0B":"\\x0B",'"':'\\"',"\\":"\\\\"};goog.string.jsEscapeCache_={"'":"\\'"};goog.string.quote=function(c){c=String(c);if(c.quote){return c.quote()}else{var e=['"'];for(var a=0;a<c.length;a++){var b=c.charAt(a);var d=b.charCodeAt(0);e[a+1]=goog.string.specialEscapeChars_[b]||((d>31&&d<127)?b:goog.string.escapeChar(b))}e.push('"');return e.join("")}};goog.string.escapeString=function(b){var c=[];for(var a=0;a<b.length;a++){c[a]=goog.string.escapeChar(b.charAt(a))}return c.join("")};goog.string.escapeChar=function(d){if(d in goog.string.jsEscapeCache_){return goog.string.jsEscapeCache_[d]}if(d in goog.string.specialEscapeChars_){return goog.string.jsEscapeCache_[d]=goog.string.specialEscapeChars_[d]}var b=d;var a=d.charCodeAt(0);if(a>31&&a<127){b=d}else{if(a<256){b="\\x";if(a<16||a>256){b+="0"}}else{b="\\u";if(a<4096){b+="0"}}b+=a.toString(16).toUpperCase()}return goog.string.jsEscapeCache_[d]=b};goog.string.contains=function(b,a){return b.indexOf(a)!=-1};goog.string.caseInsensitiveContains=function(b,a){return goog.string.contains(b.toLowerCase(),a.toLowerCase())};goog.string.countOf=function(b,a){return b&&a?b.split(a).length-1:0};goog.string.removeAt=function(d,b,a){var c=d;if(b>=0&&b<d.length&&a>0){c=d.substr(0,b)+d.substr(b+a,d.length-b-a)}return c};goog.string.remove=function(c,a){var b=new RegExp(goog.string.regExpEscape(a),"");return c.replace(b,"")};goog.string.removeAll=function(c,a){var b=new RegExp(goog.string.regExpEscape(a),"g");return c.replace(b,"")};goog.string.regExpEscape=function(a){return String(a).replace(/([-()\[\]{}+?*.$\^|,:#<!\\])/g,"\\$1").replace(/\x08/g,"\\x08")};goog.string.repeat=function(a,b){return new Array(b+1).join(a)};goog.string.padNumber=function(c,e,a){var d=goog.isDef(a)?c.toFixed(a):String(c);var b=d.indexOf(".");if(b==-1){b=d.length}return goog.string.repeat("0",Math.max(0,e-b))+d};goog.string.makeSafe=function(a){return a==null?"":String(a)};goog.string.buildString=function(a){return Array.prototype.join.call(arguments,"")};goog.string.getRandomString=function(){var a=2147483648;return Math.floor(Math.random()*a).toString(36)+Math.abs(Math.floor(Math.random()*a)^goog.now()).toString(36)};goog.string.compareVersions=function(b,o){var c=0;var j=goog.string.trim(String(b)).split(".");var i=goog.string.trim(String(o)).split(".");var f=Math.max(j.length,i.length);for(var g=0;c==0&&g<f;g++){var a=j[g]||"";var n=i[g]||"";var k=new RegExp("(\\d*)(\\D*)","g");var e=new RegExp("(\\d*)(\\D*)","g");do{var m=k.exec(a)||["","",""];var l=e.exec(n)||["","",""];if(m[0].length==0&&l[0].length==0){break}var h=m[1].length==0?0:parseInt(m[1],10);var d=l[1].length==0?0:parseInt(l[1],10);c=goog.string.compareElements_(h,d)||goog.string.compareElements_(m[2].length==0,l[2].length==0)||goog.string.compareElements_(m[2],l[2])}while(c==0)}return c};goog.string.compareElements_=function(b,a){if(b<a){return -1}else{if(b>a){return 1}}return 0};goog.string.HASHCODE_MAX_=4294967296;goog.string.hashCode=function(c){var a=0;for(var b=0;b<c.length;++b){a=31*a+c.charCodeAt(b);a%=goog.string.HASHCODE_MAX_}return a};goog.string.uniqueStringCounter_=Math.random()*2147483648|0;goog.string.createUniqueString=function(){return"goog_"+goog.string.uniqueStringCounter_++};goog.string.toNumber=function(b){var a=Number(b);if(a==0&&goog.string.isEmptyOrWhitespace(b)){return NaN}return a};goog.string.isLowerCamelCase=function(a){return/^[a-z]+([A-Z][a-z]*)*$/.test(a)};goog.string.isUpperCamelCase=function(a){return/^([A-Z][a-z]*)+$/.test(a)};goog.string.toCamelCase=function(a){return String(a).replace(/\-([a-z])/g,function(c,b){return b.toUpperCase()})};goog.string.toSelectorCase=function(a){return String(a).replace(/([A-Z])/g,"-$1").toLowerCase()};goog.string.toTitleCase=function(d,b){var c=goog.isString(b)?goog.string.regExpEscape(b):"\\s";c=c?"|["+c+"]+":"";var a=new RegExp("(^"+c+")([a-z])","g");return d.replace(a,function(e,g,f){return g+f.toUpperCase()})};goog.string.capitalize=function(a){return String(a.charAt(0)).toUpperCase()+String(a.substr(1)).toLowerCase()};goog.string.parseInt=function(a){if(isFinite(a)){a=String(a)}if(goog.isString(a)){return/^\s*-?0x/i.test(a)?parseInt(a,16):parseInt(a,10)}return NaN};goog.string.splitLimit=function(e,d,a){var c=e.split(d);var b=[];while(a>0&&c.length){b.push(c.shift());a--}if(c.length){b.push(c.join(d))}return b};goog.string.editDistance=function(e,d){var c=[];var k=[];if(e==d){return 0}if(!e.length||!d.length){return Math.max(e.length,d.length)}for(var g=0;g<d.length+1;g++){c[g]=g}for(var g=0;g<e.length;g++){k[0]=g+1;for(var f=0;f<d.length;f++){var h=e[g]!=d[f];k[f+1]=Math.min(k[f]+1,c[f+1]+1,c[f]+h)}for(var f=0;f<c.length;f++){c[f]=k[f]}}return k[d.length]};goog.provide("goog.labs.userAgent.util");goog.require("goog.string");goog.labs.userAgent.util.getNativeUserAgentString_=function(){var a=goog.labs.userAgent.util.getNavigator_();if(a){var b=a.userAgent;if(b){return b}}return""};goog.labs.userAgent.util.getNavigator_=function(){return goog.global.navigator};goog.labs.userAgent.util.userAgent_=goog.labs.userAgent.util.getNativeUserAgentString_();goog.labs.userAgent.util.setUserAgent=function(a){goog.labs.userAgent.util.userAgent_=a||goog.labs.userAgent.util.getNativeUserAgentString_()};goog.labs.userAgent.util.getUserAgent=function(){return goog.labs.userAgent.util.userAgent_};goog.labs.userAgent.util.matchUserAgent=function(b){var a=goog.labs.userAgent.util.getUserAgent();return goog.string.contains(a,b)};goog.labs.userAgent.util.matchUserAgentIgnoreCase=function(b){var a=goog.labs.userAgent.util.getUserAgent();return goog.string.caseInsensitiveContains(a,b)};goog.labs.userAgent.util.extractVersionTuples=function(d){var a=new RegExp("(\\w[\\w ]+)/([^\\s]+)\\s*(?:\\((.*?)\\))?","g");var c=[];var b;while(b=a.exec(d)){c.push([b[1],b[2],b[3]||undefined])}return c};goog.provide("goog.labs.userAgent.platform");goog.require("goog.labs.userAgent.util");goog.require("goog.string");goog.labs.userAgent.platform.isAndroid=function(){return goog.labs.userAgent.util.matchUserAgent("Android")};goog.labs.userAgent.platform.isIpod=function(){return goog.labs.userAgent.util.matchUserAgent("iPod")};goog.labs.userAgent.platform.isIphone=function(){return goog.labs.userAgent.util.matchUserAgent("iPhone")&&!goog.labs.userAgent.util.matchUserAgent("iPod")&&!goog.labs.userAgent.util.matchUserAgent("iPad")};goog.labs.userAgent.platform.isIpad=function(){return goog.labs.userAgent.util.matchUserAgent("iPad")};goog.labs.userAgent.platform.isIos=function(){return goog.labs.userAgent.platform.isIphone()||goog.labs.userAgent.platform.isIpad()||goog.labs.userAgent.platform.isIpod()};goog.labs.userAgent.platform.isMacintosh=function(){return goog.labs.userAgent.util.matchUserAgent("Macintosh")};goog.labs.userAgent.platform.isLinux=function(){return goog.labs.userAgent.util.matchUserAgent("Linux")};goog.labs.userAgent.platform.isWindows=function(){return goog.labs.userAgent.util.matchUserAgent("Windows")};goog.labs.userAgent.platform.isChromeOS=function(){return goog.labs.userAgent.util.matchUserAgent("CrOS")};goog.labs.userAgent.platform.getVersion=function(){var d=goog.labs.userAgent.util.getUserAgent();var a="",c;if(goog.labs.userAgent.platform.isWindows()){c=/Windows (?:NT|Phone) ([0-9.]+)/;var b=c.exec(d);if(b){a=b[1]}else{a="0.0"}}else{if(goog.labs.userAgent.platform.isIos()){c=/(?:iPhone|iPod|iPad|CPU)\s+OS\s+(\S+)/;var b=c.exec(d);a=b&&b[1].replace(/_/g,".")}else{if(goog.labs.userAgent.platform.isMacintosh()){c=/Mac OS X ([0-9_.]+)/;var b=c.exec(d);a=b?b[1].replace(/_/g,"."):"10"}else{if(goog.labs.userAgent.platform.isAndroid()){c=/Android\s+([^\);]+)(\)|;)/;var b=c.exec(d);a=b&&b[1]}else{if(goog.labs.userAgent.platform.isChromeOS()){c=/(?:CrOS\s+(?:i686|x86_64)\s+([0-9.]+))/;var b=c.exec(d);a=b&&b[1]}}}}}return a||""};goog.labs.userAgent.platform.isVersionOrHigher=function(a){return goog.string.compareVersions(goog.labs.userAgent.platform.getVersion(),a)>=0};goog.provide("goog.dom.NodeType");goog.dom.NodeType={ELEMENT:1,ATTRIBUTE:2,TEXT:3,CDATA_SECTION:4,ENTITY_REFERENCE:5,ENTITY:6,PROCESSING_INSTRUCTION:7,COMMENT:8,DOCUMENT:9,DOCUMENT_TYPE:10,DOCUMENT_FRAGMENT:11,NOTATION:12};goog.provide("goog.debug.Error");goog.debug.Error=function(b){if(Error.captureStackTrace){Error.captureStackTrace(this,goog.debug.Error)}else{var a=new Error().stack;if(a){this.stack=a}}if(b){this.message=String(b)}};goog.inherits(goog.debug.Error,Error);goog.debug.Error.prototype.name="CustomError";goog.provide("goog.asserts");goog.provide("goog.asserts.AssertionError");goog.require("goog.debug.Error");goog.require("goog.dom.NodeType");goog.require("goog.string");goog.define("goog.asserts.ENABLE_ASSERTS",goog.DEBUG);goog.asserts.AssertionError=function(b,a){a.unshift(b);goog.debug.Error.call(this,goog.string.subs.apply(null,a));a.shift();this.messagePattern=b};goog.inherits(goog.asserts.AssertionError,goog.debug.Error);goog.asserts.AssertionError.prototype.name="AssertionError";goog.asserts.DEFAULT_ERROR_HANDLER=function(a){throw a};goog.asserts.errorHandler_=goog.asserts.DEFAULT_ERROR_HANDLER;goog.asserts.doAssertFailure_=function(c,h,d,b){var f="Assertion failed";if(d){f+=": "+d;var a=b}else{if(c){f+=": "+c;a=h}}var g=new goog.asserts.AssertionError(""+f,a||[]);goog.asserts.errorHandler_(g)};goog.asserts.setErrorHandler=function(a){if(goog.asserts.ENABLE_ASSERTS){goog.asserts.errorHandler_=a}};goog.asserts.assert=function(c,b,a){if(goog.asserts.ENABLE_ASSERTS&&!c){goog.asserts.doAssertFailure_("",null,b,Array.prototype.slice.call(arguments,2))}return c};goog.asserts.fail=function(b,a){if(goog.asserts.ENABLE_ASSERTS){goog.asserts.errorHandler_(new goog.asserts.AssertionError("Failure"+(b?": "+b:""),Array.prototype.slice.call(arguments,1)))}};goog.asserts.assertNumber=function(a,c,b){if(goog.asserts.ENABLE_ASSERTS&&!goog.isNumber(a)){goog.asserts.doAssertFailure_("Expected number but got %s: %s.",[goog.typeOf(a),a],c,Array.prototype.slice.call(arguments,2))}return(a)};goog.asserts.assertString=function(a,c,b){if(goog.asserts.ENABLE_ASSERTS&&!goog.isString(a)){goog.asserts.doAssertFailure_("Expected string but got %s: %s.",[goog.typeOf(a),a],c,Array.prototype.slice.call(arguments,2))}return(a)};goog.asserts.assertFunction=function(a,c,b){if(goog.asserts.ENABLE_ASSERTS&&!goog.isFunction(a)){goog.asserts.doAssertFailure_("Expected function but got %s: %s.",[goog.typeOf(a),a],c,Array.prototype.slice.call(arguments,2))}return(a)};goog.asserts.assertObject=function(a,c,b){if(goog.asserts.ENABLE_ASSERTS&&!goog.isObject(a)){goog.asserts.doAssertFailure_("Expected object but got %s: %s.",[goog.typeOf(a),a],c,Array.prototype.slice.call(arguments,2))}return(a)};goog.asserts.assertArray=function(a,c,b){if(goog.asserts.ENABLE_ASSERTS&&!goog.isArray(a)){goog.asserts.doAssertFailure_("Expected array but got %s: %s.",[goog.typeOf(a),a],c,Array.prototype.slice.call(arguments,2))}return(a)};goog.asserts.assertBoolean=function(a,c,b){if(goog.asserts.ENABLE_ASSERTS&&!goog.isBoolean(a)){goog.asserts.doAssertFailure_("Expected boolean but got %s: %s.",[goog.typeOf(a),a],c,Array.prototype.slice.call(arguments,2))}return(a)};goog.asserts.assertElement=function(a,c,b){if(goog.asserts.ENABLE_ASSERTS&&(!goog.isObject(a)||a.nodeType!=goog.dom.NodeType.ELEMENT)){goog.asserts.doAssertFailure_("Expected Element but got %s: %s.",[goog.typeOf(a),a],c,Array.prototype.slice.call(arguments,2))}return(a)};goog.asserts.assertInstanceof=function(b,a,d,c){if(goog.asserts.ENABLE_ASSERTS&&!(b instanceof a)){goog.asserts.doAssertFailure_("Expected instanceof %s but got %s.",[goog.asserts.getType_(a),goog.asserts.getType_(b)],d,Array.prototype.slice.call(arguments,3))}return b};goog.asserts.assertObjectPrototypeIsIntact=function(){for(var a in Object.prototype){goog.asserts.fail(a+" should not be enumerable in Object.prototype.")}};goog.asserts.getType_=function(a){if(a instanceof Function){return a.displayName||a.name||"unknown type name"}else{if(a instanceof Object){return a.constructor.displayName||a.constructor.name||Object.prototype.toString.call(a)}else{return a===null?"null":typeof a}}};goog.provide("goog.array");goog.provide("goog.array.ArrayLike");goog.require("goog.asserts");goog.define("goog.NATIVE_ARRAY_PROTOTYPES",goog.TRUSTED_SITE);goog.define("goog.array.ASSUME_NATIVE_FUNCTIONS",false);goog.array.ArrayLike;goog.array.peek=function(a){return a[a.length-1]};goog.array.last=goog.array.peek;goog.array.ARRAY_PROTOTYPE_=Array.prototype;goog.array.indexOf=goog.NATIVE_ARRAY_PROTOTYPES&&(goog.array.ASSUME_NATIVE_FUNCTIONS||goog.array.ARRAY_PROTOTYPE_.indexOf)?function(a,c,b){goog.asserts.assert(a.length!=null);return goog.array.ARRAY_PROTOTYPE_.indexOf.call(a,c,b)}:function(a,e,b){var d=b==null?0:(b<0?Math.max(0,a.length+b):b);if(goog.isString(a)){if(!goog.isString(e)||e.length!=1){return -1}return a.indexOf(e,d)}for(var c=d;c<a.length;c++){if(c in a&&a[c]===e){return c}}return -1};goog.array.lastIndexOf=goog.NATIVE_ARRAY_PROTOTYPES&&(goog.array.ASSUME_NATIVE_FUNCTIONS||goog.array.ARRAY_PROTOTYPE_.lastIndexOf)?function(a,d,b){goog.asserts.assert(a.length!=null);var c=b==null?a.length-1:b;return goog.array.ARRAY_PROTOTYPE_.lastIndexOf.call(a,d,c)}:function(a,e,b){var d=b==null?a.length-1:b;if(d<0){d=Math.max(0,a.length+d)}if(goog.isString(a)){if(!goog.isString(e)||e.length!=1){return -1}return a.lastIndexOf(e,d)}for(var c=d;c>=0;c--){if(c in a&&a[c]===e){return c}}return -1};goog.array.forEach=goog.NATIVE_ARRAY_PROTOTYPES&&(goog.array.ASSUME_NATIVE_FUNCTIONS||goog.array.ARRAY_PROTOTYPE_.forEach)?function(a,c,b){goog.asserts.assert(a.length!=null);goog.array.ARRAY_PROTOTYPE_.forEach.call(a,c,b)}:function(a,g,e){var b=a.length;var c=goog.isString(a)?a.split(""):a;for(var d=0;d<b;d++){if(d in c){g.call(e,c[d],d,a)}}};goog.array.forEachRight=function(a,g,e){var b=a.length;var c=goog.isString(a)?a.split(""):a;for(var d=b-1;d>=0;--d){if(d in c){g.call(e,c[d],d,a)}}};goog.array.filter=goog.NATIVE_ARRAY_PROTOTYPES&&(goog.array.ASSUME_NATIVE_FUNCTIONS||goog.array.ARRAY_PROTOTYPE_.filter)?function(a,c,b){goog.asserts.assert(a.length!=null);return goog.array.ARRAY_PROTOTYPE_.filter.call(a,c,b)}:function(e,g,a){var c=e.length;var h=[];var k=0;var j=goog.isString(e)?e.split(""):e;for(var d=0;d<c;d++){if(d in j){var b=j[d];if(g.call(a,b,d,e)){h[k++]=b}}}return h};goog.array.map=goog.NATIVE_ARRAY_PROTOTYPES&&(goog.array.ASSUME_NATIVE_FUNCTIONS||goog.array.ARRAY_PROTOTYPE_.map)?function(a,c,b){goog.asserts.assert(a.length!=null);return goog.array.ARRAY_PROTOTYPE_.map.call(a,c,b)}:function(a,h,g){var b=a.length;var e=new Array(b);var c=goog.isString(a)?a.split(""):a;for(var d=0;d<b;d++){if(d in c){e[d]=h.call(g,c[d],d,a)}}return e};goog.array.reduce=goog.NATIVE_ARRAY_PROTOTYPES&&(goog.array.ASSUME_NATIVE_FUNCTIONS||goog.array.ARRAY_PROTOTYPE_.reduce)?function(a,c,d,b){goog.asserts.assert(a.length!=null);if(b){c=goog.bind(c,b)}return goog.array.ARRAY_PROTOTYPE_.reduce.call(a,c,d)}:function(a,c,e,b){var d=e;goog.array.forEach(a,function(g,f){d=c.call(b,d,g,f,a)});return d};goog.array.reduceRight=goog.NATIVE_ARRAY_PROTOTYPES&&(goog.array.ASSUME_NATIVE_FUNCTIONS||goog.array.ARRAY_PROTOTYPE_.reduceRight)?function(a,c,d,b){goog.asserts.assert(a.length!=null);if(b){c=goog.bind(c,b)}return goog.array.ARRAY_PROTOTYPE_.reduceRight.call(a,c,d)}:function(a,c,e,b){var d=e;goog.array.forEachRight(a,function(g,f){d=c.call(b,d,g,f,a)});return d};goog.array.some=goog.NATIVE_ARRAY_PROTOTYPES&&(goog.array.ASSUME_NATIVE_FUNCTIONS||goog.array.ARRAY_PROTOTYPE_.some)?function(a,c,b){goog.asserts.assert(a.length!=null);return goog.array.ARRAY_PROTOTYPE_.some.call(a,c,b)}:function(a,g,e){var b=a.length;var c=goog.isString(a)?a.split(""):a;for(var d=0;d<b;d++){if(d in c&&g.call(e,c[d],d,a)){return true}}return false};goog.array.every=goog.NATIVE_ARRAY_PROTOTYPES&&(goog.array.ASSUME_NATIVE_FUNCTIONS||goog.array.ARRAY_PROTOTYPE_.every)?function(a,c,b){goog.asserts.assert(a.length!=null);return goog.array.ARRAY_PROTOTYPE_.every.call(a,c,b)}:function(a,g,e){var b=a.length;var c=goog.isString(a)?a.split(""):a;for(var d=0;d<b;d++){if(d in c&&!g.call(e,c[d],d,a)){return false}}return true};goog.array.count=function(a,d,c){var b=0;goog.array.forEach(a,function(g,f,e){if(d.call(c,g,f,e)){++b}},c);return b};goog.array.find=function(a,d,c){var b=goog.array.findIndex(a,d,c);return b<0?null:goog.isString(a)?a.charAt(b):a[b]};goog.array.findIndex=function(a,g,e){var b=a.length;var c=goog.isString(a)?a.split(""):a;for(var d=0;d<b;d++){if(d in c&&g.call(e,c[d],d,a)){return d}}return -1};goog.array.findRight=function(a,d,c){var b=goog.array.findIndexRight(a,d,c);return b<0?null:goog.isString(a)?a.charAt(b):a[b]};goog.array.findIndexRight=function(a,g,e){var b=a.length;var c=goog.isString(a)?a.split(""):a;for(var d=b-1;d>=0;d--){if(d in c&&g.call(e,c[d],d,a)){return d}}return -1};goog.array.contains=function(a,b){return goog.array.indexOf(a,b)>=0};goog.array.isEmpty=function(a){return a.length==0};goog.array.clear=function(a){if(!goog.isArray(a)){for(var b=a.length-1;b>=0;b--){delete a[b]}}a.length=0};goog.array.insert=function(a,b){if(!goog.array.contains(a,b)){a.push(b)}};goog.array.insertAt=function(a,c,b){goog.array.splice(a,b,0,c)};goog.array.insertArrayAt=function(a,b,c){goog.partial(goog.array.splice,a,c,0).apply(null,b)};goog.array.insertBefore=function(a,d,b){var c;if(arguments.length==2||(c=goog.array.indexOf(a,b))<0){a.push(d)}else{goog.array.insertAt(a,d,c)}};goog.array.remove=function(a,c){var b=goog.array.indexOf(a,c);var d;if((d=b>=0)){goog.array.removeAt(a,b)}return d};goog.array.removeAt=function(a,b){goog.asserts.assert(a.length!=null);return goog.array.ARRAY_PROTOTYPE_.splice.call(a,b,1).length==1};goog.array.removeIf=function(a,d,c){var b=goog.array.findIndex(a,d,c);if(b>=0){goog.array.removeAt(a,b);return true}return false};goog.array.removeAllIf=function(a,d,c){var b=0;goog.array.forEachRight(a,function(f,e){if(d.call(c,f,e,a)){if(goog.array.removeAt(a,e)){b++}}});return b};goog.array.concat=function(a){return goog.array.ARRAY_PROTOTYPE_.concat.apply(goog.array.ARRAY_PROTOTYPE_,arguments)};goog.array.join=function(a){return goog.array.ARRAY_PROTOTYPE_.concat.apply(goog.array.ARRAY_PROTOTYPE_,arguments)};goog.array.toArray=function(a){var c=a.length;if(c>0){var d=new Array(c);for(var b=0;b<c;b++){d[b]=a[b]}return d}return[]};goog.array.clone=goog.array.toArray;goog.array.extend=function(e,g){for(var f=1;f<arguments.length;f++){var b=arguments[f];if(goog.isArrayLike(b)){var d=e.length||0;var a=b.length||0;e.length=d+a;for(var c=0;c<a;c++){e[d+c]=b[c]}}else{e.push(b)}}};goog.array.splice=function(a,b,c,d){goog.asserts.assert(a.length!=null);return goog.array.ARRAY_PROTOTYPE_.splice.apply(a,goog.array.slice(arguments,1))};goog.array.slice=function(b,c,a){goog.asserts.assert(b.length!=null);if(arguments.length<=2){return goog.array.ARRAY_PROTOTYPE_.slice.call(b,c)}else{return goog.array.ARRAY_PROTOTYPE_.slice.call(b,c,a)}};goog.array.removeDuplicates=function(c,i,f){var h=i||c;var b=function(l){return goog.isObject(d)?"o"+goog.getUid(d):(typeof d).charAt(0)+d};var k=f||b;var a={},e=0,j=0;while(j<c.length){var d=c[j++];var g=k(d);if(!Object.prototype.hasOwnProperty.call(a,g)){a[g]=true;h[e++]=d}}h.length=e};goog.array.binarySearch=function(a,b,c){return goog.array.binarySearch_(a,c||goog.array.defaultCompare,false,b)};goog.array.binarySelect=function(a,c,b){return goog.array.binarySearch_(a,c,true,undefined,b)};goog.array.binarySearch_=function(f,b,d,e,j){var c=0;var g=f.length;var i;while(c<g){var h=(c+g)>>1;var a;if(d){a=b.call(j,f[h],h,f)}else{a=b(e,f[h])}if(a>0){c=h+1}else{g=h;i=!a}}return i?c:~c};goog.array.sort=function(a,b){a.sort(b||goog.array.defaultCompare)};goog.array.stableSort=function(a,e){for(var d=0;d<a.length;d++){a[d]={index:d,value:a[d]}}var c=e||goog.array.defaultCompare;function b(g,f){return c(g.value,f.value)||g.index-f.index}goog.array.sort(a,b);for(var d=0;d<a.length;d++){a[d]=a[d].value}};goog.array.sortByKey=function(a,c,d){var b=d||goog.array.defaultCompare;goog.array.sort(a,function(f,e){return b(c(f),c(e))})};goog.array.sortObjectsByKey=function(a,b,c){goog.array.sortByKey(a,function(d){return d[b]},c)};goog.array.isSorted=function(a,f,e){var d=f||goog.array.defaultCompare;for(var c=1;c<a.length;c++){var b=d(a[c-1],a[c]);if(b>0||b==0&&e){return false}}return true};goog.array.equals=function(c,b,f){if(!goog.isArrayLike(c)||!goog.isArrayLike(b)||c.length!=b.length){return false}var a=c.length;var e=f||goog.array.defaultCompareEquality;for(var d=0;d<a;d++){if(!e(c[d],b[d])){return false}}return true};goog.array.compare3=function(d,c,g){var f=g||goog.array.defaultCompare;var b=Math.min(d.length,c.length);for(var e=0;e<b;e++){var a=f(d[e],c[e]);if(a!=0){return a}}return goog.array.defaultCompare(d.length,c.length)};goog.array.defaultCompare=function(d,c){return d>c?1:d<c?-1:0};goog.array.inverseDefaultCompare=function(d,c){return -goog.array.defaultCompare(d,c)};goog.array.defaultCompareEquality=function(d,c){return d===c};goog.array.binaryInsert=function(d,b,c){var a=goog.array.binarySearch(d,b,c);if(a<0){goog.array.insertAt(d,b,-(a+1));return true}return false};goog.array.binaryRemove=function(d,b,c){var a=goog.array.binarySearch(d,b,c);return(a>=0)?goog.array.removeAt(d,a):false};goog.array.bucket=function(h,g,e){var c={};for(var b=0;b<h.length;b++){var d=h[b];var a=g.call(e,d,b,h);if(goog.isDef(a)){var f=c[a]||(c[a]=[]);f.push(d)}}return c};goog.array.toObject=function(a,d,c){var b={};goog.array.forEach(a,function(f,e){b[d.call(c,f,e,a)]=f});return b};goog.array.range=function(e,a,h){var g=[];var f=0;var b=e;var d=h||1;if(a!==undefined){f=e;b=a}if(d*(b-f)<0){return[]}if(d>0){for(var c=f;c<b;c+=d){g.push(c)}}else{for(var c=f;c>b;c+=d){g.push(c)}}return g};goog.array.repeat=function(b,d){var c=[];for(var a=0;a<d;a++){c[a]=b}return c};goog.array.flatten=function(j){var b=8192;var k=[];for(var d=0;d<arguments.length;d++){var e=arguments[d];if(goog.isArray(e)){for(var f=0;f<e.length;f+=b){var h=goog.array.slice(e,f,f+b);var g=goog.array.flatten.apply(null,h);for(var a=0;a<g.length;a++){k.push(g[a])}}}else{k.push(e)}}return k};goog.array.rotate=function(b,a){goog.asserts.assert(b.length!=null);if(b.length){a%=b.length;if(a>0){goog.array.ARRAY_PROTOTYPE_.unshift.apply(b,b.splice(-a,a))}else{if(a<0){goog.array.ARRAY_PROTOTYPE_.push.apply(b,b.splice(0,-a))}}}return b};goog.array.moveItem=function(a,c,d){goog.asserts.assert(c>=0&&c<a.length);goog.asserts.assert(d>=0&&d<a.length);var b=goog.array.ARRAY_PROTOTYPE_.splice.call(a,c,1);goog.array.ARRAY_PROTOTYPE_.splice.call(a,d,0,b[0])};goog.array.zip=function(f){if(!arguments.length){return[]}var b=[];for(var d=0;true;d++){var e=[];for(var c=0;c<arguments.length;c++){var a=arguments[c];if(d>=a.length){return b}e.push(a[d])}b.push(e)}};goog.array.shuffle=function(b,f){var a=f||Math.random;for(var e=b.length-1;e>0;e--){var c=Math.floor(a()*(e+1));var d=b[e];b[e]=b[c];b[c]=d}};goog.array.copyByIndex=function(b,c){var a=[];goog.array.forEach(c,function(d){a.push(b[d])});return a};goog.provide("goog.labs.userAgent.browser");goog.require("goog.array");goog.require("goog.labs.userAgent.util");goog.require("goog.object");goog.require("goog.string");goog.labs.userAgent.browser.matchOpera_=function(){return goog.labs.userAgent.util.matchUserAgent("Opera")||goog.labs.userAgent.util.matchUserAgent("OPR")};goog.labs.userAgent.browser.matchIE_=function(){return goog.labs.userAgent.util.matchUserAgent("Edge")||goog.labs.userAgent.util.matchUserAgent("Trident")||goog.labs.userAgent.util.matchUserAgent("MSIE")};goog.labs.userAgent.browser.matchFirefox_=function(){return goog.labs.userAgent.util.matchUserAgent("Firefox")};goog.labs.userAgent.browser.matchSafari_=function(){return goog.labs.userAgent.util.matchUserAgent("Safari")&&!(goog.labs.userAgent.browser.matchChrome_()||goog.labs.userAgent.browser.matchCoast_()||goog.labs.userAgent.browser.matchOpera_()||goog.labs.userAgent.browser.matchIE_()||goog.labs.userAgent.browser.isSilk()||goog.labs.userAgent.util.matchUserAgent("Android"))};goog.labs.userAgent.browser.matchCoast_=function(){return goog.labs.userAgent.util.matchUserAgent("Coast")};goog.labs.userAgent.browser.matchIosWebview_=function(){return(goog.labs.userAgent.util.matchUserAgent("iPad")||goog.labs.userAgent.util.matchUserAgent("iPhone"))&&!goog.labs.userAgent.browser.matchSafari_()&&!goog.labs.userAgent.browser.matchChrome_()&&!goog.labs.userAgent.browser.matchCoast_()&&goog.labs.userAgent.util.matchUserAgent("AppleWebKit")};goog.labs.userAgent.browser.matchChrome_=function(){return(goog.labs.userAgent.util.matchUserAgent("Chrome")||goog.labs.userAgent.util.matchUserAgent("CriOS"))&&!goog.labs.userAgent.browser.matchOpera_()&&!goog.labs.userAgent.browser.matchIE_()};goog.labs.userAgent.browser.matchAndroidBrowser_=function(){return goog.labs.userAgent.util.matchUserAgent("Android")&&!(goog.labs.userAgent.browser.isChrome()||goog.labs.userAgent.browser.isFirefox()||goog.labs.userAgent.browser.isOpera()||goog.labs.userAgent.browser.isSilk())};goog.labs.userAgent.browser.isOpera=goog.labs.userAgent.browser.matchOpera_;goog.labs.userAgent.browser.isIE=goog.labs.userAgent.browser.matchIE_;goog.labs.userAgent.browser.isFirefox=goog.labs.userAgent.browser.matchFirefox_;goog.labs.userAgent.browser.isSafari=goog.labs.userAgent.browser.matchSafari_;goog.labs.userAgent.browser.isCoast=goog.labs.userAgent.browser.matchCoast_;goog.labs.userAgent.browser.isIosWebview=goog.labs.userAgent.browser.matchIosWebview_;goog.labs.userAgent.browser.isChrome=goog.labs.userAgent.browser.matchChrome_;goog.labs.userAgent.browser.isAndroidBrowser=goog.labs.userAgent.browser.matchAndroidBrowser_;goog.labs.userAgent.browser.isSilk=function(){return goog.labs.userAgent.util.matchUserAgent("Silk")};goog.labs.userAgent.browser.getVersion=function(){var e=goog.labs.userAgent.util.getUserAgent();if(goog.labs.userAgent.browser.isIE()){return goog.labs.userAgent.browser.getIEVersion_(e)}var c=goog.labs.userAgent.util.extractVersionTuples(e);var f={};goog.array.forEach(c,function(g){var h=g[0];var i=g[1];f[h]=i});var d=goog.partial(goog.object.containsKey,f);function b(h){var g=goog.array.find(h,d);return f[g]||""}if(goog.labs.userAgent.browser.isOpera()){return b(["Version","Opera","OPR"])}if(goog.labs.userAgent.browser.isChrome()){return b(["Chrome","CriOS"])}var a=c[2];return a&&a[1]||""};goog.labs.userAgent.browser.isVersionOrHigher=function(a){return goog.string.compareVersions(goog.labs.userAgent.browser.getVersion(),a)>=0};goog.labs.userAgent.browser.getIEVersion_=function(d){var f=/rv: *([\d\.]*)/.exec(d);if(f&&f[1]){return f[1]}var c=/Edge\/([\d\.]+)/.exec(d);if(c){return c[1]}var a="";var b=/MSIE +([\d\.]+)/.exec(d);if(b&&b[1]){var e=/Trident\/(\d.\d)/.exec(d);if(b[1]=="7.0"){if(e&&e[1]){switch(e[1]){case"4.0":a="8.0";break;case"5.0":a="9.0";break;case"6.0":a="10.0";break;case"7.0":a="11.0";break}}else{a="7.0"}}else{a=b[1]}}return a};goog.provide("goog.labs.userAgent.engine");goog.require("goog.array");goog.require("goog.labs.userAgent.util");goog.require("goog.string");goog.labs.userAgent.engine.isPresto=function(){return goog.labs.userAgent.util.matchUserAgent("Presto")};goog.labs.userAgent.engine.isTrident=function(){return goog.labs.userAgent.util.matchUserAgent("Trident")||goog.labs.userAgent.util.matchUserAgent("MSIE")};goog.labs.userAgent.engine.isEdge=function(){return goog.labs.userAgent.util.matchUserAgent("Edge")};goog.labs.userAgent.engine.isWebKit=function(){return goog.labs.userAgent.util.matchUserAgentIgnoreCase("WebKit")&&!goog.labs.userAgent.engine.isEdge()};goog.labs.userAgent.engine.isGecko=function(){return goog.labs.userAgent.util.matchUserAgent("Gecko")&&!goog.labs.userAgent.engine.isWebKit()&&!goog.labs.userAgent.engine.isTrident()&&!goog.labs.userAgent.engine.isEdge()};goog.labs.userAgent.engine.getVersion=function(){var e=goog.labs.userAgent.util.getUserAgent();if(e){var d=goog.labs.userAgent.util.extractVersionTuples(e);var c=goog.labs.userAgent.engine.getEngineTuple_(d);if(c){if(c[0]=="Gecko"){return goog.labs.userAgent.engine.getVersionForKey_(d,"Firefox")}return c[1]}var b=d[0];var f;if(b&&(f=b[2])){var a=/Trident\/([^\s;]+)/.exec(f);if(a){return a[1]}}}return""};goog.labs.userAgent.engine.getEngineTuple_=function(c){if(!goog.labs.userAgent.engine.isEdge()){return c[1]}for(var b=0;b<c.length;b++){var a=c[b];if(a[0]=="Edge"){return a}}};goog.labs.userAgent.engine.isVersionOrHigher=function(a){return goog.string.compareVersions(goog.labs.userAgent.engine.getVersion(),a)>=0};goog.labs.userAgent.engine.getVersionForKey_=function(b,a){var c=goog.array.find(b,function(d){return a==d[0]});return c&&c[1]||""};goog.provide("goog.userAgent");goog.require("goog.labs.userAgent.browser");goog.require("goog.labs.userAgent.engine");goog.require("goog.labs.userAgent.platform");goog.require("goog.labs.userAgent.util");goog.require("goog.string");goog.define("goog.userAgent.ASSUME_IE",false);goog.define("goog.userAgent.ASSUME_GECKO",false);goog.define("goog.userAgent.ASSUME_WEBKIT",false);goog.define("goog.userAgent.ASSUME_MOBILE_WEBKIT",false);goog.define("goog.userAgent.ASSUME_OPERA",false);goog.define("goog.userAgent.ASSUME_ANY_VERSION",false);goog.userAgent.BROWSER_KNOWN_=goog.userAgent.ASSUME_IE||goog.userAgent.ASSUME_GECKO||goog.userAgent.ASSUME_MOBILE_WEBKIT||goog.userAgent.ASSUME_WEBKIT||goog.userAgent.ASSUME_OPERA;goog.userAgent.getUserAgentString=function(){return goog.labs.userAgent.util.getUserAgent()};goog.userAgent.getNavigator=function(){return goog.global.navigator||null};goog.userAgent.OPERA=goog.userAgent.BROWSER_KNOWN_?goog.userAgent.ASSUME_OPERA:goog.labs.userAgent.browser.isOpera();goog.userAgent.IE=goog.userAgent.BROWSER_KNOWN_?goog.userAgent.ASSUME_IE:goog.labs.userAgent.browser.isIE();goog.userAgent.GECKO=goog.userAgent.BROWSER_KNOWN_?goog.userAgent.ASSUME_GECKO:goog.labs.userAgent.engine.isGecko();goog.userAgent.WEBKIT=goog.userAgent.BROWSER_KNOWN_?goog.userAgent.ASSUME_WEBKIT||goog.userAgent.ASSUME_MOBILE_WEBKIT:goog.labs.userAgent.engine.isWebKit();goog.userAgent.isMobile_=function(){return goog.userAgent.WEBKIT&&goog.labs.userAgent.util.matchUserAgent("Mobile")};goog.userAgent.MOBILE=goog.userAgent.ASSUME_MOBILE_WEBKIT||goog.userAgent.isMobile_();goog.userAgent.SAFARI=goog.userAgent.WEBKIT;goog.userAgent.determinePlatform_=function(){var a=goog.userAgent.getNavigator();return a&&a.platform||""};goog.userAgent.PLATFORM=goog.userAgent.determinePlatform_();goog.define("goog.userAgent.ASSUME_MAC",false);goog.define("goog.userAgent.ASSUME_WINDOWS",false);goog.define("goog.userAgent.ASSUME_LINUX",false);goog.define("goog.userAgent.ASSUME_X11",false);goog.define("goog.userAgent.ASSUME_ANDROID",false);goog.define("goog.userAgent.ASSUME_IPHONE",false);goog.define("goog.userAgent.ASSUME_IPAD",false);goog.userAgent.PLATFORM_KNOWN_=goog.userAgent.ASSUME_MAC||goog.userAgent.ASSUME_WINDOWS||goog.userAgent.ASSUME_LINUX||goog.userAgent.ASSUME_X11||goog.userAgent.ASSUME_ANDROID||goog.userAgent.ASSUME_IPHONE||goog.userAgent.ASSUME_IPAD;goog.userAgent.MAC=goog.userAgent.PLATFORM_KNOWN_?goog.userAgent.ASSUME_MAC:goog.labs.userAgent.platform.isMacintosh();goog.userAgent.WINDOWS=goog.userAgent.PLATFORM_KNOWN_?goog.userAgent.ASSUME_WINDOWS:goog.labs.userAgent.platform.isWindows();goog.userAgent.isLegacyLinux_=function(){return goog.labs.userAgent.platform.isLinux()||goog.labs.userAgent.platform.isChromeOS()};goog.userAgent.LINUX=goog.userAgent.PLATFORM_KNOWN_?goog.userAgent.ASSUME_LINUX:goog.userAgent.isLegacyLinux_();goog.userAgent.isX11_=function(){var a=goog.userAgent.getNavigator();return !!a&&goog.string.contains(a.appVersion||"","X11")};goog.userAgent.X11=goog.userAgent.PLATFORM_KNOWN_?goog.userAgent.ASSUME_X11:goog.userAgent.isX11_();goog.userAgent.ANDROID=goog.userAgent.PLATFORM_KNOWN_?goog.userAgent.ASSUME_ANDROID:goog.labs.userAgent.platform.isAndroid();goog.userAgent.IPHONE=goog.userAgent.PLATFORM_KNOWN_?goog.userAgent.ASSUME_IPHONE:goog.labs.userAgent.platform.isIphone();goog.userAgent.IPAD=goog.userAgent.PLATFORM_KNOWN_?goog.userAgent.ASSUME_IPAD:goog.labs.userAgent.platform.isIpad();goog.userAgent.determineVersion_=function(){if(goog.userAgent.OPERA&&goog.global.opera){var d=goog.global.opera.version;return goog.isFunction(d)?d():d}var b="";var a=goog.userAgent.getVersionRegexResult_();if(a){b=a?a[1]:""}if(goog.userAgent.IE&&!goog.labs.userAgent.engine.isEdge()){var c=goog.userAgent.getDocumentMode_();if(c>parseFloat(b)){return String(c)}}return b};goog.userAgent.getVersionRegexResult_=function(){var a=goog.userAgent.getUserAgentString();if(goog.userAgent.GECKO){return/rv\:([^\);]+)(\)|;)/.exec(a)}if(goog.userAgent.IE&&goog.labs.userAgent.engine.isEdge()){return/Edge\/([\d\.]+)/.exec(a)}if(goog.userAgent.IE){return/\b(?:MSIE|rv)[: ]([^\);]+)(\)|;)/.exec(a)}if(goog.userAgent.WEBKIT){return/WebKit\/(\S+)/.exec(a)}};goog.userAgent.getDocumentMode_=function(){var a=goog.global.document;return a?a.documentMode:undefined};goog.userAgent.VERSION=goog.userAgent.determineVersion_();goog.userAgent.compare=function(b,a){return goog.string.compareVersions(b,a)};goog.userAgent.isVersionOrHigherCache_={};goog.userAgent.isVersionOrHigher=function(a){return goog.userAgent.ASSUME_ANY_VERSION||goog.userAgent.isVersionOrHigherCache_[a]||(goog.userAgent.isVersionOrHigherCache_[a]=goog.string.compareVersions(goog.userAgent.VERSION,a)>=0)};goog.userAgent.isVersion=goog.userAgent.isVersionOrHigher;goog.userAgent.isDocumentModeOrHigher=function(a){return goog.userAgent.IE&&(goog.labs.userAgent.engine.isEdge()||goog.userAgent.DOCUMENT_MODE>=a)};goog.userAgent.isDocumentMode=goog.userAgent.isDocumentModeOrHigher;goog.userAgent.DOCUMENT_MODE=(function(){var a=goog.global.document;var b=goog.userAgent.getDocumentMode_();if(!a||!goog.userAgent.IE||(!b&&goog.labs.userAgent.engine.isEdge())){return undefined}return b||(a.compatMode=="CSS1Compat"?parseInt(goog.userAgent.VERSION,10):5)})();goog.provide("goog.userAgent.product");goog.require("goog.labs.userAgent.browser");goog.require("goog.labs.userAgent.platform");goog.require("goog.userAgent");goog.define("goog.userAgent.product.ASSUME_FIREFOX",false);goog.define("goog.userAgent.product.ASSUME_IPHONE",false);goog.define("goog.userAgent.product.ASSUME_IPAD",false);goog.define("goog.userAgent.product.ASSUME_ANDROID",false);goog.define("goog.userAgent.product.ASSUME_CHROME",false);goog.define("goog.userAgent.product.ASSUME_SAFARI",false);goog.userAgent.product.PRODUCT_KNOWN_=goog.userAgent.ASSUME_IE||goog.userAgent.ASSUME_OPERA||goog.userAgent.product.ASSUME_FIREFOX||goog.userAgent.product.ASSUME_IPHONE||goog.userAgent.product.ASSUME_IPAD||goog.userAgent.product.ASSUME_ANDROID||goog.userAgent.product.ASSUME_CHROME||goog.userAgent.product.ASSUME_SAFARI;goog.userAgent.product.OPERA=goog.userAgent.OPERA;goog.userAgent.product.IE=goog.userAgent.IE;goog.userAgent.product.FIREFOX=goog.userAgent.product.PRODUCT_KNOWN_?goog.userAgent.product.ASSUME_FIREFOX:goog.labs.userAgent.browser.isFirefox();goog.userAgent.product.isIphoneOrIpod_=function(){return goog.labs.userAgent.platform.isIphone()||goog.labs.userAgent.platform.isIpod()};goog.userAgent.product.IPHONE=goog.userAgent.product.PRODUCT_KNOWN_?goog.userAgent.product.ASSUME_IPHONE:goog.userAgent.product.isIphoneOrIpod_();goog.userAgent.product.IPAD=goog.userAgent.product.PRODUCT_KNOWN_?goog.userAgent.product.ASSUME_IPAD:goog.labs.userAgent.platform.isIpad();goog.userAgent.product.ANDROID=goog.userAgent.product.PRODUCT_KNOWN_?goog.userAgent.product.ASSUME_ANDROID:goog.labs.userAgent.browser.isAndroidBrowser();goog.userAgent.product.CHROME=goog.userAgent.product.PRODUCT_KNOWN_?goog.userAgent.product.ASSUME_CHROME:goog.labs.userAgent.browser.isChrome();goog.userAgent.product.isSafariDesktop_=function(){return goog.labs.userAgent.browser.isSafari()&&!goog.labs.userAgent.platform.isIos()};goog.userAgent.product.SAFARI=goog.userAgent.product.PRODUCT_KNOWN_?goog.userAgent.product.ASSUME_SAFARI:goog.userAgent.product.isSafariDesktop_();goog.provide("au.upldr.utils.mimeMapping");goog.require("goog.userAgent.product");goog.require("goog.object");au.upldr.utils.mimeMapping.map={"*.323":"text/h323","*.asx":"video/x-ms-asf","*.acx":"application/internet-property-stream","*.ai":"application/postscript","*.aif":"audio/x-aiff","*.aiff":"audio/aiff","*.axs":"application/olescript","*.aifc":"audio/aiff","*.asr":"video/x-ms-asf","*.avi":"video/x-msvideo","*.asf":"video/x-ms-asf","*.au":"audio/basic","*.application":"application/x-ms-application","*.bin":"application/octet-stream","*.bas":"text/plain","*.bcpio":"application/x-bcpio","*.bmp":"image/bmp","*.cdf":"application/x-cdf","*.cat":"application/vndms-pkiseccat","*.crt":"application/x-x509-ca-cert","*.c":"text/plain","*.css":"text/css","*.cer":"application/x-x509-ca-cert","*.crl":"application/pkix-crl","*.cmx":"image/x-cmx","*.csh":"application/x-csh","*.cod":"image/cis-cod","*.cpio":"application/x-cpio","*.clp":"application/x-msclip","*.crd":"application/x-mscardfile","*.cdr":"application/coreldraw","*.deploy":"application/octet-stream","*.dll":"application/x-msdownload","*.dot":"application/msword","*.doc":"application/msword","*.docx":"application/vnd.openxmlformats-officedocument.wordprocessingml.document","*.dvi":"application/x-dvi","*.dir":"application/x-director","*.dxr":"application/x-director","*.der":"application/x-x509-ca-cert","*.dib":"image/bmp","*.dcr":"application/x-director","*.disco":"text/xml","*.exe":"application/octet-stream","*.etx":"text/x-setext","*.evy":"application/envoy","*.eml":"message/rfc822","*.eps":"application/postscript","*.flr":"x-world/x-vrml","*.flv":"video/x-flv","*.fif":"application/fractals","*.gtar":"application/x-gtar","*.gif":"image/gif","*.png":"image/png","*.gz":"application/x-gzip","*.hta":"application/hta","*.htc":"text/x-component","*.htt":"text/webviewhtml","*.h":"text/plain","*.hdf":"application/x-hdf","*.hlp":"application/winhlp","*.html":"text/html","*.htm":"text/html","*.hqx":"application/mac-binhex40","*.isp":"application/x-internet-signup","*.iii":"application/x-iphone","*.ief":"image/ief","*.ivf":"video/x-ivf","*.ins":"application/x-internet-signup","*.ico":"image/x-icon","*.jpg":"image/jpeg","*.jfif":"image/pjpeg","*.jpe":"image/jpeg","*.jpeg":"image/jpeg","*.jp2":"image/jp2","*.j2k":"image/jp2","*.js":"application/x-javascript","*.lsx":"video/x-la-asf","*.latex":"application/x-latex","*.lsf":"video/x-la-asf","*.manifest":"application/x-ms-manifest","*.mhtml":"message/rfc822","*.mny":"application/x-msmoney","*.mht":"message/rfc822","*.mid":"audio/mid","*.mpv2":"video/mpeg","*.man":"application/x-troff-man","*.mvb":"application/x-msmediaview","*.mpeg":"video/mpeg","*.m3u":"audio/x-mpegurl","*.mdb":"application/x-msaccess","*.mpp":"application/vnd.ms-project","*.m1v":"video/mpeg","*.m4a":"audio/mp4","*.mpa":"video/mpeg","*.me":"application/x-troff-me","*.m13":"application/x-msmediaview","*.movie":"video/x-sgi-movie","*.m14":"application/x-msmediaview","*.mpe":"video/mpeg","*.mp2":"video/mpeg","*.mov":"video/quicktime","*.mp3":"audio/mpeg","*.mp4":"video/mp4","*.mpg":"video/mpeg","*.ms":"application/x-troff-ms","*.nc":"application/x-netcdf","*.nws":"message/rfc822","*.oda":"application/oda","*.odt":"application/vnd.oasis.opendocument.text","*.ods":"application/oleobject","*.ogg":"video/ogg","*.pmc":"application/x-perfmon","*.p7r":"application/x-pkcs7-certreqresp","*.p7b":"application/x-pkcs7-certificates","*.p7s":"application/pkcs7-signature","*.pmw":"application/x-perfmon","*.ps":"application/postscript","*.p7c":"application/pkcs7-mime","*.pbm":"image/x-portable-bitmap","*.ppm":"image/x-portable-pixmap","*.pub":"application/x-mspublisher","*.pnm":"image/x-portable-anymap","*.pml":"application/x-perfmon","*.p10":"application/pkcs10","*.pfx":"application/x-pkcs12","*.p12":"application/x-pkcs12","*.pdf":"application/pdf","*.pps":"application/vnd.ms-powerpoint","*.p7m":"application/pkcs7-mime","*.pko":"application/vndms-pkipko","*.ppt":"application/vnd*.ms-powerpoint","*.pptx":"application/vnd.openxmlformats-officedocument.presentationml.presentation","*.psd":"image/vnd.adobe.photoshop","*.pmr":"application/x-perfmon","*.pma":"application/x-perfmon","*.pot":"application/vnd.ms-powerpoint","*.prf":"application/pics-rules","*.pgm":"image/x-portable-graymap","*.qt":"video/quicktime","*.ra":"audio/x-pn-realaudio","*.rar":"application/x-rar-compressed","*.rgb":"image/x-rgb","*.ram":"audio/x-pn-realaudio","*.rmi":"audio/mid","*.ras":"image/x-cmu-raster","*.roff":"application/x-troff","*.rtf":"application/rtf,application/x-rtf,text/richtext,text/rtf","*.rtx":"application/rtf,application/x-rtf,text/richtext,text/rtf","*.sv4crc":"application/x-sv4crc","*.spc":"application/x-pkcs7-certificates","*.setreg":"application/set-registration-initiation","*.snd":"audio/basic","*.stl":"application/vndms-pkistl","*.setpay":"application/set-payment-initiation","*.stm":"text/html","*.shar":"application/x-shar","*.sh":"application/x-sh","*.sit":"application/x-stuffit","*.spl":"application/futuresplash","*.sct":"text/scriptlet","*.scd":"application/x-msschedule","*.sst":"application/vndms-pkicertstore","*.src":"application/x-wais-source","*.sv4cpio":"application/x-sv4cpio","*.tex":"application/x-tex","*.tgz":"application/x-compressed","*.t":"application/x-troff","*.tar":"application/x-tar","*.tr":"application/x-troff","*.tif":"image/tiff","*.tiff":"image/tiff","*.txt":"text/plain","*.texinfo":"application/x-texinfo","*.torrent":"application/x-bittorrent","*.trm":"application/x-msterminal","*.tiff":"image/tiff","*.tcl":"application/x-tcl","*.texi":"application/x-texinfo","*.tsv":"text/tab-separated-values","*.ustar":"application/x-ustar","*.uls":"text/iuls","*.vcf":"text/x-vcard","*.wps":"application/vnd.ms-works","*.wav":"audio/wav","*.wrz":"x-world/x-vrml","*.webm":"video/webm","*.wri":"application/x-mswrite","*.wks":"application/vnd.ms-works","*.wmf":"application/x-msmetafile","*.wmv":"video/x-ms-wmv","*.wcm":"application/vnd.ms-works","*.wrl":"x-world/x-vrml","*.wdb":"application/vnd.ms-works","*.wsdl":"text/xml","*.xml":"text/xml","*.xlm":"application/vnd.ms-excel","*.xaf":"x-world/x-vrml","*.xla":"application/vnd.ms-excel","*.xls":"application/vnd.ms-excel","*.xlsx":"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet","*.xof":"x-world/x-vrml","*.xlt":"application/vnd.ms-excel","*.xlc":"application/vnd.ms-excel","*.xsl":"text/xml","*.xbm":"image/x-xbitmap","*.xlw":"application/vnd*.ms-excel","*.xpm":"image/x-xpixmap","*.xwd":"image/x-xwindowdump","*.xsd":"text/xml","*.z":"application/x-compress","*.zip":"application/x-zip-compressed","*.keynote":"application/x-iwork-keynote-sffkey","*.pages":"application/x-iwork-pages-sffpages","*.numbers":"application/x-iwork-numbers-sffnumbers","*.*":""};goog.exportSymbol("Aurigma.MimeMapping",au.upldr.utils.mimeMapping.map);au.upldr.utils.mimeMapping.getMimeMapping=function(b){var a=au.upldr.utils.mimeMapping.map[b];return a?a:b.replace("*","")};au.upldr.utils.mimeMapping.getExtentionByMime=function(e){var b=goog.object.getValues(au.upldr.utils.mimeMapping.map);var d=goog.object.getKeys(au.upldr.utils.mimeMapping.map);for(var c=0,a=b.length;c<a;c++){if(e==b[c]){return d[c]}}return""};au.upldr.utils.mimeMapping.getInputFileAcceptStringWithMime=function(b){var a=[];if(b&&b.length!=0){var e=b.split(";");for(var c=0;c<e.length;c++){var d=au.upldr.utils.mimeMapping.getMimeMapping(e[c]);if(a.indexOf(d)==-1){a.push(d)}}}return a.length==0?"":a.join(",")};au.upldr.utils.mimeMapping.getInputFileAcceptStringWithExt=function(a){if(a&&a.length!=0){var c=[];var d=a.split(";");for(var b=0;b<d.length;b++){c.push(d[b].replace("*",""))}return c.join(",")}else{return""}};au.upldr.utils.mimeMapping.getInputFileAcceptString=function(a){if(goog.userAgent.product.SAFARI||goog.userAgent.product.FIREFOX){return au.upldr.utils.mimeMapping.getInputFileAcceptStringWithMime(a)}else{return au.upldr.utils.mimeMapping.getInputFileAcceptStringWithExt(a)}};goog.provide("au.upldr.upload.ProgressBytesMode");au.upldr.upload.ProgressBytesMode={BY_PACKAGE_SIZE:"ByPackageSize",BY_SOURCE_SIZE:"BySourceSize"};goog.provide("au.upldr.UploaderState");au.upldr.UploaderState={IDLE:0,READY:1,UPLOADING:2};goog.provide("au.upldr.ViewMode");au.upldr.ViewMode={TILES:"tiles",THUMBNAILS:"thumbnails",ICONS:"icons"};goog.provide("au.upldr.imaging.BaseConfig");goog.require("goog.array");goog.require("goog.object");au.upldr.imaging.BaseConfig=function(a){this.parse(a)};au.upldr.imaging.BaseConfig.prototype.getBooleanTypeParams=function(){return{}};au.upldr.imaging.BaseConfig.prototype.getNumberTypeParams=function(){return{}};au.upldr.imaging.BaseConfig.prototype.getColorTypeParams=function(){return{}};au.upldr.imaging.BaseConfig.prototype.getEnumTypeParams=function(){return{}};au.upldr.imaging.BaseConfig.prototype.parse=function(a){if(goog.isDefAndNotNull(a)&&(goog.isString(a)&&a!=""||goog.isObject(a)&&!goog.object.isEmpty(a))){goog.object.extend(this,this.convertConfigToObj_(a))}};au.upldr.imaging.BaseConfig.prototype.clone=function(){var a=new this["constructor"]();goog.object.extend(a,this);return a};au.upldr.imaging.BaseConfig.prototype.parserFunc=function(i,c,g){var f=this.getBooleanTypeParams();var a=this.getNumberTypeParams();var d=this.getColorTypeParams();var b=this.getEnumTypeParams();try{switch(true){case f.hasOwnProperty(c):i[c]=!!JSON.parse(g);break;case a.hasOwnProperty(c):if(typeof JSON.parse(g)=="number"){i[c]=JSON.parse(g)}else{i[c]=0}break;case d.hasOwnProperty(c):if(typeof JSON.parse(g)=="number"){i[c]="0x"+JSON.parse(g).toString(16).toUpperCase()}else{i[c]=g}break;case b.hasOwnProperty(c):if(b[c].hasOwnProperty(g)){i[c]=b[c][g]}break;default:i[c]=g}}catch(h){i[c]=a.hasOwnProperty(c)?0:g}};au.upldr.imaging.BaseConfig.prototype.convertConfigToObj_=function(e){var b={};if(goog.isString(e)){var d,a=e.replace(/'+|"+/g,"").replace(/^\s+|\s+$|/g,"").replace(/\s*=\s*/g,"=").replace(/\s*;\s*/g,";").split(";");goog.array.forEach(a,function(f){d=f.split("=");if(d.length==2){this.parserFunc(b,d[0],d[1])}}.bind(this))}else{if(goog.isObject(e)){for(var c in e){if(e.hasOwnProperty(c)){this.parserFunc(b,c,(e[c]))}}}}return b};goog.provide("au.upldr.imaging.imageEditor.DrawAreaConfig");goog.require("goog.array");goog.require("goog.object");goog.require("au.upldr.imaging.BaseConfig");au.upldr.imaging.imageEditor.DrawAreaConfig=function(a){this.maxWidth=100;this.minWidth=1;this.width=20;this.color="black";this.enableEraser=true;this.enableColorPicker=true;this.enableWidthSlider=true;goog.base(this,a)};goog.inherits(au.upldr.imaging.imageEditor.DrawAreaConfig,au.upldr.imaging.BaseConfig);au.upldr.imaging.imageEditor.DrawAreaConfig.prototype.getBooleanTypeParams=function(){return{enableEraser:1,enableColorPicker:1,enableWidthSlider:1}};au.upldr.imaging.imageEditor.DrawAreaConfig.prototype.getNumberTypeParams=function(){return{maxWidth:1,minWidth:1,width:1}};au.upldr.imaging.imageEditor.DrawAreaConfig.prototype.getColorTypeParams=function(){return{color:1}};goog.provide("au.upldr.UploadProgress");goog.provide("au.upldr.UploadProgress.Stage");au.upldr.UploadProgress=function(d,a,f,b,c,e){this.stage=d||au.upldr.UploadProgress.Stage.UNKNOWN;this.percents=a||0;this.loadedFiles=f||0;this.totalFiles=b||0;this.loadedBytes=c||0;this.totalBytes=e||0};au.upldr.UploadProgress.prototype.clone=function(){return new au.upldr.UploadProgress(this.stage,this.percents,this.loadedFiles,this.totalFiles,this.loadedBytes,this.totalBytes)};au.upldr.UploadProgress.Stage={UNKNOWN:0,START:1,PACKAGING:2,UPLOADING:3,FINISH:4};goog.provide("goog.ui.IdGenerator");goog.ui.IdGenerator=function(){};goog.addSingletonGetter(goog.ui.IdGenerator);goog.ui.IdGenerator.prototype.nextId_=0;goog.ui.IdGenerator.prototype.getNextUniqueId=function(){return":"+(this.nextId_++).toString(36)};goog.provide("au.upldr.VERSION");goog.provide("au.upldr.BUILD_DATE");goog.provide("au.upldr.Properties");goog.provide("au.upldr.DefaultValues");goog.provide("au.upldr.InternalProperties");goog.provide("au.upldr.InternalDefaultValues");goog.require("goog.ui.IdGenerator");goog.require("au.upldr.ViewMode");goog.require("au.upldr.UploaderState");goog.require("au.upldr.UploadProgress");goog.require("au.upldr.upload.ProgressBytesMode");goog.require("au.upldr.imaging.imageEditor.DrawAreaConfig");au.upldr.VERSION="0.0.0.0";au.upldr.BUILD_DATE="01.01.1970";au.upldr.Properties={ID:"Id",TITLE_TEXT:"TitleText",ADD_FILES_LINK_TEXT:"AddFilesHyperlinkText",ADD_FOLDER_LINK_TEXT:"AddFolderHyperlinkText",OR_LABEL_TEXT:"OrText",REMOVE_ALL_FILES_LINK_TEXT:"ClearAllHyperlinkText",WIDTH:"Width",HEIGHT:"Height",FOLDER_PROCESSING_MODE:"FolderProcessingMode",PROGRESS_BYTES_MODE:"ProgressBytesMode",SHOW_VIEW_COMBOBOX:"ShowViewComboBox",VIEW_COMBOBOX_TEXT:"ViewComboBox",VIEW_COMBOBOX_LABEL_TEXT:"ViewComboBoxText",VIEW_MODE:"ViewMode",ADD_FILES_BUTTON_TEXT:"AddFilesButtonText",ADD_FOLDER_BUTTON_TEXT:"AddFolderButtonText",ENABLE_DESCRIPTION_EDITOR:"EnableDescriptionEditor",ENABLE_ROTATION:"EnableRotation",ENABLE_ADDING_FILES:"EnableAddingFiles",IS_VISIBLE_ADDING_FILES:"IsVisibleAddingFiles",STATUS_PANE_FILES_UPLOADED_TEXT:"StatusPaneFilesUploadedText",STATUS_PANE_DATA_UPLOADED_TEXT:"StatusPaneDataUploadedText",STATUS_PANE_NO_FILES_TO_UPLOAD_TEXT:"NoFilesToUploadText",STATUS_PANE_FILES_TO_UPLOAD_TEXT:"FilesToUploadText",SEND_BUTTON_TEXT:"UploadButtonText",CANCEL_UPLOAD_BUTTON_TEXT:"CancelUploadButtonText",DROP_FILES_HERE_TEXT:"DropFilesHereText",ITEM_TOOLTIP:"ItemTooltip",IMAGE_TOOLTIP:"ImageTooltip",REMOVE_BUTTON_TOOLTIP:"RemovalIconTooltip",EDIT_BUTTON_TOOLTIP:"EditIconTooltip",ROTATE_BUTTON_TOOLTIP:"RotationIconTooltip",EDIT_DESCRIPTION_BUTTON_TOOLTIP:"DescriptionEditorIconTooltip",PANE_ITEM_TOOLBAR_ALWAYS_VISIBLE:"PaneItemToolbarAlwaysVisible",ACTION_URL:"ActionUrl",DESCRIPTION_EDITOR_OK_BUTTON_TEXT:"DescriptionEditorSaveButtonText",DESCRIPTION_EDITOR_CANCEL_BUTTON_TEXT:"DescriptionEditorCancelButtonText",RESTRICTIONS_FILE_MASK:"FileMask",RESTRICTIONS_DENIED_FILE_MASK:"DeniedFileMask",RESTRICTIONS_MAX_FILE_COUNT:"MaxFileCount",RESTRICTIONS_MAX_TOTAL_FILE_SIZE:"MaxTotalFileSize",RESTRICTIONS_MAX_FILE_SIZE:"MaxFileSize",RESTRICTIONS_MIN_FILE_SIZE:"MinFileSize",RESTRICTIONS_MAX_IMAGE_WIDTH:"MaxImageWidth",RESTRICTIONS_MIN_IMAGE_WIDTH:"MinImageWidth",RESTRICTIONS_MAX_IMAGE_HEIGHT:"MaxImageHeight",RESTRICTIONS_MIN_IMAGE_HEIGHT:"MinImageHeight",RESTRICTIONS_MIN_FILE_COUNT:"MinFileCount",ADD_FILES_PROGRESS_DIALOG_TEXT:"AddFilesProgressDialogText",ADD_FILES_PROGRESS_DIALOG_WAIT_TEXT:"AddFilesProgressDialogWaitText",COMMON_DIALOG_CANCEL_BUTTON_TEXT:"CommonDialogCancelButtonText",FILE_NAME_NOT_ALLOWED_MSG:"FileNameNotAllowedMessage",TOO_MANY_FILES_MSG:"MaxFileCountExceeded",MAX_TOTAL_FILE_SIZE_EXCEEDED_MSG:"MaxTotalFileSizeExceeded",FILE_SIZE_TOO_LARGE_MSG:"MaxFileSizeExceeded",FILE_SIZE_TOO_SMALL_MSG:"FileSizeTooSmall",DIMENSIONS_TOO_SMALL_MSG:"DimensionsTooSmall",DIMENSIONS_TOO_LARGE_MSG:"DimensionsTooLarge",FILES_NOT_ADDED_MSG:"FilesNotAdded",TOO_FEW_FILES_MSG:"TooFewFiles",DND_FOLDER_FILE_LIMIT_EXCEEDED_MSG:"DndFolderFileLimitExceeded",UPLOAD_ERROR_MSG:"UploadErrorMessage",SERVER_NOT_FOUND_MSG:"ServerNotFoundMessage",SERVER_SIDE_ERROR_MSG:"ServerSideErrorMessage",UPLOAD_CANCELLED_BY_USER_MSG:"UploadCancelledByUserMessage",UPLOAD_CANCELLED_BY_CANCEL_METHOD_MSG:"UploadCancelledByCancelMethodMessage",UPLOAD_CANCELLED_FROM_AFTER_PACKAGE_UPLOAD_EVENT_METHOD_MSG:"UploadCancelledFromAfterPackageUploadEventMessage",CLOSE_PREVIEW_TOOLTIP:"ClosePreviewTooltip",UPLOAD_PANE_ICON_ITEM_WIDTH:"IconItemWidth",UPLOAD_PANE_ICON_SIZE:"IconSize",UPLOAD_PANE_THUMBNAIL_PREVIEW_SIZE:"ThumbnailPreviewSize",UPLOAD_PANE_TILE_ITEM_WIDTH:"TileItemWidth",UPLOAD_PANE_TILE_PREVIEW_SIZE:"TilePreviewSize",LOCALE:"Locale",CHUNK_SIZE:"ChunkSize",MIN_IMAGE_WIDTH_HEIGHT_LOGIC:"MinImageWidthHeightLogic",STATUS_PANE_FILES_PREPARED_TEXT:"StatusPaneFilesPreparedText",STATUS_PANE_PREPARING_TEXT:"StatusPanePreparingText",STATUS_PANE_SENDING_TEXT:"StatusPaneSendingText",CANNOT_READ_FILE:"CannotReadFile",MEMORY_LIMIT_REACHED:"MemoryLimitReached",PREVIEW_NOT_AVAILABLE:"PreviewNotAvailable",TOO_MANY_FILES_SELECTED_TO_OPEN:"TooManyFilesSelectedToOpen",ENABLE_DISPROPORTIONAL_EXIF_THUMBNAILS:"EnableDisproportionalExifThumbnails",COMMON_DIALOG_OK_BUTTON_TEXT:"CommonDialogOkButtonText",MAX_FILE_TO_LOAD_SIZE:"MaxFileToLoadSize",UPLOAD_ERROR_DIALOG_HIDE_DETAILS_BUTTON_TEXT:"UploadErrorDialogHideDetailsButtonText",UPLOAD_ERROR_DIALOG_MESSAGE:"UploadErrorDialogMessage",UPLOAD_ERROR_DIALOG_SHOW_DETAILS_BUTTON_TEXT:"UploadErrorDialogShowDetailsButtonText",UPLOAD_ERROR_DIALOG_TITLE:"UploadErrorDialogTitle",ENABLE_AUTO_ROTATION:"EnableAutoRotation",INSTANT_UPLOAD:"EnableInstantUpload",TOP_PANE_VISIBILITY:"TopPaneVisibility",STATUS_PANE_VISIBILITY:"StatusPaneVisibility",ENABLE_ALL_STANDART_FIELDS:"EnableAllStandardFields",ENABLE_IMAGE_EDITOR:"EnableImageEditor",IMAGE_EDITOR_CROP_RATIO:"ImageEditorCropRatio",IMAGE_EDITOR_CROP_MIN_SIZE:"ImageEditorCropMinSize",IMAGE_EDITOR_ENABLE_CROP:"ImageEditorEnableCrop",IMAGE_EDITOR_ENABLE_DRAW_TOOL:"ImageEditorEnableDrawTool",IMAGE_EDITOR_DRAW_TOOL:"ImageEditorDrawTool",IMAGE_EDITOR_DEFAULT_TOOL:"ImageEditorDefaultTool",IMAGE_EDITOR_ALBUM_ORIENTATION:"ImageEditorAlbumOrientation",CLIP_BOARD_FILE_NAME:"ClipBoardFileName",FILE_NAMES_URL_ENCODED:"FilenamesUrlEncoded",ENABLE_EXIF_PREVIEW:"EnableExifPreview"};au.upldr.InternalProperties={UPLOADER_STATE:"UploaderState",UPLOAD_PROGRESS:"UploadProgress"};au.upldr.FolderProcessingModeEnum={NONE:"none",SKIP:"skip",UPLOAD:"upload",SHOW:"show",MIXED:"mixed",FOLDER:"folder"};au.upldr.DefaultValues={};au.upldr.DefaultValues[au.upldr.Properties.ID]="upldr"+goog.ui.IdGenerator.getInstance().getNextUniqueId();au.upldr.DefaultValues[au.upldr.Properties.TITLE_TEXT]="Files for upload";au.upldr.DefaultValues[au.upldr.Properties.ADD_FILES_LINK_TEXT]="Add more files";au.upldr.DefaultValues[au.upldr.Properties.ADD_FOLDER_LINK_TEXT]="add folder";au.upldr.DefaultValues[au.upldr.Properties.OR_LABEL_TEXT]="or";au.upldr.DefaultValues[au.upldr.Properties.REMOVE_ALL_FILES_LINK_TEXT]="remove all files";au.upldr.DefaultValues[au.upldr.Properties.SHOW_VIEW_COMBOBOX]=true;au.upldr.DefaultValues[au.upldr.Properties.VIEW_COMBOBOX_TEXT]=["Tiles","Thumbnails","Icons"];au.upldr.DefaultValues[au.upldr.Properties.VIEW_COMBOBOX_LABEL_TEXT]="Change view:";au.upldr.DefaultValues[au.upldr.Properties.VIEW_MODE]=au.upldr.ViewMode.TILES;au.upldr.DefaultValues[au.upldr.Properties.WIDTH]="600px";au.upldr.DefaultValues[au.upldr.Properties.HEIGHT]="400px";au.upldr.DefaultValues[au.upldr.Properties.FOLDER_PROCESSING_MODE]=au.upldr.FolderProcessingModeEnum.NONE;au.upldr.DefaultValues[au.upldr.Properties.PROGRESS_BYTES_MODE]=au.upldr.upload.ProgressBytesMode.BY_PACKAGE_SIZE;au.upldr.DefaultValues[au.upldr.Properties.ADD_FILES_BUTTON_TEXT]="+Add more files";au.upldr.DefaultValues[au.upldr.Properties.ADD_FOLDER_BUTTON_TEXT]="+Add folder";au.upldr.DefaultValues[au.upldr.Properties.ENABLE_DESCRIPTION_EDITOR]=true;au.upldr.DefaultValues[au.upldr.Properties.ENABLE_ROTATION]=true;au.upldr.DefaultValues[au.upldr.Properties.ENABLE_ADDING_FILES]=true;au.upldr.DefaultValues[au.upldr.Properties.IS_VISIBLE_ADDING_FILES]=true;au.upldr.DefaultValues[au.upldr.Properties.STATUS_PANE_FILES_UPLOADED_TEXT]="Files completed: {0} / {1}";au.upldr.DefaultValues[au.upldr.Properties.STATUS_PANE_DATA_UPLOADED_TEXT]="Data uploaded: {0} / {1}";au.upldr.DefaultValues[au.upldr.Properties.STATUS_PANE_NO_FILES_TO_UPLOAD_TEXT]="No files to upload";au.upldr.DefaultValues[au.upldr.Properties.STATUS_PANE_FILES_TO_UPLOAD_TEXT]="Total files: {0}";au.upldr.DefaultValues[au.upldr.Properties.SEND_BUTTON_TEXT]="Upload";au.upldr.DefaultValues[au.upldr.Properties.CANCEL_UPLOAD_BUTTON_TEXT]="Cancel";au.upldr.DefaultValues[au.upldr.Properties.DROP_FILES_HERE_TEXT]="Drop files here...";au.upldr.DefaultValues[au.upldr.Properties.ITEM_TOOLTIP]="{0}\n{1}";au.upldr.DefaultValues[au.upldr.Properties.IMAGE_TOOLTIP]="{0}\n{1}, {2}";au.upldr.DefaultValues[au.upldr.Properties.REMOVE_BUTTON_TOOLTIP]="Remove";au.upldr.DefaultValues[au.upldr.Properties.EDIT_BUTTON_TOOLTIP]="Edit";au.upldr.DefaultValues[au.upldr.Properties.ROTATE_BUTTON_TOOLTIP]="Rotate";au.upldr.DefaultValues[au.upldr.Properties.EDIT_DESCRIPTION_BUTTON_TOOLTIP]="Edit description";au.upldr.DefaultValues[au.upldr.Properties.PANE_ITEM_TOOLBAR_ALWAYS_VISIBLE]=false;au.upldr.DefaultValues[au.upldr.Properties.ACTION_URL]=".";au.upldr.DefaultValues[au.upldr.Properties.DESCRIPTION_EDITOR_OK_BUTTON_TEXT]="Save";au.upldr.DefaultValues[au.upldr.Properties.DESCRIPTION_EDITOR_CANCEL_BUTTON_TEXT]="Cancel";au.upldr.DefaultValues[au.upldr.Properties.RESTRICTIONS_FILE_MASK]="";au.upldr.DefaultValues[au.upldr.Properties.RESTRICTIONS_MAX_FILE_COUNT]=0;au.upldr.DefaultValues[au.upldr.Properties.RESTRICTIONS_MAX_TOTAL_FILE_SIZE]=0;au.upldr.DefaultValues[au.upldr.Properties.RESTRICTIONS_MAX_FILE_SIZE]=0;au.upldr.DefaultValues[au.upldr.Properties.RESTRICTIONS_MIN_FILE_SIZE]=0;au.upldr.DefaultValues[au.upldr.Properties.RESTRICTIONS_MAX_IMAGE_WIDTH]=0;au.upldr.DefaultValues[au.upldr.Properties.RESTRICTIONS_MIN_IMAGE_WIDTH]=0;au.upldr.DefaultValues[au.upldr.Properties.RESTRICTIONS_MAX_IMAGE_HEIGHT]=0;au.upldr.DefaultValues[au.upldr.Properties.RESTRICTIONS_MIN_IMAGE_HEIGHT]=0;au.upldr.DefaultValues[au.upldr.Properties.RESTRICTIONS_MIN_FILE_COUNT]=1;au.upldr.DefaultValues[au.upldr.Properties.ADD_FILES_PROGRESS_DIALOG_TEXT]="Adding files to upload list...";au.upldr.DefaultValues[au.upldr.Properties.ADD_FILES_PROGRESS_DIALOG_WAIT_TEXT]="Please wait, it may take some time...";au.upldr.DefaultValues[au.upldr.Properties.COMMON_DIALOG_CANCEL_BUTTON_TEXT]="Cancel";au.upldr.DefaultValues[au.upldr.Properties.COMMON_DIALOG_OK_BUTTON_TEXT]="OK";au.upldr.DefaultValues[au.upldr.Properties.FILE_NAME_NOT_ALLOWED_MSG]='The file "{0}" cannot be added. The website doesn\'t accept files of this type.';au.upldr.DefaultValues[au.upldr.Properties.TOO_MANY_FILES_MSG]="Not all files were added. You are allowed to upload no more than {0} file(s).";au.upldr.DefaultValues[au.upldr.Properties.MAX_TOTAL_FILE_SIZE_EXCEEDED_MSG]="Not all files were added. Maximum total file size ({0}) was exceeded.";au.upldr.DefaultValues[au.upldr.Properties.FILE_SIZE_TOO_LARGE_MSG]='Size of "{0}" is too large to be added. Maximum allowed size is {1}.';au.upldr.DefaultValues[au.upldr.Properties.FILE_SIZE_TOO_SMALL_MSG]='Size of "{0}" is too small to be added. Minimum allowed size is {1}.';au.upldr.DefaultValues[au.upldr.Properties.DIMENSIONS_TOO_LARGE_MSG]='Dimensions of "{0}" are too large, the file wasn\'t added. Maximum allowed image dimensions are {1}x{2} pixels.';au.upldr.DefaultValues[au.upldr.Properties.DIMENSIONS_TOO_SMALL_MSG]='Dimensions of "{0}" are too small, the file wasn\'t added. Minimum allowed image dimensions are {1}x{2} pixels.';au.upldr.DefaultValues[au.upldr.Properties.FILES_NOT_ADDED_MSG]="{0} files were not added due to restrictions of the site.";au.upldr.DefaultValues[au.upldr.Properties.TOO_FEW_FILES_MSG]="At least {0} files should be selected to start upload.";au.upldr.DefaultValues[au.upldr.Properties.DND_FOLDER_FILE_LIMIT_EXCEEDED_MSG]="Some files might be skipped in {0} due to Chrome limit (<100 files per folder). Use Add Folder button to avoid this limit.";au.upldr.DefaultValues[au.upldr.Properties.UPLOAD_ERROR_MSG]="Uploader encountered some problem. If you see this message, contact web master.";au.upldr.DefaultValues[au.upldr.Properties.SERVER_NOT_FOUND_MSG]="The server or proxy {0} cannot be found.";au.upldr.DefaultValues[au.upldr.Properties.SERVER_SIDE_ERROR_MSG]="Some server-side error occurred. If you see this message, contact your Web master.";au.upldr.DefaultValues[au.upldr.Properties.UPLOAD_CANCELLED_BY_USER_MSG]="Uploading is cancelled by user.";au.upldr.DefaultValues[au.upldr.Properties.UPLOAD_CANCELLED_BY_CANCEL_METHOD_MSG]='Uploading is cancelled by "cancelUpload" method.';au.upldr.DefaultValues[au.upldr.Properties.UPLOAD_CANCELLED_FROM_AFTER_PACKAGE_UPLOAD_EVENT_METHOD_MSG]="Upload cancelled from AfterPackageUpload event handler.";au.upldr.DefaultValues[au.upldr.Properties.CLOSE_PREVIEW_TOOLTIP]="Click to close";au.upldr.DefaultValues[au.upldr.Properties.CLIP_BOARD_FILE_NAME]="clipboard-[{0}]";au.upldr.DefaultValues[au.upldr.Properties.UPLOAD_PANE_ICON_ITEM_WIDTH]=0;au.upldr.DefaultValues[au.upldr.Properties.UPLOAD_PANE_ICON_SIZE]=28;au.upldr.DefaultValues[au.upldr.Properties.UPLOAD_PANE_THUMBNAIL_PREVIEW_SIZE]=120;au.upldr.DefaultValues[au.upldr.Properties.UPLOAD_PANE_TILE_ITEM_WIDTH]=0;au.upldr.DefaultValues[au.upldr.Properties.UPLOAD_PANE_TILE_PREVIEW_SIZE]=100;au.upldr.DefaultValues[au.upldr.Properties.INSTANT_UPLOAD]=false;au.upldr.DefaultValues[au.upldr.Properties.TOP_PANE_VISIBILITY]=true;au.upldr.DefaultValues[au.upldr.Properties.STATUS_PANE_VISIBILITY]=true;au.upldr.DefaultValues[au.upldr.Properties.ENABLE_ALL_STANDART_FIELDS]=true;au.upldr.DefaultValues[au.upldr.Properties.ENABLE_IMAGE_EDITOR]=false;au.upldr.DefaultValues[au.upldr.Properties.IMAGE_EDITOR_ENABLE_CROP]=true;au.upldr.DefaultValues[au.upldr.Properties.IMAGE_EDITOR_ENABLE_DRAW_TOOL]=false;au.upldr.DefaultValues[au.upldr.Properties.IMAGE_EDITOR_ALBUM_ORIENTATION]=true;au.upldr.DefaultValues[au.upldr.Properties.IMAGE_EDITOR_CROP_MIN_SIZE]=50;au.upldr.DefaultValues[au.upldr.Properties.IMAGE_EDITOR_CROP_RATIO]="";au.upldr.DefaultValues[au.upldr.Properties.IMAGE_EDITOR_DRAW_TOOL]=new au.upldr.imaging.imageEditor.DrawAreaConfig();au.upldr.DefaultValues[au.upldr.Properties.IMAGE_EDITOR_DEFAULT_TOOL]="crop";au.upldr.DefaultValues[au.upldr.Properties.FILE_NAMES_URL_ENCODED]=false;au.upldr.DefaultValues[au.upldr.Properties.ENABLE_EXIF_PREVIEW]=true;au.upldr.InternalDefaultValues={};au.upldr.InternalDefaultValues[au.upldr.InternalProperties.UPLOADER_STATE]=au.upldr.UploaderState.IDLE;au.upldr.InternalDefaultValues[au.upldr.InternalProperties.UPLOAD_PROGRESS]=new au.upldr.UploadProgress();goog.provide("goog.events.EventId");goog.events.EventId=function(a){this.id=a};goog.events.EventId.prototype.toString=function(){return this.id};goog.provide("goog.events.Listenable");goog.provide("goog.events.ListenableKey");goog.require("goog.events.EventId");goog.events.Listenable=function(){};goog.events.Listenable.IMPLEMENTED_BY_PROP="closure_listenable_"+((Math.random()*1000000)|0);goog.events.Listenable.addImplementation=function(a){a.prototype[goog.events.Listenable.IMPLEMENTED_BY_PROP]=true};goog.events.Listenable.isImplementedBy=function(a){return !!(a&&a[goog.events.Listenable.IMPLEMENTED_BY_PROP])};goog.events.Listenable.prototype.listen;goog.events.Listenable.prototype.listenOnce;goog.events.Listenable.prototype.unlisten;goog.events.Listenable.prototype.unlistenByKey;goog.events.Listenable.prototype.dispatchEvent;goog.events.Listenable.prototype.removeAllListeners;goog.events.Listenable.prototype.getParentEventTarget;goog.events.Listenable.prototype.fireListeners;goog.events.Listenable.prototype.getListeners;goog.events.Listenable.prototype.getListener;goog.events.Listenable.prototype.hasListener;goog.events.ListenableKey=function(){};goog.events.ListenableKey.counter_=0;goog.events.ListenableKey.reserveKey=function(){return ++goog.events.ListenableKey.counter_};goog.events.ListenableKey.prototype.src;goog.events.ListenableKey.prototype.type;goog.events.ListenableKey.prototype.listener;goog.events.ListenableKey.prototype.capture;goog.events.ListenableKey.prototype.handler;goog.events.ListenableKey.prototype.key;goog.provide("goog.events.Listener");goog.require("goog.events.ListenableKey");goog.events.Listener=function(d,b,f,c,a,e){if(goog.events.Listener.ENABLE_MONITORING){this.creationStack=new Error().stack}this.listener=d;this.proxy=b;this.src=f;this.type=c;this.capture=!!a;this.handler=e;this.key=goog.events.ListenableKey.reserveKey();this.callOnce=false;this.removed=false};goog.define("goog.events.Listener.ENABLE_MONITORING",false);goog.events.Listener.prototype.creationStack;goog.events.Listener.prototype.markAsRemoved=function(){this.removed=true;this.listener=null;this.proxy=null;this.src=null;this.handler=null};goog.provide("goog.events.ListenerMap");goog.require("goog.array");goog.require("goog.events.Listener");goog.require("goog.object");goog.events.ListenerMap=function(a){this.src=a;this.listeners={};this.typeCount_=0};goog.events.ListenerMap.prototype.getTypeCount=function(){return this.typeCount_};goog.events.ListenerMap.prototype.getListenerCount=function(){var b=0;for(var a in this.listeners){b+=this.listeners[a].length}return b};goog.events.ListenerMap.prototype.add=function(f,a,i,e,h){var g=f.toString();var c=this.listeners[g];if(!c){c=this.listeners[g]=[];this.typeCount_++}var b;var d=goog.events.ListenerMap.findListenerIndex_(c,a,e,h);if(d>-1){b=c[d];if(!i){b.callOnce=false}}else{b=new goog.events.Listener(a,null,this.src,g,!!e,h);b.callOnce=i;c.push(b)}return b};goog.events.ListenerMap.prototype.remove=function(d,e,h,g){var b=d.toString();if(!(b in this.listeners)){return false}var a=this.listeners[b];var c=goog.events.ListenerMap.findListenerIndex_(a,e,h,g);if(c>-1){var f=a[c];f.markAsRemoved();goog.array.removeAt(a,c);if(a.length==0){delete this.listeners[b];this.typeCount_--}return true}return false};goog.events.ListenerMap.prototype.removeByKey=function(b){var a=b.type;if(!(a in this.listeners)){return false}var c=goog.array.remove(this.listeners[a],b);if(c){b.markAsRemoved();if(this.listeners[a].length==0){delete this.listeners[a];this.typeCount_--}}return c};goog.events.ListenerMap.prototype.removeAll=function(f){var b=f&&f.toString();var e=0;for(var d in this.listeners){if(!b||d==b){var a=this.listeners[d];for(var c=0;c<a.length;c++){++e;a[c].markAsRemoved()}delete this.listeners[d];this.typeCount_--}}return e};goog.events.ListenerMap.prototype.getListeners=function(d,b){var a=this.listeners[d.toString()];var f=[];if(a){for(var c=0;c<a.length;++c){var e=a[c];if(e.capture==b){f.push(e)}}}return f};goog.events.ListenerMap.prototype.getListener=function(d,e,b,f){var a=this.listeners[d.toString()];var c=-1;if(a){c=goog.events.ListenerMap.findListenerIndex_(a,e,b,f)}return c>-1?a[c]:null};goog.events.ListenerMap.prototype.hasListener=function(e,c){var b=goog.isDef(e);var a=b?e.toString():"";var d=goog.isDef(c);return goog.object.some(this.listeners,function(f,h){for(var g=0;g<f.length;++g){if((!b||f[g].type==a)&&(!d||f[g].capture==c)){return true}}return false})};goog.events.ListenerMap.findListenerIndex_=function(a,c,f,e){for(var b=0;b<a.length;++b){var d=a[b];if(!d.removed&&d.listener==c&&d.capture==!!f&&d.handler==e){return b}}return -1};goog.provide("goog.events.BrowserFeature");goog.require("goog.userAgent");goog.events.BrowserFeature={HAS_W3C_BUTTON:!goog.userAgent.IE||goog.userAgent.isDocumentModeOrHigher(9),HAS_W3C_EVENT_SUPPORT:!goog.userAgent.IE||goog.userAgent.isDocumentModeOrHigher(9),SET_KEY_CODE_TO_PREVENT_DEFAULT:goog.userAgent.IE&&!goog.userAgent.isVersionOrHigher("9"),HAS_NAVIGATOR_ONLINE_PROPERTY:!goog.userAgent.WEBKIT||goog.userAgent.isVersionOrHigher("528"),HAS_HTML5_NETWORK_EVENT_SUPPORT:goog.userAgent.GECKO&&goog.userAgent.isVersionOrHigher("1.9b")||goog.userAgent.IE&&goog.userAgent.isVersionOrHigher("8")||goog.userAgent.OPERA&&goog.userAgent.isVersionOrHigher("9.5")||goog.userAgent.WEBKIT&&goog.userAgent.isVersionOrHigher("528"),HTML5_NETWORK_EVENTS_FIRE_ON_BODY:goog.userAgent.GECKO&&!goog.userAgent.isVersionOrHigher("8")||goog.userAgent.IE&&!goog.userAgent.isVersionOrHigher("9"),TOUCH_ENABLED:("ontouchstart" in goog.global||!!(goog.global.document&&document.documentElement&&"ontouchstart" in document.documentElement)||!!(goog.global.navigator&&goog.global.navigator["msMaxTouchPoints"]))};goog.provide("goog.debug.EntryPointMonitor");goog.provide("goog.debug.entryPointRegistry");goog.require("goog.asserts");goog.debug.EntryPointMonitor=function(){};goog.debug.EntryPointMonitor.prototype.wrap;goog.debug.EntryPointMonitor.prototype.unwrap;goog.debug.entryPointRegistry.refList_=[];goog.debug.entryPointRegistry.monitors_=[];goog.debug.entryPointRegistry.monitorsMayExist_=false;goog.debug.entryPointRegistry.register=function(c){goog.debug.entryPointRegistry.refList_[goog.debug.entryPointRegistry.refList_.length]=c;if(goog.debug.entryPointRegistry.monitorsMayExist_){var b=goog.debug.entryPointRegistry.monitors_;for(var a=0;a<b.length;a++){c(goog.bind(b[a].wrap,b[a]))}}};goog.debug.entryPointRegistry.monitorAll=function(b){goog.debug.entryPointRegistry.monitorsMayExist_=true;var a=goog.bind(b.wrap,b);for(var c=0;c<goog.debug.entryPointRegistry.refList_.length;c++){goog.debug.entryPointRegistry.refList_[c](a)}goog.debug.entryPointRegistry.monitors_.push(b)};goog.debug.entryPointRegistry.unmonitorAllIfPossible=function(b){var d=goog.debug.entryPointRegistry.monitors_;goog.asserts.assert(b==d[d.length-1],"Only the most recent monitor can be unwrapped.");var a=goog.bind(b.unwrap,b);for(var c=0;c<goog.debug.entryPointRegistry.refList_.length;c++){goog.debug.entryPointRegistry.refList_[c](a)}d.length--};goog.provide("goog.events.EventType");goog.require("goog.userAgent");goog.events.getVendorPrefixedName_=function(a){return goog.userAgent.WEBKIT?"webkit"+a:(goog.userAgent.OPERA?"o"+a.toLowerCase():a.toLowerCase())};goog.events.EventType={CLICK:"click",RIGHTCLICK:"rightclick",DBLCLICK:"dblclick",MOUSEDOWN:"mousedown",MOUSEUP:"mouseup",MOUSEOVER:"mouseover",MOUSEOUT:"mouseout",MOUSEMOVE:"mousemove",MOUSEENTER:"mouseenter",MOUSELEAVE:"mouseleave",SELECTSTART:"selectstart",WHEEL:"wheel",KEYPRESS:"keypress",KEYDOWN:"keydown",KEYUP:"keyup",BLUR:"blur",FOCUS:"focus",DEACTIVATE:"deactivate",FOCUSIN:goog.userAgent.IE?"focusin":"DOMFocusIn",FOCUSOUT:goog.userAgent.IE?"focusout":"DOMFocusOut",CHANGE:"change",SELECT:"select",SUBMIT:"submit",INPUT:"input",PROPERTYCHANGE:"propertychange",DRAGSTART:"dragstart",DRAG:"drag",DRAGENTER:"dragenter",DRAGOVER:"dragover",DRAGLEAVE:"dragleave",DROP:"drop",DRAGEND:"dragend",TOUCHSTART:"touchstart",TOUCHMOVE:"touchmove",TOUCHEND:"touchend",TOUCHCANCEL:"touchcancel",BEFOREUNLOAD:"beforeunload",CONSOLEMESSAGE:"consolemessage",CONTEXTMENU:"contextmenu",DOMCONTENTLOADED:"DOMContentLoaded",ERROR:"error",HELP:"help",LOAD:"load",LOSECAPTURE:"losecapture",ORIENTATIONCHANGE:"orientationchange",READYSTATECHANGE:"readystatechange",RESIZE:"resize",SCROLL:"scroll",UNLOAD:"unload",HASHCHANGE:"hashchange",PAGEHIDE:"pagehide",PAGESHOW:"pageshow",POPSTATE:"popstate",COPY:"copy",PASTE:"paste",CUT:"cut",BEFORECOPY:"beforecopy",BEFORECUT:"beforecut",BEFOREPASTE:"beforepaste",ONLINE:"online",OFFLINE:"offline",MESSAGE:"message",CONNECT:"connect",ANIMATIONSTART:goog.events.getVendorPrefixedName_("AnimationStart"),ANIMATIONEND:goog.events.getVendorPrefixedName_("AnimationEnd"),ANIMATIONITERATION:goog.events.getVendorPrefixedName_("AnimationIteration"),TRANSITIONEND:goog.events.getVendorPrefixedName_("TransitionEnd"),POINTERDOWN:"pointerdown",POINTERUP:"pointerup",POINTERCANCEL:"pointercancel",POINTERMOVE:"pointermove",POINTEROVER:"pointerover",POINTEROUT:"pointerout",POINTERENTER:"pointerenter",POINTERLEAVE:"pointerleave",GOTPOINTERCAPTURE:"gotpointercapture",LOSTPOINTERCAPTURE:"lostpointercapture",MSGESTURECHANGE:"MSGestureChange",MSGESTUREEND:"MSGestureEnd",MSGESTUREHOLD:"MSGestureHold",MSGESTURESTART:"MSGestureStart",MSGESTURETAP:"MSGestureTap",MSGOTPOINTERCAPTURE:"MSGotPointerCapture",MSINERTIASTART:"MSInertiaStart",MSLOSTPOINTERCAPTURE:"MSLostPointerCapture",MSPOINTERCANCEL:"MSPointerCancel",MSPOINTERDOWN:"MSPointerDown",MSPOINTERENTER:"MSPointerEnter",MSPOINTERHOVER:"MSPointerHover",MSPOINTERLEAVE:"MSPointerLeave",MSPOINTERMOVE:"MSPointerMove",MSPOINTEROUT:"MSPointerOut",MSPOINTEROVER:"MSPointerOver",MSPOINTERUP:"MSPointerUp",TEXT:"text",TEXTINPUT:"textInput",COMPOSITIONSTART:"compositionstart",COMPOSITIONUPDATE:"compositionupdate",COMPOSITIONEND:"compositionend",EXIT:"exit",LOADABORT:"loadabort",LOADCOMMIT:"loadcommit",LOADREDIRECT:"loadredirect",LOADSTART:"loadstart",LOADSTOP:"loadstop",RESPONSIVE:"responsive",SIZECHANGED:"sizechanged",UNRESPONSIVE:"unresponsive",VISIBILITYCHANGE:"visibilitychange",STORAGE:"storage",DOMSUBTREEMODIFIED:"DOMSubtreeModified",DOMNODEINSERTED:"DOMNodeInserted",DOMNODEREMOVED:"DOMNodeRemoved",DOMNODEREMOVEDFROMDOCUMENT:"DOMNodeRemovedFromDocument",DOMNODEINSERTEDINTODOCUMENT:"DOMNodeInsertedIntoDocument",DOMATTRMODIFIED:"DOMAttrModified",DOMCHARACTERDATAMODIFIED:"DOMCharacterDataModified"};goog.provide("goog.disposable.IDisposable");goog.disposable.IDisposable=function(){};goog.disposable.IDisposable.prototype.dispose=goog.abstractMethod;goog.disposable.IDisposable.prototype.isDisposed=goog.abstractMethod;goog.provide("goog.Disposable");goog.provide("goog.dispose");goog.provide("goog.disposeAll");goog.require("goog.disposable.IDisposable");goog.Disposable=function(){if(goog.Disposable.MONITORING_MODE!=goog.Disposable.MonitoringMode.OFF){if(goog.Disposable.INCLUDE_STACK_ON_CREATION){this.creationStack=new Error().stack}goog.Disposable.instances_[goog.getUid(this)]=this}this.disposed_=this.disposed_;this.onDisposeCallbacks_=this.onDisposeCallbacks_};goog.Disposable.MonitoringMode={OFF:0,PERMANENT:1,INTERACTIVE:2};goog.define("goog.Disposable.MONITORING_MODE",0);goog.define("goog.Disposable.INCLUDE_STACK_ON_CREATION",true);goog.Disposable.instances_={};goog.Disposable.getUndisposedObjects=function(){var a=[];for(var b in goog.Disposable.instances_){if(goog.Disposable.instances_.hasOwnProperty(b)){a.push(goog.Disposable.instances_[Number(b)])}}return a};goog.Disposable.clearUndisposedObjects=function(){goog.Disposable.instances_={}};goog.Disposable.prototype.disposed_=false;goog.Disposable.prototype.onDisposeCallbacks_;goog.Disposable.prototype.creationStack;goog.Disposable.prototype.isDisposed=function(){return this.disposed_};goog.Disposable.prototype.getDisposed=goog.Disposable.prototype.isDisposed;goog.Disposable.prototype.dispose=function(){if(!this.disposed_){this.disposed_=true;this.disposeInternal();if(goog.Disposable.MONITORING_MODE!=goog.Disposable.MonitoringMode.OFF){var a=goog.getUid(this);if(goog.Disposable.MONITORING_MODE==goog.Disposable.MonitoringMode.PERMANENT&&!goog.Disposable.instances_.hasOwnProperty(a)){throw Error(this+" did not call the goog.Disposable base constructor or was disposed of after a clearUndisposedObjects call")}delete goog.Disposable.instances_[a]}}};goog.Disposable.prototype.registerDisposable=function(a){this.addOnDisposeCallback(goog.partial(goog.dispose,a))};goog.Disposable.prototype.addOnDisposeCallback=function(b,a){if(this.disposed_){b.call(a);return}if(!this.onDisposeCallbacks_){this.onDisposeCallbacks_=[]}this.onDisposeCallbacks_.push(goog.isDef(a)?goog.bind(b,a):b)};goog.Disposable.prototype.disposeInternal=function(){if(this.onDisposeCallbacks_){while(this.onDisposeCallbacks_.length){this.onDisposeCallbacks_.shift()()}}};goog.Disposable.isDisposed=function(a){if(a&&typeof a.isDisposed=="function"){return a.isDisposed()}return false};goog.dispose=function(a){if(a&&typeof a.dispose=="function"){a.dispose()}};goog.disposeAll=function(d){for(var b=0,a=arguments.length;b<a;++b){var c=arguments[b];if(goog.isArrayLike(c)){goog.disposeAll.apply(null,c)}else{goog.dispose(c)}}};goog.provide("goog.events.Event");goog.provide("goog.events.EventLike");goog.require("goog.Disposable");goog.require("goog.events.EventId");goog.events.EventLike;goog.events.Event=function(b,a){this.type=b instanceof goog.events.EventId?String(b):b;this.target=a;this.currentTarget=this.target;this.propagationStopped_=false;this.defaultPrevented=false;this.returnValue_=true};goog.events.Event.prototype.stopPropagation=function(){this.propagationStopped_=true};goog.events.Event.prototype.preventDefault=function(){this.defaultPrevented=true;this.returnValue_=false};goog.events.Event.stopPropagation=function(a){a.stopPropagation()};goog.events.Event.preventDefault=function(a){a.preventDefault()};goog.provide("goog.reflect");goog.reflect.object=function(b,a){return a};goog.reflect.sinkValue=function(a){goog.reflect.sinkValue[" "](a);return a};goog.reflect.sinkValue[" "]=goog.nullFunction;goog.reflect.canAccessProperty=function(b,c){try{goog.reflect.sinkValue(b[c]);return true}catch(a){}return false};goog.provide("goog.events.BrowserEvent");goog.provide("goog.events.BrowserEvent.MouseButton");goog.require("goog.events.BrowserFeature");goog.require("goog.events.Event");goog.require("goog.events.EventType");goog.require("goog.reflect");goog.require("goog.userAgent");goog.events.BrowserEvent=function(b,a){goog.events.BrowserEvent.base(this,"constructor",b?b.type:"");this.target=null;this.currentTarget=null;this.relatedTarget=null;this.offsetX=0;this.offsetY=0;this.clientX=0;this.clientY=0;this.screenX=0;this.screenY=0;this.button=0;this.keyCode=0;this.charCode=0;this.ctrlKey=false;this.altKey=false;this.shiftKey=false;this.metaKey=false;this.state=null;this.platformModifierKey=false;this.event_=null;if(b){this.init(b,a)}};goog.inherits(goog.events.BrowserEvent,goog.events.Event);goog.events.BrowserEvent.MouseButton={LEFT:0,MIDDLE:1,RIGHT:2};goog.events.BrowserEvent.IEButtonMap=[1,4,2];goog.events.BrowserEvent.prototype.init=function(f,b){var d=this.type=f.type;var c=null;if(d==goog.events.EventType.TOUCHSTART||d==goog.events.EventType.TOUCHMOVE){c=f.targetTouches[0]}else{if(d==goog.events.EventType.TOUCHEND||d==goog.events.EventType.TOUCHCANCEL){c=f.changedTouches[0]}}this.target=goog.isNull(c)?(f.target)||f.srcElement:c.target;this.currentTarget=(b);var a=(f.relatedTarget);if(a){if(goog.userAgent.GECKO){if(!goog.reflect.canAccessProperty(a,"nodeName")){a=null}}}else{if(d==goog.events.EventType.MOUSEOVER){a=f.fromElement}else{if(d==goog.events.EventType.MOUSEOUT){a=f.toElement}}}this.relatedTarget=a;if(!goog.isNull(c)){this.clientX=c.clientX!==undefined?c.clientX:c.pageX;this.clientY=c.clientY!==undefined?c.clientY:c.pageY;this.screenX=c.screenX||0;this.screenY=c.screenY||0}else{this.offsetX=(goog.userAgent.WEBKIT||f.offsetX!==undefined)?f.offsetX:f.layerX;this.offsetY=(goog.userAgent.WEBKIT||f.offsetY!==undefined)?f.offsetY:f.layerY;this.clientX=f.clientX!==undefined?f.clientX:f.pageX;this.clientY=f.clientY!==undefined?f.clientY:f.pageY;this.screenX=f.screenX||0;this.screenY=f.screenY||0}this.button=f.button;this.keyCode=f.keyCode||0;this.charCode=f.charCode||(d=="keypress"?f.keyCode:0);this.ctrlKey=f.ctrlKey;this.altKey=f.altKey;this.shiftKey=f.shiftKey;this.metaKey=f.metaKey;this.platformModifierKey=goog.userAgent.MAC?f.metaKey:f.ctrlKey;this.state=f.state;this.event_=f;if(f.defaultPrevented){this.preventDefault()}};goog.events.BrowserEvent.prototype.isButton=function(a){if(!goog.events.BrowserFeature.HAS_W3C_BUTTON){if(this.type=="click"){return a==goog.events.BrowserEvent.MouseButton.LEFT}else{return !!(this.event_.button&goog.events.BrowserEvent.IEButtonMap[a])}}else{return this.event_.button==a}};goog.events.BrowserEvent.prototype.isMouseActionButton=function(){return this.isButton(goog.events.BrowserEvent.MouseButton.LEFT)&&!(goog.userAgent.WEBKIT&&goog.userAgent.MAC&&this.ctrlKey)};goog.events.BrowserEvent.prototype.stopPropagation=function(){goog.events.BrowserEvent.superClass_.stopPropagation.call(this);if(this.event_.stopPropagation){this.event_.stopPropagation()}else{this.event_.cancelBubble=true}};goog.events.BrowserEvent.prototype.preventDefault=function(){goog.events.BrowserEvent.superClass_.preventDefault.call(this);var d=this.event_;if(!d.preventDefault){d.returnValue=false;if(goog.events.BrowserFeature.SET_KEY_CODE_TO_PREVENT_DEFAULT){try{var a=112;var b=123;if(d.ctrlKey||d.keyCode>=a&&d.keyCode<=b){d.keyCode=-1}}catch(c){}}}else{d.preventDefault()}};goog.events.BrowserEvent.prototype.getBrowserEvent=function(){return this.event_};goog.provide("goog.events");goog.provide("goog.events.CaptureSimulationMode");goog.provide("goog.events.Key");goog.provide("goog.events.ListenableType");goog.require("goog.asserts");goog.require("goog.debug.entryPointRegistry");goog.require("goog.events.BrowserEvent");goog.require("goog.events.BrowserFeature");goog.require("goog.events.Listenable");goog.require("goog.events.ListenerMap");goog.forwardDeclare("goog.debug.ErrorHandler");goog.forwardDeclare("goog.events.EventWrapper");goog.events.Key;goog.events.ListenableType;goog.events.LISTENER_MAP_PROP_="closure_lm_"+((Math.random()*1000000)|0);goog.events.onString_="on";goog.events.onStringMap_={};goog.events.CaptureSimulationMode={OFF_AND_FAIL:0,OFF_AND_SILENT:1,ON:2};goog.define("goog.events.CAPTURE_SIMULATION_MODE",2);goog.events.listenerCountEstimate_=0;goog.events.listen=function(f,b,c,e,d){if(goog.isArray(b)){for(var a=0;a<b.length;a++){goog.events.listen(f,b[a],c,e,d)}return null}c=goog.events.wrapListener(c);if(goog.events.Listenable.isImplementedBy(f)){return f.listen((b),c,e,d)}else{return goog.events.listen_((f),(b),c,false,e,d)}};goog.events.listen_=function(a,f,b,i,d,j){if(!f){throw Error("Invalid event type")}var h=!!d;if(h&&!goog.events.BrowserFeature.HAS_W3C_EVENT_SUPPORT){if(goog.events.CAPTURE_SIMULATION_MODE==goog.events.CaptureSimulationMode.OFF_AND_FAIL){goog.asserts.fail("Can not register capture listener in IE8-.");return null}else{if(goog.events.CAPTURE_SIMULATION_MODE==goog.events.CaptureSimulationMode.OFF_AND_SILENT){return null}}}var g=goog.events.getListenerMap_(a);if(!g){a[goog.events.LISTENER_MAP_PROP_]=g=new goog.events.ListenerMap(a)}var c=g.add(f,b,i,d,j);if(c.proxy){return c}var e=goog.events.getProxy();c.proxy=e;e.src=a;e.listener=c;if(a.addEventListener){a.addEventListener(f.toString(),e,h)}else{a.attachEvent(goog.events.getOnString_(f.toString()),e)}goog.events.listenerCountEstimate_++;return c};goog.events.getProxy=function(){var a=goog.events.handleBrowserEvent_;var b=goog.events.BrowserFeature.HAS_W3C_EVENT_SUPPORT?function(c){return a.call(b.src,b.listener,c)}:function(c){var d=a.call(b.src,b.listener,c);if(!d){return d}};return b};goog.events.listenOnce=function(f,b,c,e,d){if(goog.isArray(b)){for(var a=0;a<b.length;a++){goog.events.listenOnce(f,b[a],c,e,d)}return null}c=goog.events.wrapListener(c);if(goog.events.Listenable.isImplementedBy(f)){return f.listenOnce((b),c,e,d)}else{return goog.events.listen_((f),(b),c,true,e,d)}};goog.events.listenWithWrapper=function(d,e,a,c,b){e.listen(d,a,c,b)};goog.events.unlisten=function(a,f,b,d,j){if(goog.isArray(f)){for(var e=0;e<f.length;e++){goog.events.unlisten(a,f[e],b,d,j)}return null}b=goog.events.wrapListener(b);if(goog.events.Listenable.isImplementedBy(a)){return a.unlisten((f),b,d,j)}if(!a){return false}var h=!!d;var g=goog.events.getListenerMap_((a));if(g){var c=g.getListener((f),b,h,j);if(c){return goog.events.unlistenByKey(c)}}return false};goog.events.unlistenByKey=function(b){if(goog.isNumber(b)){return false}var d=(b);if(!d||d.removed){return false}var f=d.src;if(goog.events.Listenable.isImplementedBy(f)){return f.unlistenByKey(d)}var c=d.type;var a=d.proxy;if(f.removeEventListener){f.removeEventListener(c,a,d.capture)}else{if(f.detachEvent){f.detachEvent(goog.events.getOnString_(c),a)}}goog.events.listenerCountEstimate_--;var e=goog.events.getListenerMap_((f));if(e){e.removeByKey(d);if(e.getTypeCount()==0){e.src=null;f[goog.events.LISTENER_MAP_PROP_]=null}}else{d.markAsRemoved()}return true};goog.events.unlistenWithWrapper=function(d,e,a,c,b){e.unlisten(d,a,c,b)};goog.events.removeAll=function(f,h){if(!f){return 0}if(goog.events.Listenable.isImplementedBy(f)){return f.removeAllListeners(h)}var g=goog.events.getListenerMap_((f));if(!g){return 0}var e=0;var a=h&&h.toString();for(var d in g.listeners){if(!a||d==a){var c=g.listeners[d].concat();for(var b=0;b<c.length;++b){if(goog.events.unlistenByKey(c[b])){++e}}}}return e};goog.events.getListeners=function(c,b,a){if(goog.events.Listenable.isImplementedBy(c)){return c.getListeners(b,a)}else{if(!c){return[]}var d=goog.events.getListenerMap_((c));return d?d.getListeners(b,a):[]}};goog.events.getListener=function(g,b,c,f,e){b=(b);c=goog.events.wrapListener(c);var a=!!f;if(goog.events.Listenable.isImplementedBy(g)){return g.getListener(b,c,a,e)}if(!g){return null}var d=goog.events.getListenerMap_((g));if(d){return d.getListener(b,c,a,e)}return null};goog.events.hasListener=function(b,d,a){if(goog.events.Listenable.isImplementedBy(b)){return b.hasListener(d,a)}var c=goog.events.getListenerMap_((b));return !!c&&c.hasListener(d,a)};goog.events.expose=function(b){var c=[];for(var a in b){if(b[a]&&b[a].id){c.push(a+" = "+b[a]+" ("+b[a].id+")")}else{c.push(a+" = "+b[a])}}return c.join("\n")};goog.events.getOnString_=function(a){if(a in goog.events.onStringMap_){return goog.events.onStringMap_[a]}return goog.events.onStringMap_[a]=goog.events.onString_+a};goog.events.fireListeners=function(d,c,b,a){if(goog.events.Listenable.isImplementedBy(d)){return d.fireListeners(c,b,a)}return goog.events.fireListeners_(d,c,b,a)};goog.events.fireListeners_=function(d,g,j,c){var a=true;var h=goog.events.getListenerMap_((d));if(h){var f=h.listeners[g.toString()];if(f){f=f.concat();for(var e=0;e<f.length;e++){var b=f[e];if(b&&b.capture==j&&!b.removed){var k=goog.events.fireListener(b,c);a=a&&(k!==false)}}}}return a};goog.events.fireListener=function(c,b){var a=c.listener;var d=c.handler||c.src;if(c.callOnce){goog.events.unlistenByKey(c)}return a.call(d,b)};goog.events.getTotalListenerCount=function(){return goog.events.listenerCountEstimate_};goog.events.dispatchEvent=function(b,a){goog.asserts.assert(goog.events.Listenable.isImplementedBy(b),"Can not use goog.events.dispatchEvent with non-goog.events.Listenable instance.");return b.dispatchEvent(a)};goog.events.protectBrowserEventEntryPoint=function(a){goog.events.handleBrowserEvent_=a.protectEntryPoint(goog.events.handleBrowserEvent_)};goog.events.handleBrowserEvent_=function(b,d){if(b.removed){return true}if(!goog.events.BrowserFeature.HAS_W3C_EVENT_SUPPORT){var f=d||(goog.getObjectByName("window.event"));var h=new goog.events.BrowserEvent(f,this);var a=true;if(goog.events.CAPTURE_SIMULATION_MODE==goog.events.CaptureSimulationMode.ON){if(!goog.events.isMarkedIeEvent_(f)){goog.events.markIeEvent_(f);var k=[];for(var g=h.currentTarget;g;g=g.parentNode){k.push(g)}var e=b.type;for(var c=k.length-1;!h.propagationStopped_&&c>=0;c--){h.currentTarget=k[c];var j=goog.events.fireListeners_(k[c],e,true,h);a=a&&j}for(var c=0;!h.propagationStopped_&&c<k.length;c++){h.currentTarget=k[c];var j=goog.events.fireListeners_(k[c],e,false,h);a=a&&j}}}else{a=goog.events.fireListener(b,h)}return a}return goog.events.fireListener(b,new goog.events.BrowserEvent(d,this))};goog.events.markIeEvent_=function(b){var c=false;if(b.keyCode==0){try{b.keyCode=-1;return}catch(a){c=true}}if(c||(b.returnValue)==undefined){b.returnValue=true}};goog.events.isMarkedIeEvent_=function(a){return a.keyCode<0||a.returnValue!=undefined};goog.events.uniqueIdCounter_=0;goog.events.getUniqueId=function(a){return a+"_"+goog.events.uniqueIdCounter_++};goog.events.getListenerMap_=function(b){var a=b[goog.events.LISTENER_MAP_PROP_];return a instanceof goog.events.ListenerMap?a:null};goog.events.LISTENER_WRAPPER_PROP_="__closure_events_fn_"+((Math.random()*1000000000)>>>0);goog.events.wrapListener=function(a){goog.asserts.assert(a,"Listener can not be null.");if(goog.isFunction(a)){return a}goog.asserts.assert(a.handleEvent,"An object listener must have handleEvent method.");if(!a[goog.events.LISTENER_WRAPPER_PROP_]){a[goog.events.LISTENER_WRAPPER_PROP_]=function(b){return a.handleEvent(b)}}return a[goog.events.LISTENER_WRAPPER_PROP_]};goog.debug.entryPointRegistry.register(function(a){goog.events.handleBrowserEvent_=a(goog.events.handleBrowserEvent_)});goog.provide("goog.events.EventHandler");goog.require("goog.Disposable");goog.require("goog.events");goog.require("goog.object");goog.forwardDeclare("goog.events.EventWrapper");goog.events.EventHandler=function(a){goog.Disposable.call(this);this.handler_=a;this.keys_={}};goog.inherits(goog.events.EventHandler,goog.Disposable);goog.events.EventHandler.typeArray_=[];goog.events.EventHandler.prototype.listen=function(d,b,a,c){return this.listen_(d,b,a,c)};goog.events.EventHandler.prototype.listenWithScope=function(e,d,c,a,b){return this.listen_(e,d,c,a,b)};goog.events.EventHandler.prototype.listen_=function(h,e,d,f,a){if(!goog.isArray(e)){if(e){goog.events.EventHandler.typeArray_[0]=e.toString()}e=goog.events.EventHandler.typeArray_}for(var c=0;c<e.length;c++){var g=goog.events.listen(h,e[c],d||this.handleEvent,f||false,a||this.handler_||this);if(!g){return this}var b=g.key;this.keys_[b]=g}return this};goog.events.EventHandler.prototype.listenOnce=function(d,b,a,c){return this.listenOnce_(d,b,a,c)};goog.events.EventHandler.prototype.listenOnceWithScope=function(e,d,c,a,b){return this.listenOnce_(e,d,c,a,b)};goog.events.EventHandler.prototype.listenOnce_=function(h,e,d,f,a){if(goog.isArray(e)){for(var c=0;c<e.length;c++){this.listenOnce_(h,e[c],d,f,a)}}else{var g=goog.events.listenOnce(h,e,d||this.handleEvent,f,a||this.handler_||this);if(!g){return this}var b=g.key;this.keys_[b]=g}return this};goog.events.EventHandler.prototype.listenWithWrapper=function(c,d,a,b){return this.listenWithWrapper_(c,d,a,b)};goog.events.EventHandler.prototype.listenWithWrapperAndScope=function(d,e,c,a,b){return this.listenWithWrapper_(d,e,c,a,b)};goog.events.EventHandler.prototype.listenWithWrapper_=function(d,e,b,c,a){e.listen(d,b,c,a||this.handler_||this,this);return this};goog.events.EventHandler.prototype.getListenerCount=function(){var b=0;for(var a in this.keys_){if(Object.prototype.hasOwnProperty.call(this.keys_,a)){b++}}return b};goog.events.EventHandler.prototype.unlisten=function(g,d,c,e,a){if(goog.isArray(d)){for(var b=0;b<d.length;b++){this.unlisten(g,d[b],c,e,a)}}else{var f=goog.events.getListener(g,d,c||this.handleEvent,e,a||this.handler_||this);if(f){goog.events.unlistenByKey(f);delete this.keys_[f.key]}}return this};goog.events.EventHandler.prototype.unlistenWithWrapper=function(d,e,b,c,a){e.unlisten(d,b,c,a||this.handler_||this,this);return this};goog.events.EventHandler.prototype.removeAll=function(){goog.object.forEach(this.keys_,goog.events.unlistenByKey);this.keys_={}};goog.events.EventHandler.prototype.disposeInternal=function(){goog.events.EventHandler.superClass_.disposeInternal.call(this);this.removeAll()};goog.events.EventHandler.prototype.handleEvent=function(a){throw Error("EventHandler.handleEvent not implemented")};goog.provide("goog.fs.url");goog.fs.url.createObjectUrl=function(a){return goog.fs.url.getUrlObject_().createObjectURL(a)};goog.fs.url.revokeObjectUrl=function(a){goog.fs.url.getUrlObject_().revokeObjectURL(a)};goog.fs.url.UrlObject_;goog.fs.url.getUrlObject_=function(){var a=goog.fs.url.findUrlObject_();if(a!=null){return a}else{throw Error("This browser doesn't seem to support blob URLs")}};goog.fs.url.findUrlObject_=function(){if(goog.isDef(goog.global.URL)&&goog.isDef(goog.global.URL.createObjectURL)){return(goog.global.URL)}else{if(goog.isDef(goog.global.webkitURL)&&goog.isDef(goog.global.webkitURL.createObjectURL)){return(goog.global.webkitURL)}else{if(goog.isDef(goog.global.createObjectURL)){return(goog.global)}else{return null}}}};goog.fs.url.browserSupportsObjectUrls=function(){return goog.fs.url.findUrlObject_()!=null};goog.provide("goog.fs.ProgressEvent");goog.require("goog.events.Event");goog.fs.ProgressEvent=function(a,b){goog.fs.ProgressEvent.base(this,"constructor",a.type,b);this.event_=a};goog.inherits(goog.fs.ProgressEvent,goog.events.Event);goog.fs.ProgressEvent.prototype.isLengthComputable=function(){return this.event_.lengthComputable};goog.fs.ProgressEvent.prototype.getLoaded=function(){return this.event_.loaded};goog.fs.ProgressEvent.prototype.getTotal=function(){return this.event_.total};goog.provide("goog.fs.Error");goog.provide("goog.fs.Error.ErrorCode");goog.require("goog.debug.Error");goog.require("goog.object");goog.require("goog.string");goog.fs.Error=function(a,b){this.name;this.code;if(goog.isDef(a.name)){this.name=a.name;this.code=goog.fs.Error.getCodeFromName_(a.name)}else{this.code=a.code;this.name=goog.fs.Error.getNameFromCode_(a.code)}goog.fs.Error.base(this,"constructor",goog.string.subs("%s %s",this.name,b))};goog.inherits(goog.fs.Error,goog.debug.Error);goog.fs.Error.ErrorName={ABORT:"AbortError",ENCODING:"EncodingError",INVALID_MODIFICATION:"InvalidModificationError",INVALID_STATE:"InvalidStateError",NOT_FOUND:"NotFoundError",NOT_READABLE:"NotReadableError",NO_MODIFICATION_ALLOWED:"NoModificationAllowedError",PATH_EXISTS:"PathExistsError",QUOTA_EXCEEDED:"QuotaExceededError",SECURITY:"SecurityError",SYNTAX:"SyntaxError",TYPE_MISMATCH:"TypeMismatchError"};goog.fs.Error.ErrorCode={NOT_FOUND:1,SECURITY:2,ABORT:3,NOT_READABLE:4,ENCODING:5,NO_MODIFICATION_ALLOWED:6,INVALID_STATE:7,SYNTAX:8,INVALID_MODIFICATION:9,QUOTA_EXCEEDED:10,TYPE_MISMATCH:11,PATH_EXISTS:12};goog.fs.Error.getNameFromCode_=function(b){var a=goog.object.findKey(goog.fs.Error.NameToCodeMap_,function(d){return b==d});if(!goog.isDef(a)){throw new Error("Invalid code: "+b)}return a};goog.fs.Error.getCodeFromName_=function(a){return goog.fs.Error.NameToCodeMap_[a]};goog.fs.Error.NameToCodeMap_=goog.object.create(goog.fs.Error.ErrorName.ABORT,goog.fs.Error.ErrorCode.ABORT,goog.fs.Error.ErrorName.ENCODING,goog.fs.Error.ErrorCode.ENCODING,goog.fs.Error.ErrorName.INVALID_MODIFICATION,goog.fs.Error.ErrorCode.INVALID_MODIFICATION,goog.fs.Error.ErrorName.INVALID_STATE,goog.fs.Error.ErrorCode.INVALID_STATE,goog.fs.Error.ErrorName.NOT_FOUND,goog.fs.Error.ErrorCode.NOT_FOUND,goog.fs.Error.ErrorName.NOT_READABLE,goog.fs.Error.ErrorCode.NOT_READABLE,goog.fs.Error.ErrorName.NO_MODIFICATION_ALLOWED,goog.fs.Error.ErrorCode.NO_MODIFICATION_ALLOWED,goog.fs.Error.ErrorName.PATH_EXISTS,goog.fs.Error.ErrorCode.PATH_EXISTS,goog.fs.Error.ErrorName.QUOTA_EXCEEDED,goog.fs.Error.ErrorCode.QUOTA_EXCEEDED,goog.fs.Error.ErrorName.SECURITY,goog.fs.Error.ErrorCode.SECURITY,goog.fs.Error.ErrorName.SYNTAX,goog.fs.Error.ErrorCode.SYNTAX,goog.fs.Error.ErrorName.TYPE_MISMATCH,goog.fs.Error.ErrorCode.TYPE_MISMATCH);goog.provide("goog.promise.Resolver");goog.promise.Resolver=function(){};goog.promise.Resolver.prototype.promise;goog.promise.Resolver.prototype.resolve;goog.promise.Resolver.prototype.reject;goog.provide("goog.async.FreeList");goog.async.FreeList=goog.defineClass(null,{constructor:function(b,c,a){this.limit_=a;this.create_=b;this.reset_=c;this.occupants_=0;this.head_=null},get:function(){var a;if(this.occupants_>0){this.occupants_--;a=this.head_;this.head_=a.next;a.next=null}else{a=this.create_()}return a},put:function(a){this.reset_(a);if(this.occupants_<this.limit_){this.occupants_++;a.next=this.head_;this.head_=a}},occupants:function(){return this.occupants_}});goog.provide("goog.async.WorkItem");goog.provide("goog.async.WorkQueue");goog.require("goog.asserts");goog.require("goog.async.FreeList");goog.async.WorkQueue=function(){this.workHead_=null;this.workTail_=null};goog.define("goog.async.WorkQueue.DEFAULT_MAX_UNUSED",100);goog.async.WorkQueue.freelist_=new goog.async.FreeList(function(){return new goog.async.WorkItem()},function(a){a.reset()},goog.async.WorkQueue.DEFAULT_MAX_UNUSED);goog.async.WorkQueue.prototype.add=function(b,a){var c=this.getUnusedItem_();c.set(b,a);if(this.workTail_){this.workTail_.next=c;this.workTail_=c}else{goog.asserts.assert(!this.workHead_);this.workHead_=c;this.workTail_=c}};goog.async.WorkQueue.prototype.remove=function(){var a=null;if(this.workHead_){a=this.workHead_;this.workHead_=this.workHead_.next;if(!this.workHead_){this.workTail_=null}a.next=null}return a};goog.async.WorkQueue.prototype.returnUnused=function(a){goog.async.WorkQueue.freelist_.put(a)};goog.async.WorkQueue.prototype.getUnusedItem_=function(){return goog.async.WorkQueue.freelist_.get()};goog.async.WorkItem=function(){this.fn=null;this.scope=null;this.next=null};goog.async.WorkItem.prototype.set=function(b,a){this.fn=b;this.scope=a;this.next=null};goog.async.WorkItem.prototype.reset=function(){this.fn=null;this.scope=null;this.next=null};goog.provide("goog.testing.watchers");goog.testing.watchers.resetWatchers_=[];goog.testing.watchers.signalClockReset=function(){var b=goog.testing.watchers.resetWatchers_;for(var a=0;a<b.length;a++){goog.testing.watchers.resetWatchers_[a]()}};goog.testing.watchers.watchClockReset=function(a){goog.testing.watchers.resetWatchers_.push(a)};goog.provide("goog.functions");goog.functions.constant=function(a){return function(){return a}};goog.functions.FALSE=goog.functions.constant(false);goog.functions.TRUE=goog.functions.constant(true);goog.functions.NULL=goog.functions.constant(null);goog.functions.identity=function(b,a){return b};goog.functions.error=function(a){return function(){throw Error(a)}};goog.functions.fail=function(a){return function(){throw a}};goog.functions.lock=function(a,b){b=b||0;return function(){return a.apply(this,Array.prototype.slice.call(arguments,0,b))}};goog.functions.nth=function(a){return function(){return arguments[a]}};goog.functions.withReturnValue=function(a,b){return goog.functions.sequence(a,goog.functions.constant(b))};goog.functions.equalTo=function(b,a){return function(c){return a?(b==c):(b===c)}};goog.functions.compose=function(a,d){var c=arguments;var b=c.length;return function(){var e;if(b){e=c[b-1].apply(this,arguments)}for(var f=b-2;f>=0;f--){e=c[f].call(this,e)}return e}};goog.functions.sequence=function(c){var b=arguments;var a=b.length;return function(){var d;for(var e=0;e<a;e++){d=b[e].apply(this,arguments)}return d}};goog.functions.and=function(c){var b=arguments;var a=b.length;return function(){for(var d=0;d<a;d++){if(!b[d].apply(this,arguments)){return false}}return true}};goog.functions.or=function(c){var b=arguments;var a=b.length;return function(){for(var d=0;d<a;d++){if(b[d].apply(this,arguments)){return true}}return false}};goog.functions.not=function(a){return function(){return !a.apply(this,arguments)}};goog.functions.create=function(b,d){var a=function(){};a.prototype=b.prototype;var c=new a();b.apply(c,Array.prototype.slice.call(arguments,1));return c};goog.define("goog.functions.CACHE_RETURN_VALUE",true);goog.functions.cacheReturnValue=function(a){var b=false;var c;return function(){if(!goog.functions.CACHE_RETURN_VALUE){return a()}if(!b){c=a();b=true}return c}};goog.provide("goog.async.nextTick");goog.provide("goog.async.throwException");goog.require("goog.debug.entryPointRegistry");goog.require("goog.functions");goog.require("goog.labs.userAgent.browser");goog.require("goog.labs.userAgent.engine");goog.async.throwException=function(a){goog.global.setTimeout(function(){throw a},0)};goog.async.nextTick=function(d,c,b){var a=d;if(c){a=goog.bind(d,c)}a=goog.async.nextTick.wrapCallback_(a);if(goog.isFunction(goog.global.setImmediate)&&(b||!goog.global.Window||!goog.global.Window.prototype||goog.global.Window.prototype.setImmediate!=goog.global.setImmediate)){goog.global.setImmediate(a);return}if(!goog.async.nextTick.setImmediate_){goog.async.nextTick.setImmediate_=goog.async.nextTick.getSetImmediateEmulator_()}goog.async.nextTick.setImmediate_(a)};goog.async.nextTick.setImmediate_;goog.async.nextTick.getSetImmediateEmulator_=function(){var c=goog.global.MessageChannel;if(typeof c==="undefined"&&typeof window!=="undefined"&&window.postMessage&&window.addEventListener&&!goog.labs.userAgent.engine.isPresto()){c=function(){var f=document.createElement("iframe");f.style.display="none";f.src="";document.documentElement.appendChild(f);var i=f.contentWindow;var h=i.document;h.open();h.write("");h.close();var g="callImmediate"+Math.random();var e=i.location.protocol=="file:"?"*":i.location.protocol+"//"+i.location.host;var j=goog.bind(function(k){if((e!="*"&&k.origin!=e)||k.data!=g){return}this["port1"].onmessage()},this);i.addEventListener("message",j,false);this["port1"]={};this["port2"]={postMessage:function(){i.postMessage(g,e)}}}}if(typeof c!=="undefined"&&(!goog.labs.userAgent.browser.isIE())){var d=new c();var b={};var a=b;d.port1.onmessage=function(){if(goog.isDef(b.next)){b=b.next;var e=b.cb;b.cb=null;e()}};return function(e){a.next={cb:e};a=a.next;d.port2.postMessage(0)}}if(typeof document!=="undefined"&&"onreadystatechange" in document.createElement("script")){return function(e){var f=document.createElement("script");f.onreadystatechange=function(){f.onreadystatechange=null;f.parentNode.removeChild(f);f=null;e();e=null};document.documentElement.appendChild(f)}}return function(e){goog.global.setTimeout(e,0)}};goog.async.nextTick.wrapCallback_=goog.functions.identity;goog.debug.entryPointRegistry.register(function(a){goog.async.nextTick.wrapCallback_=a});goog.provide("goog.async.run");goog.require("goog.async.WorkQueue");goog.require("goog.async.nextTick");goog.require("goog.async.throwException");goog.require("goog.testing.watchers");goog.async.run=function(b,a){if(!goog.async.run.schedule_){goog.async.run.initializeRunner_()}if(!goog.async.run.workQueueScheduled_){goog.async.run.schedule_();goog.async.run.workQueueScheduled_=true}goog.async.run.workQueue_.add(b,a)};goog.async.run.initializeRunner_=function(){if(goog.global.Promise&&goog.global.Promise.resolve){var a=goog.global.Promise.resolve();goog.async.run.schedule_=function(){a.then(goog.async.run.processWorkQueue)}}else{goog.async.run.schedule_=function(){goog.async.nextTick(goog.async.run.processWorkQueue)}}};goog.async.run.forceNextTick=function(){goog.async.run.schedule_=function(){goog.async.nextTick(goog.async.run.processWorkQueue)}};goog.async.run.schedule_;goog.async.run.workQueueScheduled_=false;goog.async.run.workQueue_=new goog.async.WorkQueue();if(goog.DEBUG){goog.async.run.resetQueue_=function(){goog.async.run.workQueueScheduled_=false;goog.async.run.workQueue_=new goog.async.WorkQueue()};goog.testing.watchers.watchClockReset(goog.async.run.resetQueue_)}goog.async.run.processWorkQueue=function(){var a=null;while(a=goog.async.run.workQueue_.remove()){try{a.fn.call(a.scope)}catch(b){goog.async.throwException(b)}goog.async.run.workQueue_.returnUnused(a)}goog.async.run.workQueueScheduled_=false};goog.provide("goog.Thenable");goog.Thenable=function(){};goog.Thenable.prototype.then=function(b,a,c){};goog.Thenable.IMPLEMENTED_BY_PROP="$goog_Thenable";goog.Thenable.addImplementation=function(a){goog.exportProperty(a.prototype,"then",a.prototype.then);if(COMPILED){a.prototype[goog.Thenable.IMPLEMENTED_BY_PROP]=true}else{a.prototype.$goog_Thenable=true}};goog.Thenable.isImplementedBy=function(a){if(!a){return false}try{if(COMPILED){return !!a[goog.Thenable.IMPLEMENTED_BY_PROP]}return !!a.$goog_Thenable}catch(b){return false}};goog.provide("goog.Promise");goog.require("goog.Thenable");goog.require("goog.asserts");goog.require("goog.async.FreeList");goog.require("goog.async.run");goog.require("goog.async.throwException");goog.require("goog.debug.Error");goog.require("goog.promise.Resolver");goog.Promise=function(d,c){this.state_=goog.Promise.State_.PENDING;this.result_=undefined;this.parent_=null;this.callbackEntries_=null;this.callbackEntriesTail_=null;this.executing_=false;if(goog.Promise.UNHANDLED_REJECTION_DELAY>0){this.unhandledRejectionId_=0}else{if(goog.Promise.UNHANDLED_REJECTION_DELAY==0){this.hadUnhandledRejection_=false}}if(goog.Promise.LONG_STACK_TRACES){this.stack_=[];this.addStackTrace_(new Error("created"));this.currentStep_=0}if(d==goog.Promise.RESOLVE_FAST_PATH_){this.resolve_(goog.Promise.State_.FULFILLED,c)}else{try{var a=this;d.call(c,function(e){a.resolve_(goog.Promise.State_.FULFILLED,e)},function(g){if(goog.DEBUG&&!(g instanceof goog.Promise.CancellationError)){try{if(g instanceof Error){throw g}else{throw new Error("Promise rejected.")}}catch(f){}}a.resolve_(goog.Promise.State_.REJECTED,g)})}catch(b){this.resolve_(goog.Promise.State_.REJECTED,b)}}};goog.define("goog.Promise.LONG_STACK_TRACES",false);goog.define("goog.Promise.UNHANDLED_REJECTION_DELAY",0);goog.Promise.State_={PENDING:0,BLOCKED:1,FULFILLED:2,REJECTED:3};goog.Promise.CallbackEntry_=function(){this.child=null;this.onFulfilled=null;this.onRejected=null;this.context=null;this.next=null;this.always=false};goog.Promise.CallbackEntry_.prototype.reset=function(){this.child=null;this.onFulfilled=null;this.onRejected=null;this.context=null;this.always=false};goog.define("goog.Promise.DEFAULT_MAX_UNUSED",100);goog.Promise.freelist_=new goog.async.FreeList(function(){return new goog.Promise.CallbackEntry_()},function(a){a.reset()},goog.Promise.DEFAULT_MAX_UNUSED);goog.Promise.getCallbackEntry_=function(d,a,b){var c=goog.Promise.freelist_.get();c.onFulfilled=d;c.onRejected=a;c.context=b;return c};goog.Promise.returnEntry_=function(a){goog.Promise.freelist_.put(a)};goog.Promise.RESOLVE_FAST_PATH_=function(){};goog.Promise.resolve=function(a){return new goog.Promise(goog.Promise.RESOLVE_FAST_PATH_,a)};goog.Promise.reject=function(a){return new goog.Promise(function(c,b){b(a)})};goog.Promise.race=function(a){return new goog.Promise(function(d,c){if(!a.length){d(undefined)}for(var b=0,e;e=a[b];b++){goog.Promise.maybeThenVoid_(e,d,c)}})};goog.Promise.all=function(a){return new goog.Promise(function(g,f){var b=a.length;var c=[];if(!b){g(c);return}var e=function(i,k){b--;c[i]=k;if(b==0){g(c)}};var j=function(i){f(i)};for(var d=0,h;h=a[d];d++){goog.Promise.maybeThenVoid_(h,goog.partial(e,d),j)}})};goog.Promise.firstFulfilled=function(a){return new goog.Promise(function(f,e){var b=a.length;var j=[];if(!b){f(undefined);return}var d=function(i){f(i)};var h=function(i,k){b--;j[i]=k;if(b==0){e(j)}};for(var c=0,g;g=a[c];c++){goog.Promise.maybeThenVoid_(g,d,goog.partial(h,c))}})};goog.Promise.withResolver=function(){var b,a;var c=new goog.Promise(function(e,d){b=e;a=d});return new goog.Promise.Resolver_(c,b,a)};goog.Promise.prototype.then=function(b,a,c){if(b!=null){goog.asserts.assertFunction(b,"opt_onFulfilled should be a function.")}if(a!=null){goog.asserts.assertFunction(a,"opt_onRejected should be a function. Did you pass opt_context as the second argument instead of the third?")}if(goog.Promise.LONG_STACK_TRACES){this.addStackTrace_(new Error("then"))}return this.addChildPromise_(goog.isFunction(b)?b:null,goog.isFunction(a)?a:null,c)};goog.Thenable.addImplementation(goog.Promise);goog.Promise.prototype.thenVoid=function(b,a,c){if(b!=null){goog.asserts.assertFunction(b,"opt_onFulfilled should be a function.")}if(a!=null){goog.asserts.assertFunction(a,"opt_onRejected should be a function. Did you pass opt_context as the second argument instead of the third?")}if(goog.Promise.LONG_STACK_TRACES){this.addStackTrace_(new Error("then"))}this.addCallbackEntry_(goog.Promise.getCallbackEntry_(b||goog.nullFunction,a||null,c))};goog.Promise.maybeThenVoid_=function(d,c,a,b){if(d instanceof goog.Promise){d.thenVoid(c,a,b)}else{d.then(c,a,b)}};goog.Promise.prototype.thenAlways=function(c,b){if(goog.Promise.LONG_STACK_TRACES){this.addStackTrace_(new Error("thenAlways"))}var d=function(){try{c.call(b)}catch(e){goog.Promise.handleRejection_.call(null,e)}};var a=goog.Promise.getCallbackEntry_(d,d,null);a.always=true;this.addCallbackEntry_(a);return this};goog.Promise.prototype.thenCatch=function(a,b){if(goog.Promise.LONG_STACK_TRACES){this.addStackTrace_(new Error("thenCatch"))}return this.addChildPromise_(null,a,b)};goog.Promise.prototype.cancel=function(a){if(this.state_==goog.Promise.State_.PENDING){goog.async.run(function(){var b=new goog.Promise.CancellationError(a);this.cancelInternal_(b)},this)}};goog.Promise.prototype.cancelInternal_=function(a){if(this.state_==goog.Promise.State_.PENDING){if(this.parent_){this.parent_.cancelChild_(this,a);this.parent_=null}else{this.resolve_(goog.Promise.State_.REJECTED,a)}}};goog.Promise.prototype.cancelChild_=function(f,e){if(!this.callbackEntries_){return}var b=0;var a=null;var c=null;for(var d=this.callbackEntries_;d;d=d.next){if(!d.always){b++;if(d.child==f){a=d}if(a&&b>1){break}}if(!a){c=d}}if(a){if(this.state_==goog.Promise.State_.PENDING&&b==1){this.cancelInternal_(e)}else{if(c){this.removeEntryAfter_(c)}else{this.popEntry_()}this.executeCallback_(a,goog.Promise.State_.REJECTED,e)}}};goog.Promise.prototype.addCallbackEntry_=function(a){if(!this.hasEntry_()&&(this.state_==goog.Promise.State_.FULFILLED||this.state_==goog.Promise.State_.REJECTED)){this.scheduleCallbacks_()}this.queueEntry_(a)};goog.Promise.prototype.addChildPromise_=function(d,b,c){var a=goog.Promise.getCallbackEntry_(null,null,null);a.child=new goog.Promise(function(f,e){a.onFulfilled=d?function(i){try{var g=d.call(c,i);f(g)}catch(h){e(h)}}:f;a.onRejected=b?function(i){try{var g=b.call(c,i);if(!goog.isDef(g)&&i instanceof goog.Promise.CancellationError){e(i)}else{f(g)}}catch(h){e(h)}}:e});a.child.parent_=this;this.addCallbackEntry_(a);return a.child};goog.Promise.prototype.unblockAndFulfill_=function(a){goog.asserts.assert(this.state_==goog.Promise.State_.BLOCKED);this.state_=goog.Promise.State_.PENDING;this.resolve_(goog.Promise.State_.FULFILLED,a)};goog.Promise.prototype.unblockAndReject_=function(a){goog.asserts.assert(this.state_==goog.Promise.State_.BLOCKED);this.state_=goog.Promise.State_.PENDING;this.resolve_(goog.Promise.State_.REJECTED,a)};goog.Promise.prototype.resolve_=function(b,a){if(this.state_!=goog.Promise.State_.PENDING){return}if(this==a){b=goog.Promise.State_.REJECTED;a=new TypeError("Promise cannot resolve to itself")}else{if(goog.Thenable.isImplementedBy(a)){a=(a);this.state_=goog.Promise.State_.BLOCKED;goog.Promise.maybeThenVoid_(a,this.unblockAndFulfill_,this.unblockAndReject_,this);return}else{if(goog.isObject(a)){try{var d=a.then;if(goog.isFunction(d)){this.tryThen_(a,d);return}}catch(c){b=goog.Promise.State_.REJECTED;a=c}}}}this.result_=a;this.state_=b;this.parent_=null;this.scheduleCallbacks_();if(b==goog.Promise.State_.REJECTED&&!(a instanceof goog.Promise.CancellationError)){goog.Promise.addUnhandledRejection_(this,a)}};goog.Promise.prototype.tryThen_=function(a,h){this.state_=goog.Promise.State_.BLOCKED;var g=this;var b=false;var d=function(e){if(!b){b=true;g.unblockAndFulfill_(e)}};var c=function(e){if(!b){b=true;g.unblockAndReject_(e)}};try{h.call(a,d,c)}catch(f){c(f)}};goog.Promise.prototype.scheduleCallbacks_=function(){if(!this.executing_){this.executing_=true;goog.async.run(this.executeCallbacks_,this)}};goog.Promise.prototype.hasEntry_=function(){return !!this.callbackEntries_};goog.Promise.prototype.queueEntry_=function(a){goog.asserts.assert(a.onFulfilled!=null);if(this.callbackEntriesTail_){this.callbackEntriesTail_.next=a;this.callbackEntriesTail_=a}else{this.callbackEntries_=a;this.callbackEntriesTail_=a}};goog.Promise.prototype.popEntry_=function(){var a=null;if(this.callbackEntries_){a=this.callbackEntries_;this.callbackEntries_=a.next;a.next=null}if(!this.callbackEntries_){this.callbackEntriesTail_=null}if(a!=null){goog.asserts.assert(a.onFulfilled!=null)}return a};goog.Promise.prototype.removeEntryAfter_=function(a){goog.asserts.assert(this.callbackEntries_);goog.asserts.assert(a!=null);if(a.next==this.callbackEntriesTail_){this.callbackEntriesTail_=a}a.next=a.next.next};goog.Promise.prototype.executeCallbacks_=function(){var a=null;while(a=this.popEntry_()){if(goog.Promise.LONG_STACK_TRACES){this.currentStep_++}this.executeCallback_(a,this.state_,this.result_)}this.executing_=false};goog.Promise.prototype.executeCallback_=function(b,c,a){if(b.child){b.child.parent_=null}if(c==goog.Promise.State_.FULFILLED){b.onFulfilled.call(b.context,a)}else{if(b.onRejected!=null){if(!b.always){this.removeUnhandledRejection_()}b.onRejected.call(b.context,a)}}goog.Promise.returnEntry_(b)};goog.Promise.prototype.addStackTrace_=function(b){if(goog.Promise.LONG_STACK_TRACES&&goog.isString(b.stack)){var c=b.stack.split("\n",4)[3];var a=b.message;a+=Array(11-a.length).join(" ");this.stack_.push(a+c)}};goog.Promise.prototype.appendLongStack_=function(b){if(goog.Promise.LONG_STACK_TRACES&&b&&goog.isString(b.stack)&&this.stack_.length){var d=["Promise trace:"];for(var c=this;c;c=c.parent_){for(var a=this.currentStep_;a>=0;a--){d.push(c.stack_[a])}d.push("Value: ["+(c.state_==goog.Promise.State_.REJECTED?"REJECTED":"FULFILLED")+"] <"+String(c.result_)+">")}b.stack+="\n\n"+d.join("\n")}};goog.Promise.prototype.removeUnhandledRejection_=function(){if(goog.Promise.UNHANDLED_REJECTION_DELAY>0){for(var a=this;a&&a.unhandledRejectionId_;a=a.parent_){goog.global.clearTimeout(a.unhandledRejectionId_);a.unhandledRejectionId_=0}}else{if(goog.Promise.UNHANDLED_REJECTION_DELAY==0){for(var a=this;a&&a.hadUnhandledRejection_;a=a.parent_){a.hadUnhandledRejection_=false}}}};goog.Promise.addUnhandledRejection_=function(b,a){if(goog.Promise.UNHANDLED_REJECTION_DELAY>0){b.unhandledRejectionId_=goog.global.setTimeout(function(){b.appendLongStack_(a);goog.Promise.handleRejection_.call(null,a)},goog.Promise.UNHANDLED_REJECTION_DELAY)}else{if(goog.Promise.UNHANDLED_REJECTION_DELAY==0){b.hadUnhandledRejection_=true;goog.async.run(function(){if(b.hadUnhandledRejection_){b.appendLongStack_(a);goog.Promise.handleRejection_.call(null,a)}})}}};goog.Promise.handleRejection_=goog.async.throwException;goog.Promise.setUnhandledRejectionHandler=function(a){goog.Promise.handleRejection_=a};goog.Promise.CancellationError=function(a){goog.Promise.CancellationError.base(this,"constructor",a)};goog.inherits(goog.Promise.CancellationError,goog.debug.Error);goog.Promise.CancellationError.prototype.name="cancel";goog.Promise.Resolver_=function(c,b,a){this.promise=c;this.resolve=b;this.reject=a};goog.provide("goog.async.Deferred");goog.provide("goog.async.Deferred.AlreadyCalledError");goog.provide("goog.async.Deferred.CanceledError");goog.require("goog.Promise");goog.require("goog.Thenable");goog.require("goog.array");goog.require("goog.asserts");goog.require("goog.debug.Error");goog.async.Deferred=function(c,a){this.sequence_=[];this.onCancelFunction_=c;this.defaultScope_=a||null;this.fired_=false;this.hadError_=false;this.result_=undefined;this.blocked_=false;this.blocking_=false;this.silentlyCanceled_=false;this.unhandledErrorId_=0;this.parent_=null;this.branches_=0;if(goog.async.Deferred.LONG_STACK_TRACES){this.constructorStack_=null;if(Error.captureStackTrace){var b={stack:""};Error.captureStackTrace(b,goog.async.Deferred);if(typeof b.stack=="string"){this.constructorStack_=b.stack.replace(/^[^\n]*\n/,"")}}}};goog.define("goog.async.Deferred.STRICT_ERRORS",false);goog.define("goog.async.Deferred.LONG_STACK_TRACES",false);goog.async.Deferred.prototype.cancel=function(b){if(!this.hasFired()){if(this.parent_){var a=this.parent_;delete this.parent_;if(b){a.cancel(b)}else{a.branchCancel_()}}if(this.onCancelFunction_){this.onCancelFunction_.call(this.defaultScope_,this)}else{this.silentlyCanceled_=true}if(!this.hasFired()){this.errback(new goog.async.Deferred.CanceledError(this))}}else{if(this.result_ instanceof goog.async.Deferred){this.result_.cancel()}}};goog.async.Deferred.prototype.branchCancel_=function(){this.branches_--;if(this.branches_<=0){this.cancel()}};goog.async.Deferred.prototype.continue_=function(a,b){this.blocked_=false;this.updateResult_(a,b)};goog.async.Deferred.prototype.updateResult_=function(a,b){this.fired_=true;this.result_=b;this.hadError_=!a;this.fire_()};goog.async.Deferred.prototype.check_=function(){if(this.hasFired()){if(!this.silentlyCanceled_){throw new goog.async.Deferred.AlreadyCalledError(this)}this.silentlyCanceled_=false}};goog.async.Deferred.prototype.callback=function(a){this.check_();this.assertNotDeferred_(a);this.updateResult_(true,a)};goog.async.Deferred.prototype.errback=function(a){this.check_();this.assertNotDeferred_(a);this.makeStackTraceLong_(a);this.updateResult_(false,a)};goog.async.Deferred.prototype.makeStackTraceLong_=function(a){if(!goog.async.Deferred.LONG_STACK_TRACES){return}if(this.constructorStack_&&goog.isObject(a)&&a.stack&&(/^[^\n]+(\n   [^\n]+)+/).test(a.stack)){a.stack=a.stack+"\nDEFERRED OPERATION:\n"+this.constructorStack_}};goog.async.Deferred.prototype.assertNotDeferred_=function(a){goog.asserts.assert(!(a instanceof goog.async.Deferred),"An execution sequence may not be initiated with a blocking Deferred.")};goog.async.Deferred.prototype.addCallback=function(b,a){return this.addCallbacks(b,null,a)};goog.async.Deferred.prototype.addErrback=function(b,a){return this.addCallbacks(null,b,a)};goog.async.Deferred.prototype.addBoth=function(b,a){return this.addCallbacks(b,b,a)};goog.async.Deferred.prototype.addFinally=function(b,a){return this.addCallbacks(b,function(d){var c=b.call(this,d);if(!goog.isDef(c)){throw d}return c},a)};goog.async.Deferred.prototype.addCallbacks=function(b,c,a){goog.asserts.assert(!this.blocking_,"Blocking Deferreds can not be re-used");this.sequence_.push([b,c,a]);if(this.hasFired()){this.fire_()}return this};goog.async.Deferred.prototype.then=function(b,a,e){var d,c;var f=new goog.Promise(function(h,g){d=h;c=g});this.addCallbacks(d,function(g){if(g instanceof goog.async.Deferred.CanceledError){f.cancel()}else{c(g)}});return f.then(b,a,e)};goog.Thenable.addImplementation(goog.async.Deferred);goog.async.Deferred.prototype.chainDeferred=function(a){this.addCallbacks(a.callback,a.errback,a);return this};goog.async.Deferred.prototype.awaitDeferred=function(a){if(!(a instanceof goog.async.Deferred)){return this.addCallback(function(){return a})}return this.addCallback(goog.bind(a.branch,a))};goog.async.Deferred.prototype.branch=function(a){var b=new goog.async.Deferred();this.chainDeferred(b);if(a){b.parent_=this;this.branches_++}return b};goog.async.Deferred.prototype.hasFired=function(){return this.fired_};goog.async.Deferred.prototype.isError=function(a){return a instanceof Error};goog.async.Deferred.prototype.hasErrback_=function(){return goog.array.some(this.sequence_,function(a){return goog.isFunction(a[1])})};goog.async.Deferred.prototype.fire_=function(){if(this.unhandledErrorId_&&this.hasFired()&&this.hasErrback_()){goog.async.Deferred.unscheduleError_(this.unhandledErrorId_);this.unhandledErrorId_=0}if(this.parent_){this.parent_.branches_--;delete this.parent_}var i=this.result_;var k=false;var c=false;while(this.sequence_.length&&!this.blocked_){var m=this.sequence_.shift();var j=m[0];var d=m[1];var l=m[2];var e=this.hadError_?d:j;if(e){try{var g=e.call(l||this.defaultScope_,i);if(goog.isDef(g)){this.hadError_=this.hadError_&&(g==i||this.isError(g));this.result_=i=g}if(goog.Thenable.isImplementedBy(i)){c=true;this.blocked_=true}}catch(h){i=h;this.hadError_=true;this.makeStackTraceLong_(i);if(!this.hasErrback_()){k=true}}}}this.result_=i;if(c){var a=goog.bind(this.continue_,this,true);var b=goog.bind(this.continue_,this,false);if(i instanceof goog.async.Deferred){i.addCallbacks(a,b);i.blocking_=true}else{i.then(a,b)}}else{if(goog.async.Deferred.STRICT_ERRORS&&this.isError(i)&&!(i instanceof goog.async.Deferred.CanceledError)){this.hadError_=true;k=true}}if(k){this.unhandledErrorId_=goog.async.Deferred.scheduleError_(i)}};goog.async.Deferred.succeed=function(a){var b=new goog.async.Deferred();b.callback(a);return b};goog.async.Deferred.fromPromise=function(b){var a=new goog.async.Deferred();a.callback();a.addCallback(function(){return b});return a};goog.async.Deferred.fail=function(a){var b=new goog.async.Deferred();b.errback(a);return b};goog.async.Deferred.canceled=function(){var a=new goog.async.Deferred();a.cancel();return a};goog.async.Deferred.when=function(b,c,a){if(b instanceof goog.async.Deferred){return b.branch(true).addCallback(c,a)}else{return goog.async.Deferred.succeed(b).addCallback(c,a)}};goog.async.Deferred.AlreadyCalledError=function(a){goog.debug.Error.call(this);this.deferred=a};goog.inherits(goog.async.Deferred.AlreadyCalledError,goog.debug.Error);goog.async.Deferred.AlreadyCalledError.prototype.message="Deferred has already fired";goog.async.Deferred.AlreadyCalledError.prototype.name="AlreadyCalledError";goog.async.Deferred.CanceledError=function(a){goog.debug.Error.call(this);this.deferred=a};goog.inherits(goog.async.Deferred.CanceledError,goog.debug.Error);goog.async.Deferred.CanceledError.prototype.message="Deferred was canceled";goog.async.Deferred.CanceledError.prototype.name="CanceledError";goog.async.Deferred.Error_=function(a){this.id_=goog.global.setTimeout(goog.bind(this.throwError,this),0);this.error_=a};goog.async.Deferred.Error_.prototype.throwError=function(){goog.asserts.assert(goog.async.Deferred.errorMap_[this.id_],"Cannot throw an error that is not scheduled.");delete goog.async.Deferred.errorMap_[this.id_];throw this.error_};goog.async.Deferred.Error_.prototype.resetTimer=function(){goog.global.clearTimeout(this.id_)};goog.async.Deferred.errorMap_={};goog.async.Deferred.scheduleError_=function(b){var a=new goog.async.Deferred.Error_(b);goog.async.Deferred.errorMap_[a.id_]=a;return a.id_};goog.async.Deferred.unscheduleError_=function(b){var a=goog.async.Deferred.errorMap_[b];if(a){a.resetTimer();delete goog.async.Deferred.errorMap_[b]}};goog.async.Deferred.assertNoErrors=function(){var c=goog.async.Deferred.errorMap_;for(var b in c){var a=c[b];a.resetTimer();a.throwError()}};goog.provide("goog.events.EventTarget");goog.require("goog.Disposable");goog.require("goog.asserts");goog.require("goog.events");goog.require("goog.events.Event");goog.require("goog.events.Listenable");goog.require("goog.events.ListenerMap");goog.require("goog.object");goog.events.EventTarget=function(){goog.Disposable.call(this);this.eventTargetListeners_=new goog.events.ListenerMap(this);this.actualEventTarget_=this;this.parentEventTarget_=null};goog.inherits(goog.events.EventTarget,goog.Disposable);goog.events.Listenable.addImplementation(goog.events.EventTarget);goog.events.EventTarget.MAX_ANCESTORS_=1000;goog.events.EventTarget.prototype.getParentEventTarget=function(){return this.parentEventTarget_};goog.events.EventTarget.prototype.setParentEventTarget=function(a){this.parentEventTarget_=a};goog.events.EventTarget.prototype.addEventListener=function(b,a,c,d){goog.events.listen(this,b,a,c,d)};goog.events.EventTarget.prototype.removeEventListener=function(b,a,c,d){goog.events.unlisten(this,b,a,c,d)};goog.events.EventTarget.prototype.dispatchEvent=function(d){this.assertInitialized_();var c,b=this.getParentEventTarget();if(b){c=[];var a=1;for(;b;b=b.getParentEventTarget()){c.push(b);goog.asserts.assert((++a<goog.events.EventTarget.MAX_ANCESTORS_),"infinite loop")}}return goog.events.EventTarget.dispatchEventInternal_(this.actualEventTarget_,d,c)};goog.events.EventTarget.prototype.disposeInternal=function(){goog.events.EventTarget.superClass_.disposeInternal.call(this);this.removeAllListeners();this.parentEventTarget_=null};goog.events.EventTarget.prototype.listen=function(a,b,d,c){this.assertInitialized_();return this.eventTargetListeners_.add(String(a),b,false,d,c)};goog.events.EventTarget.prototype.listenOnce=function(a,b,d,c){return this.eventTargetListeners_.add(String(a),b,true,d,c)};goog.events.EventTarget.prototype.unlisten=function(a,b,d,c){return this.eventTargetListeners_.remove(String(a),b,d,c)};goog.events.EventTarget.prototype.unlistenByKey=function(a){return this.eventTargetListeners_.removeByKey(a)};goog.events.EventTarget.prototype.removeAllListeners=function(a){if(!this.eventTargetListeners_){return 0}return this.eventTargetListeners_.removeAll(a)};goog.events.EventTarget.prototype.fireListeners=function(g,j,c){var f=this.eventTargetListeners_.listeners[String(g)];if(!f){return true}f=f.concat();var a=true;for(var e=0;e<f.length;++e){var b=f[e];if(b&&!b.removed&&b.capture==j){var h=b.listener;var d=b.handler||b.src;if(b.callOnce){this.unlistenByKey(b)}a=h.call(d,c)!==false&&a}}return a&&c.returnValue_!=false};goog.events.EventTarget.prototype.getListeners=function(b,a){return this.eventTargetListeners_.getListeners(String(b),a)};goog.events.EventTarget.prototype.getListener=function(b,c,a,d){return this.eventTargetListeners_.getListener(String(b),c,a,d)};goog.events.EventTarget.prototype.hasListener=function(b,a){var c=goog.isDef(b)?String(b):undefined;return this.eventTargetListeners_.hasListener(c,a)};goog.events.EventTarget.prototype.setTargetForTesting=function(a){this.actualEventTarget_=a};goog.events.EventTarget.prototype.assertInitialized_=function(){goog.asserts.assert(this.eventTargetListeners_,"Event target is not initialized. Did you call the superclass (goog.events.EventTarget) constructor?")};goog.events.EventTarget.dispatchEventInternal_=function(h,g,a){var d=g.type||(g);if(goog.isString(g)){g=new goog.events.Event(g,h)}else{if(!(g instanceof goog.events.Event)){var b=g;g=new goog.events.Event(d,h);goog.object.extend(g,b)}else{g.target=g.target||h}}var j=true,f;if(a){for(var c=a.length-1;!g.propagationStopped_&&c>=0;c--){f=g.currentTarget=a[c];j=f.fireListeners(d,true,g)&&j}}if(!g.propagationStopped_){f=g.currentTarget=h;j=f.fireListeners(d,true,g)&&j;if(!g.propagationStopped_){j=f.fireListeners(d,false,g)&&j}}if(a){for(c=0;!g.propagationStopped_&&c<a.length;c++){f=g.currentTarget=a[c];j=f.fireListeners(d,false,g)&&j}}return j};goog.provide("goog.fs.FileReader");goog.provide("goog.fs.FileReader.EventType");goog.provide("goog.fs.FileReader.ReadyState");goog.require("goog.async.Deferred");goog.require("goog.events.EventTarget");goog.require("goog.fs.Error");goog.require("goog.fs.ProgressEvent");goog.fs.FileReader=function(){goog.fs.FileReader.base(this,"constructor");this.reader_=new FileReader();this.reader_.onloadstart=goog.bind(this.dispatchProgressEvent_,this);this.reader_.onprogress=goog.bind(this.dispatchProgressEvent_,this);this.reader_.onload=goog.bind(this.dispatchProgressEvent_,this);this.reader_.onabort=goog.bind(this.dispatchProgressEvent_,this);this.reader_.onerror=goog.bind(this.dispatchProgressEvent_,this);this.reader_.onloadend=goog.bind(this.dispatchProgressEvent_,this)};goog.inherits(goog.fs.FileReader,goog.events.EventTarget);goog.fs.FileReader.ReadyState={INIT:0,LOADING:1,DONE:2};goog.fs.FileReader.EventType={LOAD_START:"loadstart",PROGRESS:"progress",LOAD:"load",ABORT:"abort",ERROR:"error",LOAD_END:"loadend"};goog.fs.FileReader.prototype.abort=function(){try{this.reader_.abort()}catch(a){throw new goog.fs.Error(a,"aborting read")}};goog.fs.FileReader.prototype.getReadyState=function(){return(this.reader_.readyState)};goog.fs.FileReader.prototype.getResult=function(){return this.reader_.result};goog.fs.FileReader.prototype.getError=function(){return this.reader_.error&&new goog.fs.Error(this.reader_.error,"reading file")};goog.fs.FileReader.prototype.dispatchProgressEvent_=function(a){this.dispatchEvent(new goog.fs.ProgressEvent(a,this))};goog.fs.FileReader.prototype.disposeInternal=function(){goog.fs.FileReader.base(this,"disposeInternal");delete this.reader_};goog.fs.FileReader.prototype.readAsBinaryString=function(a){this.reader_.readAsBinaryString(a)};goog.fs.FileReader.readAsBinaryString=function(b){var a=new goog.fs.FileReader();var c=goog.fs.FileReader.createDeferred_(a);a.readAsBinaryString(b);return c};goog.fs.FileReader.prototype.readAsArrayBuffer=function(a){this.reader_.readAsArrayBuffer(a)};goog.fs.FileReader.readAsArrayBuffer=function(b){var a=new goog.fs.FileReader();var c=goog.fs.FileReader.createDeferred_(a);a.readAsArrayBuffer(b);return c};goog.fs.FileReader.prototype.readAsText=function(a,b){this.reader_.readAsText(a,b)};goog.fs.FileReader.readAsText=function(b,e){var a=new goog.fs.FileReader();var c=goog.fs.FileReader.createDeferred_(a);a.readAsText(b,e);return c};goog.fs.FileReader.prototype.readAsDataUrl=function(a){this.reader_.readAsDataURL(a)};goog.fs.FileReader.readAsDataUrl=function(b){var a=new goog.fs.FileReader();var c=goog.fs.FileReader.createDeferred_(a);a.readAsDataUrl(b);return c};goog.fs.FileReader.createDeferred_=function(a){var b=new goog.async.Deferred();a.listen(goog.fs.FileReader.EventType.LOAD_END,goog.partial(function(i,g,h){var c=g.getResult();var f=g.getError();if(c!=null&&!f){i.callback(c)}else{i.errback(f)}g.dispose()},b,a));return b};goog.provide("goog.fs.FileSystem");goog.fs.FileSystem=function(){};goog.fs.FileSystem.prototype.getName=function(){};goog.fs.FileSystem.prototype.getRoot=function(){};goog.provide("goog.fs.FileSaver");goog.provide("goog.fs.FileSaver.EventType");goog.provide("goog.fs.FileSaver.ReadyState");goog.require("goog.events.EventTarget");goog.require("goog.fs.Error");goog.require("goog.fs.ProgressEvent");goog.fs.FileSaver=function(a){goog.fs.FileSaver.base(this,"constructor");this.saver_=a;this.saver_.onwritestart=goog.bind(this.dispatchProgressEvent_,this);this.saver_.onprogress=goog.bind(this.dispatchProgressEvent_,this);this.saver_.onwrite=goog.bind(this.dispatchProgressEvent_,this);this.saver_.onabort=goog.bind(this.dispatchProgressEvent_,this);this.saver_.onerror=goog.bind(this.dispatchProgressEvent_,this);this.saver_.onwriteend=goog.bind(this.dispatchProgressEvent_,this)};goog.inherits(goog.fs.FileSaver,goog.events.EventTarget);goog.fs.FileSaver.ReadyState={INIT:0,WRITING:1,DONE:2};goog.fs.FileSaver.EventType={WRITE_START:"writestart",PROGRESS:"progress",WRITE:"write",ABORT:"abort",ERROR:"error",WRITE_END:"writeend"};goog.fs.FileSaver.prototype.abort=function(){try{this.saver_.abort()}catch(a){throw new goog.fs.Error(a,"aborting save")}};goog.fs.FileSaver.prototype.getReadyState=function(){return(this.saver_.readyState)};goog.fs.FileSaver.prototype.getError=function(){return this.saver_.error&&new goog.fs.Error(this.saver_.error,"saving file")};goog.fs.FileSaver.prototype.dispatchProgressEvent_=function(a){this.dispatchEvent(new goog.fs.ProgressEvent(a,this))};goog.fs.FileSaver.prototype.disposeInternal=function(){delete this.saver_;goog.fs.FileSaver.base(this,"disposeInternal")};goog.provide("goog.fs.FileWriter");goog.require("goog.fs.Error");goog.require("goog.fs.FileSaver");goog.fs.FileWriter=function(a){goog.fs.FileWriter.base(this,"constructor",a);this.writer_=a};goog.inherits(goog.fs.FileWriter,goog.fs.FileSaver);goog.fs.FileWriter.prototype.getPosition=function(){return this.writer_.position};goog.fs.FileWriter.prototype.getLength=function(){return this.writer_.length};goog.fs.FileWriter.prototype.write=function(a){try{this.writer_.write(a)}catch(b){throw new goog.fs.Error(b,"writing file")}};goog.fs.FileWriter.prototype.seek=function(b){try{this.writer_.seek(b)}catch(a){throw new goog.fs.Error(a,"seeking in file")}};goog.fs.FileWriter.prototype.truncate=function(a){try{this.writer_.truncate(a)}catch(b){throw new goog.fs.Error(b,"truncating file")}};goog.provide("goog.fs.DirectoryEntry");goog.provide("goog.fs.DirectoryEntry.Behavior");goog.provide("goog.fs.Entry");goog.provide("goog.fs.FileEntry");goog.fs.Entry=function(){};goog.fs.Entry.prototype.isFile=function(){};goog.fs.Entry.prototype.isDirectory=function(){};goog.fs.Entry.prototype.getName=function(){};goog.fs.Entry.prototype.getFullPath=function(){};goog.fs.Entry.prototype.getFileSystem=function(){};goog.fs.Entry.prototype.getLastModified=function(){};goog.fs.Entry.prototype.getMetadata=function(){};goog.fs.Entry.prototype.moveTo=function(a,b){};goog.fs.Entry.prototype.copyTo=function(a,b){};goog.fs.Entry.prototype.wrapEntry=function(a){};goog.fs.Entry.prototype.toUrl=function(a){};goog.fs.Entry.prototype.toUri=function(a){};goog.fs.Entry.prototype.remove=function(){};goog.fs.Entry.prototype.getParent=function(){};goog.fs.DirectoryEntry=function(){};goog.fs.DirectoryEntry.Behavior={DEFAULT:1,CREATE:2,CREATE_EXCLUSIVE:3};goog.fs.DirectoryEntry.prototype.getFile=function(a,b){};goog.fs.DirectoryEntry.prototype.getDirectory=function(a,b){};goog.fs.DirectoryEntry.prototype.createPath=function(a){};goog.fs.DirectoryEntry.prototype.listDirectory=function(){};goog.fs.DirectoryEntry.prototype.removeRecursively=function(){};goog.fs.FileEntry=function(){};goog.fs.FileEntry.prototype.createWriter=function(){};goog.fs.FileEntry.prototype.file=function(){};goog.provide("goog.fs.DirectoryEntryImpl");goog.provide("goog.fs.EntryImpl");goog.provide("goog.fs.FileEntryImpl");goog.require("goog.array");goog.require("goog.async.Deferred");goog.require("goog.fs.DirectoryEntry");goog.require("goog.fs.Entry");goog.require("goog.fs.Error");goog.require("goog.fs.FileEntry");goog.require("goog.fs.FileWriter");goog.require("goog.functions");goog.require("goog.string");goog.fs.EntryImpl=function(a,b){this.fs_=a;this.entry_=b};goog.fs.EntryImpl.prototype.isFile=function(){return this.entry_.isFile};goog.fs.EntryImpl.prototype.isDirectory=function(){return this.entry_.isDirectory};goog.fs.EntryImpl.prototype.getName=function(){return this.entry_.name};goog.fs.EntryImpl.prototype.getFullPath=function(){return this.entry_.fullPath};goog.fs.EntryImpl.prototype.getFileSystem=function(){return this.fs_};goog.fs.EntryImpl.prototype.getLastModified=function(){return this.getMetadata().addCallback(function(a){return a.modificationTime})};goog.fs.EntryImpl.prototype.getMetadata=function(){var a=new goog.async.Deferred();this.entry_.getMetadata(function(b){a.callback(b)},goog.bind(function(b){var c="retrieving metadata for "+this.getFullPath();a.errback(new goog.fs.Error(b,c))},this));return a};goog.fs.EntryImpl.prototype.moveTo=function(a,b){var c=new goog.async.Deferred();this.entry_.moveTo(a.dir_,b,goog.bind(function(d){c.callback(this.wrapEntry(d))},this),goog.bind(function(d){var e="moving "+this.getFullPath()+" into "+a.getFullPath()+(b?", renaming to "+b:"");c.errback(new goog.fs.Error(d,e))},this));return c};goog.fs.EntryImpl.prototype.copyTo=function(a,b){var c=new goog.async.Deferred();this.entry_.copyTo(a.dir_,b,goog.bind(function(d){c.callback(this.wrapEntry(d))},this),goog.bind(function(d){var e="copying "+this.getFullPath()+" into "+a.getFullPath()+(b?", renaming to "+b:"");c.errback(new goog.fs.Error(d,e))},this));return c};goog.fs.EntryImpl.prototype.wrapEntry=function(a){return a.isFile?new goog.fs.FileEntryImpl(this.fs_,(a)):new goog.fs.DirectoryEntryImpl(this.fs_,(a))};goog.fs.EntryImpl.prototype.toUrl=function(a){return this.entry_.toURL(a)};goog.fs.EntryImpl.prototype.toUri=goog.fs.EntryImpl.prototype.toUrl;goog.fs.EntryImpl.prototype.remove=function(){var a=new goog.async.Deferred();this.entry_.remove(goog.bind(a.callback,a,true),goog.bind(function(b){var c="removing "+this.getFullPath();a.errback(new goog.fs.Error(b,c))},this));return a};goog.fs.EntryImpl.prototype.getParent=function(){var a=new goog.async.Deferred();this.entry_.getParent(goog.bind(function(b){a.callback(new goog.fs.DirectoryEntryImpl(this.fs_,b))},this),goog.bind(function(b){var c="getting parent of "+this.getFullPath();a.errback(new goog.fs.Error(b,c))},this));return a};goog.fs.DirectoryEntryImpl=function(a,b){goog.fs.DirectoryEntryImpl.base(this,"constructor",a,b);this.dir_=b};goog.inherits(goog.fs.DirectoryEntryImpl,goog.fs.EntryImpl);goog.fs.DirectoryEntryImpl.prototype.getFile=function(a,c){var b=new goog.async.Deferred();this.dir_.getFile(a,this.getOptions_(c),goog.bind(function(d){b.callback(new goog.fs.FileEntryImpl(this.fs_,d))},this),goog.bind(function(d){var e="loading file "+a+" from "+this.getFullPath();b.errback(new goog.fs.Error(d,e))},this));return b};goog.fs.DirectoryEntryImpl.prototype.getDirectory=function(a,c){var b=new goog.async.Deferred();this.dir_.getDirectory(a,this.getOptions_(c),goog.bind(function(d){b.callback(new goog.fs.DirectoryEntryImpl(this.fs_,d))},this),goog.bind(function(d){var e="loading directory "+a+" from "+this.getFullPath();b.errback(new goog.fs.Error(d,e))},this));return b};goog.fs.DirectoryEntryImpl.prototype.createPath=function(d){if(goog.string.startsWith(d,"/")){var a=this.getFileSystem().getRoot();if(this.getFullPath()!=a.getFullPath()){return a.createPath(d)}}var c=goog.array.filter(d.split("/"),goog.functions.identity);function b(e){if(!c.length){return goog.async.Deferred.succeed(e)}var f;var g=c.shift();if(g==".."){f=e.getParent()}else{if(g=="."){f=goog.async.Deferred.succeed(e)}else{f=e.getDirectory(g,goog.fs.DirectoryEntry.Behavior.CREATE)}}return f.addCallback(b)}return b(this)};goog.fs.DirectoryEntryImpl.prototype.listDirectory=function(){var f=new goog.async.Deferred();var b=this.dir_.createReader();var e=[];var c=goog.bind(function(d){var g="listing directory "+this.getFullPath();f.errback(new goog.fs.Error(d,g))},this);var a=goog.bind(function(d){if(d.length){for(var g=0,h;h=d[g];g++){e.push(this.wrapEntry(h))}b.readEntries(a,c)}else{f.callback(e)}},this);b.readEntries(a,c);return f};goog.fs.DirectoryEntryImpl.prototype.removeRecursively=function(){var a=new goog.async.Deferred();this.dir_.removeRecursively(goog.bind(a.callback,a,true),goog.bind(function(b){var c="removing "+this.getFullPath()+" recursively";a.errback(new goog.fs.Error(b,c))},this));return a};goog.fs.DirectoryEntryImpl.prototype.getOptions_=function(a){if(a==goog.fs.DirectoryEntry.Behavior.CREATE){return{create:true}}else{if(a==goog.fs.DirectoryEntry.Behavior.CREATE_EXCLUSIVE){return{create:true,exclusive:true}}else{return{}}}};goog.fs.FileEntryImpl=function(a,b){goog.fs.FileEntryImpl.base(this,"constructor",a,b);this.file_=b};goog.inherits(goog.fs.FileEntryImpl,goog.fs.EntryImpl);goog.fs.FileEntryImpl.prototype.createWriter=function(){var a=new goog.async.Deferred();this.file_.createWriter(function(b){a.callback(new goog.fs.FileWriter(b))},goog.bind(function(b){var c="creating writer for "+this.getFullPath();a.errback(new goog.fs.Error(b,c))},this));return a};goog.fs.FileEntryImpl.prototype.file=function(){var a=new goog.async.Deferred();this.file_.file(function(b){a.callback(b)},goog.bind(function(b){var c="getting file for "+this.getFullPath();a.errback(new goog.fs.Error(b,c))},this));return a};goog.provide("goog.fs.FileSystemImpl");goog.require("goog.fs.DirectoryEntryImpl");goog.require("goog.fs.FileSystem");goog.fs.FileSystemImpl=function(a){this.fs_=a};goog.fs.FileSystemImpl.prototype.getName=function(){return this.fs_.name};goog.fs.FileSystemImpl.prototype.getRoot=function(){return new goog.fs.DirectoryEntryImpl(this,this.fs_.root)};goog.fs.FileSystemImpl.prototype.getBrowserFileSystem=function(){return this.fs_};goog.provide("goog.fs");goog.require("goog.array");goog.require("goog.async.Deferred");goog.require("goog.fs.Error");goog.require("goog.fs.FileReader");goog.require("goog.fs.FileSystemImpl");goog.require("goog.fs.url");goog.require("goog.userAgent");goog.fs.get_=function(b,a){var c=goog.global.requestFileSystem||goog.global.webkitRequestFileSystem;if(!goog.isFunction(c)){return goog.async.Deferred.fail(new Error("File API unsupported"))}var e=new goog.async.Deferred();c(b,a,function(d){e.callback(new goog.fs.FileSystemImpl(d))},function(d){e.errback(new goog.fs.Error(d,"requesting filesystem"))});return e};goog.fs.FileSystemType_={TEMPORARY:0,PERSISTENT:1};goog.fs.getTemporary=function(a){return goog.fs.get_(goog.fs.FileSystemType_.TEMPORARY,a)};goog.fs.getPersistent=function(a){return goog.fs.get_(goog.fs.FileSystemType_.PERSISTENT,a)};goog.fs.createObjectUrl=function(a){return goog.fs.url.createObjectUrl(a)};goog.fs.revokeObjectUrl=function(a){goog.fs.url.revokeObjectUrl(a)};goog.fs.browserSupportsObjectUrls=function(){return goog.fs.url.browserSupportsObjectUrls()};goog.fs.getBlob=function(d){var b=goog.global.BlobBuilder||goog.global.WebKitBlobBuilder;if(goog.isDef(b)){var c=new b();for(var a=0;a<arguments.length;a++){c.append(arguments[a])}return c.getBlob()}else{return goog.fs.getBlobWithProperties(goog.array.toArray(arguments))}};goog.fs.getBlobWithProperties=function(e,g,d){var c=goog.global.BlobBuilder||goog.global.WebKitBlobBuilder;if(goog.isDef(c)){var f=new c();for(var b=0;b<e.length;b++){f.append(e[b],d)}return f.getBlob(g)}else{if(goog.isDef(goog.global.Blob)){var a={};if(g){a.type=g}if(d){a.endings=d}return new Blob(e,a)}else{throw Error("This browser doesn't seem to support creating Blobs")}}};goog.fs.blobToString=function(a,b){return goog.fs.FileReader.readAsText(a,b)};goog.fs.sliceBlob=function(b,c,a){if(!goog.isDef(a)){a=b.size}if(b.webkitSlice){return b.webkitSlice(c,a)}else{if(b.mozSlice){return b.mozSlice(c,a)}else{if(b.slice){if((goog.userAgent.GECKO&&!goog.userAgent.isVersionOrHigher("13.0"))||(goog.userAgent.WEBKIT&&!goog.userAgent.isVersionOrHigher("537.1"))){if(c<0){c+=b.size}if(c<0){c=0}if(a<0){a+=b.size}if(a<c){a=c}return b.slice(c,a-c)}return b.slice(c,a)}}}return null};goog.provide("goog.dom.TagName");goog.dom.TagName={A:"A",ABBR:"ABBR",ACRONYM:"ACRONYM",ADDRESS:"ADDRESS",APPLET:"APPLET",AREA:"AREA",ARTICLE:"ARTICLE",ASIDE:"ASIDE",AUDIO:"AUDIO",B:"B",BASE:"BASE",BASEFONT:"BASEFONT",BDI:"BDI",BDO:"BDO",BIG:"BIG",BLOCKQUOTE:"BLOCKQUOTE",BODY:"BODY",BR:"BR",BUTTON:"BUTTON",CANVAS:"CANVAS",CAPTION:"CAPTION",CENTER:"CENTER",CITE:"CITE",CODE:"CODE",COL:"COL",COLGROUP:"COLGROUP",COMMAND:"COMMAND",DATA:"DATA",DATALIST:"DATALIST",DD:"DD",DEL:"DEL",DETAILS:"DETAILS",DFN:"DFN",DIALOG:"DIALOG",DIR:"DIR",DIV:"DIV",DL:"DL",DT:"DT",EM:"EM",EMBED:"EMBED",FIELDSET:"FIELDSET",FIGCAPTION:"FIGCAPTION",FIGURE:"FIGURE",FONT:"FONT",FOOTER:"FOOTER",FORM:"FORM",FRAME:"FRAME",FRAMESET:"FRAMESET",H1:"H1",H2:"H2",H3:"H3",H4:"H4",H5:"H5",H6:"H6",HEAD:"HEAD",HEADER:"HEADER",HGROUP:"HGROUP",HR:"HR",HTML:"HTML",I:"I",IFRAME:"IFRAME",IMG:"IMG",INPUT:"INPUT",INS:"INS",ISINDEX:"ISINDEX",KBD:"KBD",KEYGEN:"KEYGEN",LABEL:"LABEL",LEGEND:"LEGEND",LI:"LI",LINK:"LINK",MAP:"MAP",MARK:"MARK",MATH:"MATH",MENU:"MENU",META:"META",METER:"METER",NAV:"NAV",NOFRAMES:"NOFRAMES",NOSCRIPT:"NOSCRIPT",OBJECT:"OBJECT",OL:"OL",OPTGROUP:"OPTGROUP",OPTION:"OPTION",OUTPUT:"OUTPUT",P:"P",PARAM:"PARAM",PRE:"PRE",PROGRESS:"PROGRESS",Q:"Q",RP:"RP",RT:"RT",RUBY:"RUBY",S:"S",SAMP:"SAMP",SCRIPT:"SCRIPT",SECTION:"SECTION",SELECT:"SELECT",SMALL:"SMALL",SOURCE:"SOURCE",SPAN:"SPAN",STRIKE:"STRIKE",STRONG:"STRONG",STYLE:"STYLE",SUB:"SUB",SUMMARY:"SUMMARY",SUP:"SUP",SVG:"SVG",TABLE:"TABLE",TBODY:"TBODY",TD:"TD",TEXTAREA:"TEXTAREA",TFOOT:"TFOOT",TH:"TH",THEAD:"THEAD",TIME:"TIME",TITLE:"TITLE",TR:"TR",TRACK:"TRACK",TT:"TT",U:"U",UL:"UL",VAR:"VAR",VIDEO:"VIDEO",WBR:"WBR"};goog.provide("goog.math.Size");goog.math.Size=function(b,a){this.width=b;this.height=a};goog.math.Size.equals=function(d,c){if(d==c){return true}if(!d||!c){return false}return d.width==c.width&&d.height==c.height};goog.math.Size.prototype.clone=function(){return new goog.math.Size(this.width,this.height)};if(goog.DEBUG){goog.math.Size.prototype.toString=function(){return"("+this.width+" x "+this.height+")"}}goog.math.Size.prototype.getLongest=function(){return Math.max(this.width,this.height)};goog.math.Size.prototype.getShortest=function(){return Math.min(this.width,this.height)};goog.math.Size.prototype.area=function(){return this.width*this.height};goog.math.Size.prototype.perimeter=function(){return(this.width+this.height)*2};goog.math.Size.prototype.aspectRatio=function(){return this.width/this.height};goog.math.Size.prototype.isEmpty=function(){return !this.area()};goog.math.Size.prototype.ceil=function(){this.width=Math.ceil(this.width);this.height=Math.ceil(this.height);return this};goog.math.Size.prototype.fitsInside=function(a){return this.width<=a.width&&this.height<=a.height};goog.math.Size.prototype.floor=function(){this.width=Math.floor(this.width);this.height=Math.floor(this.height);return this};goog.math.Size.prototype.round=function(){this.width=Math.round(this.width);this.height=Math.round(this.height);return this};goog.math.Size.prototype.scale=function(c,b){var a=goog.isNumber(b)?b:c;this.width*=c;this.height*=a;return this};goog.math.Size.prototype.scaleToCover=function(b){var a=this.aspectRatio()<=b.aspectRatio()?b.width/this.width:b.height/this.height;return this.scale(a)};goog.math.Size.prototype.scaleToFit=function(b){var a=this.aspectRatio()>b.aspectRatio()?b.width/this.width:b.height/this.height;return this.scale(a)};goog.provide("goog.string.TypedString");goog.string.TypedString=function(){};goog.string.TypedString.prototype.implementsGoogStringTypedString;goog.string.TypedString.prototype.getTypedStringValue;goog.provide("goog.string.Const");goog.require("goog.asserts");goog.require("goog.string.TypedString");goog.string.Const=function(){this.stringConstValueWithSecurityContract__googStringSecurityPrivate_="";this.STRING_CONST_TYPE_MARKER__GOOG_STRING_SECURITY_PRIVATE_=goog.string.Const.TYPE_MARKER_};goog.string.Const.prototype.implementsGoogStringTypedString=true;goog.string.Const.prototype.getTypedStringValue=function(){return this.stringConstValueWithSecurityContract__googStringSecurityPrivate_};goog.string.Const.prototype.toString=function(){return"Const{"+this.stringConstValueWithSecurityContract__googStringSecurityPrivate_+"}"};goog.string.Const.unwrap=function(a){if(a instanceof goog.string.Const&&a.constructor===goog.string.Const&&a.STRING_CONST_TYPE_MARKER__GOOG_STRING_SECURITY_PRIVATE_===goog.string.Const.TYPE_MARKER_){return a.stringConstValueWithSecurityContract__googStringSecurityPrivate_}else{goog.asserts.fail("expected object of type Const, got '"+a+"'");return"type_error:Const"}};goog.string.Const.from=function(a){return goog.string.Const.create__googStringSecurityPrivate_(a)};goog.string.Const.TYPE_MARKER_={};goog.string.Const.create__googStringSecurityPrivate_=function(b){var a=new goog.string.Const();a.stringConstValueWithSecurityContract__googStringSecurityPrivate_=b;return a};goog.provide("goog.i18n.bidi");goog.provide("goog.i18n.bidi.Dir");goog.provide("goog.i18n.bidi.DirectionalString");goog.provide("goog.i18n.bidi.Format");goog.define("goog.i18n.bidi.FORCE_RTL",false);goog.i18n.bidi.IS_RTL=goog.i18n.bidi.FORCE_RTL||((goog.LOCALE.substring(0,2).toLowerCase()=="ar"||goog.LOCALE.substring(0,2).toLowerCase()=="fa"||goog.LOCALE.substring(0,2).toLowerCase()=="he"||goog.LOCALE.substring(0,2).toLowerCase()=="iw"||goog.LOCALE.substring(0,2).toLowerCase()=="ps"||goog.LOCALE.substring(0,2).toLowerCase()=="sd"||goog.LOCALE.substring(0,2).toLowerCase()=="ug"||goog.LOCALE.substring(0,2).toLowerCase()=="ur"||goog.LOCALE.substring(0,2).toLowerCase()=="yi")&&(goog.LOCALE.length==2||goog.LOCALE.substring(2,3)=="-"||goog.LOCALE.substring(2,3)=="_"))||(goog.LOCALE.length>=3&&goog.LOCALE.substring(0,3).toLowerCase()=="ckb"&&(goog.LOCALE.length==3||goog.LOCALE.substring(3,4)=="-"||goog.LOCALE.substring(3,4)=="_"));goog.i18n.bidi.Format={LRE:"\u202A",RLE:"\u202B",PDF:"\u202C",LRM:"\u200E",RLM:"\u200F"};goog.i18n.bidi.Dir={LTR:1,RTL:-1,NEUTRAL:0};goog.i18n.bidi.RIGHT="right";goog.i18n.bidi.LEFT="left";goog.i18n.bidi.I18N_RIGHT=goog.i18n.bidi.IS_RTL?goog.i18n.bidi.LEFT:goog.i18n.bidi.RIGHT;goog.i18n.bidi.I18N_LEFT=goog.i18n.bidi.IS_RTL?goog.i18n.bidi.RIGHT:goog.i18n.bidi.LEFT;goog.i18n.bidi.toDir=function(b,a){if(typeof b=="number"){return b>0?goog.i18n.bidi.Dir.LTR:b<0?goog.i18n.bidi.Dir.RTL:a?null:goog.i18n.bidi.Dir.NEUTRAL}else{if(b==null){return null}else{return b?goog.i18n.bidi.Dir.RTL:goog.i18n.bidi.Dir.LTR}}};goog.i18n.bidi.ltrChars_="A-Za-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02B8\u0300-\u0590\u0800-\u1FFF\u200E\u2C00-\uFB1C\uFE00-\uFE6F\uFEFD-\uFFFF";goog.i18n.bidi.rtlChars_="\u0591-\u07FF\u200F\uFB1D-\uFDFF\uFE70-\uFEFC";goog.i18n.bidi.htmlSkipReg_=/<[^>]*>|&[^;]+;/g;goog.i18n.bidi.stripHtmlIfNeeded_=function(a,b){return b?a.replace(goog.i18n.bidi.htmlSkipReg_,""):a};goog.i18n.bidi.rtlCharReg_=new RegExp("["+goog.i18n.bidi.rtlChars_+"]");goog.i18n.bidi.ltrCharReg_=new RegExp("["+goog.i18n.bidi.ltrChars_+"]");goog.i18n.bidi.hasAnyRtl=function(b,a){return goog.i18n.bidi.rtlCharReg_.test(goog.i18n.bidi.stripHtmlIfNeeded_(b,a))};goog.i18n.bidi.hasRtlChar=goog.i18n.bidi.hasAnyRtl;goog.i18n.bidi.hasAnyLtr=function(b,a){return goog.i18n.bidi.ltrCharReg_.test(goog.i18n.bidi.stripHtmlIfNeeded_(b,a))};goog.i18n.bidi.ltrRe_=new RegExp("^["+goog.i18n.bidi.ltrChars_+"]");goog.i18n.bidi.rtlRe_=new RegExp("^["+goog.i18n.bidi.rtlChars_+"]");goog.i18n.bidi.isRtlChar=function(a){return goog.i18n.bidi.rtlRe_.test(a)};goog.i18n.bidi.isLtrChar=function(a){return goog.i18n.bidi.ltrRe_.test(a)};goog.i18n.bidi.isNeutralChar=function(a){return !goog.i18n.bidi.isLtrChar(a)&&!goog.i18n.bidi.isRtlChar(a)};goog.i18n.bidi.ltrDirCheckRe_=new RegExp("^[^"+goog.i18n.bidi.rtlChars_+"]*["+goog.i18n.bidi.ltrChars_+"]");goog.i18n.bidi.rtlDirCheckRe_=new RegExp("^[^"+goog.i18n.bidi.ltrChars_+"]*["+goog.i18n.bidi.rtlChars_+"]");goog.i18n.bidi.startsWithRtl=function(b,a){return goog.i18n.bidi.rtlDirCheckRe_.test(goog.i18n.bidi.stripHtmlIfNeeded_(b,a))};goog.i18n.bidi.isRtlText=goog.i18n.bidi.startsWithRtl;goog.i18n.bidi.startsWithLtr=function(b,a){return goog.i18n.bidi.ltrDirCheckRe_.test(goog.i18n.bidi.stripHtmlIfNeeded_(b,a))};goog.i18n.bidi.isLtrText=goog.i18n.bidi.startsWithLtr;goog.i18n.bidi.isRequiredLtrRe_=/^http:\/\/.*/;goog.i18n.bidi.isNeutralText=function(b,a){b=goog.i18n.bidi.stripHtmlIfNeeded_(b,a);return goog.i18n.bidi.isRequiredLtrRe_.test(b)||!goog.i18n.bidi.hasAnyLtr(b)&&!goog.i18n.bidi.hasAnyRtl(b)};goog.i18n.bidi.ltrExitDirCheckRe_=new RegExp("["+goog.i18n.bidi.ltrChars_+"][^"+goog.i18n.bidi.rtlChars_+"]*$");goog.i18n.bidi.rtlExitDirCheckRe_=new RegExp("["+goog.i18n.bidi.rtlChars_+"][^"+goog.i18n.bidi.ltrChars_+"]*$");goog.i18n.bidi.endsWithLtr=function(b,a){return goog.i18n.bidi.ltrExitDirCheckRe_.test(goog.i18n.bidi.stripHtmlIfNeeded_(b,a))};goog.i18n.bidi.isLtrExitText=goog.i18n.bidi.endsWithLtr;goog.i18n.bidi.endsWithRtl=function(b,a){return goog.i18n.bidi.rtlExitDirCheckRe_.test(goog.i18n.bidi.stripHtmlIfNeeded_(b,a))};goog.i18n.bidi.isRtlExitText=goog.i18n.bidi.endsWithRtl;goog.i18n.bidi.rtlLocalesRe_=new RegExp("^(ar|ckb|dv|he|iw|fa|nqo|ps|sd|ug|ur|yi|.*[-_](Arab|Hebr|Thaa|Nkoo|Tfng))(?!.*[-_](Latn|Cyrl)($|-|_))($|-|_)","i");goog.i18n.bidi.isRtlLanguage=function(a){return goog.i18n.bidi.rtlLocalesRe_.test(a)};goog.i18n.bidi.bracketGuardHtmlRe_=/(\(.*?\)+)|(\[.*?\]+)|(\{.*?\}+)|(&lt;.*?(&gt;)+)/g;goog.i18n.bidi.bracketGuardTextRe_=/(\(.*?\)+)|(\[.*?\]+)|(\{.*?\}+)|(<.*?>+)/g;goog.i18n.bidi.guardBracketInHtml=function(c,a){var b=a===undefined?goog.i18n.bidi.hasAnyRtl(c):a;if(b){return c.replace(goog.i18n.bidi.bracketGuardHtmlRe_,"<span dir=rtl>$&</span>")}return c.replace(goog.i18n.bidi.bracketGuardHtmlRe_,"<span dir=ltr>$&</span>")};goog.i18n.bidi.guardBracketInText=function(c,a){var b=a===undefined?goog.i18n.bidi.hasAnyRtl(c):a;var d=b?goog.i18n.bidi.Format.RLM:goog.i18n.bidi.Format.LRM;return c.replace(goog.i18n.bidi.bracketGuardTextRe_,d+"$&"+d)};goog.i18n.bidi.enforceRtlInHtml=function(a){if(a.charAt(0)=="<"){return a.replace(/<\w+/,"$& dir=rtl")}return"\n<span dir=rtl>"+a+"</span>"};goog.i18n.bidi.enforceRtlInText=function(a){return goog.i18n.bidi.Format.RLE+a+goog.i18n.bidi.Format.PDF};goog.i18n.bidi.enforceLtrInHtml=function(a){if(a.charAt(0)=="<"){return a.replace(/<\w+/,"$& dir=ltr")}return"\n<span dir=ltr>"+a+"</span>"};goog.i18n.bidi.enforceLtrInText=function(a){return goog.i18n.bidi.Format.LRE+a+goog.i18n.bidi.Format.PDF};goog.i18n.bidi.dimensionsRe_=/:\s*([.\d][.\w]*)\s+([.\d][.\w]*)\s+([.\d][.\w]*)\s+([.\d][.\w]*)/g;goog.i18n.bidi.leftRe_=/left/gi;goog.i18n.bidi.rightRe_=/right/gi;goog.i18n.bidi.tempRe_=/%%%%/g;goog.i18n.bidi.mirrorCSS=function(a){return a.replace(goog.i18n.bidi.dimensionsRe_,":$1 $4 $3 $2").replace(goog.i18n.bidi.leftRe_,"%%%%").replace(goog.i18n.bidi.rightRe_,goog.i18n.bidi.LEFT).replace(goog.i18n.bidi.tempRe_,goog.i18n.bidi.RIGHT)};goog.i18n.bidi.doubleQuoteSubstituteRe_=/([\u0591-\u05f2])"/g;goog.i18n.bidi.singleQuoteSubstituteRe_=/([\u0591-\u05f2])'/g;goog.i18n.bidi.normalizeHebrewQuote=function(a){return a.replace(goog.i18n.bidi.doubleQuoteSubstituteRe_,"$1\u05f4").replace(goog.i18n.bidi.singleQuoteSubstituteRe_,"$1\u05f3")};goog.i18n.bidi.wordSeparatorRe_=/\s+/;goog.i18n.bidi.hasNumeralsRe_=/\d/;goog.i18n.bidi.rtlDetectionThreshold_=0.4;goog.i18n.bidi.estimateDirection=function(h,c){var d=0;var a=0;var b=false;var g=goog.i18n.bidi.stripHtmlIfNeeded_(h,c).split(goog.i18n.bidi.wordSeparatorRe_);for(var f=0;f<g.length;f++){var e=g[f];if(goog.i18n.bidi.startsWithRtl(e)){d++;a++}else{if(goog.i18n.bidi.isRequiredLtrRe_.test(e)){b=true}else{if(goog.i18n.bidi.hasAnyLtr(e)){a++}else{if(goog.i18n.bidi.hasNumeralsRe_.test(e)){b=true}}}}}return a==0?(b?goog.i18n.bidi.Dir.LTR:goog.i18n.bidi.Dir.NEUTRAL):(d/a>goog.i18n.bidi.rtlDetectionThreshold_?goog.i18n.bidi.Dir.RTL:goog.i18n.bidi.Dir.LTR)};goog.i18n.bidi.detectRtlDirectionality=function(b,a){return goog.i18n.bidi.estimateDirection(b,a)==goog.i18n.bidi.Dir.RTL};goog.i18n.bidi.setElementDirAndAlign=function(b,a){if(b){a=goog.i18n.bidi.toDir(a);if(a){b.style.textAlign=a==goog.i18n.bidi.Dir.RTL?goog.i18n.bidi.RIGHT:goog.i18n.bidi.LEFT;b.dir=a==goog.i18n.bidi.Dir.RTL?"rtl":"ltr"}}};goog.i18n.bidi.DirectionalString=function(){};goog.i18n.bidi.DirectionalString.prototype.implementsGoogI18nBidiDirectionalString;goog.i18n.bidi.DirectionalString.prototype.getDirection;goog.provide("goog.html.SafeUrl");goog.require("goog.asserts");goog.require("goog.fs.url");goog.require("goog.i18n.bidi.Dir");goog.require("goog.i18n.bidi.DirectionalString");goog.require("goog.string.Const");goog.require("goog.string.TypedString");goog.html.SafeUrl=function(){this.privateDoNotAccessOrElseSafeHtmlWrappedValue_="";this.SAFE_URL_TYPE_MARKER_GOOG_HTML_SECURITY_PRIVATE_=goog.html.SafeUrl.TYPE_MARKER_GOOG_HTML_SECURITY_PRIVATE_};goog.html.SafeUrl.INNOCUOUS_STRING="about:invalid#zClosurez";goog.html.SafeUrl.prototype.implementsGoogStringTypedString=true;goog.html.SafeUrl.prototype.getTypedStringValue=function(){return this.privateDoNotAccessOrElseSafeHtmlWrappedValue_};goog.html.SafeUrl.prototype.implementsGoogI18nBidiDirectionalString=true;goog.html.SafeUrl.prototype.getDirection=function(){return goog.i18n.bidi.Dir.LTR};if(goog.DEBUG){goog.html.SafeUrl.prototype.toString=function(){return"SafeUrl{"+this.privateDoNotAccessOrElseSafeHtmlWrappedValue_+"}"}}goog.html.SafeUrl.unwrap=function(a){if(a instanceof goog.html.SafeUrl&&a.constructor===goog.html.SafeUrl&&a.SAFE_URL_TYPE_MARKER_GOOG_HTML_SECURITY_PRIVATE_===goog.html.SafeUrl.TYPE_MARKER_GOOG_HTML_SECURITY_PRIVATE_){return a.privateDoNotAccessOrElseSafeHtmlWrappedValue_}else{goog.asserts.fail("expected object of type SafeUrl, got '"+a+"'");return"type_error:SafeUrl"}};goog.html.SafeUrl.fromConstant=function(a){return goog.html.SafeUrl.createSafeUrlSecurityPrivateDoNotAccessOrElse(goog.string.Const.unwrap(a))};goog.html.SAFE_BLOB_TYPE_PATTERN_=/^image\/(?:bmp|gif|jpeg|jpg|png|tiff|webp)$/i;goog.html.SafeUrl.fromBlob=function(a){var b=goog.html.SAFE_BLOB_TYPE_PATTERN_.test(a.type)?goog.fs.url.createObjectUrl(a):goog.html.SafeUrl.INNOCUOUS_STRING;return goog.html.SafeUrl.createSafeUrlSecurityPrivateDoNotAccessOrElse(b)};goog.html.SAFE_URL_PATTERN_=/^(?:(?:https?|mailto|ftp):|[^&:/?#]*(?:[/?#]|$))/i;goog.html.SafeUrl.sanitize=function(a){if(a instanceof goog.html.SafeUrl){return a}else{if(a.implementsGoogStringTypedString){a=a.getTypedStringValue()}else{a=String(a)}}if(!goog.html.SAFE_URL_PATTERN_.test(a)){a=goog.html.SafeUrl.INNOCUOUS_STRING}else{a=goog.html.SafeUrl.normalize_(a)}return goog.html.SafeUrl.createSafeUrlSecurityPrivateDoNotAccessOrElse(a)};goog.html.SafeUrl.normalize_=function(a){try{var c=encodeURI(a)}catch(b){return goog.html.SafeUrl.INNOCUOUS_STRING}return c.replace(goog.html.SafeUrl.NORMALIZE_MATCHER_,function(d){return goog.html.SafeUrl.NORMALIZE_REPLACER_MAP_[d]})};goog.html.SafeUrl.NORMALIZE_MATCHER_=/[()']|%5B|%5D|%25/g;goog.html.SafeUrl.NORMALIZE_REPLACER_MAP_={"'":"%27","(":"%28",")":"%29","%5B":"[","%5D":"]","%25":"%"};goog.html.SafeUrl.TYPE_MARKER_GOOG_HTML_SECURITY_PRIVATE_={};goog.html.SafeUrl.createSafeUrlSecurityPrivateDoNotAccessOrElse=function(a){var b=new goog.html.SafeUrl();b.privateDoNotAccessOrElseSafeHtmlWrappedValue_=a;return b};goog.provide("goog.dom.tags");goog.require("goog.object");goog.dom.tags.VOID_TAGS_=goog.object.createSet(("area,base,br,col,command,embed,hr,img,input,keygen,link,meta,param,source,track,wbr").split(","));goog.dom.tags.isVoidTag=function(a){return goog.dom.tags.VOID_TAGS_[a]===true};goog.provide("goog.html.SafeStyle");goog.require("goog.array");goog.require("goog.asserts");goog.require("goog.string");goog.require("goog.string.Const");goog.require("goog.string.TypedString");goog.html.SafeStyle=function(){this.privateDoNotAccessOrElseSafeStyleWrappedValue_="";this.SAFE_STYLE_TYPE_MARKER_GOOG_HTML_SECURITY_PRIVATE_=goog.html.SafeStyle.TYPE_MARKER_GOOG_HTML_SECURITY_PRIVATE_};goog.html.SafeStyle.prototype.implementsGoogStringTypedString=true;goog.html.SafeStyle.TYPE_MARKER_GOOG_HTML_SECURITY_PRIVATE_={};goog.html.SafeStyle.fromConstant=function(b){var a=goog.string.Const.unwrap(b);if(a.length===0){return goog.html.SafeStyle.EMPTY}goog.html.SafeStyle.checkStyle_(a);goog.asserts.assert(goog.string.endsWith(a,";"),"Last character of style string is not ';': "+a);goog.asserts.assert(goog.string.contains(a,":"),"Style string must contain at least one ':', to specify a \"name: value\" pair: "+a);return goog.html.SafeStyle.createSafeStyleSecurityPrivateDoNotAccessOrElse(a)};goog.html.SafeStyle.checkStyle_=function(a){goog.asserts.assert(!/[<>]/.test(a),"Forbidden characters in style string: "+a)};goog.html.SafeStyle.prototype.getTypedStringValue=function(){return this.privateDoNotAccessOrElseSafeStyleWrappedValue_};if(goog.DEBUG){goog.html.SafeStyle.prototype.toString=function(){return"SafeStyle{"+this.privateDoNotAccessOrElseSafeStyleWrappedValue_+"}"}}goog.html.SafeStyle.unwrap=function(a){if(a instanceof goog.html.SafeStyle&&a.constructor===goog.html.SafeStyle&&a.SAFE_STYLE_TYPE_MARKER_GOOG_HTML_SECURITY_PRIVATE_===goog.html.SafeStyle.TYPE_MARKER_GOOG_HTML_SECURITY_PRIVATE_){return a.privateDoNotAccessOrElseSafeStyleWrappedValue_}else{goog.asserts.fail("expected object of type SafeStyle, got '"+a+"'");return"type_error:SafeStyle"}};goog.html.SafeStyle.createSafeStyleSecurityPrivateDoNotAccessOrElse=function(a){return new goog.html.SafeStyle().initSecurityPrivateDoNotAccessOrElse_(a)};goog.html.SafeStyle.prototype.initSecurityPrivateDoNotAccessOrElse_=function(a){this.privateDoNotAccessOrElseSafeStyleWrappedValue_=a;return this};goog.html.SafeStyle.EMPTY=goog.html.SafeStyle.createSafeStyleSecurityPrivateDoNotAccessOrElse("");goog.html.SafeStyle.INNOCUOUS_STRING="zClosurez";goog.html.SafeStyle.PropertyMap;goog.html.SafeStyle.create=function(d){var b="";for(var a in d){if(!/^[-_a-zA-Z0-9]+$/.test(a)){throw Error("Name allows only [-_a-zA-Z0-9], got: "+a)}var c=d[a];if(c==null){continue}if(c instanceof goog.string.Const){c=goog.string.Const.unwrap(c);goog.asserts.assert(!/[{;}]/.test(c),"Value does not allow [{;}].")}else{if(!goog.html.SafeStyle.VALUE_RE_.test(c)){goog.asserts.fail("String value allows only [-,.\"'%_!# a-zA-Z0-9], got: "+c);c=goog.html.SafeStyle.INNOCUOUS_STRING}else{if(!goog.html.SafeStyle.hasBalancedQuotes_(c)){goog.asserts.fail("String value requires balanced quotes, got: "+c);c=goog.html.SafeStyle.INNOCUOUS_STRING}}}b+=a+":"+c+";"}if(!b){return goog.html.SafeStyle.EMPTY}goog.html.SafeStyle.checkStyle_(b);return goog.html.SafeStyle.createSafeStyleSecurityPrivateDoNotAccessOrElse(b)};goog.html.SafeStyle.hasBalancedQuotes_=function(e){var a=true;var d=true;for(var b=0;b<e.length;b++){var f=e.charAt(b);if(f=="'"&&d){a=!a}else{if(f=='"'&&a){d=!d}}}return a&&d};goog.html.SafeStyle.VALUE_RE_=/^[-,."'%_!# a-zA-Z0-9]+$/;goog.html.SafeStyle.concat=function(c){var b="";var a=function(d){if(goog.isArray(d)){goog.array.forEach(d,a)}else{b+=goog.html.SafeStyle.unwrap(d)}};goog.array.forEach(arguments,a);if(!b){return goog.html.SafeStyle.EMPTY}return goog.html.SafeStyle.createSafeStyleSecurityPrivateDoNotAccessOrElse(b)};goog.provide("goog.html.TrustedResourceUrl");goog.require("goog.asserts");goog.require("goog.i18n.bidi.Dir");goog.require("goog.i18n.bidi.DirectionalString");goog.require("goog.string.Const");goog.require("goog.string.TypedString");goog.html.TrustedResourceUrl=function(){this.privateDoNotAccessOrElseTrustedResourceUrlWrappedValue_="";this.TRUSTED_RESOURCE_URL_TYPE_MARKER_GOOG_HTML_SECURITY_PRIVATE_=goog.html.TrustedResourceUrl.TYPE_MARKER_GOOG_HTML_SECURITY_PRIVATE_};goog.html.TrustedResourceUrl.prototype.implementsGoogStringTypedString=true;goog.html.TrustedResourceUrl.prototype.getTypedStringValue=function(){return this.privateDoNotAccessOrElseTrustedResourceUrlWrappedValue_};goog.html.TrustedResourceUrl.prototype.implementsGoogI18nBidiDirectionalString=true;goog.html.TrustedResourceUrl.prototype.getDirection=function(){return goog.i18n.bidi.Dir.LTR};if(goog.DEBUG){goog.html.TrustedResourceUrl.prototype.toString=function(){return"TrustedResourceUrl{"+this.privateDoNotAccessOrElseTrustedResourceUrlWrappedValue_+"}"}}goog.html.TrustedResourceUrl.unwrap=function(a){if(a instanceof goog.html.TrustedResourceUrl&&a.constructor===goog.html.TrustedResourceUrl&&a.TRUSTED_RESOURCE_URL_TYPE_MARKER_GOOG_HTML_SECURITY_PRIVATE_===goog.html.TrustedResourceUrl.TYPE_MARKER_GOOG_HTML_SECURITY_PRIVATE_){return a.privateDoNotAccessOrElseTrustedResourceUrlWrappedValue_}else{goog.asserts.fail("expected object of type TrustedResourceUrl, got '"+a+"'");return"type_error:TrustedResourceUrl"}};goog.html.TrustedResourceUrl.fromConstant=function(a){return goog.html.TrustedResourceUrl.createTrustedResourceUrlSecurityPrivateDoNotAccessOrElse(goog.string.Const.unwrap(a))};goog.html.TrustedResourceUrl.TYPE_MARKER_GOOG_HTML_SECURITY_PRIVATE_={};goog.html.TrustedResourceUrl.createTrustedResourceUrlSecurityPrivateDoNotAccessOrElse=function(a){var b=new goog.html.TrustedResourceUrl();b.privateDoNotAccessOrElseTrustedResourceUrlWrappedValue_=a;return b};goog.provide("goog.html.SafeStyleSheet");goog.require("goog.array");goog.require("goog.asserts");goog.require("goog.string");goog.require("goog.string.Const");goog.require("goog.string.TypedString");goog.html.SafeStyleSheet=function(){this.privateDoNotAccessOrElseSafeStyleSheetWrappedValue_="";this.SAFE_SCRIPT_TYPE_MARKER_GOOG_HTML_SECURITY_PRIVATE_=goog.html.SafeStyleSheet.TYPE_MARKER_GOOG_HTML_SECURITY_PRIVATE_};goog.html.SafeStyleSheet.prototype.implementsGoogStringTypedString=true;goog.html.SafeStyleSheet.TYPE_MARKER_GOOG_HTML_SECURITY_PRIVATE_={};goog.html.SafeStyleSheet.concat=function(c){var a="";var b=function(d){if(goog.isArray(d)){goog.array.forEach(d,b)}else{a+=goog.html.SafeStyleSheet.unwrap(d)}};goog.array.forEach(arguments,b);return goog.html.SafeStyleSheet.createSafeStyleSheetSecurityPrivateDoNotAccessOrElse(a)};goog.html.SafeStyleSheet.fromConstant=function(b){var a=goog.string.Const.unwrap(b);if(a.length===0){return goog.html.SafeStyleSheet.EMPTY}goog.asserts.assert(!goog.string.contains(a,"<"),"Forbidden '<' character in style sheet string: "+a);return goog.html.SafeStyleSheet.createSafeStyleSheetSecurityPrivateDoNotAccessOrElse(a)};goog.html.SafeStyleSheet.prototype.getTypedStringValue=function(){return this.privateDoNotAccessOrElseSafeStyleSheetWrappedValue_};if(goog.DEBUG){goog.html.SafeStyleSheet.prototype.toString=function(){return"SafeStyleSheet{"+this.privateDoNotAccessOrElseSafeStyleSheetWrappedValue_+"}"}}goog.html.SafeStyleSheet.unwrap=function(a){if(a instanceof goog.html.SafeStyleSheet&&a.constructor===goog.html.SafeStyleSheet&&a.SAFE_SCRIPT_TYPE_MARKER_GOOG_HTML_SECURITY_PRIVATE_===goog.html.SafeStyleSheet.TYPE_MARKER_GOOG_HTML_SECURITY_PRIVATE_){return a.privateDoNotAccessOrElseSafeStyleSheetWrappedValue_}else{goog.asserts.fail("expected object of type SafeStyleSheet, got '"+a+"'");return"type_error:SafeStyleSheet"}};goog.html.SafeStyleSheet.createSafeStyleSheetSecurityPrivateDoNotAccessOrElse=function(a){return new goog.html.SafeStyleSheet().initSecurityPrivateDoNotAccessOrElse_(a)};goog.html.SafeStyleSheet.prototype.initSecurityPrivateDoNotAccessOrElse_=function(a){this.privateDoNotAccessOrElseSafeStyleSheetWrappedValue_=a;return this};goog.html.SafeStyleSheet.EMPTY=goog.html.SafeStyleSheet.createSafeStyleSheetSecurityPrivateDoNotAccessOrElse("");goog.provide("goog.html.SafeHtml");goog.require("goog.array");goog.require("goog.asserts");goog.require("goog.dom.tags");goog.require("goog.html.SafeStyle");goog.require("goog.html.SafeStyleSheet");goog.require("goog.html.SafeUrl");goog.require("goog.html.TrustedResourceUrl");goog.require("goog.i18n.bidi.Dir");goog.require("goog.i18n.bidi.DirectionalString");goog.require("goog.object");goog.require("goog.string");goog.require("goog.string.Const");goog.require("goog.string.TypedString");goog.html.SafeHtml=function(){this.privateDoNotAccessOrElseSafeHtmlWrappedValue_="";this.SAFE_HTML_TYPE_MARKER_GOOG_HTML_SECURITY_PRIVATE_=goog.html.SafeHtml.TYPE_MARKER_GOOG_HTML_SECURITY_PRIVATE_;this.dir_=null};goog.html.SafeHtml.prototype.implementsGoogI18nBidiDirectionalString=true;goog.html.SafeHtml.prototype.getDirection=function(){return this.dir_};goog.html.SafeHtml.prototype.implementsGoogStringTypedString=true;goog.html.SafeHtml.prototype.getTypedStringValue=function(){return this.privateDoNotAccessOrElseSafeHtmlWrappedValue_};if(goog.DEBUG){goog.html.SafeHtml.prototype.toString=function(){return"SafeHtml{"+this.privateDoNotAccessOrElseSafeHtmlWrappedValue_+"}"}}goog.html.SafeHtml.unwrap=function(a){if(a instanceof goog.html.SafeHtml&&a.constructor===goog.html.SafeHtml&&a.SAFE_HTML_TYPE_MARKER_GOOG_HTML_SECURITY_PRIVATE_===goog.html.SafeHtml.TYPE_MARKER_GOOG_HTML_SECURITY_PRIVATE_){return a.privateDoNotAccessOrElseSafeHtmlWrappedValue_}else{goog.asserts.fail("expected object of type SafeHtml, got '"+a+"'");return"type_error:SafeHtml"}};goog.html.SafeHtml.TextOrHtml_;goog.html.SafeHtml.htmlEscape=function(b){if(b instanceof goog.html.SafeHtml){return b}var c=null;if(b.implementsGoogI18nBidiDirectionalString){c=b.getDirection()}var a;if(b.implementsGoogStringTypedString){a=b.getTypedStringValue()}else{a=String(b)}return goog.html.SafeHtml.createSafeHtmlSecurityPrivateDoNotAccessOrElse(goog.string.htmlEscape(a),c)};goog.html.SafeHtml.htmlEscapePreservingNewlines=function(a){if(a instanceof goog.html.SafeHtml){return a}var b=goog.html.SafeHtml.htmlEscape(a);return goog.html.SafeHtml.createSafeHtmlSecurityPrivateDoNotAccessOrElse(goog.string.newLineToBr(goog.html.SafeHtml.unwrap(b)),b.getDirection())};goog.html.SafeHtml.htmlEscapePreservingNewlinesAndSpaces=function(a){if(a instanceof goog.html.SafeHtml){return a}var b=goog.html.SafeHtml.htmlEscape(a);return goog.html.SafeHtml.createSafeHtmlSecurityPrivateDoNotAccessOrElse(goog.string.whitespaceEscape(goog.html.SafeHtml.unwrap(b)),b.getDirection())};goog.html.SafeHtml.from=goog.html.SafeHtml.htmlEscape;goog.html.SafeHtml.VALID_NAMES_IN_TAG_=/^[a-zA-Z0-9-]+$/;goog.html.SafeHtml.URL_ATTRIBUTES_=goog.object.createSet("action","cite","data","formaction","href","manifest","poster","src");goog.html.SafeHtml.NOT_ALLOWED_TAG_NAMES_=goog.object.createSet("embed","iframe","link","object","script","style","template");goog.html.SafeHtml.AttributeValue_;goog.html.SafeHtml.create=function(b,a,c){if(!goog.html.SafeHtml.VALID_NAMES_IN_TAG_.test(b)){throw Error("Invalid tag name <"+b+">.")}if(b.toLowerCase() in goog.html.SafeHtml.NOT_ALLOWED_TAG_NAMES_){throw Error("Tag name <"+b+"> is not allowed for SafeHtml.")}return goog.html.SafeHtml.createSafeHtmlTagSecurityPrivateDoNotAccessOrElse(b,a,c)};goog.html.SafeHtml.createIframe=function(f,d,b,g){var e={};e.src=f||null;e.srcdoc=d||null;var a={sandbox:""};var c=goog.html.SafeHtml.combineAttributes(e,a,b);return goog.html.SafeHtml.createSafeHtmlTagSecurityPrivateDoNotAccessOrElse("iframe",c,g)};goog.html.SafeHtml.createStyle=function(h,b){var e={type:"text/css"};var a={};var c=goog.html.SafeHtml.combineAttributes(e,a,b);var f="";h=goog.array.concat(h);for(var d=0;d<h.length;d++){f+=goog.html.SafeStyleSheet.unwrap(h[d])}var g=goog.html.SafeHtml.createSafeHtmlSecurityPrivateDoNotAccessOrElse(f,goog.i18n.bidi.Dir.NEUTRAL);return goog.html.SafeHtml.createSafeHtmlTagSecurityPrivateDoNotAccessOrElse("style",c,g)};goog.html.SafeHtml.getAttrNameAndValue_=function(b,a,c){if(c instanceof goog.string.Const){c=goog.string.Const.unwrap(c)}else{if(a.toLowerCase()=="style"){c=goog.html.SafeHtml.getStyleValue_(c)}else{if(/^on/i.test(a)){throw Error('Attribute "'+a+'" requires goog.string.Const value, "'+c+'" given.')}else{if(a.toLowerCase() in goog.html.SafeHtml.URL_ATTRIBUTES_){if(c instanceof goog.html.TrustedResourceUrl){c=goog.html.TrustedResourceUrl.unwrap(c)}else{if(c instanceof goog.html.SafeUrl){c=goog.html.SafeUrl.unwrap(c)}else{throw Error('Attribute "'+a+'" on tag "'+b+'" requires goog.html.SafeUrl or goog.string.Const value, "'+c+'" given.')}}}}}}if(c.implementsGoogStringTypedString){c=c.getTypedStringValue()}goog.asserts.assert(goog.isString(c)||goog.isNumber(c),"String or number value expected, got "+(typeof c)+" with value: "+c);return a+'="'+goog.string.htmlEscape(String(c))+'"'};goog.html.SafeHtml.getStyleValue_=function(a){if(!goog.isObject(a)){throw Error('The "style" attribute requires goog.html.SafeStyle or map of style properties, '+(typeof a)+" given: "+a)}if(!(a instanceof goog.html.SafeStyle)){a=goog.html.SafeStyle.create(a)}return goog.html.SafeStyle.unwrap(a)};goog.html.SafeHtml.createWithDir=function(b,d,a,e){var c=goog.html.SafeHtml.create(d,a,e);c.dir_=b;return c};goog.html.SafeHtml.concat=function(d){var b=goog.i18n.bidi.Dir.NEUTRAL;var c="";var a=function(g){if(goog.isArray(g)){goog.array.forEach(g,a)}else{var f=goog.html.SafeHtml.htmlEscape(g);c+=goog.html.SafeHtml.unwrap(f);var e=f.getDirection();if(b==goog.i18n.bidi.Dir.NEUTRAL){b=e}else{if(e!=goog.i18n.bidi.Dir.NEUTRAL&&b!=e){b=null}}}};goog.array.forEach(arguments,a);return goog.html.SafeHtml.createSafeHtmlSecurityPrivateDoNotAccessOrElse(c,b)};goog.html.SafeHtml.concatWithDir=function(a,c){var b=goog.html.SafeHtml.concat(goog.array.slice(arguments,1));b.dir_=a;return b};goog.html.SafeHtml.TYPE_MARKER_GOOG_HTML_SECURITY_PRIVATE_={};goog.html.SafeHtml.createSafeHtmlSecurityPrivateDoNotAccessOrElse=function(b,a){return new goog.html.SafeHtml().initSecurityPrivateDoNotAccessOrElse_(b,a)};goog.html.SafeHtml.prototype.initSecurityPrivateDoNotAccessOrElse_=function(b,a){this.privateDoNotAccessOrElseSafeHtmlWrappedValue_=b;this.dir_=a;return this};goog.html.SafeHtml.createSafeHtmlTagSecurityPrivateDoNotAccessOrElse=function(c,i,f){var d=null;var j="<"+c;if(i){for(var b in i){if(!goog.html.SafeHtml.VALID_NAMES_IN_TAG_.test(b)){throw Error('Invalid attribute name "'+b+'".')}var h=i[b];if(!goog.isDefAndNotNull(h)){continue}j+=" "+goog.html.SafeHtml.getAttrNameAndValue_(c,b,h)}}var g=f;if(!goog.isDef(g)){g=[]}else{if(!goog.isArray(g)){g=[g]}}if(goog.dom.tags.isVoidTag(c.toLowerCase())){goog.asserts.assert(!g.length,"Void tag <"+c+"> does not allow content.");j+=">"}else{var e=goog.html.SafeHtml.concat(g);j+=">"+goog.html.SafeHtml.unwrap(e)+"</"+c+">";d=e.getDirection()}var a=i&&i.dir;if(a){if(/^(ltr|rtl|auto)$/i.test(a)){d=goog.i18n.bidi.Dir.NEUTRAL}else{d=null}}return goog.html.SafeHtml.createSafeHtmlSecurityPrivateDoNotAccessOrElse(j,d)};goog.html.SafeHtml.combineAttributes=function(e,b,c){var a={};var d;for(d in e){goog.asserts.assert(d.toLowerCase()==d,"Must be lower case");a[d]=e[d]}for(d in b){goog.asserts.assert(d.toLowerCase()==d,"Must be lower case");a[d]=b[d]}for(d in c){var f=d.toLowerCase();if(f in e){throw Error('Cannot override "'+f+'" attribute, got "'+d+'" with value "'+c[d]+'"')}if(f in b){delete a[f]}a[d]=c[d]}return a};goog.html.SafeHtml.EMPTY=goog.html.SafeHtml.createSafeHtmlSecurityPrivateDoNotAccessOrElse("",goog.i18n.bidi.Dir.NEUTRAL);goog.provide("goog.dom.safe");goog.require("goog.html.SafeHtml");goog.require("goog.html.SafeUrl");goog.dom.safe.setInnerHtml=function(b,a){b.innerHTML=goog.html.SafeHtml.unwrap(a)};goog.dom.safe.setOuterHtml=function(b,a){b.outerHTML=goog.html.SafeHtml.unwrap(a)};goog.dom.safe.documentWrite=function(b,a){b.write(goog.html.SafeHtml.unwrap(a))};goog.dom.safe.setAnchorHref=function(b,a){var c;if(a instanceof goog.html.SafeUrl){c=a}else{c=goog.html.SafeUrl.sanitize(a)}b.href=goog.html.SafeUrl.unwrap(c)};goog.dom.safe.setLocationHref=function(c,a){var b;if(a instanceof goog.html.SafeUrl){b=a}else{b=goog.html.SafeUrl.sanitize(a)}c.href=goog.html.SafeUrl.unwrap(b)};goog.provide("goog.dom.BrowserFeature");goog.require("goog.userAgent");goog.dom.BrowserFeature={CAN_ADD_NAME_OR_TYPE_ATTRIBUTES:!goog.userAgent.IE||goog.userAgent.isDocumentModeOrHigher(9),CAN_USE_CHILDREN_ATTRIBUTE:!goog.userAgent.GECKO&&!goog.userAgent.IE||goog.userAgent.IE&&goog.userAgent.isDocumentModeOrHigher(9)||goog.userAgent.GECKO&&goog.userAgent.isVersionOrHigher("1.9.1"),CAN_USE_INNER_TEXT:(goog.userAgent.IE&&!goog.userAgent.isVersionOrHigher("9")),CAN_USE_PARENT_ELEMENT_PROPERTY:goog.userAgent.IE||goog.userAgent.OPERA||goog.userAgent.WEBKIT,INNER_HTML_NEEDS_SCOPED_ELEMENT:goog.userAgent.IE,LEGACY_IE_RANGES:goog.userAgent.IE&&!goog.userAgent.isDocumentModeOrHigher(9)};goog.provide("goog.math");goog.require("goog.array");goog.require("goog.asserts");goog.math.randomInt=function(b){return Math.floor(Math.random()*b)};goog.math.uniformRandom=function(d,c){return d+Math.random()*(c-d)};goog.math.clamp=function(c,b,a){return Math.min(Math.max(c,b),a)};goog.math.modulo=function(d,c){var e=d%c;return(e*c<0)?e+c:e};goog.math.lerp=function(e,d,c){return e+c*(d-e)};goog.math.nearlyEquals=function(d,c,e){return Math.abs(d-c)<=(e||0.000001)};goog.math.standardAngle=function(a){return goog.math.modulo(a,360)};goog.math.standardAngleInRadians=function(a){return goog.math.modulo(a,2*Math.PI)};goog.math.toRadians=function(a){return a*Math.PI/180};goog.math.toDegrees=function(a){return a*180/Math.PI};goog.math.angleDx=function(b,a){return a*Math.cos(goog.math.toRadians(b))};goog.math.angleDy=function(b,a){return a*Math.sin(goog.math.toRadians(b))};goog.math.angle=function(b,d,a,c){return goog.math.standardAngle(goog.math.toDegrees(Math.atan2(c-d,a-b)))};goog.math.angleDifference=function(b,a){var c=goog.math.standardAngle(a)-goog.math.standardAngle(b);if(c>180){c=c-360}else{if(c<=-180){c=360+c}}return c};goog.math.sign=function(a){return a==0?0:(a<0?-1:1)};goog.math.longestCommonSubsequence=function(n,l,a,k){var c=a||function(j,i){return j==i};var h=k||function(j,i){return n[j]};var d=n.length;var b=l.length;var g=[];for(var f=0;f<d+1;f++){g[f]=[];g[f][0]=0}for(var e=0;e<b+1;e++){g[0][e]=0}for(f=1;f<=d;f++){for(e=1;e<=b;e++){if(c(n[f-1],l[e-1])){g[f][e]=g[f-1][e-1]+1}else{g[f][e]=Math.max(g[f-1][e],g[f][e-1])}}}var m=[];var f=d,e=b;while(f>0&&e>0){if(c(n[f-1],l[e-1])){m.unshift(h(f-1,e-1));f--;e--}else{if(g[f-1][e]>g[f][e-1]){f--}else{e--}}}return m};goog.math.sum=function(a){return(goog.array.reduce(arguments,function(b,c){return b+c},0))};goog.math.average=function(a){return goog.math.sum.apply(null,arguments)/arguments.length};goog.math.sampleVariance=function(d){var b=arguments.length;if(b<2){return 0}var a=goog.math.average.apply(null,arguments);var c=goog.math.sum.apply(null,goog.array.map(arguments,function(e){return Math.pow(e-a,2)}))/(b-1);return c};goog.math.standardDeviation=function(a){return Math.sqrt(goog.math.sampleVariance.apply(null,arguments))};goog.math.isInt=function(a){return isFinite(a)&&a%1==0};goog.math.isFiniteNumber=function(a){return isFinite(a)&&!isNaN(a)};goog.math.log10Floor=function(b){if(b>0){var a=Math.round(Math.log(b)*Math.LOG10E);return a-(parseFloat("1e"+a)>b)}return b==0?-Infinity:NaN};goog.math.safeFloor=function(b,a){goog.asserts.assert(!goog.isDef(a)||a>0);return Math.floor(b+(a||2e-15))};goog.math.safeCeil=function(b,a){goog.asserts.assert(!goog.isDef(a)||a>0);return Math.ceil(b-(a||2e-15))};goog.provide("goog.math.Coordinate");goog.require("goog.math");goog.math.Coordinate=function(b,a){this.x=goog.isDef(b)?b:0;this.y=goog.isDef(a)?a:0};goog.math.Coordinate.prototype.clone=function(){return new goog.math.Coordinate(this.x,this.y)};if(goog.DEBUG){goog.math.Coordinate.prototype.toString=function(){return"("+this.x+", "+this.y+")"}}goog.math.Coordinate.equals=function(d,c){if(d==c){return true}if(!d||!c){return false}return d.x==c.x&&d.y==c.y};goog.math.Coordinate.distance=function(e,c){var f=e.x-c.x;var d=e.y-c.y;return Math.sqrt(f*f+d*d)};goog.math.Coordinate.magnitude=function(b){return Math.sqrt(b.x*b.x+b.y*b.y)};goog.math.Coordinate.azimuth=function(b){return goog.math.angle(0,0,b.x,b.y)};goog.math.Coordinate.squaredDistance=function(e,c){var f=e.x-c.x;var d=e.y-c.y;return f*f+d*d};goog.math.Coordinate.difference=function(d,c){return new goog.math.Coordinate(d.x-c.x,d.y-c.y)};goog.math.Coordinate.sum=function(d,c){return new goog.math.Coordinate(d.x+c.x,d.y+c.y)};goog.math.Coordinate.prototype.ceil=function(){this.x=Math.ceil(this.x);this.y=Math.ceil(this.y);return this};goog.math.Coordinate.prototype.floor=function(){this.x=Math.floor(this.x);this.y=Math.floor(this.y);return this};goog.math.Coordinate.prototype.round=function(){this.x=Math.round(this.x);this.y=Math.round(this.y);return this};goog.math.Coordinate.prototype.translate=function(b,a){if(b instanceof goog.math.Coordinate){this.x+=b.x;this.y+=b.y}else{this.x+=b;if(goog.isNumber(a)){this.y+=a}}return this};goog.math.Coordinate.prototype.scale=function(c,b){var a=goog.isNumber(b)?b:c;this.x*=c;this.y*=a;return this};goog.math.Coordinate.prototype.rotateRadians=function(f,e){var b=e||new goog.math.Coordinate(0,0);var a=this.x;var g=this.y;var d=Math.cos(f);var c=Math.sin(f);this.x=(a-b.x)*d-(g-b.y)*c+b.x;this.y=(a-b.x)*c+(g-b.y)*d+b.y};goog.math.Coordinate.prototype.rotateDegrees=function(b,a){this.rotateRadians(goog.math.toRadians(b),a)};goog.provide("goog.dom");goog.provide("goog.dom.Appendable");goog.provide("goog.dom.DomHelper");goog.require("goog.array");goog.require("goog.asserts");goog.require("goog.dom.BrowserFeature");goog.require("goog.dom.NodeType");goog.require("goog.dom.TagName");goog.require("goog.dom.safe");goog.require("goog.html.SafeHtml");goog.require("goog.math.Coordinate");goog.require("goog.math.Size");goog.require("goog.object");goog.require("goog.string");goog.require("goog.string.Unicode");goog.require("goog.userAgent");goog.define("goog.dom.ASSUME_QUIRKS_MODE",false);goog.define("goog.dom.ASSUME_STANDARDS_MODE",false);goog.dom.COMPAT_MODE_KNOWN_=goog.dom.ASSUME_QUIRKS_MODE||goog.dom.ASSUME_STANDARDS_MODE;goog.dom.getDomHelper=function(a){return a?new goog.dom.DomHelper(goog.dom.getOwnerDocument(a)):(goog.dom.defaultDomHelper_||(goog.dom.defaultDomHelper_=new goog.dom.DomHelper()))};goog.dom.defaultDomHelper_;goog.dom.getDocument=function(){return document};goog.dom.getElement=function(a){return goog.dom.getElementHelper_(document,a)};goog.dom.getElementHelper_=function(b,a){return goog.isString(a)?b.getElementById(a):a};goog.dom.getRequiredElement=function(a){return goog.dom.getRequiredElementHelper_(document,a)};goog.dom.getRequiredElementHelper_=function(b,c){goog.asserts.assertString(c);var a=goog.dom.getElementHelper_(b,c);a=goog.asserts.assertElement(a,"No element found with id: "+c);return a};goog.dom.$=goog.dom.getElement;goog.dom.getElementsByTagNameAndClass=function(c,a,b){return goog.dom.getElementsByTagNameAndClass_(document,c,a,b)};goog.dom.getElementsByClass=function(c,b){var a=b||document;if(goog.dom.canUseQuerySelector_(a)){return a.querySelectorAll("."+c)}return goog.dom.getElementsByTagNameAndClass_(document,"*",c,b)};goog.dom.getElementByClass=function(c,b){var a=b||document;var d=null;if(a.getElementsByClassName){d=a.getElementsByClassName(c)[0]}else{if(goog.dom.canUseQuerySelector_(a)){d=a.querySelector("."+c)}else{d=goog.dom.getElementsByTagNameAndClass_(document,"*",c,b)[0]}}return d||null};goog.dom.getRequiredElementByClass=function(b,a){var c=goog.dom.getElementByClass(b,a);return goog.asserts.assert(c,"No element found with className: "+b)};goog.dom.canUseQuerySelector_=function(a){return !!(a.querySelectorAll&&a.querySelector)};goog.dom.getElementsByTagNameAndClass_=function(k,j,c,m){var l=m||k;var b=(j&&j!="*")?j.toUpperCase():"";if(goog.dom.canUseQuerySelector_(l)&&(b||c)){var h=b+(c?"."+c:"");return l.querySelectorAll(h)}if(c&&l.getElementsByClassName){var d=l.getElementsByClassName(c);if(b){var n={};var f=0;for(var e=0,a;a=d[e];e++){if(b==a.nodeName){n[f++]=a}}n.length=f;return n}else{return d}}var d=l.getElementsByTagName(b||"*");if(c){var n={};var f=0;for(var e=0,a;a=d[e];e++){var g=a.className;if(typeof g.split=="function"&&goog.array.contains(g.split(/\s+/),c)){n[f++]=a}}n.length=f;return n}else{return d}};goog.dom.$$=goog.dom.getElementsByTagNameAndClass;goog.dom.setProperties=function(b,a){goog.object.forEach(a,function(d,c){if(c=="style"){b.style.cssText=d}else{if(c=="class"){b.className=d}else{if(c=="for"){b.htmlFor=d}else{if(c in goog.dom.DIRECT_ATTRIBUTE_MAP_){b.setAttribute(goog.dom.DIRECT_ATTRIBUTE_MAP_[c],d)}else{if(goog.string.startsWith(c,"aria-")||goog.string.startsWith(c,"data-")){b.setAttribute(c,d)}else{b[c]=d}}}}}})};goog.dom.DIRECT_ATTRIBUTE_MAP_={cellpadding:"cellPadding",cellspacing:"cellSpacing",colspan:"colSpan",frameborder:"frameBorder",height:"height",maxlength:"maxLength",role:"role",rowspan:"rowSpan",type:"type",usemap:"useMap",valign:"vAlign",width:"width"};goog.dom.getViewportSize=function(a){return goog.dom.getViewportSize_(a||window)};goog.dom.getViewportSize_=function(c){var b=c.document;var a=goog.dom.isCss1CompatMode_(b)?b.documentElement:b.body;return new goog.math.Size(a.clientWidth,a.clientHeight)};goog.dom.getDocumentHeight=function(){return goog.dom.getDocumentHeight_(window)};goog.dom.getDocumentHeight_=function(f){var e=f.document;var b=0;if(e){var a=e.body;var h=e.documentElement;if(!(h&&a)){return 0}var g=goog.dom.getViewportSize_(f).height;if(goog.dom.isCss1CompatMode_(e)&&h.scrollHeight){b=h.scrollHeight!=g?h.scrollHeight:h.offsetHeight}else{var c=h.scrollHeight;var d=h.offsetHeight;if(h.clientHeight!=d){c=a.scrollHeight;d=a.offsetHeight}if(c>g){b=c>d?c:d}else{b=c<d?c:d}}}return b};goog.dom.getPageScroll=function(a){var b=a||goog.global||window;return goog.dom.getDomHelper(b.document).getDocumentScroll()};goog.dom.getDocumentScroll=function(){return goog.dom.getDocumentScroll_(document)};goog.dom.getDocumentScroll_=function(c){var a=goog.dom.getDocumentScrollElement_(c);var b=goog.dom.getWindow_(c);if(goog.userAgent.IE&&goog.userAgent.isVersionOrHigher("10")&&b.pageYOffset!=a.scrollTop){return new goog.math.Coordinate(a.scrollLeft,a.scrollTop)}return new goog.math.Coordinate(b.pageXOffset||a.scrollLeft,b.pageYOffset||a.scrollTop)};goog.dom.getDocumentScrollElement=function(){return goog.dom.getDocumentScrollElement_(document)};goog.dom.getDocumentScrollElement_=function(a){if(!goog.userAgent.WEBKIT&&goog.dom.isCss1CompatMode_(a)){return a.documentElement}return a.body||a.documentElement};goog.dom.getWindow=function(a){return a?goog.dom.getWindow_(a):window};goog.dom.getWindow_=function(a){return a.parentWindow||a.defaultView};goog.dom.createDom=function(b,a,c){return goog.dom.createDom_(document,arguments)};goog.dom.createDom_=function(e,b){var d=b[0];var a=b[1];if(!goog.dom.BrowserFeature.CAN_ADD_NAME_OR_TYPE_ATTRIBUTES&&a&&(a.name||a.type)){var g=["<",d];if(a.name){g.push(' name="',goog.string.htmlEscape(a.name),'"')}if(a.type){g.push(' type="',goog.string.htmlEscape(a.type),'"');var f={};goog.object.extend(f,a);delete f.type;a=f}g.push(">");d=g.join("")}var c=e.createElement(d);if(a){if(goog.isString(a)){c.className=a}else{if(goog.isArray(a)){c.className=a.join(" ")}else{goog.dom.setProperties(c,a)}}}if(b.length>2){goog.dom.append_(e,c,b,2)}return c};goog.dom.append_=function(f,e,b,g){function d(h){if(h){e.appendChild(goog.isString(h)?f.createTextNode(h):h)}}for(var c=g;c<b.length;c++){var a=b[c];if(goog.isArrayLike(a)&&!goog.dom.isNodeLike(a)){goog.array.forEach(goog.dom.isNodeList(a)?goog.array.toArray(a):a,d)}else{d(a)}}};goog.dom.$dom=goog.dom.createDom;goog.dom.createElement=function(a){return document.createElement(a)};goog.dom.createTextNode=function(a){return document.createTextNode(String(a))};goog.dom.createTable=function(c,b,a){return goog.dom.createTable_(document,c,b,!!a)};goog.dom.createTable_=function(g,k,b,l){var h=(g.createElement(goog.dom.TagName.TABLE));var e=h.appendChild(g.createElement(goog.dom.TagName.TBODY));for(var d=0;d<k;d++){var f=g.createElement(goog.dom.TagName.TR);for(var c=0;c<b;c++){var a=g.createElement(goog.dom.TagName.TD);if(l){goog.dom.setTextContent(a,goog.string.Unicode.NBSP)}f.appendChild(a)}e.appendChild(f)}return h};goog.dom.safeHtmlToNode=function(a){return goog.dom.safeHtmlToNode_(document,a)};goog.dom.safeHtmlToNode_=function(c,b){var a=c.createElement("div");if(goog.dom.BrowserFeature.INNER_HTML_NEEDS_SCOPED_ELEMENT){goog.dom.safe.setInnerHtml(a,goog.html.SafeHtml.concat(goog.html.SafeHtml.create("br"),b));a.removeChild(a.firstChild)}else{goog.dom.safe.setInnerHtml(a,b)}return goog.dom.childrenToNode_(c,a)};goog.dom.htmlToDocumentFragment=function(a){return goog.dom.htmlToDocumentFragment_(document,a)};goog.dom.htmlToDocumentFragment_=function(c,b){var a=c.createElement("div");if(goog.dom.BrowserFeature.INNER_HTML_NEEDS_SCOPED_ELEMENT){a.innerHTML="<br>"+b;a.removeChild(a.firstChild)}else{a.innerHTML=b}return goog.dom.childrenToNode_(c,a)};goog.dom.childrenToNode_=function(c,b){if(b.childNodes.length==1){return b.removeChild(b.firstChild)}else{var a=c.createDocumentFragment();while(b.firstChild){a.appendChild(b.firstChild)}return a}};goog.dom.isCss1CompatMode=function(){return goog.dom.isCss1CompatMode_(document)};goog.dom.isCss1CompatMode_=function(a){if(goog.dom.COMPAT_MODE_KNOWN_){return goog.dom.ASSUME_STANDARDS_MODE}return a.compatMode=="CSS1Compat"};goog.dom.canHaveChildren=function(a){if(a.nodeType!=goog.dom.NodeType.ELEMENT){return false}switch(a.tagName){case goog.dom.TagName.APPLET:case goog.dom.TagName.AREA:case goog.dom.TagName.BASE:case goog.dom.TagName.BR:case goog.dom.TagName.COL:case goog.dom.TagName.COMMAND:case goog.dom.TagName.EMBED:case goog.dom.TagName.FRAME:case goog.dom.TagName.HR:case goog.dom.TagName.IMG:case goog.dom.TagName.INPUT:case goog.dom.TagName.IFRAME:case goog.dom.TagName.ISINDEX:case goog.dom.TagName.KEYGEN:case goog.dom.TagName.LINK:case goog.dom.TagName.NOFRAMES:case goog.dom.TagName.NOSCRIPT:case goog.dom.TagName.META:case goog.dom.TagName.OBJECT:case goog.dom.TagName.PARAM:case goog.dom.TagName.SCRIPT:case goog.dom.TagName.SOURCE:case goog.dom.TagName.STYLE:case goog.dom.TagName.TRACK:case goog.dom.TagName.WBR:return false}return true};goog.dom.appendChild=function(a,b){a.appendChild(b)};goog.dom.append=function(a,b){goog.dom.append_(goog.dom.getOwnerDocument(a),a,arguments,1)};goog.dom.removeChildren=function(a){var b;while((b=a.firstChild)){a.removeChild(b)}};goog.dom.insertSiblingBefore=function(b,a){if(a.parentNode){a.parentNode.insertBefore(b,a)}};goog.dom.insertSiblingAfter=function(b,a){if(a.parentNode){a.parentNode.insertBefore(b,a.nextSibling)}};goog.dom.insertChildAt=function(b,c,a){b.insertBefore(c,b.childNodes[a]||null)};goog.dom.removeNode=function(a){return a&&a.parentNode?a.parentNode.removeChild(a):null};goog.dom.replaceNode=function(a,c){var b=c.parentNode;if(b){b.replaceChild(a,c)}};goog.dom.flattenElement=function(a){var c,b=a.parentNode;if(b&&b.nodeType!=goog.dom.NodeType.DOCUMENT_FRAGMENT){if(a.removeNode){return(a.removeNode(false))}else{while((c=a.firstChild)){b.insertBefore(c,a)}return(goog.dom.removeNode(a))}}};goog.dom.getChildren=function(a){if(goog.dom.BrowserFeature.CAN_USE_CHILDREN_ATTRIBUTE&&a.children!=undefined){return a.children}return goog.array.filter(a.childNodes,function(b){return b.nodeType==goog.dom.NodeType.ELEMENT})};goog.dom.getFirstElementChild=function(a){if(a.firstElementChild!=undefined){return(a).firstElementChild}return goog.dom.getNextElementNode_(a.firstChild,true)};goog.dom.getLastElementChild=function(a){if(a.lastElementChild!=undefined){return(a).lastElementChild}return goog.dom.getNextElementNode_(a.lastChild,false)};goog.dom.getNextElementSibling=function(a){if(a.nextElementSibling!=undefined){return(a).nextElementSibling}return goog.dom.getNextElementNode_(a.nextSibling,true)};goog.dom.getPreviousElementSibling=function(a){if(a.previousElementSibling!=undefined){return(a).previousElementSibling}return goog.dom.getNextElementNode_(a.previousSibling,false)};goog.dom.getNextElementNode_=function(b,a){while(b&&b.nodeType!=goog.dom.NodeType.ELEMENT){b=a?b.nextSibling:b.previousSibling}return(b)};goog.dom.getNextNode=function(a){if(!a){return null}if(a.firstChild){return a.firstChild}while(a&&!a.nextSibling){a=a.parentNode}return a?a.nextSibling:null};goog.dom.getPreviousNode=function(a){if(!a){return null}if(!a.previousSibling){return a.parentNode}a=a.previousSibling;while(a&&a.lastChild){a=a.lastChild}return a};goog.dom.isNodeLike=function(a){return goog.isObject(a)&&a.nodeType>0};goog.dom.isElement=function(a){return goog.isObject(a)&&a.nodeType==goog.dom.NodeType.ELEMENT};goog.dom.isWindow=function(a){return goog.isObject(a)&&a.window==a};goog.dom.getParentElement=function(a){var c;if(goog.dom.BrowserFeature.CAN_USE_PARENT_ELEMENT_PROPERTY){var b=goog.userAgent.IE&&goog.userAgent.isVersionOrHigher("9")&&!goog.userAgent.isVersionOrHigher("10");if(!(b&&goog.global.SVGElement&&a instanceof goog.global.SVGElement)){c=a.parentElement;if(c){return c}}}c=a.parentNode;return goog.dom.isElement(c)?(c):null};goog.dom.contains=function(b,a){if(b.contains&&a.nodeType==goog.dom.NodeType.ELEMENT){return b==a||b.contains(a)}if(typeof b.compareDocumentPosition!="undefined"){return b==a||Boolean(b.compareDocumentPosition(a)&16)}while(a&&b!=a){a=a.parentNode}return a==b};goog.dom.compareNodeOrder=function(h,g){if(h==g){return 0}if(h.compareDocumentPosition){return h.compareDocumentPosition(g)&2?1:-1}if(goog.userAgent.IE&&!goog.userAgent.isDocumentModeOrHigher(9)){if(h.nodeType==goog.dom.NodeType.DOCUMENT){return -1}if(g.nodeType==goog.dom.NodeType.DOCUMENT){return 1}}if("sourceIndex" in h||(h.parentNode&&"sourceIndex" in h.parentNode)){var c=h.nodeType==goog.dom.NodeType.ELEMENT;var a=g.nodeType==goog.dom.NodeType.ELEMENT;if(c&&a){return h.sourceIndex-g.sourceIndex}else{var d=h.parentNode;var b=g.parentNode;if(d==b){return goog.dom.compareSiblingOrder_(h,g)}if(!c&&goog.dom.contains(d,g)){return -1*goog.dom.compareParentsDescendantNodeIe_(h,g)}if(!a&&goog.dom.contains(b,h)){return goog.dom.compareParentsDescendantNodeIe_(g,h)}return(c?h.sourceIndex:d.sourceIndex)-(a?g.sourceIndex:b.sourceIndex)}}var e=goog.dom.getOwnerDocument(h);var i,f;i=e.createRange();i.selectNode(h);i.collapse(true);f=e.createRange();f.selectNode(g);f.collapse(true);return i.compareBoundaryPoints(goog.global.Range.START_TO_END,f)};goog.dom.compareParentsDescendantNodeIe_=function(d,c){var b=d.parentNode;if(b==c){return -1}var a=c;while(a.parentNode!=b){a=a.parentNode}return goog.dom.compareSiblingOrder_(a,d)};goog.dom.compareSiblingOrder_=function(b,a){var c=a;while((c=c.previousSibling)){if(c==b){return -1}}return 1};goog.dom.findCommonAncestor=function(h){var e,g=arguments.length;if(!g){return null}else{if(g==1){return arguments[0]}}var k=[];var a=Infinity;for(e=0;e<g;e++){var l=[];var c=arguments[e];while(c){l.unshift(c);c=c.parentNode}k.push(l);a=Math.min(a,l.length)}var b=null;for(e=0;e<a;e++){var f=k[0][e];for(var d=1;d<g;d++){if(f!=k[d][e]){return b}}b=f}return b};goog.dom.getOwnerDocument=function(a){goog.asserts.assert(a,"Node cannot be null or undefined.");return(a.nodeType==goog.dom.NodeType.DOCUMENT?a:a.ownerDocument||a.document)};goog.dom.getFrameContentDocument=function(b){var a=b.contentDocument||b.contentWindow.document;return a};goog.dom.getFrameContentWindow=function(a){return a.contentWindow||goog.dom.getWindow(goog.dom.getFrameContentDocument(a))};goog.dom.setTextContent=function(a,c){goog.asserts.assert(a!=null,"goog.dom.setTextContent expects a non-null value for node");if("textContent" in a){a.textContent=c}else{if(a.nodeType==goog.dom.NodeType.TEXT){a.data=c}else{if(a.firstChild&&a.firstChild.nodeType==goog.dom.NodeType.TEXT){while(a.lastChild!=a.firstChild){a.removeChild(a.lastChild)}a.firstChild.data=c}else{goog.dom.removeChildren(a);var b=goog.dom.getOwnerDocument(a);a.appendChild(b.createTextNode(String(c)))}}}};goog.dom.getOuterHtml=function(a){if("outerHTML" in a){return a.outerHTML}else{var b=goog.dom.getOwnerDocument(a);var c=b.createElement("div");c.appendChild(a.cloneNode(true));return c.innerHTML}};goog.dom.findNode=function(a,c){var d=[];var b=goog.dom.findNodes_(a,c,d,true);return b?d[0]:undefined};goog.dom.findNodes=function(a,b){var c=[];goog.dom.findNodes_(a,b,c,false);return c};goog.dom.findNodes_=function(a,c,e,b){if(a!=null){var d=a.firstChild;while(d){if(c(d)){e.push(d);if(b){return true}}if(goog.dom.findNodes_(d,c,e,b)){return true}d=d.nextSibling}}return false};goog.dom.TAGS_TO_IGNORE_={SCRIPT:1,STYLE:1,HEAD:1,IFRAME:1,OBJECT:1};goog.dom.PREDEFINED_TAG_VALUES_={IMG:" ",BR:"\n"};goog.dom.isFocusableTabIndex=function(a){return goog.dom.hasSpecifiedTabIndex_(a)&&goog.dom.isTabIndexFocusable_(a)};goog.dom.setFocusableTabIndex=function(b,a){if(a){b.tabIndex=0}else{b.tabIndex=-1;b.removeAttribute("tabIndex")}};goog.dom.isFocusable=function(a){var b;if(goog.dom.nativelySupportsFocus_(a)){b=!a.disabled&&(!goog.dom.hasSpecifiedTabIndex_(a)||goog.dom.isTabIndexFocusable_(a))}else{b=goog.dom.isFocusableTabIndex(a)}return b&&goog.userAgent.IE?goog.dom.hasNonZeroBoundingRect_(a):b};goog.dom.hasSpecifiedTabIndex_=function(a){var b=a.getAttributeNode("tabindex");return goog.isDefAndNotNull(b)&&b.specified};goog.dom.isTabIndexFocusable_=function(b){var a=b.tabIndex;return goog.isNumber(a)&&a>=0&&a<32768};goog.dom.nativelySupportsFocus_=function(a){return a.tagName==goog.dom.TagName.A||a.tagName==goog.dom.TagName.INPUT||a.tagName==goog.dom.TagName.TEXTAREA||a.tagName==goog.dom.TagName.SELECT||a.tagName==goog.dom.TagName.BUTTON};goog.dom.hasNonZeroBoundingRect_=function(a){var b=goog.isFunction(a.getBoundingClientRect)?a.getBoundingClientRect():{height:a.offsetHeight,width:a.offsetWidth};return goog.isDefAndNotNull(b)&&b.height>0&&b.width>0};goog.dom.getTextContent=function(c){var b;if(goog.dom.BrowserFeature.CAN_USE_INNER_TEXT&&("innerText" in c)){b=goog.string.canonicalizeNewlines(c.innerText)}else{var a=[];goog.dom.getTextContent_(c,a,true);b=a.join("")}b=b.replace(/ \xAD /g," ").replace(/\xAD/g,"");b=b.replace(/\u200B/g,"");if(!goog.dom.BrowserFeature.CAN_USE_INNER_TEXT){b=b.replace(/ +/g," ")}if(b!=" "){b=b.replace(/^\s*/,"")}return b};goog.dom.getRawTextContent=function(b){var a=[];goog.dom.getTextContent_(b,a,false);return a.join("")};goog.dom.getTextContent_=function(c,b,a){if(c.nodeName in goog.dom.TAGS_TO_IGNORE_){}else{if(c.nodeType==goog.dom.NodeType.TEXT){if(a){b.push(String(c.nodeValue).replace(/(\r\n|\r|\n)/g,""))}else{b.push(c.nodeValue)}}else{if(c.nodeName in goog.dom.PREDEFINED_TAG_VALUES_){b.push(goog.dom.PREDEFINED_TAG_VALUES_[c.nodeName])}else{var d=c.firstChild;while(d){goog.dom.getTextContent_(d,b,a);d=d.nextSibling}}}}};goog.dom.getNodeTextLength=function(a){return goog.dom.getTextContent(a).length};goog.dom.getNodeTextOffset=function(d,b){var a=b||goog.dom.getOwnerDocument(d).body;var c=[];while(d&&d!=a){var e=d;while((e=e.previousSibling)){c.unshift(goog.dom.getTextContent(e))}d=d.parentNode}return goog.string.trimLeft(c.join("")).replace(/ +/g," ").length};goog.dom.getNodeAtOffset=function(c,g,d){var a=[c],h=0,f=null;while(a.length>0&&h<g){f=a.pop();if(f.nodeName in goog.dom.TAGS_TO_IGNORE_){}else{if(f.nodeType==goog.dom.NodeType.TEXT){var e=f.nodeValue.replace(/(\r\n|\r|\n)/g,"").replace(/ +/g," ");h+=e.length}else{if(f.nodeName in goog.dom.PREDEFINED_TAG_VALUES_){h+=goog.dom.PREDEFINED_TAG_VALUES_[f.nodeName].length}else{for(var b=f.childNodes.length-1;b>=0;b--){a.push(f.childNodes[b])}}}}}if(goog.isObject(d)){d.remainder=f?f.nodeValue.length+g-h-1:0;d.node=f}return f};goog.dom.isNodeList=function(a){if(a&&typeof a.length=="number"){if(goog.isObject(a)){return typeof a.item=="function"||typeof a.item=="string"}else{if(goog.isFunction(a)){return typeof a.item=="function"}}}return false};goog.dom.getAncestorByTagNameAndClass=function(c,e,a,d){if(!e&&!a){return null}var b=e?e.toUpperCase():null;return(goog.dom.getAncestor(c,function(f){return(!b||f.nodeName==b)&&(!a||goog.isString(f.className)&&goog.array.contains(f.className.split(/\s+/),a))},true,d))};goog.dom.getAncestorByClass=function(a,b,c){return goog.dom.getAncestorByTagNameAndClass(a,null,b,c)};goog.dom.getAncestor=function(c,e,a,d){if(!a){c=c.parentNode}var f=d==null;var b=0;while(c&&(f||b<=d)){if(e(c)){return c}c=c.parentNode;b++}return null};goog.dom.getActiveElement=function(b){try{return b&&b.activeElement}catch(a){}return null};goog.dom.getPixelRatio=function(){var b=goog.dom.getWindow();var a=goog.userAgent.GECKO&&goog.userAgent.MOBILE;if(goog.isDef(b.devicePixelRatio)&&!a){return b.devicePixelRatio}else{if(b.matchMedia){return goog.dom.matchesPixelRatio_(0.75)||goog.dom.matchesPixelRatio_(1.5)||goog.dom.matchesPixelRatio_(2)||goog.dom.matchesPixelRatio_(3)||1}}return 1};goog.dom.matchesPixelRatio_=function(c){var b=goog.dom.getWindow();var a=("(-webkit-min-device-pixel-ratio: "+c+"),(min--moz-device-pixel-ratio: "+c+"),(min-resolution: "+c+"dppx)");return b.matchMedia(a).matches?c:0};goog.dom.DomHelper=function(a){this.document_=a||goog.global.document||document};goog.dom.DomHelper.prototype.getDomHelper=goog.dom.getDomHelper;goog.dom.DomHelper.prototype.setDocument=function(a){this.document_=a};goog.dom.DomHelper.prototype.getDocument=function(){return this.document_};goog.dom.DomHelper.prototype.getElement=function(a){return goog.dom.getElementHelper_(this.document_,a)};goog.dom.DomHelper.prototype.getRequiredElement=function(a){return goog.dom.getRequiredElementHelper_(this.document_,a)};goog.dom.DomHelper.prototype.$=goog.dom.DomHelper.prototype.getElement;goog.dom.DomHelper.prototype.getElementsByTagNameAndClass=function(c,a,b){return goog.dom.getElementsByTagNameAndClass_(this.document_,c,a,b)};goog.dom.DomHelper.prototype.getElementsByClass=function(b,a){var c=a||this.document_;return goog.dom.getElementsByClass(b,c)};goog.dom.DomHelper.prototype.getElementByClass=function(b,a){var c=a||this.document_;return goog.dom.getElementByClass(b,c)};goog.dom.DomHelper.prototype.getRequiredElementByClass=function(c,b){var a=b||this.document_;return goog.dom.getRequiredElementByClass(c,a)};goog.dom.DomHelper.prototype.$$=goog.dom.DomHelper.prototype.getElementsByTagNameAndClass;goog.dom.DomHelper.prototype.setProperties=goog.dom.setProperties;goog.dom.DomHelper.prototype.getViewportSize=function(a){return goog.dom.getViewportSize(a||this.getWindow())};goog.dom.DomHelper.prototype.getDocumentHeight=function(){return goog.dom.getDocumentHeight_(this.getWindow())};goog.dom.Appendable;goog.dom.DomHelper.prototype.createDom=function(b,a,c){return goog.dom.createDom_(this.document_,arguments)};goog.dom.DomHelper.prototype.$dom=goog.dom.DomHelper.prototype.createDom;goog.dom.DomHelper.prototype.createElement=function(a){return this.document_.createElement(a)};goog.dom.DomHelper.prototype.createTextNode=function(a){return this.document_.createTextNode(String(a))};goog.dom.DomHelper.prototype.createTable=function(c,b,a){return goog.dom.createTable_(this.document_,c,b,!!a)};goog.dom.DomHelper.prototype.safeHtmlToNode=function(a){return goog.dom.safeHtmlToNode_(this.document_,a)};goog.dom.DomHelper.prototype.htmlToDocumentFragment=function(a){return goog.dom.htmlToDocumentFragment_(this.document_,a)};goog.dom.DomHelper.prototype.isCss1CompatMode=function(){return goog.dom.isCss1CompatMode_(this.document_)};goog.dom.DomHelper.prototype.getWindow=function(){return goog.dom.getWindow_(this.document_)};goog.dom.DomHelper.prototype.getDocumentScrollElement=function(){return goog.dom.getDocumentScrollElement_(this.document_)};goog.dom.DomHelper.prototype.getDocumentScroll=function(){return goog.dom.getDocumentScroll_(this.document_)};goog.dom.DomHelper.prototype.getActiveElement=function(a){return goog.dom.getActiveElement(a||this.document_)};goog.dom.DomHelper.prototype.appendChild=goog.dom.appendChild;goog.dom.DomHelper.prototype.append=goog.dom.append;goog.dom.DomHelper.prototype.canHaveChildren=goog.dom.canHaveChildren;goog.dom.DomHelper.prototype.removeChildren=goog.dom.removeChildren;goog.dom.DomHelper.prototype.insertSiblingBefore=goog.dom.insertSiblingBefore;goog.dom.DomHelper.prototype.insertSiblingAfter=goog.dom.insertSiblingAfter;goog.dom.DomHelper.prototype.insertChildAt=goog.dom.insertChildAt;goog.dom.DomHelper.prototype.removeNode=goog.dom.removeNode;goog.dom.DomHelper.prototype.replaceNode=goog.dom.replaceNode;goog.dom.DomHelper.prototype.flattenElement=goog.dom.flattenElement;goog.dom.DomHelper.prototype.getChildren=goog.dom.getChildren;goog.dom.DomHelper.prototype.getFirstElementChild=goog.dom.getFirstElementChild;goog.dom.DomHelper.prototype.getLastElementChild=goog.dom.getLastElementChild;goog.dom.DomHelper.prototype.getNextElementSibling=goog.dom.getNextElementSibling;goog.dom.DomHelper.prototype.getPreviousElementSibling=goog.dom.getPreviousElementSibling;goog.dom.DomHelper.prototype.getNextNode=goog.dom.getNextNode;goog.dom.DomHelper.prototype.getPreviousNode=goog.dom.getPreviousNode;goog.dom.DomHelper.prototype.isNodeLike=goog.dom.isNodeLike;goog.dom.DomHelper.prototype.isElement=goog.dom.isElement;goog.dom.DomHelper.prototype.isWindow=goog.dom.isWindow;goog.dom.DomHelper.prototype.getParentElement=goog.dom.getParentElement;goog.dom.DomHelper.prototype.contains=goog.dom.contains;goog.dom.DomHelper.prototype.compareNodeOrder=goog.dom.compareNodeOrder;goog.dom.DomHelper.prototype.findCommonAncestor=goog.dom.findCommonAncestor;goog.dom.DomHelper.prototype.getOwnerDocument=goog.dom.getOwnerDocument;goog.dom.DomHelper.prototype.getFrameContentDocument=goog.dom.getFrameContentDocument;goog.dom.DomHelper.prototype.getFrameContentWindow=goog.dom.getFrameContentWindow;goog.dom.DomHelper.prototype.setTextContent=goog.dom.setTextContent;goog.dom.DomHelper.prototype.getOuterHtml=goog.dom.getOuterHtml;goog.dom.DomHelper.prototype.findNode=goog.dom.findNode;goog.dom.DomHelper.prototype.findNodes=goog.dom.findNodes;goog.dom.DomHelper.prototype.isFocusableTabIndex=goog.dom.isFocusableTabIndex;goog.dom.DomHelper.prototype.setFocusableTabIndex=goog.dom.setFocusableTabIndex;goog.dom.DomHelper.prototype.isFocusable=goog.dom.isFocusable;goog.dom.DomHelper.prototype.getTextContent=goog.dom.getTextContent;goog.dom.DomHelper.prototype.getNodeTextLength=goog.dom.getNodeTextLength;goog.dom.DomHelper.prototype.getNodeTextOffset=goog.dom.getNodeTextOffset;goog.dom.DomHelper.prototype.getNodeAtOffset=goog.dom.getNodeAtOffset;goog.dom.DomHelper.prototype.isNodeList=goog.dom.isNodeList;goog.dom.DomHelper.prototype.getAncestorByTagNameAndClass=goog.dom.getAncestorByTagNameAndClass;goog.dom.DomHelper.prototype.getAncestorByClass=goog.dom.getAncestorByClass;goog.dom.DomHelper.prototype.getAncestor=goog.dom.getAncestor;goog.provide("au.upldr.support");goog.require("goog.dom");au.upldr.support.isThumbnailCreationSupported=function(){if(!au.upldr.support.isBlobUrlSupported()){return false}var b=false;if(!b){var a=(goog.dom.createElement("canvas"));b=a.mozGetAsFile}if(!b){b=window.atob&&(window.Blob||window.BlobBuilder||window.WebKitBlobBuilder||window.MozBlobBuilder||window.MSBlobBuilder)}return !!b};au.upldr.support.isBlobUrlSupported=function(){var a=goog.global.URL||goog.global.webkitURL;a=a&&a.createObjectURL;return !!a};au.upldr.support.isImageRestrictionsSupported=function(){return au.upldr.support.isBlobUrlSupported()};au.upldr.support.isHtmlUploaderSupported=function(){return("FormData" in goog.global)&&("File" in goog.global)&&("files" in goog.dom.createElement("input")&&("FileReader" in goog.global))};goog.exportSymbol("Aurigma.ImageUploaderFlash.Control.isHtmlUploaderSupported",au.upldr.support.isHtmlUploaderSupported);goog.exportSymbol("Aurigma.ImageUploaderFlash.Control.isThumbnailCreationSupported",au.upldr.support.isThumbnailCreationSupported);goog.exportSymbol("Aurigma.ImageUploaderFlash.Control.isImageRestrictionsSupported",au.upldr.support.isImageRestrictionsSupported);goog.provide("au.upldr.image.ImageLoader");goog.require("goog.events.EventHandler");goog.require("goog.events.EventType");goog.require("goog.events.EventTarget");goog.require("goog.fs");goog.require("goog.asserts");goog.require("goog.events");goog.require("goog.async.Deferred");goog.require("au.upldr.support");au.upldr.image.ImageLoader={isProcessing_:false,isQueued_:goog.userAgent.GECKO,image_:new Image(),curItem_:null,queue_:[],reset:function(){au.upldr.image.ImageLoader.isProcessing_=false;au.upldr.image.ImageLoader.queue_=[];au.upldr.image.ImageLoader.curItem_=null;au.upldr.image.ImageLoader.image_.onload=null;au.upldr.image.ImageLoader.image_.onerror=null;au.upldr.image.ImageLoader.image_.onabort=null;au.upldr.image.ImageLoader.image_.src="data:image/gif;base64,R0lGODlhAQABAIAAAAUEBAAAACwAAAAAAQABAAACAkQBADs="},loadDeferred:function(b){var a=new goog.async.Deferred();if(!b){a.callback(null)}var c=({file:b,result:a});if(au.upldr.image.ImageLoader.isProcessing_&&au.upldr.image.ImageLoader.isQueued_){au.upldr.image.ImageLoader.queue_.push(c)}else{au.upldr.image.ImageLoader.loadDeferred_(c)}return a},processNext:function(){if(au.upldr.image.ImageLoader.isQueued_&&!au.upldr.image.ImageLoader.isProcessing_){var a=au.upldr.image.ImageLoader.queue_.shift();if(a){au.upldr.image.ImageLoader.curItem_=a;au.upldr.image.ImageLoader.loadDeferred_(a)}}},loadDeferred_:function(a){if(!a){return}var c=au.upldr.image.ImageLoader.isQueued_?au.upldr.image.ImageLoader.image_:new Image();if(au.upldr.image.ImageLoader.isQueued_){au.upldr.image.ImageLoader.isProcessing_=true}if(a.file&&au.upldr.support.isBlobUrlSupported()){var b=function(d){if(d){goog.fs.revokeObjectUrl(c.src);d.onload=d.onerror=d.onabort=null}a.result.callback(d);au.upldr.image.ImageLoader.isProcessing_=false;au.upldr.image.ImageLoader.processNext()};c.onload=b.bind(au.upldr.image.ImageLoader,c);c.onerror=c.onabort=function(){b(null)};c.src=goog.fs.createObjectUrl(a.file)}else{a.result.callback(null);au.upldr.image.ImageLoader.isProcessing_=false;au.upldr.image.ImageLoader.processNext()}},remove:function(b){if(au.upldr.image.ImageLoader.curItem_&&au.upldr.image.ImageLoader.curItem_.file==b){au.upldr.image.ImageLoader.image_.onload=null;au.upldr.image.ImageLoader.image_.onerror=null;au.upldr.image.ImageLoader.image_.onabort=null;au.upldr.image.ImageLoader.image_.src="data:image/gif;base64,R0lGODlhAQABAIAAAAUEBAAAACwAAAAAAQABAAACAkQBADs=";au.upldr.image.ImageLoader.processNext();return}if(au.upldr.image.ImageLoader.queue_.length==0||b==null){return}var c;for(var a=0;a<au.upldr.image.ImageLoader.queue_.length;a++){c=au.upldr.image.ImageLoader.queue_[a];if(b==c.file){goog.array.removeAt(au.upldr.image.ImageLoader.queue_,a)}}}};au.upldr.image.ImageLoader.Item;goog.provide("au.upldr.utils");goog.require("goog.string");goog.require("goog.array");goog.require("goog.math");au.upldr.utils.format=function(a,c){var b=goog.array.slice(arguments,1);return a.replace(au.upldr.utils.rg_,function(e,d){return b[parseInt(d,10)]})};au.upldr.utils.createGUID=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(d){var b=Math.random()*16|0,a=d=="x"?b:(b&3|8);return a.toString(16)})};au.upldr.utils.setTimeout=function(c,a,b){return setTimeout(b?goog.bind(c,b):c,a)};au.upldr.utils.rg_=/{(\d+)}/g;au.upldr.utils.getExt=function(e){if(!e){return""}var b=e.split(".");for(var d=0,c=b.length-1;d<c;++d){if(b[d]){break}}return d<c?b.pop():""};au.upldr.utils.normalizeAngle=goog.math.standardAngle;au.upldr.utils.insertBR=goog.string.newLineToBr;au.upldr.utils.error=function(a){throw new Error(a)};au.upldr.utils.warning=function(a){if(window.console){window.console.warn(a)}};au.upldr.utils.numberToHexColor=function(a){var b=a.toString(16);b="000000".slice(b.length)+b;return"#"+b};au.upldr.utils.capitalize=function(a){return a.charAt(0).toUpperCase()+a.slice(1).toLowerCase()};au.upldr.utils.getSuitablePointerEvent=function(a){if(!goog.events.BrowserFeature.TOUCH_ENABLED){return a}switch(a){case goog.events.EventType.MOUSEDOWN:if(window.navigator.pointerEnabled){return goog.events.EventType.POINTERDOWN}else{if(window.navigator.msPointerEnabled){return goog.events.EventType.MSPOINTERDOWN}else{return goog.events.EventType.TOUCHSTART}}case goog.events.EventType.MOUSEMOVE:if(window.navigator.pointerEnabled){return goog.events.EventType.POINTERMOVE}else{if(window.navigator.msPointerEnabled){return goog.events.EventType.MSPOINTERMOVE}else{return goog.events.EventType.TOUCHMOVE}}case goog.events.EventType.MOUSEUP:if(window.navigator.pointerEnabled){return goog.events.EventType.POINTERUP}else{if(window.navigator.msPointerEnabled){return goog.events.EventType.MSPOINTERUP}else{return goog.events.EventType.TOUCHEND}}case goog.events.EventType.MOUSEENTER:if(window.navigator.pointerEnabled){return goog.events.EventType.POINTERENTER}else{if(window.navigator.msPointerEnabled){return goog.events.EventType.MSPOINTERENTER}else{return goog.events.EventType.TOUCHSTART}}case goog.events.EventType.MOUSELEAVE:if(window.navigator.pointerEnabled){return goog.events.EventType.POINTERLEAVE}else{if(window.navigator.msPointerEnabled){return goog.events.EventType.MSPOINTERLEAVE}else{return goog.events.EventType.TOUCHEND}}case goog.events.EventType.MOUSEOUT:if(window.navigator.pointerEnabled){return goog.events.EventType.POINTEROUT}else{if(window.navigator.msPointerEnabled){return goog.events.EventType.MSPOINTEROUT}else{return goog.events.EventType.TOUCHEND}}case goog.events.EventType.MOUSEOVER:if(window.navigator.pointerEnabled){return goog.events.EventType.POINTEROVER}else{if(window.navigator.msPointerEnabled){return goog.events.EventType.MSPOINTEROVER}else{return goog.events.EventType.TOUCHSTART}}}return a};goog.provide("au.upldr.image.FitMode");au.upldr.image.FitMode={FIT:"fit",WIDTH:"width",HEIGHT:"height",ACTUAL_SIZE:"actualsize",CROP:"crop"};goog.provide("au.upldr.image");goog.require("goog.events");goog.require("au.upldr.image.FitMode");goog.require("au.upldr.utils");goog.require("au.upldr.image.ImageLoader");goog.require("goog.async.Deferred");au.upldr.image.Size;au.upldr.image.isImageType=function(a){return/^image\/(jpeg|bmp|png|gif)$/.test(a)};au.upldr.image.isJpegImageType=function(a){return/^image\/jpeg$/.test(a)};au.upldr.image.isImageFile=function(b){var a=au.upldr.utils.getExt(b).toLowerCase();switch(a){case"jpg":case"jpeg":case"bmp":case"png":case"gif":return true}return false};au.upldr.image.getThumbnailSize=function(b,a,h,f,g,e){if(!goog.isDefAndNotNull(e)){e=au.upldr.image.FitMode.FIT}if(!goog.isDefAndNotNull(g)){g=0}var d=0;g=au.upldr.utils.normalizeAngle(g);if(g==90||g==270){var c=b;b=a;a=c}switch(e){case au.upldr.image.FitMode.ACTUAL_SIZE:return{width:b,height:a};case au.upldr.image.FitMode.HEIGHT:d=f/a;break;case au.upldr.image.FitMode.WIDTH:d=h/b;break;case au.upldr.image.FitMode.FIT:d=Math.min(f/a,h/b);break;case au.upldr.image.FitMode.CROP:d=Math.min(b/h,a/f);return{width:Math.floor(h*d),height:Math.floor(f*d)};default:au.upldr.utils.error('Incorrect "fitMode" value.')}if(d>1){d=1}return{width:Math.round(b*d)||1,height:Math.round(a*d)||1}};au.upldr.image.getImageSizeByLoadImage=function(b,d){var a=goog.getUid(b);var c=au.upldr.image.imageSizeCache_[a];if(c){d({width:c.width,height:c.height});return}au.upldr.image.ImageLoader.loadDeferred(b).addCallback(function(e){if(e){if(!("naturalWidth" in e)){e.naturalWidth=e.width;e.naturalHeight=e.height}au.upldr.image.imageSizeCache_[a]={width:e.naturalWidth,height:e.naturalHeight};e.src="data:image/gif;base64,R0lGODlhAQABAIAAAAUEBAAAACwAAAAAAQABAAACAkQBADs="}else{au.upldr.image.imageSizeCache_[a]={width:0,height:0}}d(au.upldr.image.imageSizeCache_[a])})};au.upldr.image.getImageSize=function(b,d){if(!b){d({width:0,height:0});return}var a=goog.getUid(b);var c=au.upldr.image.imageSizeCache_[a];if(c){d({width:c.width,height:c.height});return}au.upldr.image.DataReader.getInstance().getDimensionsFromFileDef(b).addCallback(function(e){if(!e){au.upldr.image.imageSizeCache_[a]={width:0,height:0}}else{au.upldr.image.imageSizeCache_[a]=(e)}d(au.upldr.image.imageSizeCache_[a])})};au.upldr.image.getImageSizeDef=function(c){var a=new goog.async.Deferred();if(!c){a.callback({width:0,height:0})}else{var b=goog.getUid(c);var d=au.upldr.image.imageSizeCache_[b];if(d){a.callback({width:d.width,height:d.height})}else{au.upldr.image.DataReader.getInstance().getDimensionsFromFileDef(c).addCallback(function(e){if(!e){au.upldr.image.imageSizeCache_[b]={width:0,height:0}}else{au.upldr.image.imageSizeCache_[b]=(e)}a.callback(au.upldr.image.imageSizeCache_[b])})}}return a};au.upldr.image.imageSizeCache_={};goog.provide("au.upldr.image.DataReader");goog.require("goog.async.Deferred");goog.require("goog.array");goog.require("au.upldr.utils");goog.require("au.upldr.image");au.upldr.image.DataReader=function(){this.fileHeaderStart_=0;this.fileHeaderEnd_=26;this.iterationSize_=262144;this.imageFormatDictionary_=[{bytes:[66,77],type:au.upldr.image.DataReader.formats.BMP},{bytes:[71,73,70,56,55,97],type:au.upldr.image.DataReader.formats.GIF},{bytes:[71,73,70,56,57,97],type:au.upldr.image.DataReader.formats.GIF},{bytes:[137,80,78,71,13,10,26,10],type:au.upldr.image.DataReader.formats.PNG},{bytes:[255,216],decoder:this.decodeJfif.bind(this),type:au.upldr.image.DataReader.formats.JPEG}];goog.array.sort(this.imageFormatDictionary_,function(b,a){return b.bytes.length<a.bytes.length?1:0});this.imageFormatDecoders_={};this.imageFormatDecoders_[au.upldr.image.DataReader.formats.JPEG]=this.decodeJfif.bind(this);this.imageFormatDecoders_[au.upldr.image.DataReader.formats.PNG]=this.decodePng.bind(this);this.imageFormatDecoders_[au.upldr.image.DataReader.formats.GIF]=this.decodeGif.bind(this);this.imageFormatDecoders_[au.upldr.image.DataReader.formats.BMP]=this.decodeBitmap.bind(this)};goog.addSingletonGetter(au.upldr.image.DataReader);au.upldr.image.DataReader.formats={JPEG:"image/jpeg",PNG:"image/png",GIF:"image/gif",BMP:"image/bmp"};au.upldr.image.DataReader.prototype.getImageTypeDef=function(a){var b=new goog.async.Deferred();this.getSmallDataView_(a).addCallback(function(c){b.callback(c?this.getImageTypeFromDataView.bind(this)(c):null)}.bind(this));return b};au.upldr.image.DataReader.prototype.getSmallDataView_=function(b){if(b.size==0){var c=new goog.async.Deferred();c.callback(null);return c}var a=au.upldr.utils.fileUtils.getFilePart(b,this.fileHeaderStart_,this.fileHeaderEnd_);return au.upldr.utils.fileUtils.blobToDataView(a)};au.upldr.image.DataReader.prototype.getDimensionsFromFileDef=function(a){var b=new goog.async.Deferred();this.getSmallDataView_(a).addCallback(function(e){var c=(this.getImageTypeFromDataView.bind(this)(e));if(c!=null){if(this.imageFormatDecoders_.hasOwnProperty(c)){if(c==au.upldr.image.DataReader.formats.JPEG){var d=function(i,h){var g=this.findJfifSize_(h,i);var f=(g.result);if(f){b.callback(f);return null}else{return g.offset}}.bind(this);this.readByParts(a,2,d)}else{b.callback(this.imageFormatDecoders_[c].bind(this)(e))}}}else{b.callback(null)}}.bind(this));return b};au.upldr.image.DataReader.prototype.getThumbnailFromFileDef=function(a){var b=new goog.async.Deferred();this.getSmallDataView_(a).addCallback(function(f){var c=(this.getImageTypeFromDataView.bind(this)(f));if(c!=null){if(this.imageFormatDecoders_.hasOwnProperty(c)){if(c==au.upldr.image.DataReader.formats.JPEG){var d=this;var e={start:null,end:null,offset:0};var g=function(l,k){var j=d.findJfifThumbnail_(k,l);var h=(j.result);if(h&&h.start!=null){e.start=e.offset+h.start;e.offset+=2}if(h&&h.end!=null){e.end=e.offset+h.end;e.offset+=2}if(e.start!=null&&e.end!=null){var i=au.upldr.utils.fileUtils.getFilePart(a,e.start,e.end);au.upldr.utils.fileUtils.blobToDataView(i).addCallback(function(m){i=au.upldr.utils.fileUtils.arrayBufferToBlob(m,a.type);b.callback(i)});return null}else{e.offset+=j.offset;if(e.offset<a.size){return e.offset}else{b.callback(null);return null}}};this.readByParts(a,2,g)}else{b.callback(null)}}}else{b.callback(null)}}.bind(this));return b};au.upldr.image.DataReader.prototype.getImageTypeFromDataView=function(e){if(e){var d=this.imageFormatDictionary_[0].bytes.length;var b=[];for(var c=0;c<d;c++){b[c]=e.getUint8(c);for(var a=0;a<this.imageFormatDictionary_.length;a++){if(this.startsWith(b,this.imageFormatDictionary_[a].bytes)){return(this.imageFormatDictionary_[a].type)}}}}return null};au.upldr.image.DataReader.prototype.startsWith=function(c,b){for(var a=0;a<b.length;a++){if(c[a]!=b[a]){return false}}return true};au.upldr.image.DataReader.prototype.decodeBitmap=function(d){var c,a,b=d.getInt32(14,true);if(b==12){c=d.getInt16(18,true);a=d.getInt16(20,true)}else{c=d.getInt32(18,true);a=d.getInt32(22,true)}return({width:c,height:a})};au.upldr.image.DataReader.prototype.decodeGif=function(c){var b=c.getInt16(6,true);var a=c.getInt16(8,true);return({width:b,height:a})};au.upldr.image.DataReader.prototype.decodePng=function(c){var b=c.getInt32(16,false);var a=c.getInt32(20,false);return({width:b,height:a})};au.upldr.image.DataReader.prototype.decodeJfif=function(e,d){while(d<e.byteLength&&e.getUint8(d)==255){var b=e.getUint8(d+1);if(b==192||b==193||b==194){var a=e.getInt16(d+5,false);var c=e.getInt16(d+7,false);return({width:c,height:a})}else{if(b>=208&&b<=215){d+=2}else{d+=2+e.getUint16(d+2)}}}return null};au.upldr.image.DataReader.OffsetResult;au.upldr.image.DataReader.Position;au.upldr.image.DataReader.prototype.findJfifSize_=function(e,d){while(d<e.byteLength&&e.getUint8(d)==255){var b=e.getUint8(d+1);if(b==192||b==193||b==194){var a=e.getInt16(d+5,false);var c=e.getInt16(d+7,false);return({offset:d,result:({width:c,height:a})})}else{if(b>=208&&b<=215){d+=2}else{d+=2+e.getUint16(d+2)}}}return({offset:d,result:null})};au.upldr.image.DataReader.prototype.findJfifThumbnail_=function(e,d){var a=({offset:d,result:({start:null,end:null})});for(;a.offset<e.byteLength-1;a.offset++){var c=e.getUint8(a.offset);var b=e.getUint8(a.offset+1);if(c==255){switch(b){case 216:a.result.start=a.offset;break;case 217:a.result.end=a.offset;return a}}}return a};au.upldr.image.DataReader.prototype.readByParts=function(a,b,c){if(this.iterationSize_>=a.size){au.upldr.utils.fileUtils.blobToDataView(a).addCallback(function(d){c(b,d)}.bind(this))}else{this.readPart(a,b,c,this.fileHeaderStart_,this.iterationSize_)}};au.upldr.image.DataReader.prototype.readPart=function(c,d,f,e,a){var b=au.upldr.utils.fileUtils.getFilePart(c,e,a);au.upldr.utils.fileUtils.blobToDataView(b).addCallback(function(i){var g=f(d,i);if(g){if(g<c.size){var h=(c.size-g)>this.iterationSize_?this.iterationSize_:(c.size-g);this.readPart(c,0,f,g,g+h)}}}.bind(this))};goog.provide("goog.structs.Collection");goog.structs.Collection=function(){};goog.structs.Collection.prototype.add;goog.structs.Collection.prototype.remove;goog.structs.Collection.prototype.contains;goog.structs.Collection.prototype.getCount;goog.provide("au.upldr.events.CollectionEvent");goog.require("goog.events");goog.require("goog.events.Event");au.upldr.events.CollectionEvent=function(c,b,a){goog.base(this,c);this.kind_=b;this.items_=a};goog.inherits(au.upldr.events.CollectionEvent,goog.events.Event);au.upldr.events.CollectionEvent.COLLECTION_CHANGED=goog.events.getUniqueId("collection_changed");au.upldr.events.CollectionEvent.prototype.getKind=function(){return this.kind_};au.upldr.events.CollectionEvent.prototype.getItems=function(){return this.items_};goog.provide("au.upldr.events.CollectionEventKind");au.upldr.events.CollectionEventKind={ADD:"add",ADD_RANGE:"add_range",REMOVE:"remove",RESET:"reset"};goog.provide("au.upldr.ObservableCollection");goog.require("goog.array");goog.require("goog.events.EventTarget");goog.require("goog.structs.Collection");goog.require("au.upldr.events.CollectionEvent");goog.require("au.upldr.events.CollectionEventKind");au.upldr.ObservableCollection=function(){goog.base(this);this.collection_=[]};goog.inherits(au.upldr.ObservableCollection,goog.events.EventTarget);au.upldr.ObservableCollection.prototype.add=function(b){this.collection_.push(b);var a=new au.upldr.events.CollectionEvent(au.upldr.events.CollectionEvent.COLLECTION_CHANGED,au.upldr.events.CollectionEventKind.ADD,[b]);try{this.dispatchEvent(a)}catch(c){}};au.upldr.ObservableCollection.prototype.remove=function(a){return this.removeAt(goog.array.indexOf(this.collection_,a))};au.upldr.ObservableCollection.prototype.removeAt=function(c){if(this.collection_.length>c){var d=this.collection_[c];var a=goog.array.removeAt(this.collection_,c);if(a){var b=new au.upldr.events.CollectionEvent(au.upldr.events.CollectionEvent.COLLECTION_CHANGED,au.upldr.events.CollectionEventKind.REMOVE,[d]);try{this.dispatchEvent(b)}catch(f){}}return a}else{return false}};au.upldr.ObservableCollection.prototype.getItem=function(a){return this.collection_[a]};au.upldr.ObservableCollection.prototype.clear=function(){if(this.collection_.length>0){this.collection_=[];var a=new au.upldr.events.CollectionEvent(au.upldr.events.CollectionEvent.COLLECTION_CHANGED,au.upldr.events.CollectionEventKind.RESET,[]);try{this.dispatchEvent(a)}catch(b){}}};au.upldr.ObservableCollection.prototype.contains=function(a){return goog.array.contains(this.collection_,a)};au.upldr.ObservableCollection.prototype.getCount=function(){return this.collection_.length};au.upldr.ObservableCollection.prototype.toArray=function(){return this.collection_.slice()};goog.provide("au.upldr.upload.Fields");au.upldr.upload.Fields={CONTROL_ID:"UploaderID",PACKAGE_GUID:"PackageGuid",PACKAGE_FILE_COUNT:"PackageFileCount",PACKAGE_COUNT:"PackageCount",PACKAGE_INDEX:"PackageIndex",PACKAGE_COMPLETE:"PackageComplete",FILE_NAMES_URL_ENCODED:"FilenamesUrlEncoded",SOURCE_NAME:"SourceName_{0}",SOURCE_SIZE:"SourceSize_{0}",SOURCE_WIDTH:"SourceWidth_{0}",SOURCE_HEIGHT:"SourceHeight_{0}",ANGLE:"Angle_{0}",DESCRIPTION:"Description_{0}",CROP_BOUNDS:"CropBounds_{0}",TAG:"Tag_{0}",FILE:"File{1}_{0}",FILE_MODE:"File{1}Mode_{0}",FILE_NAME:"File{1}Name_{0}",FILE_SIZE:"File{1}Size_{0}",FILE_WIDTH:"File{1}Width_{0}",FILE_HEIGHT:"File{1}Height_{0}",REQUEST_COMPLETE:"RequestComplete",REQUEST_COUNT:"RequestCount"};goog.provide("au.upldr.ErrorCodes");au.upldr.ErrorCodes={UNKNOWN_ERROR:0,NUMBER_OF_SELECTED_FILES_LESS_THEN_ALLOWED:1,ACTION_URL_NOT_FOUND:2,ACTION_URL_INVALID:3,SERVER_SIDE_ERROR:4,UPLOAD_ABORTED_BY_USER:9,HTTP_CODE_3XX:11,UPLOAD_ABORTED_BY_SCRIPT:12,TRIAL_PERIOD_EXPIRED:13,UPLOAD_ABORTED_BY_PACKAGE_COMPLETE_EVENT_HANDLER:18,THUMBNAIL_SIZE_LIMIT:20};goog.provide("au.upldr.errorHelper");goog.require("au.upldr.ErrorCodes");goog.require("au.upldr.Properties");au.upldr.errorHelper.getErrorCodeByHttpStatus=function(a){if(a>=300&&a<400){return au.upldr.ErrorCodes.HTTP_CODE_3XX}if(a>=400&&a<500){return au.upldr.ErrorCodes.ACTION_URL_NOT_FOUND}if(a>=500&&a<600){return au.upldr.ErrorCodes.SERVER_SIDE_ERROR}return au.upldr.ErrorCodes.UNKNOWN_ERROR};au.upldr.errorHelper.getErrorMessageByCode=function(b,a){switch(b){case au.upldr.ErrorCodes.HTTP_CODE_3XX:return(a.getProperty(au.upldr.Properties.UPLOAD_ERROR_MSG));case au.upldr.ErrorCodes.ACTION_URL_NOT_FOUND:return au.upldr.utils.format((a.getProperty(au.upldr.Properties.SERVER_NOT_FOUND_MSG)),(a.getProperty(au.upldr.Properties.ACTION_URL)));case au.upldr.ErrorCodes.SERVER_SIDE_ERROR:return(a.getProperty(au.upldr.Properties.SERVER_SIDE_ERROR_MSG));case au.upldr.ErrorCodes.UNKNOWN_ERROR:return(a.getProperty(au.upldr.Properties.UPLOAD_ERROR_MSG));default:return""}};goog.provide("goog.math.Box");goog.require("goog.math.Coordinate");goog.math.Box=function(d,b,a,c){this.top=d;this.right=b;this.bottom=a;this.left=c};goog.math.Box.boundingBox=function(c){var b=new goog.math.Box(arguments[0].y,arguments[0].x,arguments[0].y,arguments[0].x);for(var a=1;a<arguments.length;a++){var d=arguments[a];b.top=Math.min(b.top,d.y);b.right=Math.max(b.right,d.x);b.bottom=Math.max(b.bottom,d.y);b.left=Math.min(b.left,d.x)}return b};goog.math.Box.prototype.getWidth=function(){return this.right-this.left};goog.math.Box.prototype.getHeight=function(){return this.bottom-this.top};goog.math.Box.prototype.clone=function(){return new goog.math.Box(this.top,this.right,this.bottom,this.left)};if(goog.DEBUG){goog.math.Box.prototype.toString=function(){return"("+this.top+"t, "+this.right+"r, "+this.bottom+"b, "+this.left+"l)"}}goog.math.Box.prototype.contains=function(a){return goog.math.Box.contains(this,a)};goog.math.Box.prototype.expand=function(b,d,c,a){if(goog.isObject(b)){this.top-=b.top;this.right+=b.right;this.bottom+=b.bottom;this.left-=b.left}else{this.top-=b;this.right+=d;this.bottom+=c;this.left-=a}return this};goog.math.Box.prototype.expandToInclude=function(a){this.left=Math.min(this.left,a.left);this.top=Math.min(this.top,a.top);this.right=Math.max(this.right,a.right);this.bottom=Math.max(this.bottom,a.bottom)};goog.math.Box.equals=function(d,c){if(d==c){return true}if(!d||!c){return false}return d.top==c.top&&d.right==c.right&&d.bottom==c.bottom&&d.left==c.left};goog.math.Box.contains=function(b,a){if(!b||!a){return false}if(a instanceof goog.math.Box){return a.left>=b.left&&a.right<=b.right&&a.top>=b.top&&a.bottom<=b.bottom}return a.x>=b.left&&a.x<=b.right&&a.y>=b.top&&a.y<=b.bottom};goog.math.Box.relativePositionX=function(a,b){if(b.x<a.left){return b.x-a.left}else{if(b.x>a.right){return b.x-a.right}}return 0};goog.math.Box.relativePositionY=function(a,b){if(b.y<a.top){return b.y-a.top}else{if(b.y>a.bottom){return b.y-a.bottom}}return 0};goog.math.Box.distance=function(b,d){var a=goog.math.Box.relativePositionX(b,d);var c=goog.math.Box.relativePositionY(b,d);return Math.sqrt(a*a+c*c)};goog.math.Box.intersects=function(d,c){return(d.left<=c.right&&c.left<=d.right&&d.top<=c.bottom&&c.top<=d.bottom)};goog.math.Box.intersectsWithPadding=function(d,c,e){return(d.left<=c.right+e&&c.left<=d.right+e&&d.top<=c.bottom+e&&c.top<=d.bottom+e)};goog.math.Box.prototype.ceil=function(){this.top=Math.ceil(this.top);this.right=Math.ceil(this.right);this.bottom=Math.ceil(this.bottom);this.left=Math.ceil(this.left);return this};goog.math.Box.prototype.floor=function(){this.top=Math.floor(this.top);this.right=Math.floor(this.right);this.bottom=Math.floor(this.bottom);this.left=Math.floor(this.left);return this};goog.math.Box.prototype.round=function(){this.top=Math.round(this.top);this.right=Math.round(this.right);this.bottom=Math.round(this.bottom);this.left=Math.round(this.left);return this};goog.math.Box.prototype.translate=function(b,a){if(b instanceof goog.math.Coordinate){this.left+=b.x;this.right+=b.x;this.top+=b.y;this.bottom+=b.y}else{this.left+=b;this.right+=b;if(goog.isNumber(a)){this.top+=a;this.bottom+=a}}return this};goog.math.Box.prototype.scale=function(c,b){var a=goog.isNumber(b)?b:c;this.left*=c;this.right*=c;this.top*=a;this.bottom*=a;return this};goog.provide("goog.math.Rect");goog.require("goog.math.Box");goog.require("goog.math.Coordinate");goog.require("goog.math.Size");goog.math.Rect=function(a,d,b,c){this.left=a;this.top=d;this.width=b;this.height=c};goog.math.Rect.prototype.clone=function(){return new goog.math.Rect(this.left,this.top,this.width,this.height)};goog.math.Rect.prototype.toBox=function(){var b=this.left+this.width;var a=this.top+this.height;return new goog.math.Box(this.top,b,a,this.left)};goog.math.Rect.createFromBox=function(a){return new goog.math.Rect(a.left,a.top,a.right-a.left,a.bottom-a.top)};if(goog.DEBUG){goog.math.Rect.prototype.toString=function(){return"("+this.left+", "+this.top+" - "+this.width+"w x "+this.height+"h)"}}goog.math.Rect.equals=function(d,c){if(d==c){return true}if(!d||!c){return false}return d.left==c.left&&d.width==c.width&&d.top==c.top&&d.height==c.height};goog.math.Rect.prototype.intersection=function(e){var b=Math.max(this.left,e.left);var a=Math.min(this.left+this.width,e.left+e.width);if(b<=a){var d=Math.max(this.top,e.top);var c=Math.min(this.top+this.height,e.top+e.height);if(d<=c){this.left=b;this.top=d;this.width=a-b;this.height=c-d;return true}}return false};goog.math.Rect.intersection=function(d,c){var f=Math.max(d.left,c.left);var e=Math.min(d.left+d.width,c.left+c.width);if(f<=e){var h=Math.max(d.top,c.top);var g=Math.min(d.top+d.height,c.top+c.height);if(h<=g){return new goog.math.Rect(f,h,e-f,g-h)}}return null};goog.math.Rect.intersects=function(d,c){return(d.left<=c.left+c.width&&c.left<=d.left+d.width&&d.top<=c.top+c.height&&c.top<=d.top+d.height)};goog.math.Rect.prototype.intersects=function(a){return goog.math.Rect.intersects(this,a)};goog.math.Rect.difference=function(h,g){var c=goog.math.Rect.intersection(h,g);if(!c||!c.height||!c.width){return[h.clone()]}var l=[];var f=h.top;var i=h.height;var d=h.left+h.width;var k=h.top+h.height;var j=g.left+g.width;var e=g.top+g.height;if(g.top>h.top){l.push(new goog.math.Rect(h.left,h.top,h.width,g.top-h.top));f=g.top;i-=g.top-h.top}if(e<k){l.push(new goog.math.Rect(h.left,e,h.width,k-e));i=e-f}if(g.left>h.left){l.push(new goog.math.Rect(h.left,f,g.left-h.left,i))}if(j<d){l.push(new goog.math.Rect(j,f,d-j,i))}return l};goog.math.Rect.prototype.difference=function(a){return goog.math.Rect.difference(this,a)};goog.math.Rect.prototype.boundingRect=function(c){var b=Math.max(this.left+this.width,c.left+c.width);var a=Math.max(this.top+this.height,c.top+c.height);this.left=Math.min(this.left,c.left);this.top=Math.min(this.top,c.top);this.width=b-this.left;this.height=a-this.top};goog.math.Rect.boundingRect=function(d,c){if(!d||!c){return null}var e=d.clone();e.boundingRect(c);return e};goog.math.Rect.prototype.contains=function(a){if(a instanceof goog.math.Rect){return this.left<=a.left&&this.left+this.width>=a.left+a.width&&this.top<=a.top&&this.top+this.height>=a.top+a.height}else{return a.x>=this.left&&a.x<=this.left+this.width&&a.y>=this.top&&a.y<=this.top+this.height}};goog.math.Rect.prototype.squaredDistance=function(a){var c=a.x<this.left?this.left-a.x:Math.max(a.x-(this.left+this.width),0);var b=a.y<this.top?this.top-a.y:Math.max(a.y-(this.top+this.height),0);return c*c+b*b};goog.math.Rect.prototype.distance=function(a){return Math.sqrt(this.squaredDistance(a))};goog.math.Rect.prototype.getSize=function(){return new goog.math.Size(this.width,this.height)};goog.math.Rect.prototype.getTopLeft=function(){return new goog.math.Coordinate(this.left,this.top)};goog.math.Rect.prototype.getCenter=function(){return new goog.math.Coordinate(this.left+this.width/2,this.top+this.height/2)};goog.math.Rect.prototype.getBottomRight=function(){return new goog.math.Coordinate(this.left+this.width,this.top+this.height)};goog.math.Rect.prototype.ceil=function(){this.left=Math.ceil(this.left);this.top=Math.ceil(this.top);this.width=Math.ceil(this.width);this.height=Math.ceil(this.height);return this};goog.math.Rect.prototype.floor=function(){this.left=Math.floor(this.left);this.top=Math.floor(this.top);this.width=Math.floor(this.width);this.height=Math.floor(this.height);return this};goog.math.Rect.prototype.round=function(){this.left=Math.round(this.left);this.top=Math.round(this.top);this.width=Math.round(this.width);this.height=Math.round(this.height);return this};goog.math.Rect.prototype.translate=function(b,a){if(b instanceof goog.math.Coordinate){this.left+=b.x;this.top+=b.y}else{this.left+=b;if(goog.isNumber(a)){this.top+=a}}return this};goog.math.Rect.prototype.scale=function(c,b){var a=goog.isNumber(b)?b:c;this.left*=c;this.width*=c;this.top*=a;this.height*=a;return this};goog.provide("goog.dom.vendor");goog.require("goog.string");goog.require("goog.userAgent");goog.dom.vendor.getVendorJsPrefix=function(){if(goog.userAgent.WEBKIT){return"Webkit"}else{if(goog.userAgent.GECKO){return"Moz"}else{if(goog.userAgent.IE){return"ms"}else{if(goog.userAgent.OPERA){return"O"}}}}return null};goog.dom.vendor.getVendorPrefix=function(){if(goog.userAgent.WEBKIT){return"-webkit"}else{if(goog.userAgent.GECKO){return"-moz"}else{if(goog.userAgent.IE){return"-ms"}else{if(goog.userAgent.OPERA){return"-o"}}}}return null};goog.dom.vendor.getPrefixedPropertyName=function(c,b){if(b&&c in b){return c}var d=goog.dom.vendor.getVendorJsPrefix();if(d){d=d.toLowerCase();var a=d+goog.string.toTitleCase(c);return(!goog.isDef(b)||a in b)?a:null}return null};goog.dom.vendor.getPrefixedEventType=function(a){var b=goog.dom.vendor.getVendorJsPrefix()||"";return(b+a).toLowerCase()};goog.provide("goog.style");goog.require("goog.array");goog.require("goog.asserts");goog.require("goog.dom");goog.require("goog.dom.NodeType");goog.require("goog.dom.vendor");goog.require("goog.math.Box");goog.require("goog.math.Coordinate");goog.require("goog.math.Rect");goog.require("goog.math.Size");goog.require("goog.object");goog.require("goog.string");goog.require("goog.userAgent");goog.forwardDeclare("goog.events.BrowserEvent");goog.forwardDeclare("goog.events.Event");goog.style.setStyle=function(c,d,a){if(goog.isString(d)){goog.style.setStyle_(c,a,d)}else{for(var b in d){goog.style.setStyle_(c,d[b],b)}}};goog.style.setStyle_=function(b,d,c){var a=goog.style.getVendorJsStyleName_(b,c);if(a){b.style[a]=d}};goog.style.styleNameCache_={};goog.style.getVendorJsStyleName_=function(b,c){var a=goog.style.styleNameCache_[c];if(!a){var e=goog.string.toCamelCase(c);a=e;if(b.style[e]===undefined){var d=goog.dom.vendor.getVendorJsPrefix()+goog.string.toTitleCase(e);if(b.style[d]!==undefined){a=d}}goog.style.styleNameCache_[c]=a}return a};goog.style.getVendorStyleName_=function(a,b){var d=goog.string.toCamelCase(b);if(a.style[d]===undefined){var c=goog.dom.vendor.getVendorJsPrefix()+goog.string.toTitleCase(d);if(a.style[c]!==undefined){return goog.dom.vendor.getVendorPrefix()+"-"+b}}return b};goog.style.getStyle=function(b,c){var a=b.style[goog.string.toCamelCase(c)];if(typeof(a)!=="undefined"){return a}return b.style[goog.style.getVendorJsStyleName_(b,c)]||""};goog.style.getComputedStyle=function(a,c){var d=goog.dom.getOwnerDocument(a);if(d.defaultView&&d.defaultView.getComputedStyle){var b=d.defaultView.getComputedStyle(a,null);if(b){return b[c]||b.getPropertyValue(c)||""}}return""};goog.style.getCascadedStyle=function(a,b){return a.currentStyle?a.currentStyle[b]:null};goog.style.getStyle_=function(a,b){return goog.style.getComputedStyle(a,b)||goog.style.getCascadedStyle(a,b)||(a.style&&a.style[b])};goog.style.getComputedBoxSizing=function(a){return goog.style.getStyle_(a,"boxSizing")||goog.style.getStyle_(a,"MozBoxSizing")||goog.style.getStyle_(a,"WebkitBoxSizing")||null};goog.style.getComputedPosition=function(a){return goog.style.getStyle_(a,"position")};goog.style.getBackgroundColor=function(a){return goog.style.getStyle_(a,"backgroundColor")};goog.style.getComputedOverflowX=function(a){return goog.style.getStyle_(a,"overflowX")};goog.style.getComputedOverflowY=function(a){return goog.style.getStyle_(a,"overflowY")};goog.style.getComputedZIndex=function(a){return goog.style.getStyle_(a,"zIndex")};goog.style.getComputedTextAlign=function(a){return goog.style.getStyle_(a,"textAlign")};goog.style.getComputedCursor=function(a){return goog.style.getStyle_(a,"cursor")};goog.style.getComputedTransform=function(a){var b=goog.style.getVendorStyleName_(a,"transform");return goog.style.getStyle_(a,b)||goog.style.getStyle_(a,"transform")};goog.style.setPosition=function(c,b,d){var a,e;if(b instanceof goog.math.Coordinate){a=b.x;e=b.y}else{a=b;e=d}c.style.left=goog.style.getPixelStyleValue_((a),false);c.style.top=goog.style.getPixelStyleValue_((e),false)};goog.style.getPosition=function(a){return new goog.math.Coordinate(a.offsetLeft,a.offsetTop)};goog.style.getClientViewportElement=function(b){var a;if(b){a=goog.dom.getOwnerDocument(b)}else{a=goog.dom.getDocument()}if(goog.userAgent.IE&&!goog.userAgent.isDocumentModeOrHigher(9)&&!goog.dom.getDomHelper(a).isCss1CompatMode()){return a.body}return a.documentElement};goog.style.getViewportPageOffset=function(d){var a=d.body;var b=d.documentElement;var e=a.scrollLeft||b.scrollLeft;var c=a.scrollTop||b.scrollTop;return new goog.math.Coordinate(e,c)};goog.style.getBoundingClientRect_=function(a){var b;try{b=a.getBoundingClientRect()}catch(d){return{left:0,top:0,right:0,bottom:0}}if(goog.userAgent.IE&&a.ownerDocument.body){var c=a.ownerDocument;b.left-=c.documentElement.clientLeft+c.body.clientLeft;b.top-=c.documentElement.clientTop+c.body.clientTop}return(b)};goog.style.getOffsetParent=function(b){if(goog.userAgent.IE&&!goog.userAgent.isDocumentModeOrHigher(8)){return b.offsetParent}var e=goog.dom.getOwnerDocument(b);var d=goog.style.getStyle_(b,"position");var a=d=="fixed"||d=="absolute";for(var c=b.parentNode;c&&c!=e;c=c.parentNode){if(c.nodeType==goog.dom.NodeType.DOCUMENT_FRAGMENT&&c.host){c=c.host}d=goog.style.getStyle_((c),"position");a=a&&d=="static"&&c!=e.documentElement&&c!=e.body;if(!a&&(c.scrollWidth>c.clientWidth||c.scrollHeight>c.clientHeight||d=="fixed"||d=="absolute"||d=="relative")){return(c)}}return null};goog.style.getVisibleRectForElement=function(d){var k=new goog.math.Box(0,Infinity,Infinity,0);var c=goog.dom.getDomHelper(d);var f=c.getDocument().body;var i=c.getDocument().documentElement;var l=c.getDocumentScrollElement();for(var a=d;a=goog.style.getOffsetParent(a);){if((!goog.userAgent.IE||a.clientWidth!=0)&&(!goog.userAgent.WEBKIT||a.clientHeight!=0||a!=f)&&(a!=f&&a!=i&&goog.style.getStyle_(a,"overflow")!="visible")){var g=goog.style.getPageOffset(a);var b=goog.style.getClientLeftTop(a);g.x+=b.x;g.y+=b.y;k.top=Math.max(k.top,g.y);k.right=Math.min(k.right,g.x+a.clientWidth);k.bottom=Math.min(k.bottom,g.y+a.clientHeight);k.left=Math.max(k.left,g.x)}}var j=l.scrollLeft,h=l.scrollTop;k.left=Math.max(k.left,j);k.top=Math.max(k.top,h);var e=c.getViewportSize();k.right=Math.min(k.right,j+e.width);k.bottom=Math.min(k.bottom,h+e.height);return k.top>=0&&k.left>=0&&k.bottom>k.top&&k.right>k.left?k:null};goog.style.getContainerOffsetToScrollInto=function(g,a,k){var d=goog.style.getPageOffset(g);var f=goog.style.getPageOffset(a);var c=goog.style.getBorderBox(a);var l=d.x-f.x-c.left;var j=d.y-f.y-c.top;var i=a.clientWidth-g.offsetWidth;var h=a.clientHeight-g.offsetHeight;var e=a.scrollLeft;var b=a.scrollTop;if(a==goog.dom.getDocument().body||a==goog.dom.getDocument().documentElement){e=f.x+c.left;b=f.y+c.top;if(goog.userAgent.IE&&!goog.userAgent.isDocumentModeOrHigher(10)){e+=c.left;b+=c.top}}if(k){e+=l-i/2;b+=j-h/2}else{e+=Math.min(l,Math.max(l-i,0));b+=Math.min(j,Math.max(j-h,0))}return new goog.math.Coordinate(e,b)};goog.style.scrollIntoContainerView=function(b,a,c){var d=goog.style.getContainerOffsetToScrollInto(b,a,c);a.scrollLeft=d.x;a.scrollTop=d.y};goog.style.getClientLeftTop=function(a){return new goog.math.Coordinate(a.clientLeft,a.clientTop)};goog.style.getPageOffset=function(b){var e=goog.dom.getOwnerDocument(b);goog.asserts.assertObject(b,"Parameter is required");var f=new goog.math.Coordinate(0,0);var a=goog.style.getClientViewportElement(e);if(b==a){return f}var c=goog.style.getBoundingClientRect_(b);var d=goog.dom.getDomHelper(e).getDocumentScroll();f.x=c.left+d.x;f.y=c.top+d.y;return f};goog.style.getPageOffsetLeft=function(a){return goog.style.getPageOffset(a).x};goog.style.getPageOffsetTop=function(a){return goog.style.getPageOffset(a).y};goog.style.getFramedPageOffset=function(c,e){var a=new goog.math.Coordinate(0,0);var b=goog.dom.getWindow(goog.dom.getOwnerDocument(c));var d=c;do{var f=b==e?goog.style.getPageOffset(d):goog.style.getClientPositionForElement_(goog.asserts.assert(d));a.x+=f.x;a.y+=f.y}while(b&&b!=e&&b!=b.parent&&(d=b.frameElement)&&(b=b.parent));return a};goog.style.translateRectForAnotherFrame=function(c,d,b){if(d.getDocument()!=b.getDocument()){var a=d.getDocument().body;var e=goog.style.getFramedPageOffset(a,b.getWindow());e=goog.math.Coordinate.difference(e,goog.style.getPageOffset(a));if(goog.userAgent.IE&&!goog.userAgent.isDocumentModeOrHigher(9)&&!d.isCss1CompatMode()){e=goog.math.Coordinate.difference(e,d.getDocumentScroll())}c.left+=e.x;c.top+=e.y}};goog.style.getRelativePosition=function(d,c){var e=goog.style.getClientPosition(d);var f=goog.style.getClientPosition(c);return new goog.math.Coordinate(e.x-f.x,e.y-f.y)};goog.style.getClientPositionForElement_=function(a){var b=goog.style.getBoundingClientRect_(a);return new goog.math.Coordinate(b.left,b.top)};goog.style.getClientPosition=function(c){goog.asserts.assert(c);if(c.nodeType==goog.dom.NodeType.ELEMENT){return goog.style.getClientPositionForElement_((c))}else{var a=goog.isFunction(c.getBrowserEvent);var d=(c);var b=c;if(c.targetTouches&&c.targetTouches.length){b=c.targetTouches[0]}else{if(a&&d.getBrowserEvent().targetTouches&&d.getBrowserEvent().targetTouches.length){b=d.getBrowserEvent().targetTouches[0]}}return new goog.math.Coordinate(b.clientX,b.clientY)}};goog.style.setPageOffset=function(e,b,a){var f=goog.style.getPageOffset(e);if(b instanceof goog.math.Coordinate){a=b.y;b=b.x}var d=b-f.x;var c=a-f.y;goog.style.setPosition(e,e.offsetLeft+d,e.offsetTop+c)};goog.style.setSize=function(b,a,d){var c;if(a instanceof goog.math.Size){c=a.height;a=a.width}else{if(d==undefined){throw Error("missing height argument")}c=d}goog.style.setWidth(b,(a));goog.style.setHeight(b,(c))};goog.style.getPixelStyleValue_=function(b,a){if(typeof b=="number"){b=(a?Math.round(b):b)+"px"}return b};goog.style.setHeight=function(b,a){b.style.height=goog.style.getPixelStyleValue_(a,true)};goog.style.setWidth=function(a,b){a.style.width=goog.style.getPixelStyleValue_(b,true)};goog.style.getSize=function(a){return goog.style.evaluateWithTemporaryDisplay_(goog.style.getSizeWithDisplay_,(a))};goog.style.evaluateWithTemporaryDisplay_=function(e,b){if(goog.style.getStyle_(b,"display")!="none"){return e(b)}var d=b.style;var a=d.display;var f=d.visibility;var c=d.position;d.visibility="hidden";d.position="absolute";d.display="inline";var g=e(b);d.display=a;d.position=c;d.visibility=f;return g};goog.style.getSizeWithDisplay_=function(b){var d=b.offsetWidth;var a=b.offsetHeight;var c=goog.userAgent.WEBKIT&&!d&&!a;if((!goog.isDef(d)||c)&&b.getBoundingClientRect){var e=goog.style.getBoundingClientRect_(b);return new goog.math.Size(e.right-e.left,e.bottom-e.top)}return new goog.math.Size(d,a)};goog.style.getTransformedSize=function(a){if(!a.getBoundingClientRect){return null}var b=goog.style.evaluateWithTemporaryDisplay_(goog.style.getBoundingClientRect_,a);return new goog.math.Size(b.right-b.left,b.bottom-b.top)};goog.style.getBounds=function(a){var c=goog.style.getPageOffset(a);var b=goog.style.getSize(a);return new goog.math.Rect(c.x,c.y,b.width,b.height)};goog.style.toCamelCase=function(a){return goog.string.toCamelCase(String(a))};goog.style.toSelectorCase=function(a){return goog.string.toSelectorCase(a)};goog.style.getOpacity=function(d){var c=d.style;var a="";if("opacity" in c){a=c.opacity}else{if("MozOpacity" in c){a=c.MozOpacity}else{if("filter" in c){var b=c.filter.match(/alpha\(opacity=([\d.]+)\)/);if(b){a=String(b[1]/100)}}}}return a==""?a:Number(a)};goog.style.setOpacity=function(b,c){var a=b.style;if("opacity" in a){a.opacity=c}else{if("MozOpacity" in a){a.MozOpacity=c}else{if("filter" in a){if(c===""){a.filter=""}else{a.filter="alpha(opacity="+c*100+")"}}}}};goog.style.setTransparentBackgroundImage=function(b,c){var a=b.style;if(goog.userAgent.IE&&!goog.userAgent.isVersionOrHigher("8")){a.filter='progid:DXImageTransform.Microsoft.AlphaImageLoader(src="'+c+'", sizingMethod="crop")'}else{a.backgroundImage="url("+c+")";a.backgroundPosition="top left";a.backgroundRepeat="no-repeat"}};goog.style.clearTransparentBackgroundImage=function(b){var a=b.style;if("filter" in a){a.filter=""}else{a.backgroundImage="none"}};goog.style.showElement=function(a,b){goog.style.setElementShown(a,b)};goog.style.setElementShown=function(a,b){a.style.display=b?"":"none"};goog.style.isElementShown=function(a){return a.style.display!="none"};goog.style.installStyles=function(d,g){var c=goog.dom.getDomHelper(g);var f=null;var e=c.getDocument();if(goog.userAgent.IE&&e.createStyleSheet){f=e.createStyleSheet();goog.style.setStyles(f,d)}else{var b=c.getElementsByTagNameAndClass("head")[0];if(!b){var a=c.getElementsByTagNameAndClass("body")[0];b=c.createDom("head");a.parentNode.insertBefore(b,a)}f=c.createDom("style");goog.style.setStyles(f,d);c.appendChild(b,f)}return f};goog.style.uninstallStyles=function(b){var a=b.ownerNode||b.owningElement||(b);goog.dom.removeNode(a)};goog.style.setStyles=function(a,b){if(goog.userAgent.IE&&goog.isDef(a.cssText)){a.cssText=b}else{a.innerHTML=b}};goog.style.setPreWrap=function(b){var a=b.style;if(goog.userAgent.IE&&!goog.userAgent.isVersionOrHigher("8")){a.whiteSpace="pre";a.wordWrap="break-word"}else{if(goog.userAgent.GECKO){a.whiteSpace="-moz-pre-wrap"}else{a.whiteSpace="pre-wrap"}}};goog.style.setInlineBlock=function(b){var a=b.style;a.position="relative";if(goog.userAgent.IE&&!goog.userAgent.isVersionOrHigher("8")){a.zoom="1";a.display="inline"}else{a.display="inline-block"}};goog.style.isRightToLeft=function(a){return"rtl"==goog.style.getStyle_(a,"direction")};goog.style.unselectableStyle_=goog.userAgent.GECKO?"MozUserSelect":goog.userAgent.WEBKIT?"WebkitUserSelect":null;goog.style.isUnselectable=function(a){if(goog.style.unselectableStyle_){return a.style[goog.style.unselectableStyle_].toLowerCase()=="none"}else{if(goog.userAgent.IE||goog.userAgent.OPERA){return a.getAttribute("unselectable")=="on"}}return false};goog.style.setUnselectable=function(e,c,g){var h=!g?e.getElementsByTagName("*"):null;var a=goog.style.unselectableStyle_;if(a){var f=c?"none":"";e.style[a]=f;if(h){for(var b=0,d;d=h[b];b++){d.style[a]=f}}}else{if(goog.userAgent.IE||goog.userAgent.OPERA){var f=c?"on":"";e.setAttribute("unselectable",f);if(h){for(var b=0,d;d=h[b];b++){d.setAttribute("unselectable",f)}}}}};goog.style.getBorderBoxSize=function(a){return new goog.math.Size(a.offsetWidth,a.offsetHeight)};goog.style.setBorderBoxSize=function(c,b){var f=goog.dom.getOwnerDocument(c);var g=goog.dom.getDomHelper(f).isCss1CompatMode();if(goog.userAgent.IE&&!goog.userAgent.isVersionOrHigher("10")&&(!g||!goog.userAgent.isVersionOrHigher("8"))){var d=c.style;if(g){var a=goog.style.getPaddingBox(c);var e=goog.style.getBorderBox(c);d.pixelWidth=b.width-e.left-a.left-a.right-e.right;d.pixelHeight=b.height-e.top-a.top-a.bottom-e.bottom}else{d.pixelWidth=b.width;d.pixelHeight=b.height}}else{goog.style.setBoxSizingSize_(c,b,"border-box")}};goog.style.getContentBoxSize=function(c){var g=goog.dom.getOwnerDocument(c);var e=goog.userAgent.IE&&c.currentStyle;if(e&&goog.dom.getDomHelper(g).isCss1CompatMode()&&e.width!="auto"&&e.height!="auto"&&!e.boxSizing){var d=goog.style.getIePixelValue_(c,e.width,"width","pixelWidth");var a=goog.style.getIePixelValue_(c,e.height,"height","pixelHeight");return new goog.math.Size(d,a)}else{var h=goog.style.getBorderBoxSize(c);var b=goog.style.getPaddingBox(c);var f=goog.style.getBorderBox(c);return new goog.math.Size(h.width-f.left-b.left-b.right-f.right,h.height-f.top-b.top-b.bottom-f.bottom)}};goog.style.setContentBoxSize=function(c,b){var f=goog.dom.getOwnerDocument(c);var g=goog.dom.getDomHelper(f).isCss1CompatMode();if(goog.userAgent.IE&&!goog.userAgent.isVersionOrHigher("10")&&(!g||!goog.userAgent.isVersionOrHigher("8"))){var d=c.style;if(g){d.pixelWidth=b.width;d.pixelHeight=b.height}else{var a=goog.style.getPaddingBox(c);var e=goog.style.getBorderBox(c);d.pixelWidth=b.width+e.left+a.left+a.right+e.right;d.pixelHeight=b.height+e.top+a.top+a.bottom+e.bottom}}else{goog.style.setBoxSizingSize_(c,b,"content-box")}};goog.style.setBoxSizingSize_=function(b,a,d){var c=b.style;if(goog.userAgent.GECKO){c.MozBoxSizing=d}else{if(goog.userAgent.WEBKIT){c.WebkitBoxSizing=d}else{c.boxSizing=d}}c.width=Math.max(a.width,0)+"px";c.height=Math.max(a.height,0)+"px"};goog.style.getIePixelValue_=function(e,f,d,b){if(/^\d+px?$/.test(f)){return parseInt(f,10)}else{var c=e.style[d];var g=e.runtimeStyle[d];e.runtimeStyle[d]=e.currentStyle[d];e.style[d]=f;var a=e.style[b];e.style[d]=c;e.runtimeStyle[d]=g;return a}};goog.style.getIePixelDistance_=function(a,c){var b=goog.style.getCascadedStyle(a,c);return b?goog.style.getIePixelValue_(a,b,"left","pixelLeft"):0};goog.style.getBox_=function(c,d){if(goog.userAgent.IE){var f=goog.style.getIePixelDistance_(c,d+"Left");var b=goog.style.getIePixelDistance_(c,d+"Right");var e=goog.style.getIePixelDistance_(c,d+"Top");var a=goog.style.getIePixelDistance_(c,d+"Bottom");return new goog.math.Box(e,b,a,f)}else{var f=(goog.style.getComputedStyle(c,d+"Left"));var b=(goog.style.getComputedStyle(c,d+"Right"));var e=(goog.style.getComputedStyle(c,d+"Top"));var a=(goog.style.getComputedStyle(c,d+"Bottom"));return new goog.math.Box(parseFloat(e),parseFloat(b),parseFloat(a),parseFloat(f))}};goog.style.getPaddingBox=function(a){return goog.style.getBox_(a,"padding")};goog.style.getMarginBox=function(a){return goog.style.getBox_(a,"margin")};goog.style.ieBorderWidthKeywords_={thin:2,medium:4,thick:6};goog.style.getIePixelBorder_=function(a,c){if(goog.style.getCascadedStyle(a,c+"Style")=="none"){return 0}var b=goog.style.getCascadedStyle(a,c+"Width");if(b in goog.style.ieBorderWidthKeywords_){return goog.style.ieBorderWidthKeywords_[b]}return goog.style.getIePixelValue_(a,b,"left","pixelLeft")};goog.style.getBorderBox=function(c){if(goog.userAgent.IE&&!goog.userAgent.isDocumentModeOrHigher(9)){var e=goog.style.getIePixelBorder_(c,"borderLeft");var b=goog.style.getIePixelBorder_(c,"borderRight");var d=goog.style.getIePixelBorder_(c,"borderTop");var a=goog.style.getIePixelBorder_(c,"borderBottom");return new goog.math.Box(d,b,a,e)}else{var e=(goog.style.getComputedStyle(c,"borderLeftWidth"));var b=(goog.style.getComputedStyle(c,"borderRightWidth"));var d=(goog.style.getComputedStyle(c,"borderTopWidth"));var a=(goog.style.getComputedStyle(c,"borderBottomWidth"));return new goog.math.Box(parseFloat(d),parseFloat(b),parseFloat(a),parseFloat(e))}};goog.style.getFontFamily=function(d){var g=goog.dom.getOwnerDocument(d);var c="";if(g.body.createTextRange&&goog.dom.contains(g,d)){var b=g.body.createTextRange();b.moveToElementText(d);try{c=b.queryCommandValue("FontName")}catch(f){c=""}}if(!c){c=goog.style.getStyle_(d,"fontFamily")}var a=c.split(",");if(a.length>1){c=a[0]}return goog.string.stripQuotes(c,"\"'")};goog.style.lengthUnitRegex_=/[^\d]+$/;goog.style.getLengthUnits=function(b){var a=b.match(goog.style.lengthUnitRegex_);return a&&a[0]||null};goog.style.ABSOLUTE_CSS_LENGTH_UNITS_={cm:1,"in":1,mm:1,pc:1,pt:1};goog.style.CONVERTIBLE_RELATIVE_CSS_UNITS_={em:1,ex:1};goog.style.getFontSize=function(c){var e=goog.style.getStyle_(c,"fontSize");var b=goog.style.getLengthUnits(e);if(e&&"px"==b){return parseInt(e,10)}if(goog.userAgent.IE){if(b in goog.style.ABSOLUTE_CSS_LENGTH_UNITS_){return goog.style.getIePixelValue_(c,e,"left","pixelLeft")}else{if(c.parentNode&&c.parentNode.nodeType==goog.dom.NodeType.ELEMENT&&b in goog.style.CONVERTIBLE_RELATIVE_CSS_UNITS_){var a=(c.parentNode);var f=goog.style.getStyle_(a,"fontSize");return goog.style.getIePixelValue_(a,e==f?"1em":e,"left","pixelLeft")}}}var d=goog.dom.createDom("span",{style:"visibility:hidden;position:absolute;line-height:0;padding:0;margin:0;border:0;height:1em;"});goog.dom.appendChild(c,d);e=d.offsetHeight;goog.dom.removeNode(d);return e};goog.style.parseStyleAttribute=function(b){var a={};goog.array.forEach(b.split(/\s*;\s*/),function(d){var c=d.split(/\s*:\s*/);if(c.length==2){a[goog.string.toCamelCase(c[0].toLowerCase())]=c[1]}});return a};goog.style.toStyleAttribute=function(b){var a=[];goog.object.forEach(b,function(d,c){a.push(goog.string.toSelectorCase(c),":",d,";")});return a.join("")};goog.style.setFloat=function(a,b){a.style[goog.userAgent.IE?"styleFloat":"cssFloat"]=b};goog.style.getFloat=function(a){return a.style[goog.userAgent.IE?"styleFloat":"cssFloat"]||""};goog.style.getScrollbarWidth=function(c){var d=goog.dom.createElement("div");if(c){d.className=c}d.style.cssText="overflow:auto;position:absolute;top:0;width:100px;height:100px";var b=goog.dom.createElement("div");goog.style.setSize(b,"200px","200px");d.appendChild(b);goog.dom.appendChild(goog.dom.getDocument().body,d);var a=d.offsetWidth-d.clientWidth;goog.dom.removeNode(d);return a};goog.style.MATRIX_TRANSLATION_REGEX_=new RegExp("matrix\\([0-9\\.\\-]+, [0-9\\.\\-]+, [0-9\\.\\-]+, [0-9\\.\\-]+, ([0-9\\.\\-]+)p?x?, ([0-9\\.\\-]+)p?x?\\)");goog.style.getCssTranslation=function(b){var a=goog.style.getComputedTransform(b);if(!a){return new goog.math.Coordinate(0,0)}var c=a.match(goog.style.MATRIX_TRANSLATION_REGEX_);if(!c){return new goog.math.Coordinate(0,0)}return new goog.math.Coordinate(parseFloat(c[1]),parseFloat(c[2]))};goog.provide("goog.async.DeferredList");goog.require("goog.async.Deferred");goog.async.DeferredList=function(h,c,f,b,a,g){goog.async.DeferredList.base(this,"constructor",a,g);this.list_=h;this.deferredResults_=[];this.fireOnOneCallback_=!!c;this.fireOnOneErrback_=!!f;this.consumeErrors_=!!b;this.numFinished_=0;for(var e=0;e<h.length;e++){var j=h[e];j.addCallbacks(goog.bind(this.handleCallback_,this,e,true),goog.bind(this.handleCallback_,this,e,false))}if(h.length==0&&!this.fireOnOneCallback_){this.callback(this.deferredResults_)}};goog.inherits(goog.async.DeferredList,goog.async.Deferred);goog.async.DeferredList.prototype.handleCallback_=function(b,c,a){this.numFinished_++;this.deferredResults_[b]=[c,a];if(!this.hasFired()){if(this.fireOnOneCallback_&&c){this.callback([b,a])}else{if(this.fireOnOneErrback_&&!c){this.errback(a)}else{if(this.numFinished_==this.list_.length){this.callback(this.deferredResults_)}}}}if(this.consumeErrors_&&!c){a=null}return a};goog.async.DeferredList.prototype.errback=function(b){goog.async.DeferredList.base(this,"errback",b);for(var a=0;a<this.list_.length;a++){this.list_[a].cancel()}};goog.async.DeferredList.gatherResults=function(a){return new goog.async.DeferredList(a,false,true).addCallback(function(d){var b=[];for(var c=0;c<d.length;c++){b[c]=d[c][1]}return b})};goog.provide("au.upldr.utils.fileUtils");goog.require("goog.async.Deferred");goog.require("goog.async.DeferredList");au.upldr.utils.fileUtils={arrayBufferToBlob:function(d,h){var e=window.BlobBuilder||window.WebKitBlobBuilder||window.MozBlobBuilder||window.MSBlobBuilder;var a=h||"image/jpeg";var c;var f=d.buffer;var b=d;if(window.Blob){c=new window.Blob([b.buffer],{type:a})}else{var g=new e();g.append(f);c=g.getBlob(a)}return c},canvasToBlob:function(a,f,d,b){f=f||1;d=d||"";b=b||"image/jpeg";try{if(a.mozGetAsFile&&f==1){return a.mozGetAsFile(d,b)}else{return au.upldr.utils.fileUtils.dataURItoBlob(a.toDataURL(b,f))}}catch(c){return new Blob()}},canvasToImageDef:function(c){var b=new goog.async.Deferred();if(c){var a=new Image();a.onload=function(){b.callback(this)};a.onerror=a.onabort=function(){b.callback(null)};a.src=c.toDataURL();b.addCallback(function(){a.onload=null;a.onerror=null;a.onabort=null})}else{b.callback(null)}return b},dataURItoBlob:function(c){if(!c){return null}var b=c.split(",")[1];var a=c.split(",")[0].split(":")[1].split(";")[0];return au.upldr.utils.fileUtils.base64ToBlob(b,a)},base64ToBlob:function(a,e){var f=window.atob(a);var d=new ArrayBuffer(f.length);var b=new Uint8Array(d);for(var c=0;c<f.length;c++){b[c]=f.charCodeAt(c)}return au.upldr.utils.fileUtils.arrayBufferToBlob(b,e)},blobToImgDef:function(b){var c;if(au.upldr.support.isBlobUrlSupported()){c=new goog.async.Deferred();c.callback(goog.fs.createObjectUrl(b))}else{c=au.upldr.utils.fileUtils.blobToDataUriDef(b)}var a=new goog.async.Deferred();c.addCallback(function(d){var e=new Image();a.addCallback(function(){e.onload=null;e.onerror=null;e.onabort=null});e.onload=function(){a.callback(this)};e.src=d});return a},blobToDataUriDef:function(c){var b=new goog.async.Deferred();var a=new FileReader();a.onload=function(d){b.callback(d.target.result)};a.onerror=function(){b.callback("")};a.readAsDataURL(c);b.addCallback(function(){a=null});return b},blobToDataView:function(c){var b=new goog.async.Deferred();var a=new FileReader();b.addCallback(function(){a=null});a.onload=function(d){b.callback(new DataView(d.target.result))};a.onerror=a.onabort=function(){b.callback(null)};a.readAsArrayBuffer(c);return b},getFilePart:function(b,c,a){c=typeof c=="undefined"?0:c;a=typeof a=="undefined"?b.size:a;switch(true){case !!b.webkitSlice:return b.webkitSlice(c,a);case !!b.mozSlice:return b.mozSlice(c,a);case !!b.slice:return b.slice(c,a);default:return b}}};goog.provide("au.upldr.upload.ExtendedFile");au.upldr.upload.ExtendedFile=function(b,c,a){this.file=b;this.name=a||b&&b.name||"";this.path=b&&b.webkitRelativePath?b.webkitRelativePath:""||c||"";this.size=b&&b.size||0;this.type=b&&b.type||"application/octet-stream"};au.upldr.upload.ExtendedFile.prototype.file=null;au.upldr.upload.ExtendedFile.prototype.path="";au.upldr.upload.ExtendedFile.prototype.name="";au.upldr.upload.ExtendedFile.prototype.size=0;au.upldr.upload.ExtendedFile.prototype.type="";goog.provide("goog.structs.InversionMap");goog.require("goog.array");goog.structs.InversionMap=function(c,b,a){this.rangeArray=null;if(c.length!=b.length){return null}this.storeInversion_(c,a);this.values=b};goog.structs.InversionMap.prototype.storeInversion_=function(c,b){this.rangeArray=c;for(var a=1;a<c.length;a++){if(c[a]==null){c[a]=c[a-1]+1}else{if(b){c[a]+=c[a-1]}}}};goog.structs.InversionMap.prototype.spliceInversion=function(a,h,i){var c=new goog.structs.InversionMap(a,h,i);var g=c.rangeArray[0];var b=(goog.array.peek(c.rangeArray));var d=this.getLeast(g);var e=this.getLeast(b);if(g!=this.rangeArray[d]){d++}var f=e-d+1;goog.partial(goog.array.splice,this.rangeArray,d,f).apply(null,c.rangeArray);goog.partial(goog.array.splice,this.values,d,f).apply(null,c.values)};goog.structs.InversionMap.prototype.at=function(a){var b=this.getLeast(a);if(b<0){return null}return this.values[b]};goog.structs.InversionMap.prototype.getLeast=function(c){var b=this.rangeArray;var a=0;var e=b.length;while(e-a>8){var d=(e+a)>>1;if(b[d]<=c){a=d}else{e=d}}for(;a<e;++a){if(c<b[a]){break}}return a-1};goog.provide("goog.i18n.GraphemeBreak");goog.require("goog.structs.InversionMap");goog.i18n.GraphemeBreak.property={ANY:0,CONTROL:1,EXTEND:2,PREPEND:3,SPACING_MARK:4,INDIC_CONSONANT:5,VIRAMA:6,L:7,V:8,T:9,LV:10,LVT:11,CR:12,LF:13,REGIONAL_INDICATOR:14};goog.i18n.GraphemeBreak.inversions_=null;goog.i18n.GraphemeBreak.applyLegacyBreakRules_=function(b,a){var c=goog.i18n.GraphemeBreak.property;if(b==c.CR&&a==c.LF){return false}if(b==c.CONTROL||b==c.CR||b==c.LF){return true}if(a==c.CONTROL||a==c.CR||a==c.LF){return true}if((b==c.L)&&(a==c.L||a==c.V||a==c.LV||a==c.LVT)){return false}if((b==c.LV||b==c.V)&&(a==c.V||a==c.T)){return false}if((b==c.LVT||b==c.T)&&(a==c.T)){return false}if(a==c.EXTEND||a==c.VIRAMA){return false}if(b==c.VIRAMA&&a==c.INDIC_CONSONANT){return false}return true};goog.i18n.GraphemeBreak.getBreakProp_=function(a){if(44032<=a&&a<=55203){var b=goog.i18n.GraphemeBreak.property;if(a%28==16){return b.LV}return b.LVT}else{if(!goog.i18n.GraphemeBreak.inversions_){goog.i18n.GraphemeBreak.inversions_=new goog.structs.InversionMap([0,10,1,2,1,18,95,33,13,1,594,112,275,7,263,45,1,1,1,2,1,2,1,1,56,5,11,11,48,21,16,1,101,7,1,1,6,2,2,1,4,33,1,1,1,30,27,91,11,58,9,34,4,1,9,1,3,1,5,43,3,136,31,1,17,37,1,1,1,1,3,8,4,1,2,1,7,8,2,2,21,8,1,2,17,39,1,1,1,2,6,6,1,9,5,4,2,2,12,2,15,2,1,17,39,2,3,12,4,8,6,17,2,3,14,1,17,39,1,1,3,8,4,1,20,2,29,1,2,17,39,1,1,2,1,6,6,9,6,4,2,2,13,1,16,1,18,41,1,1,1,12,1,9,1,41,3,17,37,4,3,5,7,8,3,2,8,2,30,2,17,39,1,1,1,1,2,1,3,1,5,1,8,9,1,3,2,30,2,17,38,3,1,2,5,7,1,9,1,10,2,30,2,22,48,5,1,2,6,7,19,2,13,46,2,1,1,1,6,1,12,8,50,46,2,1,1,1,9,11,6,14,2,58,2,27,1,1,1,1,1,4,2,49,14,1,4,1,1,2,5,48,9,1,57,33,12,4,1,6,1,2,2,2,1,16,2,4,2,2,4,3,1,3,2,7,3,4,13,1,1,1,2,6,1,1,14,1,98,96,72,88,349,3,931,15,2,1,14,15,2,1,14,15,2,15,15,14,35,17,2,1,7,8,1,2,9,1,1,9,1,45,3,155,1,87,31,3,4,2,9,1,6,3,20,19,29,44,9,3,2,1,69,23,2,3,4,45,6,2,1,1,1,8,1,1,1,2,8,6,13,128,4,1,14,33,1,1,5,1,1,5,1,1,1,7,31,9,12,2,1,7,23,1,4,2,2,2,2,2,11,3,2,36,2,1,1,2,3,1,1,3,2,12,36,8,8,2,2,21,3,128,3,1,13,1,7,4,1,4,2,1,203,64,523,1,2,2,24,7,49,16,96,33,3070,3,141,1,96,32,554,6,105,2,30164,4,1,10,33,1,80,2,272,1,3,1,4,1,23,2,2,1,24,30,4,4,3,8,1,1,13,2,16,34,16,1,27,18,24,24,4,8,2,23,11,1,1,12,32,3,1,5,3,3,36,1,2,4,2,1,3,1,69,35,6,2,2,2,2,12,1,8,1,1,18,16,1,3,6,1,5,48,1,1,3,2,2,5,2,1,1,32,9,1,2,2,5,1,1,201,14,2,1,1,9,8,2,1,2,1,2,1,1,1,18,11184,27,49,1028,1024,6942,1,737,16,16,7,216,1,158,2,89,3,513,1,2051,15,40,7,1,1472,1,1,1,53,14,1,57,2,1,45,3,4,2,1,1,2,1,66,3,36,5,1,6,2,75,2,1,48,3,9,1,1,1258,1,1,1,2,6,1,1,22681,62,4,25042,1,1,3,3,1,5,8,8,2,7,30,4,148,3,8097,26,790017,255],[1,13,1,12,1,0,1,0,1,0,2,0,2,0,2,0,2,0,2,0,2,0,2,0,1,0,2,0,2,0,2,0,2,1,0,2,0,2,0,2,0,1,0,2,0,2,0,2,0,2,0,2,0,2,0,2,0,2,0,2,0,2,4,0,5,2,4,2,0,4,2,4,6,4,0,2,5,0,2,0,5,2,4,0,5,2,0,2,4,2,4,6,0,2,5,0,2,0,5,0,2,4,0,5,2,4,2,6,2,5,0,2,0,2,4,0,5,2,0,4,2,4,6,0,2,0,2,4,0,5,2,0,2,4,2,4,6,2,5,0,2,0,5,0,2,0,5,2,4,2,4,6,0,2,0,4,0,5,0,2,4,2,6,2,5,0,2,0,4,0,5,2,0,4,2,4,2,4,2,4,2,6,2,5,0,2,0,4,0,5,0,2,4,2,4,6,0,2,0,2,0,4,0,5,6,2,4,2,4,2,4,0,5,0,2,0,4,2,6,0,2,0,5,0,2,0,4,2,0,2,0,5,0,2,0,2,0,2,0,2,0,4,5,2,4,2,6,0,2,0,2,0,2,0,5,0,2,4,2,0,6,4,2,5,0,5,0,4,2,5,2,5,0,5,0,5,2,5,2,0,4,2,0,2,5,0,2,0,7,8,9,0,2,0,5,2,6,0,5,2,6,0,5,2,0,5,2,5,0,2,4,2,4,2,4,2,6,2,0,2,0,2,0,2,0,5,2,4,2,4,2,4,2,0,5,0,5,0,4,0,4,0,5,2,4,0,5,0,5,4,2,4,2,6,0,2,0,2,4,2,0,2,4,0,5,2,4,2,4,2,4,2,4,6,5,0,2,0,2,4,0,5,4,2,4,2,6,4,5,0,5,0,5,0,2,4,2,4,2,4,2,6,0,5,4,2,4,2,0,5,0,2,0,2,4,2,0,2,0,4,2,0,2,0,1,2,1,0,1,0,1,0,2,0,2,0,6,0,2,0,2,0,2,0,2,0,2,0,2,0,2,0,2,0,6,5,2,5,4,2,4,0,5,0,5,0,5,0,5,0,4,0,5,4,6,0,2,0,5,0,2,0,5,2,4,6,0,7,2,4,0,5,0,5,2,4,2,4,2,4,6,0,5,2,4,2,4,2,0,2,0,2,4,0,5,0,5,0,5,0,5,2,0,2,0,2,0,2,0,2,0,5,4,2,4,0,4,6,0,5,0,5,0,5,0,4,2,4,2,4,0,4,6,0,11,8,9,0,2,0,2,0,2,0,2,0,1,0,2,0,1,0,2,0,2,0,2,6,0,4,2,4,0,2,6,0,2,4,0,4,2,4,6,2,0,1,0,2,0,2,4,2,6,0,2,4,0,4,2,4,6,0,2,4,2,4,2,6,2,0,4,2,0,2,4,2,0,4,2,1,2,0,2,0,2,0,2,0,14,0,1,2],true)}return(goog.i18n.GraphemeBreak.inversions_.at(a))}};goog.i18n.GraphemeBreak.hasGraphemeBreak=function(e,c,d){var g=goog.i18n.GraphemeBreak.getBreakProp_(e);var f=goog.i18n.GraphemeBreak.getBreakProp_(c);var h=goog.i18n.GraphemeBreak.property;return goog.i18n.GraphemeBreak.applyLegacyBreakRules_(g,f)&&!(d&&(g==h.PREPEND||f==h.SPACING_MARK))};goog.provide("goog.format");goog.require("goog.i18n.GraphemeBreak");goog.require("goog.string");goog.require("goog.userAgent");goog.format.fileSize=function(a,b){return goog.format.numBytesToString(a,b,false)};goog.format.isConvertableScaledNumber=function(a){return goog.format.SCALED_NUMERIC_RE_.test(a)};goog.format.stringToNumericValue=function(a){if(goog.string.endsWith(a,"B")){return goog.format.stringToNumericValue_(a,goog.format.NUMERIC_SCALES_BINARY_)}return goog.format.stringToNumericValue_(a,goog.format.NUMERIC_SCALES_SI_)};goog.format.stringToNumBytes=function(a){return goog.format.stringToNumericValue_(a,goog.format.NUMERIC_SCALES_BINARY_)};goog.format.numericValueToString=function(b,a){return goog.format.numericValueToString_(b,goog.format.NUMERIC_SCALES_SI_,a)};goog.format.numBytesToString=function(e,a,b,c){var d="";if(!goog.isDef(b)||b){d="B"}return goog.format.numericValueToString_(e,goog.format.NUMERIC_SCALES_BINARY_,a,d,c)};goog.format.stringToNumericValue_=function(a,c){var b=a.match(goog.format.SCALED_NUMERIC_RE_);if(!b){return NaN}var d=b[1]*c[b[2]];return d};goog.format.numericValueToString_=function(b,e,n,l,a){var g=goog.format.NUMERIC_SCALE_PREFIXES_;var j=b;var d="";var h="";var c=1;if(b<0){b=-b}for(var f=0;f<g.length;f++){var m=g[f];c=e[m];if(b>=c||(c<=1&&b>0.1*c)){d=m;break}}if(!d){c=1}else{if(l){d+=l}if(a){h=" "}}var k=Math.pow(10,goog.isDef(n)?n:2);return Math.round(j/c*k)/k+h+d};goog.format.SCALED_NUMERIC_RE_=/^([-]?\d+\.?\d*)([K,M,G,T,P,k,m,u,n]?)[B]?$/;goog.format.NUMERIC_SCALE_PREFIXES_=["P","T","G","M","K","","m","u","n"];goog.format.NUMERIC_SCALES_SI_={"":1,n:1e-9,u:0.000001,m:0.001,k:1000,K:1000,M:1000000,G:1000000000,T:1000000000000,P:1000000000000000};goog.format.NUMERIC_SCALES_BINARY_={"":1,n:Math.pow(1024,-3),u:Math.pow(1024,-2),m:1/1024,k:1024,K:1024,M:Math.pow(1024,2),G:Math.pow(1024,3),T:Math.pow(1024,4),P:Math.pow(1024,5)};goog.format.FIRST_GRAPHEME_EXTEND_=768;goog.format.isTreatedAsBreakingSpace_=function(a){return(a<=goog.format.WbrToken_.SPACE)||(a>=4096&&((a>=8192&&a<=8198)||(a>=8200&&a<=8203)||a==5760||a==6158||a==8232||a==8233||a==8287||a==12288))};goog.format.isInvisibleFormattingCharacter_=function(a){return(a>=8204&&a<=8207)||(a>=8234&&a<=8238)};goog.format.insertWordBreaksGeneric_=function(l,j,a){var g=a||10;if(g>l.length){return l}var c=[];var d=0;var k=0;var e=0;var m=0;for(var h=0;h<l.length;h++){var f=m;m=l.charCodeAt(h);var b=m>=goog.format.FIRST_GRAPHEME_EXTEND_&&!j(f,m,true);if(d>=g&&!goog.format.isTreatedAsBreakingSpace_(m)&&!b){c.push(l.substring(e,h),goog.format.WORD_BREAK_HTML);e=h;d=0}if(!k){if(m==goog.format.WbrToken_.LT||m==goog.format.WbrToken_.AMP){k=m}else{if(goog.format.isTreatedAsBreakingSpace_(m)){d=0}else{if(!goog.format.isInvisibleFormattingCharacter_(m)){d++}}}}else{if(m==goog.format.WbrToken_.GT&&k==goog.format.WbrToken_.LT){k=0}else{if(m==goog.format.WbrToken_.SEMI_COLON&&k==goog.format.WbrToken_.AMP){k=0;d++}}}}c.push(l.substr(e));return c.join("")};goog.format.insertWordBreaks=function(b,a){return goog.format.insertWordBreaksGeneric_(b,goog.i18n.GraphemeBreak.hasGraphemeBreak,a)};goog.format.conservativelyHasGraphemeBreak_=function(c,b,a){return b>=1024&&b<1315};goog.format.insertWordBreaksBasic=function(b,a){return goog.format.insertWordBreaksGeneric_(b,goog.format.conservativelyHasGraphemeBreak_,a)};goog.format.IS_IE8_OR_ABOVE_=goog.userAgent.IE&&goog.userAgent.isVersionOrHigher(8);goog.format.WORD_BREAK_HTML=goog.userAgent.WEBKIT?"<wbr></wbr>":goog.userAgent.OPERA?"&shy;":goog.format.IS_IE8_OR_ABOVE_?"&#8203;":"<wbr>";goog.format.WbrToken_={LT:60,GT:62,AMP:38,SEMI_COLON:59,SPACE:32};goog.provide("goog.dom.classlist");goog.require("goog.array");goog.define("goog.dom.classlist.ALWAYS_USE_DOM_TOKEN_LIST",false);goog.dom.classlist.get=function(a){if(goog.dom.classlist.ALWAYS_USE_DOM_TOKEN_LIST||a.classList){return a.classList}var b=a.className;return goog.isString(b)&&b.match(/\S+/g)||[]};goog.dom.classlist.set=function(a,b){a.className=b};goog.dom.classlist.contains=function(a,b){if(goog.dom.classlist.ALWAYS_USE_DOM_TOKEN_LIST||a.classList){return a.classList.contains(b)}return goog.array.contains(goog.dom.classlist.get(a),b)};goog.dom.classlist.add=function(a,b){if(goog.dom.classlist.ALWAYS_USE_DOM_TOKEN_LIST||a.classList){a.classList.add(b);return}if(!goog.dom.classlist.contains(a,b)){a.className+=a.className.length>0?(" "+b):b}};goog.dom.classlist.addAll=function(a,d){if(goog.dom.classlist.ALWAYS_USE_DOM_TOKEN_LIST||a.classList){goog.array.forEach(d,function(e){goog.dom.classlist.add(a,e)});return}var c={};goog.array.forEach(goog.dom.classlist.get(a),function(e){c[e]=true});goog.array.forEach(d,function(e){c[e]=true});a.className="";for(var b in c){a.className+=a.className.length>0?(" "+b):b}};goog.dom.classlist.remove=function(a,b){if(goog.dom.classlist.ALWAYS_USE_DOM_TOKEN_LIST||a.classList){a.classList.remove(b);return}if(goog.dom.classlist.contains(a,b)){a.className=goog.array.filter(goog.dom.classlist.get(a),function(d){return d!=b}).join(" ")}};goog.dom.classlist.removeAll=function(b,a){if(goog.dom.classlist.ALWAYS_USE_DOM_TOKEN_LIST||b.classList){goog.array.forEach(a,function(c){goog.dom.classlist.remove(b,c)});return}b.className=goog.array.filter(goog.dom.classlist.get(b),function(c){return !goog.array.contains(a,c)}).join(" ")};goog.dom.classlist.enable=function(b,c,a){if(a){goog.dom.classlist.add(b,c)}else{goog.dom.classlist.remove(b,c)}};goog.dom.classlist.enableAll=function(c,b,a){var d=a?goog.dom.classlist.addAll:goog.dom.classlist.removeAll;d(c,b)};goog.dom.classlist.swap=function(b,c,a){if(goog.dom.classlist.contains(b,c)){goog.dom.classlist.remove(b,c);goog.dom.classlist.add(b,a);return true}return false};goog.dom.classlist.toggle=function(a,b){var c=!goog.dom.classlist.contains(a,b);goog.dom.classlist.enable(a,b,c);return c};goog.dom.classlist.addRemove=function(b,a,c){goog.dom.classlist.remove(b,a);goog.dom.classlist.add(b,c)};goog.provide("au.upldr.events.EventType");goog.require("goog.events");au.upldr.events.EventType={INIT_FILE:goog.events.getUniqueId("init_file"),DND_FOLDER_FILE_LIMIT:goog.events.getUniqueId("dnd_folder_file_limit"),ADD_FILE:goog.events.getUniqueId("add_file"),PROPERTY_CHANGE:goog.events.getUniqueId("property_change"),COMPLETE:goog.events.getUniqueId("complete"),PROGRESS:"progress",ERROR:"error",BEFORE_UPLOAD:"beforeUpload",BEFORE_PACKAGE_UPLOAD:"beforePackageUpload",AFTER_PACKAGE_UPLOAD:"afterPackageUpload",AFTER_UPLOAD:"afterUpload",RESTRICTION_FAILED:"restrictionFailed",INIT_COMPLETE:"initComplete",TRACE:"trace",FILE_COUNT_CHANGE:"uploadFileCountChange",ADDING_FILES:"addingFiles",SELECTION_CHANGE:"selectionChange",UPLOAD_LIST_SCROLL:"uploadListScroll",UPLOAD_LIST_CHANGED:"uploadListChanged",IMAGE_EDITOR_CLOSE:"ImageEditorClose"};goog.provide("au.upldr.events.PropertyChangeEvent");goog.require("goog.events.Event");goog.require("au.upldr.events.EventType");au.upldr.events.PropertyChangeEvent=function(a,b,c){goog.base(this,au.upldr.events.EventType.PROPERTY_CHANGE);this.propertyName_=a;this.oldValue_=b;this.newValue_=c};goog.inherits(au.upldr.events.PropertyChangeEvent,goog.events.Event);au.upldr.events.PropertyChangeEvent.prototype.getPropertyName=function(){return this.propertyName_};au.upldr.events.PropertyChangeEvent.prototype.getOldValue=function(){return this.oldValue_};au.upldr.events.PropertyChangeEvent.prototype.getNewValue=function(){return this.newValue_};goog.provide("au.upldr.events.PropertyChangeTarget");goog.require("goog.events.EventTarget");goog.require("au.upldr.events.PropertyChangeEvent");au.upldr.events.PropertyChangeTarget=function(){goog.base(this);this.handler_=new goog.events.EventHandler(this);this.valueStorage_={}};goog.inherits(au.upldr.events.PropertyChangeTarget,goog.events.EventTarget);au.upldr.events.PropertyChangeTarget.prototype.getPropertyInternal=function(b,a){try{return b in this.valueStorage_?this.valueStorage_[b]:a}catch(c){window.console.error(c.stack)}};au.upldr.events.PropertyChangeTarget.prototype.setPropertyInternal=function(b,d,a){var e=this.valueStorage_;if(e){var c=!a&&e[b];e[b]=d;if(!a&&c!=d){this.dispactPropertyChanged(b,c,d)}}};au.upldr.events.PropertyChangeTarget.prototype.dispactPropertyChanged=function(b,c,d){var a=new au.upldr.events.PropertyChangeEvent(b,c,d);try{this.dispatchEvent(a)}catch(f){}};au.upldr.events.PropertyChangeTarget.prototype.getHandlerInternal=function(){return this.handler_};au.upldr.events.PropertyChangeTarget.prototype.observe=function(a){this.handler_.listen(this,au.upldr.events.EventType.PROPERTY_CHANGE,a)};au.upldr.events.PropertyChangeTarget.prototype.unobserve=function(a){this.handler_.unlisten(this,au.upldr.events.EventType.PROPERTY_CHANGE,a)};au.upldr.events.PropertyChangeTarget.prototype.disposeInternal=function(){goog.base(this,"disposeInternal");delete this.valueStorage_;this.handler_.dispose();delete this.handler_};goog.provide("au.upldr.ui.ClassNames");goog.provide("au.upldr.ui.ClassNamesCompat");goog.provide("au.upldr.ui.ClassNamesImaging");au.upldr.ui.classPrefix="au-upldr-";au.upldr.ui.ClassNames={BUTTON_LIST_ITEM:au.upldr.ui.classPrefix+"button-list-item",CSS3_TOOLBAR_BUTTON:au.upldr.ui.classPrefix+"css3-toolbar-button",DESCRIPTION_EDITOR:au.upldr.ui.classPrefix+"description-editor",ICON_LIST_ITEM:au.upldr.ui.classPrefix+"icon-list-item",BUTTON:au.upldr.ui.classPrefix+"button",REMOVE_BUTTON:au.upldr.ui.classPrefix+"icon remove",EDIT_DESCRIPTION_BUTTON:au.upldr.ui.classPrefix+"icon add-desc",ROTATE_BUTTON:au.upldr.ui.classPrefix+"icon rotate",IMAGE_PREVIEW:au.upldr.ui.classPrefix+"image-preview",INFORMATION_BAR:au.upldr.ui.classPrefix+"information-bar",INFORMATION_BAR_COLLAPSED:au.upldr.ui.classPrefix+"information-bar-collapsed",LABEL:au.upldr.ui.classPrefix+"label",LIST_ITEM:au.upldr.ui.classPrefix+"list-item",DESCRIPTION_ICON:au.upldr.ui.classPrefix+"icon with-desc",PREVIEW:au.upldr.ui.classPrefix+"preview",FILE_PREVIEW:au.upldr.ui.classPrefix+"icon generic-file",IMAGE_FILE_PREVIEW:au.upldr.ui.classPrefix+"icon image-file",ITEM_CONTENT:au.upldr.ui.classPrefix+"item-content",LIST:au.upldr.ui.classPrefix+"list",PROGRESS_DIALOG:au.upldr.ui.classPrefix+"progress-dialog",IMAGE_EDIT_DIALOG:au.upldr.ui.classPrefix+"image-edit-dialog noselect",CROP_AREA:au.upldr.ui.classPrefix+"crop-area",DRAW_AREA:au.upldr.ui.classPrefix+"draw-area",IMAGE_EDITOR:au.upldr.ui.classPrefix+"image-editor",AJAX_LOADER:au.upldr.ui.classPrefix+"ajax-loader",STATUS_PANE:au.upldr.ui.classPrefix+"status-pane",THUMBNAIL_LIST_ITEM:au.upldr.ui.classPrefix+"thumbnail-list-item",TOOLBAR_OUTER:au.upldr.ui.classPrefix+"toolbar-outer",TILE_LIST_ITEM:au.upldr.ui.classPrefix+"tile-list-item",FILE_NAME:au.upldr.ui.classPrefix+"filename",FILE_SIZE:au.upldr.ui.classPrefix+"filesize",TOP_PANE:au.upldr.ui.classPrefix+"top-pane",TITLE:au.upldr.ui.classPrefix+"title",CHANGE_VIEW:au.upldr.ui.classPrefix+"change-view",UPLOADER:au.upldr.ui.classPrefix+"uploader",UPLOAD_PANE:au.upldr.ui.classPrefix+"upload-pane",BACKGROUND_EMPTY:au.upldr.ui.classPrefix+"empty-background",CANVAS_EMPTY:au.upldr.ui.classPrefix+"empty-canvas",BRUSH_BUTTON:au.upldr.ui.classPrefix+"icon brush",CROP_AREA_BUTTON:au.upldr.ui.classPrefix+"icon crop-area",CROP_APPLY_BUTTON:au.upldr.ui.classPrefix+"icon crop-apply",ERASER_BUTTON:au.upldr.ui.classPrefix+"icon eraser",PALETTE_BUTTON:au.upldr.ui.classPrefix+"icon palette",PALETTE_BUTTON_COLOR:au.upldr.ui.classPrefix+"icon palette-color",CLEAN_BUTTON:au.upldr.ui.classPrefix+"icon clean",DRAWING_WIDTH_BUTTON:au.upldr.ui.classPrefix+"icon line-width",DRAWING_WIDTH_MENU_ITEM:au.upldr.ui.classPrefix+"drawing-width-menuItem",CLOSE:au.upldr.ui.classPrefix+"icon close"};au.upldr.ui.guidLIne=au.upldr.ui.classPrefix+"imgareaselect-guide-line ";au.upldr.ui.handle=au.upldr.ui.classPrefix+"imgareaselect-handle ";au.upldr.ui.ClassNamesImaging={GUID_LINE:au.upldr.ui.guidLIne,GUID_LINE_HORIZONTAL_ONE:au.upldr.ui.guidLIne+au.upldr.ui.classPrefix+"imgareaselect-horizontal1",GUID_LINE_HORIZONTAL_TWO:au.upldr.ui.guidLIne+au.upldr.ui.classPrefix+"imgareaselect-horizontal2",GUID_LINE_VERTICAL_ONE:au.upldr.ui.guidLIne+au.upldr.ui.classPrefix+"imgareaselect-vertical1",GUID_LINE_VERTICAL_TWO:au.upldr.ui.guidLIne+au.upldr.ui.classPrefix+"imgareaselect-vertical2",GUID_LINE_TOP:au.upldr.ui.guidLIne+au.upldr.ui.classPrefix+"imgareaselect-top",GUID_LINE_BOTTOM:au.upldr.ui.guidLIne+au.upldr.ui.classPrefix+"imgareaselect-bottom",GUID_LINE_LEFT:au.upldr.ui.guidLIne+au.upldr.ui.classPrefix+"imgareaselect-left",GUID_LINE_RIGHT:au.upldr.ui.guidLIne+au.upldr.ui.classPrefix+"imgareaselect-right",HANDLE:au.upldr.ui.handle,HANDLE_TOP_LEFT:au.upldr.ui.handle+au.upldr.ui.classPrefix+"imgareaselect-top-left",HANDLE_TOP_CENTER:au.upldr.ui.handle+au.upldr.ui.classPrefix+"imgareaselect-top-center",HANDLE_TOP_RIGHT:au.upldr.ui.handle+au.upldr.ui.classPrefix+"imgareaselect-top-right",HANDLE_BOTTOM_LEFT:au.upldr.ui.handle+au.upldr.ui.classPrefix+"imgareaselect-bottom-left",HANDLE_BOTTOM_CENTER:au.upldr.ui.handle+au.upldr.ui.classPrefix+"imgareaselect-bottom-center",HANDLE_BOTTOM_RIGHT:au.upldr.ui.handle+au.upldr.ui.classPrefix+"imgareaselect-bottom-right",HANDLE_LEFT_CENTER:au.upldr.ui.handle+au.upldr.ui.classPrefix+"imgareaselect-left-center",HANDLE_RIGHT_CENTER:au.upldr.ui.handle+au.upldr.ui.classPrefix+"imgareaselect-right-center",CANVAS:au.upldr.ui.classPrefix+"imgareaselect-canvas",CANVAS_AREA:au.upldr.ui.classPrefix+"imgareaselect-canvas-area noselect",DRAWING_CANVAS:au.upldr.ui.classPrefix+"drawing-canvas",DRAWING_CANVAS_POINTER:au.upldr.ui.classPrefix+"drawing-canvas-pointer",BORDER:au.upldr.ui.classPrefix+"imgareaselect-border",TRUE_AREA:au.upldr.ui.classPrefix+"true-area"};au.upldr.ui.ClassNamesCompat={UPLOAD_PANE_BAR:"uploadPaneBar",STATUS_BAR:"statusBar",TITLE_TEXT:"titleText",PANEL_TEXT:"panelText",VIEW_COMBOBOX:"viewComboBox",UPLOAD_PANEL_OR_TEXT:"uploadPanelOrText",HTML_LINK:"htmlLink",STATUS_BAR_TEXT0:"statusBarText0",STATUS_BAR_TEXT1:"statusBarText1",PREVIEW_FILE_NAME_LABEL_TEXT:"previewFileNameLabelText",ADD_FILES_BUTTON:"addFilesButton "+au.upldr.ui.classPrefix+"icon add-file green_button",ADD_FILES_BUTTON_TEXT_CLASS:"addFilesButtonText",SEND_BUTTON:"sendButton "+au.upldr.ui.classPrefix+"icon start-upload green_button",SEND_BUTTON_TEXT_CLASS:"sendButtonText",REMOVE_ALL_BUTTON_CLASS:au.upldr.ui.classPrefix+"icon remove-all",CANCEL_BUTTON:"cancelButton "+au.upldr.ui.classPrefix+"icon cancel-upload",CANCEL_BUTTON_TEXT_CLASS:"cancelButtonText",TILE_LIST:"tileList",TILE_ITEM_FILE_NAME_TEXT:"tilesViewFileNameText",TILE_ITEM_PARAM_TEXT:"tilesViewParamText",ICON_ITEM_FILE_NAME_TEXT:"iconsViewFileNameText",ICONS_BAR:"iconsBar",INFORMATION_BAR:"informationBar",INFORMATION_BAR_TEXT:"informationBarText",INFORMATION_BAR_CLOSE_BUTTON:"informationBarCloseButton",DESCRIPTION_EDITOR_WINDOW:"descriptionEditorWindow",DESCRIPTION_EDITOR_TEXTBOX:"descriptionEditorTextBox",UPLOAD_PROGRESS_BAR:"uploadProgressBar",WAIT_WINDOW_PROGRESS_BAR:"waitWindowProgressBar",WAIT_WINDOW_PANEL:"waitWindowPanel"};goog.provide("au.upldr.exif.Exif");au.upldr.exif.Exif=(function(){var t=false;var x=window.console||function(){};var g=window.atob;var h={};var z={36864:"ExifVersion",40960:"FlashpixVersion",40961:"ColorSpace",40962:"PixelXDimension",40963:"PixelYDimension",37121:"ComponentsConfiguration",37122:"CompressedBitsPerPixel",37500:"MakerNote",37510:"UserComment",40964:"RelatedSoundFile",36867:"DateTimeOriginal",36868:"DateTimeDigitized",37520:"SubsecTime",37521:"SubsecTimeOriginal",37522:"SubsecTimeDigitized",33434:"ExposureTime",33437:"FNumber",34850:"ExposureProgram",34852:"SpectralSensitivity",34855:"ISOSpeedRatings",34856:"OECF",37377:"ShutterSpeedValue",37378:"ApertureValue",37379:"BrightnessValue",37380:"ExposureBias",37381:"MaxApertureValue",37382:"SubjectDistance",37383:"MeteringMode",37384:"LightSource",37385:"Flash",37396:"SubjectArea",37386:"FocalLength",41483:"FlashEnergy",41484:"SpatialFrequencyResponse",41486:"FocalPlaneXResolution",41487:"FocalPlaneYResolution",41488:"FocalPlaneResolutionUnit",41492:"SubjectLocation",41493:"ExposureIndex",41495:"SensingMethod",41728:"FileSource",41729:"SceneType",41730:"CFAPattern",41985:"CustomRendered",41986:"ExposureMode",41987:"WhiteBalance",41988:"DigitalZoomRation",41989:"FocalLengthIn35mmFilm",41990:"SceneCaptureType",41991:"GainControl",41992:"Contrast",41993:"Saturation",41994:"Sharpness",41995:"DeviceSettingDescription",41996:"SubjectDistanceRange",40965:"InteroperabilityIFDPointer",42016:"ImageUniqueID"};var C={256:"ImageWidth",257:"ImageHeight",34665:"ExifIFDPointer",34853:"GPSInfoIFDPointer",40965:"InteroperabilityIFDPointer",258:"BitsPerSample",259:"Compression",262:"PhotometricInterpretation",274:"Orientation",277:"SamplesPerPixel",284:"PlanarConfiguration",530:"YCbCrSubSampling",531:"YCbCrPositioning",282:"XResolution",283:"YResolution",296:"ResolutionUnit",273:"StripOffsets",278:"RowsPerStrip",279:"StripByteCounts",513:"JPEGInterchangeFormat",514:"JPEGInterchangeFormatLength",301:"TransferFunction",318:"WhitePoint",319:"PrimaryChromaticities",529:"YCbCrCoefficients",532:"ReferenceBlackWhite",306:"DateTime",270:"ImageDescription",271:"Make",272:"Model",305:"Software",315:"Artist",33432:"Copyright"};var s={0:"GPSVersionID",1:"GPSLatitudeRef",2:"GPSLatitude",3:"GPSLongitudeRef",4:"GPSLongitude",5:"GPSAltitudeRef",6:"GPSAltitude",7:"GPSTimeStamp",8:"GPSSatellites",9:"GPSStatus",10:"GPSMeasureMode",11:"GPSDOP",12:"GPSSpeedRef",13:"GPSSpeed",14:"GPSTrackRef",15:"GPSTrack",16:"GPSImgDirectionRef",17:"GPSImgDirection",18:"GPSMapDatum",19:"GPSDestLatitudeRef",20:"GPSDestLatitude",21:"GPSDestLongitudeRef",22:"GPSDestLongitude",23:"GPSDestBearingRef",24:"GPSDestBearing",25:"GPSDestDistanceRef",26:"GPSDestDistance",27:"GPSProcessingMethod",28:"GPSAreaInformation",29:"GPSDateStamp",30:"GPSDifferential"};var o={ExposureProgram:{0:"Not defined",1:"Manual",2:"Normal program",3:"Aperture priority",4:"Shutter priority",5:"Creative program",6:"Action program",7:"Portrait mode",8:"Landscape mode"},MeteringMode:{0:"Unknown",1:"Average",2:"CenterWeightedAverage",3:"Spot",4:"MultiSpot",5:"Pattern",6:"Partial",255:"Other"},LightSource:{0:"Unknown",1:"Daylight",2:"Fluorescent",3:"Tungsten (incandescent light)",4:"Flash",9:"Fine weather",10:"Cloudy weather",11:"Shade",12:"Daylight fluorescent (D 5700 - 7100K)",13:"Day white fluorescent (N 4600 - 5400K)",14:"Cool white fluorescent (W 3900 - 4500K)",15:"White fluorescent (WW 3200 - 3700K)",17:"Standard light A",18:"Standard light B",19:"Standard light C",20:"D55",21:"D65",22:"D75",23:"D50",24:"ISO studio tungsten",255:"Other"},Flash:{0:"Flash did not fire",1:"Flash fired",5:"Strobe return light not detected",7:"Strobe return light detected",9:"Flash fired, compulsory flash mode",13:"Flash fired, compulsory flash mode, return light not detected",15:"Flash fired, compulsory flash mode, return light detected",16:"Flash did not fire, compulsory flash mode",24:"Flash did not fire, auto mode",25:"Flash fired, auto mode",29:"Flash fired, auto mode, return light not detected",31:"Flash fired, auto mode, return light detected",32:"No flash function",65:"Flash fired, red-eye reduction mode",69:"Flash fired, red-eye reduction mode, return light not detected",71:"Flash fired, red-eye reduction mode, return light detected",73:"Flash fired, compulsory flash mode, red-eye reduction mode",77:"Flash fired, compulsory flash mode, red-eye reduction mode, return light not detected",79:"Flash fired, compulsory flash mode, red-eye reduction mode, return light detected",89:"Flash fired, auto mode, red-eye reduction mode",93:"Flash fired, auto mode, return light not detected, red-eye reduction mode",95:"Flash fired, auto mode, return light detected, red-eye reduction mode"},SensingMethod:{1:"Not defined",2:"One-chip color area sensor",3:"Two-chip color area sensor",4:"Three-chip color area sensor",5:"Color sequential area sensor",7:"Trilinear sensor",8:"Color sequential linear sensor"},SceneCaptureType:{0:"Standard",1:"Landscape",2:"Portrait",3:"Night scene"},SceneType:{1:"Directly photographed"},CustomRendered:{0:"Normal process",1:"Custom process"},WhiteBalance:{0:"Auto white balance",1:"Manual white balance"},GainControl:{0:"None",1:"Low gain up",2:"High gain up",3:"Low gain down",4:"High gain down"},Contrast:{0:"Normal",1:"Soft",2:"Hard"},Saturation:{0:"Normal",1:"Low saturation",2:"High saturation"},Sharpness:{0:"Normal",1:"Soft",2:"Hard"},SubjectDistanceRange:{0:"Unknown",1:"Macro",2:"Close view",3:"Distant view"},FileSource:{3:"DSC"},Components:{0:"",1:"Y",2:"Cb",3:"Cr",4:"R",5:"G",6:"B"}};function v(E,G,F){if(E.addEventListener){E.addEventListener(G,F,false)}else{if(E.attachEvent){E.attachEvent("on"+G,F)}}}function m(E){return !!(E.exifdata)}function f(H,K){K=K||H.match(/^data\:([^\;]+)\;base64,/mi)[1]||"";H=H.replace(/^data\:([^\;]+)\;base64,/gmi,"");var J=g(H);var E=J.length;var G=new ArrayBuffer(E);var F=new Uint8Array(G);for(var I=0;I<E;I++){F[I]=J.charCodeAt(I)}return G}function A(F,G){var E=new XMLHttpRequest();E.open("GET",F,true);E.responseType="blob";E.onload=function(H){if(this.status==200||this.status===0){G(this.response)}};E.send()}function b(F,G){h.exifMetaObject={};var E=k(F);h.exifdata=E||{};if(G){G.call(h)}}function k(H){if(t){x.log("Got file of length "+H.byteLength)}if((H.getUint8(0)!=255)||(H.getUint8(1)!=216)){if(t){x.log("Not a valid JPEG")}return false}var G=2,F=H.byteLength,E;while(G<F){if(H.getUint8(G)!=255){if(t){x.log("Not a valid marker at offset "+G+", found: "+H.getUint8(G))}return false}E=H.getUint8(G+1);if(t){x.log(E)}if(E==225){if(t){x.log("Found 0xFFE1 marker")}return y(H,G+4,H.getUint16(G+2)-2)}else{G+=2+H.getUint16(G+2)}}}function i(K){if(t){x.log("Got file of length "+K.byteLength)}if((K.getUint8(0)!=255)||(K.getUint8(1)!=216)){if(t){x.log("Not a valid JPEG")}return false}var J=2,I=K.byteLength;var F=function(M,L){return(M.getUint8(L)===56&&M.getUint8(L+1)===66&&M.getUint8(L+2)===73&&M.getUint8(L+3)===77&&M.getUint8(L+4)===4&&M.getUint8(L+5)===4)};while(J<I){if(F(K,J)){var H=K.getUint8(J+7);if(H%2!==0){H+=1}if(H===0){H=4}var E=J+8+H;var G=K.getUint16(J+6+H);return B(K,E,G);break}J++}}var a={120:"caption",110:"credit",25:"keywords",55:"dateCreated",80:"byline",85:"bylineTitle",122:"captionWriter",105:"headline",116:"copyright",15:"category"};function B(L,K,J){var I={};var F,N,E,M,G;var H=K;while(H<K+J){if(L.getUint8(H)===28&&L.getUint8(H+1)===2){M=L.getUint8(H+2);if(M in a){E=L.getInt16(H+3);G=E+5;N=a[M];F=u(L,H+5,E);if(I.hasOwnProperty(N)){if(I[N] instanceof Array){I[N].push(F)}else{I[N]=[I[N],F]}}else{I[N]=F}}}H++}return I}function w(E,K,M,J,G){var H=E.getUint16(M,!G),N={},I,L,F;for(F=0;F<H;F++){I=M+F*12+2;L=J[E.getUint16(I,!G)];if(!L&&t){x.log("Unknown tag: "+E.getUint16(I,!G))}N[L]=r(E,I,K,M,G);h.exifMetaObject[L]={value:N[L],entryOffset:I,tiffStart:K,dirStart:M,bigEnd:G}}return N}function r(J,N,Q,R,L){var M=J.getUint16(N+2,!L),P=J.getUint32(N+4,!L),F=J.getUint32(N+8,!L)+Q,K,O,I,H,E,G;switch(M){case 1:case 7:if(P==1){return J.getUint8(N+8,!L)}else{K=P>4?F:(N+8);O=[];for(H=0;H<P;H++){O[H]=J.getUint8(K+H)}return O}case 2:K=P>4?F:(N+8);return u(J,K,P-1);case 3:if(P==1){return J.getUint16(N+8,!L)}else{K=P>2?F:(N+8);O=[];for(H=0;H<P;H++){O[H]=J.getUint16(K+2*H,!L)}return O}case 4:if(P==1){return J.getUint32(N+8,!L)}else{O=[];for(H=0;H<P;H++){O[H]=J.getUint32(F+4*H,!L)}return O}case 5:if(P==1){E=J.getUint32(F,!L);G=J.getUint32(F+4,!L);I=new Number(E/G);I.numerator=E;I.denominator=G;return I}else{O=[];for(H=0;H<P;H++){E=J.getUint32(F+8*H,!L);G=J.getUint32(F+4+8*H,!L);O[H]=new Number(E/G);O[H].numerator=E;O[H].denominator=G}return O}case 9:if(P==1){return J.getInt32(N+8,!L)}else{O=[];for(H=0;H<P;H++){O[H]=J.getInt32(F+4*H,!L)}return O}case 10:if(P==1){return J.getInt32(F,!L)/J.getInt32(F+4,!L)}else{O=[];for(H=0;H<P;H++){O[H]=J.getInt32(F+8*H,!L)/J.getInt32(F+4+8*H,!L)}return O}}}function d(L,F,J,M,N,H){var I=F.getUint16(J+2,!H),K=F.getUint32(J+4,!H),E=F.getUint32(J+8,!H)+M,G;switch(I){case 1:case 7:if(K==1){F.setUint8(J+8,L,!H)}break;case 2:G=K>4?E:(J+8);D(F,L,G,!H);break;case 3:if(K==1){F.setUint16(J+8,L,!H)}break;case 4:if(K==1){F.setUint32(J+8,L,!H)}break;case 9:if(K==1){F.setInt32(J+8,L,!H)}break}return F}function u(F,I,G){var E="";for(var H=I;H<I+G;H++){E+=String.fromCharCode(F.getUint8(H))}return E}function q(I){var F=new ArrayBuffer(I.length*2);var E=new Uint16Array(F);for(var G=0,H=I.length;G<H;G++){E[G]=I.charCodeAt(G)}return F}function D(F,K,J,I){var E=q(K);for(var G=0,H=E.length;G<H;G++){F.setUint8(J+G,E.getUint8(G),I)}}function y(I,F,J){if(u(I,F,4)!="Exif"){if(t){x.log("Not valid EXIF data! "+u(I,F,4))}return false}var K,M,N,H,G,L=F+6;if(I.getUint16(L)==18761){K=false}else{if(I.getUint16(L)==19789){K=true}else{if(t){x.log("Not valid TIFF data! (no 0x4949 or 0x4D4D)")}return false}}if(I.getUint16(L+2,!K)!=42){if(t){x.log("Not valid TIFF data! (no 0x002A)")}return false}var E=I.getUint32(L+4,!K);if(E<8){if(t){x.log("Not valid TIFF data! (First offset less than 8)",I.getUint32(L+4,!K))}return false}M=w(I,L,L+E,C,K);if(M.ExifIFDPointer){H=w(I,L,L+M.ExifIFDPointer,z,K);for(N in H){switch(N){case"LightSource":case"Flash":case"MeteringMode":case"ExposureProgram":case"SensingMethod":case"SceneCaptureType":case"SceneType":case"CustomRendered":case"WhiteBalance":case"GainControl":case"Contrast":case"Saturation":case"Sharpness":case"SubjectDistanceRange":case"FileSource":H[N]=o[N][H[N]];break;case"ExifVersion":case"FlashpixVersion":H[N]=String.fromCharCode(H[N][0],H[N][1],H[N][2],H[N][3]);break;case"ComponentsConfiguration":H[N]=o.Components[H[N][0]]+o.Components[H[N][1]]+o.Components[H[N][2]]+o.Components[H[N][3]];break}M[N]=H[N]}}if(M.GPSInfoIFDPointer){G=w(I,L,L+M.GPSInfoIFDPointer,s,K);for(N in G){switch(N){case"GPSVersionID":G[N]=G[N][0]+"."+G[N][1]+"."+G[N][2]+"."+G[N][3];break}M[N]=G[N]}}return M}function n(E,F){b(E,F);return true}function l(F,E){if(!m(F)){return}return F.exifdata[E]}function c(F){if(!m(F)){return{}}var E,H=F.exifdata,G={};for(E in H){if(H.hasOwnProperty(E)){G[E]=H[E]}}return G}function e(F){if(!m(F)){return""}var E,H=F.exifdata,G="";for(E in H){if(H.hasOwnProperty(E)){if(typeof H[E]=="object"){if(H[E] instanceof Number){G+=E+" : "+H[E]+" ["+H[E].numerator+"/"+H[E].denominator+"]\r\n"}else{G+=E+" : ["+H[E].length+" values]\r\n"}}else{G+=E+" : "+H[E]+"\r\n"}}}return G}function j(E){return k(E)}return{readFromBinaryFile:j,pretty:e,getTag:l,getAllTags:c,getData:n,writeTagValue:d,Tags:z,TiffTags:C,GPSTags:s,StringValues:o}})();goog.provide("au.upldr.exif.ExifIO");goog.require("goog.async.Deferred");goog.require("goog.events.EventTarget");goog.require("au.upldr.exif.Exif");goog.require("au.upldr.utils.fileUtils");goog.scope(function(){au.upldr.exif.ExifIO=function(b){goog.base(this);this._dataView=b;this._isRead=false;this._degrees=[0,0,0,180,0,0,90,0,270];this._exifData={};this._exifTagsMeta={}};goog.inherits(au.upldr.exif.ExifIO,goog.events.EventTarget);var a=au.upldr.exif.ExifIO;a.prototype.writeValuesDeferred=function(b){var f=this;var e=function(h){for(var i=0;i<b.length;i++){var j=b[i];if(h.hasOwnProperty(j.key)){var g=h[j.key];if(g.value!=j.value){g.value=j.value;au.upldr.exif.Exif.writeTagValue(j.value,f._dataView,g.entryOffset,g.tiffStart,g.dirStart,g.bigEnd)}}}return au.upldr.utils.fileUtils.arrayBufferToBlob(f._dataView)};var d=new goog.async.Deferred();if(!this._isRead){var c=this.readValuesDeferred();c.addCallback(function(){d.callback(e(f._exifTagsMeta))})}else{d.callback(e(f._exifTagsMeta))}return d};a.prototype.readValuesDeferred=function(){var c=this;var b=new goog.async.Deferred();if(c._isRead){b.callback(c._exifData)}else{var d=function(){c._exifData=this.exifdata;c._exifTagsMeta=this.exifMetaObject;c._isRead=true;b.callback(c._exifData)};au.upldr.exif.Exif.getData(this._dataView,d)}return b};a.prototype.getInstanceDeferred=function(){return this.wrapReadResultDeferred(this)};a.restoreFileExifDeferred=function(d,c){var g=au.upldr.utils.fileUtils.blobToDataUriDef(d);var e=au.upldr.utils.fileUtils.blobToDataUriDef(c);var b=new goog.async.Deferred();var f=new goog.async.DeferredList([g,e]);f.addCallback(function(j){var h=au.upldr.exif.ExifRestorer.restore(j[0][1],j[1][1]);var i=au.upldr.utils.fileUtils.dataURItoBlob(h);b.callback(i)});return b};a.prototype.getExifRotateAngleDeferred=function(){var b=this;var c=function(e){if(e.hasOwnProperty("Orientation")){var d=e.Orientation;if(d>0&&d<9&&b._degrees[d]!=0){return b._degrees[d]}else{return 0}}};return this.wrapReadResultDeferred(c)};a.prototype.stringlifyAndLowerExifTags=function(h){var d=({key:"",value:""});var f="";for(var e in h){if(h.hasOwnProperty(e)){f=e.toLowerCase();if(typeof h[e]=="object"){if(h[e] instanceof Number){d[f]=h[e].numerator+"/"+h[e].denominator}else{if(h[e] instanceof Array){var c=(h[e]);var g=[];for(var b=0;b<c.length;b++){if(c[b] instanceof Number){g.push(c[b].numerator+"/"+c[b].denominator)}else{g.push(c[b].toString())}}d[f]=g.join(" ")}}}else{d[f]=h[e]}}}return d};a.prototype.getExifTagsJsonDeferred=function(){var b=this;var c=function(d){return b.stringlifyAndLowerExifTags(d)};return this.wrapReadResultDeferred(c)};a.prototype.wrapReadResultDeferred=function(d){var c=new goog.async.Deferred();var b=this.readValuesDeferred();b.addCallback(function(f){var e;if(typeof d=="function"){e=d(f)}else{e=d}c.callback(e)});return c}});goog.provide("au.upldr.ItemHolder");goog.provide("au.upldr.ItemHolder.Properties");goog.provide("au.upldr.ItemHolder.State");goog.require("goog.dom");goog.require("goog.format");goog.require("goog.Disposable");goog.require("goog.dom.classlist");goog.require("goog.style");goog.require("goog.array");goog.require("au.upldr.events.PropertyChangeTarget");goog.require("au.upldr.image");goog.require("au.upldr.ui.ClassNames");goog.require("au.upldr.utils.fileUtils");goog.require("au.upldr.exif.ExifIO");goog.require("au.upldr.upload.ExtendedFile");goog.require("goog.async.Deferred");au.upldr.ItemHolder=function(a){goog.base(this);this.guid_="file_"+goog.getUid(this);this.file_=(a instanceof File||!a||a instanceof Blob)?new au.upldr.upload.ExtendedFile(a):a;this.tilePreview_=null;this.thumbnailPreview_=null;this._exifIODeferred=new goog.async.Deferred();this._exifParsed=false;this._isAutoRotated=false;this._canAutoRotate=false;this._isCanvasRotationObserved=false;this._cropBounds=null;this._drawingPoints=[];if(this.isImage()){this.setPropertyInternal(au.upldr.ItemHolder.Properties.STATE,au.upldr.ItemHolder.State.NEW,true);this.tilePreview_=(goog.dom.createElement("canvas"));this.thumbnailPreview_=(goog.dom.createElement("canvas"));goog.dom.classlist.addAll(this.tilePreview_,au.upldr.ui.ClassNames.CANVAS_EMPTY.replace(/\s+/," ").split(" "));goog.dom.classlist.addAll(this.thumbnailPreview_,au.upldr.ui.ClassNames.CANVAS_EMPTY.replace(/\s+/," ").split(" "))}else{this.setPropertyInternal(au.upldr.ItemHolder.Properties.STATE,au.upldr.ItemHolder.State.INITIALIZED,true)}this.setPropertyInternal(au.upldr.ItemHolder.Properties.IMAGE_WIDTH,0,true);this.setPropertyInternal(au.upldr.ItemHolder.Properties.IMAGE_HEIGHT,0,true);this.setPropertyInternal(au.upldr.ItemHolder.Properties.ANGLE,0,true);this.setPropertyInternal(au.upldr.ItemHolder.Properties.DESCRIPTION,"",true);this.setPropertyInternal(au.upldr.ItemHolder.Properties.CROP_BOUNDS,null,false);this.setPropertyInternal(au.upldr.ItemHolder.Properties.SELECTED,false,true)};goog.inherits(au.upldr.ItemHolder,au.upldr.events.PropertyChangeTarget);au.upldr.ItemHolder.Properties={IMAGE_WIDTH:"imageWidth",IMAGE_HEIGHT:"imageHeight",ANGLE:"angle",DESCRIPTION:"description",STATE:"state",SELECTED:"selected",TAG:"tag",CROP_BOUNDS:"cropBounds"};au.upldr.ItemHolder.State={NEW:0,LOADED:1,INITIALIZED:2};au.upldr.ItemHolder.prototype.getGuid=function(){return this.guid_};au.upldr.ItemHolder.prototype.onUpdate=function(a){a=a||function(){};var b=this.guid_;this.observe(function(c){a(b,c.getPropertyName())})};au.upldr.ItemHolder.prototype.onRotate=function(b){b=b||function(){};var a=this.guid_;this.observe(function(c){if(c.getPropertyName()==au.upldr.ItemHolder.Properties.ANGLE){b(a,this.getAngle())}})};au.upldr.ItemHolder.prototype.clearPreview=function(){if(this.isImage()){if(this.getState()==au.upldr.ItemHolder.State.LOADED){this.setState(au.upldr.ItemHolder.State.INITIALIZED)}if(this.tilePreview_&&this.tilePreview_.parentElement){goog.dom.classlist.removeAll(this.tilePreview_.parentElement,au.upldr.ui.ClassNames.BACKGROUND_EMPTY.replace(/\s+/," ").split(" "))}if(this.tilePreview_&&this.thumbnailPreview_.parentElement){goog.dom.classlist.removeAll(this.thumbnailPreview_.parentElement,au.upldr.ui.ClassNames.BACKGROUND_EMPTY.replace(/\s+/," ").split(" "))}var b=goog.dom.getDomHelper();var c=(goog.dom.createElement("canvas"));var a=(goog.dom.createElement("canvas"));goog.dom.classlist.addAll(c,au.upldr.ui.ClassNames.CANVAS_EMPTY.replace(/\s+/," ").split(" "));goog.dom.classlist.addAll(a,au.upldr.ui.ClassNames.CANVAS_EMPTY.replace(/\s+/," ").split(" "));if(this.tilePreview_){b.replaceNode(c,this.tilePreview_)}if(this.thumbnailPreview_){b.replaceNode(a,this.thumbnailPreview_)}this.tilePreview_=c;this.thumbnailPreview_=a;this.updateCanvasAngle()}};au.upldr.ItemHolder.prototype.updateCanvasAngle=function(){var a=this.getAngle()||0;if(this.tilePreview_){au.upldr.imaging.CanvasUtil.updateCanvasAngle(this.tilePreview_,a)}if(this.thumbnailPreview_){au.upldr.imaging.CanvasUtil.updateCanvasAngle(this.thumbnailPreview_,a)}};au.upldr.ItemHolder.prototype.getFile=function(){return(this.file_.file||null)};au.upldr.ItemHolder.prototype.getName=function(){return this.file_.name};au.upldr.ItemHolder.prototype.getNameWithPath=function(){return this.file_.path?this.file_.path:this.file_.name};au.upldr.ItemHolder.prototype.getSize=function(){return this.file_.size};au.upldr.ItemHolder.prototype.getFormattedSize=function(){return goog.format.numBytesToString(this.file_.size,0)};au.upldr.ItemHolder.prototype.getType=function(){return this.file_.type};au.upldr.ItemHolder.prototype.getTilePreview=function(){return this.tilePreview_};au.upldr.ItemHolder.prototype.getThumbnailPreview=function(){return this.thumbnailPreview_};au.upldr.ItemHolder.prototype.setTilePreview=function(a){if(this.tilePreview_&&this.tilePreview_.parentElement){this.tilePreview_.parentElement.replaceChild(a,this.tilePreview_)}this.tilePreview_=a;if(this.tilePreview_){au.upldr.imaging.CanvasUtil.updateCanvasAngle(this.tilePreview_,this.getAngle()||0)}};au.upldr.ItemHolder.prototype.setThumbnailPreview=function(a){if(this.thumbnailPreview_&&this.thumbnailPreview_.parentElement){this.thumbnailPreview_.parentElement.replaceChild(a,this.thumbnailPreview_)}this.thumbnailPreview_=a;if(this.thumbnailPreview_){au.upldr.imaging.CanvasUtil.updateCanvasAngle(this.thumbnailPreview_,this.getAngle()||0)}};au.upldr.ItemHolder.prototype.getImageWidth=function(){return(this.getPropertyInternal(au.upldr.ItemHolder.Properties.IMAGE_WIDTH))};au.upldr.ItemHolder.prototype.setImageWidth=function(a){this.setPropertyInternal(au.upldr.ItemHolder.Properties.IMAGE_WIDTH,a)};au.upldr.ItemHolder.prototype.getImageHeight=function(){return(this.getPropertyInternal(au.upldr.ItemHolder.Properties.IMAGE_HEIGHT))};au.upldr.ItemHolder.prototype.setImageHeight=function(a){this.setPropertyInternal(au.upldr.ItemHolder.Properties.IMAGE_HEIGHT,a)};au.upldr.ItemHolder.prototype.getAngle=function(){return(this.getPropertyInternal(au.upldr.ItemHolder.Properties.ANGLE))};au.upldr.ItemHolder.prototype.setAngle=function(a){if(!this.isImage()){return}a=this.normalizeAngle_(a);if(!isNaN(a)){this.setPropertyInternal(au.upldr.ItemHolder.Properties.ANGLE,a)}};au.upldr.ItemHolder.prototype.getDescription=function(){return(this.getPropertyInternal(au.upldr.ItemHolder.Properties.DESCRIPTION))};au.upldr.ItemHolder.prototype.setDescription=function(a){if(a!=null){this.setPropertyInternal(au.upldr.ItemHolder.Properties.DESCRIPTION,a)}};au.upldr.ItemHolder.prototype.getTag=function(){return(this.getPropertyInternal(au.upldr.ItemHolder.Properties.TAG))};au.upldr.ItemHolder.prototype.setTag=function(a){if(a!=null){this.setPropertyInternal(au.upldr.ItemHolder.Properties.TAG,a)}};au.upldr.ItemHolder.prototype.getState=function(){return(this.getPropertyInternal(au.upldr.ItemHolder.Properties.STATE))};au.upldr.ItemHolder.prototype.setState=function(a){if(a!=null){this.setPropertyInternal(au.upldr.ItemHolder.Properties.STATE,a)}};au.upldr.ItemHolder.prototype.setCanAutoRotate=function(a){this._canAutoRotate=a};au.upldr.ItemHolder.prototype.getCanAutoRotate=function(){return this._canAutoRotate};au.upldr.ItemHolder.prototype.updateAngleFromExif=function(){var a=this;var b=new goog.async.Deferred();if(a.isJpegImage()&&a._canAutoRotate&&!a._isAutoRotated){a.getExifIOInstanceDeferred().addCallback(function(c){if(c){c.getExifRotateAngleDeferred().addCallback(function(d){a.setAngle(d);a._isAutoRotated=true;a.updateCanvasAngle();b.callback(a)})}else{a.updateCanvasAngle();b.callback(a)}})}else{a.updateCanvasAngle();b.callback(a)}return b};au.upldr.ItemHolder.prototype.getExifIOInstanceDeferred=function(){if(this.isJpegImage()&&goog.isDefAndNotNull(this.getFile())&&this.getFile().size>0){if(!this._exifParsed){this._exifIODeferred=this._getExifIOInstanceDeferred();this._exifParsed=true}}else{if(!this._exifParsed){this._exifParsed=true;this._exifIODeferred.callback(null)}}return this._exifIODeferred};au.upldr.ItemHolder.prototype._getExifIOInstanceDeferred=function(){var a=au.upldr.utils.fileUtils.blobToDataView((this.getFile()));a.addCallback(function(b){var c=new au.upldr.exif.ExifIO(b);return c.getInstanceDeferred()});return a};au.upldr.ItemHolder.prototype.isImage=function(){return au.upldr.image.isImageType(this.getType())||au.upldr.image.isImageFile(this.getName())};au.upldr.ItemHolder.prototype.isJpegImage=function(){return au.upldr.image.isJpegImageType(this.getType())||au.upldr.image.isImageFile(this.getName())};au.upldr.ItemHolder.prototype.disposeInternal=function(){goog.base(this,"disposeInternal");this.file_=null;delete this.file_;goog.dom.removeNode(this.thumbnailPreview_);goog.dom.removeNode(this.tilePreview_);this.thumbnailPreview_=null;this.tilePreview_=null;delete this.thumbnailPreview_;delete this.tilePreview_;this._exifIODeferred.cancel(true);this._exifIODeferred=null;delete this._exifIODeferred};au.upldr.ItemHolder.prototype.normalizeAngle_=function(a){return au.upldr.utils.normalizeAngle(a)};au.upldr.ItemHolder.prototype.isSelected=function(){return(this.getPropertyInternal(au.upldr.ItemHolder.Properties.SELECTED))};au.upldr.ItemHolder.prototype.setSelected=function(a){if(typeof a!="undefined"){this.setPropertyInternal(au.upldr.ItemHolder.Properties.SELECTED,a)}};au.upldr.ItemHolder.prototype.getIconCssClass=function(c){c=typeof c!="undefined"?c:false;var b=au.upldr.ui.ClassNames.PREVIEW+" "+au.upldr.ui.ClassNames.FILE_PREVIEW;var d=this.getName()||"";var a=au.upldr.utils.getExt(d);if(a){b+="-"+a.toLowerCase()}if(this.isImage()){b+=" "+au.upldr.ui.ClassNames.IMAGE_FILE_PREVIEW}return c?b.replace(/\s+|^/g,"."):b};au.upldr.ItemHolder.prototype.getPreview=function(c,b,a){window.setTimeout(function(){if(this.isImage()){var e="";var d=au.upldr.image.PreviewGenerator.createDeferred(this,a,a,b);d.addCallback(function(g){if(g){var f=au.upldr.utils.fileUtils.canvasToImageDef(g);f.addCallback(function(h){h.id=e="image_"+this.getGuid();au.upldr.imaging.CanvasUtil.updateCanvasAngle(h,this.getAngle()||0);if(!this._isCanvasRotationObserved){this._isCanvasRotationObserved=true;this.onRotate(function(k,m){var j=document.querySelectorAll("#"+e);for(var l=0;l<j.length;l++){au.upldr.imaging.CanvasUtil.updateCanvasAngle(j[l],m)}}.bind(this))}c(h)}.bind(this))}else{c(null)}}.bind(this))}else{c(null)}}.bind(this),50)};au.upldr.ItemHolder.prototype.setDrawingPoints=function(a){this._drawingPoints=a};au.upldr.ItemHolder.prototype.getDrawingPoints=function(){return this._drawingPoints.slice(0)};au.upldr.ItemHolder.prototype.setCropBounds=function(a,b){b=(typeof b=="undefined"?false:b);this.setPropertyInternal(au.upldr.ItemHolder.Properties.CROP_BOUNDS,a,b)};au.upldr.ItemHolder.prototype.getCropBounds=function(b){var a=(this.getPropertyInternal(au.upldr.ItemHolder.Properties.CROP_BOUNDS));if(a){return new au.upldr.imaging.Bounds(a.top,a.left,a.width,a.height)}if(!!b){return new au.upldr.imaging.Bounds(0,0,this.getImageWidth(),this.getImageHeight())}return null};au.upldr.ItemHolder.prototype.cloneCanvas_=function(a){var c=(document.createElement("canvas"));var b=c.getContext("2d");c.width=a.width;c.height=a.height;b.drawImage(a,0,0);return c};au.upldr.ItemHolder.prototype.getThumbnailPreviewBase64_=function(){return(this.thumbnailPreview_.toDataURL(this.getType(),au.upldr.upload.Converter.defaultJpegQuality/au.upldr.upload.Converter.maxJpegQuality))};goog.provide("au.upldr.RestrictionVerifier");goog.provide("au.upldr.VerifyCode");goog.require("au.upldr.image");au.upldr.RestrictionVerifier=function(d,g,i,b,c,e,a,j,h,f){this.fileMask_=au.upldr.RestrictionVerifier.parseFileMask(d);this.deniedFileMask_=g;this.maxFileCount_=i||0;this.maxTotalFileSize_=b||0;this.maxFileSize_=c||0;this.minFileSize_=e||0;this.maxImageWidth_=a||0;this.minImageWidth_=j||0;this.maxImageHeight_=h||0;this.minImageHeight_=f||0};au.upldr.RestrictionVerifier.prototype.verifyFile=function(d,c,b){if(this.fileMask_&&!this.checkFileMask_(this.fileMask_,d.name)){return au.upldr.VerifyCode.FILE_MASK}else{if(this.deniedFileMask_&&this.checkFileMask_(this.deniedFileMask_,d.name)){return au.upldr.VerifyCode.FILE_MASK}else{if(this.maxFileSize_!=0&&d.size>this.maxFileSize_){return au.upldr.VerifyCode.MAX_FILE_SIZE}else{if(this.minFileSize_!=0&&d.size<this.minFileSize_){return au.upldr.VerifyCode.MIN_FILE_SIZE}else{if(this.maxFileCount_!=0&&c+1>this.maxFileCount_){return au.upldr.VerifyCode.MAX_FILE_COUNT}else{if(this.maxTotalFileSize_!=0&&b+d.size>this.maxTotalFileSize_){return au.upldr.VerifyCode.MAX_TOTAL_FILE_SIZE}else{var a=this.maxImageWidth_>0||this.minImageWidth_>0;a|=this.maxImageHeight_>0||this.minImageHeight_>0;a&=au.upldr.image.isImageType(d.type)||au.upldr.image.isImageFile(d.name);return a?au.upldr.VerifyCode.VERIFY_ASYNC:au.upldr.VerifyCode.VERIFIED}}}}}}};au.upldr.RestrictionVerifier.prototype.verifyFileAsync=function(c,b,a,e){var d=this.verifyFile(c,b,a);if(d==au.upldr.VerifyCode.VERIFY_ASYNC){au.upldr.image.getImageSize(c.file,goog.bind(function(g){var f;if(this.maxImageHeight_!=0&&g.height>this.maxImageHeight_){f=au.upldr.VerifyCode.MAX_IMAGE_HEIGHT}else{if(this.maxImageWidth_!=0&&g.width>this.maxImageWidth_){f=au.upldr.VerifyCode.MAX_IMAGE_WIDTH}else{if(this.minImageHeight_!=0&&g.height<this.minImageHeight_){f=au.upldr.VerifyCode.MIN_IMAGE_HEIGHT}else{if(this.minImageWidth_!=0&&g.width<this.minImageWidth_){f=au.upldr.VerifyCode.MIN_IMAGE_WIDTH}else{f=au.upldr.VerifyCode.VERIFIED}}}}e(f)},this))}else{au.upldr.utils.setTimeout(goog.partial(e,d),0)}};au.upldr.RestrictionVerifier.prototype.checkFileMask_=function(a,f){if(!a||!a.length){return true}a=a.replace(/([-()\[\]{}+.$\^|,:#<!\\])/g,"\\$1");var b="",e=a.split(";");for(var d=0,c=e.length;d<c;++d){if(e[d]){if(b){b+="|"}if(e[d].replace(/\*\\\./g,"")==""){b+="[^\\.]*(?!\\.)"}else{b+=e[d].replace(/\?/g,".").replace(/\*/g,".*")}}}b="^("+b+")$";return new RegExp(b,"gi").test(f)};au.upldr.RestrictionVerifier.parseFileMask=function(fileMask){if(!fileMask||fileMask.length==0){return""}try{var fileMaskArr=[];if(fileMask instanceof Array){fileMaskArr=fileMask}else{if(typeof fileMask=="string"){if(/^\[.+\]$/g.test(fileMask)){fileMaskArr=eval(fileMask)}else{return fileMask.replace(/,/g,";").toLowerCase()}}}var ext=[];goog.array.forEach(fileMaskArr,function(el){if(el&&el[1]&&el[1]!="*.*"){ext.push(el[1])}});return ext.join(";").toLowerCase()}catch(e){return""}};au.upldr.VerifyCode={VERIFY_ASYNC:-1,VERIFIED:0,NOT_INITIALIZED:1,MAX_FILE_COUNT:2,MAX_FILE_SIZE:3,MIN_FILE_SIZE:4,MAX_TOTAL_FILE_SIZE:5,MAX_IMAGE_HEIGHT:6,MAX_IMAGE_WIDTH:7,MIN_IMAGE_HEIGHT:8,MIN_IMAGE_WIDTH:9,FILE_MASK:10,DND_FOLDER_FILE_LIMIT:11};goog.provide("au.upldr.ItemHolderInitializer");goog.provide("au.upldr.ItemHolderInitializer.EventType");goog.require("goog.events.EventTarget");goog.require("goog.events.Event");goog.require("au.upldr.events.EventType");goog.require("au.upldr.VerifyCode");goog.require("au.upldr.ItemHolder");goog.require("au.upldr.utils");au.upldr.ItemHolderInitializer=function(){goog.base(this);this.files_;this.itemsCount_;this.initilizedItemsCount_;this.itemsSize_;this.verifier_;this.cancelled_};goog.inherits(au.upldr.ItemHolderInitializer,goog.events.EventTarget);au.upldr.ItemHolderInitializer.prototype.initialize=function(d,b,e,a,c){this.files_=Array.prototype.slice.call(d);this.itemsCount_=b;this.itemsCountTotal_=d.length,this.itemsSize_=e;this.verifier_=a;this.cancelled_=false;this.enableAutoRotation_=c;this.initilizedItemsCount_=0;this.initializeNext_()};au.upldr.ItemHolderInitializer.prototype.initializeNext_=function(){if(this.cancelled_){return}var a=this.files_;if(!a||!(a.length>0)){this.initilizedItemsCount_=0;this.dispatchCompleteEvent();return}var e=this.verifier_,i=this.itemsCount_,c=this.itemsSize_;var f=[],b,g;while((b=a.shift())&&(g=e.verifyFile(b,i,c))!==au.upldr.VerifyCode.VERIFY_ASYNC){var h=new au.upldr.ItemHolder(b);h.setCanAutoRotate(this.enableAutoRotation_);if(g===au.upldr.VerifyCode.VERIFIED){++i;c+=b.size;f.push(h);this.dispatchInitFileEvent_(this.initilizedItemsCount_++,this.itemsCountTotal_,h)}else{if(f.length>0){this.dispatchInitializedEvent_(f);f=[]}switch(g){case au.upldr.VerifyCode.FILE_MASK:case au.upldr.VerifyCode.MAX_FILE_SIZE:case au.upldr.VerifyCode.MIN_FILE_SIZE:this.dispatchFileSkippedEvent_(h,g);break;case au.upldr.VerifyCode.MAX_FILE_COUNT:case au.upldr.VerifyCode.MAX_TOTAL_FILE_SIZE:this.dispatchFileSkippedEvent_(h,g);break;default:var d='Unexpected "verifyCode" value.';au.upldr.utils.error(d)}}}if(f.length>0){this.dispatchInitializedEvent_(f)}this.itemsCount_=i;this.itemsSize_=c;if(b&&g===au.upldr.VerifyCode.VERIFY_ASYNC){e.verifyFileAsync(b,i,c,goog.bind(this.verifyFileAsyncResult_,this,b))}else{this.initilizedItemsCount_=0;this.dispatchCompleteEvent()}};au.upldr.ItemHolderInitializer.prototype.verifyFileAsyncResult_=function(b,d){if(this.cancelled_){return}var c=new au.upldr.ItemHolder(b);c.setCanAutoRotate(this.enableAutoRotation_);if(d){switch(d){case au.upldr.VerifyCode.FILE_MASK:case au.upldr.VerifyCode.MAX_FILE_SIZE:case au.upldr.VerifyCode.MIN_FILE_SIZE:case au.upldr.VerifyCode.MAX_IMAGE_HEIGHT:case au.upldr.VerifyCode.MAX_IMAGE_WIDTH:case au.upldr.VerifyCode.MIN_IMAGE_HEIGHT:case au.upldr.VerifyCode.MIN_IMAGE_WIDTH:this.dispatchFileSkippedEvent_(c,d);this.initializeNext_();break;case au.upldr.VerifyCode.MAX_FILE_COUNT:case au.upldr.VerifyCode.MAX_TOTAL_FILE_SIZE:this.dispatchFileSkippedEvent_(c,d);this.initilizedItemsCount_=0;this.dispatchCompleteEvent();return;default:var a='Unexpected "verifyCode" value.';au.upldr.utils.error(a)}}else{++this.itemsCount_;this.itemsSize_+=b.size;this.dispatchInitializedEvent_([c]);this.initializeNext_()}};au.upldr.ItemHolderInitializer.prototype.dispatchCompleteEvent=function(){if(this.cancelled_){return}try{this.dispatchEvent(au.upldr.ItemHolderInitializer.EventType.COMPLETE)}finally{this.cleanUp_()}};au.upldr.ItemHolderInitializer.prototype.dispatchInitializedEvent_=function(b){if(this.cancelled_){return}var a=new goog.events.Event(au.upldr.ItemHolderInitializer.EventType.INITIALIZED);a.items=b;try{this.dispatchEvent(a)}catch(c){}};au.upldr.ItemHolderInitializer.prototype.dispatchInitFileEvent_=function(c,b,d){if(this.cancelled_){return}var a=new goog.events.Event(au.upldr.events.EventType.INIT_FILE);a.currentIndex=c;a.totalCount=b;a.item=d;try{this.dispatchEvent(a)}catch(f){}};au.upldr.ItemHolderInitializer.prototype.dispatchFileSkippedEvent_=function(c,b){if(this.cancelled_){return}var a=new goog.events.Event(au.upldr.ItemHolderInitializer.EventType.FILE_SKIPPED);a.item=c;a.code=b;a.totalCount=this.itemsCountTotal_;try{this.dispatchEvent(a)}catch(d){}};au.upldr.ItemHolderInitializer.prototype.cleanUp_=function(){this.files_=null;this.verifier_=null};au.upldr.ItemHolderInitializer.prototype.reset=function(){this.cancelled_=true;this.cleanUp_()};au.upldr.ItemHolderInitializer.EventType={INITIALIZED:au.upldr.events.EventType.PROGRESS,COMPLETE:au.upldr.events.EventType.COMPLETE,FILE_SKIPPED:goog.events.getUniqueId("fileSkipped")};goog.provide("au.upldr.RestrictionErrorCodes");au.upldr.RestrictionErrorCodes={SIZE_OF_SELECTED_FILE_EXCEEDS_MAX_FILE_SIZE:0,SIZE_OF_SELECTED_FILES_LESS_THEN_MIN_FILE_SIZE:1,SELECTED_IMAGE_IS_CMYK_WHERE_CMYK_IMAGES_ARE_DENIDED:2,IMAGE_DIMENSIONS_ARE_TOO_LARGE:3,IMAGE_DIMENSIONS_ARE_TOO_SMALL:4,SELECTED_FILE_HAS_NOT_ALLOWED_NAME:5,NUMBER_OF_SELECTED_FILES_EXCEEDS_MAX_FILE_COUNT:6,TOTAL_SIZE_OF_SELECTED_FILES_EXCEEDS_MAX_TOTAL_FILE_SIZE:7};goog.provide("au.upldr.events.UploadEvent");goog.require("goog.events.Event");au.upldr.events.UploadEvent=function(d,c,a,b){goog.base(this,d);this.httpStatus=c||0;this.response=a||"";this.errorMessage=b||""};goog.inherits(au.upldr.events.UploadEvent,goog.events.Event);goog.provide("au.upldr.upload.ProgressState");goog.require("au.upldr.UploadProgress.Stage");au.upldr.upload.ProgressState=function(c,d,f,a,b,e){this.stage=c;this.percent=d;this.loadedFiles=f;this.totalFiles=a;this.loadedBytes=b;this.totalBytes=e};au.upldr.upload.ProgressState.prototype.clone=function(){return new au.upldr.upload.ProgressState(this.stage,this.percent,this.loadedFiles,this.totalFiles,this.loadedBytes,this.totalBytes)};goog.provide("goog.uri.utils");goog.provide("goog.uri.utils.ComponentIndex");goog.provide("goog.uri.utils.QueryArray");goog.provide("goog.uri.utils.QueryValue");goog.provide("goog.uri.utils.StandardQueryParam");goog.require("goog.asserts");goog.require("goog.string");goog.require("goog.userAgent");goog.uri.utils.CharCode_={AMPERSAND:38,EQUAL:61,HASH:35,QUESTION:63};goog.uri.utils.buildFromEncodedParts=function(h,f,e,g,b,a,d){var c="";if(h){c+=h+":"}if(e){c+="//";if(f){c+=f+"@"}c+=e;if(g){c+=":"+g}}if(b){c+=b}if(a){c+="?"+a}if(d){c+="#"+d}return c};goog.uri.utils.splitRe_=new RegExp("^(?:([^:/?#.]+):)?(?://(?:([^/?#]*)@)?([^/#?]*?)(?::([0-9]+))?(?=[/#?]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#(.*))?$");goog.uri.utils.ComponentIndex={SCHEME:1,USER_INFO:2,DOMAIN:3,PORT:4,PATH:5,QUERY_DATA:6,FRAGMENT:7};goog.uri.utils.split=function(a){goog.uri.utils.phishingProtection_();return(a.match(goog.uri.utils.splitRe_))};goog.uri.utils.needsPhishingProtection_=goog.userAgent.WEBKIT;goog.uri.utils.phishingProtection_=function(){if(goog.uri.utils.needsPhishingProtection_){goog.uri.utils.needsPhishingProtection_=false;var a=goog.global.location;if(a){var b=a.href;if(b){var c=goog.uri.utils.getDomain(b);if(c&&c!=a.hostname){goog.uri.utils.needsPhishingProtection_=true;throw Error()}}}}};goog.uri.utils.decodeIfPossible_=function(a,b){if(!a){return a}return b?decodeURI(a):decodeURIComponent(a)};goog.uri.utils.getComponentByIndex_=function(a,b){return goog.uri.utils.split(b)[a]||null};goog.uri.utils.getScheme=function(a){return goog.uri.utils.getComponentByIndex_(goog.uri.utils.ComponentIndex.SCHEME,a)};goog.uri.utils.getEffectiveScheme=function(b){var a=goog.uri.utils.getScheme(b);if(!a&&self.location){var c=self.location.protocol;a=c.substr(0,c.length-1)}return a?a.toLowerCase():""};goog.uri.utils.getUserInfoEncoded=function(a){return goog.uri.utils.getComponentByIndex_(goog.uri.utils.ComponentIndex.USER_INFO,a)};goog.uri.utils.getUserInfo=function(a){return goog.uri.utils.decodeIfPossible_(goog.uri.utils.getUserInfoEncoded(a))};goog.uri.utils.getDomainEncoded=function(a){return goog.uri.utils.getComponentByIndex_(goog.uri.utils.ComponentIndex.DOMAIN,a)};goog.uri.utils.getDomain=function(a){return goog.uri.utils.decodeIfPossible_(goog.uri.utils.getDomainEncoded(a),true)};goog.uri.utils.getPort=function(a){return Number(goog.uri.utils.getComponentByIndex_(goog.uri.utils.ComponentIndex.PORT,a))||null};goog.uri.utils.getPathEncoded=function(a){return goog.uri.utils.getComponentByIndex_(goog.uri.utils.ComponentIndex.PATH,a)};goog.uri.utils.getPath=function(a){return goog.uri.utils.decodeIfPossible_(goog.uri.utils.getPathEncoded(a),true)};goog.uri.utils.getQueryData=function(a){return goog.uri.utils.getComponentByIndex_(goog.uri.utils.ComponentIndex.QUERY_DATA,a)};goog.uri.utils.getFragmentEncoded=function(b){var a=b.indexOf("#");return a<0?null:b.substr(a+1)};goog.uri.utils.setFragmentEncoded=function(b,a){return goog.uri.utils.removeFragment(b)+(a?"#"+a:"")};goog.uri.utils.getFragment=function(a){return goog.uri.utils.decodeIfPossible_(goog.uri.utils.getFragmentEncoded(a))};goog.uri.utils.getHost=function(b){var a=goog.uri.utils.split(b);return goog.uri.utils.buildFromEncodedParts(a[goog.uri.utils.ComponentIndex.SCHEME],a[goog.uri.utils.ComponentIndex.USER_INFO],a[goog.uri.utils.ComponentIndex.DOMAIN],a[goog.uri.utils.ComponentIndex.PORT])};goog.uri.utils.getPathAndAfter=function(b){var a=goog.uri.utils.split(b);return goog.uri.utils.buildFromEncodedParts(null,null,null,null,a[goog.uri.utils.ComponentIndex.PATH],a[goog.uri.utils.ComponentIndex.QUERY_DATA],a[goog.uri.utils.ComponentIndex.FRAGMENT])};goog.uri.utils.removeFragment=function(b){var a=b.indexOf("#");return a<0?b:b.substr(0,a)};goog.uri.utils.haveSameDomain=function(d,c){var b=goog.uri.utils.split(d);var a=goog.uri.utils.split(c);return b[goog.uri.utils.ComponentIndex.DOMAIN]==a[goog.uri.utils.ComponentIndex.DOMAIN]&&b[goog.uri.utils.ComponentIndex.SCHEME]==a[goog.uri.utils.ComponentIndex.SCHEME]&&b[goog.uri.utils.ComponentIndex.PORT]==a[goog.uri.utils.ComponentIndex.PORT]};goog.uri.utils.assertNoFragmentsOrQueries_=function(a){if(goog.DEBUG&&(a.indexOf("#")>=0||a.indexOf("?")>=0)){throw Error("goog.uri.utils: Fragment or query identifiers are not supported: ["+a+"]")}};goog.uri.utils.QueryValue;goog.uri.utils.QueryArray;goog.uri.utils.parseQueryData=function(b,g){var f=b.split("&");for(var c=0;c<f.length;c++){var d=f[c].indexOf("=");var a=null;var e=null;if(d>=0){a=f[c].substring(0,d);e=f[c].substring(d+1)}else{a=f[c]}g(a,e?goog.string.urlDecode(e):"")}};goog.uri.utils.appendQueryData_=function(a){if(a[1]){var d=(a[0]);var b=d.indexOf("#");if(b>=0){a.push(d.substr(b));a[0]=d=d.substr(0,b)}var c=d.indexOf("?");if(c<0){a[1]="?"}else{if(c==d.length-1){a[1]=undefined}}}return a.join("")};goog.uri.utils.appendKeyValuePairs_=function(b,d,c){if(goog.isArray(d)){goog.asserts.assertArray(d);for(var a=0;a<d.length;a++){goog.uri.utils.appendKeyValuePairs_(b,String(d[a]),c)}}else{if(d!=null){c.push("&",b,d===""?"":"=",goog.string.urlEncode(d))}}};goog.uri.utils.buildQueryDataBuffer_=function(a,b,d){goog.asserts.assert(Math.max(b.length-(d||0),0)%2==0,"goog.uri.utils: Key/value lists must be even in length.");for(var c=d||0;c<b.length;c+=2){goog.uri.utils.appendKeyValuePairs_(b[c],b[c+1],a)}return a};goog.uri.utils.buildQueryData=function(b,c){var a=goog.uri.utils.buildQueryDataBuffer_([],b,c);a[0]="";return a.join("")};goog.uri.utils.buildQueryDataBufferFromMap_=function(a,c){for(var b in c){goog.uri.utils.appendKeyValuePairs_(b,c[b],a)}return a};goog.uri.utils.buildQueryDataFromMap=function(b){var a=goog.uri.utils.buildQueryDataBufferFromMap_([],b);a[0]="";return a.join("")};goog.uri.utils.appendParams=function(a,b){return goog.uri.utils.appendQueryData_(arguments.length==2?goog.uri.utils.buildQueryDataBuffer_([a],arguments[1],0):goog.uri.utils.buildQueryDataBuffer_([a],arguments,1))};goog.uri.utils.appendParamsFromMap=function(a,b){return goog.uri.utils.appendQueryData_(goog.uri.utils.buildQueryDataBufferFromMap_([a],b))};goog.uri.utils.appendParam=function(c,b,a){var d=[c,"&",b];if(goog.isDefAndNotNull(a)){d.push("=",goog.string.urlEncode(a))}return goog.uri.utils.appendQueryData_(d)};goog.uri.utils.findParam_=function(e,f,a,h){var d=f;var c=a.length;while((d=e.indexOf(a,d))>=0&&d<h){var g=e.charCodeAt(d-1);if(g==goog.uri.utils.CharCode_.AMPERSAND||g==goog.uri.utils.CharCode_.QUESTION){var b=e.charCodeAt(d+c);if(!b||b==goog.uri.utils.CharCode_.EQUAL||b==goog.uri.utils.CharCode_.AMPERSAND||b==goog.uri.utils.CharCode_.HASH){return d}}d+=c+1}return -1};goog.uri.utils.hashOrEndRe_=/#|$/;goog.uri.utils.hasParam=function(b,a){return goog.uri.utils.findParam_(b,0,a,b.search(goog.uri.utils.hashOrEndRe_))>=0};goog.uri.utils.getParamValue=function(c,a){var e=c.search(goog.uri.utils.hashOrEndRe_);var d=goog.uri.utils.findParam_(c,0,a,e);if(d<0){return null}else{var b=c.indexOf("&",d);if(b<0||b>e){b=e}d+=a.length+1;return goog.string.urlDecode(c.substr(d,b-d))}};goog.uri.utils.getParamValues=function(d,c){var f=d.search(goog.uri.utils.hashOrEndRe_);var b=0;var e;var a=[];while((e=goog.uri.utils.findParam_(d,b,c,f))>=0){b=d.indexOf("&",e);if(b<0||b>f){b=f}e+=c.length+1;a.push(goog.string.urlDecode(d.substr(e,b-e)))}return a};goog.uri.utils.trailingQueryPunctuationRe_=/[?&]($|#)/;goog.uri.utils.removeParam=function(d,b){var f=d.search(goog.uri.utils.hashOrEndRe_);var a=0;var e;var c=[];while((e=goog.uri.utils.findParam_(d,a,b,f))>=0){c.push(d.substring(a,e));a=Math.min((d.indexOf("&",e)+1)||f,f)}c.push(d.substr(a));return c.join("").replace(goog.uri.utils.trailingQueryPunctuationRe_,"$1")};goog.uri.utils.setParam=function(b,a,c){return goog.uri.utils.appendParam(goog.uri.utils.removeParam(b,a),a,c)};goog.uri.utils.appendPath=function(b,a){goog.uri.utils.assertNoFragmentsOrQueries_(b);if(goog.string.endsWith(b,"/")){b=b.substr(0,b.length-1)}if(goog.string.startsWith(a,"/")){a=a.substr(1)}return goog.string.buildString(b,"/",a)};goog.uri.utils.setPath=function(a,c){if(!goog.string.startsWith(c,"/")){c="/"+c}var b=goog.uri.utils.split(a);return goog.uri.utils.buildFromEncodedParts(b[goog.uri.utils.ComponentIndex.SCHEME],b[goog.uri.utils.ComponentIndex.USER_INFO],b[goog.uri.utils.ComponentIndex.DOMAIN],b[goog.uri.utils.ComponentIndex.PORT],c,b[goog.uri.utils.ComponentIndex.QUERY_DATA],b[goog.uri.utils.ComponentIndex.FRAGMENT])};goog.uri.utils.StandardQueryParam={RANDOM:"zx"};goog.uri.utils.makeUnique=function(a){return goog.uri.utils.setParam(a,goog.uri.utils.StandardQueryParam.RANDOM,goog.string.getRandomString())};goog.provide("goog.iter");goog.provide("goog.iter.Iterable");goog.provide("goog.iter.Iterator");goog.provide("goog.iter.StopIteration");goog.require("goog.array");goog.require("goog.asserts");goog.require("goog.functions");goog.require("goog.math");goog.iter.Iterable;goog.iter.StopIteration=("StopIteration" in goog.global)?goog.global.StopIteration:Error("StopIteration");goog.iter.Iterator=function(){};goog.iter.Iterator.prototype.next=function(){throw goog.iter.StopIteration};goog.iter.Iterator.prototype.__iterator__=function(a){return this};goog.iter.toIterator=function(b){if(b instanceof goog.iter.Iterator){return b}if(typeof b.__iterator__=="function"){return b.__iterator__(false)}if(goog.isArrayLike(b)){var a=0;var c=new goog.iter.Iterator;c.next=function(){while(true){if(a>=b.length){throw goog.iter.StopIteration}if(!(a in b)){a++;continue}return b[a++]}};return c}throw Error("Not implemented")};goog.iter.forEach=function(d,c,b){if(goog.isArrayLike(d)){try{goog.array.forEach((d),c,b)}catch(a){if(a!==goog.iter.StopIteration){throw a}}}else{d=goog.iter.toIterator(d);try{while(true){c.call(b,d.next(),undefined,d)}}catch(a){if(a!==goog.iter.StopIteration){throw a}}}};goog.iter.filter=function(d,c,b){var a=goog.iter.toIterator(d);var e=new goog.iter.Iterator;e.next=function(){while(true){var f=a.next();if(c.call(b,f,undefined,a)){return f}}};return e};goog.iter.filterFalse=function(c,b,a){return goog.iter.filter(c,goog.functions.not(b),a)};goog.iter.range=function(c,d,g){var f=0;var a=c;var b=g||1;if(arguments.length>1){f=c;a=d}if(b==0){throw Error("Range step argument must not be zero")}var e=new goog.iter.Iterator;e.next=function(){if(b>0&&f>=a||b<0&&f<=a){throw goog.iter.StopIteration}var h=f;f+=b;return h};return e};goog.iter.join=function(b,a){return goog.iter.toArray(b).join(a)};goog.iter.map=function(d,c,b){var a=goog.iter.toIterator(d);var e=new goog.iter.Iterator;e.next=function(){var f=a.next();return c.call(b,f,undefined,a)};return e};goog.iter.reduce=function(c,b,e,a){var d=e;goog.iter.forEach(c,function(f){d=b.call(a,d,f)});return d};goog.iter.some=function(d,c,b){d=goog.iter.toIterator(d);try{while(true){if(c.call(b,d.next(),undefined,d)){return true}}}catch(a){if(a!==goog.iter.StopIteration){throw a}}return false};goog.iter.every=function(d,c,b){d=goog.iter.toIterator(d);try{while(true){if(!c.call(b,d.next(),undefined,d)){return false}}}catch(a){if(a!==goog.iter.StopIteration){throw a}}return true};goog.iter.chain=function(a){return goog.iter.chainFromIterable(arguments)};goog.iter.chainFromIterable=function(c){var b=goog.iter.toIterator(c);var a=new goog.iter.Iterator();var d=null;a.next=function(){while(true){if(d==null){var f=b.next();d=goog.iter.toIterator(f)}try{return d.next()}catch(e){if(e!==goog.iter.StopIteration){throw e}d=null}}};return a};goog.iter.dropWhile=function(d,c,b){var a=goog.iter.toIterator(d);var g=new goog.iter.Iterator;var e=true;g.next=function(){while(true){var f=a.next();if(e&&c.call(b,f,undefined,a)){continue}else{e=false}return f}};return g};goog.iter.takeWhile=function(e,d,c){var b=goog.iter.toIterator(e);var a=new goog.iter.Iterator();a.next=function(){var f=b.next();if(d.call(c,f,undefined,b)){return f}throw goog.iter.StopIteration};return a};goog.iter.toArray=function(a){if(goog.isArrayLike(a)){return goog.array.toArray((a))}a=goog.iter.toIterator(a);var b=[];goog.iter.forEach(a,function(c){b.push(c)});return b};goog.iter.equals=function(b,a,e){var c={};var f=goog.iter.zipLongest(c,b,a);var d=e||goog.array.defaultCompareEquality;return goog.iter.every(f,function(g){return d(g[0],g[1])})};goog.iter.nextOrValue=function(b,a){try{return goog.iter.toIterator(b).next()}catch(c){if(c!=goog.iter.StopIteration){throw c}return a}};goog.iter.product=function(e){var b=goog.array.some(arguments,function(f){return !f.length});if(b||!arguments.length){return new goog.iter.Iterator()}var a=new goog.iter.Iterator();var c=arguments;var d=goog.array.repeat(0,c.length);a.next=function(){if(d){var g=goog.array.map(d,function(i,h){return c[h][i]});for(var f=d.length-1;f>=0;f--){goog.asserts.assert(d);if(d[f]<c[f].length-1){d[f]++;break}if(f==0){d=null;break}d[f]=0}return g}throw goog.iter.StopIteration};return a};goog.iter.cycle=function(e){var f=goog.iter.toIterator(e);var c=[];var d=0;var a=new goog.iter.Iterator();var b=false;a.next=function(){var g=null;if(!b){try{g=f.next();c.push(g);return g}catch(h){if(h!=goog.iter.StopIteration||goog.array.isEmpty(c)){throw h}b=true}}g=c[d];d=(d+1)%c.length;return g};return a};goog.iter.count=function(c,e){var b=c||0;var d=goog.isDef(e)?e:1;var a=new goog.iter.Iterator();a.next=function(){var f=b;b+=d;return f};return a};goog.iter.repeat=function(b){var a=new goog.iter.Iterator();a.next=goog.functions.constant(b);return a};goog.iter.accumulate=function(d){var b=goog.iter.toIterator(d);var c=0;var a=new goog.iter.Iterator();a.next=function(){c+=b.next();return c};return a};goog.iter.zip=function(d){var b=arguments;var a=new goog.iter.Iterator();if(b.length>0){var c=goog.array.map(b,goog.iter.toIterator);a.next=function(){var e=goog.array.map(c,function(f){return f.next()});return e}}return a};goog.iter.zipLongest=function(c,e){var b=goog.array.slice(arguments,1);var a=new goog.iter.Iterator();if(b.length>0){var d=goog.array.map(b,goog.iter.toIterator);a.next=function(){var g=false;var f=goog.array.map(d,function(j){var i;try{i=j.next();g=true}catch(h){if(h!==goog.iter.StopIteration){throw h}i=c}return i});if(!g){throw goog.iter.StopIteration}return f}}return a};goog.iter.compress=function(c,a){var b=goog.iter.toIterator(a);return goog.iter.filter(c,function(){return !!b.next()})};goog.iter.GroupByIterator_=function(b,a){this.iterator=goog.iter.toIterator(b);this.keyFunc=a||goog.functions.identity;this.targetKey;this.currentKey;this.currentValue};goog.inherits(goog.iter.GroupByIterator_,goog.iter.Iterator);goog.iter.GroupByIterator_.prototype.next=function(){while(this.currentKey==this.targetKey){this.currentValue=this.iterator.next();this.currentKey=this.keyFunc(this.currentValue)}this.targetKey=this.currentKey;return[this.currentKey,this.groupItems_(this.targetKey)]};goog.iter.GroupByIterator_.prototype.groupItems_=function(b){var a=[];while(this.currentKey==b){a.push(this.currentValue);try{this.currentValue=this.iterator.next()}catch(c){if(c!==goog.iter.StopIteration){throw c}break}this.currentKey=this.keyFunc(this.currentValue)}return a};goog.iter.groupBy=function(b,a){return new goog.iter.GroupByIterator_(b,a)};goog.iter.starMap=function(e,d,c){var b=goog.iter.toIterator(e);var a=new goog.iter.Iterator();a.next=function(){var f=goog.iter.toArray(b.next());return d.apply(c,goog.array.concat(f,undefined,b))};return a};goog.iter.tee=function(g,b){var f=goog.iter.toIterator(g);var d=goog.isNumber(b)?b:2;var a=goog.array.map(goog.array.range(d),function(){return[]});var c=function(){var h=f.next();goog.array.forEach(a,function(i){i.push(h)})};var e=function(i){var h=new goog.iter.Iterator();h.next=function(){if(goog.array.isEmpty(i)){c()}goog.asserts.assert(!goog.array.isEmpty(i));return i.shift()};return h};return goog.array.map(a,e)};goog.iter.enumerate=function(b,a){return goog.iter.zip(goog.iter.count(a),b)};goog.iter.limit=function(e,d){goog.asserts.assert(goog.math.isInt(d)&&d>=0);var c=goog.iter.toIterator(e);var a=new goog.iter.Iterator();var b=d;a.next=function(){if(b-->0){return c.next()}throw goog.iter.StopIteration};return a};goog.iter.consume=function(c,b){goog.asserts.assert(goog.math.isInt(b)&&b>=0);var a=goog.iter.toIterator(c);while(b-->0){goog.iter.nextOrValue(a,null)}return a};goog.iter.slice=function(c,d,a){goog.asserts.assert(goog.math.isInt(d)&&d>=0);var b=goog.iter.consume(c,d);if(goog.isNumber(a)){goog.asserts.assert(goog.math.isInt((a))&&a>=d);b=goog.iter.limit(b,a-d)}return b};goog.iter.hasDuplicates_=function(a){var b=[];goog.array.removeDuplicates(a,b);return a.length!=b.length};goog.iter.permutations=function(f,a){var e=goog.iter.toArray(f);var c=goog.isNumber(a)?a:e.length;var b=goog.array.repeat(e,c);var d=goog.iter.product.apply(undefined,b);return goog.iter.filter(d,function(g){return !goog.iter.hasDuplicates_(g)})};goog.iter.combinations=function(g,e){var f=goog.iter.toArray(g);var d=goog.iter.range(f.length);var b=goog.iter.permutations(d,e);var h=goog.iter.filter(b,function(i){return goog.array.isSorted(i)});var a=new goog.iter.Iterator();function c(i){return f[i]}a.next=function(){return goog.array.map((h.next()),c)};return a};goog.iter.combinationsWithReplacement=function(b,c){var a=goog.iter.toArray(b);var g=goog.array.range(a.length);var h=goog.array.repeat(g,c);var e=goog.iter.product.apply(undefined,h);var f=goog.iter.filter(e,function(j){return goog.array.isSorted(j)});var i=new goog.iter.Iterator();function d(j){return a[j]}i.next=function(){return goog.array.map((f.next()),d)};return i};goog.provide("goog.structs.Map");goog.require("goog.iter.Iterator");goog.require("goog.iter.StopIteration");goog.require("goog.object");goog.structs.Map=function(b,c){this.map_={};this.keys_=[];this.count_=0;this.version_=0;var d=arguments.length;if(d>1){if(d%2){throw Error("Uneven number of arguments")}for(var a=0;a<d;a+=2){this.set(arguments[a],arguments[a+1])}}else{if(b){this.addAll((b))}}};goog.structs.Map.prototype.getCount=function(){return this.count_};goog.structs.Map.prototype.getValues=function(){this.cleanupKeysArray_();var c=[];for(var b=0;b<this.keys_.length;b++){var a=this.keys_[b];c.push(this.map_[a])}return c};goog.structs.Map.prototype.getKeys=function(){this.cleanupKeysArray_();return(this.keys_.concat())};goog.structs.Map.prototype.containsKey=function(a){return goog.structs.Map.hasKey_(this.map_,a)};goog.structs.Map.prototype.containsValue=function(c){for(var b=0;b<this.keys_.length;b++){var a=this.keys_[b];if(goog.structs.Map.hasKey_(this.map_,a)&&this.map_[a]==c){return true}}return false};goog.structs.Map.prototype.equals=function(c,a){if(this===c){return true}if(this.count_!=c.getCount()){return false}var b=a||goog.structs.Map.defaultEquals;this.cleanupKeysArray_();for(var e,d=0;e=this.keys_[d];d++){if(!b(this.get(e),c.get(e))){return false}}return true};goog.structs.Map.defaultEquals=function(d,c){return d===c};goog.structs.Map.prototype.isEmpty=function(){return this.count_==0};goog.structs.Map.prototype.clear=function(){this.map_={};this.keys_.length=0;this.count_=0;this.version_=0};goog.structs.Map.prototype.remove=function(a){if(goog.structs.Map.hasKey_(this.map_,a)){delete this.map_[a];this.count_--;this.version_++;if(this.keys_.length>2*this.count_){this.cleanupKeysArray_()}return true}return false};goog.structs.Map.prototype.cleanupKeysArray_=function(){if(this.count_!=this.keys_.length){var c=0;var b=0;while(c<this.keys_.length){var d=this.keys_[c];if(goog.structs.Map.hasKey_(this.map_,d)){this.keys_[b++]=d}c++}this.keys_.length=b}if(this.count_!=this.keys_.length){var a={};var c=0;var b=0;while(c<this.keys_.length){var d=this.keys_[c];if(!(goog.structs.Map.hasKey_(a,d))){this.keys_[b++]=d;a[d]=1}c++}this.keys_.length=b}};goog.structs.Map.prototype.get=function(a,b){if(goog.structs.Map.hasKey_(this.map_,a)){return this.map_[a]}return b};goog.structs.Map.prototype.set=function(a,b){if(!(goog.structs.Map.hasKey_(this.map_,a))){this.count_++;this.keys_.push(a);this.version_++}this.map_[a]=b};goog.structs.Map.prototype.addAll=function(d){var c,a;if(d instanceof goog.structs.Map){c=d.getKeys();a=d.getValues()}else{c=goog.object.getKeys(d);a=goog.object.getValues(d)}for(var b=0;b<c.length;b++){this.set(c[b],a[b])}};goog.structs.Map.prototype.forEach=function(g,e){var c=this.getKeys();for(var b=0;b<c.length;b++){var a=c[b];var d=this.get(a);g.call(e,d,a,this)}};goog.structs.Map.prototype.clone=function(){return new goog.structs.Map(this)};goog.structs.Map.prototype.transpose=function(){var c=new goog.structs.Map();for(var b=0;b<this.keys_.length;b++){var a=this.keys_[b];var d=this.map_[a];c.set(d,a)}return c};goog.structs.Map.prototype.toObject=function(){this.cleanupKeysArray_();var c={};for(var b=0;b<this.keys_.length;b++){var a=this.keys_[b];c[a]=this.map_[a]}return c};goog.structs.Map.prototype.getKeyIterator=function(){return this.__iterator__(true)};goog.structs.Map.prototype.getValueIterator=function(){return this.__iterator__(false)};goog.structs.Map.prototype.__iterator__=function(g){this.cleanupKeysArray_();var b=0;var c=this.keys_;var d=this.map_;var a=this.version_;var f=this;var e=new goog.iter.Iterator;e.next=function(){while(true){if(a!=f.version_){throw Error("The map has changed since the iterator was created")}if(b>=c.length){throw goog.iter.StopIteration}var h=c[b++];return g?h:d[h]}};return e};goog.structs.Map.hasKey_=function(b,a){return Object.prototype.hasOwnProperty.call(b,a)};goog.provide("goog.structs");goog.require("goog.array");goog.require("goog.object");goog.structs.getCount=function(a){if(typeof a.getCount=="function"){return a.getCount()}if(goog.isArrayLike(a)||goog.isString(a)){return a.length}return goog.object.getCount(a)};goog.structs.getValues=function(b){if(typeof b.getValues=="function"){return b.getValues()}if(goog.isString(b)){return b.split("")}if(goog.isArrayLike(b)){var d=[];var a=b.length;for(var c=0;c<a;c++){d.push(b[c])}return d}return goog.object.getValues(b)};goog.structs.getKeys=function(b){if(typeof b.getKeys=="function"){return b.getKeys()}if(typeof b.getValues=="function"){return undefined}if(goog.isArrayLike(b)||goog.isString(b)){var d=[];var a=b.length;for(var c=0;c<a;c++){d.push(c)}return d}return goog.object.getKeys(b)};goog.structs.contains=function(a,b){if(typeof a.contains=="function"){return a.contains(b)}if(typeof a.containsValue=="function"){return a.containsValue(b)}if(goog.isArrayLike(a)||goog.isString(a)){return goog.array.contains((a),b)}return goog.object.containsValue(a,b)};goog.structs.isEmpty=function(a){if(typeof a.isEmpty=="function"){return a.isEmpty()}if(goog.isArrayLike(a)||goog.isString(a)){return goog.array.isEmpty((a))}return goog.object.isEmpty(a)};goog.structs.clear=function(a){if(typeof a.clear=="function"){a.clear()}else{if(goog.isArrayLike(a)){goog.array.clear((a))}else{goog.object.clear(a)}}};goog.structs.forEach=function(c,h,g){if(typeof c.forEach=="function"){c.forEach(h,g)}else{if(goog.isArrayLike(c)||goog.isString(c)){goog.array.forEach((c),h,g)}else{var e=goog.structs.getKeys(c);var b=goog.structs.getValues(c);var a=b.length;for(var d=0;d<a;d++){h.call(g,b[d],e&&e[d],c)}}}};goog.structs.filter=function(c,h,g){if(typeof c.filter=="function"){return c.filter(h,g)}if(goog.isArrayLike(c)||goog.isString(c)){return goog.array.filter((c),h,g)}var j;var e=goog.structs.getKeys(c);var b=goog.structs.getValues(c);var a=b.length;if(e){j={};for(var d=0;d<a;d++){if(h.call(g,b[d],e[d],c)){j[e[d]]=b[d]}}}else{j=[];for(var d=0;d<a;d++){if(h.call(g,b[d],undefined,c)){j.push(b[d])}}}return j};goog.structs.map=function(c,h,g){if(typeof c.map=="function"){return c.map(h,g)}if(goog.isArrayLike(c)||goog.isString(c)){return goog.array.map((c),h,g)}var j;var e=goog.structs.getKeys(c);var b=goog.structs.getValues(c);var a=b.length;if(e){j={};for(var d=0;d<a;d++){j[e[d]]=h.call(g,b[d],e[d],c)}}else{j=[];for(var d=0;d<a;d++){j[d]=h.call(g,b[d],undefined,c)}}return j};goog.structs.some=function(c,h,g){if(typeof c.some=="function"){return c.some(h,g)}if(goog.isArrayLike(c)||goog.isString(c)){return goog.array.some((c),h,g)}var e=goog.structs.getKeys(c);var b=goog.structs.getValues(c);var a=b.length;for(var d=0;d<a;d++){if(h.call(g,b[d],e&&e[d],c)){return true}}return false};goog.structs.every=function(c,h,g){if(typeof c.every=="function"){return c.every(h,g)}if(goog.isArrayLike(c)||goog.isString(c)){return goog.array.every((c),h,g)}var e=goog.structs.getKeys(c);var b=goog.structs.getValues(c);var a=b.length;for(var d=0;d<a;d++){if(!h.call(g,b[d],e&&e[d],c)){return false}}return true};goog.provide("goog.Uri");goog.provide("goog.Uri.QueryData");goog.require("goog.array");goog.require("goog.string");goog.require("goog.structs");goog.require("goog.structs.Map");goog.require("goog.uri.utils");goog.require("goog.uri.utils.ComponentIndex");goog.require("goog.uri.utils.StandardQueryParam");goog.Uri=function(c,b){var a;if(c instanceof goog.Uri){this.ignoreCase_=goog.isDef(b)?b:c.getIgnoreCase();this.setScheme(c.getScheme());this.setUserInfo(c.getUserInfo());this.setDomain(c.getDomain());this.setPort(c.getPort());this.setPath(c.getPath());this.setQueryData(c.getQueryData().clone());this.setFragment(c.getFragment())}else{if(c&&(a=goog.uri.utils.split(String(c)))){this.ignoreCase_=!!b;this.setScheme(a[goog.uri.utils.ComponentIndex.SCHEME]||"",true);this.setUserInfo(a[goog.uri.utils.ComponentIndex.USER_INFO]||"",true);this.setDomain(a[goog.uri.utils.ComponentIndex.DOMAIN]||"",true);this.setPort(a[goog.uri.utils.ComponentIndex.PORT]);this.setPath(a[goog.uri.utils.ComponentIndex.PATH]||"",true);this.setQueryData(a[goog.uri.utils.ComponentIndex.QUERY_DATA]||"",true);this.setFragment(a[goog.uri.utils.ComponentIndex.FRAGMENT]||"",true)}else{this.ignoreCase_=!!b;this.queryData_=new goog.Uri.QueryData(null,null,this.ignoreCase_)}}};goog.Uri.preserveParameterTypesCompatibilityFlag=false;goog.Uri.RANDOM_PARAM=goog.uri.utils.StandardQueryParam.RANDOM;goog.Uri.prototype.scheme_="";goog.Uri.prototype.userInfo_="";goog.Uri.prototype.domain_="";goog.Uri.prototype.port_=null;goog.Uri.prototype.path_="";goog.Uri.prototype.queryData_;goog.Uri.prototype.fragment_="";goog.Uri.prototype.isReadOnly_=false;goog.Uri.prototype.ignoreCase_=false;goog.Uri.prototype.toString=function(){var e=[];var c=this.getScheme();if(c){e.push(goog.Uri.encodeSpecialChars_(c,goog.Uri.reDisallowedInSchemeOrUserInfo_,true),":")}var g=this.getDomain();if(g){e.push("//");var a=this.getUserInfo();if(a){e.push(goog.Uri.encodeSpecialChars_(a,goog.Uri.reDisallowedInSchemeOrUserInfo_,true),"@")}e.push(goog.Uri.removeDoubleEncoding_(goog.string.urlEncode(g)));var b=this.getPort();if(b!=null){e.push(":",String(b))}}var h=this.getPath();if(h){if(this.hasDomain()&&h.charAt(0)!="/"){e.push("/")}e.push(goog.Uri.encodeSpecialChars_(h,h.charAt(0)=="/"?goog.Uri.reDisallowedInAbsolutePath_:goog.Uri.reDisallowedInRelativePath_,true))}var f=this.getEncodedQuery();if(f){e.push("?",f)}var d=this.getFragment();if(d){e.push("#",goog.Uri.encodeSpecialChars_(d,goog.Uri.reDisallowedInFragment_))}return e.join("")};goog.Uri.prototype.resolve=function(b){var e=this.clone();var c=b.hasScheme();if(c){e.setScheme(b.getScheme())}else{c=b.hasUserInfo()}if(c){e.setUserInfo(b.getUserInfo())}else{c=b.hasDomain()}if(c){e.setDomain(b.getDomain())}else{c=b.hasPort()}var d=b.getPath();if(c){e.setPort(b.getPort())}else{c=b.hasPath();if(c){if(d.charAt(0)!="/"){if(this.hasDomain()&&!this.hasPath()){d="/"+d}else{var a=e.getPath().lastIndexOf("/");if(a!=-1){d=e.getPath().substr(0,a+1)+d}}}d=goog.Uri.removeDotSegments(d)}}if(c){e.setPath(d)}else{c=b.hasQuery()}if(c){e.setQueryData(b.getDecodedQuery())}else{c=b.hasFragment()}if(c){e.setFragment(b.getFragment())}return e};goog.Uri.prototype.clone=function(){return new goog.Uri(this)};goog.Uri.prototype.getScheme=function(){return this.scheme_};goog.Uri.prototype.setScheme=function(a,b){this.enforceReadOnly();this.scheme_=b?goog.Uri.decodeOrEmpty_(a,true):a;if(this.scheme_){this.scheme_=this.scheme_.replace(/:$/,"")}return this};goog.Uri.prototype.hasScheme=function(){return !!this.scheme_};goog.Uri.prototype.getUserInfo=function(){return this.userInfo_};goog.Uri.prototype.setUserInfo=function(b,a){this.enforceReadOnly();this.userInfo_=a?goog.Uri.decodeOrEmpty_(b):b;return this};goog.Uri.prototype.hasUserInfo=function(){return !!this.userInfo_};goog.Uri.prototype.getDomain=function(){return this.domain_};goog.Uri.prototype.setDomain=function(b,a){this.enforceReadOnly();this.domain_=a?goog.Uri.decodeOrEmpty_(b,true):b;return this};goog.Uri.prototype.hasDomain=function(){return !!this.domain_};goog.Uri.prototype.getPort=function(){return this.port_};goog.Uri.prototype.setPort=function(a){this.enforceReadOnly();if(a){a=Number(a);if(isNaN(a)||a<0){throw Error("Bad port number "+a)}this.port_=a}else{this.port_=null}return this};goog.Uri.prototype.hasPort=function(){return this.port_!=null};goog.Uri.prototype.getPath=function(){return this.path_};goog.Uri.prototype.setPath=function(b,a){this.enforceReadOnly();this.path_=a?goog.Uri.decodeOrEmpty_(b,true):b;return this};goog.Uri.prototype.hasPath=function(){return !!this.path_};goog.Uri.prototype.hasQuery=function(){return this.queryData_.toString()!==""};goog.Uri.prototype.setQueryData=function(a,b){this.enforceReadOnly();if(a instanceof goog.Uri.QueryData){this.queryData_=a;this.queryData_.setIgnoreCase(this.ignoreCase_)}else{if(!b){a=goog.Uri.encodeSpecialChars_(a,goog.Uri.reDisallowedInQuery_)}this.queryData_=new goog.Uri.QueryData(a,null,this.ignoreCase_)}return this};goog.Uri.prototype.setQuery=function(b,a){return this.setQueryData(b,a)};goog.Uri.prototype.getEncodedQuery=function(){return this.queryData_.toString()};goog.Uri.prototype.getDecodedQuery=function(){return this.queryData_.toDecodedString()};goog.Uri.prototype.getQueryData=function(){return this.queryData_};goog.Uri.prototype.getQuery=function(){return this.getEncodedQuery()};goog.Uri.prototype.setParameterValue=function(a,b){this.enforceReadOnly();this.queryData_.set(a,b);return this};goog.Uri.prototype.setParameterValues=function(b,a){this.enforceReadOnly();if(!goog.isArray(a)){a=[String(a)]}this.queryData_.setValues(b,a);return this};goog.Uri.prototype.getParameterValues=function(a){return this.queryData_.getValues(a)};goog.Uri.prototype.getParameterValue=function(a){return(this.queryData_.get(a))};goog.Uri.prototype.getFragment=function(){return this.fragment_};goog.Uri.prototype.setFragment=function(b,a){this.enforceReadOnly();this.fragment_=a?goog.Uri.decodeOrEmpty_(b):b;return this};goog.Uri.prototype.hasFragment=function(){return !!this.fragment_};goog.Uri.prototype.hasSameDomainAs=function(a){return((!this.hasDomain()&&!a.hasDomain())||this.getDomain()==a.getDomain())&&((!this.hasPort()&&!a.hasPort())||this.getPort()==a.getPort())};goog.Uri.prototype.makeUnique=function(){this.enforceReadOnly();this.setParameterValue(goog.Uri.RANDOM_PARAM,goog.string.getRandomString());return this};goog.Uri.prototype.removeParameter=function(a){this.enforceReadOnly();this.queryData_.remove(a);return this};goog.Uri.prototype.setReadOnly=function(a){this.isReadOnly_=a;return this};goog.Uri.prototype.isReadOnly=function(){return this.isReadOnly_};goog.Uri.prototype.enforceReadOnly=function(){if(this.isReadOnly_){throw Error("Tried to modify a read-only Uri")}};goog.Uri.prototype.setIgnoreCase=function(a){this.ignoreCase_=a;if(this.queryData_){this.queryData_.setIgnoreCase(a)}return this};goog.Uri.prototype.getIgnoreCase=function(){return this.ignoreCase_};goog.Uri.parse=function(b,a){return b instanceof goog.Uri?b.clone():new goog.Uri(b,a)};goog.Uri.create=function(i,h,c,f,a,g,e,b){var d=new goog.Uri(null,b);i&&d.setScheme(i);h&&d.setUserInfo(h);c&&d.setDomain(c);f&&d.setPort(f);a&&d.setPath(a);g&&d.setQueryData(g);e&&d.setFragment(e);return d};goog.Uri.resolve=function(b,a){if(!(b instanceof goog.Uri)){b=goog.Uri.parse(b)}if(!(a instanceof goog.Uri)){a=goog.Uri.parse(a)}return b.resolve(a)};goog.Uri.removeDotSegments=function(e){if(e==".."||e=="."){return""}else{if(!goog.string.contains(e,"./")&&!goog.string.contains(e,"/.")){return e}else{var c=goog.string.startsWith(e,"/");var b=e.split("/");var a=[];for(var f=0;f<b.length;){var d=b[f++];if(d=="."){if(c&&f==b.length){a.push("")}}else{if(d==".."){if(a.length>1||a.length==1&&a[0]!=""){a.pop()}if(c&&f==b.length){a.push("")}}else{a.push(d);c=true}}}return a.join("/")}}};goog.Uri.decodeOrEmpty_=function(a,b){if(!a){return""}return b?decodeURI(a):decodeURIComponent(a)};goog.Uri.encodeSpecialChars_=function(c,b,a){if(goog.isString(c)){var d=encodeURI(c).replace(b,goog.Uri.encodeChar_);if(a){d=goog.Uri.removeDoubleEncoding_(d)}return d}return null};goog.Uri.encodeChar_=function(a){var b=a.charCodeAt(0);return"%"+((b>>4)&15).toString(16)+(b&15).toString(16)};goog.Uri.removeDoubleEncoding_=function(a){return a.replace(/%25([0-9a-fA-F]{2})/g,"%$1")};goog.Uri.reDisallowedInSchemeOrUserInfo_=/[#\/\?@]/g;goog.Uri.reDisallowedInRelativePath_=/[\#\?:]/g;goog.Uri.reDisallowedInAbsolutePath_=/[\#\?]/g;goog.Uri.reDisallowedInQuery_=/[\#\?@]/g;goog.Uri.reDisallowedInFragment_=/#/g;goog.Uri.haveSameDomain=function(d,b){var c=goog.uri.utils.split(d);var a=goog.uri.utils.split(b);return c[goog.uri.utils.ComponentIndex.DOMAIN]==a[goog.uri.utils.ComponentIndex.DOMAIN]&&c[goog.uri.utils.ComponentIndex.PORT]==a[goog.uri.utils.ComponentIndex.PORT]};goog.Uri.QueryData=function(b,c,a){this.encodedQuery_=b||null;this.ignoreCase_=!!a};goog.Uri.QueryData.prototype.ensureKeyMapInitialized_=function(){if(!this.keyMap_){this.keyMap_=new goog.structs.Map();this.count_=0;if(this.encodedQuery_){var a=this;goog.uri.utils.parseQueryData(this.encodedQuery_,function(b,c){a.add(goog.string.urlDecode(b),c)})}}};goog.Uri.QueryData.createFromMap=function(b,h,a){var g=goog.structs.getKeys(b);if(typeof g=="undefined"){throw Error("Keys are undefined")}var j=new goog.Uri.QueryData(null,null,a);var f=goog.structs.getValues(b);for(var c=0;c<g.length;c++){var e=g[c];var d=f[c];if(!goog.isArray(d)){j.add(e,d)}else{j.setValues(e,d)}}return j};goog.Uri.QueryData.createFromKeysValues=function(f,c,e,a){if(f.length!=c.length){throw Error("Mismatched lengths for keys/values")}var b=new goog.Uri.QueryData(null,null,a);for(var d=0;d<f.length;d++){b.add(f[d],c[d])}return b};goog.Uri.QueryData.prototype.keyMap_=null;goog.Uri.QueryData.prototype.count_=null;goog.Uri.QueryData.prototype.getCount=function(){this.ensureKeyMapInitialized_();return this.count_};goog.Uri.QueryData.prototype.add=function(b,c){this.ensureKeyMapInitialized_();this.invalidateCache_();b=this.getKeyName_(b);var a=this.keyMap_.get(b);if(!a){this.keyMap_.set(b,(a=[]))}a.push(c);this.count_++;return this};goog.Uri.QueryData.prototype.remove=function(a){this.ensureKeyMapInitialized_();a=this.getKeyName_(a);if(this.keyMap_.containsKey(a)){this.invalidateCache_();this.count_-=this.keyMap_.get(a).length;return this.keyMap_.remove(a)}return false};goog.Uri.QueryData.prototype.clear=function(){this.invalidateCache_();this.keyMap_=null;this.count_=0};goog.Uri.QueryData.prototype.isEmpty=function(){this.ensureKeyMapInitialized_();return this.count_==0};goog.Uri.QueryData.prototype.containsKey=function(a){this.ensureKeyMapInitialized_();a=this.getKeyName_(a);return this.keyMap_.containsKey(a)};goog.Uri.QueryData.prototype.containsValue=function(b){var a=this.getValues();return goog.array.contains(a,b)};goog.Uri.QueryData.prototype.getKeys=function(){this.ensureKeyMapInitialized_();var d=(this.keyMap_.getValues());var c=this.keyMap_.getKeys();var f=[];for(var b=0;b<c.length;b++){var e=d[b];for(var a=0;a<e.length;a++){f.push(c[b])}}return f};goog.Uri.QueryData.prototype.getValues=function(b){this.ensureKeyMapInitialized_();var d=[];if(goog.isString(b)){if(this.containsKey(b)){d=goog.array.concat(d,this.keyMap_.get(this.getKeyName_(b)))}}else{var a=this.keyMap_.getValues();for(var c=0;c<a.length;c++){d=goog.array.concat(d,a[c])}}return d};goog.Uri.QueryData.prototype.set=function(a,b){this.ensureKeyMapInitialized_();this.invalidateCache_();a=this.getKeyName_(a);if(this.containsKey(a)){this.count_-=this.keyMap_.get(a).length}this.keyMap_.set(a,[b]);this.count_++;return this};goog.Uri.QueryData.prototype.get=function(b,c){var a=b?this.getValues(b):[];if(goog.Uri.preserveParameterTypesCompatibilityFlag){return a.length>0?a[0]:c}else{return a.length>0?String(a[0]):c}};goog.Uri.QueryData.prototype.setValues=function(b,a){this.remove(b);if(a.length>0){this.invalidateCache_();this.keyMap_.set(this.getKeyName_(b),goog.array.clone(a));this.count_+=a.length}};goog.Uri.QueryData.prototype.toString=function(){if(this.encodedQuery_){return this.encodedQuery_}if(!this.keyMap_){return""}var h=[];var d=this.keyMap_.getKeys();for(var c=0;c<d.length;c++){var b=d[c];var e=goog.string.urlEncode(b);var g=this.getValues(b);for(var a=0;a<g.length;a++){var f=e;if(g[a]!==""){f+="="+goog.string.urlEncode(g[a])}h.push(f)}}return this.encodedQuery_=h.join("&")};goog.Uri.QueryData.prototype.toDecodedString=function(){return goog.Uri.decodeOrEmpty_(this.toString())};goog.Uri.QueryData.prototype.invalidateCache_=function(){this.encodedQuery_=null};goog.Uri.QueryData.prototype.filterKeys=function(a){this.ensureKeyMapInitialized_();this.keyMap_.forEach(function(c,b){if(!goog.array.contains(a,b)){this.remove(b)}},this);return this};goog.Uri.QueryData.prototype.clone=function(){var a=new goog.Uri.QueryData();a.encodedQuery_=this.encodedQuery_;if(this.keyMap_){a.keyMap_=this.keyMap_.clone();a.count_=this.count_}return a};goog.Uri.QueryData.prototype.getKeyName_=function(a){var b=String(a);if(this.ignoreCase_){b=b.toLowerCase()}return b};goog.Uri.QueryData.prototype.setIgnoreCase=function(a){var b=a&&!this.ignoreCase_;if(b){this.ensureKeyMapInitialized_();this.invalidateCache_();this.keyMap_.forEach(function(e,d){var c=d.toLowerCase();if(d!=c){this.remove(d);this.setValues(c,e)}},this)}this.ignoreCase_=a};goog.Uri.QueryData.prototype.extend=function(c){for(var a=0;a<arguments.length;a++){var b=arguments[a];goog.structs.forEach(b,function(e,d){this.add(d,e)},this)}};goog.provide("goog.net.EventType");goog.net.EventType={COMPLETE:"complete",SUCCESS:"success",ERROR:"error",ABORT:"abort",READY:"ready",READY_STATE_CHANGE:"readystatechange",TIMEOUT:"timeout",INCREMENTAL_DATA:"incrementaldata",PROGRESS:"progress"};goog.provide("au.upldr.events.ProgressEvent");goog.require("goog.events.Event");goog.require("goog.net.EventType");au.upldr.events.ProgressEvent=function(c,a,b,d){goog.base(this,c||goog.net.EventType.PROGRESS);this.lengthComputable=!!a;this.loaded=b||0;this.total=d||0};goog.inherits(au.upldr.events.ProgressEvent,goog.events.Event);goog.provide("goog.Timer");goog.require("goog.Promise");goog.require("goog.events.EventTarget");goog.Timer=function(a,b){goog.events.EventTarget.call(this);this.interval_=a||1;this.timerObject_=b||goog.Timer.defaultTimerObject;this.boundTick_=goog.bind(this.tick_,this);this.last_=goog.now()};goog.inherits(goog.Timer,goog.events.EventTarget);goog.Timer.MAX_TIMEOUT_=2147483647;goog.Timer.INVALID_TIMEOUT_ID_=-1;goog.Timer.prototype.enabled=false;goog.Timer.defaultTimerObject=goog.global;goog.Timer.intervalScale=0.8;goog.Timer.prototype.timer_=null;goog.Timer.prototype.getInterval=function(){return this.interval_};goog.Timer.prototype.setInterval=function(a){this.interval_=a;if(this.timer_&&this.enabled){this.stop();this.start()}else{if(this.timer_){this.stop()}}};goog.Timer.prototype.tick_=function(){if(this.enabled){var a=goog.now()-this.last_;if(a>0&&a<this.interval_*goog.Timer.intervalScale){this.timer_=this.timerObject_.setTimeout(this.boundTick_,this.interval_-a);return}if(this.timer_){this.timerObject_.clearTimeout(this.timer_);this.timer_=null}this.dispatchTick();if(this.enabled){this.timer_=this.timerObject_.setTimeout(this.boundTick_,this.interval_);this.last_=goog.now()}}};goog.Timer.prototype.dispatchTick=function(){this.dispatchEvent(goog.Timer.TICK)};goog.Timer.prototype.start=function(){this.enabled=true;if(!this.timer_){this.timer_=this.timerObject_.setTimeout(this.boundTick_,this.interval_);this.last_=goog.now()}};goog.Timer.prototype.stop=function(){this.enabled=false;if(this.timer_){this.timerObject_.clearTimeout(this.timer_);this.timer_=null}};goog.Timer.prototype.disposeInternal=function(){goog.Timer.superClass_.disposeInternal.call(this);this.stop();delete this.timerObject_};goog.Timer.TICK="tick";goog.Timer.callOnce=function(a,c,b){if(goog.isFunction(a)){if(b){a=goog.bind(a,b)}}else{if(a&&typeof a.handleEvent=="function"){a=goog.bind(a.handleEvent,a)}else{throw Error("Invalid listener argument")}}if(c>goog.Timer.MAX_TIMEOUT_){return goog.Timer.INVALID_TIMEOUT_ID_}else{return goog.Timer.defaultTimerObject.setTimeout(a,c||0)}};goog.Timer.clear=function(a){goog.Timer.defaultTimerObject.clearTimeout(a)};goog.Timer.promise=function(a,c){var b=null;return new goog.Promise(function(e,d){b=goog.Timer.callOnce(function(){e(c)},a);if(b==goog.Timer.INVALID_TIMEOUT_ID_){d(new Error("Failed to schedule timer."))}}).thenCatch(function(d){goog.Timer.clear(b);throw d})};goog.provide("goog.net.ErrorCode");goog.net.ErrorCode={NO_ERROR:0,ACCESS_DENIED:1,FILE_NOT_FOUND:2,FF_SILENT_ERROR:3,CUSTOM_ERROR:4,EXCEPTION:5,HTTP_ERROR:6,ABORT:7,TIMEOUT:8,OFFLINE:9};goog.net.ErrorCode.getDebugMessage=function(a){switch(a){case goog.net.ErrorCode.NO_ERROR:return"No Error";case goog.net.ErrorCode.ACCESS_DENIED:return"Access denied to content document";case goog.net.ErrorCode.FILE_NOT_FOUND:return"File not found";case goog.net.ErrorCode.FF_SILENT_ERROR:return"Firefox silently errored";case goog.net.ErrorCode.CUSTOM_ERROR:return"Application custom error";case goog.net.ErrorCode.EXCEPTION:return"An exception occurred";case goog.net.ErrorCode.HTTP_ERROR:return"Http response at 400 or 500 level";case goog.net.ErrorCode.ABORT:return"Request was aborted";case goog.net.ErrorCode.TIMEOUT:return"Request timed out";case goog.net.ErrorCode.OFFLINE:return"The resource is not available offline";default:return"Unrecognized error code"}};goog.provide("goog.net.HttpStatus");goog.net.HttpStatus={CONTINUE:100,SWITCHING_PROTOCOLS:101,OK:200,CREATED:201,ACCEPTED:202,NON_AUTHORITATIVE_INFORMATION:203,NO_CONTENT:204,RESET_CONTENT:205,PARTIAL_CONTENT:206,MULTIPLE_CHOICES:300,MOVED_PERMANENTLY:301,FOUND:302,SEE_OTHER:303,NOT_MODIFIED:304,USE_PROXY:305,TEMPORARY_REDIRECT:307,BAD_REQUEST:400,UNAUTHORIZED:401,PAYMENT_REQUIRED:402,FORBIDDEN:403,NOT_FOUND:404,METHOD_NOT_ALLOWED:405,NOT_ACCEPTABLE:406,PROXY_AUTHENTICATION_REQUIRED:407,REQUEST_TIMEOUT:408,CONFLICT:409,GONE:410,LENGTH_REQUIRED:411,PRECONDITION_FAILED:412,REQUEST_ENTITY_TOO_LARGE:413,REQUEST_URI_TOO_LONG:414,UNSUPPORTED_MEDIA_TYPE:415,REQUEST_RANGE_NOT_SATISFIABLE:416,EXPECTATION_FAILED:417,PRECONDITION_REQUIRED:428,TOO_MANY_REQUESTS:429,REQUEST_HEADER_FIELDS_TOO_LARGE:431,INTERNAL_SERVER_ERROR:500,NOT_IMPLEMENTED:501,BAD_GATEWAY:502,SERVICE_UNAVAILABLE:503,GATEWAY_TIMEOUT:504,HTTP_VERSION_NOT_SUPPORTED:505,NETWORK_AUTHENTICATION_REQUIRED:511,QUIRK_IE_NO_CONTENT:1223};goog.net.HttpStatus.isSuccess=function(a){switch(a){case goog.net.HttpStatus.OK:case goog.net.HttpStatus.CREATED:case goog.net.HttpStatus.ACCEPTED:case goog.net.HttpStatus.NO_CONTENT:case goog.net.HttpStatus.PARTIAL_CONTENT:case goog.net.HttpStatus.NOT_MODIFIED:case goog.net.HttpStatus.QUIRK_IE_NO_CONTENT:return true;default:return false}};goog.provide("goog.json");goog.provide("goog.json.Replacer");goog.provide("goog.json.Reviver");goog.provide("goog.json.Serializer");goog.define("goog.json.USE_NATIVE_JSON",false);goog.json.isValid=function(e){if(/^\s*$/.test(e)){return false}var a=/\\["\\\/bfnrtu]/g;var b=/"[^"\\\n\r\u2028\u2029\x00-\x08\x0a-\x1f]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g;var d=/(?:^|:|,)(?:[\s\u2028\u2029]*\[)+/g;var c=/^[\],:{}\s\u2028\u2029]*$/;return c.test(e.replace(a,"@").replace(b,"]").replace(d,""))};goog.json.parse=goog.json.USE_NATIVE_JSON?(goog.global.JSON["parse"]):function(s){var o=String(s);if(goog.json.isValid(o)){try{return(eval("("+o+")"))}catch(ex){}}throw Error("Invalid JSON string: "+o)};goog.json.unsafeParse=goog.json.USE_NATIVE_JSON?(goog.global.JSON["parse"]):function(s){return(eval("("+s+")"))};goog.json.Replacer;goog.json.Reviver;goog.json.serialize=goog.json.USE_NATIVE_JSON?(goog.global.JSON["stringify"]):function(a,b){return new goog.json.Serializer(b).serialize(a)};goog.json.Serializer=function(a){this.replacer_=a};goog.json.Serializer.prototype.serialize=function(a){var b=[];this.serializeInternal(a,b);return b.join("")};goog.json.Serializer.prototype.serializeInternal=function(a,b){switch(typeof a){case"string":this.serializeString_((a),b);break;case"number":this.serializeNumber_((a),b);break;case"boolean":b.push(a);break;case"undefined":b.push("null");break;case"object":if(a==null){b.push("null");break}if(goog.isArray(a)){this.serializeArray((a),b);break}this.serializeObject_((a),b);break;case"function":break;default:throw Error("Unknown type: "+typeof a)}};goog.json.Serializer.charToJsonCharCache_={'"':'\\"',"\\":"\\\\","/":"\\/","\b":"\\b","\f":"\\f","\n":"\\n","\r":"\\r","\t":"\\t","\x0B":"\\u000b"};goog.json.Serializer.charsToReplace_=/\uffff/.test("\uffff")?/[\\\"\x00-\x1f\x7f-\uffff]/g:/[\\\"\x00-\x1f\x7f-\xff]/g;goog.json.Serializer.prototype.serializeString_=function(a,b){b.push('"',a.replace(goog.json.Serializer.charsToReplace_,function(f){if(f in goog.json.Serializer.charToJsonCharCache_){return goog.json.Serializer.charToJsonCharCache_[f]}var e=f.charCodeAt(0);var d="\\u";if(e<16){d+="000"}else{if(e<256){d+="00"}else{if(e<4096){d+="0"}}}return goog.json.Serializer.charToJsonCharCache_[f]=d+e.toString(16)}),'"')};goog.json.Serializer.prototype.serializeNumber_=function(b,a){a.push(isFinite(b)&&!isNaN(b)?b:"null")};goog.json.Serializer.prototype.serializeArray=function(a,f){var b=a.length;f.push("[");var c="";for(var d=0;d<b;d++){f.push(c);var e=a[d];this.serializeInternal(this.replacer_?this.replacer_.call(a,String(d),e):e,f);c=","}f.push("]")};goog.json.Serializer.prototype.serializeObject_=function(d,e){e.push("{");var a="";for(var b in d){if(Object.prototype.hasOwnProperty.call(d,b)){var c=d[b];if(typeof c!="function"){e.push(a);this.serializeString_(b,e);e.push(":");this.serializeInternal(this.replacer_?this.replacer_.call(d,b,c):c,e);a=","}}}e.push("}")};goog.provide("goog.net.XhrLike");goog.net.XhrLike=function(){};goog.net.XhrLike.OrNative;goog.net.XhrLike.prototype.onreadystatechange;goog.net.XhrLike.prototype.responseText;goog.net.XhrLike.prototype.responseXML;goog.net.XhrLike.prototype.readyState;goog.net.XhrLike.prototype.status;goog.net.XhrLike.prototype.statusText;goog.net.XhrLike.prototype.open=function(e,b,a,d,c){};goog.net.XhrLike.prototype.send=function(a){};goog.net.XhrLike.prototype.abort=function(){};goog.net.XhrLike.prototype.setRequestHeader=function(b,a){};goog.net.XhrLike.prototype.getResponseHeader=function(a){};goog.net.XhrLike.prototype.getAllResponseHeaders=function(){};goog.provide("goog.net.XmlHttpFactory");goog.require("goog.net.XhrLike");goog.net.XmlHttpFactory=function(){};goog.net.XmlHttpFactory.prototype.cachedOptions_=null;goog.net.XmlHttpFactory.prototype.createInstance=goog.abstractMethod;goog.net.XmlHttpFactory.prototype.getOptions=function(){return this.cachedOptions_||(this.cachedOptions_=this.internalGetOptions())};goog.net.XmlHttpFactory.prototype.internalGetOptions=goog.abstractMethod;goog.provide("goog.net.WrapperXmlHttpFactory");goog.require("goog.net.XhrLike");goog.require("goog.net.XmlHttpFactory");goog.net.WrapperXmlHttpFactory=function(b,a){goog.net.XmlHttpFactory.call(this);this.xhrFactory_=b;this.optionsFactory_=a};goog.inherits(goog.net.WrapperXmlHttpFactory,goog.net.XmlHttpFactory);goog.net.WrapperXmlHttpFactory.prototype.createInstance=function(){return this.xhrFactory_()};goog.net.WrapperXmlHttpFactory.prototype.getOptions=function(){return this.optionsFactory_()};goog.provide("goog.net.DefaultXmlHttpFactory");goog.provide("goog.net.XmlHttp");goog.provide("goog.net.XmlHttp.OptionType");goog.provide("goog.net.XmlHttp.ReadyState");goog.provide("goog.net.XmlHttpDefines");goog.require("goog.asserts");goog.require("goog.net.WrapperXmlHttpFactory");goog.require("goog.net.XmlHttpFactory");goog.net.XmlHttp=function(){return goog.net.XmlHttp.factory_.createInstance()};goog.define("goog.net.XmlHttp.ASSUME_NATIVE_XHR",false);goog.net.XmlHttpDefines={};goog.define("goog.net.XmlHttpDefines.ASSUME_NATIVE_XHR",false);goog.net.XmlHttp.getOptions=function(){return goog.net.XmlHttp.factory_.getOptions()};goog.net.XmlHttp.OptionType={USE_NULL_FUNCTION:0,LOCAL_REQUEST_ERROR:1};goog.net.XmlHttp.ReadyState={UNINITIALIZED:0,LOADING:1,LOADED:2,INTERACTIVE:3,COMPLETE:4};goog.net.XmlHttp.factory_;goog.net.XmlHttp.setFactory=function(a,b){goog.net.XmlHttp.setGlobalFactory(new goog.net.WrapperXmlHttpFactory(goog.asserts.assert(a),goog.asserts.assert(b)))};goog.net.XmlHttp.setGlobalFactory=function(a){goog.net.XmlHttp.factory_=a};goog.net.DefaultXmlHttpFactory=function(){goog.net.XmlHttpFactory.call(this)};goog.inherits(goog.net.DefaultXmlHttpFactory,goog.net.XmlHttpFactory);goog.net.DefaultXmlHttpFactory.prototype.createInstance=function(){var a=this.getProgId_();if(a){return new ActiveXObject(a)}else{return new XMLHttpRequest()}};goog.net.DefaultXmlHttpFactory.prototype.internalGetOptions=function(){var b=this.getProgId_();var a={};if(b){a[goog.net.XmlHttp.OptionType.USE_NULL_FUNCTION]=true;a[goog.net.XmlHttp.OptionType.LOCAL_REQUEST_ERROR]=true}return a};goog.net.DefaultXmlHttpFactory.prototype.ieProgId_;goog.net.DefaultXmlHttpFactory.prototype.getProgId_=function(){if(goog.net.XmlHttp.ASSUME_NATIVE_XHR||goog.net.XmlHttpDefines.ASSUME_NATIVE_XHR){return""}if(!this.ieProgId_&&typeof XMLHttpRequest=="undefined"&&typeof ActiveXObject!="undefined"){var a=["MSXML2.XMLHTTP.6.0","MSXML2.XMLHTTP.3.0","MSXML2.XMLHTTP","Microsoft.XMLHTTP"];for(var b=0;b<a.length;b++){var c=a[b];try{new ActiveXObject(c);this.ieProgId_=c;return c}catch(d){}}throw Error("Could not create ActiveXObject. ActiveX might be disabled, or MSXML might not be installed")}return(this.ieProgId_)};goog.net.XmlHttp.setGlobalFactory(new goog.net.DefaultXmlHttpFactory());goog.provide("goog.html.SafeScript");goog.require("goog.asserts");goog.require("goog.string.Const");goog.require("goog.string.TypedString");goog.html.SafeScript=function(){this.privateDoNotAccessOrElseSafeScriptWrappedValue_="";this.SAFE_SCRIPT_TYPE_MARKER_GOOG_HTML_SECURITY_PRIVATE_=goog.html.SafeScript.TYPE_MARKER_GOOG_HTML_SECURITY_PRIVATE_};goog.html.SafeScript.prototype.implementsGoogStringTypedString=true;goog.html.SafeScript.TYPE_MARKER_GOOG_HTML_SECURITY_PRIVATE_={};goog.html.SafeScript.fromConstant=function(b){var a=goog.string.Const.unwrap(b);if(a.length===0){return goog.html.SafeScript.EMPTY}return goog.html.SafeScript.createSafeScriptSecurityPrivateDoNotAccessOrElse(a)};goog.html.SafeScript.prototype.getTypedStringValue=function(){return this.privateDoNotAccessOrElseSafeScriptWrappedValue_};if(goog.DEBUG){goog.html.SafeScript.prototype.toString=function(){return"SafeScript{"+this.privateDoNotAccessOrElseSafeScriptWrappedValue_+"}"}}goog.html.SafeScript.unwrap=function(a){if(a instanceof goog.html.SafeScript&&a.constructor===goog.html.SafeScript&&a.SAFE_SCRIPT_TYPE_MARKER_GOOG_HTML_SECURITY_PRIVATE_===goog.html.SafeScript.TYPE_MARKER_GOOG_HTML_SECURITY_PRIVATE_){return a.privateDoNotAccessOrElseSafeScriptWrappedValue_}else{goog.asserts.fail("expected object of type SafeScript, got '"+a+"'");return"type_error:SafeScript"}};goog.html.SafeScript.createSafeScriptSecurityPrivateDoNotAccessOrElse=function(a){return new goog.html.SafeScript().initSecurityPrivateDoNotAccessOrElse_(a)};goog.html.SafeScript.prototype.initSecurityPrivateDoNotAccessOrElse_=function(a){this.privateDoNotAccessOrElseSafeScriptWrappedValue_=a;return this};goog.html.SafeScript.EMPTY=goog.html.SafeScript.createSafeScriptSecurityPrivateDoNotAccessOrElse("");goog.provide("goog.html.uncheckedconversions");goog.require("goog.asserts");goog.require("goog.html.SafeHtml");goog.require("goog.html.SafeScript");goog.require("goog.html.SafeStyle");goog.require("goog.html.SafeStyleSheet");goog.require("goog.html.SafeUrl");goog.require("goog.html.TrustedResourceUrl");goog.require("goog.string");goog.require("goog.string.Const");goog.html.uncheckedconversions.safeHtmlFromStringKnownToSatisfyTypeContract=function(b,c,a){goog.asserts.assertString(goog.string.Const.unwrap(b),"must provide justification");goog.asserts.assert(!goog.string.isEmptyOrWhitespace(goog.string.Const.unwrap(b)),"must provide non-empty justification");return goog.html.SafeHtml.createSafeHtmlSecurityPrivateDoNotAccessOrElse(c,a||null)};goog.html.uncheckedconversions.safeScriptFromStringKnownToSatisfyTypeContract=function(b,a){goog.asserts.assertString(goog.string.Const.unwrap(b),"must provide justification");goog.asserts.assert(!goog.string.isEmpty(goog.string.Const.unwrap(b)),"must provide non-empty justification");return goog.html.SafeScript.createSafeScriptSecurityPrivateDoNotAccessOrElse(a)};goog.html.uncheckedconversions.safeStyleFromStringKnownToSatisfyTypeContract=function(a,b){goog.asserts.assertString(goog.string.Const.unwrap(a),"must provide justification");goog.asserts.assert(!goog.string.isEmptyOrWhitespace(goog.string.Const.unwrap(a)),"must provide non-empty justification");return goog.html.SafeStyle.createSafeStyleSecurityPrivateDoNotAccessOrElse(b)};goog.html.uncheckedconversions.safeStyleSheetFromStringKnownToSatisfyTypeContract=function(a,b){goog.asserts.assertString(goog.string.Const.unwrap(a),"must provide justification");goog.asserts.assert(!goog.string.isEmptyOrWhitespace(goog.string.Const.unwrap(a)),"must provide non-empty justification");return goog.html.SafeStyleSheet.createSafeStyleSheetSecurityPrivateDoNotAccessOrElse(b)};goog.html.uncheckedconversions.safeUrlFromStringKnownToSatisfyTypeContract=function(b,a){goog.asserts.assertString(goog.string.Const.unwrap(b),"must provide justification");goog.asserts.assert(!goog.string.isEmptyOrWhitespace(goog.string.Const.unwrap(b)),"must provide non-empty justification");return goog.html.SafeUrl.createSafeUrlSecurityPrivateDoNotAccessOrElse(a)};goog.html.uncheckedconversions.trustedResourceUrlFromStringKnownToSatisfyTypeContract=function(b,a){goog.asserts.assertString(goog.string.Const.unwrap(b),"must provide justification");goog.asserts.assert(!goog.string.isEmptyOrWhitespace(goog.string.Const.unwrap(b)),"must provide non-empty justification");return goog.html.TrustedResourceUrl.createTrustedResourceUrlSecurityPrivateDoNotAccessOrElse(a)};goog.provide("goog.structs.Set");goog.require("goog.structs");goog.require("goog.structs.Collection");goog.require("goog.structs.Map");goog.structs.Set=function(a){this.map_=new goog.structs.Map;if(a){this.addAll(a)}};goog.structs.Set.getKey_=function(b){var a=typeof b;if(a=="object"&&b||a=="function"){return"o"+goog.getUid((b))}else{return a.substr(0,1)+b}};goog.structs.Set.prototype.getCount=function(){return this.map_.getCount()};goog.structs.Set.prototype.add=function(a){this.map_.set(goog.structs.Set.getKey_(a),a)};goog.structs.Set.prototype.addAll=function(c){var b=goog.structs.getValues(c);var a=b.length;for(var d=0;d<a;d++){this.add(b[d])}};goog.structs.Set.prototype.removeAll=function(c){var b=goog.structs.getValues(c);var a=b.length;for(var d=0;d<a;d++){this.remove(b[d])}};goog.structs.Set.prototype.remove=function(a){return this.map_.remove(goog.structs.Set.getKey_(a))};goog.structs.Set.prototype.clear=function(){this.map_.clear()};goog.structs.Set.prototype.isEmpty=function(){return this.map_.isEmpty()};goog.structs.Set.prototype.contains=function(a){return this.map_.containsKey(goog.structs.Set.getKey_(a))};goog.structs.Set.prototype.containsAll=function(a){return goog.structs.every(a,this.contains,this)};goog.structs.Set.prototype.intersection=function(c){var a=new goog.structs.Set();var b=goog.structs.getValues(c);for(var d=0;d<b.length;d++){var e=b[d];if(this.contains(e)){a.add(e)}}return a};goog.structs.Set.prototype.difference=function(b){var a=this.clone();a.removeAll(b);return a};goog.structs.Set.prototype.getValues=function(){return this.map_.getValues()};goog.structs.Set.prototype.clone=function(){return new goog.structs.Set(this)};goog.structs.Set.prototype.equals=function(a){return this.getCount()==goog.structs.getCount(a)&&this.isSubsetOf(a)};goog.structs.Set.prototype.isSubsetOf=function(a){var b=goog.structs.getCount(a);if(this.getCount()>b){return false}if(!(a instanceof goog.structs.Set)&&b>5){a=new goog.structs.Set(a)}return goog.structs.every(this,function(c){return goog.structs.contains(a,c)})};goog.structs.Set.prototype.__iterator__=function(a){return this.map_.__iterator__(false)};goog.provide("goog.debug");goog.require("goog.array");goog.require("goog.html.SafeHtml");goog.require("goog.html.SafeUrl");goog.require("goog.html.uncheckedconversions");goog.require("goog.string.Const");goog.require("goog.structs.Set");goog.require("goog.userAgent");goog.define("goog.debug.LOGGING_ENABLED",goog.DEBUG);goog.debug.catchErrors=function(b,a,d){var f=d||goog.global;var c=f.onerror;var e=!!a;if(goog.userAgent.WEBKIT&&!goog.userAgent.isVersionOrHigher("535.3")){e=!e}f.onerror=function(j,i,g,h,k){if(c){c(j,i,g,h,k)}b({message:j,fileName:i,line:g,col:h,error:k});return e}};goog.debug.expose=function(f,b){if(typeof f=="undefined"){return"undefined"}if(f==null){return"NULL"}var g=[];for(var a in f){if(!b&&goog.isFunction(f[a])){continue}var c=a+" = ";try{c+=f[a]}catch(d){c+="*** "+d+" ***"}g.push(c)}return g.join("\n")};goog.debug.deepExpose=function(c,a){var d=[];var b=function(m,j,i){var h=j+"  ";var g=new goog.structs.Set(i);var l=function(e){return e.replace(/\n/g,"\n"+j)};try{if(!goog.isDef(m)){d.push("undefined")}else{if(goog.isNull(m)){d.push("NULL")}else{if(goog.isString(m)){d.push('"'+l(m)+'"')}else{if(goog.isFunction(m)){d.push(l(String(m)))}else{if(goog.isObject(m)){if(g.contains(m)){d.push("*** reference loop detected ***")}else{g.add(m);d.push("{");for(var f in m){if(!a&&goog.isFunction(m[f])){continue}d.push("\n");d.push(h);d.push(f+" = ");b(m[f],h,g)}d.push("\n"+j+"}")}}else{d.push(m)}}}}}}catch(k){d.push("*** "+k+" ***")}};b(c,"",new goog.structs.Set());return d.join("")};goog.debug.exposeArray=function(a){var c=[];for(var b=0;b<a.length;b++){if(goog.isArray(a[b])){c.push(goog.debug.exposeArray(a[b]))}else{c.push(a[b])}}return"[ "+c.join(", ")+" ]"};goog.debug.exposeException=function(c,b){var a=goog.debug.exposeExceptionAsHtml(c,b);return goog.html.SafeHtml.unwrap(a)};goog.debug.exposeExceptionAsHtml=function(d,c){try{var g=goog.debug.normalizeErrorObject(d);var a=goog.debug.createViewSourceUrl_(g.fileName);var b=goog.html.SafeHtml.concat(goog.html.SafeHtml.htmlEscapePreservingNewlinesAndSpaces("Message: "+g.message+"\nUrl: "),goog.html.SafeHtml.create("a",{href:a,target:"_new"},g.fileName),goog.html.SafeHtml.htmlEscapePreservingNewlinesAndSpaces("\nLine: "+g.lineNumber+"\n\nBrowser stack:\n"+g.stack+"-> [end]\n\nJS stack traversal:\n"+goog.debug.getStacktrace(c)+"-> "));return b}catch(f){return goog.html.SafeHtml.htmlEscapePreservingNewlinesAndSpaces("Exception trying to expose exception! You win, we lose. "+f)}};goog.debug.createViewSourceUrl_=function(a){if(!goog.isDefAndNotNull(a)){a=""}if(!/^https?:\/\//i.test(a)){return goog.html.SafeUrl.fromConstant(goog.string.Const.from("sanitizedviewsrc"))}var b=goog.html.SafeUrl.sanitize(a);return goog.html.uncheckedconversions.safeUrlFromStringKnownToSatisfyTypeContract(goog.string.Const.from("view-source scheme plus HTTP/HTTPS URL"),"view-source:"+goog.html.SafeUrl.unwrap(b))};goog.debug.normalizeErrorObject=function(d){var b=goog.getObjectByName("window.location.href");if(goog.isString(d)){return{message:d,name:"Unknown error",lineNumber:"Not available",fileName:b,stack:"Not available"}}var a,g;var c=false;try{a=d.lineNumber||d.line||"Not available"}catch(f){a="Not available";c=true}try{g=d.fileName||d.filename||d.sourceURL||goog.global["$googDebugFname"]||b}catch(f){g="Not available";c=true}if(c||!d.lineNumber||!d.fileName||!d.stack||!d.message||!d.name){return{message:d.message||"Not available",name:d.name||"UnknownError",lineNumber:a,fileName:g,stack:d.stack||"Not available"}}return d};goog.debug.enhanceError=function(c,d){var b;if(typeof c=="string"){b=Error(c);if(Error.captureStackTrace){Error.captureStackTrace(b,goog.debug.enhanceError)}}else{b=c}if(!b.stack){b.stack=goog.debug.getStacktrace(goog.debug.enhanceError)}if(d){var a=0;while(b["message"+a]){++a}b["message"+a]=String(d)}return b};goog.debug.getStacktraceSimple=function(b){if(goog.STRICT_MODE_COMPATIBLE){var a=goog.debug.getNativeStackTrace_(goog.debug.getStacktraceSimple);if(a){return a}}var g=[];var c=arguments.callee.caller;var f=0;while(c&&(!b||f<b)){g.push(goog.debug.getFunctionName(c));g.push("()\n");try{c=c.caller}catch(d){g.push("[exception trying to get caller]\n");break}f++;if(f>=goog.debug.MAX_STACK_DEPTH){g.push("[...long stack...]");break}}if(b&&f>=b){g.push("[...reached max depth limit...]")}else{g.push("[end]")}return g.join("")};goog.debug.MAX_STACK_DEPTH=50;goog.debug.getNativeStackTrace_=function(b){var d=new Error();if(Error.captureStackTrace){Error.captureStackTrace(d,b);return String(d.stack)}else{try{throw d}catch(c){d=c}var a=d.stack;if(a){return String(a)}}return null};goog.debug.getStacktrace=function(b){var a;if(goog.STRICT_MODE_COMPATIBLE){var c=b||goog.debug.getStacktrace;a=goog.debug.getNativeStackTrace_(c)}if(!a){a=goog.debug.getStacktraceHelper_(b||arguments.callee.caller,[])}return a};goog.debug.getStacktraceHelper_=function(g,b){var j=[];if(goog.array.contains(b,g)){j.push("[...circular reference...]")}else{if(g&&b.length<goog.debug.MAX_STACK_DEPTH){j.push(goog.debug.getFunctionName(g)+"(");var c=g.arguments;for(var d=0;c&&d<c.length;d++){if(d>0){j.push(", ")}var f;var a=c[d];switch(typeof a){case"object":f=a?"object":"null";break;case"string":f=a;break;case"number":f=String(a);break;case"boolean":f=a?"true":"false";break;case"function":f=goog.debug.getFunctionName(a);f=f?f:"[fn]";break;case"undefined":default:f=typeof a;break}if(f.length>40){f=f.substr(0,40)+"..."}j.push(f)}b.push(g);j.push(")\n");try{j.push(goog.debug.getStacktraceHelper_(g.caller,b))}catch(h){j.push("[exception trying to get caller]\n")}}else{if(g){j.push("[...long stack...]")}else{j.push("[end]")}}}return j.join("")};goog.debug.setFunctionResolver=function(a){goog.debug.fnNameResolver_=a};goog.debug.getFunctionName=function(c){if(goog.debug.fnNameCache_[c]){return goog.debug.fnNameCache_[c]}if(goog.debug.fnNameResolver_){var a=goog.debug.fnNameResolver_(c);if(a){goog.debug.fnNameCache_[c]=a;return a}}var b=String(c);if(!goog.debug.fnNameCache_[b]){var d=/function ([^\(]+)/.exec(b);if(d){var e=d[1];goog.debug.fnNameCache_[b]=e}else{goog.debug.fnNameCache_[b]="[Anonymous]"}}return goog.debug.fnNameCache_[b]};goog.debug.makeWhitespaceVisible=function(a){return a.replace(/ /g,"[_]").replace(/\f/g,"[f]").replace(/\n/g,"[n]\n").replace(/\r/g,"[r]").replace(/\t/g,"[t]")};goog.debug.fnNameCache_={};goog.debug.fnNameResolver_;goog.provide("goog.debug.LogRecord");goog.debug.LogRecord=function(e,d,b,a,c){this.reset(e,d,b,a,c)};goog.debug.LogRecord.prototype.time_;goog.debug.LogRecord.prototype.level_;goog.debug.LogRecord.prototype.msg_;goog.debug.LogRecord.prototype.loggerName_;goog.debug.LogRecord.prototype.sequenceNumber_=0;goog.debug.LogRecord.prototype.exception_=null;goog.define("goog.debug.LogRecord.ENABLE_SEQUENCE_NUMBERS",true);goog.debug.LogRecord.nextSequenceNumber_=0;goog.debug.LogRecord.prototype.reset=function(e,d,b,a,c){if(goog.debug.LogRecord.ENABLE_SEQUENCE_NUMBERS){this.sequenceNumber_=typeof c=="number"?c:goog.debug.LogRecord.nextSequenceNumber_++}this.time_=a||goog.now();this.level_=e;this.msg_=d;this.loggerName_=b;delete this.exception_};goog.debug.LogRecord.prototype.getLoggerName=function(){return this.loggerName_};goog.debug.LogRecord.prototype.getException=function(){return this.exception_};goog.debug.LogRecord.prototype.setException=function(a){this.exception_=a};goog.debug.LogRecord.prototype.setLoggerName=function(a){this.loggerName_=a};goog.debug.LogRecord.prototype.getLevel=function(){return this.level_};goog.debug.LogRecord.prototype.setLevel=function(a){this.level_=a};goog.debug.LogRecord.prototype.getMessage=function(){return this.msg_};goog.debug.LogRecord.prototype.setMessage=function(a){this.msg_=a};goog.debug.LogRecord.prototype.getMillis=function(){return this.time_};goog.debug.LogRecord.prototype.setMillis=function(a){this.time_=a};goog.debug.LogRecord.prototype.getSequenceNumber=function(){return this.sequenceNumber_};goog.provide("goog.debug.LogBuffer");goog.require("goog.asserts");goog.require("goog.debug.LogRecord");goog.debug.LogBuffer=function(){goog.asserts.assert(goog.debug.LogBuffer.isBufferingEnabled(),"Cannot use goog.debug.LogBuffer without defining goog.debug.LogBuffer.CAPACITY.");this.clear()};goog.debug.LogBuffer.getInstance=function(){if(!goog.debug.LogBuffer.instance_){goog.debug.LogBuffer.instance_=new goog.debug.LogBuffer()}return goog.debug.LogBuffer.instance_};goog.define("goog.debug.LogBuffer.CAPACITY",0);goog.debug.LogBuffer.prototype.buffer_;goog.debug.LogBuffer.prototype.curIndex_;goog.debug.LogBuffer.prototype.isFull_;goog.debug.LogBuffer.prototype.addRecord=function(e,d,b){var c=(this.curIndex_+1)%goog.debug.LogBuffer.CAPACITY;this.curIndex_=c;if(this.isFull_){var a=this.buffer_[c];a.reset(e,d,b);return a}this.isFull_=c==goog.debug.LogBuffer.CAPACITY-1;return this.buffer_[c]=new goog.debug.LogRecord(e,d,b)};goog.debug.LogBuffer.isBufferingEnabled=function(){return goog.debug.LogBuffer.CAPACITY>0};goog.debug.LogBuffer.prototype.clear=function(){this.buffer_=new Array(goog.debug.LogBuffer.CAPACITY);this.curIndex_=-1;this.isFull_=false};goog.debug.LogBuffer.prototype.forEachRecord=function(d){var a=this.buffer_;if(!a[0]){return}var c=this.curIndex_;var b=this.isFull_?c:-1;do{b=(b+1)%goog.debug.LogBuffer.CAPACITY;d((a[b]))}while(b!=c)};goog.provide("goog.debug.LogManager");goog.provide("goog.debug.Loggable");goog.provide("goog.debug.Logger");goog.provide("goog.debug.Logger.Level");goog.require("goog.array");goog.require("goog.asserts");goog.require("goog.debug");goog.require("goog.debug.LogBuffer");goog.require("goog.debug.LogRecord");goog.debug.Loggable;goog.debug.Logger=function(a){this.name_=a;this.parent_=null;this.level_=null;this.children_=null;this.handlers_=null};goog.debug.Logger.ROOT_LOGGER_NAME="";goog.define("goog.debug.Logger.ENABLE_HIERARCHY",true);if(!goog.debug.Logger.ENABLE_HIERARCHY){goog.debug.Logger.rootHandlers_=[];goog.debug.Logger.rootLevel_}goog.debug.Logger.Level=function(a,b){this.name=a;this.value=b};goog.debug.Logger.Level.prototype.toString=function(){return this.name};goog.debug.Logger.Level.OFF=new goog.debug.Logger.Level("OFF",Infinity);goog.debug.Logger.Level.SHOUT=new goog.debug.Logger.Level("SHOUT",1200);goog.debug.Logger.Level.SEVERE=new goog.debug.Logger.Level("SEVERE",1000);goog.debug.Logger.Level.WARNING=new goog.debug.Logger.Level("WARNING",900);goog.debug.Logger.Level.INFO=new goog.debug.Logger.Level("INFO",800);goog.debug.Logger.Level.CONFIG=new goog.debug.Logger.Level("CONFIG",700);goog.debug.Logger.Level.FINE=new goog.debug.Logger.Level("FINE",500);goog.debug.Logger.Level.FINER=new goog.debug.Logger.Level("FINER",400);goog.debug.Logger.Level.FINEST=new goog.debug.Logger.Level("FINEST",300);goog.debug.Logger.Level.ALL=new goog.debug.Logger.Level("ALL",0);goog.debug.Logger.Level.PREDEFINED_LEVELS=[goog.debug.Logger.Level.OFF,goog.debug.Logger.Level.SHOUT,goog.debug.Logger.Level.SEVERE,goog.debug.Logger.Level.WARNING,goog.debug.Logger.Level.INFO,goog.debug.Logger.Level.CONFIG,goog.debug.Logger.Level.FINE,goog.debug.Logger.Level.FINER,goog.debug.Logger.Level.FINEST,goog.debug.Logger.Level.ALL];goog.debug.Logger.Level.predefinedLevelsCache_=null;goog.debug.Logger.Level.createPredefinedLevelsCache_=function(){goog.debug.Logger.Level.predefinedLevelsCache_={};for(var a=0,b;b=goog.debug.Logger.Level.PREDEFINED_LEVELS[a];a++){goog.debug.Logger.Level.predefinedLevelsCache_[b.value]=b;goog.debug.Logger.Level.predefinedLevelsCache_[b.name]=b}};goog.debug.Logger.Level.getPredefinedLevel=function(a){if(!goog.debug.Logger.Level.predefinedLevelsCache_){goog.debug.Logger.Level.createPredefinedLevelsCache_()}return goog.debug.Logger.Level.predefinedLevelsCache_[a]||null};goog.debug.Logger.Level.getPredefinedLevelByValue=function(b){if(!goog.debug.Logger.Level.predefinedLevelsCache_){goog.debug.Logger.Level.createPredefinedLevelsCache_()}if(b in goog.debug.Logger.Level.predefinedLevelsCache_){return goog.debug.Logger.Level.predefinedLevelsCache_[b]}for(var a=0;a<goog.debug.Logger.Level.PREDEFINED_LEVELS.length;++a){var c=goog.debug.Logger.Level.PREDEFINED_LEVELS[a];if(c.value<=b){return c}}return null};goog.debug.Logger.getLogger=function(a){return goog.debug.LogManager.getLogger(a)};goog.debug.Logger.logToProfilers=function(a){if(goog.global.console){if(goog.global.console["timeStamp"]){goog.global.console["timeStamp"](a)}else{if(goog.global.console["markTimeline"]){goog.global.console["markTimeline"](a)}}}if(goog.global.msWriteProfilerMark){goog.global.msWriteProfilerMark(a)}};goog.debug.Logger.prototype.getName=function(){return this.name_};goog.debug.Logger.prototype.addHandler=function(a){if(goog.debug.LOGGING_ENABLED){if(goog.debug.Logger.ENABLE_HIERARCHY){if(!this.handlers_){this.handlers_=[]}this.handlers_.push(a)}else{goog.asserts.assert(!this.name_,"Cannot call addHandler on a non-root logger when goog.debug.Logger.ENABLE_HIERARCHY is false.");goog.debug.Logger.rootHandlers_.push(a)}}};goog.debug.Logger.prototype.removeHandler=function(b){if(goog.debug.LOGGING_ENABLED){var a=goog.debug.Logger.ENABLE_HIERARCHY?this.handlers_:goog.debug.Logger.rootHandlers_;return !!a&&goog.array.remove(a,b)}else{return false}};goog.debug.Logger.prototype.getParent=function(){return this.parent_};goog.debug.Logger.prototype.getChildren=function(){if(!this.children_){this.children_={}}return this.children_};goog.debug.Logger.prototype.setLevel=function(a){if(goog.debug.LOGGING_ENABLED){if(goog.debug.Logger.ENABLE_HIERARCHY){this.level_=a}else{goog.asserts.assert(!this.name_,"Cannot call setLevel() on a non-root logger when goog.debug.Logger.ENABLE_HIERARCHY is false.");goog.debug.Logger.rootLevel_=a}}};goog.debug.Logger.prototype.getLevel=function(){return goog.debug.LOGGING_ENABLED?this.level_:goog.debug.Logger.Level.OFF};goog.debug.Logger.prototype.getEffectiveLevel=function(){if(!goog.debug.LOGGING_ENABLED){return goog.debug.Logger.Level.OFF}if(!goog.debug.Logger.ENABLE_HIERARCHY){return goog.debug.Logger.rootLevel_}if(this.level_){return this.level_}if(this.parent_){return this.parent_.getEffectiveLevel()}goog.asserts.fail("Root logger has no level set.");return null};goog.debug.Logger.prototype.isLoggable=function(a){return goog.debug.LOGGING_ENABLED&&a.value>=this.getEffectiveLevel().value};goog.debug.Logger.prototype.log=function(c,b,a){if(goog.debug.LOGGING_ENABLED&&this.isLoggable(c)){if(goog.isFunction(b)){b=b()}this.doLogRecord_(this.getLogRecord(c,b,a))}};goog.debug.Logger.prototype.getLogRecord=function(d,c,a){if(goog.debug.LogBuffer.isBufferingEnabled()){var b=goog.debug.LogBuffer.getInstance().addRecord(d,c,this.name_)}else{b=new goog.debug.LogRecord(d,String(c),this.name_)}if(a){b.setException(a)}return b};goog.debug.Logger.prototype.shout=function(b,a){if(goog.debug.LOGGING_ENABLED){this.log(goog.debug.Logger.Level.SHOUT,b,a)}};goog.debug.Logger.prototype.severe=function(b,a){if(goog.debug.LOGGING_ENABLED){this.log(goog.debug.Logger.Level.SEVERE,b,a)}};goog.debug.Logger.prototype.warning=function(b,a){if(goog.debug.LOGGING_ENABLED){this.log(goog.debug.Logger.Level.WARNING,b,a)}};goog.debug.Logger.prototype.info=function(b,a){if(goog.debug.LOGGING_ENABLED){this.log(goog.debug.Logger.Level.INFO,b,a)}};goog.debug.Logger.prototype.config=function(b,a){if(goog.debug.LOGGING_ENABLED){this.log(goog.debug.Logger.Level.CONFIG,b,a)}};goog.debug.Logger.prototype.fine=function(b,a){if(goog.debug.LOGGING_ENABLED){this.log(goog.debug.Logger.Level.FINE,b,a)}};goog.debug.Logger.prototype.finer=function(b,a){if(goog.debug.LOGGING_ENABLED){this.log(goog.debug.Logger.Level.FINER,b,a)}};goog.debug.Logger.prototype.finest=function(b,a){if(goog.debug.LOGGING_ENABLED){this.log(goog.debug.Logger.Level.FINEST,b,a)}};goog.debug.Logger.prototype.logRecord=function(a){if(goog.debug.LOGGING_ENABLED&&this.isLoggable(a.getLevel())){this.doLogRecord_(a)}};goog.debug.Logger.prototype.doLogRecord_=function(d){goog.debug.Logger.logToProfilers("log:"+d.getMessage());if(goog.debug.Logger.ENABLE_HIERARCHY){var c=this;while(c){c.callPublish_(d);c=c.getParent()}}else{for(var a=0,b;b=goog.debug.Logger.rootHandlers_[a++];){b(d)}}};goog.debug.Logger.prototype.callPublish_=function(c){if(this.handlers_){for(var a=0,b;b=this.handlers_[a];a++){b(c)}}};goog.debug.Logger.prototype.setParent_=function(a){this.parent_=a};goog.debug.Logger.prototype.addChild_=function(b,a){this.getChildren()[b]=a};goog.debug.LogManager={};goog.debug.LogManager.loggers_={};goog.debug.LogManager.rootLogger_=null;goog.debug.LogManager.initialize=function(){if(!goog.debug.LogManager.rootLogger_){goog.debug.LogManager.rootLogger_=new goog.debug.Logger(goog.debug.Logger.ROOT_LOGGER_NAME);goog.debug.LogManager.loggers_[goog.debug.Logger.ROOT_LOGGER_NAME]=goog.debug.LogManager.rootLogger_;goog.debug.LogManager.rootLogger_.setLevel(goog.debug.Logger.Level.CONFIG)}};goog.debug.LogManager.getLoggers=function(){return goog.debug.LogManager.loggers_};goog.debug.LogManager.getRoot=function(){goog.debug.LogManager.initialize();return(goog.debug.LogManager.rootLogger_)};goog.debug.LogManager.getLogger=function(b){goog.debug.LogManager.initialize();var a=goog.debug.LogManager.loggers_[b];return a||goog.debug.LogManager.createLogger_(b)};goog.debug.LogManager.createFunctionForCatchErrors=function(a){return function(c){var b=a||goog.debug.LogManager.getRoot();b.severe("Error: "+c.message+" ("+c.fileName+" @ Line: "+c.line+")")}};goog.debug.LogManager.createLogger_=function(c){var b=new goog.debug.Logger(c);if(goog.debug.Logger.ENABLE_HIERARCHY){var f=c.lastIndexOf(".");var e=c.substr(0,f);var a=c.substr(f+1);var d=goog.debug.LogManager.getLogger(e);d.addChild_(a,b);b.setParent_(d)}goog.debug.LogManager.loggers_[c]=b;return b};goog.provide("goog.log");goog.provide("goog.log.Level");goog.provide("goog.log.LogRecord");goog.provide("goog.log.Logger");goog.require("goog.debug");goog.require("goog.debug.LogManager");goog.require("goog.debug.LogRecord");goog.require("goog.debug.Logger");goog.define("goog.log.ENABLED",goog.debug.LOGGING_ENABLED);goog.log.ROOT_LOGGER_NAME=goog.debug.Logger.ROOT_LOGGER_NAME;goog.log.Logger=goog.debug.Logger;goog.log.Level=goog.debug.Logger.Level;goog.log.LogRecord=goog.debug.LogRecord;goog.log.getLogger=function(b,c){if(goog.log.ENABLED){var a=goog.debug.LogManager.getLogger(b);if(c&&a){a.setLevel(c)}return a}else{return null}};goog.log.addHandler=function(a,b){if(goog.log.ENABLED&&a){a.addHandler(b)}};goog.log.removeHandler=function(a,b){if(goog.log.ENABLED&&a){return a.removeHandler(b)}else{return false}};goog.log.log=function(a,d,c,b){if(goog.log.ENABLED&&a){a.log(d,c,b)}};goog.log.error=function(a,c,b){if(goog.log.ENABLED&&a){a.severe(c,b)}};goog.log.warning=function(a,c,b){if(goog.log.ENABLED&&a){a.warning(c,b)}};goog.log.info=function(a,c,b){if(goog.log.ENABLED&&a){a.info(c,b)}};goog.log.fine=function(a,c,b){if(goog.log.ENABLED&&a){a.fine(c,b)}};goog.provide("goog.net.XhrIo");goog.provide("goog.net.XhrIo.ResponseType");goog.require("goog.Timer");goog.require("goog.array");goog.require("goog.debug.entryPointRegistry");goog.require("goog.events.EventTarget");goog.require("goog.json");goog.require("goog.log");goog.require("goog.net.ErrorCode");goog.require("goog.net.EventType");goog.require("goog.net.HttpStatus");goog.require("goog.net.XmlHttp");goog.require("goog.object");goog.require("goog.string");goog.require("goog.structs");goog.require("goog.structs.Map");goog.require("goog.uri.utils");goog.require("goog.userAgent");goog.forwardDeclare("goog.Uri");goog.net.XhrIo=function(a){goog.net.XhrIo.base(this,"constructor");this.headers=new goog.structs.Map();this.xmlHttpFactory_=a||null;this.active_=false;this.xhr_=null;this.xhrOptions_=null;this.lastUri_="";this.lastMethod_="";this.lastErrorCode_=goog.net.ErrorCode.NO_ERROR;this.lastError_="";this.errorDispatched_=false;this.inSend_=false;this.inOpen_=false;this.inAbort_=false;this.timeoutInterval_=0;this.timeoutId_=null;this.responseType_=goog.net.XhrIo.ResponseType.DEFAULT;this.withCredentials_=false;this.useXhr2Timeout_=false};goog.inherits(goog.net.XhrIo,goog.events.EventTarget);goog.net.XhrIo.ResponseType={DEFAULT:"",TEXT:"text",DOCUMENT:"document",BLOB:"blob",ARRAY_BUFFER:"arraybuffer"};goog.net.XhrIo.prototype.logger_=goog.log.getLogger("goog.net.XhrIo");goog.net.XhrIo.CONTENT_TYPE_HEADER="Content-Type";goog.net.XhrIo.HTTP_SCHEME_PATTERN=/^https?$/i;goog.net.XhrIo.METHODS_WITH_FORM_DATA=["POST","PUT"];goog.net.XhrIo.FORM_CONTENT_TYPE="application/x-www-form-urlencoded;charset=utf-8";goog.net.XhrIo.XHR2_TIMEOUT_="timeout";goog.net.XhrIo.XHR2_ON_TIMEOUT_="ontimeout";goog.net.XhrIo.sendInstances_=[];goog.net.XhrIo.send=function(f,d,g,h,c,e,b){var a=new goog.net.XhrIo();goog.net.XhrIo.sendInstances_.push(a);if(d){a.listen(goog.net.EventType.COMPLETE,d)}a.listenOnce(goog.net.EventType.READY,a.cleanupSend_);if(e){a.setTimeoutInterval(e)}if(b){a.setWithCredentials(b)}a.send(f,g,h,c);return a};goog.net.XhrIo.cleanup=function(){var a=goog.net.XhrIo.sendInstances_;while(a.length){a.pop().dispose()}};goog.net.XhrIo.protectEntryPoints=function(a){goog.net.XhrIo.prototype.onReadyStateChangeEntryPoint_=a.protectEntryPoint(goog.net.XhrIo.prototype.onReadyStateChangeEntryPoint_)};goog.net.XhrIo.prototype.cleanupSend_=function(){this.dispose();goog.array.remove(goog.net.XhrIo.sendInstances_,this)};goog.net.XhrIo.prototype.getTimeoutInterval=function(){return this.timeoutInterval_};goog.net.XhrIo.prototype.setTimeoutInterval=function(a){this.timeoutInterval_=Math.max(0,a)};goog.net.XhrIo.prototype.setResponseType=function(a){this.responseType_=a};goog.net.XhrIo.prototype.getResponseType=function(){return this.responseType_};goog.net.XhrIo.prototype.setWithCredentials=function(a){this.withCredentials_=a};goog.net.XhrIo.prototype.getWithCredentials=function(){return this.withCredentials_};goog.net.XhrIo.prototype.send=function(b,i,g,d){if(this.xhr_){throw Error("[goog.net.XhrIo] Object is active with another request="+this.lastUri_+"; newUri="+b)}var a=i?i.toUpperCase():"GET";this.lastUri_=b;this.lastError_="";this.lastErrorCode_=goog.net.ErrorCode.NO_ERROR;this.lastMethod_=a;this.errorDispatched_=false;this.active_=true;this.xhr_=this.createXhr();this.xhrOptions_=this.xmlHttpFactory_?this.xmlHttpFactory_.getOptions():goog.net.XmlHttp.getOptions();this.xhr_.onreadystatechange=goog.bind(this.onReadyStateChange_,this);try{goog.log.fine(this.logger_,this.formatMsg_("Opening Xhr"));this.inOpen_=true;this.xhr_.open(a,String(b),true);this.inOpen_=false}catch(f){goog.log.fine(this.logger_,this.formatMsg_("Error opening Xhr: "+f.message));this.error_(goog.net.ErrorCode.EXCEPTION,f);return}var h=g||"";var c=this.headers.clone();if(d){goog.structs.forEach(d,function(l,k){c.set(k,l)})}var e=goog.array.find(c.getKeys(),goog.net.XhrIo.isContentTypeHeader_);var j=(goog.global.FormData&&(h instanceof goog.global.FormData));if(goog.array.contains(goog.net.XhrIo.METHODS_WITH_FORM_DATA,a)&&!e&&!j){c.set(goog.net.XhrIo.CONTENT_TYPE_HEADER,goog.net.XhrIo.FORM_CONTENT_TYPE)}c.forEach(function(l,k){this.xhr_.setRequestHeader(k,l)},this);if(this.responseType_){this.xhr_.responseType=this.responseType_}if(goog.object.containsKey(this.xhr_,"withCredentials")){this.xhr_.withCredentials=this.withCredentials_}try{this.cleanUpTimeoutTimer_();if(this.timeoutInterval_>0){this.useXhr2Timeout_=goog.net.XhrIo.shouldUseXhr2Timeout_(this.xhr_);goog.log.fine(this.logger_,this.formatMsg_("Will abort after "+this.timeoutInterval_+"ms if incomplete, xhr2 "+this.useXhr2Timeout_));if(this.useXhr2Timeout_){this.xhr_[goog.net.XhrIo.XHR2_TIMEOUT_]=this.timeoutInterval_;this.xhr_[goog.net.XhrIo.XHR2_ON_TIMEOUT_]=goog.bind(this.timeout_,this)}else{this.timeoutId_=goog.Timer.callOnce(this.timeout_,this.timeoutInterval_,this)}}goog.log.fine(this.logger_,this.formatMsg_("Sending request"));this.inSend_=true;this.xhr_.send(h);this.inSend_=false}catch(f){goog.log.fine(this.logger_,this.formatMsg_("Send error: "+f.message));this.error_(goog.net.ErrorCode.EXCEPTION,f)}};goog.net.XhrIo.shouldUseXhr2Timeout_=function(a){return goog.userAgent.IE&&goog.userAgent.isVersionOrHigher(9)&&goog.isNumber(a[goog.net.XhrIo.XHR2_TIMEOUT_])&&goog.isDef(a[goog.net.XhrIo.XHR2_ON_TIMEOUT_])};goog.net.XhrIo.isContentTypeHeader_=function(a){return goog.string.caseInsensitiveEquals(goog.net.XhrIo.CONTENT_TYPE_HEADER,a)};goog.net.XhrIo.prototype.createXhr=function(){return this.xmlHttpFactory_?this.xmlHttpFactory_.createInstance():goog.net.XmlHttp()};goog.net.XhrIo.prototype.timeout_=function(){if(typeof goog=="undefined"){}else{if(this.xhr_){this.lastError_="Timed out after "+this.timeoutInterval_+"ms, aborting";this.lastErrorCode_=goog.net.ErrorCode.TIMEOUT;goog.log.fine(this.logger_,this.formatMsg_(this.lastError_));this.dispatchEvent(goog.net.EventType.TIMEOUT);this.abort(goog.net.ErrorCode.TIMEOUT)}}};goog.net.XhrIo.prototype.error_=function(b,a){this.active_=false;if(this.xhr_){this.inAbort_=true;this.xhr_.abort();this.inAbort_=false}this.lastError_=a;this.lastErrorCode_=b;this.dispatchErrors_();this.cleanUpXhr_()};goog.net.XhrIo.prototype.dispatchErrors_=function(){if(!this.errorDispatched_){this.errorDispatched_=true;this.dispatchEvent(goog.net.EventType.COMPLETE);this.dispatchEvent(goog.net.EventType.ERROR)}};goog.net.XhrIo.prototype.abort=function(a){if(this.xhr_&&this.active_){goog.log.fine(this.logger_,this.formatMsg_("Aborting"));this.active_=false;this.inAbort_=true;this.xhr_.abort();this.inAbort_=false;this.lastErrorCode_=a||goog.net.ErrorCode.ABORT;this.dispatchEvent(goog.net.EventType.COMPLETE);this.dispatchEvent(goog.net.EventType.ABORT);this.cleanUpXhr_()}};goog.net.XhrIo.prototype.disposeInternal=function(){if(this.xhr_){if(this.active_){this.active_=false;this.inAbort_=true;this.xhr_.abort();this.inAbort_=false}this.cleanUpXhr_(true)}goog.net.XhrIo.base(this,"disposeInternal")};goog.net.XhrIo.prototype.onReadyStateChange_=function(){if(this.isDisposed()){return}if(!this.inOpen_&&!this.inSend_&&!this.inAbort_){this.onReadyStateChangeEntryPoint_()}else{this.onReadyStateChangeHelper_()}};goog.net.XhrIo.prototype.onReadyStateChangeEntryPoint_=function(){this.onReadyStateChangeHelper_()};goog.net.XhrIo.prototype.onReadyStateChangeHelper_=function(){if(!this.active_){return}if(typeof goog=="undefined"){}else{if(this.xhrOptions_[goog.net.XmlHttp.OptionType.LOCAL_REQUEST_ERROR]&&this.getReadyState()==goog.net.XmlHttp.ReadyState.COMPLETE&&this.getStatus()==2){goog.log.fine(this.logger_,this.formatMsg_("Local request error detected and ignored"))}else{if(this.inSend_&&this.getReadyState()==goog.net.XmlHttp.ReadyState.COMPLETE){goog.Timer.callOnce(this.onReadyStateChange_,0,this);return}this.dispatchEvent(goog.net.EventType.READY_STATE_CHANGE);if(this.isComplete()){goog.log.fine(this.logger_,this.formatMsg_("Request complete"));this.active_=false;try{if(this.isSuccess()){this.dispatchEvent(goog.net.EventType.COMPLETE);this.dispatchEvent(goog.net.EventType.SUCCESS)}else{this.lastErrorCode_=goog.net.ErrorCode.HTTP_ERROR;this.lastError_=this.getStatusText()+" ["+this.getStatus()+"]";this.dispatchErrors_()}}finally{this.cleanUpXhr_()}}}}};goog.net.XhrIo.prototype.cleanUpXhr_=function(c){if(this.xhr_){this.cleanUpTimeoutTimer_();var d=this.xhr_;var a=this.xhrOptions_[goog.net.XmlHttp.OptionType.USE_NULL_FUNCTION]?goog.nullFunction:null;this.xhr_=null;this.xhrOptions_=null;if(!c){this.dispatchEvent(goog.net.EventType.READY)}try{d.onreadystatechange=a}catch(b){goog.log.error(this.logger_,"Problem encountered resetting onreadystatechange: "+b.message)}}};goog.net.XhrIo.prototype.cleanUpTimeoutTimer_=function(){if(this.xhr_&&this.useXhr2Timeout_){this.xhr_[goog.net.XhrIo.XHR2_ON_TIMEOUT_]=null}if(goog.isNumber(this.timeoutId_)){goog.Timer.clear(this.timeoutId_);this.timeoutId_=null}};goog.net.XhrIo.prototype.isActive=function(){return !!this.xhr_};goog.net.XhrIo.prototype.isComplete=function(){return this.getReadyState()==goog.net.XmlHttp.ReadyState.COMPLETE};goog.net.XhrIo.prototype.isSuccess=function(){var a=this.getStatus();return goog.net.HttpStatus.isSuccess(a)||a===0&&!this.isLastUriEffectiveSchemeHttp_()};goog.net.XhrIo.prototype.isLastUriEffectiveSchemeHttp_=function(){var a=goog.uri.utils.getEffectiveScheme(String(this.lastUri_));return goog.net.XhrIo.HTTP_SCHEME_PATTERN.test(a)};goog.net.XhrIo.prototype.getReadyState=function(){return this.xhr_?(this.xhr_.readyState):goog.net.XmlHttp.ReadyState.UNINITIALIZED};goog.net.XhrIo.prototype.getStatus=function(){try{return this.getReadyState()>goog.net.XmlHttp.ReadyState.LOADED?this.xhr_.status:-1}catch(a){return -1}};goog.net.XhrIo.prototype.getStatusText=function(){try{return this.getReadyState()>goog.net.XmlHttp.ReadyState.LOADED?this.xhr_.statusText:""}catch(a){goog.log.fine(this.logger_,"Can not get status: "+a.message);return""}};goog.net.XhrIo.prototype.getLastUri=function(){return String(this.lastUri_)};goog.net.XhrIo.prototype.getResponseText=function(){try{return this.xhr_?this.xhr_.responseText:""}catch(a){goog.log.fine(this.logger_,"Can not get responseText: "+a.message);return""}};goog.net.XhrIo.prototype.getResponseBody=function(){try{if(this.xhr_&&"responseBody" in this.xhr_){return this.xhr_.responseBody}}catch(a){goog.log.fine(this.logger_,"Can not get responseBody: "+a.message)}return null};goog.net.XhrIo.prototype.getResponseXml=function(){try{return this.xhr_?this.xhr_.responseXML:null}catch(a){goog.log.fine(this.logger_,"Can not get responseXML: "+a.message);return null}};goog.net.XhrIo.prototype.getResponseJson=function(a){if(!this.xhr_){return undefined}var b=this.xhr_.responseText;if(a&&b.indexOf(a)==0){b=b.substring(a.length)}return goog.json.parse(b)};goog.net.XhrIo.prototype.getResponse=function(){try{if(!this.xhr_){return null}if("response" in this.xhr_){return this.xhr_.response}switch(this.responseType_){case goog.net.XhrIo.ResponseType.DEFAULT:case goog.net.XhrIo.ResponseType.TEXT:return this.xhr_.responseText;case goog.net.XhrIo.ResponseType.ARRAY_BUFFER:if("mozResponseArrayBuffer" in this.xhr_){return this.xhr_.mozResponseArrayBuffer}}goog.log.error(this.logger_,"Response type "+this.responseType_+" is not supported on this browser");return null}catch(a){goog.log.fine(this.logger_,"Can not get response: "+a.message);return null}};goog.net.XhrIo.prototype.getResponseHeader=function(a){return this.xhr_&&this.isComplete()?this.xhr_.getResponseHeader(a):undefined};goog.net.XhrIo.prototype.getAllResponseHeaders=function(){return this.xhr_&&this.isComplete()?this.xhr_.getAllResponseHeaders():""};goog.net.XhrIo.prototype.getResponseHeaders=function(){var c={};var b=this.getAllResponseHeaders().split("\r\n");for(var a=0;a<b.length;a++){if(goog.string.isEmptyOrWhitespace(b[a])){continue}var d=goog.string.splitLimit(b[a],": ",2);if(c[d[0]]){c[d[0]]+=", "+d[1]}else{c[d[0]]=d[1]}}return c};goog.net.XhrIo.prototype.getLastErrorCode=function(){return this.lastErrorCode_};goog.net.XhrIo.prototype.getLastError=function(){return goog.isString(this.lastError_)?this.lastError_:String(this.lastError_)};goog.net.XhrIo.prototype.formatMsg_=function(a){return a+" ["+this.lastMethod_+" "+this.lastUri_+" "+this.getStatus()+"]"};goog.debug.entryPointRegistry.register(function(a){goog.net.XhrIo.prototype.onReadyStateChangeEntryPoint_=a(goog.net.XhrIo.prototype.onReadyStateChangeEntryPoint_)});goog.provide("au.upldr.upload.XhrIo");goog.require("goog.net.XhrIo");goog.require("goog.Uri");goog.require("au.upldr.events.ProgressEvent");au.upldr.upload.XhrIo=function(a){goog.base(this,a)};goog.inherits(au.upldr.upload.XhrIo,goog.net.XhrIo);au.upldr.upload.XhrIo.getInstance=function(a){return new au.upldr.upload.XhrIo(a)};au.upldr.upload.XhrIo.prototype.send=function(b,h,f,d){if(this.xhr_){throw Error("[au.upldr.upload.XhrIo] Object is active with another request")}var a=h?h.toUpperCase():"GET";this.lastUri_=(b);this.lastError_="";this.lastErrorCode_=goog.net.ErrorCode.NO_ERROR;this.lastMethod_=a;this.errorDispatched_=false;this.active_=true;this.xhr_=this.createXhr();if(goog.events.hasListener(this,goog.net.EventType.PROGRESS)){var i=this.xhr_.upload;i.onprogress=goog.bind(this.xhr_uploadProgressHandler_,this)}this.xhrOptions_=this.xmlHttpFactory_?this.xmlHttpFactory_.getOptions():goog.net.XmlHttp.getOptions();this.xhr_.onreadystatechange=goog.bind(this.onReadyStateChange_,this);try{this.logger_.fine(this.formatMsg_("Opening Xhr"));this.inOpen_=true;this.xhr_.open(a,this.lastUri_,true);this.inOpen_=false}catch(e){this.logger_.warning(this.formatMsg_("Error opening Xhr: "+e.message));this.error_(goog.net.ErrorCode.EXCEPTION,e);return}var g=f||"";var c=this.headers.clone();if(d){goog.structs.forEach(d,function(k,j){c.set(j,k)})}if(a=="POST"&&!(f instanceof FormData)&&!c.containsKey(goog.net.XhrIo.CONTENT_TYPE_HEADER)){c.set(goog.net.XhrIo.CONTENT_TYPE_HEADER,goog.net.XhrIo.FORM_CONTENT_TYPE)}goog.structs.forEach(c,function(k,j){this.xhr_.setRequestHeader(j,k)},this);if(this.responseType_){this.xhr_.responseType=this.responseType_}if(goog.object.containsKey(this.xhr_,"withCredentials")){this.xhr_.withCredentials=this.withCredentials_}try{if(this.timeoutId_){goog.Timer.defaultTimerObject.clearTimeout(this.timeoutId_);this.timeoutId_=null}if(this.timeoutInterval_>0){this.logger_.fine(this.formatMsg_("Will abort after "+this.timeoutInterval_+"ms if incomplete"));this.timeoutId_=goog.Timer.defaultTimerObject.setTimeout(goog.bind(this.timeout_,this),this.timeoutInterval_)}this.logger_.fine(this.formatMsg_("Sending request"));this.inSend_=true;this.xhr_.send(g);this.inSend_=false}catch(e){this.logger_.warning(this.formatMsg_("Send error: "+e.message));this.error_(goog.net.ErrorCode.EXCEPTION,e)}};au.upldr.upload.XhrIo.prototype.cleanUpXhr_=function(a){if(this.xhr_&&this.xhr_.upload&&this.xhr_.upload.onprogress){this.xhr_.upload.onprogress=this.xhrOptions_[goog.net.XmlHttp.OptionType.USE_NULL_FUNCTION]?goog.nullFunction:null}goog.base(this,"cleanUpXhr_",a)};au.upldr.upload.XhrIo.prototype.xhr_uploadProgressHandler_=function(b){var a=new au.upldr.events.ProgressEvent(b.type,b.lengthComputable,b.loaded,b.total);this.dispatchEvent(a)};au.upldr.upload.XhrIo.prototype.logger_=goog.log.getLogger("au.upldr.upload.XhrIo");goog.provide("au.upldr.upload.Transmitter");goog.require("goog.net.EventType");goog.require("goog.events.EventTarget");goog.require("au.upldr.events.ProgressEvent");goog.require("au.upldr.utils");goog.require("au.upldr.events.EventType");goog.require("au.upldr.events.UploadEvent");goog.require("au.upldr.upload.XhrIo");au.upldr.upload.Transmitter=function(){goog.base(this);this.isProcessing_=false;this.queue_;this.xhr_;this.handler_=new goog.events.EventHandler(this);this.url_;this.reset()};goog.inherits(au.upldr.upload.Transmitter,goog.events.EventTarget);goog.addSingletonGetter(au.upldr.upload.Transmitter);au.upldr.upload.Transmitter.prototype.enqueue=function(a){this.queue_.push(a);if(!this.isProcessing_){this.processNext_()}};au.upldr.upload.Transmitter.prototype.reset=function(a){this.logger.fine("Resetting transmitter ("+a+")");if(this.xhr_){this.xhr_.dispose();delete this.xhr_}this.queue_=[];this.isProcessing_=false;this.url_=a=a||".";var b=this.xhr_=au.upldr.upload.XhrIo.getInstance();this.handler_.listen(b,goog.net.EventType.READY,this.xhr_readyToUploadHandler_).listen(b,goog.net.EventType.COMPLETE,this.xhr_completeHandler_).listen(b,goog.net.EventType.PROGRESS,this.xhr_progressHandler_)};au.upldr.upload.Transmitter.prototype.processNext_=function(){if(this.isProcessing_){return}var a=this.queue_.shift();if(a){this.isProcessing_=true;this.xhr_.send(this.url_,"POST",a.getFormData())}};au.upldr.upload.Transmitter.prototype.xhr_completeHandler_=function(h){var k=this.xhr_;var j;var g=k.getStatus();var f=k.getResponseText();var a=k.getLastUri();var d=false;var l="";if(k.xhr_.responseURL){if(!/^http/.test(a)){if(window.location.href.replace(/\/$/g,"")==window.location.origin){a=window.location.origin+"\\"+a.replace(/^\//g,"")}else{var b=window.location.href.split("/");b[b.length-1]=a.replace(/^\//g,"");a=b.join("/")}}l=String(k.xhr_.responseURL);d=l!=a}var i;if(k.isSuccess()&&!d){j=au.upldr.events.EventType.COMPLETE;this.logger.fine("Package uploaded ["+g+"]")}else{if(k.isSuccess()&&d){j=au.upldr.events.EventType.ERROR;i="You has been redirected to '"+l+"'";g=goog.net.HttpStatus.FOUND;f=l;this.logger.warning(i)}else{j=au.upldr.events.EventType.ERROR;i=k.getLastError();this.logger.warning(au.upldr.utils.format('Package upload error \n\t{ errorCode: {0}, errorMessage: "{1}", responseText: "{2}" }',k.getLastErrorCode(),i,f))}}var c=new au.upldr.events.UploadEvent(j,g,f,i);this.dispatchEvent(c)};au.upldr.upload.Transmitter.prototype.xhr_readyToUploadHandler_=function(a){this.isProcessing_=false;au.upldr.utils.setTimeout(this.processNext_,0,this)};au.upldr.upload.Transmitter.prototype.xhr_progressHandler_=function(b){var a=new au.upldr.events.ProgressEvent(au.upldr.events.EventType.PROGRESS,b.lengthComputable,b.loaded,b.total);this.dispatchEvent(a)};au.upldr.upload.Transmitter.prototype.disposeInternal=function(){this.reset();this.handler_.removeAll();this.xhr_.dispose();delete this.xhr_;goog.base(this,"disposeInternal")};au.upldr.upload.Transmitter.prototype.logger=goog.log.getLogger("au.upldr.upload.Transmitter");goog.provide("au.upldr.events.PackageEvent");goog.require("goog.events.Event");goog.require("au.upldr.events.EventType");au.upldr.events.PackageEvent=function(e,a,d,b,c){goog.base(this,e);this.packageIndex=a;this.httpStatus=d||0;this.response=b||"";this.errorMessage=c||""};goog.inherits(au.upldr.events.PackageEvent,goog.events.Event);goog.provide("au.upldr.upload.Package");au.upldr.upload.Package=function(){this.formData_=new FormData()};au.upldr.upload.Package.getInstance=function(){return new au.upldr.upload.Package()};au.upldr.upload.Package.prototype.addField=function(a,b,c){if(goog.userAgent.WEBKIT&&typeof c!="undefined"){this.formData_.append(a,(b),c)}else{this.formData_.append(a,(b))}};au.upldr.upload.Package.prototype.getFormData=function(){return this.formData_};goog.provide("au.upldr.events.PackageCreateEvent");goog.require("goog.events.Event");goog.require("au.upldr.events.EventType");au.upldr.events.PackageCreateEvent=function(a){goog.base(this,au.upldr.events.EventType.COMPLETE);this.packet=a};goog.inherits(au.upldr.events.PackageCreateEvent,goog.events.Event);goog.provide("au.upldr.upload.Packager");goog.require("goog.log");goog.require("goog.events.EventHandler");goog.require("goog.events.EventTarget");goog.require("au.upldr.utils");goog.require("au.upldr.upload.Package");goog.require("au.upldr.events.PackageCreateEvent");goog.require("au.upldr.upload.Fields");goog.require("au.upldr.events.EventType");goog.require("au.upldr.events.ProgressEvent");goog.require("au.upldr.exif.ExifIO");goog.require("au.upldr.utils.fileUtils");au.upldr.upload.Packager=function(){goog.base(this);this.packageCount_;this.isProcessing_=false;this.queue_;this.packageGuid_;this.packageIndex_;this.converterIndex_=0;this.converters_;this.item_;this.package_;this.customFields_;this.enableAllStandardFields_=true;this.isFilenamesUrlEncoded_=false;this.convertedItemDeferredArray_=[];this.reset(0,[])};goog.inherits(au.upldr.upload.Packager,goog.events.EventTarget);goog.addSingletonGetter(au.upldr.upload.Packager);au.upldr.upload.Packager.prototype.reset=function(h,g,f,b,a){this.logger.fine("Resetting packager");for(var c=0;c<this.convertedItemDeferredArray_.length;c++){this.convertedItemDeferredArray_[c].cancel(true)}this.convertedItemDeferredArray_=[];this.packageCount_=h;this.customFields_=f||null;this.packageGuid_=au.upldr.utils.createGUID();this.packageIndex_=0;this.queue_=[];this.item_=null;this.package_=null;this.exifTagsToExtract_=b||[];this.isFilenamesUrlEncoded_=!!a;var d,e;if(this.converters_){d=0;while(e=this.converters_[d++]){e.reset()}}this.converters_=goog.array.slice(g,0);this.isProcessing_=false;this.converterIndex_=0};au.upldr.upload.Packager.prototype.enqueue=function(a){this.queue_.push(a);if(!this.isProcessing_){this.processNext_()}};au.upldr.upload.Packager.prototype.isEnableAllStandardFields=function(){return this.enableAllStandardFields_};au.upldr.upload.Packager.prototype.setEnableAllStandardFields=function(a){this.enableAllStandardFields_=a};au.upldr.upload.Packager.prototype.isProcessing=function(){return this.isProcessing_};au.upldr.upload.Packager.prototype.createPackage_=function(a){var d=this.package_=au.upldr.upload.Package.getInstance();var c=au.upldr.utils.format;var b=this.item_;b.updateAngleFromExif().addCallback(function(){if(this.isEnableAllStandardFields()){a.push([au.upldr.upload.Fields.PACKAGE_GUID,this.packageGuid_]);a.push([au.upldr.upload.Fields.PACKAGE_FILE_COUNT,b.getFile()?1:0]);a.push([au.upldr.upload.Fields.PACKAGE_COUNT,this.packageCount_]);a.push([au.upldr.upload.Fields.PACKAGE_INDEX,this.packageIndex_]);a.push([au.upldr.upload.Fields.FILE_NAMES_URL_ENCODED,this.isFilenamesUrlEncoded_]);a.push([c(au.upldr.upload.Fields.SOURCE_NAME,0),this.getEncodedNameIfNeed(b.getNameWithPath())]);a.push([c(au.upldr.upload.Fields.SOURCE_SIZE,0),b.getSize()]);a.push([c(au.upldr.upload.Fields.SOURCE_WIDTH,0),b.getImageWidth()]);a.push([c(au.upldr.upload.Fields.SOURCE_HEIGHT,0),b.getImageHeight()]);a.push([c(au.upldr.upload.Fields.ANGLE,0),b.getAngle()]);a.push([c(au.upldr.upload.Fields.DESCRIPTION,0),b.getDescription()]);var f=b.getCropBounds(true);a.push([c(au.upldr.upload.Fields.CROP_BOUNDS,0),[f.left,f.top,f.width,f.height].join(",")]);var e=b.getTag();if(e!=null&&e!=""){a.push([c(au.upldr.upload.Fields.TAG,0),e])}this.addFields_(d,a)}this.addCustomFields_(d,this.customFields_);this.converterIndex_=0;this.createConvertedItemDef_()}.bind(this))};au.upldr.upload.Packager.prototype.onImgLoad_=function(a){var b=this.item_;if(this.exifTagsToExtract_.length>0){b.getExifIOInstanceDeferred().addCallback(function(c){if(c){c.getExifTagsJsonDeferred().addCallback(function(f){for(var d=0;d<this.exifTagsToExtract_.length;d++){var e=this.exifTagsToExtract_[d].replace(/^Exif/,"").toLowerCase();if(f.hasOwnProperty(e)){a.push([this.exifTagsToExtract_[d]+"_0",f[e]])}}b.setState(au.upldr.ItemHolder.State.INITIALIZED)}.bind(this))}else{b.setState(au.upldr.ItemHolder.State.INITIALIZED)}}.bind(this))}else{b.setState(au.upldr.ItemHolder.State.INITIALIZED)}};au.upldr.upload.Packager.prototype.attachItemStateHandler_=function(a){var c=this.item_;c.listen(au.upldr.events.EventType.PROPERTY_CHANGE,function b(d){if(d.getPropertyName()==au.upldr.ItemHolder.Properties.STATE&&d.getNewValue()==au.upldr.ItemHolder.State.INITIALIZED){c.unlisten(au.upldr.events.EventType.PROPERTY_CHANGE,b,false,this);this.createPackage_(a)}else{if(d.getPropertyName()==au.upldr.ItemHolder.Properties.STATE&&d.getNewValue()==au.upldr.ItemHolder.State.LOADED){this.onImgLoad_(a)}}},false,this)};au.upldr.upload.Packager.prototype.onItemNew_=function(){var a=this.item_;au.upldr.image.getImageSize((a.getFile()),function(b){a.setImageWidth(b.width);a.setImageHeight(b.height);a.setState(au.upldr.ItemHolder.State.LOADED)})};au.upldr.upload.Packager.prototype.stateProcessor_=function(){var a=[];switch(this.item_.getState()){case au.upldr.ItemHolder.State.NEW:this.attachItemStateHandler_(a);this.onItemNew_();break;case au.upldr.ItemHolder.State.LOADED:this.attachItemStateHandler_(a);this.onImgLoad_(a);break;default:this.createPackage_(a)}};au.upldr.upload.Packager.prototype.processNext_=function(){if(this.isProcessing_){return}this.package_=null;if(this.item_=this.queue_.shift()){this.logger.fine("Creating new package "+this.packageIndex_);this.isProcessing_=true;try{this.stateProcessor_()}catch(a){console.error(a.stack)}}};au.upldr.upload.Packager.prototype.onComplete_=function(){if(this.isEnableAllStandardFields()){var a=this.package_;this.addFields_(a,[[au.upldr.upload.Fields.PACKAGE_COMPLETE,1],[au.upldr.upload.Fields.REQUEST_COMPLETE,1],[au.upldr.upload.Fields.REQUEST_COUNT,1]])}if(this.converters_.length==0){this.dispatchProgressEvent_(0)}this.dispatchCompleteEvent();this.isProcessing_=false;this.packageIndex_++;this.processNext_()};au.upldr.upload.Packager.prototype.createConvertedItemDef_=function(){var b=0;var a=[];while(b<this.converters_.length){var c=this.converters_[b].applyDef(this.item_);var d=goog.bind(function(e,f){this.converter_completeHandler_deferred_.bind(this)(f,e)},this,b);c.addCallback(d);a.push(c);b++}this.convertedItemDeferredArray_.push(new goog.async.DeferredList(a));this.convertedItemDeferredArray_[this.convertedItemDeferredArray_.length-1].addCallback(this.onComplete_.bind(this))};au.upldr.upload.Packager.prototype.addCustomFields_=function(f,a){if(!a){return}for(var c in a){if(a.hasOwnProperty(c)){var b=a[c];if(b){for(var e=0,d=b.length;e<d;++e){f.addField(c,b[e])}}}}};au.upldr.upload.Packager.prototype.converter_completeHandler_deferred_=function(d,b){var e=d;if(e){var h=this.package_;var g=au.upldr.utils.format;var f=au.upldr.upload.Fields;var a=[];if(e.mode==au.upldr.upload.ConvertMode.NONE){if(this.isEnableAllStandardFields()){a.push([g(f.FILE_MODE,0,b),e.mode])}}else{if(this.isEnableAllStandardFields()){a.push([g(f.FILE_MODE,0,b),e.mode]);a.push([g(f.FILE_NAME,0,b),e.fileName]);a.push([g(f.FILE_SIZE,0,b),e.size]);a.push([g(f.FILE_WIDTH,0,b),e.thumbnailWidth]);a.push([g(f.FILE_HEIGHT,0,b),e.thumbnailHeight])}var c=e.file.size==0?au.upldr.utils.fileUtils.arrayBufferToBlob(new Uint8Array(1)):e.file;a.push([g(f.FILE,0,b),c,this.getEncodedNameIfNeed(e.fileName)])}this.addFields_(h,a)}this.dispatchProgressEvent_(b)};au.upldr.upload.Packager.prototype.getEncodedNameIfNeed=function(a){return this.isFilenamesUrlEncoded_?window.encodeURI(a):a};au.upldr.upload.Packager.prototype.addFields_=function(d,a){var c,b=0;while(c=a[b++]){d.addField(c[0],c[1],c[2])}};au.upldr.upload.Packager.prototype.dispatchCompleteEvent=function(){this.logger.fine("Package created.");var a=new au.upldr.events.PackageCreateEvent(this.package_);this.dispatchEvent(a)};au.upldr.upload.Packager.prototype.dispatchProgressEvent_=function(b){var a=new au.upldr.events.ProgressEvent(au.upldr.events.EventType.PROGRESS,true,Math.min(b+1,this.converters_.length),this.converters_.length);this.dispatchEvent(a)};au.upldr.upload.Packager.prototype.disposeInternal=function(){this.reset(0,[]);goog.base(this,"disposeInternal")};au.upldr.upload.Packager.prototype.logger=goog.log.getLogger("au.upldr.upload.Packager");goog.provide("au.upldr.upload.UploadManager");goog.require("goog.log");goog.require("goog.events.EventHandler");goog.require("goog.events.EventTarget");goog.require("goog.array");goog.require("au.upldr.events.EventType");goog.require("au.upldr.events.PackageEvent");goog.require("au.upldr.events.UploadEvent");goog.require("au.upldr.upload.Transmitter");goog.require("au.upldr.upload.Packager");goog.require("au.upldr.upload.ProgressState");goog.require("au.upldr.UploadProgress.Stage");goog.require("au.upldr.utils");goog.require("au.upldr.upload.ProgressBytesMode");au.upldr.upload.UploadManager=function(d,a,c,b){goog.base(this);this.packager_=d=d||au.upldr.upload.Packager.getInstance();this.packager_.setEnableAllStandardFields(!!b);this.transmitter_=a=a||au.upldr.upload.Transmitter.getInstance();this.processing_=false;this.cancelled_=false;this.items_;this.totalPackagesCount_=0;this.currentPackageIndex_;this.progressBytesMode_=c||au.upldr.upload.ProgressBytesMode.BY_PACKAGE_SIZE;this.itemSize_;this.progressState_;this.handler_=new goog.events.EventHandler(this);this.handler_.listen(d,au.upldr.events.EventType.COMPLETE,this.packager_completeHandler_).listen(d,au.upldr.events.EventType.PROGRESS,this.packager_progressHandler_).listen(a,au.upldr.events.EventType.COMPLETE,this.transmitter_completeHandler_).listen(a,au.upldr.events.EventType.PROGRESS,this.transmitter_progressHandler_).listen(a,au.upldr.events.EventType.ERROR,this.transmitter_errorHandler_)};goog.inherits(au.upldr.upload.UploadManager,goog.events.EventTarget);au.upldr.upload.UploadManager.prototype.startUpload=function(k,n,c,g,l,h){this.logger.info("Starting upload...");if(this.processing_){var b="UploadManager is busy. Cancel current operation with stopUpload or wailt until it completes.";this.logger.severe(b);au.upldr.utils.error(b)}this.processing_=true;this.cancelled_=false;if(goog.isArray(k)){this.items_=goog.array.slice(k,0)}else{var m=[];for(var f=0,e=k.getCount();f<e;f++){this.items_.push(k.getItem(f))}}this.packager_.reset(this.items_.length,n,g,l,h);this.transmitter_.reset(c||".");this.currentPackageIndex_=0;var d=0;if(this.progressBytesMode_==au.upldr.upload.ProgressBytesMode.BY_SOURCE_SIZE){goog.array.forEach(this.items_,function(o,i,a){d+=o.getSize()})}var j=this.progressState_=new au.upldr.upload.ProgressState(au.upldr.UploadProgress.Stage.START,0,0,this.items_.length,0,d);this.dispatchProgressChanged_();if(this.items_.length>0){j.stage=au.upldr.UploadProgress.Stage.PACKAGING;this.packageNextItem_()}else{this.processing_=false;j.stage=au.upldr.UploadProgress.Stage.FINISH;j.percent=100;this.dispatchProgressChanged_();this.onUploadCompleted_()}};au.upldr.upload.UploadManager.prototype.cancelUpload=function(){this.logger.fine("Cancel upload.");this.packager_.reset(0,[]);this.transmitter_.reset();this.currentPackageIndex_=0;this.items_=[];this.processing_=false;this.cancelled_=true;this.itemSize_=0};au.upldr.upload.UploadManager.prototype.packageNextItem_=function(){this.logger.fine("Enqueue item to package");if(this.progressBytesMode_===au.upldr.upload.ProgressBytesMode.BY_PACKAGE_SIZE){this.progressState_.loadedBytes=0;this.progressState_.totalBytes=0}this.dispatchBeforePackageUploadEvent_(this.currentPackageIndex_);var a=this.items_.shift();this.itemSize_=a.getSize();this.packager_.enqueue(a)};au.upldr.upload.UploadManager.prototype.uploadPackage_=function(b){this.logger.fine("Enqueue package to upload.");var a=this.progressState_;a.stage=au.upldr.UploadProgress.Stage.UPLOADING;this.transmitter_.enqueue(b)};au.upldr.upload.UploadManager.prototype.onUploadCompleted_=function(b,a){this.logger.info("All files has been uploaded successfully.");if(!this.cancelled_){this.dispatchEvent(new au.upldr.events.UploadEvent(au.upldr.events.EventType.COMPLETE,b,a))}};au.upldr.upload.UploadManager.prototype.packager_completeHandler_=function(a){this.logger.fine("Packager complete handler");if(!this.cancelled_){this.uploadPackage_(a.packet)}};au.upldr.upload.UploadManager.prototype.packager_progressHandler_=function(c){if(this.progressBytesMode_===au.upldr.upload.ProgressBytesMode.BY_PACKAGE_SIZE){var a=this.progressState_;var b=a.percent;if(c.total>0){a.percent+=50*c.loaded/c.total/a.totalFiles}else{a.percent+=50/a.totalFiles}this.dispatchProgressChanged_();a.percent=b}};au.upldr.upload.UploadManager.prototype.transmitter_completeHandler_=function(c){this.logger.info("Package "+this.currentPackageIndex_+" uploaded ["+c.httpStatus+"]");if(!this.cancelled_){var d=this.dispatchAfterPackageUploadEvent_(this.currentPackageIndex_,c.httpStatus,c.response,c.errorMessage);var a=this.items_.length<=0;var b=this.progressState_;b.loadedFiles++;if(this.progressBytesMode_===au.upldr.upload.ProgressBytesMode.BY_PACKAGE_SIZE){b.loadedBytes=b.totalBytes}else{b.loadedBytes+=this.itemSize_}if(a){b.stage=au.upldr.UploadProgress.Stage.FINISH;b.percent=100}else{if(this.progressBytesMode_===au.upldr.upload.ProgressBytesMode.BY_PACKAGE_SIZE){b.percent=100*b.loadedFiles/b.totalFiles}else{b.percent=100*b.loadedBytes/b.totalBytes}}this.dispatchProgressChanged_();this.currentPackageIndex_++;if(a){this.processing_=false;this.onUploadCompleted_(c.httpStatus,c.response)}else{this.packageNextItem_()}}};au.upldr.upload.UploadManager.prototype.transmitter_progressHandler_=function(c){var b=this.progressState_;if(this.progressBytesMode_===au.upldr.upload.ProgressBytesMode.BY_PACKAGE_SIZE){b.totalBytes=c.total;b.loadedBytes=c.loaded;b.percent=(b.loadedFiles+0.5)*100/b.totalFiles;if(b.totalBytes>0){b.percent+=50*b.loadedBytes/b.totalFiles/b.totalBytes}this.dispatchProgressChanged_()}else{var a=b.loadedBytes;b.loadedBytes+=Math.min(c.loaded,this.itemSize_);b.percent=100*b.loadedBytes/b.totalBytes;this.dispatchProgressChanged_();b.loadedBytes=a;b.percent=100*b.loadedBytes/b.totalBytes}};au.upldr.upload.UploadManager.prototype.transmitter_errorHandler_=function(b){var a=new au.upldr.events.UploadEvent(au.upldr.events.EventType.ERROR,b.httpStatus,b.response,"Upload error: "+b.errorMessage);this.dispatchErrorEvent_(a)};au.upldr.upload.UploadManager.prototype.dispatchBeforePackageUploadEvent_=function(b){var a=new au.upldr.events.PackageEvent(au.upldr.events.EventType.BEFORE_PACKAGE_UPLOAD,b);this.dispatchEvent(a)};au.upldr.upload.UploadManager.prototype.dispatchAfterPackageUploadEvent_=function(e,d,b,c){var a=new au.upldr.events.PackageEvent(au.upldr.events.EventType.AFTER_PACKAGE_UPLOAD,e,d,b,c);return this.dispatchEvent(a)};au.upldr.upload.UploadManager.prototype.dispatchProgressChanged_=function(){var a=new goog.events.Event(au.upldr.events.EventType.PROGRESS);a.state=this.progressState_.clone();this.dispatchEvent(a)};au.upldr.upload.UploadManager.prototype.dispatchErrorEvent_=function(a){this.dispatchEvent(a)};au.upldr.upload.UploadManager.prototype.disposeInternal=function(){this.handler_.removeAll();this.transmitter_.dispose();this.packager_.dispose();goog.base(this,"disposeInternal")};au.upldr.upload.UploadManager.prototype.logger=goog.log.getLogger("au.upldr.upload.UploadManager");goog.provide("au.upldr.events.ConverterEvent");goog.require("goog.events.Event");goog.require("au.upldr.events.EventType");au.upldr.events.ConverterEvent=function(a,b){goog.base(this,a||au.upldr.events.EventType.COMPLETE);this.convertedItem=b};goog.inherits(au.upldr.events.ConverterEvent,goog.events.Event);goog.provide("au.upldr.events.ThumbnailEvent");goog.require("goog.events.Event");au.upldr.events.ThumbnailEvent=function(b,a,c,d){goog.base(this,b);this.canvas=a;this.fitMode=c;this.angle=d||0;this.width=a&&a.width||0;this.height=a&&a.height||0};goog.inherits(au.upldr.events.ThumbnailEvent,goog.events.Event);goog.provide("au.upldr.image.ThumbnailCreator");goog.require("goog.events.EventTarget");goog.require("goog.fs");goog.require("goog.dom");goog.require("goog.async.Deferred");goog.require("au.upldr.events.ThumbnailEvent");goog.require("au.upldr.events.EventType");goog.require("au.upldr.image");goog.require("au.upldr.utils");goog.require("au.upldr.image.ImageLoader");au.upldr.image.ThumbnailCreator=function(){goog.base(this);this.fitMode_;this.width_;this.height_;this.bgColor_;this.angle_;this.canvas_;this.cancelled_;this.before_;this.after_};goog.inherits(au.upldr.image.ThumbnailCreator,goog.events.EventTarget);au.upldr.image.ThumbnailCreator.getInstance=function(){return new au.upldr.image.ThumbnailCreator()};au.upldr.image.ThumbnailCreator.prototype.createDeferred=function(d,g,e,b,f,h,c){var a=new goog.async.Deferred();au.upldr.image.ImageLoader.loadDeferred(d).addCallback(function(i){c=c||(goog.dom.createElement("canvas"));a.callback(au.upldr.imaging.CanvasUtil.createFromImage(i,g,e,b,f,h,c))}.bind(this));return a};au.upldr.image.ThumbnailCreator.prototype.createAspectedDeferred=function(m,f,g,c,l,k,d,i,j,b){var n=new goog.async.Deferred();if(j){var h=(document.createElement("canvas"));h.width=f.width;h.height=f.height;h.getContext("2d").drawImage(f,0,0);j(h).addCallback(function(o){n.callback(au.upldr.imaging.CanvasUtil.getImage(m,o,c,l,m.getAngle(),k,g,d,i))})}else{if(b){var a=au.upldr.imaging.CanvasUtil.getImage(m,f,c,l,m.getAngle(),k,g,d,i);if(a){var e=(document.createElement("canvas"));e.width=a.width;e.height=a.height;e.getContext("2d").drawImage(a,0,0);b(e).addCallback(function(o){n.callback(o)})}else{n.callback(null)}}else{n.callback(au.upldr.imaging.CanvasUtil.getImage(m,f,c,l,m.getAngle(),k,g,d,i))}}return n};au.upldr.image.ThumbnailCreator.prototype.reset=function(){this.cancelled_=true};au.upldr.image.ThumbnailCreator.prototype.dispatchError_=function(){this.dispatchEvent(new au.upldr.events.ThumbnailEvent(au.upldr.events.EventType.ERROR))};au.upldr.image.ThumbnailCreator.prototype.handleOnLoadEvent_=function(a){if(a){this.dispatchEvent(new au.upldr.events.ThumbnailEvent(au.upldr.events.EventType.COMPLETE,a,this.fitMode_,this.angle_))}else{this.dispatchError_()}};au.upldr.image.ThumbnailCreator.prototype.disposeInternal=function(){goog.base(this,"disposeInternal")};goog.provide("au.upldr.upload.ConvertedItem");au.upldr.upload.ConvertedItem=function(c,e,a,d,b){this.mode=c;this.fileName=e;this.file=a;this.thumbnailWidth=d||0;this.thumbnailHeight=b||0;this.size=a?a.size:0};goog.provide("au.upldr.imaging.watermark.WatermarkObjects");au.upldr.imaging.watermark.WatermarkObjects={};au.upldr.imaging.watermark.WatermarkObjects.DrawingSet=function(a,b){this.point=a||new au.upldr.imaging.watermark.WatermarkObjects.Point();this.rectangle=b||new au.upldr.imaging.watermark.WatermarkObjects.Rectangle()};au.upldr.imaging.watermark.WatermarkObjects.Point=function(a,b){this.x=a||0;this.y=b||0};au.upldr.imaging.watermark.WatermarkObjects.Rectangle=function(a,d,b,c){this.x=a||0;this.y=d||0;this.w=b||0;this.h=c||0};goog.provide("au.upldr.imaging.watermark.WatermarkConfig");goog.require("goog.array");goog.require("goog.object");goog.require("au.upldr.imaging.BaseConfig");au.upldr.imaging.watermark.WatermarkConfig=function(a){this.FillColor="black";this.Font="Arial";this.Size=12;this.Style="";this.Position=au.upldr.imaging.watermark.WatermarkConfig.PositionEnum.TopLeft;this.OffsetX=0;this.OffsetY=0;this.Opacity=100;this.BackgroundColor="";this.BackgroundMarginWidth=0;this.BackgroundMarginHeight=0;this.Width=0;this.Height=0;this.ImageUrl="";this.Text="";this.Angle=0;this.Tiled=false;this.When=au.upldr.imaging.watermark.WatermarkConfig.WhenEnum.BeforeResize;goog.base(this,a)};goog.inherits(au.upldr.imaging.watermark.WatermarkConfig,au.upldr.imaging.BaseConfig);au.upldr.imaging.watermark.WatermarkConfig.WhenEnum={BeforeResize:0,AfterResize:1};au.upldr.imaging.watermark.WatermarkConfig.PositionEnum={TopLeft:0,TopCenter:1,TopRight:2,CenterLeft:3,Center:4,CenterRight:5,BottomLeft:6,BottomCenter:7,BottomRight:8};au.upldr.imaging.watermark.WatermarkConfig.prototype.getBooleanTypeParams=function(){return{Tiled:1}};au.upldr.imaging.watermark.WatermarkConfig.prototype.getNumberTypeParams=function(){return{Size:1,OffsetX:1,OffsetY:1,Opacity:1,BackgroundMarginWidth:1,BackgroundMarginHeight:1,Width:1,Height:1,Angle:1}};au.upldr.imaging.watermark.WatermarkConfig.prototype.getColorTypeParams=function(){return{BackgroundColor:1,FillColor:1}};au.upldr.imaging.watermark.WatermarkConfig.prototype.getEnumTypeParams=function(){return{When:au.upldr.imaging.watermark.WatermarkConfig.WhenEnum,Position:au.upldr.imaging.watermark.WatermarkConfig.PositionEnum}};goog.provide("au.upldr.imaging.watermark.DriwingUtil");goog.require("au.upldr.imaging.watermark.WatermarkConfig");goog.require("au.upldr.imaging.watermark.WatermarkObjects");au.upldr.imaging.watermark.DriwingUtil=function(b,a,c){this.config_=a;this.canvas_=b;this.context_=(this.canvas_.getContext("2d"));this.image_=c};au.upldr.imaging.watermark.DriwingUtil.prototype.applyOpacity=function(){this.context_.globalAlpha=this.config_.Opacity/100};au.upldr.imaging.watermark.DriwingUtil.prototype.drawCenterLines=function(){this.context_.beginPath();this.context_.moveTo(this.canvas_.width/2,0);this.context_.lineTo(this.canvas_.width/2,this.canvas_.height);this.context_.stroke();this.context_.beginPath();this.context_.moveTo(0,this.canvas_.height/2);this.context_.lineTo(this.canvas_.width,this.canvas_.height/2);this.context_.stroke()};au.upldr.imaging.watermark.DriwingUtil.prototype.rotate=function(d){if(this.config_.Angle!=0){var c=this.config_.Angle*(Math.PI/180);var b=d.rectangle;var a=b.x+(b.w/2);var e=b.y+(b.h/2);this.context_.translate(a,e);this.context_.rotate(c);this.context_.translate(-a,-e)}};au.upldr.imaging.watermark.DriwingUtil.prototype.drawObjects=function(a){if(this.image_||this.config_.Text!=""){if(this.config_.Tiled){this.drawObjectsTiled_(a)}else{if(this.image_){this.drawImage_(a.point)}else{if(this.config_.Text!=""){this.drawText_(a.point)}}}}};au.upldr.imaging.watermark.DriwingUtil.prototype.drawObjectsTiled_=function(g){var d=2;var f=this.canvas_.width*d;var e=this.canvas_.height*d;var c=-f;var b=-e;var a;while(f>c){while(e>b){a=new au.upldr.imaging.watermark.WatermarkObjects.Point(c,b);if(this.image_){this.drawImage_(a)}else{if(this.config_.Text!=""){this.drawText_(a)}}b+=g.rectangle.h}b=-e;c+=g.rectangle.w}};au.upldr.imaging.watermark.DriwingUtil.prototype.drawBg=function(e){var d=e.rectangle;if(this.config_.BackgroundColor!=""){if(this.config_.Tiled){var c=2;var b=-this.canvas_.width*c;var a=-this.canvas_.height*c;d=new au.upldr.imaging.watermark.WatermarkObjects.Rectangle(b,a,-b*2,-a*2)}this.drawBg_(d)}};au.upldr.imaging.watermark.DriwingUtil.prototype.drawBg_=function(a){this.context_.fillStyle=this.config_.BackgroundColor.replace(/^\s*0x/gi,"#");this.context_.fillRect(a.x,a.y,a.w,a.h)};au.upldr.imaging.watermark.DriwingUtil.prototype.drawImage_=function(a){this.context_.drawImage(this.image_,a.x,a.y)};au.upldr.imaging.watermark.DriwingUtil.prototype.drawText_=function(a){this.context_.textBaseline="bottom";this.context_.font=au.upldr.imaging.watermark.DriwingUtil.getCanvasFontStyleArray(this.config_).join(" ").replace(/\s+/g," ").replace(/^\s+|\s+$/g,"");this.context_.fillStyle=this.config_.FillColor.replace(/^\s*0x/gi,"#");this.context_.fillText(this.config_.Text,a.x,a.y)};au.upldr.imaging.watermark.DriwingUtil.getCanvasFontStyleArray=function(a){return[a.Style,""+a.Size+"px",a.Font]};au.upldr.imaging.watermark.DriwingUtil.prototype.mergeCanvas=function(a){a.getContext("2d").drawImage(this.canvas_,0,0);return a};goog.provide("au.upldr.imaging.watermark.WatermarkWriter");goog.require("goog.array");goog.require("goog.object");goog.require("goog.async.Deferred");goog.require("au.upldr.imaging.watermark.WatermarkConfig");goog.require("au.upldr.imaging.watermark.WatermarkObjects");goog.require("au.upldr.imaging.watermark.DriwingUtil");au.upldr.upload.WatermarkWrapObj={canvas:null,image:null};au.upldr.imaging.watermark.WatermarkWriter=function(b,a){this.config_=a;this.resultCanvas_=b;this.canvas_=(document.createElement("canvas"));this.canvas_.width=this.resultCanvas_.width;this.canvas_.height=this.resultCanvas_.height};au.upldr.imaging.watermark.WatermarkWriter.prototype.drawAll_=function(d){var c=d?d.image:null;var b=this.parsePosition_(c);var a=new au.upldr.imaging.watermark.DriwingUtil(this.canvas_,this.config_,c);a.applyOpacity();a.rotate(b);a.drawBg(b);a.drawObjects(b);return a.mergeCanvas(this.resultCanvas_)};au.upldr.imaging.watermark.WatermarkWriter.prototype.getPositionAfterMargin_=function(g,l){var i=this.config_.BackgroundMarginWidth;var e=this.config_.BackgroundMarginHeight;var h=this.canvas_.height;var f=this.canvas_.width;var m;var k;var b;var c;if(g){m=g.height;k=g.width;c=l.x-i;b=l.y-e}else{m=this.getTextHeight();k=this.getTextWidth();c=l.x-i;b=l.y-this.getTextHeight()-e}var d=k+(i*2);var n=m+(e*2);if(i>0&&c+d>f){c=f-d}if(e>0&&b+n>h){b=h-n}var a=c+i;var o=b+e;if(!g){o=b+e+this.getTextHeight()}var j=new au.upldr.imaging.watermark.WatermarkObjects.Rectangle(c,b,d,n);l=new au.upldr.imaging.watermark.WatermarkObjects.Point(a,o);return new au.upldr.imaging.watermark.WatermarkObjects.DrawingSet(l,j)};au.upldr.imaging.watermark.WatermarkWriter.tryLoadImage=function(e,h,f){var g=new Image();var b=new goog.async.Deferred();var d=({image:null,canvas:null});var c=(h||0);var a=(f||0);g.onerror=function(){b.callback(null)};g.onload=function(){if(c>0||a>0){var j=(document.createElement("canvas"));var l=au.upldr.imaging.CanvasUtil.createFromImage(g,au.upldr.image.FitMode.FIT,c,a,null,0,j);var k=new Image();try{var n=l.toDataURL("image/png");k.onerror=function(){b.callback(null)};k.onload=function(){d.image=k;d.canvas=l;b.callback(d)};k.src=n}catch(m){b.callback(null)}}else{var i=document.createElement("canvas");i.width=g.width;i.height=g.height;i.getContext("2d").drawImage(g,0,0);d.image=g;d.canvas=i;b.callback(d)}};if(e&&(e instanceof HTMLImageElement||typeof e=="string")){g.src=(e instanceof HTMLImageElement)?e.src:e}else{b.callback(null)}return b};au.upldr.imaging.watermark.WatermarkWriter.prototype.dispose=function(){this.resultCanvas_=null;this.canvas_=null;this.config_=null};au.upldr.imaging.watermark.WatermarkWriter.prototype.positionMethodsSet_=function(g){g=g||null;var f=g==null?this.getTextHeight():g.height;var b=g==null?this.getTextWidth():g.width;var d=this.canvas_.height;var a=this.canvas_.width;var c=a-b;var e=d-f;return{toRight:function(){return c<0?0:c},toHorizontalCenter:function(){return c>0?c/2:0},toLeft:function(){return 0},toTop:function(){return g?0:f},toVerticalCenter:function(){return(d/2)+((g?-f:f)/2)},toBottom:function(){return g?e:d}}};au.upldr.imaging.watermark.WatermarkWriter.prototype.parsePosition_=function(e){var c=this.config_.Position;var b=au.upldr.imaging.watermark.WatermarkConfig.PositionEnum;var d=this.positionMethodsSet_(e);var a=new au.upldr.imaging.watermark.WatermarkObjects.Point(this.config_.OffsetX,this.config_.OffsetY);switch(c){case b.TopLeft:a.x+=d.toLeft();a.y+=d.toTop();break;case b.TopCenter:a.x+=d.toHorizontalCenter();a.y+=d.toTop();break;case b.TopRight:a.x+=d.toRight();a.y+=d.toTop();break;case b.CenterLeft:a.x+=d.toLeft();a.y+=d.toVerticalCenter();break;case b.Center:a.x+=d.toHorizontalCenter();a.y+=d.toVerticalCenter();break;case b.CenterRight:a.x+=d.toRight();a.y+=d.toVerticalCenter();break;case b.BottomLeft:a.x+=d.toLeft();a.y+=d.toBottom();break;case b.BottomCenter:a.x+=d.toHorizontalCenter();a.y+=d.toBottom();break;case b.BottomRight:a.x+=d.toRight();a.y+=d.toBottom();break}return this.getPositionAfterMargin_(e,a)};au.upldr.imaging.watermark.WatermarkWriter.prototype.getContext=function(){return(this.canvas_.getContext("2d"))};au.upldr.imaging.watermark.WatermarkWriter.prototype.getTextWidth=function(){var a=this.getContext();a.font=au.upldr.imaging.watermark.DriwingUtil.getCanvasFontStyleArray(this.config_).join(" ").replace(/\s+/g," ").replace(/^\s+|\s+$/g,"");return a.measureText(this.config_.Text).width};au.upldr.imaging.watermark.WatermarkWriter.prototype.getTextHeight=function(){return this.config_.Size};au.upldr.imaging.watermark.WatermarkWriter.writeOnImageDeferred=function(e,c,d,b){var a=new goog.async.Deferred();if(e instanceof HTMLImageElement||typeof e=="string"){au.upldr.imaging.watermark.WatermarkWriter.tryLoadImage(e,d,b).addCallback(function(f){f=(f);if(f){au.upldr.imaging.watermark.WatermarkWriter.writeCanvasWithDefToImage(a,f.canvas,c)}else{a.callback(null)}})}else{a.callback(null)}return a};au.upldr.imaging.watermark.WatermarkWriter.writeOnCanvasDeferred=function(b,c){var a=new goog.async.Deferred();if(b instanceof HTMLCanvasElement){au.upldr.imaging.watermark.WatermarkWriter.writeCanvasWithDef(a,b,c)}else{a.callback(null)}return a};au.upldr.imaging.watermark.WatermarkWriter.prototype.writeDeferred=function(){return au.upldr.imaging.watermark.WatermarkWriter.tryLoadImage(this.config_.ImageUrl,this.config_.Width,this.config_.Height).addCallback(this.drawAll_.bind(this))};au.upldr.imaging.watermark.WatermarkWriter.writeCanvasWithDefToImage=function(d,a,b){var c=new au.upldr.imaging.watermark.WatermarkWriter(a,b);c.writeDeferred().addCallback(function(e){c.dispose();au.upldr.utils.fileUtils.canvasToImageDef(e).chainDeferred(d)})};au.upldr.imaging.watermark.WatermarkWriter.writeCanvasWithDef=function(d,a,b){var c=new au.upldr.imaging.watermark.WatermarkWriter(a,b);c.writeDeferred().addCallback(function(e){c.dispose();d.callback(e)})};goog.provide("au.upldr.exif.ExifRestorer");goog.require("goog.async.Deferred");goog.require("goog.async.DeferredList");au.upldr.exif.ExifRestorer=(function(){var a={};a.KEY_STR="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";a.encode64=function(d){var b="",l,j,g="",k,h,f,e="",c=0;do{l=d[c++];j=d[c++];g=d[c++];k=l>>2;h=((l&3)<<4)|(j>>4);f=((j&15)<<2)|(g>>6);e=g&63;if(isNaN(j)){f=e=64}else{if(isNaN(g)){e=64}}b=b+this.KEY_STR.charAt(k)+this.KEY_STR.charAt(h)+this.KEY_STR.charAt(f)+this.KEY_STR.charAt(e);l=j=g="";k=h=f=e=""}while(c<d.length);return b};a.restore=function(b,g){var d="data:image/jpeg;base64,";if(!b.match(d)){return g}var f=this.decode64(b.replace(d,""));var c=this.slice2Segments(f);var e=this.exifManipulation(g,c);return d+this.encode64(e)};a.exifManipulation=function(f,d){var b=this.getExifArray(d),c=this.insertExif(f,b),e=new Uint8Array(c);return e};a.getExifArray=function(d){var c;for(var b=0;b<d.length;b++){c=d[b];if(c[0]==255&c[1]==225){return c}}return[]};a.insertExif=function(i,b){var h=i.replace("data:image/jpeg;base64,",""),d=this.decode64(h),c=d.indexOf(255,3),f=d.slice(0,c),e=d.slice(c),g=f;g=g.concat(b);g=g.concat(e);return g};a.slice2Segments=function(c){var f=0,d=[];while(1){if(c[f]==255&c[f+1]==218){break}if(c[f]==255&c[f+1]==216){f+=2}else{var g=c[f+2]*256+c[f+3],e=f+g+2,b=c.slice(f,e);d.push(b);f=e}if(f>c.length){break}}return d};a.decode64=function(f){var d="",n,l,j="",m,k,h,g="",e=0,c=[];var b=/[^A-Za-z0-9\+\/\=]/g;if(b.exec(f)){alert("There were invalid base64 characters in the input text.\nValid base64 characters are A-Z, a-z, 0-9, '+', '/',and '='\nExpect errors in decoding.")}f=f.replace(/[^A-Za-z0-9\+\/\=]/g,"");do{m=this.KEY_STR.indexOf(f.charAt(e++));k=this.KEY_STR.indexOf(f.charAt(e++));h=this.KEY_STR.indexOf(f.charAt(e++));g=this.KEY_STR.indexOf(f.charAt(e++));n=(m<<2)|(k>>4);l=((k&15)<<4)|(h>>2);j=((h&3)<<6)|g;c.push(n);if(h!=64){c.push(l)}if(g!=64){c.push(j)}n=l=j="";m=k=h=g=""}while(e<f.length);return c};return a})();goog.provide("au.upldr.upload.ConvertMode");au.upldr.upload.ConvertMode={SOURCE:"sourceFile",THUMBNAIL:"thumbnail",ICON:"icon",NONE:"none"};goog.provide("au.upldr.upload.Converter");goog.require("goog.events.EventTarget");goog.require("goog.string");goog.require("goog.log");goog.require("goog.asserts");goog.require("goog.async.Deferred");goog.require("goog.async.DeferredList");goog.require("au.upldr.events.ConverterEvent");goog.require("au.upldr.upload.ConvertedItem");goog.require("au.upldr.image.FitMode");goog.require("au.upldr.upload.ConvertMode");goog.require("au.upldr.image.ThumbnailCreator");goog.require("au.upldr.utils");goog.require("au.upldr.support");goog.require("au.upldr.exif.ExifRestorer");goog.require("au.upldr.exif.ExifIO");goog.require("au.upldr.utils.fileUtils");goog.require("au.upldr.imaging.watermark.WatermarkConfig");goog.require("au.upldr.imaging.watermark.WatermarkWriter");au.upldr.upload.ConvertRule;au.upldr.upload.Converter=function(f,e,c,i,d,j,h,k,a,g,b){goog.base(this);this.isProcessing_=false;this.index_=f;this.rules_=au.upldr.upload.Converter.parseMode(e);this.thumbnailWidth_=c==null?96:c;this.thumbnailHeight_=i==null?96:i;this.thumbnailJpegQuality_=goog.isDefAndNotNull(h)?h:au.upldr.upload.Converter.defaultJpegQuality;this._isThumbnailCopyExif=!!k;this.thumbnailFitMode_=this.parseFitMode_(d);this.thumbnailBgColor_=!j?16777215:j;this.ruleIndex_=0;this.item_;this.convertedItem_;this.thumbnailCreator_=au.upldr.image.ThumbnailCreator.getInstance();this.thumbnailWatermark_=a||null;this.thumbnailApplyCrop_=typeof g=="undefined"?true:g;this.thumbnailApplyDrawTool_=typeof b=="undefined"?true:b};goog.inherits(au.upldr.upload.Converter,goog.events.EventTarget);au.upldr.upload.Converter.maxJpegQuality=100;au.upldr.upload.Converter.defaultJpegQuality=90;au.upldr.upload.Converter.minJpegQuality=0;au.upldr.upload.Converter.prototype.isProcessing=function(){return this.isProcessing_};au.upldr.upload.Converter.prototype.applyDef=function(a){this.logger.info("Applying converter "+this.dump());this.isProcessing_=true;this.item_=a;this.ruleIndex_=au.upldr.upload.Converter.findNextMode_(this.rules_,0,a.getName());return this.createItemDef_()};au.upldr.upload.Converter.prototype.reset=function(){this.isProcessing_=false;this.ruleIndex_=0;this.item_=null;this.convertedItem_=null;this.thumbnailCreator_.reset()};au.upldr.upload.Converter.prototype.createItemDef_=function(){var a=au.upldr.upload.ConvertMode;var b;if(this.ruleIndex_>=0){b=this.rules_[this.ruleIndex_].mode}else{b=a.NONE}if(b==a.SOURCE){return this.makeSourceConvertedItemDef_()}else{if(b==a.NONE){return this.makeNoneConvertedItemDef_()}else{if(b==a.THUMBNAIL){return this.makeThumbnailConvertedItemDef_()}else{if(b==a.ICON){return this.makeIconConvertedItemDef_()}else{return this.makeNoneConvertedItemDef_()}}}}};au.upldr.upload.Converter.prototype.createSimpleDeferred_=function(b){var a=new goog.async.Deferred();a.callback(b);return a};au.upldr.upload.Converter.prototype.makeSourceConvertedItemDef_=function(){this.logger.fine('Creating "sourceFile" converted item');var a=this.item_;var b=new au.upldr.upload.ConvertedItem(au.upldr.upload.ConvertMode.SOURCE,a.getName(),a.getFile(),a.getImageWidth(),a.getImageHeight());return this.createSimpleDeferred_(b)};au.upldr.upload.Converter.prototype.makeNoneConvertedItemDef_=function(){this.logger.fine('Creating "none" converted item');var a=new au.upldr.upload.ConvertedItem(au.upldr.upload.ConvertMode.NONE,"",null);return this.createSimpleDeferred_(a)};au.upldr.upload.Converter.prototype.makeIconConvertedItemDef_=function(){this.logger.fine('Creating "icon" converted item');var c=this.item_;var a=this.makeIconCanvas_(c);var b=au.upldr.utils.fileUtils.canvasToBlob(a,this.thumbnailJpegQuality_/au.upldr.upload.Converter.maxJpegQuality,c.getName());var d=new au.upldr.upload.ConvertedItem(au.upldr.upload.ConvertMode.ICON,c.getName(),b,a.width,a.height);return this.createSimpleDeferred_(d)};au.upldr.upload.Converter.prototype.makeThumbnailConvertedItemDefExec_=function(b){var a=new goog.async.Deferred();au.upldr.image.ImageLoader.loadDeferred(b.getFile()).addCallback(function(f){if(f){var e=(null);var g=(null);if(this.thumbnailWatermark_!=null){var d=function(h){return au.upldr.imaging.watermark.WatermarkWriter.writeOnCanvasDeferred(h,this.thumbnailWatermark_)}.bind(this);if(this.thumbnailWatermark_.When==au.upldr.imaging.watermark.WatermarkConfig.WhenEnum.BeforeResize){e=d}else{if(this.thumbnailWatermark_.When==au.upldr.imaging.watermark.WatermarkConfig.WhenEnum.AfterResize){g=d}}}var c=this.thumbnailCreator_.createAspectedDeferred(b,f,this.thumbnailFitMode_,this.thumbnailWidth_,this.thumbnailHeight_,this.thumbnailBgColor_,this.thumbnailApplyCrop_,this.thumbnailApplyDrawTool_,e,g);c.addCallback(function(h){this.thumbnailCreatorComplitter_.bind(this)(h).chainDeferred(a)}.bind(this))}else{this.makeNotImageFileDefExec_(b).addCallback(function(h){a.callback(h)})}}.bind(this));return a};au.upldr.upload.Converter.prototype.makeNotImageFileDefExec_=function(b){this.logger.info("Item is not an image.Trying to apply next convert rule.");var a=b.getName();this.ruleIndex_=au.upldr.upload.Converter.findNextMode_(this.rules_,this.ruleIndex_+1,a);if(this.ruleIndex_==-1){return this.makeNoneConvertedItemDef_()}else{return this.createItemDef_()}};au.upldr.upload.Converter.prototype.makeThumbnailConvertedItemDef_=function(){this.logger.fine('Creating "thumbnail" converted item');if(this.item_.isImage()&&this.item_.getFile()!=null){return this.makeThumbnailConvertedItemDefExec_(this.item_)}else{return this.makeNotImageFileDefExec_(this.item_)}};au.upldr.upload.Converter.prototype.makeIconCanvas_=function(e){var d=document.querySelector(e.getIconCssClass(true));var b=window.getComputedStyle(d,":before");var c=(document.createElement("canvas"));c.width=this.thumbnailWidth_;c.height=this.thumbnailHeight_;var g=Math.max(this.thumbnailWidth_,this.thumbnailHeight_);var a=c.getContext("2d");var f=typeof this.thumbnailBgColor_=="number"?au.upldr.utils.numberToHexColor(this.thumbnailBgColor_):this.thumbnailBgColor_;a.fillStyle=f.replace(/^\s*0x/gi,"#");a.fillRect(0,0,c.width,c.height);a.textBaseline="bottom";a.font=g+"px "+b.getPropertyValue("font-family");a.fillStyle=b.getPropertyValue("color");a.fillText(b.getPropertyValue("content").replace(/'|"/g,""),0,this.thumbnailHeight_);return c};au.upldr.upload.Converter.prototype.thumbnailCreatorComplitter_=function(d){var f=this.item_,c=f.getName();var b=new goog.async.Deferred();var a=new goog.async.Deferred();b.addCallback(function(h){if(h){a.callback(new au.upldr.upload.ConvertedItem(au.upldr.upload.ConvertMode.THUMBNAIL,c,h,d.width,d.height))}else{a.callback(null)}});if(d){this.logger.fine(au.upldr.utils.format("Thumbnail created: {0}x{1}",d.width,d.height));c=c+"_Thumbnail"+this.index_+".jpg";var e=au.upldr.upload.Converter.getFileFromCanvas_(d,c,this.thumbnailJpegQuality_);if(f.isJpegImage()&&this.getThumbnailCopyExif()){var g=au.upldr.exif.ExifIO.restoreFileExifDeferred(f.getFile(),e);g.addCallback(function(h){var i=au.upldr.utils.fileUtils.blobToDataView(h);i.addCallback(function(j){var l=new au.upldr.exif.ExifIO(j);var k=[{key:"PixelXDimension",value:d.width},{key:"PixelYDimension",value:d.height}];if(f.getCanAutoRotate()){k.push({key:"Orientation",value:1})}l.writeValuesDeferred(k).chainDeferred(b)})})}else{b.callback(e)}}else{this.logger.fine("Thumbnail not created. Trying to apply next convert rule.");this.ruleIndex_=au.upldr.upload.Converter.findNextMode_(this.rules_,this.ruleIndex_+1,c);this.createItemDef_();b.callback(null)}return a};au.upldr.upload.Converter.getFileFromCanvas_=function(b,f,a){a=goog.isDefAndNotNull(a)?a:au.upldr.upload.Converter.defaultJpegQuality;if(a>au.upldr.upload.Converter.maxJpegQuality){a=au.upldr.upload.Converter.maxJpegQuality}else{if(a<au.upldr.upload.Converter.minJpegQuality){a=au.upldr.upload.Converter.minJpegQuality}}goog.asserts.assert(au.upldr.support.isThumbnailCreationSupported(),"The browser does not support thumbnails creation.");var c="image/jpeg";try{if(b.mozGetAsFile&&a==au.upldr.upload.Converter.maxJpegQuality){return b.mozGetAsFile(f,c)}else{return au.upldr.utils.fileUtils.dataURItoBlob(b.toDataURL(c,a/au.upldr.upload.Converter.maxJpegQuality))}}catch(d){return new Blob()}};au.upldr.upload.Converter.findNextMode_=function(b,a,c){if(a<0){a=0}if(a<b.length){do{if(b[a].pattern.test(c)){return a}}while(b[++a])}return -1};au.upldr.upload.Converter.parseMode=function(f){var c='Can not parse "'+f+'" string';var h=f.split(";");var l=[],d,e=0;var j;var g;while(d=h[e++]){d=d.split("=");if(d.length==2){j=goog.string.trim(d[0]);g=goog.string.trim(d[1])}else{j="*";g=goog.string.trim(d[0])}if(!j||!g){au.upldr.utils.error(c)}j=j.toLowerCase().split(",");var o=[];var k;var n;var b;goog.array.forEach(j,function(q,m,a){o[m]=goog.string.trim(q);if(o[m]!="*"){k=o[m].lastIndexOf(".");if(k==-1){n=o[m];b="*"}else{n=o[m].substring(0,k);b=k<o[m].length?o[m].substring(k+1):""}n=(n==""?"*":n).replace(/\?/g,".").replace(/\./g,"\\.").replace(/\*/g,b==""?"[^\\.]+":".+");b=b==""?"(?!\\.)":"\\."+b.replace(/\?/g,".").replace(/\./g,"\\.").replace(/\*/g,".+");a[m]=n+b}else{a[m]=".+"}});j=new RegExp("^"+j.join("|")+"$","i");o=o.join(",");g=g.toLowerCase();if(g=="icon"){g=au.upldr.upload.ConvertMode.ICON}else{if(g=="none"){g=au.upldr.upload.ConvertMode.NONE}else{if(g=="thumbnail"){if(au.upldr.support.isThumbnailCreationSupported()){g=au.upldr.upload.ConvertMode.THUMBNAIL}else{c="Thumbnail converter is not supported in your browser.";window.alert(c);au.upldr.utils.warning(c);g=au.upldr.upload.ConvertMode.NONE}}else{if(g=="sourcefile"){g=au.upldr.upload.ConvertMode.SOURCE}else{au.upldr.utils.warning("Failed to parse a converter mode "+g+". Defaulting to *.*=SourceFile");j=new RegExp("^.+..+$","i");g=au.upldr.upload.ConvertMode.SOURCE}}}}l.push({pattern:j,mode:g,mask:o})}return l};au.upldr.upload.Converter.prototype.getMode=function(){var d=this.rules_;var c="";var b,a=0;while(b=d[a++]){if(c){c+=";"}c+=b.mask+"="+b.mode}return c};au.upldr.upload.Converter.prototype.setMode=function(a){this.rules_=au.upldr.upload.Converter.parseMode(a)};au.upldr.upload.Converter.prototype.getThumbnailBgColor=function(){return this.thumbnailBgColor_};au.upldr.upload.Converter.prototype.setThumbnailBgColor=function(b){if(goog.isString(b)){var a=10;if(goog.string.startsWith(b,"0x")||goog.string.startsWith(b,"0X")){b=b.slice(2);a=16}else{if(goog.string.startsWith(b,"#")){b=b.slice(1);a=16}}b=parseInt(b,a)}this.thumbnailBgColor_=b};au.upldr.upload.Converter.prototype.getThumbnailFitMode=function(){return this.thumbnailFitMode_};au.upldr.upload.Converter.prototype.setThumbnailFitMode=function(a){this.thumbnailFitMode_=this.parseFitMode_(a)};au.upldr.upload.Converter.prototype.getThumbnailHeight=function(){return this.thumbnailHeight_};au.upldr.upload.Converter.prototype.setThumbnailHeight=function(a){this.thumbnailHeight_=a};au.upldr.upload.Converter.prototype.getThumbnailWidth=function(){return this.thumbnailWidth_};au.upldr.upload.Converter.prototype.setThumbnailWidth=function(a){this.thumbnailWidth_=a};au.upldr.upload.Converter.prototype.getThumbnailJpegQuality=function(){return this.thumbnailJpegQuality_};au.upldr.upload.Converter.prototype.setThumbnailJpegQuality=function(a){this.thumbnailJpegQuality_=a};au.upldr.upload.Converter.prototype.getThumbnailCopyExif=function(){return this._isThumbnailCopyExif};au.upldr.upload.Converter.prototype.setThumbnailCopyExif=function(a){this._isThumbnailCopyExif=a};au.upldr.upload.Converter.prototype.getThumbnailWatermark=function(){return this.thumbnailWatermark_};au.upldr.upload.Converter.prototype.setThumbnailApplyCrop=function(a){this.thumbnailApplyCrop_=a};au.upldr.upload.Converter.prototype.getThumbnailApplyCrop=function(){return this.thumbnailApplyCrop_};au.upldr.upload.Converter.prototype.setThumbnailApplyDrawTool=function(a){this.thumbnailApplyDrawTool_=a};au.upldr.upload.Converter.prototype.getThumbnailApplyDrawTool=function(){return this.thumbnailApplyDrawTool_};au.upldr.upload.Converter.prototype.setThumbnailWatermark=function(a){this.thumbnailWatermark_=(a?new au.upldr.imaging.watermark.WatermarkConfig(a):null)};au.upldr.upload.Converter.prototype.dump=function(){return"{ index: "+this.index_+", mode: "+this.getMode()+", thimbnailFitMode: "+this.thumbnailFitMode_+", thumbnailWidth: "+this.thumbnailWidth_+", thumbnailHeight: "+this.thumbnailHeight_+", thumbnailBgColor: "+au.upldr.utils.numberToHexColor(this.thumbnailBgColor_)+", thumbnailCopyExif: "+this._isThumbnailCopyExif+" }"};au.upldr.upload.Converter.prototype.parseFitMode_=function(a){if(!a){return au.upldr.image.FitMode.FIT}a=(a+"").toLowerCase();switch(a){case au.upldr.image.FitMode.FIT:case au.upldr.image.FitMode.WIDTH:case au.upldr.image.FitMode.HEIGHT:case au.upldr.image.FitMode.ACTUAL_SIZE:case au.upldr.image.FitMode.CROP:return(a);default:return au.upldr.image.FitMode.FIT}};au.upldr.upload.Converter.prototype.getWatermarkPreview=function(a,b){au.upldr.imaging.watermark.WatermarkWriter.writeOnImageDeferred(a,this.thumbnailWatermark_).addCallback(b)};au.upldr.upload.Converter.prototype.logger=goog.log.getLogger("au.upldr.upload.Converter");goog.provide("au.upldr.validate");goog.require("goog.log");goog.require("au.upldr.Properties");goog.require("au.upldr.DefaultValues");goog.require("au.upldr.upload.ProgressBytesMode");au.upldr.validate[au.upldr.Properties.WIDTH]=au.upldr.validate[au.upldr.Properties.HEIGHT]=function(a,b){a=(a+"").toLowerCase();if(/^\d+$/.test(a)){a+="px"}return a};au.upldr.validate[au.upldr.Properties.VIEW_MODE]=function(a,b){a=(a+"").toLowerCase();if(a!==au.upldr.ViewMode.TILES&&a!==au.upldr.ViewMode.THUMBNAILS&&a!==au.upldr.ViewMode.ICONS){au.upldr.validate.warnPropertyValue_(au.upldr.Properties.VIEW_MODE,a);a=au.upldr.DefaultValues[au.upldr.Properties.VIEW_MODE]}return a};au.upldr.validate[au.upldr.Properties.VIEW_COMBOBOX_TEXT]=function(a,b){if(!a||!goog.isArray(a)||a.length!==3){au.upldr.validate.warnPropertyValue_(au.upldr.Properties.VIEW_COMBOBOX_TEXT,a);a=au.upldr.DefaultValues[au.upldr.Properties.VIEW_COMBOBOX_TEXT]}return(a)};au.upldr.validate.validateImageRestriction_=function(a,d,e){var b=au.upldr.support.isImageRestrictionsSupported();if(!b){au.upldr.validate.logger_.warning("The image restrictions are not supported in this browser.");return au.upldr.DefaultValues[a]}var c=parseInt(d,10);if(isNaN(c)){c=au.upldr.DefaultValues[a];au.upldr.validate.warnPropertyValue_(a,d)}return c};au.upldr.validate[au.upldr.Properties.RESTRICTIONS_MAX_IMAGE_HEIGHT]=goog.partial(au.upldr.validate.validateImageRestriction_,au.upldr.Properties.RESTRICTIONS_MAX_IMAGE_HEIGHT);au.upldr.validate[au.upldr.Properties.RESTRICTIONS_MAX_IMAGE_WIDTH]=goog.partial(au.upldr.validate.validateImageRestriction_,au.upldr.Properties.RESTRICTIONS_MAX_IMAGE_WIDTH);au.upldr.validate[au.upldr.Properties.RESTRICTIONS_MIN_IMAGE_HEIGHT]=goog.partial(au.upldr.validate.validateImageRestriction_,au.upldr.Properties.RESTRICTIONS_MIN_IMAGE_HEIGHT);au.upldr.validate[au.upldr.Properties.RESTRICTIONS_MIN_IMAGE_WIDTH]=goog.partial(au.upldr.validate.validateImageRestriction_,au.upldr.Properties.RESTRICTIONS_MIN_IMAGE_WIDTH);au.upldr.validate[au.upldr.Properties.PROGRESS_BYTES_MODE]=function(b,c){var a=(b+"").toLowerCase();if(a==au.upldr.upload.ProgressBytesMode.BY_SOURCE_SIZE.toLowerCase()||a==="1"){a=au.upldr.upload.ProgressBytesMode.BY_SOURCE_SIZE}else{if(a===au.upldr.upload.ProgressBytesMode.BY_PACKAGE_SIZE.toLowerCase()||a==="0"){a=au.upldr.upload.ProgressBytesMode.BY_PACKAGE_SIZE}else{a=au.upldr.upload.ProgressBytesMode.BY_PACKAGE_SIZE;au.upldr.validate.warnPropertyValue_(au.upldr.Properties.PROGRESS_BYTES_MODE,b)}}return a};au.upldr.validate.warnPropertyValue_=function(a,b){au.upldr.validate.logger_.warning('Incorrect value for "'+a+'": "'+b+'"')};au.upldr.validate.logger_=goog.log.getLogger("au.upldr.validate");goog.provide("goog.string.StringBuffer");goog.string.StringBuffer=function(a,b){if(a!=null){this.append.apply(this,arguments)}};goog.string.StringBuffer.prototype.buffer_="";goog.string.StringBuffer.prototype.set=function(a){this.buffer_=""+a};goog.string.StringBuffer.prototype.append=function(b,a,d){this.buffer_+=b;if(a!=null){for(var c=1;c<arguments.length;c++){this.buffer_+=arguments[c]}}return this};goog.string.StringBuffer.prototype.clear=function(){this.buffer_=""};goog.string.StringBuffer.prototype.getLength=function(){return this.buffer_.length};goog.string.StringBuffer.prototype.toString=function(){return this.buffer_};goog.provide("goog.ui.Component");goog.provide("goog.ui.Component.Error");goog.provide("goog.ui.Component.EventType");goog.provide("goog.ui.Component.State");goog.require("goog.array");goog.require("goog.asserts");goog.require("goog.dom");goog.require("goog.dom.NodeType");goog.require("goog.events.EventHandler");goog.require("goog.events.EventTarget");goog.require("goog.object");goog.require("goog.style");goog.require("goog.ui.IdGenerator");goog.ui.Component=function(a){goog.events.EventTarget.call(this);this.dom_=a||goog.dom.getDomHelper();this.rightToLeft_=goog.ui.Component.defaultRightToLeft_;this.id_=null;this.inDocument_=false;this.element_=null;this.googUiComponentHandler_=void 0;this.model_=null;this.parent_=null;this.children_=null;this.childIndex_=null;this.wasDecorated_=false};goog.inherits(goog.ui.Component,goog.events.EventTarget);goog.define("goog.ui.Component.ALLOW_DETACHED_DECORATION",false);goog.ui.Component.prototype.idGenerator_=goog.ui.IdGenerator.getInstance();goog.define("goog.ui.Component.DEFAULT_BIDI_DIR",0);goog.ui.Component.defaultRightToLeft_=(goog.ui.Component.DEFAULT_BIDI_DIR==1)?false:(goog.ui.Component.DEFAULT_BIDI_DIR==-1)?true:null;goog.ui.Component.EventType={BEFORE_SHOW:"beforeshow",SHOW:"show",HIDE:"hide",DISABLE:"disable",ENABLE:"enable",HIGHLIGHT:"highlight",UNHIGHLIGHT:"unhighlight",ACTIVATE:"activate",DEACTIVATE:"deactivate",SELECT:"select",UNSELECT:"unselect",CHECK:"check",UNCHECK:"uncheck",FOCUS:"focus",BLUR:"blur",OPEN:"open",CLOSE:"close",ENTER:"enter",LEAVE:"leave",ACTION:"action",CHANGE:"change"};goog.ui.Component.Error={NOT_SUPPORTED:"Method not supported",DECORATE_INVALID:"Invalid element to decorate",ALREADY_RENDERED:"Component already rendered",PARENT_UNABLE_TO_BE_SET:"Unable to set parent component",CHILD_INDEX_OUT_OF_BOUNDS:"Child component index out of bounds",NOT_OUR_CHILD:"Child is not in parent component",NOT_IN_DOCUMENT:"Operation not supported while component is not in document",STATE_INVALID:"Invalid component state"};goog.ui.Component.State={ALL:255,DISABLED:1,HOVER:2,ACTIVE:4,SELECTED:8,CHECKED:16,FOCUSED:32,OPENED:64};goog.ui.Component.getStateTransitionEvent=function(b,a){switch(b){case goog.ui.Component.State.DISABLED:return a?goog.ui.Component.EventType.DISABLE:goog.ui.Component.EventType.ENABLE;case goog.ui.Component.State.HOVER:return a?goog.ui.Component.EventType.HIGHLIGHT:goog.ui.Component.EventType.UNHIGHLIGHT;case goog.ui.Component.State.ACTIVE:return a?goog.ui.Component.EventType.ACTIVATE:goog.ui.Component.EventType.DEACTIVATE;case goog.ui.Component.State.SELECTED:return a?goog.ui.Component.EventType.SELECT:goog.ui.Component.EventType.UNSELECT;case goog.ui.Component.State.CHECKED:return a?goog.ui.Component.EventType.CHECK:goog.ui.Component.EventType.UNCHECK;case goog.ui.Component.State.FOCUSED:return a?goog.ui.Component.EventType.FOCUS:goog.ui.Component.EventType.BLUR;case goog.ui.Component.State.OPENED:return a?goog.ui.Component.EventType.OPEN:goog.ui.Component.EventType.CLOSE;default:}throw Error(goog.ui.Component.Error.STATE_INVALID)};goog.ui.Component.setDefaultRightToLeft=function(a){goog.ui.Component.defaultRightToLeft_=a};goog.ui.Component.prototype.getId=function(){return this.id_||(this.id_=this.idGenerator_.getNextUniqueId())};goog.ui.Component.prototype.setId=function(a){if(this.parent_&&this.parent_.childIndex_){goog.object.remove(this.parent_.childIndex_,this.id_);goog.object.add(this.parent_.childIndex_,a,this)}this.id_=a};goog.ui.Component.prototype.getElement=function(){return this.element_};goog.ui.Component.prototype.getElementStrict=function(){var a=this.element_;goog.asserts.assert(a,"Can not call getElementStrict before rendering/decorating.");return a};goog.ui.Component.prototype.setElementInternal=function(a){this.element_=a};goog.ui.Component.prototype.getElementsByClass=function(a){return this.element_?this.dom_.getElementsByClass(a,this.element_):[]};goog.ui.Component.prototype.getElementByClass=function(a){return this.element_?this.dom_.getElementByClass(a,this.element_):null};goog.ui.Component.prototype.getRequiredElementByClass=function(b){var a=this.getElementByClass(b);goog.asserts.assert(a,"Expected element in component with class: %s",b);return a};goog.ui.Component.prototype.getHandler=function(){var a=(this);if(!a.googUiComponentHandler_){a.googUiComponentHandler_=new goog.events.EventHandler(a)}return a.googUiComponentHandler_};goog.ui.Component.prototype.setParent=function(a){if(this==a){throw Error(goog.ui.Component.Error.PARENT_UNABLE_TO_BE_SET)}if(a&&this.parent_&&this.id_&&this.parent_.getChild(this.id_)&&this.parent_!=a){throw Error(goog.ui.Component.Error.PARENT_UNABLE_TO_BE_SET)}this.parent_=a;goog.ui.Component.superClass_.setParentEventTarget.call(this,a)};goog.ui.Component.prototype.getParent=function(){return this.parent_};goog.ui.Component.prototype.setParentEventTarget=function(a){if(this.parent_&&this.parent_!=a){throw Error(goog.ui.Component.Error.NOT_SUPPORTED)}goog.ui.Component.superClass_.setParentEventTarget.call(this,a)};goog.ui.Component.prototype.getDomHelper=function(){return this.dom_};goog.ui.Component.prototype.isInDocument=function(){return this.inDocument_};goog.ui.Component.prototype.createDom=function(){this.element_=this.dom_.createElement("div")};goog.ui.Component.prototype.render=function(a){this.render_(a)};goog.ui.Component.prototype.renderBefore=function(a){this.render_((a.parentNode),a)};goog.ui.Component.prototype.render_=function(b,a){if(this.inDocument_){throw Error(goog.ui.Component.Error.ALREADY_RENDERED)}if(!this.element_){this.createDom()}if(b){b.insertBefore(this.element_,a||null)}else{this.dom_.getDocument().body.appendChild(this.element_)}if(!this.parent_||this.parent_.isInDocument()){this.enterDocument()}};goog.ui.Component.prototype.decorate=function(a){if(this.inDocument_){throw Error(goog.ui.Component.Error.ALREADY_RENDERED)}else{if(a&&this.canDecorate(a)){this.wasDecorated_=true;var b=goog.dom.getOwnerDocument(a);if(!this.dom_||this.dom_.getDocument()!=b){this.dom_=goog.dom.getDomHelper(a)}this.decorateInternal(a);if(!goog.ui.Component.ALLOW_DETACHED_DECORATION||goog.dom.contains(b,a)){this.enterDocument()}}else{throw Error(goog.ui.Component.Error.DECORATE_INVALID)}}};goog.ui.Component.prototype.canDecorate=function(a){return true};goog.ui.Component.prototype.wasDecorated=function(){return this.wasDecorated_};goog.ui.Component.prototype.decorateInternal=function(a){this.element_=a};goog.ui.Component.prototype.enterDocument=function(){this.inDocument_=true;this.forEachChild(function(a){if(!a.isInDocument()&&a.getElement()){a.enterDocument()}})};goog.ui.Component.prototype.exitDocument=function(){this.forEachChild(function(a){if(a.isInDocument()){a.exitDocument()}});if(this.googUiComponentHandler_){this.googUiComponentHandler_.removeAll()}this.inDocument_=false};goog.ui.Component.prototype.disposeInternal=function(){if(this.inDocument_){this.exitDocument()}if(this.googUiComponentHandler_){this.googUiComponentHandler_.dispose();delete this.googUiComponentHandler_}this.forEachChild(function(a){a.dispose()});if(!this.wasDecorated_&&this.element_){goog.dom.removeNode(this.element_)}this.children_=null;this.childIndex_=null;this.element_=null;this.model_=null;this.parent_=null;goog.ui.Component.superClass_.disposeInternal.call(this)};goog.ui.Component.prototype.makeId=function(a){return this.getId()+"."+a};goog.ui.Component.prototype.makeIds=function(a){var c={};for(var b in a){c[b]=this.makeId(a[b])}return c};goog.ui.Component.prototype.getModel=function(){return this.model_};goog.ui.Component.prototype.setModel=function(a){this.model_=a};goog.ui.Component.prototype.getFragmentFromId=function(a){return a.substring(this.getId().length+1)};goog.ui.Component.prototype.getElementByFragment=function(a){if(!this.inDocument_){throw Error(goog.ui.Component.Error.NOT_IN_DOCUMENT)}return this.dom_.getElement(this.makeId(a))};goog.ui.Component.prototype.addChild=function(b,a){this.addChildAt(b,this.getChildCount(),a)};goog.ui.Component.prototype.addChildAt=function(f,b,a){goog.asserts.assert(!!f,"Provided element must not be null.");if(f.inDocument_&&(a||!this.inDocument_)){throw Error(goog.ui.Component.Error.ALREADY_RENDERED)}if(b<0||b>this.getChildCount()){throw Error(goog.ui.Component.Error.CHILD_INDEX_OUT_OF_BOUNDS)}if(!this.childIndex_||!this.children_){this.childIndex_={};this.children_=[]}if(f.getParent()==this){goog.object.set(this.childIndex_,f.getId(),f);goog.array.remove(this.children_,f)}else{goog.object.add(this.childIndex_,f.getId(),f)}f.setParent(this);goog.array.insertAt(this.children_,f,b);if(f.inDocument_&&this.inDocument_&&f.getParent()==this){var e=this.getContentElement();var d=e.childNodes[b]||null;if(d!=f.getElement()){e.insertBefore(f.getElement(),d)}}else{if(a){if(!this.element_){this.createDom()}var c=this.getChildAt(b+1);f.render_(this.getContentElement(),c?c.element_:null)}else{if(this.inDocument_&&!f.inDocument_&&f.element_&&f.element_.parentNode&&f.element_.parentNode.nodeType==goog.dom.NodeType.ELEMENT){f.enterDocument()}}}};goog.ui.Component.prototype.getContentElement=function(){return this.element_};goog.ui.Component.prototype.isRightToLeft=function(){if(this.rightToLeft_==null){this.rightToLeft_=goog.style.isRightToLeft(this.inDocument_?this.element_:this.dom_.getDocument().body)}return(this.rightToLeft_)};goog.ui.Component.prototype.setRightToLeft=function(a){if(this.inDocument_){throw Error(goog.ui.Component.Error.ALREADY_RENDERED)}this.rightToLeft_=a};goog.ui.Component.prototype.hasChildren=function(){return !!this.children_&&this.children_.length!=0};goog.ui.Component.prototype.getChildCount=function(){return this.children_?this.children_.length:0};goog.ui.Component.prototype.getChildIds=function(){var a=[];this.forEachChild(function(b){a.push(b.getId())});return a};goog.ui.Component.prototype.getChild=function(a){return(this.childIndex_&&a)?(goog.object.get(this.childIndex_,a))||null:null};goog.ui.Component.prototype.getChildAt=function(a){return this.children_?this.children_[a]||null:null};goog.ui.Component.prototype.forEachChild=function(b,a){if(this.children_){goog.array.forEach(this.children_,b,a)}};goog.ui.Component.prototype.indexOfChild=function(a){return(this.children_&&a)?goog.array.indexOf(this.children_,a):-1};goog.ui.Component.prototype.removeChild=function(c,b){if(c){var a=goog.isString(c)?c:c.getId();c=this.getChild(a);if(a&&c){goog.object.remove(this.childIndex_,a);goog.array.remove(this.children_,c);if(b){c.exitDocument();if(c.element_){goog.dom.removeNode(c.element_)}}c.setParent(null)}}if(!c){throw Error(goog.ui.Component.Error.NOT_OUR_CHILD)}return(c)};goog.ui.Component.prototype.removeChildAt=function(a,b){return this.removeChild(this.getChildAt(a),b)};goog.ui.Component.prototype.removeChildren=function(b){var a=[];while(this.hasChildren()){a.push(this.removeChildAt(0,b))}return a};goog.provide("au.upldr.ui.Label");goog.require("goog.ui.Component");goog.require("goog.dom");goog.require("au.upldr.ui.ClassNames");au.upldr.ui.Label=function(b,a){goog.base(this,a);this.labelText_=goog.isDef(b)?b:"";this.html_=false};goog.inherits(au.upldr.ui.Label,goog.ui.Component);au.upldr.ui.Label.CSS_CLASS=au.upldr.ui.ClassNames.LABEL;au.upldr.ui.Label.prototype.getLabelText=function(){return this.labelText_};au.upldr.ui.Label.prototype.createDom=function(){var a=this.dom_.createDom("span",undefined,this.labelText_);this.decorateInternal(a)};au.upldr.ui.Label.prototype.decorateInternal=function(a){goog.base(this,"decorateInternal",a);this.labelText_=a.firstChild&&a.firstChild.nodeValue||"";goog.dom.classlist.addAll(a,au.upldr.ui.Label.CSS_CLASS.replace(/\s+/," ").split(" "))};au.upldr.ui.Label.prototype.setLabelText=function(b,a){this.labelText_=goog.isDef(b)?b:"";this.html_=!!a;this.updateElement_()};au.upldr.ui.Label.prototype.updateElement_=function(){var a=this.getElement();if(a){if(this.html_){a.innerHTML=this.labelText_}else{goog.dom.setTextContent(a,this.labelText_)}}};goog.provide("goog.a11y.aria.AutoCompleteValues");goog.provide("goog.a11y.aria.CheckedValues");goog.provide("goog.a11y.aria.DropEffectValues");goog.provide("goog.a11y.aria.ExpandedValues");goog.provide("goog.a11y.aria.GrabbedValues");goog.provide("goog.a11y.aria.InvalidValues");goog.provide("goog.a11y.aria.LivePriority");goog.provide("goog.a11y.aria.OrientationValues");goog.provide("goog.a11y.aria.PressedValues");goog.provide("goog.a11y.aria.RelevantValues");goog.provide("goog.a11y.aria.SelectedValues");goog.provide("goog.a11y.aria.SortValues");goog.provide("goog.a11y.aria.State");goog.a11y.aria.State={ACTIVEDESCENDANT:"activedescendant",ATOMIC:"atomic",AUTOCOMPLETE:"autocomplete",BUSY:"busy",CHECKED:"checked",CONTROLS:"controls",DESCRIBEDBY:"describedby",DISABLED:"disabled",DROPEFFECT:"dropeffect",EXPANDED:"expanded",FLOWTO:"flowto",GRABBED:"grabbed",HASPOPUP:"haspopup",HIDDEN:"hidden",INVALID:"invalid",LABEL:"label",LABELLEDBY:"labelledby",LEVEL:"level",LIVE:"live",MULTILINE:"multiline",MULTISELECTABLE:"multiselectable",ORIENTATION:"orientation",OWNS:"owns",POSINSET:"posinset",PRESSED:"pressed",READONLY:"readonly",RELEVANT:"relevant",REQUIRED:"required",SELECTED:"selected",SETSIZE:"setsize",SORT:"sort",VALUEMAX:"valuemax",VALUEMIN:"valuemin",VALUENOW:"valuenow",VALUETEXT:"valuetext"};goog.a11y.aria.AutoCompleteValues={INLINE:"inline",LIST:"list",BOTH:"both",NONE:"none"};goog.a11y.aria.DropEffectValues={COPY:"copy",MOVE:"move",LINK:"link",EXECUTE:"execute",POPUP:"popup",NONE:"none"};goog.a11y.aria.LivePriority={OFF:"off",POLITE:"polite",ASSERTIVE:"assertive"};goog.a11y.aria.OrientationValues={VERTICAL:"vertical",HORIZONTAL:"horizontal"};goog.a11y.aria.RelevantValues={ADDITIONS:"additions",REMOVALS:"removals",TEXT:"text",ALL:"all"};goog.a11y.aria.SortValues={ASCENDING:"ascending",DESCENDING:"descending",NONE:"none",OTHER:"other"};goog.a11y.aria.CheckedValues={TRUE:"true",FALSE:"false",MIXED:"mixed",UNDEFINED:"undefined"};goog.a11y.aria.ExpandedValues={TRUE:"true",FALSE:"false",UNDEFINED:"undefined"};goog.a11y.aria.GrabbedValues={TRUE:"true",FALSE:"false",UNDEFINED:"undefined"};goog.a11y.aria.InvalidValues={FALSE:"false",TRUE:"true",GRAMMAR:"grammar",SPELLING:"spelling"};goog.a11y.aria.PressedValues={TRUE:"true",FALSE:"false",MIXED:"mixed",UNDEFINED:"undefined"};goog.a11y.aria.SelectedValues={TRUE:"true",FALSE:"false",UNDEFINED:"undefined"};goog.provide("goog.a11y.aria.datatables");goog.require("goog.a11y.aria.State");goog.require("goog.object");goog.a11y.aria.DefaultStateValueMap_;goog.a11y.aria.datatables.getDefaultValuesMap=function(){if(!goog.a11y.aria.DefaultStateValueMap_){goog.a11y.aria.DefaultStateValueMap_=goog.object.create(goog.a11y.aria.State.ATOMIC,false,goog.a11y.aria.State.AUTOCOMPLETE,"none",goog.a11y.aria.State.DROPEFFECT,"none",goog.a11y.aria.State.HASPOPUP,false,goog.a11y.aria.State.LIVE,"off",goog.a11y.aria.State.MULTILINE,false,goog.a11y.aria.State.MULTISELECTABLE,false,goog.a11y.aria.State.ORIENTATION,"vertical",goog.a11y.aria.State.READONLY,false,goog.a11y.aria.State.RELEVANT,"additions text",goog.a11y.aria.State.REQUIRED,false,goog.a11y.aria.State.SORT,"none",goog.a11y.aria.State.BUSY,false,goog.a11y.aria.State.DISABLED,false,goog.a11y.aria.State.HIDDEN,false,goog.a11y.aria.State.INVALID,"false")}return goog.a11y.aria.DefaultStateValueMap_};goog.provide("goog.a11y.aria.Role");goog.a11y.aria.Role={ALERT:"alert",ALERTDIALOG:"alertdialog",APPLICATION:"application",ARTICLE:"article",BANNER:"banner",BUTTON:"button",CHECKBOX:"checkbox",COLUMNHEADER:"columnheader",COMBOBOX:"combobox",COMPLEMENTARY:"complementary",CONTENTINFO:"contentinfo",DEFINITION:"definition",DIALOG:"dialog",DIRECTORY:"directory",DOCUMENT:"document",FORM:"form",GRID:"grid",GRIDCELL:"gridcell",GROUP:"group",HEADING:"heading",IMG:"img",LINK:"link",LIST:"list",LISTBOX:"listbox",LISTITEM:"listitem",LOG:"log",MAIN:"main",MARQUEE:"marquee",MATH:"math",MENU:"menu",MENUBAR:"menubar",MENU_ITEM:"menuitem",MENU_ITEM_CHECKBOX:"menuitemcheckbox",MENU_ITEM_RADIO:"menuitemradio",NAVIGATION:"navigation",NOTE:"note",OPTION:"option",PRESENTATION:"presentation",PROGRESSBAR:"progressbar",RADIO:"radio",RADIOGROUP:"radiogroup",REGION:"region",ROW:"row",ROWGROUP:"rowgroup",ROWHEADER:"rowheader",SCROLLBAR:"scrollbar",SEARCH:"search",SEPARATOR:"separator",SLIDER:"slider",SPINBUTTON:"spinbutton",STATUS:"status",TAB:"tab",TAB_LIST:"tablist",TAB_PANEL:"tabpanel",TEXTBOX:"textbox",TIMER:"timer",TOOLBAR:"toolbar",TOOLTIP:"tooltip",TREE:"tree",TREEGRID:"treegrid",TREEITEM:"treeitem"};goog.provide("goog.a11y.aria");goog.require("goog.a11y.aria.Role");goog.require("goog.a11y.aria.State");goog.require("goog.a11y.aria.datatables");goog.require("goog.array");goog.require("goog.asserts");goog.require("goog.dom");goog.require("goog.dom.TagName");goog.require("goog.object");goog.require("goog.string");goog.a11y.aria.ARIA_PREFIX_="aria-";goog.a11y.aria.ROLE_ATTRIBUTE_="role";goog.a11y.aria.TAGS_WITH_ASSUMED_ROLES_=[goog.dom.TagName.A,goog.dom.TagName.AREA,goog.dom.TagName.BUTTON,goog.dom.TagName.HEAD,goog.dom.TagName.INPUT,goog.dom.TagName.LINK,goog.dom.TagName.MENU,goog.dom.TagName.META,goog.dom.TagName.OPTGROUP,goog.dom.TagName.OPTION,goog.dom.TagName.PROGRESS,goog.dom.TagName.STYLE,goog.dom.TagName.SELECT,goog.dom.TagName.SOURCE,goog.dom.TagName.TEXTAREA,goog.dom.TagName.TITLE,goog.dom.TagName.TRACK];goog.a11y.aria.setRole=function(b,a){if(!a){goog.a11y.aria.removeRole(b)}else{if(goog.asserts.ENABLE_ASSERTS){goog.asserts.assert(goog.object.containsValue(goog.a11y.aria.Role,a),"No such ARIA role "+a)}b.setAttribute(goog.a11y.aria.ROLE_ATTRIBUTE_,a)}};goog.a11y.aria.getRole=function(a){var b=a.getAttribute(goog.a11y.aria.ROLE_ATTRIBUTE_);return(b)||null};goog.a11y.aria.removeRole=function(a){a.removeAttribute(goog.a11y.aria.ROLE_ATTRIBUTE_)};goog.a11y.aria.setState=function(a,c,b){if(goog.isArray(b)){b=b.join(" ")}var e=goog.a11y.aria.getAriaAttributeName_(c);if(b===""||b==undefined){var d=goog.a11y.aria.datatables.getDefaultValuesMap();if(c in d){a.setAttribute(e,d[c])}else{a.removeAttribute(e)}}else{a.setAttribute(e,b)}};goog.a11y.aria.toggleState=function(b,a){var c=goog.a11y.aria.getState(b,a);if(!goog.string.isEmptyOrWhitespace(goog.string.makeSafe(c))&&!(c=="true"||c=="false")){goog.a11y.aria.removeState(b,(a));return}goog.a11y.aria.setState(b,a,c=="true"?"false":"true")};goog.a11y.aria.removeState=function(a,b){a.removeAttribute(goog.a11y.aria.getAriaAttributeName_(b))};goog.a11y.aria.getState=function(c,d){var a=(c.getAttribute(goog.a11y.aria.getAriaAttributeName_(d)));var b=a==null||a==undefined;return b?"":String(a)};goog.a11y.aria.getActiveDescendant=function(a){var b=goog.a11y.aria.getState(a,goog.a11y.aria.State.ACTIVEDESCENDANT);return goog.dom.getOwnerDocument(a).getElementById(b)};goog.a11y.aria.setActiveDescendant=function(a,b){var c="";if(b){c=b.id;goog.asserts.assert(c,"The active element should have an id.")}goog.a11y.aria.setState(a,goog.a11y.aria.State.ACTIVEDESCENDANT,c)};goog.a11y.aria.getLabel=function(a){return goog.a11y.aria.getState(a,goog.a11y.aria.State.LABEL)};goog.a11y.aria.setLabel=function(b,a){goog.a11y.aria.setState(b,goog.a11y.aria.State.LABEL,a)};goog.a11y.aria.assertRoleIsSetInternalUtil=function(b,a){if(goog.array.contains(goog.a11y.aria.TAGS_WITH_ASSUMED_ROLES_,b.tagName)){return}var c=(goog.a11y.aria.getRole(b));goog.asserts.assert(c!=null,"The element ARIA role cannot be null.");goog.asserts.assert(goog.array.contains(a,c),'Non existing or incorrect role set for element.The role set is "'+c+'". The role should be any of "'+a+'". Check the ARIA specification for more details http://www.w3.org/TR/wai-aria/roles.')};goog.a11y.aria.getStateBoolean=function(b,c){var a=(b.getAttribute(goog.a11y.aria.getAriaAttributeName_(c)));goog.asserts.assert(goog.isBoolean(a)||a==null||a=="true"||a=="false");if(a==null){return a}return goog.isBoolean(a)?a:a=="true"};goog.a11y.aria.getStateNumber=function(b,c){var a=(b.getAttribute(goog.a11y.aria.getAriaAttributeName_(c)));goog.asserts.assert((a==null||!isNaN(Number(a)))&&!goog.isBoolean(a));return a==null?null:Number(a)};goog.a11y.aria.getStateString=function(b,c){var a=b.getAttribute(goog.a11y.aria.getAriaAttributeName_(c));goog.asserts.assert((a==null||goog.isString(a))&&isNaN(Number(a))&&a!="true"&&a!="false");return a==null?null:a};goog.a11y.aria.getStringArrayStateInternalUtil=function(a,b){var c=a.getAttribute(goog.a11y.aria.getAriaAttributeName_(b));return goog.a11y.aria.splitStringOnWhitespace_(c)};goog.a11y.aria.splitStringOnWhitespace_=function(a){return a?a.split(/\s+/):[]};goog.a11y.aria.getAriaAttributeName_=function(a){if(goog.asserts.ENABLE_ASSERTS){goog.asserts.assert(a,"ARIA attribute cannot be empty.");goog.asserts.assert(goog.object.containsValue(goog.a11y.aria.State,a),"No such ARIA attribute "+a)}return goog.a11y.aria.ARIA_PREFIX_+a};goog.provide("goog.ui.ControlRenderer");goog.require("goog.a11y.aria");goog.require("goog.a11y.aria.Role");goog.require("goog.a11y.aria.State");goog.require("goog.array");goog.require("goog.asserts");goog.require("goog.dom");goog.require("goog.dom.classlist");goog.require("goog.object");goog.require("goog.string");goog.require("goog.style");goog.require("goog.ui.Component");goog.require("goog.userAgent");goog.ui.ControlRenderer=function(){};goog.addSingletonGetter(goog.ui.ControlRenderer);goog.tagUnsealableClass(goog.ui.ControlRenderer);goog.ui.ControlRenderer.getCustomRenderer=function(b,a){var c=new b();c.getCssClass=function(){return a};return c};goog.ui.ControlRenderer.CSS_CLASS=goog.getCssName("goog-control");goog.ui.ControlRenderer.IE6_CLASS_COMBINATIONS=[];goog.ui.ControlRenderer.ariaAttributeMap_;goog.ui.ControlRenderer.TOGGLE_ARIA_STATE_MAP_=goog.object.create(goog.a11y.aria.Role.BUTTON,goog.a11y.aria.State.PRESSED,goog.a11y.aria.Role.CHECKBOX,goog.a11y.aria.State.CHECKED,goog.a11y.aria.Role.MENU_ITEM,goog.a11y.aria.State.SELECTED,goog.a11y.aria.Role.MENU_ITEM_CHECKBOX,goog.a11y.aria.State.CHECKED,goog.a11y.aria.Role.MENU_ITEM_RADIO,goog.a11y.aria.State.CHECKED,goog.a11y.aria.Role.RADIO,goog.a11y.aria.State.CHECKED,goog.a11y.aria.Role.TAB,goog.a11y.aria.State.SELECTED,goog.a11y.aria.Role.TREEITEM,goog.a11y.aria.State.SELECTED);goog.ui.ControlRenderer.prototype.getAriaRole=function(){return undefined};goog.ui.ControlRenderer.prototype.createDom=function(b){var a=b.getDomHelper().createDom("div",this.getClassNames(b).join(" "),b.getContent());return a};goog.ui.ControlRenderer.prototype.getContentElement=function(a){return a};goog.ui.ControlRenderer.prototype.enableClassName=function(d,c,a){var b=(d.getElement?d.getElement():d);if(b){var e=[c];if(goog.userAgent.IE&&!goog.userAgent.isVersionOrHigher("7")){e=this.getAppliedCombinedClassNames_(goog.dom.classlist.get(b),c);e.push(c)}goog.dom.classlist.enableAll(b,e,a)}};goog.ui.ControlRenderer.prototype.enableExtraClassName=function(c,b,a){this.enableClassName(c,b,a)};goog.ui.ControlRenderer.prototype.canDecorate=function(a){return true};goog.ui.ControlRenderer.prototype.decorate=function(f,g){if(g.id){f.setId(g.id)}var h=this.getContentElement(g);if(h&&h.firstChild){f.setContentInternal(h.firstChild.nextSibling?goog.array.clone(h.childNodes):h.firstChild)}else{f.setContentInternal(null)}var c=0;var b=this.getCssClass();var d=this.getStructuralCssClass();var i=false;var e=false;var l=false;var a=goog.array.toArray(goog.dom.classlist.get(g));goog.array.forEach(a,function(m){if(!i&&m==b){i=true;if(d==b){e=true}}else{if(!e&&m==d){e=true}else{c|=this.getStateFromClass(m)}}if(this.getStateFromClass(m)==goog.ui.Component.State.DISABLED){goog.asserts.assertElement(h);if(goog.dom.isFocusableTabIndex(h)){goog.dom.setFocusableTabIndex(h,false)}}},this);f.setStateInternal(c);if(!i){a.push(b);if(d==b){e=true}}if(!e){a.push(d)}var j=f.getExtraClassNames();if(j){a.push.apply(a,j)}if(goog.userAgent.IE&&!goog.userAgent.isVersionOrHigher("7")){var k=this.getAppliedCombinedClassNames_(a);if(k.length>0){a.push.apply(a,k);l=true}}if(!i||!e||j||l){goog.dom.classlist.set(g,a.join(" "))}return g};goog.ui.ControlRenderer.prototype.initializeDom=function(a){if(a.isRightToLeft()){this.setRightToLeft(a.getElement(),true)}if(a.isEnabled()){this.setFocusable(a,a.isVisible())}};goog.ui.ControlRenderer.prototype.setAriaRole=function(c,a){var b=a||this.getAriaRole();if(b){goog.asserts.assert(c,"The element passed as a first parameter cannot be null.");var d=goog.a11y.aria.getRole(c);if(b==d){return}goog.a11y.aria.setRole(c,b)}};goog.ui.ControlRenderer.prototype.setAriaStates=function(c,b){goog.asserts.assert(c);goog.asserts.assert(b);var a=c.getAriaLabel();if(goog.isDefAndNotNull(a)){this.setAriaLabel(b,a)}if(!c.isVisible()){goog.a11y.aria.setState(b,goog.a11y.aria.State.HIDDEN,!c.isVisible())}if(!c.isEnabled()){this.updateAriaState(b,goog.ui.Component.State.DISABLED,!c.isEnabled())}if(c.isSupportedState(goog.ui.Component.State.SELECTED)){this.updateAriaState(b,goog.ui.Component.State.SELECTED,c.isSelected())}if(c.isSupportedState(goog.ui.Component.State.CHECKED)){this.updateAriaState(b,goog.ui.Component.State.CHECKED,c.isChecked())}if(c.isSupportedState(goog.ui.Component.State.OPENED)){this.updateAriaState(b,goog.ui.Component.State.OPENED,c.isOpen())}};goog.ui.ControlRenderer.prototype.setAriaLabel=function(b,a){goog.a11y.aria.setLabel(b,a)};goog.ui.ControlRenderer.prototype.setAllowTextSelection=function(a,b){goog.style.setUnselectable(a,!b,!goog.userAgent.IE&&!goog.userAgent.OPERA)};goog.ui.ControlRenderer.prototype.setRightToLeft=function(a,b){this.enableClassName(a,goog.getCssName(this.getStructuralCssClass(),"rtl"),b)};goog.ui.ControlRenderer.prototype.isFocusable=function(b){var a;if(b.isSupportedState(goog.ui.Component.State.FOCUSED)&&(a=b.getKeyEventTarget())){return goog.dom.isFocusableTabIndex(a)}return false};goog.ui.ControlRenderer.prototype.setFocusable=function(c,d){var a;if(c.isSupportedState(goog.ui.Component.State.FOCUSED)&&(a=c.getKeyEventTarget())){if(!d&&c.isFocused()){try{a.blur()}catch(b){}if(c.isFocused()){c.handleBlur(null)}}if(goog.dom.isFocusableTabIndex(a)!=d){goog.dom.setFocusableTabIndex(a,d)}}};goog.ui.ControlRenderer.prototype.setVisible=function(a,b){goog.style.setElementShown(a,b);if(a){goog.a11y.aria.setState(a,goog.a11y.aria.State.HIDDEN,!b)}};goog.ui.ControlRenderer.prototype.setState=function(e,d,a){var b=e.getElement();if(b){var c=this.getClassForState(d);if(c){this.enableClassName(e,c,a)}this.updateAriaState(b,d,a)}};goog.ui.ControlRenderer.prototype.updateAriaState=function(c,d,b){if(!goog.ui.ControlRenderer.ariaAttributeMap_){goog.ui.ControlRenderer.ariaAttributeMap_=goog.object.create(goog.ui.Component.State.DISABLED,goog.a11y.aria.State.DISABLED,goog.ui.Component.State.SELECTED,goog.a11y.aria.State.SELECTED,goog.ui.Component.State.CHECKED,goog.a11y.aria.State.CHECKED,goog.ui.Component.State.OPENED,goog.a11y.aria.State.EXPANDED)}goog.asserts.assert(c,"The element passed as a first parameter cannot be null.");var a=goog.ui.ControlRenderer.getAriaStateForAriaRole_(c,goog.ui.ControlRenderer.ariaAttributeMap_[d]);if(a){goog.a11y.aria.setState(c,a,b)}};goog.ui.ControlRenderer.getAriaStateForAriaRole_=function(c,a){var d=goog.a11y.aria.getRole(c);if(!d){return a}d=(d);var b=goog.ui.ControlRenderer.TOGGLE_ARIA_STATE_MAP_[d]||a;return goog.ui.ControlRenderer.isAriaState_(a)?b:a};goog.ui.ControlRenderer.isAriaState_=function(a){return a==goog.a11y.aria.State.CHECKED||a==goog.a11y.aria.State.SELECTED};goog.ui.ControlRenderer.prototype.setContent=function(c,d){var a=this.getContentElement(c);if(a){goog.dom.removeChildren(a);if(d){if(goog.isString(d)){goog.dom.setTextContent(a,d)}else{var b=function(f){if(f){var e=goog.dom.getOwnerDocument(a);a.appendChild(goog.isString(f)?e.createTextNode(f):f)}};if(goog.isArray(d)){goog.array.forEach(d,b)}else{if(goog.isArrayLike(d)&&!("nodeType" in d)){goog.array.forEach(goog.array.clone((d)),b)}else{b(d)}}}}}};goog.ui.ControlRenderer.prototype.getKeyEventTarget=function(a){return a.getElement()};goog.ui.ControlRenderer.prototype.getCssClass=function(){return goog.ui.ControlRenderer.CSS_CLASS};goog.ui.ControlRenderer.prototype.getIe6ClassCombinations=function(){return[]};goog.ui.ControlRenderer.prototype.getStructuralCssClass=function(){return this.getCssClass()};goog.ui.ControlRenderer.prototype.getClassNames=function(d){var a=this.getCssClass();var e=[a];var f=this.getStructuralCssClass();if(f!=a){e.push(f)}var c=this.getClassNamesForState(d.getState());e.push.apply(e,c);var b=d.getExtraClassNames();if(b){e.push.apply(e,b)}if(goog.userAgent.IE&&!goog.userAgent.isVersionOrHigher("7")){e.push.apply(e,this.getAppliedCombinedClassNames_(e))}return e};goog.ui.ControlRenderer.prototype.getAppliedCombinedClassNames_=function(c,a){var b=[];if(a){c=c.concat([a])}goog.array.forEach(this.getIe6ClassCombinations(),function(d){if(goog.array.every(d,goog.partial(goog.array.contains,c))&&(!a||goog.array.contains(d,a))){b.push(d.join("_"))}});return b};goog.ui.ControlRenderer.prototype.getClassNamesForState=function(b){var c=[];while(b){var a=b&-b;c.push(this.getClassForState((a)));b&=~a}return c};goog.ui.ControlRenderer.prototype.getClassForState=function(a){if(!this.classByState_){this.createClassByStateMap_()}return this.classByState_[a]};goog.ui.ControlRenderer.prototype.getStateFromClass=function(a){if(!this.stateByClass_){this.createStateByClassMap_()}var b=parseInt(this.stateByClass_[a],10);return(isNaN(b)?0:b)};goog.ui.ControlRenderer.prototype.createClassByStateMap_=function(){var b=this.getStructuralCssClass();var a=!goog.string.contains(goog.string.normalizeWhitespace(b)," ");goog.asserts.assert(a,"ControlRenderer has an invalid css class: '"+b+"'");this.classByState_=goog.object.create(goog.ui.Component.State.DISABLED,goog.getCssName(b,"disabled"),goog.ui.Component.State.HOVER,goog.getCssName(b,"hover"),goog.ui.Component.State.ACTIVE,goog.getCssName(b,"active"),goog.ui.Component.State.SELECTED,goog.getCssName(b,"selected"),goog.ui.Component.State.CHECKED,goog.getCssName(b,"checked"),goog.ui.Component.State.FOCUSED,goog.getCssName(b,"focused"),goog.ui.Component.State.OPENED,goog.getCssName(b,"open"))};goog.ui.ControlRenderer.prototype.createStateByClassMap_=function(){if(!this.classByState_){this.createClassByStateMap_()}this.stateByClass_=goog.object.transpose(this.classByState_)};goog.provide("goog.ui.ButtonSide");goog.ui.ButtonSide={NONE:0,START:1,END:2,BOTH:3};goog.provide("goog.ui.ButtonRenderer");goog.require("goog.a11y.aria");goog.require("goog.a11y.aria.Role");goog.require("goog.a11y.aria.State");goog.require("goog.asserts");goog.require("goog.ui.ButtonSide");goog.require("goog.ui.Component");goog.require("goog.ui.ControlRenderer");goog.ui.ButtonRenderer=function(){goog.ui.ControlRenderer.call(this)};goog.inherits(goog.ui.ButtonRenderer,goog.ui.ControlRenderer);goog.addSingletonGetter(goog.ui.ButtonRenderer);goog.ui.ButtonRenderer.CSS_CLASS=goog.getCssName("goog-button");goog.ui.ButtonRenderer.prototype.getAriaRole=function(){return goog.a11y.aria.Role.BUTTON};goog.ui.ButtonRenderer.prototype.updateAriaState=function(b,c,a){switch(c){case goog.ui.Component.State.SELECTED:case goog.ui.Component.State.CHECKED:goog.asserts.assert(b,"The button DOM element cannot be null.");goog.a11y.aria.setState(b,goog.a11y.aria.State.PRESSED,a);break;default:case goog.ui.Component.State.OPENED:case goog.ui.Component.State.DISABLED:goog.ui.ButtonRenderer.base(this,"updateAriaState",b,c,a);break}};goog.ui.ButtonRenderer.prototype.createDom=function(b){var a=goog.ui.ButtonRenderer.base(this,"createDom",b);this.setTooltip(a,b.getTooltip());var c=b.getValue();if(c){this.setValue(a,c)}if(b.isSupportedState(goog.ui.Component.State.CHECKED)){this.updateAriaState(a,goog.ui.Component.State.CHECKED,b.isChecked())}return a};goog.ui.ButtonRenderer.prototype.decorate=function(b,a){a=goog.ui.ButtonRenderer.superClass_.decorate.call(this,b,a);b.setValueInternal(this.getValue(a));b.setTooltipInternal(this.getTooltip(a));if(b.isSupportedState(goog.ui.Component.State.CHECKED)){this.updateAriaState(a,goog.ui.Component.State.CHECKED,b.isChecked())}return a};goog.ui.ButtonRenderer.prototype.getValue=goog.nullFunction;goog.ui.ButtonRenderer.prototype.setValue=goog.nullFunction;goog.ui.ButtonRenderer.prototype.getTooltip=function(a){return a.title};goog.ui.ButtonRenderer.prototype.setTooltip=function(a,b){if(a){if(b){a.title=b}else{a.removeAttribute("title")}}};goog.ui.ButtonRenderer.prototype.setCollapsed=function(c,d){var b=c.isRightToLeft();var a=goog.getCssName(this.getStructuralCssClass(),"collapse-left");var e=goog.getCssName(this.getStructuralCssClass(),"collapse-right");c.enableClassName(b?e:a,!!(d&goog.ui.ButtonSide.START));c.enableClassName(b?a:e,!!(d&goog.ui.ButtonSide.END))};goog.ui.ButtonRenderer.prototype.getCssClass=function(){return goog.ui.ButtonRenderer.CSS_CLASS};goog.provide("goog.events.KeyCodes");goog.require("goog.userAgent");goog.events.KeyCodes={WIN_KEY_FF_LINUX:0,MAC_ENTER:3,BACKSPACE:8,TAB:9,NUM_CENTER:12,ENTER:13,SHIFT:16,CTRL:17,ALT:18,PAUSE:19,CAPS_LOCK:20,ESC:27,SPACE:32,PAGE_UP:33,PAGE_DOWN:34,END:35,HOME:36,LEFT:37,UP:38,RIGHT:39,DOWN:40,PRINT_SCREEN:44,INSERT:45,DELETE:46,ZERO:48,ONE:49,TWO:50,THREE:51,FOUR:52,FIVE:53,SIX:54,SEVEN:55,EIGHT:56,NINE:57,FF_SEMICOLON:59,FF_EQUALS:61,FF_DASH:173,QUESTION_MARK:63,A:65,B:66,C:67,D:68,E:69,F:70,G:71,H:72,I:73,J:74,K:75,L:76,M:77,N:78,O:79,P:80,Q:81,R:82,S:83,T:84,U:85,V:86,W:87,X:88,Y:89,Z:90,META:91,WIN_KEY_RIGHT:92,CONTEXT_MENU:93,NUM_ZERO:96,NUM_ONE:97,NUM_TWO:98,NUM_THREE:99,NUM_FOUR:100,NUM_FIVE:101,NUM_SIX:102,NUM_SEVEN:103,NUM_EIGHT:104,NUM_NINE:105,NUM_MULTIPLY:106,NUM_PLUS:107,NUM_MINUS:109,NUM_PERIOD:110,NUM_DIVISION:111,F1:112,F2:113,F3:114,F4:115,F5:116,F6:117,F7:118,F8:119,F9:120,F10:121,F11:122,F12:123,NUMLOCK:144,SCROLL_LOCK:145,FIRST_MEDIA_KEY:166,LAST_MEDIA_KEY:183,SEMICOLON:186,DASH:189,EQUALS:187,COMMA:188,PERIOD:190,SLASH:191,APOSTROPHE:192,TILDE:192,SINGLE_QUOTE:222,OPEN_SQUARE_BRACKET:219,BACKSLASH:220,CLOSE_SQUARE_BRACKET:221,WIN_KEY:224,MAC_FF_META:224,MAC_WK_CMD_LEFT:91,MAC_WK_CMD_RIGHT:93,WIN_IME:229,VK_NONAME:252,PHANTOM:255};goog.events.KeyCodes.isTextModifyingKeyEvent=function(a){if(a.altKey&&!a.ctrlKey||a.metaKey||a.keyCode>=goog.events.KeyCodes.F1&&a.keyCode<=goog.events.KeyCodes.F12){return false}switch(a.keyCode){case goog.events.KeyCodes.ALT:case goog.events.KeyCodes.CAPS_LOCK:case goog.events.KeyCodes.CONTEXT_MENU:case goog.events.KeyCodes.CTRL:case goog.events.KeyCodes.DOWN:case goog.events.KeyCodes.END:case goog.events.KeyCodes.ESC:case goog.events.KeyCodes.HOME:case goog.events.KeyCodes.INSERT:case goog.events.KeyCodes.LEFT:case goog.events.KeyCodes.MAC_FF_META:case goog.events.KeyCodes.META:case goog.events.KeyCodes.NUMLOCK:case goog.events.KeyCodes.NUM_CENTER:case goog.events.KeyCodes.PAGE_DOWN:case goog.events.KeyCodes.PAGE_UP:case goog.events.KeyCodes.PAUSE:case goog.events.KeyCodes.PHANTOM:case goog.events.KeyCodes.PRINT_SCREEN:case goog.events.KeyCodes.RIGHT:case goog.events.KeyCodes.SCROLL_LOCK:case goog.events.KeyCodes.SHIFT:case goog.events.KeyCodes.UP:case goog.events.KeyCodes.VK_NONAME:case goog.events.KeyCodes.WIN_KEY:case goog.events.KeyCodes.WIN_KEY_RIGHT:return false;case goog.events.KeyCodes.WIN_KEY_FF_LINUX:return !goog.userAgent.GECKO;default:return a.keyCode<goog.events.KeyCodes.FIRST_MEDIA_KEY||a.keyCode>goog.events.KeyCodes.LAST_MEDIA_KEY}};goog.events.KeyCodes.firesKeyPressEvent=function(e,d,c,a,b){if(!goog.userAgent.IE&&!(goog.userAgent.WEBKIT&&goog.userAgent.isVersionOrHigher("525"))){return true}if(goog.userAgent.MAC&&b){return goog.events.KeyCodes.isCharacterKey(e)}if(b&&!a){return false}if(goog.isNumber(d)){d=goog.events.KeyCodes.normalizeKeyCode(d)}if(!c&&(d==goog.events.KeyCodes.CTRL||d==goog.events.KeyCodes.ALT||goog.userAgent.MAC&&d==goog.events.KeyCodes.META)){return false}if(goog.userAgent.WEBKIT&&a&&c){switch(e){case goog.events.KeyCodes.BACKSLASH:case goog.events.KeyCodes.OPEN_SQUARE_BRACKET:case goog.events.KeyCodes.CLOSE_SQUARE_BRACKET:case goog.events.KeyCodes.TILDE:case goog.events.KeyCodes.SEMICOLON:case goog.events.KeyCodes.DASH:case goog.events.KeyCodes.EQUALS:case goog.events.KeyCodes.COMMA:case goog.events.KeyCodes.PERIOD:case goog.events.KeyCodes.SLASH:case goog.events.KeyCodes.APOSTROPHE:case goog.events.KeyCodes.SINGLE_QUOTE:return false}}if(goog.userAgent.IE&&a&&d==e){return false}switch(e){case goog.events.KeyCodes.ENTER:return true;case goog.events.KeyCodes.ESC:return !goog.userAgent.WEBKIT}return goog.events.KeyCodes.isCharacterKey(e)};goog.events.KeyCodes.isCharacterKey=function(a){if(a>=goog.events.KeyCodes.ZERO&&a<=goog.events.KeyCodes.NINE){return true}if(a>=goog.events.KeyCodes.NUM_ZERO&&a<=goog.events.KeyCodes.NUM_MULTIPLY){return true}if(a>=goog.events.KeyCodes.A&&a<=goog.events.KeyCodes.Z){return true}if(goog.userAgent.WEBKIT&&a==0){return true}switch(a){case goog.events.KeyCodes.SPACE:case goog.events.KeyCodes.QUESTION_MARK:case goog.events.KeyCodes.NUM_PLUS:case goog.events.KeyCodes.NUM_MINUS:case goog.events.KeyCodes.NUM_PERIOD:case goog.events.KeyCodes.NUM_DIVISION:case goog.events.KeyCodes.SEMICOLON:case goog.events.KeyCodes.FF_SEMICOLON:case goog.events.KeyCodes.DASH:case goog.events.KeyCodes.EQUALS:case goog.events.KeyCodes.FF_EQUALS:case goog.events.KeyCodes.COMMA:case goog.events.KeyCodes.PERIOD:case goog.events.KeyCodes.SLASH:case goog.events.KeyCodes.APOSTROPHE:case goog.events.KeyCodes.SINGLE_QUOTE:case goog.events.KeyCodes.OPEN_SQUARE_BRACKET:case goog.events.KeyCodes.BACKSLASH:case goog.events.KeyCodes.CLOSE_SQUARE_BRACKET:return true;default:return false}};goog.events.KeyCodes.normalizeKeyCode=function(a){if(goog.userAgent.GECKO){return goog.events.KeyCodes.normalizeGeckoKeyCode(a)}else{if(goog.userAgent.MAC&&goog.userAgent.WEBKIT){return goog.events.KeyCodes.normalizeMacWebKitKeyCode(a)}else{return a}}};goog.events.KeyCodes.normalizeGeckoKeyCode=function(a){switch(a){case goog.events.KeyCodes.FF_EQUALS:return goog.events.KeyCodes.EQUALS;case goog.events.KeyCodes.FF_SEMICOLON:return goog.events.KeyCodes.SEMICOLON;case goog.events.KeyCodes.FF_DASH:return goog.events.KeyCodes.DASH;case goog.events.KeyCodes.MAC_FF_META:return goog.events.KeyCodes.META;case goog.events.KeyCodes.WIN_KEY_FF_LINUX:return goog.events.KeyCodes.WIN_KEY;default:return a}};goog.events.KeyCodes.normalizeMacWebKitKeyCode=function(a){switch(a){case goog.events.KeyCodes.MAC_WK_CMD_RIGHT:return goog.events.KeyCodes.META;default:return a}};goog.provide("goog.ui.NativeButtonRenderer");goog.require("goog.asserts");goog.require("goog.dom.classlist");goog.require("goog.events.EventType");goog.require("goog.ui.ButtonRenderer");goog.require("goog.ui.Component");goog.ui.NativeButtonRenderer=function(){goog.ui.ButtonRenderer.call(this)};goog.inherits(goog.ui.NativeButtonRenderer,goog.ui.ButtonRenderer);goog.addSingletonGetter(goog.ui.NativeButtonRenderer);goog.ui.NativeButtonRenderer.prototype.getAriaRole=function(){return undefined};goog.ui.NativeButtonRenderer.prototype.createDom=function(a){this.setUpNativeButton_(a);return a.getDomHelper().createDom("button",{"class":this.getClassNames(a).join(" "),disabled:!a.isEnabled(),title:a.getTooltip()||"",value:a.getValue()||""},a.getCaption()||"")};goog.ui.NativeButtonRenderer.prototype.canDecorate=function(a){return a.tagName=="BUTTON"||(a.tagName=="INPUT"&&(a.type=="button"||a.type=="submit"||a.type=="reset"))};goog.ui.NativeButtonRenderer.prototype.decorate=function(c,b){this.setUpNativeButton_(c);if(b.disabled){var a=goog.asserts.assertString(this.getClassForState(goog.ui.Component.State.DISABLED));goog.dom.classlist.add(b,a)}return goog.ui.NativeButtonRenderer.superClass_.decorate.call(this,c,b)};goog.ui.NativeButtonRenderer.prototype.initializeDom=function(a){a.getHandler().listen(a.getElement(),goog.events.EventType.CLICK,a.performActionInternal)};goog.ui.NativeButtonRenderer.prototype.setAllowTextSelection=goog.nullFunction;goog.ui.NativeButtonRenderer.prototype.setRightToLeft=goog.nullFunction;goog.ui.NativeButtonRenderer.prototype.isFocusable=function(a){return a.isEnabled()};goog.ui.NativeButtonRenderer.prototype.setFocusable=goog.nullFunction;goog.ui.NativeButtonRenderer.prototype.setState=function(c,d,a){goog.ui.NativeButtonRenderer.superClass_.setState.call(this,c,d,a);var b=c.getElement();if(b&&d==goog.ui.Component.State.DISABLED){b.disabled=a}};goog.ui.NativeButtonRenderer.prototype.getValue=function(a){return a.value};goog.ui.NativeButtonRenderer.prototype.setValue=function(a,b){if(a){a.value=b}};goog.ui.NativeButtonRenderer.prototype.updateAriaState=goog.nullFunction;goog.ui.NativeButtonRenderer.prototype.setUpNativeButton_=function(a){a.setHandleMouseEvents(false);a.setAutoStates(goog.ui.Component.State.ALL,false);a.setSupportedState(goog.ui.Component.State.FOCUSED,false)};goog.provide("goog.ui.registry");goog.require("goog.asserts");goog.require("goog.dom.classlist");goog.ui.registry.getDefaultRenderer=function(b){var a;var c;while(b){a=goog.getUid(b);if((c=goog.ui.registry.defaultRenderers_[a])){break}b=b.superClass_?b.superClass_.constructor:null}if(c){return goog.isFunction(c.getInstance)?c.getInstance():new c()}return null};goog.ui.registry.setDefaultRenderer=function(b,c){if(!goog.isFunction(b)){throw Error("Invalid component class "+b)}if(!goog.isFunction(c)){throw Error("Invalid renderer class "+c)}var a=goog.getUid(b);goog.ui.registry.defaultRenderers_[a]=c};goog.ui.registry.getDecoratorByClassName=function(a){return a in goog.ui.registry.decoratorFunctions_?goog.ui.registry.decoratorFunctions_[a]():null};goog.ui.registry.setDecoratorByClassName=function(a,b){if(!a){throw Error("Invalid class name "+a)}if(!goog.isFunction(b)){throw Error("Invalid decorator function "+b)}goog.ui.registry.decoratorFunctions_[a]=b};goog.ui.registry.getDecorator=function(d){var b;goog.asserts.assert(d);var e=goog.dom.classlist.get(d);for(var c=0,a=e.length;c<a;c++){if((b=goog.ui.registry.getDecoratorByClassName(e[c]))){return b}}return null};goog.ui.registry.reset=function(){goog.ui.registry.defaultRenderers_={};goog.ui.registry.decoratorFunctions_={}};goog.ui.registry.defaultRenderers_={};goog.ui.registry.decoratorFunctions_={};goog.provide("goog.events.KeyEvent");goog.provide("goog.events.KeyHandler");goog.provide("goog.events.KeyHandler.EventType");goog.require("goog.events");goog.require("goog.events.BrowserEvent");goog.require("goog.events.EventTarget");goog.require("goog.events.EventType");goog.require("goog.events.KeyCodes");goog.require("goog.userAgent");goog.events.KeyHandler=function(b,a){goog.events.EventTarget.call(this);if(b){this.attach(b,a)}};goog.inherits(goog.events.KeyHandler,goog.events.EventTarget);goog.events.KeyHandler.prototype.element_=null;goog.events.KeyHandler.prototype.keyPressKey_=null;goog.events.KeyHandler.prototype.keyDownKey_=null;goog.events.KeyHandler.prototype.keyUpKey_=null;goog.events.KeyHandler.prototype.lastKey_=-1;goog.events.KeyHandler.prototype.keyCode_=-1;goog.events.KeyHandler.prototype.altKey_=false;goog.events.KeyHandler.EventType={KEY:"key"};goog.events.KeyHandler.safariKey_={"3":goog.events.KeyCodes.ENTER,"12":goog.events.KeyCodes.NUMLOCK,"63232":goog.events.KeyCodes.UP,"63233":goog.events.KeyCodes.DOWN,"63234":goog.events.KeyCodes.LEFT,"63235":goog.events.KeyCodes.RIGHT,"63236":goog.events.KeyCodes.F1,"63237":goog.events.KeyCodes.F2,"63238":goog.events.KeyCodes.F3,"63239":goog.events.KeyCodes.F4,"63240":goog.events.KeyCodes.F5,"63241":goog.events.KeyCodes.F6,"63242":goog.events.KeyCodes.F7,"63243":goog.events.KeyCodes.F8,"63244":goog.events.KeyCodes.F9,"63245":goog.events.KeyCodes.F10,"63246":goog.events.KeyCodes.F11,"63247":goog.events.KeyCodes.F12,"63248":goog.events.KeyCodes.PRINT_SCREEN,"63272":goog.events.KeyCodes.DELETE,"63273":goog.events.KeyCodes.HOME,"63275":goog.events.KeyCodes.END,"63276":goog.events.KeyCodes.PAGE_UP,"63277":goog.events.KeyCodes.PAGE_DOWN,"63289":goog.events.KeyCodes.NUMLOCK,"63302":goog.events.KeyCodes.INSERT};goog.events.KeyHandler.keyIdentifier_={Up:goog.events.KeyCodes.UP,Down:goog.events.KeyCodes.DOWN,Left:goog.events.KeyCodes.LEFT,Right:goog.events.KeyCodes.RIGHT,Enter:goog.events.KeyCodes.ENTER,F1:goog.events.KeyCodes.F1,F2:goog.events.KeyCodes.F2,F3:goog.events.KeyCodes.F3,F4:goog.events.KeyCodes.F4,F5:goog.events.KeyCodes.F5,F6:goog.events.KeyCodes.F6,F7:goog.events.KeyCodes.F7,F8:goog.events.KeyCodes.F8,F9:goog.events.KeyCodes.F9,F10:goog.events.KeyCodes.F10,F11:goog.events.KeyCodes.F11,F12:goog.events.KeyCodes.F12,"U+007F":goog.events.KeyCodes.DELETE,Home:goog.events.KeyCodes.HOME,End:goog.events.KeyCodes.END,PageUp:goog.events.KeyCodes.PAGE_UP,PageDown:goog.events.KeyCodes.PAGE_DOWN,Insert:goog.events.KeyCodes.INSERT};goog.events.KeyHandler.USES_KEYDOWN_=goog.userAgent.IE||goog.userAgent.WEBKIT&&goog.userAgent.isVersionOrHigher("525");goog.events.KeyHandler.SAVE_ALT_FOR_KEYPRESS_=goog.userAgent.MAC&&goog.userAgent.GECKO;goog.events.KeyHandler.prototype.handleKeyDown_=function(a){if(goog.userAgent.WEBKIT){if(this.lastKey_==goog.events.KeyCodes.CTRL&&!a.ctrlKey||this.lastKey_==goog.events.KeyCodes.ALT&&!a.altKey||goog.userAgent.MAC&&this.lastKey_==goog.events.KeyCodes.META&&!a.metaKey){this.lastKey_=-1;this.keyCode_=-1}}if(this.lastKey_==-1){if(a.ctrlKey&&a.keyCode!=goog.events.KeyCodes.CTRL){this.lastKey_=goog.events.KeyCodes.CTRL}else{if(a.altKey&&a.keyCode!=goog.events.KeyCodes.ALT){this.lastKey_=goog.events.KeyCodes.ALT}else{if(a.metaKey&&a.keyCode!=goog.events.KeyCodes.META){this.lastKey_=goog.events.KeyCodes.META}}}}if(goog.events.KeyHandler.USES_KEYDOWN_&&!goog.events.KeyCodes.firesKeyPressEvent(a.keyCode,this.lastKey_,a.shiftKey,a.ctrlKey,a.altKey)){this.handleEvent(a)}else{this.keyCode_=goog.events.KeyCodes.normalizeKeyCode(a.keyCode);if(goog.events.KeyHandler.SAVE_ALT_FOR_KEYPRESS_){this.altKey_=a.altKey}}};goog.events.KeyHandler.prototype.resetState=function(){this.lastKey_=-1;this.keyCode_=-1};goog.events.KeyHandler.prototype.handleKeyup_=function(a){this.resetState();this.altKey_=a.altKey};goog.events.KeyHandler.prototype.handleEvent=function(g){var f=g.getBrowserEvent();var j,i;var a=f.altKey;if(goog.userAgent.IE&&g.type==goog.events.EventType.KEYPRESS){j=this.keyCode_;i=j!=goog.events.KeyCodes.ENTER&&j!=goog.events.KeyCodes.ESC?f.keyCode:0}else{if(goog.userAgent.WEBKIT&&g.type==goog.events.EventType.KEYPRESS){j=this.keyCode_;i=f.charCode>=0&&f.charCode<63232&&goog.events.KeyCodes.isCharacterKey(j)?f.charCode:0}else{if(goog.userAgent.OPERA){j=this.keyCode_;i=goog.events.KeyCodes.isCharacterKey(j)?f.keyCode:0}else{j=f.keyCode||this.keyCode_;i=f.charCode||0;if(goog.events.KeyHandler.SAVE_ALT_FOR_KEYPRESS_){a=this.altKey_}if(goog.userAgent.MAC&&i==goog.events.KeyCodes.QUESTION_MARK&&j==goog.events.KeyCodes.WIN_KEY){j=goog.events.KeyCodes.SLASH}}}}j=goog.events.KeyCodes.normalizeKeyCode(j);var h=j;var d=f.keyIdentifier;if(j){if(j>=63232&&j in goog.events.KeyHandler.safariKey_){h=goog.events.KeyHandler.safariKey_[j]}else{if(j==25&&g.shiftKey){h=9}}}else{if(d&&d in goog.events.KeyHandler.keyIdentifier_){h=goog.events.KeyHandler.keyIdentifier_[d]}}var c=h==this.lastKey_;this.lastKey_=h;var b=new goog.events.KeyEvent(h,i,c,f);b.altKey=a;this.dispatchEvent(b)};goog.events.KeyHandler.prototype.getElement=function(){return this.element_};goog.events.KeyHandler.prototype.attach=function(a,b){if(this.keyUpKey_){this.detach()}this.element_=a;this.keyPressKey_=goog.events.listen(this.element_,goog.events.EventType.KEYPRESS,this,b);this.keyDownKey_=goog.events.listen(this.element_,goog.events.EventType.KEYDOWN,this.handleKeyDown_,b,this);this.keyUpKey_=goog.events.listen(this.element_,goog.events.EventType.KEYUP,this.handleKeyup_,b,this)};goog.events.KeyHandler.prototype.detach=function(){if(this.keyPressKey_){goog.events.unlistenByKey(this.keyPressKey_);goog.events.unlistenByKey(this.keyDownKey_);goog.events.unlistenByKey(this.keyUpKey_);this.keyPressKey_=null;this.keyDownKey_=null;this.keyUpKey_=null}this.element_=null;this.lastKey_=-1;this.keyCode_=-1};goog.events.KeyHandler.prototype.disposeInternal=function(){goog.events.KeyHandler.superClass_.disposeInternal.call(this);this.detach()};goog.events.KeyEvent=function(c,a,b,d){goog.events.BrowserEvent.call(this,d);this.type=goog.events.KeyHandler.EventType.KEY;this.keyCode=c;this.charCode=a;this.repeat=b};goog.inherits(goog.events.KeyEvent,goog.events.BrowserEvent);goog.provide("goog.ui.decorate");goog.require("goog.ui.registry");goog.ui.decorate=function(b){var a=goog.ui.registry.getDecorator(b);if(a){a.decorate(b)}return a};goog.provide("goog.ui.ControlContent");goog.ui.ControlContent;goog.provide("goog.ui.Control");goog.require("goog.Disposable");goog.require("goog.array");goog.require("goog.dom");goog.require("goog.events.BrowserEvent");goog.require("goog.events.Event");goog.require("goog.events.EventHandler");goog.require("goog.events.EventType");goog.require("goog.events.KeyCodes");goog.require("goog.events.KeyHandler");goog.require("goog.string");goog.require("goog.ui.Component");goog.require("goog.ui.ControlContent");goog.require("goog.ui.ControlRenderer");goog.require("goog.ui.decorate");goog.require("goog.ui.registry");goog.require("goog.userAgent");goog.ui.Control=function(c,b,a){goog.ui.Component.call(this,a);this.renderer_=b||goog.ui.registry.getDefaultRenderer(this.constructor);this.setContentInternal(goog.isDef(c)?c:null);this.ariaLabel_=null;this.ieMouseEventSequenceSimulator_};goog.inherits(goog.ui.Control,goog.ui.Component);goog.tagUnsealableClass(goog.ui.Control);goog.ui.Control.registerDecorator=goog.ui.registry.setDecoratorByClassName;goog.ui.Control.getDecorator=(goog.ui.registry.getDecorator);goog.ui.Control.decorate=(goog.ui.decorate);goog.ui.Control.prototype.renderer_;goog.ui.Control.prototype.content_=null;goog.ui.Control.prototype.state_=0;goog.ui.Control.prototype.supportedStates_=goog.ui.Component.State.DISABLED|goog.ui.Component.State.HOVER|goog.ui.Component.State.ACTIVE|goog.ui.Component.State.FOCUSED;goog.ui.Control.prototype.autoStates_=goog.ui.Component.State.ALL;goog.ui.Control.prototype.statesWithTransitionEvents_=0;goog.ui.Control.prototype.visible_=true;goog.ui.Control.prototype.keyHandler_;goog.ui.Control.prototype.extraClassNames_=null;goog.ui.Control.prototype.handleMouseEvents_=true;goog.ui.Control.prototype.allowTextSelection_=false;goog.ui.Control.prototype.preferredAriaRole_=null;goog.ui.Control.prototype.isHandleMouseEvents=function(){return this.handleMouseEvents_};goog.ui.Control.prototype.setHandleMouseEvents=function(a){if(this.isInDocument()&&a!=this.handleMouseEvents_){this.enableMouseEventHandling_(a)}this.handleMouseEvents_=a};goog.ui.Control.prototype.getKeyEventTarget=function(){return this.renderer_.getKeyEventTarget(this)};goog.ui.Control.prototype.getKeyHandler=function(){return this.keyHandler_||(this.keyHandler_=new goog.events.KeyHandler())};goog.ui.Control.prototype.getRenderer=function(){return this.renderer_};goog.ui.Control.prototype.setRenderer=function(a){if(this.isInDocument()){throw Error(goog.ui.Component.Error.ALREADY_RENDERED)}if(this.getElement()){this.setElementInternal(null)}this.renderer_=a};goog.ui.Control.prototype.getExtraClassNames=function(){return this.extraClassNames_};goog.ui.Control.prototype.addClassName=function(a){if(a){if(this.extraClassNames_){if(!goog.array.contains(this.extraClassNames_,a)){this.extraClassNames_.push(a)}}else{this.extraClassNames_=[a]}this.renderer_.enableExtraClassName(this,a,true)}};goog.ui.Control.prototype.removeClassName=function(a){if(a&&this.extraClassNames_&&goog.array.remove(this.extraClassNames_,a)){if(this.extraClassNames_.length==0){this.extraClassNames_=null}this.renderer_.enableExtraClassName(this,a,false)}};goog.ui.Control.prototype.enableClassName=function(b,a){if(a){this.addClassName(b)}else{this.removeClassName(b)}};goog.ui.Control.prototype.createDom=function(){var a=this.renderer_.createDom(this);this.setElementInternal(a);this.renderer_.setAriaRole(a,this.getPreferredAriaRole());if(!this.isAllowTextSelection()){this.renderer_.setAllowTextSelection(a,false)}if(!this.isVisible()){this.renderer_.setVisible(a,false)}};goog.ui.Control.prototype.getPreferredAriaRole=function(){return this.preferredAriaRole_};goog.ui.Control.prototype.setPreferredAriaRole=function(a){this.preferredAriaRole_=a};goog.ui.Control.prototype.getAriaLabel=function(){return this.ariaLabel_};goog.ui.Control.prototype.setAriaLabel=function(a){this.ariaLabel_=a;var b=this.getElement();if(b){this.renderer_.setAriaLabel(b,a)}};goog.ui.Control.prototype.getContentElement=function(){return this.renderer_.getContentElement(this.getElement())};goog.ui.Control.prototype.canDecorate=function(a){return this.renderer_.canDecorate(a)};goog.ui.Control.prototype.decorateInternal=function(a){a=this.renderer_.decorate(this,a);this.setElementInternal(a);this.renderer_.setAriaRole(a,this.getPreferredAriaRole());if(!this.isAllowTextSelection()){this.renderer_.setAllowTextSelection(a,false)}this.visible_=a.style.display!="none"};goog.ui.Control.prototype.enterDocument=function(){goog.ui.Control.superClass_.enterDocument.call(this);this.renderer_.setAriaStates(this,this.getElementStrict());this.renderer_.initializeDom(this);if(this.supportedStates_&~goog.ui.Component.State.DISABLED){if(this.isHandleMouseEvents()){this.enableMouseEventHandling_(true)}if(this.isSupportedState(goog.ui.Component.State.FOCUSED)){var a=this.getKeyEventTarget();if(a){var b=this.getKeyHandler();b.attach(a);this.getHandler().listen(b,goog.events.KeyHandler.EventType.KEY,this.handleKeyEvent).listen(a,goog.events.EventType.FOCUS,this.handleFocus).listen(a,goog.events.EventType.BLUR,this.handleBlur)}}}};goog.ui.Control.prototype.enableMouseEventHandling_=function(a){var c=this.getHandler();var b=this.getElement();if(a){c.listen(b,goog.events.EventType.MOUSEOVER,this.handleMouseOver).listen(b,goog.events.EventType.MOUSEDOWN,this.handleMouseDown).listen(b,goog.events.EventType.MOUSEUP,this.handleMouseUp).listen(b,goog.events.EventType.MOUSEOUT,this.handleMouseOut);if(this.handleContextMenu!=goog.nullFunction){c.listen(b,goog.events.EventType.CONTEXTMENU,this.handleContextMenu)}if(goog.userAgent.IE){c.listen(b,goog.events.EventType.DBLCLICK,this.handleDblClick);if(!this.ieMouseEventSequenceSimulator_){this.ieMouseEventSequenceSimulator_=new goog.ui.Control.IeMouseEventSequenceSimulator_(this);this.registerDisposable(this.ieMouseEventSequenceSimulator_)}}}else{c.unlisten(b,goog.events.EventType.MOUSEOVER,this.handleMouseOver).unlisten(b,goog.events.EventType.MOUSEDOWN,this.handleMouseDown).unlisten(b,goog.events.EventType.MOUSEUP,this.handleMouseUp).unlisten(b,goog.events.EventType.MOUSEOUT,this.handleMouseOut);if(this.handleContextMenu!=goog.nullFunction){c.unlisten(b,goog.events.EventType.CONTEXTMENU,this.handleContextMenu)}if(goog.userAgent.IE){c.unlisten(b,goog.events.EventType.DBLCLICK,this.handleDblClick);goog.dispose(this.ieMouseEventSequenceSimulator_);this.ieMouseEventSequenceSimulator_=null}}};goog.ui.Control.prototype.exitDocument=function(){goog.ui.Control.superClass_.exitDocument.call(this);if(this.keyHandler_){this.keyHandler_.detach()}if(this.isVisible()&&this.isEnabled()){this.renderer_.setFocusable(this,false)}};goog.ui.Control.prototype.disposeInternal=function(){goog.ui.Control.superClass_.disposeInternal.call(this);if(this.keyHandler_){this.keyHandler_.dispose();delete this.keyHandler_}delete this.renderer_;this.content_=null;this.extraClassNames_=null;this.ieMouseEventSequenceSimulator_=null};goog.ui.Control.prototype.getContent=function(){return this.content_};goog.ui.Control.prototype.setContent=function(a){this.renderer_.setContent(this.getElement(),a);this.setContentInternal(a)};goog.ui.Control.prototype.setContentInternal=function(a){this.content_=a};goog.ui.Control.prototype.getCaption=function(){var b=this.getContent();if(!b){return""}var a=goog.isString(b)?b:goog.isArray(b)?goog.array.map(b,goog.dom.getRawTextContent).join(""):goog.dom.getTextContent((b));return goog.string.collapseBreakingSpaces(a)};goog.ui.Control.prototype.setCaption=function(a){this.setContent(a)};goog.ui.Control.prototype.setRightToLeft=function(b){goog.ui.Control.superClass_.setRightToLeft.call(this,b);var a=this.getElement();if(a){this.renderer_.setRightToLeft(a,b)}};goog.ui.Control.prototype.isAllowTextSelection=function(){return this.allowTextSelection_};goog.ui.Control.prototype.setAllowTextSelection=function(b){this.allowTextSelection_=b;var a=this.getElement();if(a){this.renderer_.setAllowTextSelection(a,b)}};goog.ui.Control.prototype.isVisible=function(){return this.visible_};goog.ui.Control.prototype.setVisible=function(c,a){if(a||(this.visible_!=c&&this.dispatchEvent(c?goog.ui.Component.EventType.SHOW:goog.ui.Component.EventType.HIDE))){var b=this.getElement();if(b){this.renderer_.setVisible(b,c)}if(this.isEnabled()){this.renderer_.setFocusable(this,c)}this.visible_=c;return true}return false};goog.ui.Control.prototype.isEnabled=function(){return !this.hasState(goog.ui.Component.State.DISABLED)};goog.ui.Control.prototype.isParentDisabled_=function(){var a=this.getParent();return !!a&&typeof a.isEnabled=="function"&&!a.isEnabled()};goog.ui.Control.prototype.setEnabled=function(a){if(!this.isParentDisabled_()&&this.isTransitionAllowed(goog.ui.Component.State.DISABLED,!a)){if(!a){this.setActive(false);this.setHighlighted(false)}if(this.isVisible()){this.renderer_.setFocusable(this,a)}this.setState(goog.ui.Component.State.DISABLED,!a,true)}};goog.ui.Control.prototype.isHighlighted=function(){return this.hasState(goog.ui.Component.State.HOVER)};goog.ui.Control.prototype.setHighlighted=function(a){if(this.isTransitionAllowed(goog.ui.Component.State.HOVER,a)){this.setState(goog.ui.Component.State.HOVER,a)}};goog.ui.Control.prototype.isActive=function(){return this.hasState(goog.ui.Component.State.ACTIVE)};goog.ui.Control.prototype.setActive=function(a){if(this.isTransitionAllowed(goog.ui.Component.State.ACTIVE,a)){this.setState(goog.ui.Component.State.ACTIVE,a)}};goog.ui.Control.prototype.isSelected=function(){return this.hasState(goog.ui.Component.State.SELECTED)};goog.ui.Control.prototype.setSelected=function(a){if(this.isTransitionAllowed(goog.ui.Component.State.SELECTED,a)){this.setState(goog.ui.Component.State.SELECTED,a)}};goog.ui.Control.prototype.isChecked=function(){return this.hasState(goog.ui.Component.State.CHECKED)};goog.ui.Control.prototype.setChecked=function(a){if(this.isTransitionAllowed(goog.ui.Component.State.CHECKED,a)){this.setState(goog.ui.Component.State.CHECKED,a)}};goog.ui.Control.prototype.isFocused=function(){return this.hasState(goog.ui.Component.State.FOCUSED)};goog.ui.Control.prototype.setFocused=function(a){if(this.isTransitionAllowed(goog.ui.Component.State.FOCUSED,a)){this.setState(goog.ui.Component.State.FOCUSED,a)}};goog.ui.Control.prototype.isOpen=function(){return this.hasState(goog.ui.Component.State.OPENED)};goog.ui.Control.prototype.setOpen=function(a){if(this.isTransitionAllowed(goog.ui.Component.State.OPENED,a)){this.setState(goog.ui.Component.State.OPENED,a)}};goog.ui.Control.prototype.getState=function(){return this.state_};goog.ui.Control.prototype.hasState=function(a){return !!(this.state_&a)};goog.ui.Control.prototype.setState=function(c,a,b){if(!b&&c==goog.ui.Component.State.DISABLED){this.setEnabled(!a);return}if(this.isSupportedState(c)&&a!=this.hasState(c)){this.renderer_.setState(this,c,a);this.state_=a?this.state_|c:this.state_&~c}};goog.ui.Control.prototype.setStateInternal=function(a){this.state_=a};goog.ui.Control.prototype.isSupportedState=function(a){return !!(this.supportedStates_&a)};goog.ui.Control.prototype.setSupportedState=function(b,a){if(this.isInDocument()&&this.hasState(b)&&!a){throw Error(goog.ui.Component.Error.ALREADY_RENDERED)}if(!a&&this.hasState(b)){this.setState(b,false)}this.supportedStates_=a?this.supportedStates_|b:this.supportedStates_&~b};goog.ui.Control.prototype.isAutoState=function(a){return !!(this.autoStates_&a)&&this.isSupportedState(a)};goog.ui.Control.prototype.setAutoStates=function(a,b){this.autoStates_=b?this.autoStates_|a:this.autoStates_&~a};goog.ui.Control.prototype.isDispatchTransitionEvents=function(a){return !!(this.statesWithTransitionEvents_&a)&&this.isSupportedState(a)};goog.ui.Control.prototype.setDispatchTransitionEvents=function(a,b){this.statesWithTransitionEvents_=b?this.statesWithTransitionEvents_|a:this.statesWithTransitionEvents_&~a};goog.ui.Control.prototype.isTransitionAllowed=function(b,a){return this.isSupportedState(b)&&this.hasState(b)!=a&&(!(this.statesWithTransitionEvents_&b)||this.dispatchEvent(goog.ui.Component.getStateTransitionEvent(b,a)))&&!this.isDisposed()};goog.ui.Control.prototype.handleMouseOver=function(a){if(!goog.ui.Control.isMouseEventWithinElement_(a,this.getElement())&&this.dispatchEvent(goog.ui.Component.EventType.ENTER)&&this.isEnabled()&&this.isAutoState(goog.ui.Component.State.HOVER)){this.setHighlighted(true)}};goog.ui.Control.prototype.handleMouseOut=function(a){if(!goog.ui.Control.isMouseEventWithinElement_(a,this.getElement())&&this.dispatchEvent(goog.ui.Component.EventType.LEAVE)){if(this.isAutoState(goog.ui.Component.State.ACTIVE)){this.setActive(false)}if(this.isAutoState(goog.ui.Component.State.HOVER)){this.setHighlighted(false)}}};goog.ui.Control.prototype.handleContextMenu=goog.nullFunction;goog.ui.Control.isMouseEventWithinElement_=function(b,a){return !!b.relatedTarget&&goog.dom.contains(a,b.relatedTarget)};goog.ui.Control.prototype.handleMouseDown=function(a){if(this.isEnabled()){if(this.isAutoState(goog.ui.Component.State.HOVER)){this.setHighlighted(true)}if(a.isMouseActionButton()){if(this.isAutoState(goog.ui.Component.State.ACTIVE)){this.setActive(true)}if(this.renderer_&&this.renderer_.isFocusable(this)){this.getKeyEventTarget().focus()}}}if(!this.isAllowTextSelection()&&a.isMouseActionButton()){a.preventDefault()}};goog.ui.Control.prototype.handleMouseUp=function(a){if(this.isEnabled()){if(this.isAutoState(goog.ui.Component.State.HOVER)){this.setHighlighted(true)}if(this.isActive()&&this.performActionInternal(a)&&this.isAutoState(goog.ui.Component.State.ACTIVE)){this.setActive(false)}}};goog.ui.Control.prototype.handleDblClick=function(a){if(this.isEnabled()){this.performActionInternal(a)}};goog.ui.Control.prototype.performActionInternal=function(b){if(this.isAutoState(goog.ui.Component.State.CHECKED)){this.setChecked(!this.isChecked())}if(this.isAutoState(goog.ui.Component.State.SELECTED)){this.setSelected(true)}if(this.isAutoState(goog.ui.Component.State.OPENED)){this.setOpen(!this.isOpen())}var a=new goog.events.Event(goog.ui.Component.EventType.ACTION,this);if(b){a.altKey=b.altKey;a.ctrlKey=b.ctrlKey;a.metaKey=b.metaKey;a.shiftKey=b.shiftKey;a.platformModifierKey=b.platformModifierKey}return this.dispatchEvent(a)};goog.ui.Control.prototype.handleFocus=function(a){if(this.isAutoState(goog.ui.Component.State.FOCUSED)){this.setFocused(true)}};goog.ui.Control.prototype.handleBlur=function(a){if(this.isAutoState(goog.ui.Component.State.ACTIVE)){this.setActive(false)}if(this.isAutoState(goog.ui.Component.State.FOCUSED)){this.setFocused(false)}};goog.ui.Control.prototype.handleKeyEvent=function(a){if(this.isVisible()&&this.isEnabled()&&this.handleKeyEventInternal(a)){a.preventDefault();a.stopPropagation();return true}return false};goog.ui.Control.prototype.handleKeyEventInternal=function(a){return a.keyCode==goog.events.KeyCodes.ENTER&&this.performActionInternal(a)};goog.ui.registry.setDefaultRenderer(goog.ui.Control,goog.ui.ControlRenderer);goog.ui.registry.setDecoratorByClassName(goog.ui.ControlRenderer.CSS_CLASS,function(){return new goog.ui.Control(null)});goog.ui.Control.IeMouseEventSequenceSimulator_=function(b){this.control_=b;this.clickExpected_=false;this.handler_=new goog.events.EventHandler(this);this.registerDisposable(this.handler_);var a=this.control_.getElementStrict();this.handler_.listen(a,goog.events.EventType.MOUSEDOWN,this.handleMouseDown_).listen(a,goog.events.EventType.MOUSEUP,this.handleMouseUp_).listen(a,goog.events.EventType.CLICK,this.handleClick_)};goog.inherits(goog.ui.Control.IeMouseEventSequenceSimulator_,goog.Disposable);goog.ui.Control.IeMouseEventSequenceSimulator_.prototype.handleMouseDown_=function(){this.clickExpected_=false};goog.ui.Control.IeMouseEventSequenceSimulator_.prototype.handleMouseUp_=function(){this.clickExpected_=true};goog.ui.Control.IeMouseEventSequenceSimulator_.prototype.handleClick_=function(d){if(this.clickExpected_){this.clickExpected_=false;return}var f=(d);var c=f.getBrowserEvent();var a=c.button;var b=c.type;c.button=goog.events.BrowserEvent.MouseButton.LEFT;c.type=goog.events.EventType.MOUSEDOWN;this.control_.handleMouseDown(new goog.events.BrowserEvent(c,f.currentTarget));c.type=goog.events.EventType.MOUSEUP;this.control_.handleMouseUp(new goog.events.BrowserEvent(c,f.currentTarget));c.button=a;c.type=b};goog.ui.Control.IeMouseEventSequenceSimulator_.prototype.disposeInternal=function(){this.control_=null;goog.ui.Control.IeMouseEventSequenceSimulator_.base(this,"disposeInternal")};goog.provide("goog.ui.Button");goog.provide("goog.ui.Button.Side");goog.require("goog.events.EventType");goog.require("goog.events.KeyCodes");goog.require("goog.events.KeyHandler");goog.require("goog.ui.ButtonRenderer");goog.require("goog.ui.ButtonSide");goog.require("goog.ui.Component");goog.require("goog.ui.Control");goog.require("goog.ui.NativeButtonRenderer");goog.require("goog.ui.registry");goog.ui.Button=function(c,b,a){goog.ui.Control.call(this,c,b||goog.ui.NativeButtonRenderer.getInstance(),a)};goog.inherits(goog.ui.Button,goog.ui.Control);goog.tagUnsealableClass(goog.ui.Button);goog.ui.Button.Side=goog.ui.ButtonSide;goog.ui.Button.prototype.value_;goog.ui.Button.prototype.tooltip_;goog.ui.Button.prototype.getValue=function(){return this.value_};goog.ui.Button.prototype.setValue=function(b){this.value_=b;var a=(this.getRenderer());a.setValue(this.getElement(),(b))};goog.ui.Button.prototype.setValueInternal=function(a){this.value_=a};goog.ui.Button.prototype.getTooltip=function(){return this.tooltip_};goog.ui.Button.prototype.setTooltip=function(a){this.tooltip_=a;this.getRenderer().setTooltip(this.getElement(),a)};goog.ui.Button.prototype.setTooltipInternal=function(a){this.tooltip_=a};goog.ui.Button.prototype.setCollapsed=function(a){this.getRenderer().setCollapsed(this,a)};goog.ui.Button.prototype.disposeInternal=function(){goog.ui.Button.superClass_.disposeInternal.call(this);delete this.value_;delete this.tooltip_};goog.ui.Button.prototype.enterDocument=function(){goog.ui.Button.superClass_.enterDocument.call(this);if(this.isSupportedState(goog.ui.Component.State.FOCUSED)){var a=this.getKeyEventTarget();if(a){this.getHandler().listen(a,goog.events.EventType.KEYUP,this.handleKeyEventInternal)}}};goog.ui.Button.prototype.handleKeyEventInternal=function(a){if(a.keyCode==goog.events.KeyCodes.ENTER&&a.type==goog.events.KeyHandler.EventType.KEY||a.keyCode==goog.events.KeyCodes.SPACE&&a.type==goog.events.EventType.KEYUP){return this.performActionInternal(a)}return a.keyCode==goog.events.KeyCodes.SPACE};goog.ui.registry.setDecoratorByClassName(goog.ui.ButtonRenderer.CSS_CLASS,function(){return new goog.ui.Button(null)});goog.provide("goog.ui.INLINE_BLOCK_CLASSNAME");goog.ui.INLINE_BLOCK_CLASSNAME=goog.getCssName("goog-inline-block");goog.provide("goog.ui.Css3ButtonRenderer");goog.require("goog.asserts");goog.require("goog.dom.TagName");goog.require("goog.dom.classlist");goog.require("goog.ui.Button");goog.require("goog.ui.ButtonRenderer");goog.require("goog.ui.Component");goog.require("goog.ui.INLINE_BLOCK_CLASSNAME");goog.require("goog.ui.registry");goog.ui.Css3ButtonRenderer=function(){goog.ui.ButtonRenderer.call(this)};goog.inherits(goog.ui.Css3ButtonRenderer,goog.ui.ButtonRenderer);goog.ui.Css3ButtonRenderer.instance_=null;goog.addSingletonGetter(goog.ui.Css3ButtonRenderer);goog.ui.Css3ButtonRenderer.CSS_CLASS=goog.getCssName("goog-css3-button");goog.ui.Css3ButtonRenderer.prototype.getContentElement=function(a){return(a)};goog.ui.Css3ButtonRenderer.prototype.createDom=function(c){var b=(c);var d=this.getClassNames(b);var a={"class":goog.ui.INLINE_BLOCK_CLASSNAME+" "+d.join(" "),title:b.getTooltip()||""};return b.getDomHelper().createDom("div",a,b.getContent())};goog.ui.Css3ButtonRenderer.prototype.canDecorate=function(a){return a.tagName==goog.dom.TagName.DIV};goog.ui.Css3ButtonRenderer.prototype.decorate=function(b,a){goog.asserts.assert(a);goog.dom.classlist.addAll(a,[goog.ui.INLINE_BLOCK_CLASSNAME,this.getCssClass()]);return goog.ui.Css3ButtonRenderer.superClass_.decorate.call(this,b,a)};goog.ui.Css3ButtonRenderer.prototype.getCssClass=function(){return goog.ui.Css3ButtonRenderer.CSS_CLASS};goog.ui.registry.setDecoratorByClassName(goog.ui.Css3ButtonRenderer.CSS_CLASS,function(){return new goog.ui.Button(null,goog.ui.Css3ButtonRenderer.getInstance())});goog.ui.registry.setDecoratorByClassName(goog.getCssName("goog-css3-toggle-button"),function(){var a=new goog.ui.Button(null,goog.ui.Css3ButtonRenderer.getInstance());a.setSupportedState(goog.ui.Component.State.CHECKED,true);return a});goog.provide("goog.ui.RangeModel");goog.require("goog.events.EventTarget");goog.require("goog.ui.Component");goog.ui.RangeModel=function(){goog.events.EventTarget.call(this)};goog.inherits(goog.ui.RangeModel,goog.events.EventTarget);goog.tagUnsealableClass(goog.ui.RangeModel);goog.ui.RangeModel.prototype.value_=0;goog.ui.RangeModel.prototype.minimum_=0;goog.ui.RangeModel.prototype.maximum_=100;goog.ui.RangeModel.prototype.extent_=0;goog.ui.RangeModel.prototype.step_=1;goog.ui.RangeModel.prototype.isChanging_=false;goog.ui.RangeModel.prototype.mute_=false;goog.ui.RangeModel.prototype.setMute=function(a){this.mute_=a};goog.ui.RangeModel.prototype.setValue=function(a){a=this.roundToStepWithMin(a);if(this.value_!=a){if(a+this.extent_>this.maximum_){this.value_=this.maximum_-this.extent_}else{if(a<this.minimum_){this.value_=this.minimum_}else{this.value_=a}}if(!this.isChanging_&&!this.mute_){this.dispatchEvent(goog.ui.Component.EventType.CHANGE)}}};goog.ui.RangeModel.prototype.getValue=function(){return this.roundToStepWithMin(this.value_)};goog.ui.RangeModel.prototype.setExtent=function(a){a=this.roundToStepWithMin(a);if(this.extent_!=a){if(a<0){this.extent_=0}else{if(this.value_+a>this.maximum_){this.extent_=this.maximum_-this.value_}else{this.extent_=a}}if(!this.isChanging_&&!this.mute_){this.dispatchEvent(goog.ui.Component.EventType.CHANGE)}}};goog.ui.RangeModel.prototype.getExtent=function(){return this.roundToStep(this.extent_)};goog.ui.RangeModel.prototype.setMinimum=function(a){if(this.minimum_!=a){var b=this.isChanging_;this.isChanging_=true;this.minimum_=a;if(a+this.extent_>this.maximum_){this.extent_=this.maximum_-this.minimum_}if(a>this.value_){this.setValue(a)}if(a>this.maximum_){this.extent_=0;this.setMaximum(a);this.setValue(a)}this.isChanging_=b;if(!this.isChanging_&&!this.mute_){this.dispatchEvent(goog.ui.Component.EventType.CHANGE)}}};goog.ui.RangeModel.prototype.getMinimum=function(){return this.roundToStepWithMin(this.minimum_)};goog.ui.RangeModel.prototype.setMaximum=function(b){b=this.roundToStepWithMin(b);if(this.maximum_!=b){var a=this.isChanging_;this.isChanging_=true;this.maximum_=b;if(b<this.value_+this.extent_){this.setValue(b-this.extent_)}if(b<this.minimum_){this.extent_=0;this.setMinimum(b);this.setValue(this.maximum_)}if(b<this.minimum_+this.extent_){this.extent_=this.maximum_-this.minimum_}this.isChanging_=a;if(!this.isChanging_&&!this.mute_){this.dispatchEvent(goog.ui.Component.EventType.CHANGE)}}};goog.ui.RangeModel.prototype.getMaximum=function(){return this.roundToStepWithMin(this.maximum_)};goog.ui.RangeModel.prototype.getStep=function(){return this.step_};goog.ui.RangeModel.prototype.setStep=function(a){if(this.step_!=a){this.step_=a;var b=this.isChanging_;this.isChanging_=true;this.setMaximum(this.getMaximum());this.setExtent(this.getExtent());this.setValue(this.getValue());this.isChanging_=b;if(!this.isChanging_&&!this.mute_){this.dispatchEvent(goog.ui.Component.EventType.CHANGE)}}};goog.ui.RangeModel.prototype.roundToStepWithMin=function(a){if(this.step_==null){return a}return this.minimum_+Math.round((a-this.minimum_)/this.step_)*this.step_};goog.ui.RangeModel.prototype.roundToStep=function(a){if(this.step_==null){return a}return Math.round(a/this.step_)*this.step_};goog.provide("goog.ui.ProgressBar");goog.provide("goog.ui.ProgressBar.Orientation");goog.require("goog.a11y.aria");goog.require("goog.asserts");goog.require("goog.dom");goog.require("goog.dom.classlist");goog.require("goog.events");goog.require("goog.events.EventType");goog.require("goog.ui.Component");goog.require("goog.ui.RangeModel");goog.require("goog.userAgent");goog.ui.ProgressBar=function(a){goog.ui.Component.call(this,a);this.thumbElement_;this.rangeModel_=new goog.ui.RangeModel;goog.events.listen(this.rangeModel_,goog.ui.Component.EventType.CHANGE,this.handleChange_,false,this)};goog.inherits(goog.ui.ProgressBar,goog.ui.Component);goog.tagUnsealableClass(goog.ui.ProgressBar);goog.ui.ProgressBar.Orientation={VERTICAL:"vertical",HORIZONTAL:"horizontal"};goog.ui.ProgressBar.ORIENTATION_TO_CSS_NAME_={};goog.ui.ProgressBar.ORIENTATION_TO_CSS_NAME_[goog.ui.ProgressBar.Orientation.VERTICAL]=goog.getCssName("progress-bar-vertical");goog.ui.ProgressBar.ORIENTATION_TO_CSS_NAME_[goog.ui.ProgressBar.Orientation.HORIZONTAL]=goog.getCssName("progress-bar-horizontal");goog.ui.ProgressBar.prototype.createDom=function(){this.thumbElement_=this.createThumb_();var a=goog.ui.ProgressBar.ORIENTATION_TO_CSS_NAME_[this.orientation_];this.setElementInternal(this.getDomHelper().createDom("div",a,this.thumbElement_));this.setValueState_();this.setMinimumState_();this.setMaximumState_()};goog.ui.ProgressBar.prototype.enterDocument=function(){goog.ui.ProgressBar.superClass_.enterDocument.call(this);this.attachEvents_();this.updateUi_();var a=this.getElement();goog.asserts.assert(a,"The progress bar DOM element cannot be null.");goog.a11y.aria.setRole(a,"progressbar");goog.a11y.aria.setState(a,"live","polite")};goog.ui.ProgressBar.prototype.exitDocument=function(){goog.ui.ProgressBar.superClass_.exitDocument.call(this);this.detachEvents_()};goog.ui.ProgressBar.prototype.createThumb_=function(){return(this.getDomHelper().createDom("div",goog.getCssName("progress-bar-thumb")))};goog.ui.ProgressBar.prototype.attachEvents_=function(){if(goog.userAgent.IE&&goog.userAgent.VERSION<7){goog.events.listen(this.getElement(),goog.events.EventType.RESIZE,this.updateUi_,false,this)}};goog.ui.ProgressBar.prototype.detachEvents_=function(){if(goog.userAgent.IE&&goog.userAgent.VERSION<7){goog.events.unlisten(this.getElement(),goog.events.EventType.RESIZE,this.updateUi_,false,this)}};goog.ui.ProgressBar.prototype.decorateInternal=function(b){goog.ui.ProgressBar.superClass_.decorateInternal.call(this,b);goog.dom.classlist.add(goog.asserts.assert(this.getElement()),goog.ui.ProgressBar.ORIENTATION_TO_CSS_NAME_[this.orientation_]);var a=goog.dom.getElementsByTagNameAndClass(null,goog.getCssName("progress-bar-thumb"),this.getElement())[0];if(!a){a=this.createThumb_();this.getElement().appendChild(a)}this.thumbElement_=a};goog.ui.ProgressBar.prototype.getValue=function(){return this.rangeModel_.getValue()};goog.ui.ProgressBar.prototype.setValue=function(a){this.rangeModel_.setValue(a);if(this.getElement()){this.setValueState_()}};goog.ui.ProgressBar.prototype.setValueState_=function(){var a=this.getElement();goog.asserts.assert(a,"The progress bar DOM element cannot be null.");goog.a11y.aria.setState(a,"valuenow",this.getValue())};goog.ui.ProgressBar.prototype.getMinimum=function(){return this.rangeModel_.getMinimum()};goog.ui.ProgressBar.prototype.setMinimum=function(a){this.rangeModel_.setMinimum(a);if(this.getElement()){this.setMinimumState_()}};goog.ui.ProgressBar.prototype.setMinimumState_=function(){var a=this.getElement();goog.asserts.assert(a,"The progress bar DOM element cannot be null.");goog.a11y.aria.setState(a,"valuemin",this.getMinimum())};goog.ui.ProgressBar.prototype.getMaximum=function(){return this.rangeModel_.getMaximum()};goog.ui.ProgressBar.prototype.setMaximum=function(a){this.rangeModel_.setMaximum(a);if(this.getElement()){this.setMaximumState_()}};goog.ui.ProgressBar.prototype.setMaximumState_=function(){var a=this.getElement();goog.asserts.assert(a,"The progress bar DOM element cannot be null.");goog.a11y.aria.setState(a,"valuemax",this.getMaximum())};goog.ui.ProgressBar.prototype.orientation_=goog.ui.ProgressBar.Orientation.HORIZONTAL;goog.ui.ProgressBar.prototype.handleChange_=function(a){this.updateUi_();this.dispatchEvent(goog.ui.Component.EventType.CHANGE)};goog.ui.ProgressBar.prototype.updateUi_=function(){if(this.thumbElement_){var d=this.getMinimum();var a=this.getMaximum();var g=this.getValue();var f=(g-d)/(a-d);var c=Math.round(f*100);if(this.orientation_==goog.ui.ProgressBar.Orientation.VERTICAL){if(goog.userAgent.IE&&goog.userAgent.VERSION<7){this.thumbElement_.style.top=0;this.thumbElement_.style.height="100%";var e=this.thumbElement_.offsetHeight;var b=Math.round(f*e);this.thumbElement_.style.top=e-b+"px";this.thumbElement_.style.height=b+"px"}else{this.thumbElement_.style.top=(100-c)+"%";this.thumbElement_.style.height=c+"%"}}else{this.thumbElement_.style.width=c+"%"}}};goog.ui.ProgressBar.prototype.initializeUi_=function(){var a=this.thumbElement_.style;if(this.orientation_==goog.ui.ProgressBar.Orientation.VERTICAL){a.left=0;a.width="100%"}else{a.top=a.left=0;a.height="100%"}};goog.ui.ProgressBar.prototype.setOrientation=function(a){if(this.orientation_!=a){var c=goog.ui.ProgressBar.ORIENTATION_TO_CSS_NAME_[this.orientation_];var d=goog.ui.ProgressBar.ORIENTATION_TO_CSS_NAME_[a];this.orientation_=a;var b=this.getElement();if(b){goog.dom.classlist.swap(b,c,d);this.initializeUi_();this.updateUi_()}}};goog.ui.ProgressBar.prototype.getOrientation=function(){return this.orientation_};goog.ui.ProgressBar.prototype.disposeInternal=function(){this.detachEvents_();goog.ui.ProgressBar.superClass_.disposeInternal.call(this);this.thumbElement_=null;this.rangeModel_.dispose()};goog.ui.ProgressBar.prototype.getStep=function(){return this.rangeModel_.getStep()};goog.ui.ProgressBar.prototype.setStep=function(a){this.rangeModel_.setStep(a)};goog.provide("au.upldr.ui.StatusPane");goog.require("goog.format");goog.require("goog.functions");goog.require("goog.style");goog.require("goog.ui.Button");goog.require("goog.ui.Css3ButtonRenderer");goog.require("goog.ui.Component");goog.require("goog.ui.ProgressBar");goog.require("au.upldr.utils");goog.require("au.upldr.UploaderState");goog.require("au.upldr.events.CollectionEvent");goog.require("au.upldr.ui.Label");goog.require("au.upldr.ui.ClassNames");goog.require("au.upldr.ui.ClassNamesCompat");au.upldr.ui.StatusPane=function(b,a){goog.base(this,a);this.progress_;this.fileProgressLabel_;this.uploadButton_;this.setModel(b)};goog.inherits(au.upldr.ui.StatusPane,goog.ui.Component);au.upldr.ui.StatusPane.prototype.setVisible=function(a){goog.style.setElementShown(this.getElement(),a)};au.upldr.ui.StatusPane.CSS_CLASS=au.upldr.ui.ClassNames.STATUS_PANE;au.upldr.ui.StatusPane.prototype.getCssClass=function(){return au.upldr.ui.StatusPane.CSS_CLASS};au.upldr.ui.StatusPane.prototype.createDom=function(){var d=this.getDomHelper();var b="div";var e=this.getModel();var f=e.getPropertyHolder();var c=d.createDom("div",[this.getCssClass(),au.upldr.ui.ClassNamesCompat.STATUS_BAR].join(" "));this.setElementInternal(c);var a=this.progress_=new goog.ui.ProgressBar();a.setMaximum(100);a.setMinimum(0);this.addChild(a,true);goog.dom.classlist.addAll(a.getElement(),au.upldr.ui.ClassNamesCompat.UPLOAD_PROGRESS_BAR.replace(/\s+/," ").split(" "));var h,g;var i=d.createDom(b,null,h=d.createDom(b,{"class":"leftCeil"}),g=d.createDom(b,{"class":"rightCeil"}));this.fileProgressLabel_=new au.upldr.ui.Label();this.addChild(this.fileProgressLabel_,false);this.fileProgressLabel_.render(h);goog.dom.classlist.addAll(this.fileProgressLabel_.getElement(),au.upldr.ui.ClassNamesCompat.STATUS_BAR_TEXT0.replace(/\s+/," ").split(" "));this.statusBarBr=d.createElement("br");this.statusBarBr.id="statusBarBr";this.statusBarBr.style.display="block";goog.dom.appendChild(h,this.statusBarBr);this.dataProgressLabel_=new au.upldr.ui.Label();this.addChild(this.dataProgressLabel_,false);this.dataProgressLabel_.render(h);goog.dom.classlist.addAll(this.dataProgressLabel_.getElement(),au.upldr.ui.ClassNamesCompat.STATUS_BAR_TEXT1.replace(/\s+/," ").split(" "));this.uploadButtonTextSpan_=goog.dom.createElement("span");goog.dom.classlist.addAll(this.uploadButtonTextSpan_,au.upldr.ui.ClassNamesCompat.SEND_BUTTON_TEXT_CLASS.replace(/\s+/," ").split(" "));this.uploadButton_=new goog.ui.Button(this.uploadButtonTextSpan_,goog.ui.Css3ButtonRenderer.getInstance());this.addChild(this.uploadButton_,false);this.uploadButton_.render(g);goog.dom.classlist.addAll(this.uploadButton_.getElement(),au.upldr.ui.ClassNamesCompat.SEND_BUTTON.replace(/\s+/," ").split(" "));this.uploadButton_.setVisible((f.getProperty(au.upldr.Properties.SEND_BUTTON_TEXT)!=""));this.removeAllFilesButton_=new goog.ui.Button("",goog.ui.Css3ButtonRenderer.getInstance());this.addChild(this.removeAllFilesButton_,false);this.removeAllFilesButton_.render(h);goog.dom.classlist.addAll(this.removeAllFilesButton_.getElement(),au.upldr.ui.ClassNamesCompat.REMOVE_ALL_BUTTON_CLASS.replace(/\s+/," ").split(" "));this.updateControls_();this.setVisible((f.getProperty(au.upldr.Properties.STATUS_PANE_VISIBILITY)));f.observe(au.upldr.Properties.STATUS_PANE_VISIBILITY,function(){this.setVisible(f.getProperty(au.upldr.Properties.STATUS_PANE_VISIBILITY))},this);goog.dom.appendChild(c,i)};au.upldr.ui.StatusPane.prototype.enterDocument=function(){goog.base(this,"enterDocument");var a=this.getModel();var c=a.getPropertyHolder();c.observe(au.upldr.InternalProperties.UPLOADER_STATE,this.updateControls_,this);c.observe(au.upldr.Properties.SEND_BUTTON_TEXT,this.updateControls_,this);c.observe(au.upldr.Properties.CANCEL_UPLOAD_BUTTON_TEXT,this.updateControls_,this);c.observe(au.upldr.Properties.STATUS_PANE_FILES_TO_UPLOAD_TEXT,this.updateFileCountControls_,this);c.observe(au.upldr.Properties.STATUS_PANE_NO_FILES_TO_UPLOAD_TEXT,this.updateFileCountControls_,this);c.observe(au.upldr.Properties.SEND_BUTTON_TEXT,function(){this.uploadButton_.setVisible(c.getProperty(au.upldr.Properties.SEND_BUTTON_TEXT)!="")},this);c.observe(au.upldr.InternalProperties.UPLOAD_PROGRESS,this.updateProgressControls_,this);var b=this.getHandler();b.listen(this.uploadButton_,goog.ui.Component.EventType.ACTION,this.onUploadButtonClick_);b.listen(a.getItems(),au.upldr.events.CollectionEvent.COLLECTION_CHANGED,this.updateFileCountControls_);b.listen(this.removeAllFilesButton_,goog.ui.Component.EventType.ACTION,this.onRemoveAllButtonClick_)};au.upldr.ui.StatusPane.prototype.updateControls_=function(){var a=this.getModel();var d=a.getPropertyHolder();var c;var b=d.getProperty(au.upldr.InternalProperties.UPLOADER_STATE);switch(b){case au.upldr.UploaderState.IDLE:goog.style.setElementShown(this.progress_.getElement(),false);goog.style.setElementShown(this.dataProgressLabel_.getElement(),false);c=(d.getProperty(au.upldr.Properties.SEND_BUTTON_TEXT));goog.dom.setTextContent(this.uploadButtonTextSpan_,c);goog.dom.classlist.removeAll(this.uploadButton_.getElement(),(au.upldr.ui.ClassNamesCompat.CANCEL_BUTTON+" "+au.upldr.ui.ClassNamesCompat.SEND_BUTTON).replace(/\s+/," ").split(" "));goog.dom.classlist.addAll(this.uploadButton_.getElement(),au.upldr.ui.ClassNamesCompat.SEND_BUTTON.replace(/\s+/," ").split(" "));goog.dom.classlist.removeAll(this.uploadButtonTextSpan_,au.upldr.ui.ClassNamesCompat.SEND_BUTTON_TEXT_CLASS.replace(/\s+/," ").split(" "));goog.dom.classlist.addAll(this.uploadButtonTextSpan_,au.upldr.ui.ClassNamesCompat.CANCEL_BUTTON_TEXT_CLASS.replace(/\s+/," ").split(" "));goog.style.setElementShown(this.statusBarBr,false);this.statusBarBr.style.display="none";goog.style.setElementShown(this.removeAllFilesButton_.getElement(),false);this.updateFileCountControls_();break;case au.upldr.UploaderState.READY:goog.style.setElementShown(this.progress_.getElement(),false);goog.style.setElementShown(this.dataProgressLabel_.getElement(),false);c=(d.getProperty(au.upldr.Properties.SEND_BUTTON_TEXT));goog.dom.setTextContent(this.uploadButtonTextSpan_,c);goog.dom.classlist.removeAll(this.uploadButton_.getElement(),(au.upldr.ui.ClassNamesCompat.CANCEL_BUTTON+" "+au.upldr.ui.ClassNamesCompat.SEND_BUTTON).replace(/\s+/," ").split(" "));goog.dom.classlist.addAll(this.uploadButton_.getElement(),au.upldr.ui.ClassNamesCompat.SEND_BUTTON.replace(/\s+/," ").split(" "));goog.dom.classlist.removeAll(this.uploadButtonTextSpan_,au.upldr.ui.ClassNamesCompat.SEND_BUTTON_TEXT_CLASS.replace(/\s+/," ").split(" "));goog.dom.classlist.addAll(this.uploadButtonTextSpan_,au.upldr.ui.ClassNamesCompat.CANCEL_BUTTON_TEXT_CLASS.replace(/\s+/," ").split(" "));this.statusBarBr.style.display="none";goog.style.setElementShown(this.removeAllFilesButton_.getElement(),true);this.updateFileCountControls_();break;case au.upldr.UploaderState.UPLOADING:goog.style.setElementShown(this.progress_.getElement(),true);goog.style.setElementShown(this.dataProgressLabel_.getElement(),true);c=(d.getProperty(au.upldr.Properties.CANCEL_UPLOAD_BUTTON_TEXT));goog.dom.setTextContent(this.uploadButtonTextSpan_,c);this.uploadButton_.setEnabled(true);goog.dom.classlist.removeAll(this.uploadButton_.getElement(),(au.upldr.ui.ClassNamesCompat.CANCEL_BUTTON+" "+au.upldr.ui.ClassNamesCompat.SEND_BUTTON).replace(/\s+/," ").split(" "));goog.dom.classlist.addAll(this.uploadButton_.getElement(),au.upldr.ui.ClassNamesCompat.CANCEL_BUTTON.replace(/\s+/," ").split(" "));goog.dom.classlist.removeAll(this.uploadButtonTextSpan_,au.upldr.ui.ClassNamesCompat.CANCEL_BUTTON_TEXT_CLASS.replace(/\s+/," ").split(" "));goog.dom.classlist.addAll(this.uploadButtonTextSpan_,au.upldr.ui.ClassNamesCompat.SEND_BUTTON_TEXT_CLASS.replace(/\s+/," ").split(" "));this.statusBarBr.style.display="block";goog.style.setElementShown(this.removeAllFilesButton_.getElement(),false);break}};au.upldr.ui.StatusPane.prototype.updateProgressControls_=function(){var c=this.getModel(),f=c.getPropertyHolder();if(f.getProperty(au.upldr.InternalProperties.UPLOADER_STATE)!=au.upldr.UploaderState.UPLOADING){return}var b=(f.getProperty(au.upldr.InternalProperties.UPLOAD_PROGRESS));this.progress_.setValue(b.percents);var e=(f.getProperty(au.upldr.Properties.STATUS_PANE_FILES_UPLOADED_TEXT));e=au.upldr.utils.format(e,b.loadedFiles,b.totalFiles);this.fileProgressLabel_.setLabelText(e);e=(f.getProperty(au.upldr.Properties.STATUS_PANE_DATA_UPLOADED_TEXT));var a=goog.format.numBytesToString(b.loadedBytes);var d=goog.format.numBytesToString(b.totalBytes);e=au.upldr.utils.format(e,a,d);this.dataProgressLabel_.setLabelText(e)};au.upldr.ui.StatusPane.prototype.updateFileCountControls_=function(){var a=this.getModel(),d=a.getPropertyHolder();var b=(d.getProperty(au.upldr.InternalProperties.UPLOADER_STATE));var c;switch(b){case au.upldr.UploaderState.IDLE:c=(d.getProperty(au.upldr.Properties.STATUS_PANE_NO_FILES_TO_UPLOAD_TEXT));break;case au.upldr.UploaderState.READY:c=(d.getProperty(au.upldr.Properties.STATUS_PANE_FILES_TO_UPLOAD_TEXT));c=au.upldr.utils.format(c,a.getItems().getCount());break;default:return}this.fileProgressLabel_.setLabelText(c,true);this.uploadButton_.setEnabled(true)};au.upldr.ui.StatusPane.prototype.onUploadButtonClick_=function(c){var a=this.getModel(),d=a.getPropertyHolder(),b=d.getProperty(au.upldr.InternalProperties.UPLOADER_STATE);switch(b){case au.upldr.UploaderState.READY:case au.upldr.UploaderState.IDLE:a.upload();break;case au.upldr.UploaderState.UPLOADING:a.cancelUploadByButton();break}};au.upldr.ui.StatusPane.prototype.onRemoveAllButtonClick_=function(b){var a=this.getModel();a.removeAllFiles()};au.upldr.ui.StatusPane.prototype.getUploadButton=function(){return this.uploadButton_};au.upldr.ui.StatusPane.prototype.getModel;au.upldr.ui.StatusPane.prototype.canDecorate=goog.functions.FALSE;goog.provide("goog.fx.Transition");goog.provide("goog.fx.Transition.EventType");goog.fx.Transition=function(){};goog.fx.Transition.EventType={PLAY:"play",BEGIN:"begin",RESUME:"resume",END:"end",STOP:"stop",FINISH:"finish",PAUSE:"pause"};goog.fx.Transition.prototype.play;goog.fx.Transition.prototype.stop;goog.provide("goog.ui.PopupBase");goog.provide("goog.ui.PopupBase.EventType");goog.provide("goog.ui.PopupBase.Type");goog.require("goog.Timer");goog.require("goog.array");goog.require("goog.dom");goog.require("goog.events");goog.require("goog.events.EventHandler");goog.require("goog.events.EventTarget");goog.require("goog.events.EventType");goog.require("goog.events.KeyCodes");goog.require("goog.fx.Transition");goog.require("goog.style");goog.require("goog.userAgent");goog.ui.PopupBase=function(a,b){goog.events.EventTarget.call(this);this.handler_=new goog.events.EventHandler(this);this.setElement(a||null);if(b){this.setType(b)}};goog.inherits(goog.ui.PopupBase,goog.events.EventTarget);goog.tagUnsealableClass(goog.ui.PopupBase);goog.ui.PopupBase.Type={TOGGLE_DISPLAY:"toggle_display",MOVE_OFFSCREEN:"move_offscreen"};goog.ui.PopupBase.prototype.element_=null;goog.ui.PopupBase.prototype.autoHide_=true;goog.ui.PopupBase.prototype.autoHidePartners_=null;goog.ui.PopupBase.prototype.autoHideRegion_=null;goog.ui.PopupBase.prototype.isVisible_=false;goog.ui.PopupBase.prototype.shouldHideAsync_=false;goog.ui.PopupBase.prototype.lastShowTime_=-1;goog.ui.PopupBase.prototype.lastHideTime_=-1;goog.ui.PopupBase.prototype.hideOnEscape_=false;goog.ui.PopupBase.prototype.enableCrossIframeDismissal_=true;goog.ui.PopupBase.prototype.type_=goog.ui.PopupBase.Type.TOGGLE_DISPLAY;goog.ui.PopupBase.prototype.showTransition_;goog.ui.PopupBase.prototype.hideTransition_;goog.ui.PopupBase.EventType={BEFORE_SHOW:"beforeshow",SHOW:"show",BEFORE_HIDE:"beforehide",HIDE:"hide"};goog.ui.PopupBase.DEBOUNCE_DELAY_MS=150;goog.ui.PopupBase.prototype.getType=function(){return this.type_};goog.ui.PopupBase.prototype.setType=function(a){this.type_=a};goog.ui.PopupBase.prototype.shouldHideAsync=function(){return this.shouldHideAsync_};goog.ui.PopupBase.prototype.setShouldHideAsync=function(a){this.shouldHideAsync_=a};goog.ui.PopupBase.prototype.getElement=function(){return this.element_};goog.ui.PopupBase.prototype.setElement=function(a){this.ensureNotVisible_();this.element_=a};goog.ui.PopupBase.prototype.getAutoHide=function(){return this.autoHide_};goog.ui.PopupBase.prototype.setAutoHide=function(a){this.ensureNotVisible_();this.autoHide_=a};goog.ui.PopupBase.prototype.addAutoHidePartner=function(a){if(!this.autoHidePartners_){this.autoHidePartners_=[]}goog.array.insert(this.autoHidePartners_,a)};goog.ui.PopupBase.prototype.removeAutoHidePartner=function(a){if(this.autoHidePartners_){goog.array.remove(this.autoHidePartners_,a)}};goog.ui.PopupBase.prototype.getHideOnEscape=function(){return this.hideOnEscape_};goog.ui.PopupBase.prototype.setHideOnEscape=function(a){this.ensureNotVisible_();this.hideOnEscape_=a};goog.ui.PopupBase.prototype.getEnableCrossIframeDismissal=function(){return this.enableCrossIframeDismissal_};goog.ui.PopupBase.prototype.setEnableCrossIframeDismissal=function(a){this.enableCrossIframeDismissal_=a};goog.ui.PopupBase.prototype.getAutoHideRegion=function(){return this.autoHideRegion_};goog.ui.PopupBase.prototype.setAutoHideRegion=function(a){this.autoHideRegion_=a};goog.ui.PopupBase.prototype.setTransition=function(a,b){this.showTransition_=a;this.hideTransition_=b};goog.ui.PopupBase.prototype.getLastShowTime=function(){return this.lastShowTime_};goog.ui.PopupBase.prototype.getLastHideTime=function(){return this.lastHideTime_};goog.ui.PopupBase.prototype.getHandler=function(){var a=(this);return a.handler_};goog.ui.PopupBase.prototype.ensureNotVisible_=function(){if(this.isVisible_){throw Error("Can not change this state of the popup while showing.")}};goog.ui.PopupBase.prototype.isVisible=function(){return this.isVisible_};goog.ui.PopupBase.prototype.isOrWasRecentlyVisible=function(){return this.isVisible_||(goog.now()-this.lastHideTime_<goog.ui.PopupBase.DEBOUNCE_DELAY_MS)};goog.ui.PopupBase.prototype.setVisible=function(a){if(this.showTransition_){this.showTransition_.stop()}if(this.hideTransition_){this.hideTransition_.stop()}if(a){this.show_()}else{this.hide_()}};goog.ui.PopupBase.prototype.reposition=goog.nullFunction;goog.ui.PopupBase.prototype.show_=function(){if(this.isVisible_){return}if(!this.onBeforeShow()){return}if(!this.element_){throw Error("Caller must call setElement before trying to show the popup")}this.reposition();var d=goog.dom.getOwnerDocument(this.element_);if(this.hideOnEscape_){this.handler_.listen(d,goog.events.EventType.KEYDOWN,this.onDocumentKeyDown_,true)}if(this.autoHide_){this.handler_.listen(d,goog.events.EventType.MOUSEDOWN,this.onDocumentMouseDown_,true);if(goog.userAgent.IE){var b;try{b=d.activeElement}catch(c){}while(b&&b.nodeName=="IFRAME"){try{var a=goog.dom.getFrameContentDocument(b)}catch(c){break}d=a;b=d.activeElement}this.handler_.listen(d,goog.events.EventType.MOUSEDOWN,this.onDocumentMouseDown_,true);this.handler_.listen(d,goog.events.EventType.DEACTIVATE,this.onDocumentBlur_)}else{this.handler_.listen(d,goog.events.EventType.BLUR,this.onDocumentBlur_)}}if(this.type_==goog.ui.PopupBase.Type.TOGGLE_DISPLAY){this.showPopupElement()}else{if(this.type_==goog.ui.PopupBase.Type.MOVE_OFFSCREEN){this.reposition()}}this.isVisible_=true;this.lastShowTime_=goog.now();this.lastHideTime_=-1;if(this.showTransition_){goog.events.listenOnce((this.showTransition_),goog.fx.Transition.EventType.END,this.onShow_,false,this);this.showTransition_.play()}else{this.onShow_()}};goog.ui.PopupBase.prototype.hide_=function(a){if(!this.isVisible_||!this.onBeforeHide_(a)){return false}if(this.handler_){this.handler_.removeAll()}this.isVisible_=false;this.lastHideTime_=goog.now();if(this.hideTransition_){goog.events.listenOnce((this.hideTransition_),goog.fx.Transition.EventType.END,goog.partial(this.continueHidingPopup_,a),false,this);this.hideTransition_.play()}else{this.continueHidingPopup_(a)}return true};goog.ui.PopupBase.prototype.continueHidingPopup_=function(a){if(this.type_==goog.ui.PopupBase.Type.TOGGLE_DISPLAY){if(this.shouldHideAsync_){goog.Timer.callOnce(this.hidePopupElement,0,this)}else{this.hidePopupElement()}}else{if(this.type_==goog.ui.PopupBase.Type.MOVE_OFFSCREEN){this.moveOffscreen_()}}this.onHide_(a)};goog.ui.PopupBase.prototype.showPopupElement=function(){this.element_.style.visibility="visible";goog.style.setElementShown(this.element_,true)};goog.ui.PopupBase.prototype.hidePopupElement=function(){this.element_.style.visibility="hidden";goog.style.setElementShown(this.element_,false)};goog.ui.PopupBase.prototype.moveOffscreen_=function(){this.element_.style.top="-10000px"};goog.ui.PopupBase.prototype.onBeforeShow=function(){return this.dispatchEvent(goog.ui.PopupBase.EventType.BEFORE_SHOW)};goog.ui.PopupBase.prototype.onShow_=function(){this.dispatchEvent(goog.ui.PopupBase.EventType.SHOW)};goog.ui.PopupBase.prototype.onBeforeHide_=function(a){return this.dispatchEvent({type:goog.ui.PopupBase.EventType.BEFORE_HIDE,target:a})};goog.ui.PopupBase.prototype.onHide_=function(a){this.dispatchEvent({type:goog.ui.PopupBase.EventType.HIDE,target:a})};goog.ui.PopupBase.prototype.onDocumentMouseDown_=function(b){var a=(b.target);if(!goog.dom.contains(this.element_,a)&&!this.isOrWithinAutoHidePartner_(a)&&this.isWithinAutoHideRegion_(a)&&!this.shouldDebounce_()){this.hide_(a)}};goog.ui.PopupBase.prototype.onDocumentKeyDown_=function(a){if(a.keyCode==goog.events.KeyCodes.ESC){if(this.hide_(a.target)){a.preventDefault();a.stopPropagation()}}};goog.ui.PopupBase.prototype.onDocumentBlur_=function(c){if(!this.enableCrossIframeDismissal_){return}var b=goog.dom.getOwnerDocument(this.element_);if(typeof document.activeElement!="undefined"){var a=b.activeElement;if(!a||goog.dom.contains(this.element_,a)||a.tagName=="BODY"){return}}else{if(c.target!=b){return}}if(this.shouldDebounce_()){return}this.hide_()};goog.ui.PopupBase.prototype.isOrWithinAutoHidePartner_=function(a){return goog.array.some(this.autoHidePartners_||[],function(b){return a===b||goog.dom.contains(b,a)})};goog.ui.PopupBase.prototype.isWithinAutoHideRegion_=function(a){return this.autoHideRegion_?goog.dom.contains(this.autoHideRegion_,a):true};goog.ui.PopupBase.prototype.shouldDebounce_=function(){return goog.now()-this.lastShowTime_<goog.ui.PopupBase.DEBOUNCE_DELAY_MS};goog.ui.PopupBase.prototype.disposeInternal=function(){goog.ui.PopupBase.base(this,"disposeInternal");this.handler_.dispose();goog.dispose(this.showTransition_);goog.dispose(this.hideTransition_);delete this.element_;delete this.handler_;delete this.autoHidePartners_};goog.provide("goog.style.bidi");goog.require("goog.dom");goog.require("goog.style");goog.require("goog.userAgent");goog.style.bidi.getScrollLeft=function(c){var b=goog.style.isRightToLeft(c);if(b&&goog.userAgent.GECKO){return -c.scrollLeft}else{if(b&&!(goog.userAgent.IE&&goog.userAgent.isVersionOrHigher("8"))){var a=goog.style.getComputedOverflowX(c);if(a=="visible"){return c.scrollLeft}else{return c.scrollWidth-c.clientWidth-c.scrollLeft}}}return c.scrollLeft};goog.style.bidi.getOffsetStart=function(c){var e=c.offsetLeft;var b=c.offsetParent;if(!b&&goog.style.getComputedPosition(c)=="fixed"){b=goog.dom.getOwnerDocument(c).documentElement}if(!b){return e}if(goog.userAgent.GECKO){var d=goog.style.getBorderBox(b);e+=d.left}else{if(goog.userAgent.isDocumentModeOrHigher(8)&&!goog.userAgent.isDocumentModeOrHigher(9)){var d=goog.style.getBorderBox(b);e-=d.left}}if(goog.style.isRightToLeft(b)){var a=e+c.offsetWidth;return b.clientWidth-a}return e};goog.style.bidi.setScrollOffset=function(a,b){b=Math.max(b,0);if(!goog.style.isRightToLeft(a)){a.scrollLeft=b}else{if(goog.userAgent.GECKO){a.scrollLeft=-b}else{if(!(goog.userAgent.IE&&goog.userAgent.isVersionOrHigher("8"))){a.scrollLeft=a.scrollWidth-b-a.clientWidth}else{a.scrollLeft=b}}}};goog.style.bidi.setPosition=function(b,d,c,a){if(!goog.isNull(c)){b.style.top=c+"px"}if(a){b.style.right=d+"px";b.style.left=""}else{b.style.left=d+"px";b.style.right=""}};goog.provide("goog.positioning");goog.provide("goog.positioning.Corner");goog.provide("goog.positioning.CornerBit");goog.provide("goog.positioning.Overflow");goog.provide("goog.positioning.OverflowStatus");goog.require("goog.asserts");goog.require("goog.dom");goog.require("goog.dom.TagName");goog.require("goog.math.Coordinate");goog.require("goog.math.Rect");goog.require("goog.math.Size");goog.require("goog.style");goog.require("goog.style.bidi");goog.positioning.Corner={TOP_LEFT:0,TOP_RIGHT:2,BOTTOM_LEFT:1,BOTTOM_RIGHT:3,TOP_START:4,TOP_END:6,BOTTOM_START:5,BOTTOM_END:7};goog.positioning.CornerBit={BOTTOM:1,RIGHT:2,FLIP_RTL:4};goog.positioning.Overflow={IGNORE:0,ADJUST_X:1,FAIL_X:2,ADJUST_Y:4,FAIL_Y:8,RESIZE_WIDTH:16,RESIZE_HEIGHT:32,ADJUST_X_EXCEPT_OFFSCREEN:64|1,ADJUST_Y_EXCEPT_OFFSCREEN:128|4};goog.positioning.OverflowStatus={NONE:0,ADJUSTED_X:1,ADJUSTED_Y:2,WIDTH_ADJUSTED:4,HEIGHT_ADJUSTED:8,FAILED_LEFT:16,FAILED_RIGHT:32,FAILED_TOP:64,FAILED_BOTTOM:128,FAILED_OUTSIDE_VIEWPORT:256};goog.positioning.OverflowStatus.FAILED=goog.positioning.OverflowStatus.FAILED_LEFT|goog.positioning.OverflowStatus.FAILED_RIGHT|goog.positioning.OverflowStatus.FAILED_TOP|goog.positioning.OverflowStatus.FAILED_BOTTOM|goog.positioning.OverflowStatus.FAILED_OUTSIDE_VIEWPORT;goog.positioning.OverflowStatus.FAILED_HORIZONTAL=goog.positioning.OverflowStatus.FAILED_LEFT|goog.positioning.OverflowStatus.FAILED_RIGHT;goog.positioning.OverflowStatus.FAILED_VERTICAL=goog.positioning.OverflowStatus.FAILED_TOP|goog.positioning.OverflowStatus.FAILED_BOTTOM;goog.positioning.positionAtAnchor=function(k,d,j,i,b,a,n,l,c){goog.asserts.assert(j);var f=goog.positioning.getOffsetParentPageOffset(j);var e=goog.positioning.getVisiblePart_(k);goog.style.translateRectForAnotherFrame(e,goog.dom.getDomHelper(k),goog.dom.getDomHelper(j));var m=goog.positioning.getEffectiveCorner(k,d);var g=new goog.math.Coordinate(m&goog.positioning.CornerBit.RIGHT?e.left+e.width:e.left,m&goog.positioning.CornerBit.BOTTOM?e.top+e.height:e.top);g=goog.math.Coordinate.difference(g,f);if(b){g.x+=(m&goog.positioning.CornerBit.RIGHT?-1:1)*b.x;g.y+=(m&goog.positioning.CornerBit.BOTTOM?-1:1)*b.y}var h;if(n){if(c){h=c}else{h=goog.style.getVisibleRectForElement(j);if(h){h.top-=f.y;h.right-=f.x;h.bottom-=f.y;h.left-=f.x}}}return goog.positioning.positionAtCoordinate(g,j,i,a,h,n,l)};goog.positioning.getOffsetParentPageOffset=function(a){var d;var c=a.offsetParent;if(c){var b=c.tagName==goog.dom.TagName.HTML||c.tagName==goog.dom.TagName.BODY;if(!b||goog.style.getComputedPosition(c)!="static"){d=goog.style.getPageOffset(c);if(!b){d=goog.math.Coordinate.difference(d,new goog.math.Coordinate(goog.style.bidi.getScrollLeft(c),c.scrollTop))}}}return d||new goog.math.Coordinate()};goog.positioning.getVisiblePart_=function(b){var c=goog.style.getBounds(b);var a=goog.style.getVisibleRectForElement(b);if(a){c.intersection(goog.math.Rect.createFromBox(a))}return c};goog.positioning.positionAtCoordinate=function(d,f,e,a,b,j,g){d=d.clone();var h=goog.positioning.getEffectiveCorner(f,e);var i=goog.style.getSize(f);var k=g?g.clone():i.clone();var c=goog.positioning.getPositionAtCoordinate(d,k,h,a,b,j);if(c.status&goog.positioning.OverflowStatus.FAILED){return c.status}goog.style.setPosition(f,c.rect.getTopLeft());k=c.rect.getSize();if(!goog.math.Size.equals(i,k)){goog.style.setBorderBoxSize(f,k)}return c.status};goog.positioning.getPositionAtCoordinate=function(f,e,b,g,d,a){f=f.clone();e=e.clone();var c=goog.positioning.OverflowStatus.NONE;if(g||b!=goog.positioning.Corner.TOP_LEFT){if(b&goog.positioning.CornerBit.RIGHT){f.x-=e.width+(g?g.right:0)}else{if(g){f.x+=g.left}}if(b&goog.positioning.CornerBit.BOTTOM){f.y-=e.height+(g?g.bottom:0)}else{if(g){f.y+=g.top}}}if(a){c=d?goog.positioning.adjustForViewport_(f,e,d,a):goog.positioning.OverflowStatus.FAILED_OUTSIDE_VIEWPORT}var h=new goog.math.Rect(0,0,0,0);h.left=f.x;h.top=f.y;h.width=e.width;h.height=e.height;return{rect:h,status:c}};goog.positioning.adjustForViewport_=function(f,i,d,a){var c=goog.positioning.OverflowStatus.NONE;var e=goog.positioning.Overflow.ADJUST_X_EXCEPT_OFFSCREEN;var b=goog.positioning.Overflow.ADJUST_Y_EXCEPT_OFFSCREEN;if((a&e)==e&&(f.x<d.left||f.x>=d.right)){a&=~goog.positioning.Overflow.ADJUST_X}if((a&b)==b&&(f.y<d.top||f.y>=d.bottom)){a&=~goog.positioning.Overflow.ADJUST_Y}if(f.x<d.left&&a&goog.positioning.Overflow.ADJUST_X){f.x=d.left;c|=goog.positioning.OverflowStatus.ADJUSTED_X}if(a&goog.positioning.Overflow.RESIZE_WIDTH){var h=f.x;if(f.x<d.left){f.x=d.left;c|=goog.positioning.OverflowStatus.WIDTH_ADJUSTED}if(f.x+i.width>d.right){i.width=Math.min(d.right-f.x,h+i.width-d.left);i.width=Math.max(i.width,0);c|=goog.positioning.OverflowStatus.WIDTH_ADJUSTED}}if(f.x+i.width>d.right&&a&goog.positioning.Overflow.ADJUST_X){f.x=Math.max(d.right-i.width,d.left);c|=goog.positioning.OverflowStatus.ADJUSTED_X}if(a&goog.positioning.Overflow.FAIL_X){c|=(f.x<d.left?goog.positioning.OverflowStatus.FAILED_LEFT:0)|(f.x+i.width>d.right?goog.positioning.OverflowStatus.FAILED_RIGHT:0)}if(f.y<d.top&&a&goog.positioning.Overflow.ADJUST_Y){f.y=d.top;c|=goog.positioning.OverflowStatus.ADJUSTED_Y}if(a&goog.positioning.Overflow.RESIZE_HEIGHT){var g=f.y;if(f.y<d.top){f.y=d.top;c|=goog.positioning.OverflowStatus.HEIGHT_ADJUSTED}if(f.y+i.height>d.bottom){i.height=Math.min(d.bottom-f.y,g+i.height-d.top);i.height=Math.max(i.height,0);c|=goog.positioning.OverflowStatus.HEIGHT_ADJUSTED}}if(f.y+i.height>d.bottom&&a&goog.positioning.Overflow.ADJUST_Y){f.y=Math.max(d.bottom-i.height,d.top);c|=goog.positioning.OverflowStatus.ADJUSTED_Y}if(a&goog.positioning.Overflow.FAIL_Y){c|=(f.y<d.top?goog.positioning.OverflowStatus.FAILED_TOP:0)|(f.y+i.height>d.bottom?goog.positioning.OverflowStatus.FAILED_BOTTOM:0)}return c};goog.positioning.getEffectiveCorner=function(a,b){return((b&goog.positioning.CornerBit.FLIP_RTL&&goog.style.isRightToLeft(a)?b^goog.positioning.CornerBit.RIGHT:b)&~goog.positioning.CornerBit.FLIP_RTL)};goog.positioning.flipCornerHorizontal=function(a){return(a^goog.positioning.CornerBit.RIGHT)};goog.positioning.flipCornerVertical=function(a){return(a^goog.positioning.CornerBit.BOTTOM)};goog.positioning.flipCorner=function(a){return(a^goog.positioning.CornerBit.BOTTOM^goog.positioning.CornerBit.RIGHT)};goog.provide("au.upldr.ui.ProgressDialog");goog.provide("au.upldr.ui.ProgressDialog.EventType");goog.require("goog.functions");goog.require("goog.log");goog.require("goog.ui.Component");goog.require("goog.style");goog.require("goog.ui.PopupBase");goog.require("goog.positioning.Corner");goog.require("goog.ui.Button");goog.require("goog.ui.Css3ButtonRenderer");goog.require("goog.ui.Component.EventType");goog.require("goog.ui.ProgressBar");goog.require("au.upldr.Properties");goog.require("au.upldr.ui.ClassNames");goog.require("au.upldr.ui.ClassNamesCompat");au.upldr.ui.ProgressDialog=function(b,a){goog.base(this,a);this.popup_;this.cancelButton_;this.progress_;this.ajaxLoader_;this.waitMode_=false;this.setModel(b)};goog.inherits(au.upldr.ui.ProgressDialog,goog.ui.Component);au.upldr.ui.ProgressDialog.CSS_CLASS=au.upldr.ui.ClassNames.PROGRESS_DIALOG;au.upldr.ui.ProgressDialog.prototype.getCssClass=function(){return au.upldr.ui.ProgressDialog.CSS_CLASS};au.upldr.ui.ProgressDialog.prototype.createDom=function(){var f=this.getModel().getPropertyHolder();var g=au.upldr.Properties;var e=this.getDomHelper();var d=e.createDom("div",this.getCssClass());goog.dom.classlist.addAll(d,au.upldr.ui.ClassNamesCompat.WAIT_WINDOW_PANEL.replace(/\s+/," ").split(" "));this.setElementInternal(d);goog.style.setElementShown(d,false);var b=this.popup_=new goog.ui.PopupBase(d);b.setVisible(false);b.setHideOnEscape(false);b.setAutoHide(false);var i=this.label=new au.upldr.ui.Label((f.getProperty(g.ADD_FILES_PROGRESS_DIALOG_TEXT)));this.addChild(i,true);f.observe(g.ADD_FILES_PROGRESS_DIALOG_TEXT,function(){if(!this.waitMode_){i.setLabelText((f.getProperty(g.ADD_FILES_PROGRESS_DIALOG_TEXT)))}});f.observe(g.ADD_FILES_PROGRESS_DIALOG_WAIT_TEXT,function(){if(this.waitMode_){i.setLabelText((f.getProperty(g.ADD_FILES_PROGRESS_DIALOG_WAIT_TEXT)))}});var a=this.progress_=new goog.ui.ProgressBar();a.setMaximum(100);a.setMinimum(0);this.addChild(a,true);goog.dom.classlist.addAll(a.getElement(),au.upldr.ui.ClassNamesCompat.WAIT_WINDOW_PROGRESS_BAR.replace(/\s+/," ").split(" "));this.ajaxLoader_=e.createDom("div",au.upldr.ui.ClassNames.AJAX_LOADER);e.appendChild(d,this.ajaxLoader_);var h=e.createElement("div");e.appendChild(d,h);var c=this.cancelButton_=new goog.ui.Button((f.getProperty(g.COMMON_DIALOG_CANCEL_BUTTON_TEXT)),goog.ui.Css3ButtonRenderer.getInstance());this.addChild(c,false);c.render(h);f.observe(g.COMMON_DIALOG_CANCEL_BUTTON_TEXT,function(){this.cancelButton_.setCaption((f.getProperty(g.COMMON_DIALOG_CANCEL_BUTTON_TEXT)))},this)};au.upldr.ui.ProgressDialog.prototype.enterDocument=function(){goog.base(this,"enterDocument");this.getHandler().listen(this.popup_,goog.ui.PopupBase.EventType.HIDE,this.popup_hideHandler_).listen(this.popup_,goog.ui.PopupBase.EventType.SHOW,this.popup_showHandler_).listen(this.cancelButton_,goog.ui.Component.EventType.ACTION,this.dispatchCancelEvent_).listen(this.cancelButton_,goog.ui.Component.EventType.ACTION,this.hide)};au.upldr.ui.ProgressDialog.prototype.toggleInfinitLoader=function(a){this.waitMode_=a;goog.style.setElementShown(this.progress_.getElement(),!a);goog.style.setElementShown(this.ajaxLoader_,a);var b=a?au.upldr.Properties.ADD_FILES_PROGRESS_DIALOG_WAIT_TEXT:au.upldr.Properties.ADD_FILES_PROGRESS_DIALOG_TEXT;this.label.setLabelText(this.getModel().getPropertyHolder().getProperty(b))};au.upldr.ui.ProgressDialog.prototype.show=function(){this.popup_.setVisible(true)};au.upldr.ui.ProgressDialog.prototype.hide=function(){this.popup_.setVisible(false)};au.upldr.ui.ProgressDialog.prototype.setMaximum=function(a){this.progress_.setMaximum(a)};au.upldr.ui.ProgressDialog.prototype.getMaximum=function(){return this.progress_.getMaximum()};au.upldr.ui.ProgressDialog.prototype.getValue=function(){return this.progress_.getValue()};au.upldr.ui.ProgressDialog.prototype.setValue=function(a){this.progress_.setValue(a)};au.upldr.ui.ProgressDialog.prototype.popup_hideHandler_=function(a){this.dispatchEvent(au.upldr.ui.ProgressDialog.EventType.HIDE)};au.upldr.ui.ProgressDialog.prototype.popup_showHandler_=function(a){this.dispatchEvent(au.upldr.ui.ProgressDialog.EventType.SHOW)};au.upldr.ui.ProgressDialog.prototype.dispatchCancelEvent_=function(){this.dispatchEvent(au.upldr.ui.ProgressDialog.EventType.CANCEL)};au.upldr.ui.ProgressDialog.prototype.canDecorate=goog.functions.FALSE;au.upldr.ui.ProgressDialog.prototype.logger=goog.log.getLogger("au.upldr.ui.ProgressDialog");au.upldr.ui.ProgressDialog.prototype.getModel;au.upldr.ui.ProgressDialog.EventType={SHOW:goog.ui.PopupBase.EventType.SHOW,HIDE:goog.ui.PopupBase.EventType.HIDE,CANCEL:"cancel"};goog.provide("goog.positioning.AbstractPosition");goog.positioning.AbstractPosition=function(){};goog.positioning.AbstractPosition.prototype.reposition=function(a,d,b,c){};goog.provide("goog.positioning.AnchoredPosition");goog.require("goog.positioning");goog.require("goog.positioning.AbstractPosition");goog.positioning.AnchoredPosition=function(c,b,a){this.element=c;this.corner=b;this.overflow_=a};goog.inherits(goog.positioning.AnchoredPosition,goog.positioning.AbstractPosition);goog.positioning.AnchoredPosition.prototype.reposition=function(a,d,b,c){goog.positioning.positionAtAnchor(this.element,this.corner,a,d,undefined,b,this.overflow_)};goog.provide("goog.positioning.AnchoredViewportPosition");goog.require("goog.positioning");goog.require("goog.positioning.AnchoredPosition");goog.require("goog.positioning.Overflow");goog.require("goog.positioning.OverflowStatus");goog.positioning.AnchoredViewportPosition=function(d,c,b,a){goog.positioning.AnchoredPosition.call(this,d,c);this.lastResortOverflow_=b?(goog.positioning.Overflow.ADJUST_X|goog.positioning.Overflow.ADJUST_Y):goog.positioning.Overflow.IGNORE;this.overflowConstraint_=a||undefined};goog.inherits(goog.positioning.AnchoredViewportPosition,goog.positioning.AnchoredPosition);goog.positioning.AnchoredViewportPosition.prototype.getOverflowConstraint=function(){return this.overflowConstraint_};goog.positioning.AnchoredViewportPosition.prototype.setOverflowConstraint=function(a){this.overflowConstraint_=a};goog.positioning.AnchoredViewportPosition.prototype.getLastResortOverflow=function(){return this.lastResortOverflow_};goog.positioning.AnchoredViewportPosition.prototype.setLastResortOverflow=function(a){this.lastResortOverflow_=a};goog.positioning.AnchoredViewportPosition.prototype.reposition=function(b,g,e,f){var c=goog.positioning.positionAtAnchor(this.element,this.corner,b,g,null,e,goog.positioning.Overflow.FAIL_X|goog.positioning.Overflow.FAIL_Y,f,this.overflowConstraint_);if(c&goog.positioning.OverflowStatus.FAILED){var a=this.adjustCorner(c,this.corner);var d=this.adjustCorner(c,g);c=goog.positioning.positionAtAnchor(this.element,a,b,d,null,e,goog.positioning.Overflow.FAIL_X|goog.positioning.Overflow.FAIL_Y,f,this.overflowConstraint_);if(c&goog.positioning.OverflowStatus.FAILED){a=this.adjustCorner(c,a);d=this.adjustCorner(c,d);goog.positioning.positionAtAnchor(this.element,a,b,d,null,e,this.getLastResortOverflow(),f,this.overflowConstraint_)}}};goog.positioning.AnchoredViewportPosition.prototype.adjustCorner=function(a,b){if(a&goog.positioning.OverflowStatus.FAILED_HORIZONTAL){b=goog.positioning.flipCornerHorizontal(b)}if(a&goog.positioning.OverflowStatus.FAILED_VERTICAL){b=goog.positioning.flipCornerVertical(b)}return b};goog.provide("goog.positioning.MenuAnchoredPosition");goog.require("goog.positioning.AnchoredViewportPosition");goog.require("goog.positioning.Overflow");goog.positioning.MenuAnchoredPosition=function(f,e,d,a){goog.positioning.AnchoredViewportPosition.call(this,f,e,d||a);if(d||a){var c=goog.positioning.Overflow.ADJUST_X_EXCEPT_OFFSCREEN;var b=a?goog.positioning.Overflow.RESIZE_HEIGHT:goog.positioning.Overflow.ADJUST_Y_EXCEPT_OFFSCREEN;this.setLastResortOverflow(c|b)}};goog.inherits(goog.positioning.MenuAnchoredPosition,goog.positioning.AnchoredViewportPosition);goog.provide("goog.positioning.ClientPosition");goog.require("goog.asserts");goog.require("goog.dom");goog.require("goog.math.Coordinate");goog.require("goog.positioning");goog.require("goog.positioning.AbstractPosition");goog.require("goog.style");goog.positioning.ClientPosition=function(a,b){this.coordinate=a instanceof goog.math.Coordinate?a:new goog.math.Coordinate((a),b)};goog.inherits(goog.positioning.ClientPosition,goog.positioning.AbstractPosition);goog.positioning.ClientPosition.prototype.reposition=function(c,f,d,e){goog.asserts.assert(c);var b=goog.style.getViewportPageOffset(goog.dom.getOwnerDocument(c));var a=this.coordinate.x+b.x;var h=this.coordinate.y+b.y;var g=goog.positioning.getOffsetParentPageOffset(c);a-=g.x;h-=g.y;goog.positioning.positionAtCoordinate(new goog.math.Coordinate(a,h),c,f,d,null,null,e)};goog.provide("goog.positioning.ViewportClientPosition");goog.require("goog.dom");goog.require("goog.math.Coordinate");goog.require("goog.positioning");goog.require("goog.positioning.ClientPosition");goog.require("goog.positioning.Overflow");goog.require("goog.positioning.OverflowStatus");goog.require("goog.style");goog.positioning.ViewportClientPosition=function(a,b){goog.positioning.ClientPosition.call(this,a,b)};goog.inherits(goog.positioning.ViewportClientPosition,goog.positioning.ClientPosition);goog.positioning.ViewportClientPosition.prototype.lastResortOverflow_=0;goog.positioning.ViewportClientPosition.prototype.setLastResortOverflow=function(a){this.lastResortOverflow_=a};goog.positioning.ViewportClientPosition.prototype.reposition=function(c,f,a,i){var h=goog.style.getClientViewportElement(c);var g=goog.style.getVisibleRectForElement(h);var k=goog.dom.getDomHelper(c).getDocumentScrollElement();var d=new goog.math.Coordinate(this.coordinate.x+k.scrollLeft,this.coordinate.y+k.scrollTop);var e=goog.positioning.Overflow.FAIL_X|goog.positioning.Overflow.FAIL_Y;var j=f;var b=goog.positioning.positionAtCoordinate(d,c,j,a,g,e,i);if((b&goog.positioning.OverflowStatus.FAILED)==0){return}if(b&goog.positioning.OverflowStatus.FAILED_LEFT||b&goog.positioning.OverflowStatus.FAILED_RIGHT){j=goog.positioning.flipCornerHorizontal(j)}if(b&goog.positioning.OverflowStatus.FAILED_TOP||b&goog.positioning.OverflowStatus.FAILED_BOTTOM){j=goog.positioning.flipCornerVertical(j)}b=goog.positioning.positionAtCoordinate(d,c,j,a,g,e,i);if((b&goog.positioning.OverflowStatus.FAILED)==0){return}goog.positioning.positionAtCoordinate(d,c,f,a,g,this.lastResortOverflow_,i)};goog.provide("goog.ui.ContainerRenderer");goog.require("goog.a11y.aria");goog.require("goog.array");goog.require("goog.asserts");goog.require("goog.dom.NodeType");goog.require("goog.dom.classlist");goog.require("goog.string");goog.require("goog.style");goog.require("goog.ui.registry");goog.require("goog.userAgent");goog.ui.ContainerRenderer=function(a){this.ariaRole_=a};goog.addSingletonGetter(goog.ui.ContainerRenderer);goog.ui.ContainerRenderer.getCustomRenderer=function(b,a){var c=new b();c.getCssClass=function(){return a};return c};goog.ui.ContainerRenderer.CSS_CLASS=goog.getCssName("goog-container");goog.ui.ContainerRenderer.prototype.getAriaRole=function(){return this.ariaRole_};goog.ui.ContainerRenderer.prototype.enableTabIndex=function(b,a){if(b){b.tabIndex=a?0:-1}};goog.ui.ContainerRenderer.prototype.createDom=function(a){return a.getDomHelper().createDom("div",this.getClassNames(a).join(" "))};goog.ui.ContainerRenderer.prototype.getContentElement=function(a){return a};goog.ui.ContainerRenderer.prototype.canDecorate=function(a){return a.tagName=="DIV"};goog.ui.ContainerRenderer.prototype.decorate=function(b,d){if(d.id){b.setId(d.id)}var c=this.getCssClass();var a=false;var e=goog.dom.classlist.get(d);if(e){goog.array.forEach(e,function(f){if(f==c){a=true}else{if(f){this.setStateFromClassName(b,f,c)}}},this)}if(!a){goog.dom.classlist.add(d,c)}this.decorateChildren(b,this.getContentElement(d));return d};goog.ui.ContainerRenderer.prototype.setStateFromClassName=function(a,c,b){if(c==goog.getCssName(b,"disabled")){a.setEnabled(false)}else{if(c==goog.getCssName(b,"horizontal")){a.setOrientation(goog.ui.Container.Orientation.HORIZONTAL)}else{if(c==goog.getCssName(b,"vertical")){a.setOrientation(goog.ui.Container.Orientation.VERTICAL)}}}};goog.ui.ContainerRenderer.prototype.decorateChildren=function(a,b,e){if(b){var d=e||b.firstChild,c;while(d&&d.parentNode==b){c=d.nextSibling;if(d.nodeType==goog.dom.NodeType.ELEMENT){var f=this.getDecoratorForChild((d));if(f){f.setElementInternal((d));if(!a.isEnabled()){f.setEnabled(false)}a.addChild(f);f.decorate((d))}}else{if(!d.nodeValue||goog.string.trim(d.nodeValue)==""){b.removeChild(d)}}d=c}}};goog.ui.ContainerRenderer.prototype.getDecoratorForChild=function(a){return(goog.ui.registry.getDecorator(a))};goog.ui.ContainerRenderer.prototype.initializeDom=function(a){var c=a.getElement();goog.asserts.assert(c,"The container DOM element cannot be null.");goog.style.setUnselectable(c,true,goog.userAgent.GECKO);if(goog.userAgent.IE){c.hideFocus=true}var b=this.getAriaRole();if(b){goog.a11y.aria.setRole(c,b)}};goog.ui.ContainerRenderer.prototype.getKeyEventTarget=function(a){return a.getElement()};goog.ui.ContainerRenderer.prototype.getCssClass=function(){return goog.ui.ContainerRenderer.CSS_CLASS};goog.ui.ContainerRenderer.prototype.getClassNames=function(a){var b=this.getCssClass();var d=a.getOrientation()==goog.ui.Container.Orientation.HORIZONTAL;var c=[b,(d?goog.getCssName(b,"horizontal"):goog.getCssName(b,"vertical"))];if(!a.isEnabled()){c.push(goog.getCssName(b,"disabled"))}return c};goog.ui.ContainerRenderer.prototype.getDefaultOrientation=function(){return goog.ui.Container.Orientation.VERTICAL};goog.provide("goog.ui.MenuSeparatorRenderer");goog.require("goog.dom");goog.require("goog.dom.classlist");goog.require("goog.ui.ControlRenderer");goog.ui.MenuSeparatorRenderer=function(){goog.ui.ControlRenderer.call(this)};goog.inherits(goog.ui.MenuSeparatorRenderer,goog.ui.ControlRenderer);goog.addSingletonGetter(goog.ui.MenuSeparatorRenderer);goog.ui.MenuSeparatorRenderer.CSS_CLASS=goog.getCssName("goog-menuseparator");goog.ui.MenuSeparatorRenderer.prototype.createDom=function(a){return a.getDomHelper().createDom("div",this.getCssClass())};goog.ui.MenuSeparatorRenderer.prototype.decorate=function(c,a){if(a.id){c.setId(a.id)}if(a.tagName=="HR"){var b=a;a=this.createDom(c);goog.dom.insertSiblingBefore(a,b);goog.dom.removeNode(b)}else{goog.dom.classlist.add(a,this.getCssClass())}return a};goog.ui.MenuSeparatorRenderer.prototype.setContent=function(b,a){};goog.ui.MenuSeparatorRenderer.prototype.getCssClass=function(){return goog.ui.MenuSeparatorRenderer.CSS_CLASS};goog.provide("goog.ui.Separator");goog.require("goog.a11y.aria");goog.require("goog.asserts");goog.require("goog.ui.Component");goog.require("goog.ui.Control");goog.require("goog.ui.MenuSeparatorRenderer");goog.require("goog.ui.registry");goog.ui.Separator=function(b,a){goog.ui.Control.call(this,null,b||goog.ui.MenuSeparatorRenderer.getInstance(),a);this.setSupportedState(goog.ui.Component.State.DISABLED,false);this.setSupportedState(goog.ui.Component.State.HOVER,false);this.setSupportedState(goog.ui.Component.State.ACTIVE,false);this.setSupportedState(goog.ui.Component.State.FOCUSED,false);this.setStateInternal(goog.ui.Component.State.DISABLED)};goog.inherits(goog.ui.Separator,goog.ui.Control);goog.ui.Separator.prototype.enterDocument=function(){goog.ui.Separator.superClass_.enterDocument.call(this);var a=this.getElement();goog.asserts.assert(a,"The DOM element for the separator cannot be null.");goog.a11y.aria.setRole(a,"separator")};goog.ui.registry.setDecoratorByClassName(goog.ui.MenuSeparatorRenderer.CSS_CLASS,function(){return new goog.ui.Separator()});goog.provide("goog.ui.MenuRenderer");goog.require("goog.a11y.aria");goog.require("goog.a11y.aria.Role");goog.require("goog.a11y.aria.State");goog.require("goog.asserts");goog.require("goog.dom");goog.require("goog.ui.ContainerRenderer");goog.require("goog.ui.Separator");goog.ui.MenuRenderer=function(a){goog.ui.ContainerRenderer.call(this,a||goog.a11y.aria.Role.MENU)};goog.inherits(goog.ui.MenuRenderer,goog.ui.ContainerRenderer);goog.addSingletonGetter(goog.ui.MenuRenderer);goog.ui.MenuRenderer.CSS_CLASS=goog.getCssName("goog-menu");goog.ui.MenuRenderer.prototype.canDecorate=function(a){return a.tagName=="UL"||goog.ui.MenuRenderer.superClass_.canDecorate.call(this,a)};goog.ui.MenuRenderer.prototype.getDecoratorForChild=function(a){return a.tagName=="HR"?new goog.ui.Separator():goog.ui.MenuRenderer.superClass_.getDecoratorForChild.call(this,a)};goog.ui.MenuRenderer.prototype.containsElement=function(b,a){return goog.dom.contains(b.getElement(),a)};goog.ui.MenuRenderer.prototype.getCssClass=function(){return goog.ui.MenuRenderer.CSS_CLASS};goog.ui.MenuRenderer.prototype.initializeDom=function(a){goog.ui.MenuRenderer.superClass_.initializeDom.call(this,a);var b=a.getElement();goog.asserts.assert(b,"The menu DOM element cannot be null.");goog.a11y.aria.setState(b,goog.a11y.aria.State.HASPOPUP,"true")};goog.provide("goog.ui.MenuSeparator");goog.require("goog.ui.MenuSeparatorRenderer");goog.require("goog.ui.Separator");goog.require("goog.ui.registry");goog.ui.MenuSeparator=function(a){goog.ui.Separator.call(this,goog.ui.MenuSeparatorRenderer.getInstance(),a)};goog.inherits(goog.ui.MenuSeparator,goog.ui.Separator);goog.ui.registry.setDecoratorByClassName(goog.ui.MenuSeparatorRenderer.CSS_CLASS,function(){return new goog.ui.Separator()});goog.provide("goog.ui.MenuItemRenderer");goog.require("goog.a11y.aria.Role");goog.require("goog.asserts");goog.require("goog.dom");goog.require("goog.dom.classlist");goog.require("goog.ui.Component");goog.require("goog.ui.ControlRenderer");goog.ui.MenuItemRenderer=function(){goog.ui.ControlRenderer.call(this);this.classNameCache_=[]};goog.inherits(goog.ui.MenuItemRenderer,goog.ui.ControlRenderer);goog.addSingletonGetter(goog.ui.MenuItemRenderer);goog.ui.MenuItemRenderer.CSS_CLASS=goog.getCssName("goog-menuitem");goog.ui.MenuItemRenderer.CompositeCssClassIndex_={HOVER:0,CHECKBOX:1,CONTENT:2};goog.ui.MenuItemRenderer.prototype.getCompositeCssClass_=function(b){var a=this.classNameCache_[b];if(!a){switch(b){case goog.ui.MenuItemRenderer.CompositeCssClassIndex_.HOVER:a=goog.getCssName(this.getStructuralCssClass(),"highlight");break;case goog.ui.MenuItemRenderer.CompositeCssClassIndex_.CHECKBOX:a=goog.getCssName(this.getStructuralCssClass(),"checkbox");break;case goog.ui.MenuItemRenderer.CompositeCssClassIndex_.CONTENT:a=goog.getCssName(this.getStructuralCssClass(),"content");break}this.classNameCache_[b]=a}return a};goog.ui.MenuItemRenderer.prototype.getAriaRole=function(){return goog.a11y.aria.Role.MENU_ITEM};goog.ui.MenuItemRenderer.prototype.createDom=function(b){var a=b.getDomHelper().createDom("div",this.getClassNames(b).join(" "),this.createContent(b.getContent(),b.getDomHelper()));this.setEnableCheckBoxStructure(b,a,b.isSupportedState(goog.ui.Component.State.SELECTED)||b.isSupportedState(goog.ui.Component.State.CHECKED));return a};goog.ui.MenuItemRenderer.prototype.getContentElement=function(a){return(a&&a.firstChild)};goog.ui.MenuItemRenderer.prototype.decorate=function(b,a){goog.asserts.assert(a);if(!this.hasContentStructure(a)){a.appendChild(this.createContent(a.childNodes,b.getDomHelper()))}if(goog.dom.classlist.contains(a,goog.getCssName("goog-option"))){((b)).setCheckable(true);this.setCheckable(b,a,true)}return goog.ui.MenuItemRenderer.superClass_.decorate.call(this,b,a)};goog.ui.MenuItemRenderer.prototype.setContent=function(b,c){var d=this.getContentElement(b);var a=this.hasCheckBoxStructure(b)?d.firstChild:null;goog.ui.MenuItemRenderer.superClass_.setContent.call(this,b,c);if(a&&!this.hasCheckBoxStructure(b)){d.insertBefore(a,d.firstChild||null)}};goog.ui.MenuItemRenderer.prototype.hasContentStructure=function(a){var c=goog.dom.getFirstElementChild(a);var b=this.getCompositeCssClass_(goog.ui.MenuItemRenderer.CompositeCssClassIndex_.CONTENT);return !!c&&goog.dom.classlist.contains(c,b)};goog.ui.MenuItemRenderer.prototype.createContent=function(a,c){var b=this.getCompositeCssClass_(goog.ui.MenuItemRenderer.CompositeCssClassIndex_.CONTENT);return c.createDom("div",b,a)};goog.ui.MenuItemRenderer.prototype.setSelectable=function(c,b,a){if(c&&b){this.setEnableCheckBoxStructure(c,b,a)}};goog.ui.MenuItemRenderer.prototype.setCheckable=function(c,b,a){if(c&&b){this.setEnableCheckBoxStructure(c,b,a)}};goog.ui.MenuItemRenderer.prototype.hasCheckBoxStructure=function(b){var c=this.getContentElement(b);if(c){var d=c.firstChild;var a=this.getCompositeCssClass_(goog.ui.MenuItemRenderer.CompositeCssClassIndex_.CHECKBOX);return !!d&&goog.dom.isElement(d)&&goog.dom.classlist.contains((d),a)}return false};goog.ui.MenuItemRenderer.prototype.setEnableCheckBoxStructure=function(d,c,b){this.setAriaRole(c,d.getPreferredAriaRole());this.setAriaStates(d,c);if(b!=this.hasCheckBoxStructure(c)){goog.dom.classlist.enable(c,goog.getCssName("goog-option"),b);var e=this.getContentElement(c);if(b){var a=this.getCompositeCssClass_(goog.ui.MenuItemRenderer.CompositeCssClassIndex_.CHECKBOX);e.insertBefore(d.getDomHelper().createDom("div",a),e.firstChild||null)}else{e.removeChild(e.firstChild)}}};goog.ui.MenuItemRenderer.prototype.getClassForState=function(a){switch(a){case goog.ui.Component.State.HOVER:return this.getCompositeCssClass_(goog.ui.MenuItemRenderer.CompositeCssClassIndex_.HOVER);case goog.ui.Component.State.CHECKED:case goog.ui.Component.State.SELECTED:return goog.getCssName("goog-option-selected");default:return goog.ui.MenuItemRenderer.superClass_.getClassForState.call(this,a)}};goog.ui.MenuItemRenderer.prototype.getStateFromClass=function(b){var a=this.getCompositeCssClass_(goog.ui.MenuItemRenderer.CompositeCssClassIndex_.HOVER);switch(b){case goog.getCssName("goog-option-selected"):return goog.ui.Component.State.CHECKED;case a:return goog.ui.Component.State.HOVER;default:return goog.ui.MenuItemRenderer.superClass_.getStateFromClass.call(this,b)}};goog.ui.MenuItemRenderer.prototype.getCssClass=function(){return goog.ui.MenuItemRenderer.CSS_CLASS};goog.provide("goog.ui.MenuItem");goog.require("goog.a11y.aria.Role");goog.require("goog.array");goog.require("goog.dom");goog.require("goog.dom.classlist");goog.require("goog.math.Coordinate");goog.require("goog.string");goog.require("goog.ui.Component");goog.require("goog.ui.Control");goog.require("goog.ui.MenuItemRenderer");goog.require("goog.ui.registry");goog.ui.MenuItem=function(b,c,a,d){goog.ui.Control.call(this,b,d||goog.ui.MenuItemRenderer.getInstance(),a);this.setValue(c)};goog.inherits(goog.ui.MenuItem,goog.ui.Control);goog.tagUnsealableClass(goog.ui.MenuItem);goog.ui.MenuItem.prototype.mnemonicKey_;goog.ui.MenuItem.MNEMONIC_WRAPPER_CLASS_=goog.getCssName("goog-menuitem-mnemonic-separator");goog.ui.MenuItem.ACCELERATOR_CLASS=goog.getCssName("goog-menuitem-accel");goog.ui.MenuItem.prototype.getValue=function(){var a=this.getModel();return a!=null?a:this.getCaption()};goog.ui.MenuItem.prototype.setValue=function(a){this.setModel(a)};goog.ui.MenuItem.prototype.setSupportedState=function(b,a){goog.ui.MenuItem.base(this,"setSupportedState",b,a);switch(b){case goog.ui.Component.State.SELECTED:this.setSelectableInternal_(a);break;case goog.ui.Component.State.CHECKED:this.setCheckableInternal_(a);break}};goog.ui.MenuItem.prototype.setSelectable=function(a){this.setSupportedState(goog.ui.Component.State.SELECTED,a)};goog.ui.MenuItem.prototype.setSelectableInternal_=function(a){if(this.isChecked()&&!a){this.setChecked(false)}var b=this.getElement();if(b){this.getRenderer().setSelectable(this,b,a)}};goog.ui.MenuItem.prototype.setCheckable=function(a){this.setSupportedState(goog.ui.Component.State.CHECKED,a)};goog.ui.MenuItem.prototype.setCheckableInternal_=function(a){var b=this.getElement();if(b){this.getRenderer().setCheckable(this,b,a)}};goog.ui.MenuItem.prototype.getCaption=function(){var d=this.getContent();if(goog.isArray(d)){var a=goog.ui.MenuItem.ACCELERATOR_CLASS;var c=goog.ui.MenuItem.MNEMONIC_WRAPPER_CLASS_;var b=goog.array.map(d,function(e){if(goog.dom.isElement(e)&&(goog.dom.classlist.contains((e),a)||goog.dom.classlist.contains((e),c))){return""}else{return goog.dom.getRawTextContent(e)}}).join("");return goog.string.collapseBreakingSpaces(b)}return goog.ui.MenuItem.superClass_.getCaption.call(this)};goog.ui.MenuItem.prototype.getAccelerator=function(){var c=this.getDomHelper();var b=this.getContent();if(goog.isArray(b)){var a=goog.array.find(b,function(d){return goog.dom.classlist.contains((d),goog.ui.MenuItem.ACCELERATOR_CLASS)});if(a){return c.getTextContent(a)}}return null};goog.ui.MenuItem.prototype.handleMouseUp=function(d){var a=(this.getParent());if(a){var b=a.openingCoords;a.openingCoords=null;if(b&&goog.isNumber(d.clientX)){var c=new goog.math.Coordinate(d.clientX,d.clientY);if(goog.math.Coordinate.equals(b,c)){return}}}goog.ui.MenuItem.base(this,"handleMouseUp",d)};goog.ui.MenuItem.prototype.handleKeyEventInternal=function(a){if(a.keyCode==this.getMnemonic()&&this.performActionInternal(a)){return true}else{return goog.ui.MenuItem.base(this,"handleKeyEventInternal",a)}};goog.ui.MenuItem.prototype.setMnemonic=function(a){this.mnemonicKey_=a};goog.ui.MenuItem.prototype.getMnemonic=function(){return this.mnemonicKey_};goog.ui.registry.setDecoratorByClassName(goog.ui.MenuItemRenderer.CSS_CLASS,function(){return new goog.ui.MenuItem(null)});goog.ui.MenuItem.prototype.getPreferredAriaRole=function(){if(this.isSupportedState(goog.ui.Component.State.CHECKED)){return goog.a11y.aria.Role.MENU_ITEM_CHECKBOX}if(this.isSupportedState(goog.ui.Component.State.SELECTED)){return goog.a11y.aria.Role.MENU_ITEM_RADIO}return goog.ui.MenuItem.base(this,"getPreferredAriaRole")};goog.ui.MenuItem.prototype.getParent=function(){return(goog.ui.Control.prototype.getParent.call(this))};goog.ui.MenuItem.prototype.getParentEventTarget=function(){return(goog.ui.Control.prototype.getParentEventTarget.call(this))};goog.provide("goog.ui.Container");goog.provide("goog.ui.Container.EventType");goog.provide("goog.ui.Container.Orientation");goog.require("goog.a11y.aria");goog.require("goog.a11y.aria.State");goog.require("goog.asserts");goog.require("goog.dom");goog.require("goog.events.EventType");goog.require("goog.events.KeyCodes");goog.require("goog.events.KeyHandler");goog.require("goog.object");goog.require("goog.style");goog.require("goog.ui.Component");goog.require("goog.ui.ContainerRenderer");goog.require("goog.ui.Control");goog.ui.Container=function(b,c,a){goog.ui.Component.call(this,a);this.renderer_=c||goog.ui.ContainerRenderer.getInstance();this.orientation_=b||this.renderer_.getDefaultOrientation()};goog.inherits(goog.ui.Container,goog.ui.Component);goog.tagUnsealableClass(goog.ui.Container);goog.ui.Container.EventType={AFTER_SHOW:"aftershow",AFTER_HIDE:"afterhide"};goog.ui.Container.Orientation={HORIZONTAL:"horizontal",VERTICAL:"vertical"};goog.ui.Container.prototype.keyEventTarget_=null;goog.ui.Container.prototype.keyHandler_=null;goog.ui.Container.prototype.renderer_=null;goog.ui.Container.prototype.orientation_=null;goog.ui.Container.prototype.visible_=true;goog.ui.Container.prototype.enabled_=true;goog.ui.Container.prototype.focusable_=true;goog.ui.Container.prototype.highlightedIndex_=-1;goog.ui.Container.prototype.openItem_=null;goog.ui.Container.prototype.mouseButtonPressed_=false;goog.ui.Container.prototype.allowFocusableChildren_=false;goog.ui.Container.prototype.openFollowsHighlight_=true;goog.ui.Container.prototype.childElementIdMap_=null;goog.ui.Container.prototype.getKeyEventTarget=function(){return this.keyEventTarget_||this.renderer_.getKeyEventTarget(this)};goog.ui.Container.prototype.setKeyEventTarget=function(b){if(this.focusable_){var c=this.getKeyEventTarget();var a=this.isInDocument();this.keyEventTarget_=b;var d=this.getKeyEventTarget();if(a){this.keyEventTarget_=c;this.enableFocusHandling_(false);this.keyEventTarget_=b;this.getKeyHandler().attach(d);this.enableFocusHandling_(true)}}else{throw Error("Can't set key event target for container that doesn't support keyboard focus!")}};goog.ui.Container.prototype.getKeyHandler=function(){return this.keyHandler_||(this.keyHandler_=new goog.events.KeyHandler(this.getKeyEventTarget()))};goog.ui.Container.prototype.getRenderer=function(){return this.renderer_};goog.ui.Container.prototype.setRenderer=function(a){if(this.getElement()){throw Error(goog.ui.Component.Error.ALREADY_RENDERED)}this.renderer_=a};goog.ui.Container.prototype.createDom=function(){this.setElementInternal(this.renderer_.createDom(this))};goog.ui.Container.prototype.getContentElement=function(){return this.renderer_.getContentElement(this.getElement())};goog.ui.Container.prototype.canDecorate=function(a){return this.renderer_.canDecorate(a)};goog.ui.Container.prototype.decorateInternal=function(a){this.setElementInternal(this.renderer_.decorate(this,a));if(a.style.display=="none"){this.visible_=false}};goog.ui.Container.prototype.enterDocument=function(){goog.ui.Container.superClass_.enterDocument.call(this);this.forEachChild(function(b){if(b.isInDocument()){this.registerChildId_(b)}},this);var a=this.getElement();this.renderer_.initializeDom(this);this.setVisible(this.visible_,true);this.getHandler().listen(this,goog.ui.Component.EventType.ENTER,this.handleEnterItem).listen(this,goog.ui.Component.EventType.HIGHLIGHT,this.handleHighlightItem).listen(this,goog.ui.Component.EventType.UNHIGHLIGHT,this.handleUnHighlightItem).listen(this,goog.ui.Component.EventType.OPEN,this.handleOpenItem).listen(this,goog.ui.Component.EventType.CLOSE,this.handleCloseItem).listen(a,goog.events.EventType.MOUSEDOWN,this.handleMouseDown).listen(goog.dom.getOwnerDocument(a),goog.events.EventType.MOUSEUP,this.handleDocumentMouseUp).listen(a,[goog.events.EventType.MOUSEDOWN,goog.events.EventType.MOUSEUP,goog.events.EventType.MOUSEOVER,goog.events.EventType.MOUSEOUT,goog.events.EventType.CONTEXTMENU],this.handleChildMouseEvents);if(this.isFocusable()){this.enableFocusHandling_(true)}};goog.ui.Container.prototype.enableFocusHandling_=function(a){var b=this.getHandler();var c=this.getKeyEventTarget();if(a){b.listen(c,goog.events.EventType.FOCUS,this.handleFocus).listen(c,goog.events.EventType.BLUR,this.handleBlur).listen(this.getKeyHandler(),goog.events.KeyHandler.EventType.KEY,this.handleKeyEvent)}else{b.unlisten(c,goog.events.EventType.FOCUS,this.handleFocus).unlisten(c,goog.events.EventType.BLUR,this.handleBlur).unlisten(this.getKeyHandler(),goog.events.KeyHandler.EventType.KEY,this.handleKeyEvent)}};goog.ui.Container.prototype.exitDocument=function(){this.setHighlightedIndex(-1);if(this.openItem_){this.openItem_.setOpen(false)}this.mouseButtonPressed_=false;goog.ui.Container.superClass_.exitDocument.call(this)};goog.ui.Container.prototype.disposeInternal=function(){goog.ui.Container.superClass_.disposeInternal.call(this);if(this.keyHandler_){this.keyHandler_.dispose();this.keyHandler_=null}this.keyEventTarget_=null;this.childElementIdMap_=null;this.openItem_=null;this.renderer_=null};goog.ui.Container.prototype.handleEnterItem=function(a){return true};goog.ui.Container.prototype.handleHighlightItem=function(d){var a=this.indexOfChild((d.target));if(a>-1&&a!=this.highlightedIndex_){var c=this.getHighlighted();if(c){c.setHighlighted(false)}this.highlightedIndex_=a;c=this.getHighlighted();if(this.isMouseButtonPressed()){c.setActive(true)}if(this.openFollowsHighlight_&&this.openItem_&&c!=this.openItem_){if(c.isSupportedState(goog.ui.Component.State.OPENED)){c.setOpen(true)}else{this.openItem_.setOpen(false)}}}var b=this.getElement();goog.asserts.assert(b,"The DOM element for the container cannot be null.");if(d.target.getElement()!=null){goog.a11y.aria.setState(b,goog.a11y.aria.State.ACTIVEDESCENDANT,d.target.getElement().id)}};goog.ui.Container.prototype.handleUnHighlightItem=function(b){if(b.target==this.getHighlighted()){this.highlightedIndex_=-1}var a=this.getElement();goog.asserts.assert(a,"The DOM element for the container cannot be null.");goog.a11y.aria.removeState(a,goog.a11y.aria.State.ACTIVEDESCENDANT)};goog.ui.Container.prototype.handleOpenItem=function(b){var a=(b.target);if(a&&a!=this.openItem_&&a.getParent()==this){if(this.openItem_){this.openItem_.setOpen(false)}this.openItem_=a}};goog.ui.Container.prototype.handleCloseItem=function(a){if(a.target==this.openItem_){this.openItem_=null}};goog.ui.Container.prototype.handleMouseDown=function(b){if(this.enabled_){this.setMouseButtonPressed(true)}var a=this.getKeyEventTarget();if(a&&goog.dom.isFocusableTabIndex(a)){a.focus()}else{b.preventDefault()}};goog.ui.Container.prototype.handleDocumentMouseUp=function(a){this.setMouseButtonPressed(false)};goog.ui.Container.prototype.handleChildMouseEvents=function(b){var a=this.getOwnerControl((b.target));if(a){switch(b.type){case goog.events.EventType.MOUSEDOWN:a.handleMouseDown(b);break;case goog.events.EventType.MOUSEUP:a.handleMouseUp(b);break;case goog.events.EventType.MOUSEOVER:a.handleMouseOver(b);break;case goog.events.EventType.MOUSEOUT:a.handleMouseOut(b);break;case goog.events.EventType.CONTEXTMENU:a.handleContextMenu(b);break}}};goog.ui.Container.prototype.getOwnerControl=function(b){if(this.childElementIdMap_){var a=this.getElement();while(b&&b!==a){var c=b.id;if(c in this.childElementIdMap_){return this.childElementIdMap_[c]}b=b.parentNode}}return null};goog.ui.Container.prototype.handleFocus=function(a){};goog.ui.Container.prototype.handleBlur=function(a){this.setHighlightedIndex(-1);this.setMouseButtonPressed(false);if(this.openItem_){this.openItem_.setOpen(false)}};goog.ui.Container.prototype.handleKeyEvent=function(a){if(this.isEnabled()&&this.isVisible()&&(this.getChildCount()!=0||this.keyEventTarget_)&&this.handleKeyEventInternal(a)){a.preventDefault();a.stopPropagation();return true}return false};goog.ui.Container.prototype.handleKeyEventInternal=function(b){var a=this.getHighlighted();if(a&&typeof a.handleKeyEvent=="function"&&a.handleKeyEvent(b)){return true}if(this.openItem_&&this.openItem_!=a&&typeof this.openItem_.handleKeyEvent=="function"&&this.openItem_.handleKeyEvent(b)){return true}if(b.shiftKey||b.ctrlKey||b.metaKey||b.altKey){return false}switch(b.keyCode){case goog.events.KeyCodes.ESC:if(this.isFocusable()){this.getKeyEventTarget().blur()}else{return false}break;case goog.events.KeyCodes.HOME:this.highlightFirst();break;case goog.events.KeyCodes.END:this.highlightLast();break;case goog.events.KeyCodes.UP:if(this.orientation_==goog.ui.Container.Orientation.VERTICAL){this.highlightPrevious()}else{return false}break;case goog.events.KeyCodes.LEFT:if(this.orientation_==goog.ui.Container.Orientation.HORIZONTAL){if(this.isRightToLeft()){this.highlightNext()}else{this.highlightPrevious()}}else{return false}break;case goog.events.KeyCodes.DOWN:if(this.orientation_==goog.ui.Container.Orientation.VERTICAL){this.highlightNext()}else{return false}break;case goog.events.KeyCodes.RIGHT:if(this.orientation_==goog.ui.Container.Orientation.HORIZONTAL){if(this.isRightToLeft()){this.highlightPrevious()}else{this.highlightNext()}}else{return false}break;default:return false}return true};goog.ui.Container.prototype.registerChildId_=function(c){var a=c.getElement();var b=a.id||(a.id=c.getId());if(!this.childElementIdMap_){this.childElementIdMap_={}}this.childElementIdMap_[b]=c};goog.ui.Container.prototype.addChild=function(b,a){goog.asserts.assertInstanceof(b,goog.ui.Control,"The child of a container must be a control");goog.ui.Container.superClass_.addChild.call(this,b,a)};goog.ui.Container.prototype.getChild;goog.ui.Container.prototype.getChildAt;goog.ui.Container.prototype.addChildAt=function(d,c,a){goog.asserts.assertInstanceof(d,goog.ui.Control);d.setDispatchTransitionEvents(goog.ui.Component.State.HOVER,true);d.setDispatchTransitionEvents(goog.ui.Component.State.OPENED,true);if(this.isFocusable()||!this.isFocusableChildrenAllowed()){d.setSupportedState(goog.ui.Component.State.FOCUSED,false)}d.setHandleMouseEvents(false);var b=(d.getParent()==this)?this.indexOfChild(d):-1;goog.ui.Container.superClass_.addChildAt.call(this,d,c,a);if(d.isInDocument()&&this.isInDocument()){this.registerChildId_(d)}this.updateHighlightedIndex_(b,c)};goog.ui.Container.prototype.updateHighlightedIndex_=function(a,b){if(a==-1){a=this.getChildCount()}if(a==this.highlightedIndex_){this.highlightedIndex_=Math.min(this.getChildCount()-1,b)}else{if(a>this.highlightedIndex_&&b<=this.highlightedIndex_){this.highlightedIndex_++}else{if(a<this.highlightedIndex_&&b>this.highlightedIndex_){this.highlightedIndex_--}}}};goog.ui.Container.prototype.removeChild=function(c,d){c=goog.isString(c)?this.getChild(c):c;goog.asserts.assertInstanceof(c,goog.ui.Control);if(c){var a=this.indexOfChild(c);if(a!=-1){if(a==this.highlightedIndex_){c.setHighlighted(false);this.highlightedIndex_=-1}else{if(a<this.highlightedIndex_){this.highlightedIndex_--}}}var b=c.getElement();if(b&&b.id&&this.childElementIdMap_){goog.object.remove(this.childElementIdMap_,b.id)}}c=(goog.ui.Container.superClass_.removeChild.call(this,c,d));c.setHandleMouseEvents(true);return c};goog.ui.Container.prototype.getOrientation=function(){return this.orientation_};goog.ui.Container.prototype.setOrientation=function(a){if(this.getElement()){throw Error(goog.ui.Component.Error.ALREADY_RENDERED)}this.orientation_=a};goog.ui.Container.prototype.isVisible=function(){return this.visible_};goog.ui.Container.prototype.setVisible=function(c,a){if(a||(this.visible_!=c&&this.dispatchEvent(c?goog.ui.Component.EventType.SHOW:goog.ui.Component.EventType.HIDE))){this.visible_=c;var b=this.getElement();if(b){goog.style.setElementShown(b,c);if(this.isFocusable()){this.renderer_.enableTabIndex(this.getKeyEventTarget(),this.enabled_&&this.visible_)}if(!a){this.dispatchEvent(this.visible_?goog.ui.Container.EventType.AFTER_SHOW:goog.ui.Container.EventType.AFTER_HIDE)}}return true}return false};goog.ui.Container.prototype.isEnabled=function(){return this.enabled_};goog.ui.Container.prototype.setEnabled=function(a){if(this.enabled_!=a&&this.dispatchEvent(a?goog.ui.Component.EventType.ENABLE:goog.ui.Component.EventType.DISABLE)){if(a){this.enabled_=true;this.forEachChild(function(b){if(b.wasDisabled){delete b.wasDisabled}else{b.setEnabled(true)}})}else{this.forEachChild(function(b){if(b.isEnabled()){b.setEnabled(false)}else{b.wasDisabled=true}});this.enabled_=false;this.setMouseButtonPressed(false)}if(this.isFocusable()){this.renderer_.enableTabIndex(this.getKeyEventTarget(),a&&this.visible_)}}};goog.ui.Container.prototype.isFocusable=function(){return this.focusable_};goog.ui.Container.prototype.setFocusable=function(a){if(a!=this.focusable_&&this.isInDocument()){this.enableFocusHandling_(a)}this.focusable_=a;if(this.enabled_&&this.visible_){this.renderer_.enableTabIndex(this.getKeyEventTarget(),a)}};goog.ui.Container.prototype.isFocusableChildrenAllowed=function(){return this.allowFocusableChildren_};goog.ui.Container.prototype.setFocusableChildrenAllowed=function(a){this.allowFocusableChildren_=a};goog.ui.Container.prototype.isOpenFollowsHighlight=function(){return this.openFollowsHighlight_};goog.ui.Container.prototype.setOpenFollowsHighlight=function(a){this.openFollowsHighlight_=a};goog.ui.Container.prototype.getHighlightedIndex=function(){return this.highlightedIndex_};goog.ui.Container.prototype.setHighlightedIndex=function(a){var b=this.getChildAt(a);if(b){b.setHighlighted(true)}else{if(this.highlightedIndex_>-1){this.getHighlighted().setHighlighted(false)}}};goog.ui.Container.prototype.setHighlighted=function(a){this.setHighlightedIndex(this.indexOfChild(a))};goog.ui.Container.prototype.getHighlighted=function(){return this.getChildAt(this.highlightedIndex_)};goog.ui.Container.prototype.highlightFirst=function(){this.highlightHelper(function(b,a){return(b+1)%a},this.getChildCount()-1)};goog.ui.Container.prototype.highlightLast=function(){this.highlightHelper(function(b,a){b--;return b<0?a-1:b},0)};goog.ui.Container.prototype.highlightNext=function(){this.highlightHelper(function(b,a){return(b+1)%a},this.highlightedIndex_)};goog.ui.Container.prototype.highlightPrevious=function(){this.highlightHelper(function(b,a){b--;return b<0?a-1:b},this.highlightedIndex_)};goog.ui.Container.prototype.highlightHelper=function(d,f){var c=f<0?this.indexOfChild(this.openItem_):f;var b=this.getChildCount();c=d.call(this,c,b);var a=0;while(a<=b){var e=this.getChildAt(c);if(e&&this.canHighlightItem(e)){this.setHighlightedIndexFromKeyEvent(c);return true}a++;c=d.call(this,c,b)}return false};goog.ui.Container.prototype.canHighlightItem=function(a){return a.isVisible()&&a.isEnabled()&&a.isSupportedState(goog.ui.Component.State.HOVER)};goog.ui.Container.prototype.setHighlightedIndexFromKeyEvent=function(a){this.setHighlightedIndex(a)};goog.ui.Container.prototype.getOpenItem=function(){return this.openItem_};goog.ui.Container.prototype.isMouseButtonPressed=function(){return this.mouseButtonPressed_};goog.ui.Container.prototype.setMouseButtonPressed=function(a){this.mouseButtonPressed_=a};goog.provide("goog.ui.MenuHeaderRenderer");goog.require("goog.ui.ControlRenderer");goog.ui.MenuHeaderRenderer=function(){goog.ui.ControlRenderer.call(this)};goog.inherits(goog.ui.MenuHeaderRenderer,goog.ui.ControlRenderer);goog.addSingletonGetter(goog.ui.MenuHeaderRenderer);goog.ui.MenuHeaderRenderer.CSS_CLASS=goog.getCssName("goog-menuheader");goog.ui.MenuHeaderRenderer.prototype.getCssClass=function(){return goog.ui.MenuHeaderRenderer.CSS_CLASS};goog.provide("goog.ui.MenuHeader");goog.require("goog.ui.Component");goog.require("goog.ui.Control");goog.require("goog.ui.MenuHeaderRenderer");goog.require("goog.ui.registry");goog.ui.MenuHeader=function(b,a,c){goog.ui.Control.call(this,b,c||goog.ui.MenuHeaderRenderer.getInstance(),a);this.setSupportedState(goog.ui.Component.State.DISABLED,false);this.setSupportedState(goog.ui.Component.State.HOVER,false);this.setSupportedState(goog.ui.Component.State.ACTIVE,false);this.setSupportedState(goog.ui.Component.State.FOCUSED,false);this.setStateInternal(goog.ui.Component.State.DISABLED)};goog.inherits(goog.ui.MenuHeader,goog.ui.Control);goog.ui.registry.setDecoratorByClassName(goog.ui.MenuHeaderRenderer.CSS_CLASS,function(){return new goog.ui.MenuHeader(null)});goog.provide("goog.ui.Menu");goog.provide("goog.ui.Menu.EventType");goog.require("goog.math.Coordinate");goog.require("goog.string");goog.require("goog.style");goog.require("goog.ui.Component.EventType");goog.require("goog.ui.Component.State");goog.require("goog.ui.Container");goog.require("goog.ui.Container.Orientation");goog.require("goog.ui.MenuHeader");goog.require("goog.ui.MenuItem");goog.require("goog.ui.MenuRenderer");goog.require("goog.ui.MenuSeparator");goog.ui.Menu=function(a,b){goog.ui.Container.call(this,goog.ui.Container.Orientation.VERTICAL,b||goog.ui.MenuRenderer.getInstance(),a);this.setFocusable(false)};goog.inherits(goog.ui.Menu,goog.ui.Container);goog.tagUnsealableClass(goog.ui.Menu);goog.ui.Menu.EventType={BEFORE_SHOW:goog.ui.Component.EventType.BEFORE_SHOW,SHOW:goog.ui.Component.EventType.SHOW,BEFORE_HIDE:goog.ui.Component.EventType.HIDE,HIDE:goog.ui.Component.EventType.HIDE};goog.ui.Menu.CSS_CLASS=goog.ui.MenuRenderer.CSS_CLASS;goog.ui.Menu.prototype.openingCoords;goog.ui.Menu.prototype.allowAutoFocus_=true;goog.ui.Menu.prototype.allowHighlightDisabled_=false;goog.ui.Menu.prototype.getCssClass=function(){return this.getRenderer().getCssClass()};goog.ui.Menu.prototype.containsElement=function(b){if(this.getRenderer().containsElement(this,b)){return true}for(var a=0,c=this.getChildCount();a<c;a++){var d=this.getChildAt(a);if(typeof d.containsElement=="function"&&d.containsElement(b)){return true}}return false};goog.ui.Menu.prototype.addItem=function(a){this.addChild(a,true)};goog.ui.Menu.prototype.addItemAt=function(a,b){this.addChildAt(a,b,true)};goog.ui.Menu.prototype.removeItem=function(a){var b=this.removeChild(a,true);if(b){b.dispose()}};goog.ui.Menu.prototype.removeItemAt=function(b){var a=this.removeChildAt(b,true);if(a){a.dispose()}};goog.ui.Menu.prototype.getItemAt=function(a){return(this.getChildAt(a))};goog.ui.Menu.prototype.getItemCount=function(){return this.getChildCount()};goog.ui.Menu.prototype.getItems=function(){var a=[];this.forEachChild(function(b){a.push(b)});return a};goog.ui.Menu.prototype.setPosition=function(b,a){var c=this.isVisible();if(!c){goog.style.setElementShown(this.getElement(),true)}goog.style.setPageOffset(this.getElement(),b,a);if(!c){goog.style.setElementShown(this.getElement(),false)}};goog.ui.Menu.prototype.getPosition=function(){return this.isVisible()?goog.style.getPageOffset(this.getElement()):null};goog.ui.Menu.prototype.setAllowAutoFocus=function(a){this.allowAutoFocus_=a;if(a){this.setFocusable(true)}};goog.ui.Menu.prototype.getAllowAutoFocus=function(){return this.allowAutoFocus_};goog.ui.Menu.prototype.setAllowHighlightDisabled=function(a){this.allowHighlightDisabled_=a};goog.ui.Menu.prototype.getAllowHighlightDisabled=function(){return this.allowHighlightDisabled_};goog.ui.Menu.prototype.setVisible=function(a,c,d){var b=goog.ui.Menu.superClass_.setVisible.call(this,a,c);if(b&&a&&this.isInDocument()&&this.allowAutoFocus_){this.getKeyEventTarget().focus()}if(a&&d&&goog.isNumber(d.clientX)){this.openingCoords=new goog.math.Coordinate(d.clientX,d.clientY)}else{this.openingCoords=null}return b};goog.ui.Menu.prototype.handleEnterItem=function(a){if(this.allowAutoFocus_){this.getKeyEventTarget().focus()}return goog.ui.Menu.superClass_.handleEnterItem.call(this,a)};goog.ui.Menu.prototype.highlightNextPrefix=function(b){var a=new RegExp("^"+goog.string.regExpEscape(b),"i");return this.highlightHelper(function(f,c){var g=f<0?0:f;var d=false;do{++f;if(f==c){f=0;d=true}var e=this.getChildAt(f).getCaption();if(e&&e.match(a)){return f}}while(!d||f!=g);return this.getHighlightedIndex()},this.getHighlightedIndex())};goog.ui.Menu.prototype.canHighlightItem=function(a){return(this.allowHighlightDisabled_||a.isEnabled())&&a.isVisible()&&a.isSupportedState(goog.ui.Component.State.HOVER)};goog.ui.Menu.prototype.decorateInternal=function(a){this.decorateContent(a);goog.ui.Menu.superClass_.decorateInternal.call(this,a)};goog.ui.Menu.prototype.handleKeyEventInternal=function(b){var a=goog.ui.Menu.base(this,"handleKeyEventInternal",b);if(!a){this.forEachChild(function(c){if(!a&&c.getMnemonic&&c.getMnemonic()==b.keyCode){if(this.isEnabled()){this.setHighlighted(c)}a=c.handleKeyEvent(b)}},this)}return a};goog.ui.Menu.prototype.setHighlightedIndex=function(a){goog.ui.Menu.base(this,"setHighlightedIndex",a);var b=this.getChildAt(a);if(b){goog.style.scrollIntoContainerView(b.getElement(),this.getElement())}};goog.ui.Menu.prototype.decorateContent=function(c){var e=this.getRenderer();var a=this.getDomHelper().getElementsByTagNameAndClass("div",goog.getCssName(e.getCssClass(),"content"),c);var d=a.length;for(var b=0;b<d;b++){e.decorateChildren(this,a[b])}};goog.provide("goog.ui.PopupMenu");goog.require("goog.events.EventType");goog.require("goog.positioning.AnchoredViewportPosition");goog.require("goog.positioning.Corner");goog.require("goog.positioning.MenuAnchoredPosition");goog.require("goog.positioning.Overflow");goog.require("goog.positioning.ViewportClientPosition");goog.require("goog.structs.Map");goog.require("goog.style");goog.require("goog.ui.Component");goog.require("goog.ui.Menu");goog.require("goog.ui.PopupBase");goog.require("goog.userAgent");goog.ui.PopupMenu=function(a,b){goog.ui.Menu.call(this,a,b);this.setAllowAutoFocus(true);this.setVisible(false,true);this.targets_=new goog.structs.Map()};goog.inherits(goog.ui.PopupMenu,goog.ui.Menu);goog.tagUnsealableClass(goog.ui.PopupMenu);goog.ui.PopupMenu.prototype.toggleMode_=false;goog.ui.PopupMenu.prototype.lastHide_=0;goog.ui.PopupMenu.prototype.currentAnchor_=null;goog.ui.PopupMenu.prototype.decorateInternal=function(a){goog.ui.PopupMenu.superClass_.decorateInternal.call(this,a);var b=a.getAttribute("for")||a.htmlFor;if(b){this.attach(this.getDomHelper().getElement(b),goog.positioning.Corner.BOTTOM_LEFT)}};goog.ui.PopupMenu.prototype.enterDocument=function(){goog.ui.PopupMenu.superClass_.enterDocument.call(this);this.targets_.forEach(this.attachEvent_,this);var a=this.getHandler();a.listen(this,goog.ui.Component.EventType.ACTION,this.onAction_);a.listen(this.getDomHelper().getDocument(),goog.events.EventType.MOUSEDOWN,this.onDocClick,true);if(goog.userAgent.WEBKIT){a.listen(this.getDomHelper().getDocument(),goog.events.EventType.CONTEXTMENU,this.onDocClick,true)}};goog.ui.PopupMenu.prototype.attach=function(d,a,c,f,b){if(this.isAttachTarget(d)){return}var e=this.createAttachTarget(d,a,c,f,b);if(this.isInDocument()){this.attachEvent_(e)}};goog.ui.PopupMenu.prototype.createAttachTarget=function(d,a,c,f,b){if(!d){return null}var e={element_:d,targetCorner_:a,menuCorner_:c,eventType_:f?goog.events.EventType.CONTEXTMENU:goog.events.EventType.MOUSEDOWN,margin_:b};this.targets_.set(goog.getUid(d),e);return e};goog.ui.PopupMenu.prototype.getAttachTarget=function(a){return a?(this.targets_.get(goog.getUid(a))):null};goog.ui.PopupMenu.prototype.isAttachTarget=function(a){return a?this.targets_.containsKey(goog.getUid(a)):false};goog.ui.PopupMenu.prototype.getAttachedElement=function(){return this.currentAnchor_};goog.ui.PopupMenu.prototype.attachEvent_=function(a){this.getHandler().listen(a.element_,a.eventType_,this.onTargetClick_)};goog.ui.PopupMenu.prototype.detachAll=function(){if(this.isInDocument()){var b=this.targets_.getKeys();for(var a=0;a<b.length;a++){this.detachEvent_((this.targets_.get(b[a])))}}this.targets_.clear()};goog.ui.PopupMenu.prototype.detach=function(b){if(!this.isAttachTarget(b)){throw Error("Menu not attached to provided element, unable to detach.")}var a=goog.getUid(b);if(this.isInDocument()){this.detachEvent_((this.targets_.get(a)))}this.targets_.remove(a)};goog.ui.PopupMenu.prototype.detachEvent_=function(a){this.getHandler().unlisten(a.element_,a.eventType_,this.onTargetClick_)};goog.ui.PopupMenu.prototype.setToggleMode=function(a){this.toggleMode_=a};goog.ui.PopupMenu.prototype.getToggleMode=function(){return this.toggleMode_};goog.ui.PopupMenu.prototype.showWithPosition=function(c,e,d,b){var a=this.isVisible();if(this.isOrWasRecentlyVisible()&&this.toggleMode_){this.hide();return}this.currentAnchor_=b||null;if(!this.dispatchEvent(goog.ui.Component.EventType.BEFORE_SHOW)){return}var f=typeof e!="undefined"?e:goog.positioning.Corner.TOP_START;if(!a){this.getElement().style.visibility="hidden"}goog.style.setElementShown(this.getElement(),true);c.reposition(this.getElement(),f,d);if(!a){this.getElement().style.visibility="visible"}this.setHighlightedIndex(-1);this.setVisible(true)};goog.ui.PopupMenu.prototype.showMenu=function(c,b,d){var a=goog.isDef(c.targetCorner_)?new goog.positioning.AnchoredViewportPosition(c.element_,c.targetCorner_,true):new goog.positioning.ViewportClientPosition(b,d);if(a.setLastResortOverflow){a.setLastResortOverflow(goog.positioning.Overflow.ADJUST_X|goog.positioning.Overflow.ADJUST_Y)}this.showWithPosition(a,c.menuCorner_,c.margin_,c.element_)};goog.ui.PopupMenu.prototype.showAt=function(a,c,b){this.showWithPosition(new goog.positioning.ViewportClientPosition(a,c),b)};goog.ui.PopupMenu.prototype.showAtElement=function(b,c,a){this.showWithPosition(new goog.positioning.MenuAnchoredPosition(b,c,true),a,null,b)};goog.ui.PopupMenu.prototype.hide=function(){if(!this.isVisible()){return}this.setVisible(false);if(!this.isVisible()){this.lastHide_=goog.now();this.currentAnchor_=null}};goog.ui.PopupMenu.prototype.isOrWasRecentlyVisible=function(){return this.isVisible()||this.wasRecentlyHidden()};goog.ui.PopupMenu.prototype.wasRecentlyHidden=function(){return goog.now()-this.lastHide_<goog.ui.PopupBase.DEBOUNCE_DELAY_MS};goog.ui.PopupMenu.prototype.onAction_=function(a){this.hide()};goog.ui.PopupMenu.prototype.onTargetClick_=function(d){var b=this.targets_.getKeys();for(var a=0;a<b.length;a++){var c=(this.targets_.get(b[a]));if(c.element_==d.currentTarget){this.showMenu(c,(d.clientX),(d.clientY));d.preventDefault();d.stopPropagation();return}}};goog.ui.PopupMenu.prototype.onDocClick=function(a){if(this.isVisible()&&!this.containsElement((a.target))){this.hide()}};goog.ui.PopupMenu.prototype.handleBlur=function(a){goog.ui.PopupMenu.superClass_.handleBlur.call(this,a);this.hide()};goog.ui.PopupMenu.prototype.disposeInternal=function(){goog.ui.PopupMenu.superClass_.disposeInternal.call(this);if(this.targets_){this.targets_.clear();delete this.targets_}};goog.provide("goog.fx.DragEvent");goog.provide("goog.fx.Dragger");goog.provide("goog.fx.Dragger.EventType");goog.require("goog.dom");goog.require("goog.events");goog.require("goog.events.Event");goog.require("goog.events.EventHandler");goog.require("goog.events.EventTarget");goog.require("goog.events.EventType");goog.require("goog.math.Coordinate");goog.require("goog.math.Rect");goog.require("goog.style");goog.require("goog.style.bidi");goog.require("goog.userAgent");goog.fx.Dragger=function(c,b,a){goog.events.EventTarget.call(this);this.target=c;this.handle=b||c;this.limits=a||new goog.math.Rect(NaN,NaN,NaN,NaN);this.document_=goog.dom.getOwnerDocument(c);this.eventHandler_=new goog.events.EventHandler(this);this.registerDisposable(this.eventHandler_);goog.events.listen(this.handle,[goog.events.EventType.TOUCHSTART,goog.events.EventType.MOUSEDOWN],this.startDrag,false,this)};goog.inherits(goog.fx.Dragger,goog.events.EventTarget);goog.tagUnsealableClass(goog.fx.Dragger);goog.fx.Dragger.HAS_SET_CAPTURE_=goog.userAgent.IE||goog.userAgent.GECKO&&goog.userAgent.isVersionOrHigher("1.9.3");goog.fx.Dragger.cloneNode=function(c){var b=(c.cloneNode(true)),a=c.getElementsByTagName("textarea"),e=b.getElementsByTagName("textarea");for(var d=0;d<a.length;d++){e[d].value=a[d].value}switch(c.tagName.toLowerCase()){case"tr":return goog.dom.createDom("table",null,goog.dom.createDom("tbody",null,b));case"td":case"th":return goog.dom.createDom("table",null,goog.dom.createDom("tbody",null,goog.dom.createDom("tr",null,b)));case"textarea":b.value=c.value;default:return b}};goog.fx.Dragger.EventType={EARLY_CANCEL:"earlycancel",START:"start",BEFOREDRAG:"beforedrag",DRAG:"drag",END:"end"};goog.fx.Dragger.prototype.target;goog.fx.Dragger.prototype.handle;goog.fx.Dragger.prototype.limits;goog.fx.Dragger.prototype.rightToLeft_;goog.fx.Dragger.prototype.clientX=0;goog.fx.Dragger.prototype.clientY=0;goog.fx.Dragger.prototype.screenX=0;goog.fx.Dragger.prototype.screenY=0;goog.fx.Dragger.prototype.startX=0;goog.fx.Dragger.prototype.startY=0;goog.fx.Dragger.prototype.deltaX=0;goog.fx.Dragger.prototype.deltaY=0;goog.fx.Dragger.prototype.pageScroll;goog.fx.Dragger.prototype.enabled_=true;goog.fx.Dragger.prototype.dragging_=false;goog.fx.Dragger.prototype.hysteresisDistanceSquared_=0;goog.fx.Dragger.prototype.mouseDownTime_=0;goog.fx.Dragger.prototype.document_;goog.fx.Dragger.prototype.scrollTarget_;goog.fx.Dragger.prototype.ieDragStartCancellingOn_=false;goog.fx.Dragger.prototype.useRightPositioningForRtl_=false;goog.fx.Dragger.prototype.enableRightPositioningForRtl=function(a){this.useRightPositioningForRtl_=a};goog.fx.Dragger.prototype.getHandler=function(){var a=(this);return a.eventHandler_};goog.fx.Dragger.prototype.setLimits=function(a){this.limits=a||new goog.math.Rect(NaN,NaN,NaN,NaN)};goog.fx.Dragger.prototype.setHysteresis=function(a){this.hysteresisDistanceSquared_=Math.pow(a,2)};goog.fx.Dragger.prototype.getHysteresis=function(){return Math.sqrt(this.hysteresisDistanceSquared_)};goog.fx.Dragger.prototype.setScrollTarget=function(a){this.scrollTarget_=a};goog.fx.Dragger.prototype.setCancelIeDragStart=function(a){this.ieDragStartCancellingOn_=a};goog.fx.Dragger.prototype.getEnabled=function(){return this.enabled_};goog.fx.Dragger.prototype.setEnabled=function(a){this.enabled_=a};goog.fx.Dragger.prototype.disposeInternal=function(){goog.fx.Dragger.superClass_.disposeInternal.call(this);goog.events.unlisten(this.handle,[goog.events.EventType.TOUCHSTART,goog.events.EventType.MOUSEDOWN],this.startDrag,false,this);this.cleanUpAfterDragging_();this.target=null;this.handle=null};goog.fx.Dragger.prototype.isRightToLeft_=function(){if(!goog.isDef(this.rightToLeft_)){this.rightToLeft_=goog.style.isRightToLeft(this.target)}return this.rightToLeft_};goog.fx.Dragger.prototype.startDrag=function(b){var a=b.type==goog.events.EventType.MOUSEDOWN;if(this.enabled_&&!this.dragging_&&(!a||b.isMouseActionButton())){if(this.hysteresisDistanceSquared_==0){if(this.fireDragStart_(b)){this.dragging_=true;b.preventDefault()}else{return}}else{b.preventDefault()}this.setupDragHandlers();this.clientX=this.startX=b.clientX;this.clientY=this.startY=b.clientY;this.screenX=b.screenX;this.screenY=b.screenY;this.computeInitialPosition();this.pageScroll=goog.dom.getDomHelper(this.document_).getDocumentScroll();this.mouseDownTime_=goog.now()}else{this.dispatchEvent(goog.fx.Dragger.EventType.EARLY_CANCEL)}};goog.fx.Dragger.prototype.setupDragHandlers=function(){var b=this.document_;var c=b.documentElement;var a=!goog.fx.Dragger.HAS_SET_CAPTURE_;this.eventHandler_.listen(b,[goog.events.EventType.TOUCHMOVE,goog.events.EventType.MOUSEMOVE],this.handleMove_,a);this.eventHandler_.listen(b,[goog.events.EventType.TOUCHEND,goog.events.EventType.MOUSEUP],this.endDrag,a);if(goog.fx.Dragger.HAS_SET_CAPTURE_){c.setCapture(false);this.eventHandler_.listen(c,goog.events.EventType.LOSECAPTURE,this.endDrag)}else{this.eventHandler_.listen(goog.dom.getWindow(b),goog.events.EventType.BLUR,this.endDrag)}if(goog.userAgent.IE&&this.ieDragStartCancellingOn_){this.eventHandler_.listen(b,goog.events.EventType.DRAGSTART,goog.events.Event.preventDefault)}if(this.scrollTarget_){this.eventHandler_.listen(this.scrollTarget_,goog.events.EventType.SCROLL,this.onScroll_,a)}};goog.fx.Dragger.prototype.fireDragStart_=function(a){return this.dispatchEvent(new goog.fx.DragEvent(goog.fx.Dragger.EventType.START,this,a.clientX,a.clientY,a))};goog.fx.Dragger.prototype.cleanUpAfterDragging_=function(){this.eventHandler_.removeAll();if(goog.fx.Dragger.HAS_SET_CAPTURE_){this.document_.releaseCapture()}};goog.fx.Dragger.prototype.endDrag=function(d,c){this.cleanUpAfterDragging_();if(this.dragging_){this.dragging_=false;var b=this.limitX(this.deltaX);var f=this.limitY(this.deltaY);var a=c||d.type==goog.events.EventType.TOUCHCANCEL;this.dispatchEvent(new goog.fx.DragEvent(goog.fx.Dragger.EventType.END,this,d.clientX,d.clientY,d,b,f,a))}else{this.dispatchEvent(goog.fx.Dragger.EventType.EARLY_CANCEL)}};goog.fx.Dragger.prototype.endDragCancel=function(a){this.endDrag(a,true)};goog.fx.Dragger.prototype.handleMove_=function(d){if(this.enabled_){var c=this.useRightPositioningForRtl_&&this.isRightToLeft_()?-1:1;var l=c*(d.clientX-this.clientX);var k=d.clientY-this.clientY;this.clientX=d.clientX;this.clientY=d.clientY;this.screenX=d.screenX;this.screenY=d.screenY;if(!this.dragging_){var j=this.startX-this.clientX;var h=this.startY-this.clientY;var a=j*j+h*h;if(a>this.hysteresisDistanceSquared_){if(this.fireDragStart_(d)){this.dragging_=true}else{if(!this.isDisposed()){this.endDrag(d)}return}}}var g=this.calculatePosition_(l,k);var i=g.x;var f=g.y;if(this.dragging_){var b=this.dispatchEvent(new goog.fx.DragEvent(goog.fx.Dragger.EventType.BEFOREDRAG,this,d.clientX,d.clientY,d,i,f));if(b){this.doDrag(d,i,f,false);d.preventDefault()}}}};goog.fx.Dragger.prototype.calculatePosition_=function(c,b){var d=goog.dom.getDomHelper(this.document_).getDocumentScroll();c+=d.x-this.pageScroll.x;b+=d.y-this.pageScroll.y;this.pageScroll=d;this.deltaX+=c;this.deltaY+=b;var a=this.limitX(this.deltaX);var e=this.limitY(this.deltaY);return new goog.math.Coordinate(a,e)};goog.fx.Dragger.prototype.onScroll_=function(a){var b=this.calculatePosition_(0,0);a.clientX=this.clientX;a.clientY=this.clientY;this.doDrag(a,b.x,b.y,true)};goog.fx.Dragger.prototype.doDrag=function(c,a,d,b){this.defaultAction(a,d);this.dispatchEvent(new goog.fx.DragEvent(goog.fx.Dragger.EventType.DRAG,this,c.clientX,c.clientY,c,a,d))};goog.fx.Dragger.prototype.limitX=function(b){var d=this.limits;var f=!isNaN(d.left)?d.left:null;var c=!isNaN(d.width)?d.width:0;var e=f!=null?f+c:Infinity;var a=f!=null?f:-Infinity;return Math.min(e,Math.max(a,b))};goog.fx.Dragger.prototype.limitY=function(f){var b=this.limits;var d=!isNaN(b.top)?b.top:null;var a=!isNaN(b.height)?b.height:0;var c=d!=null?d+a:Infinity;var e=d!=null?d:-Infinity;return Math.min(c,Math.max(e,f))};goog.fx.Dragger.prototype.computeInitialPosition=function(){this.deltaX=this.useRightPositioningForRtl_?goog.style.bidi.getOffsetStart(this.target):this.target.offsetLeft;this.deltaY=this.target.offsetTop};goog.fx.Dragger.prototype.defaultAction=function(a,b){if(this.useRightPositioningForRtl_&&this.isRightToLeft_()){this.target.style.right=a+"px"}else{this.target.style.left=a+"px"}this.target.style.top=b+"px"};goog.fx.Dragger.prototype.isDragging=function(){return this.dragging_};goog.fx.DragEvent=function(d,a,e,c,h,g,f,b){goog.events.Event.call(this,d);this.clientX=e;this.clientY=c;this.browserEvent=h;this.left=goog.isDef(g)?g:a.deltaX;this.top=goog.isDef(f)?f:a.deltaY;this.dragger=a;this.dragCanceled=!!b};goog.inherits(goog.fx.DragEvent,goog.events.Event);goog.provide("goog.Delay");goog.provide("goog.async.Delay");goog.require("goog.Disposable");goog.require("goog.Timer");goog.async.Delay=function(b,a,c){goog.Disposable.call(this);this.listener_=b;this.interval_=a||0;this.handler_=c;this.callback_=goog.bind(this.doAction_,this)};goog.inherits(goog.async.Delay,goog.Disposable);goog.Delay=goog.async.Delay;goog.async.Delay.prototype.id_=0;goog.async.Delay.prototype.disposeInternal=function(){goog.async.Delay.superClass_.disposeInternal.call(this);this.stop();delete this.listener_;delete this.handler_};goog.async.Delay.prototype.start=function(a){this.stop();this.id_=goog.Timer.callOnce(this.callback_,goog.isDef(a)?a:this.interval_)};goog.async.Delay.prototype.stop=function(){if(this.isActive()){goog.Timer.clear(this.id_)}this.id_=0};goog.async.Delay.prototype.fire=function(){this.stop();this.doAction_()};goog.async.Delay.prototype.fireIfActive=function(){if(this.isActive()){this.fire()}};goog.async.Delay.prototype.isActive=function(){return this.id_!=0};goog.async.Delay.prototype.doAction_=function(){this.id_=0;if(this.listener_){this.listener_.call(this.handler_)}};goog.provide("goog.async.AnimationDelay");goog.require("goog.Disposable");goog.require("goog.events");goog.require("goog.functions");goog.async.AnimationDelay=function(b,a,c){goog.async.AnimationDelay.base(this,"constructor");this.listener_=b;this.handler_=c;this.win_=a||window;this.callback_=goog.bind(this.doAction_,this)};goog.inherits(goog.async.AnimationDelay,goog.Disposable);goog.async.AnimationDelay.prototype.id_=null;goog.async.AnimationDelay.prototype.usingListeners_=false;goog.async.AnimationDelay.TIMEOUT=20;goog.async.AnimationDelay.MOZ_BEFORE_PAINT_EVENT_="MozBeforePaint";goog.async.AnimationDelay.prototype.start=function(){this.stop();this.usingListeners_=false;var b=this.getRaf_();var a=this.getCancelRaf_();if(b&&!a&&this.win_.mozRequestAnimationFrame){this.id_=goog.events.listen(this.win_,goog.async.AnimationDelay.MOZ_BEFORE_PAINT_EVENT_,this.callback_);this.win_.mozRequestAnimationFrame(null);this.usingListeners_=true}else{if(b&&a){this.id_=b.call(this.win_,this.callback_)}else{this.id_=this.win_.setTimeout(goog.functions.lock(this.callback_),goog.async.AnimationDelay.TIMEOUT)}}};goog.async.AnimationDelay.prototype.stop=function(){if(this.isActive()){var b=this.getRaf_();var a=this.getCancelRaf_();if(b&&!a&&this.win_.mozRequestAnimationFrame){goog.events.unlistenByKey(this.id_)}else{if(b&&a){a.call(this.win_,(this.id_))}else{this.win_.clearTimeout((this.id_))}}}this.id_=null};goog.async.AnimationDelay.prototype.fire=function(){this.stop();this.doAction_()};goog.async.AnimationDelay.prototype.fireIfActive=function(){if(this.isActive()){this.fire()}};goog.async.AnimationDelay.prototype.isActive=function(){return this.id_!=null};goog.async.AnimationDelay.prototype.doAction_=function(){if(this.usingListeners_&&this.id_){goog.events.unlistenByKey(this.id_)}this.id_=null;this.listener_.call(this.handler_,goog.now())};goog.async.AnimationDelay.prototype.disposeInternal=function(){this.stop();goog.async.AnimationDelay.base(this,"disposeInternal")};goog.async.AnimationDelay.prototype.getRaf_=function(){var a=this.win_;return a.requestAnimationFrame||a.webkitRequestAnimationFrame||a.mozRequestAnimationFrame||a.oRequestAnimationFrame||a.msRequestAnimationFrame||null};goog.async.AnimationDelay.prototype.getCancelRaf_=function(){var a=this.win_;return a.cancelAnimationFrame||a.cancelRequestAnimationFrame||a.webkitCancelRequestAnimationFrame||a.mozCancelRequestAnimationFrame||a.oCancelRequestAnimationFrame||a.msCancelRequestAnimationFrame||null};goog.provide("goog.fx.anim");goog.provide("goog.fx.anim.Animated");goog.require("goog.async.AnimationDelay");goog.require("goog.async.Delay");goog.require("goog.object");goog.fx.anim.Animated=function(){};goog.fx.anim.Animated.prototype.onAnimationFrame;goog.fx.anim.TIMEOUT=goog.async.AnimationDelay.TIMEOUT;goog.fx.anim.activeAnimations_={};goog.fx.anim.animationWindow_=null;goog.fx.anim.animationDelay_=null;goog.fx.anim.registerAnimation=function(b){var a=goog.getUid(b);if(!(a in goog.fx.anim.activeAnimations_)){goog.fx.anim.activeAnimations_[a]=b}goog.fx.anim.requestAnimationFrame_()};goog.fx.anim.unregisterAnimation=function(b){var a=goog.getUid(b);delete goog.fx.anim.activeAnimations_[a];if(goog.object.isEmpty(goog.fx.anim.activeAnimations_)){goog.fx.anim.cancelAnimationFrame_()}};goog.fx.anim.tearDown=function(){goog.fx.anim.animationWindow_=null;goog.dispose(goog.fx.anim.animationDelay_);goog.fx.anim.animationDelay_=null;goog.fx.anim.activeAnimations_={}};goog.fx.anim.setAnimationWindow=function(b){var a=goog.fx.anim.animationDelay_&&goog.fx.anim.animationDelay_.isActive();goog.dispose(goog.fx.anim.animationDelay_);goog.fx.anim.animationDelay_=null;goog.fx.anim.animationWindow_=b;if(a){goog.fx.anim.requestAnimationFrame_()}};goog.fx.anim.requestAnimationFrame_=function(){if(!goog.fx.anim.animationDelay_){if(goog.fx.anim.animationWindow_){goog.fx.anim.animationDelay_=new goog.async.AnimationDelay(function(b){goog.fx.anim.cycleAnimations_(b)},goog.fx.anim.animationWindow_)}else{goog.fx.anim.animationDelay_=new goog.async.Delay(function(){goog.fx.anim.cycleAnimations_(goog.now())},goog.fx.anim.TIMEOUT)}}var a=goog.fx.anim.animationDelay_;if(!a.isActive()){a.start()}};goog.fx.anim.cancelAnimationFrame_=function(){if(goog.fx.anim.animationDelay_){goog.fx.anim.animationDelay_.stop()}};goog.fx.anim.cycleAnimations_=function(a){goog.object.forEach(goog.fx.anim.activeAnimations_,function(b){b.onAnimationFrame(a)});if(!goog.object.isEmpty(goog.fx.anim.activeAnimations_)){goog.fx.anim.requestAnimationFrame_()}};goog.provide("goog.fx.TransitionBase");goog.provide("goog.fx.TransitionBase.State");goog.require("goog.events.EventTarget");goog.require("goog.fx.Transition");goog.fx.TransitionBase=function(){goog.fx.TransitionBase.base(this,"constructor");this.state_=goog.fx.TransitionBase.State.STOPPED;this.startTime=null;this.endTime=null};goog.inherits(goog.fx.TransitionBase,goog.events.EventTarget);goog.fx.TransitionBase.State={STOPPED:0,PAUSED:-1,PLAYING:1};goog.fx.TransitionBase.prototype.play=goog.abstractMethod;goog.fx.TransitionBase.prototype.stop=goog.abstractMethod;goog.fx.TransitionBase.prototype.pause=goog.abstractMethod;goog.fx.TransitionBase.prototype.getStateInternal=function(){return this.state_};goog.fx.TransitionBase.prototype.setStatePlaying=function(){this.state_=goog.fx.TransitionBase.State.PLAYING};goog.fx.TransitionBase.prototype.setStatePaused=function(){this.state_=goog.fx.TransitionBase.State.PAUSED};goog.fx.TransitionBase.prototype.setStateStopped=function(){this.state_=goog.fx.TransitionBase.State.STOPPED};goog.fx.TransitionBase.prototype.isPlaying=function(){return this.state_==goog.fx.TransitionBase.State.PLAYING};goog.fx.TransitionBase.prototype.isPaused=function(){return this.state_==goog.fx.TransitionBase.State.PAUSED};goog.fx.TransitionBase.prototype.isStopped=function(){return this.state_==goog.fx.TransitionBase.State.STOPPED};goog.fx.TransitionBase.prototype.onBegin=function(){this.dispatchAnimationEvent(goog.fx.Transition.EventType.BEGIN)};goog.fx.TransitionBase.prototype.onEnd=function(){this.dispatchAnimationEvent(goog.fx.Transition.EventType.END)};goog.fx.TransitionBase.prototype.onFinish=function(){this.dispatchAnimationEvent(goog.fx.Transition.EventType.FINISH)};goog.fx.TransitionBase.prototype.onPause=function(){this.dispatchAnimationEvent(goog.fx.Transition.EventType.PAUSE)};goog.fx.TransitionBase.prototype.onPlay=function(){this.dispatchAnimationEvent(goog.fx.Transition.EventType.PLAY)};goog.fx.TransitionBase.prototype.onResume=function(){this.dispatchAnimationEvent(goog.fx.Transition.EventType.RESUME)};goog.fx.TransitionBase.prototype.onStop=function(){this.dispatchAnimationEvent(goog.fx.Transition.EventType.STOP)};goog.fx.TransitionBase.prototype.dispatchAnimationEvent=function(a){this.dispatchEvent(a)};goog.provide("goog.fx.Animation");goog.provide("goog.fx.Animation.EventType");goog.provide("goog.fx.Animation.State");goog.provide("goog.fx.AnimationEvent");goog.require("goog.array");goog.require("goog.events.Event");goog.require("goog.fx.Transition");goog.require("goog.fx.TransitionBase");goog.require("goog.fx.anim");goog.require("goog.fx.anim.Animated");goog.fx.Animation=function(d,a,c,b){goog.fx.Animation.base(this,"constructor");if(!goog.isArray(d)||!goog.isArray(a)){throw Error("Start and end parameters must be arrays")}if(d.length!=a.length){throw Error("Start and end points must be the same length")}this.startPoint=d;this.endPoint=a;this.duration=c;this.accel_=b;this.coords=[];this.useRightPositioningForRtl_=false;this.fps_=0;this.progress=0;this.lastFrame=null};goog.inherits(goog.fx.Animation,goog.fx.TransitionBase);goog.fx.Animation.prototype.enableRightPositioningForRtl=function(a){this.useRightPositioningForRtl_=a};goog.fx.Animation.prototype.isRightPositioningForRtlEnabled=function(){return this.useRightPositioningForRtl_};goog.fx.Animation.EventType={PLAY:goog.fx.Transition.EventType.PLAY,BEGIN:goog.fx.Transition.EventType.BEGIN,RESUME:goog.fx.Transition.EventType.RESUME,END:goog.fx.Transition.EventType.END,STOP:goog.fx.Transition.EventType.STOP,FINISH:goog.fx.Transition.EventType.FINISH,PAUSE:goog.fx.Transition.EventType.PAUSE,ANIMATE:"animate",DESTROY:"destroy"};goog.fx.Animation.TIMEOUT=goog.fx.anim.TIMEOUT;goog.fx.Animation.State=goog.fx.TransitionBase.State;goog.fx.Animation.setAnimationWindow=function(a){goog.fx.anim.setAnimationWindow(a)};goog.fx.Animation.prototype.play=function(b){if(b||this.isStopped()){this.progress=0;this.coords=this.startPoint}else{if(this.isPlaying()){return false}}goog.fx.anim.unregisterAnimation(this);var a=(goog.now());this.startTime=a;if(this.isPaused()){this.startTime-=this.duration*this.progress}this.endTime=this.startTime+this.duration;this.lastFrame=this.startTime;if(!this.progress){this.onBegin()}this.onPlay();if(this.isPaused()){this.onResume()}this.setStatePlaying();goog.fx.anim.registerAnimation(this);this.cycle(a);return true};goog.fx.Animation.prototype.stop=function(a){goog.fx.anim.unregisterAnimation(this);this.setStateStopped();if(!!a){this.progress=1}this.updateCoords_(this.progress);this.onStop();this.onEnd()};goog.fx.Animation.prototype.pause=function(){if(this.isPlaying()){goog.fx.anim.unregisterAnimation(this);this.setStatePaused();this.onPause()}};goog.fx.Animation.prototype.getProgress=function(){return this.progress};goog.fx.Animation.prototype.setProgress=function(b){this.progress=b;if(this.isPlaying()){var a=goog.now();this.startTime=a-this.duration*this.progress;this.endTime=this.startTime+this.duration}};goog.fx.Animation.prototype.disposeInternal=function(){if(!this.isStopped()){this.stop(false)}this.onDestroy();goog.fx.Animation.base(this,"disposeInternal")};goog.fx.Animation.prototype.destroy=function(){this.dispose()};goog.fx.Animation.prototype.onAnimationFrame=function(a){this.cycle(a)};goog.fx.Animation.prototype.cycle=function(a){this.progress=(a-this.startTime)/(this.endTime-this.startTime);if(this.progress>=1){this.progress=1}this.fps_=1000/(a-this.lastFrame);this.lastFrame=a;this.updateCoords_(this.progress);if(this.progress==1){this.setStateStopped();goog.fx.anim.unregisterAnimation(this);this.onFinish();this.onEnd()}else{if(this.isPlaying()){this.onAnimate()}}};goog.fx.Animation.prototype.updateCoords_=function(b){if(goog.isFunction(this.accel_)){b=this.accel_(b)}this.coords=new Array(this.startPoint.length);for(var a=0;a<this.startPoint.length;a++){this.coords[a]=(this.endPoint[a]-this.startPoint[a])*b+this.startPoint[a]}};goog.fx.Animation.prototype.onAnimate=function(){this.dispatchAnimationEvent(goog.fx.Animation.EventType.ANIMATE)};goog.fx.Animation.prototype.onDestroy=function(){this.dispatchAnimationEvent(goog.fx.Animation.EventType.DESTROY)};goog.fx.Animation.prototype.dispatchAnimationEvent=function(a){this.dispatchEvent(new goog.fx.AnimationEvent(a,this))};goog.fx.AnimationEvent=function(a,b){goog.fx.AnimationEvent.base(this,"constructor",a);this.coords=b.coords;this.x=b.coords[0];this.y=b.coords[1];this.z=b.coords[2];this.duration=b.duration;this.progress=b.getProgress();this.fps=b.fps_;this.state=b.getStateInternal();this.anim=b};goog.inherits(goog.fx.AnimationEvent,goog.events.Event);goog.fx.AnimationEvent.prototype.coordsAsInts=function(){return goog.array.map(this.coords,Math.round)};goog.provide("goog.color.names");goog.color.names={aliceblue:"#f0f8ff",antiquewhite:"#faebd7",aqua:"#00ffff",aquamarine:"#7fffd4",azure:"#f0ffff",beige:"#f5f5dc",bisque:"#ffe4c4",black:"#000000",blanchedalmond:"#ffebcd",blue:"#0000ff",blueviolet:"#8a2be2",brown:"#a52a2a",burlywood:"#deb887",cadetblue:"#5f9ea0",chartreuse:"#7fff00",chocolate:"#d2691e",coral:"#ff7f50",cornflowerblue:"#6495ed",cornsilk:"#fff8dc",crimson:"#dc143c",cyan:"#00ffff",darkblue:"#00008b",darkcyan:"#008b8b",darkgoldenrod:"#b8860b",darkgray:"#a9a9a9",darkgreen:"#006400",darkgrey:"#a9a9a9",darkkhaki:"#bdb76b",darkmagenta:"#8b008b",darkolivegreen:"#556b2f",darkorange:"#ff8c00",darkorchid:"#9932cc",darkred:"#8b0000",darksalmon:"#e9967a",darkseagreen:"#8fbc8f",darkslateblue:"#483d8b",darkslategray:"#2f4f4f",darkslategrey:"#2f4f4f",darkturquoise:"#00ced1",darkviolet:"#9400d3",deeppink:"#ff1493",deepskyblue:"#00bfff",dimgray:"#696969",dimgrey:"#696969",dodgerblue:"#1e90ff",firebrick:"#b22222",floralwhite:"#fffaf0",forestgreen:"#228b22",fuchsia:"#ff00ff",gainsboro:"#dcdcdc",ghostwhite:"#f8f8ff",gold:"#ffd700",goldenrod:"#daa520",gray:"#808080",green:"#008000",greenyellow:"#adff2f",grey:"#808080",honeydew:"#f0fff0",hotpink:"#ff69b4",indianred:"#cd5c5c",indigo:"#4b0082",ivory:"#fffff0",khaki:"#f0e68c",lavender:"#e6e6fa",lavenderblush:"#fff0f5",lawngreen:"#7cfc00",lemonchiffon:"#fffacd",lightblue:"#add8e6",lightcoral:"#f08080",lightcyan:"#e0ffff",lightgoldenrodyellow:"#fafad2",lightgray:"#d3d3d3",lightgreen:"#90ee90",lightgrey:"#d3d3d3",lightpink:"#ffb6c1",lightsalmon:"#ffa07a",lightseagreen:"#20b2aa",lightskyblue:"#87cefa",lightslategray:"#778899",lightslategrey:"#778899",lightsteelblue:"#b0c4de",lightyellow:"#ffffe0",lime:"#00ff00",limegreen:"#32cd32",linen:"#faf0e6",magenta:"#ff00ff",maroon:"#800000",mediumaquamarine:"#66cdaa",mediumblue:"#0000cd",mediumorchid:"#ba55d3",mediumpurple:"#9370db",mediumseagreen:"#3cb371",mediumslateblue:"#7b68ee",mediumspringgreen:"#00fa9a",mediumturquoise:"#48d1cc",mediumvioletred:"#c71585",midnightblue:"#191970",mintcream:"#f5fffa",mistyrose:"#ffe4e1",moccasin:"#ffe4b5",navajowhite:"#ffdead",navy:"#000080",oldlace:"#fdf5e6",olive:"#808000",olivedrab:"#6b8e23",orange:"#ffa500",orangered:"#ff4500",orchid:"#da70d6",palegoldenrod:"#eee8aa",palegreen:"#98fb98",paleturquoise:"#afeeee",palevioletred:"#db7093",papayawhip:"#ffefd5",peachpuff:"#ffdab9",peru:"#cd853f",pink:"#ffc0cb",plum:"#dda0dd",powderblue:"#b0e0e6",purple:"#800080",red:"#ff0000",rosybrown:"#bc8f8f",royalblue:"#4169e1",saddlebrown:"#8b4513",salmon:"#fa8072",sandybrown:"#f4a460",seagreen:"#2e8b57",seashell:"#fff5ee",sienna:"#a0522d",silver:"#c0c0c0",skyblue:"#87ceeb",slateblue:"#6a5acd",slategray:"#708090",slategrey:"#708090",snow:"#fffafa",springgreen:"#00ff7f",steelblue:"#4682b4",tan:"#d2b48c",teal:"#008080",thistle:"#d8bfd8",tomato:"#ff6347",turquoise:"#40e0d0",violet:"#ee82ee",wheat:"#f5deb3",white:"#ffffff",whitesmoke:"#f5f5f5",yellow:"#ffff00",yellowgreen:"#9acd32"};goog.provide("goog.color");goog.provide("goog.color.Hsl");goog.provide("goog.color.Hsv");goog.provide("goog.color.Rgb");goog.require("goog.color.names");goog.require("goog.math");goog.color.Rgb;goog.color.Hsv;goog.color.Hsl;goog.color.parse=function(e){var a={};e=String(e);var d=goog.color.prependHashIfNecessaryHelper(e);if(goog.color.isValidHexColor_(d)){a.hex=goog.color.normalizeHex(d);a.type="hex";return a}else{var b=goog.color.isValidRgbColor_(e);if(b.length){a.hex=goog.color.rgbArrayToHex(b);a.type="rgb";return a}else{if(goog.color.names){var c=goog.color.names[e.toLowerCase()];if(c){a.hex=c;a.type="named";return a}}}}throw Error(e+" is not a valid color string")};goog.color.isValidColor=function(b){var a=goog.color.prependHashIfNecessaryHelper(b);return !!(goog.color.isValidHexColor_(a)||goog.color.isValidRgbColor_(b).length||goog.color.names&&goog.color.names[b.toLowerCase()])};goog.color.parseRgb=function(b){var a=goog.color.isValidRgbColor_(b);if(!a.length){throw Error(b+" is not a valid RGB color")}return a};goog.color.hexToRgbStyle=function(a){return goog.color.rgbStyle_(goog.color.hexToRgb(a))};goog.color.hexTripletRe_=/#(.)(.)(.)/;goog.color.normalizeHex=function(a){if(!goog.color.isValidHexColor_(a)){throw Error("'"+a+"' is not a valid hex color")}if(a.length==4){a=a.replace(goog.color.hexTripletRe_,"#$1$1$2$2$3$3")}return a.toLowerCase()};goog.color.hexToRgb=function(c){c=goog.color.normalizeHex(c);var e=parseInt(c.substr(1,2),16);var d=parseInt(c.substr(3,2),16);var a=parseInt(c.substr(5,2),16);return[e,d,a]};goog.color.rgbToHex=function(f,e,a){f=Number(f);e=Number(e);a=Number(a);if(isNaN(f)||f<0||f>255||isNaN(e)||e<0||e>255||isNaN(a)||a<0||a>255){throw Error('"('+f+","+e+","+a+'") is not a valid RGB color')}var d=goog.color.prependZeroIfNecessaryHelper(f.toString(16));var c=goog.color.prependZeroIfNecessaryHelper(e.toString(16));var h=goog.color.prependZeroIfNecessaryHelper(a.toString(16));return"#"+d+c+h};goog.color.rgbArrayToHex=function(a){return goog.color.rgbToHex(a[0],a[1],a[2])};goog.color.rgbToHsl=function(a,j,k){var n=a/255;var c=j/255;var i=k/255;var m=Math.max(n,c,i);var e=Math.min(n,c,i);var f=0;var o=0;var d=0.5*(m+e);if(m!=e){if(m==n){f=60*(c-i)/(m-e)}else{if(m==c){f=60*(i-n)/(m-e)+120}else{if(m==i){f=60*(n-c)/(m-e)+240}}}if(0<d&&d<=0.5){o=(m-e)/(2*d)}else{o=(m-e)/(2-2*d)}}return[Math.round(f+360)%360,o,d]};goog.color.rgbArrayToHsl=function(a){return goog.color.rgbToHsl(a[0],a[1],a[2])};goog.color.hueToRgb_=function(c,b,a){if(a<0){a+=1}else{if(a>1){a-=1}}if((6*a)<1){return(c+(b-c)*6*a)}else{if(2*a<1){return b}else{if(3*a<2){return(c+(b-c)*((2/3)-a)*6)}}}return c};goog.color.hslToRgb=function(i,m,f){var a=0;var j=0;var k=0;var e=i/360;if(m==0){a=j=k=f*255}else{var d=0;var c=0;if(f<0.5){c=f*(1+m)}else{c=f+m-(m*f)}d=2*f-c;a=255*goog.color.hueToRgb_(d,c,e+(1/3));j=255*goog.color.hueToRgb_(d,c,e);k=255*goog.color.hueToRgb_(d,c,e-(1/3))}return[Math.round(a),Math.round(j),Math.round(k)]};goog.color.hslArrayToRgb=function(a){return goog.color.hslToRgb(a[0],a[1],a[2])};goog.color.validHexColorRe_=/^#(?:[0-9a-f]{3}){1,2}$/i;goog.color.isValidHexColor_=function(a){return goog.color.validHexColorRe_.test(a)};goog.color.normalizedHexColorRe_=/^#[0-9a-f]{6}$/;goog.color.isNormalizedHexColor_=function(a){return goog.color.normalizedHexColorRe_.test(a)};goog.color.rgbColorRe_=/^(?:rgb)?\((0|[1-9]\d{0,2}),\s?(0|[1-9]\d{0,2}),\s?(0|[1-9]\d{0,2})\)$/i;goog.color.isValidRgbColor_=function(f){var c=f.match(goog.color.rgbColorRe_);if(c){var e=Number(c[1]);var d=Number(c[2]);var a=Number(c[3]);if(e>=0&&e<=255&&d>=0&&d<=255&&a>=0&&a<=255){return[e,d,a]}}return[]};goog.color.prependZeroIfNecessaryHelper=function(a){return a.length==1?"0"+a:a};goog.color.prependHashIfNecessaryHelper=function(a){return a.charAt(0)=="#"?a:"#"+a};goog.color.rgbStyle_=function(a){return"rgb("+a.join(",")+")"};goog.color.hsvToRgb=function(d,l,i){var a=0;var b=0;var j=0;if(l==0){a=i;b=i;j=i}else{var c=Math.floor(d/60);var k=(d/60)-c;var g=i*(1-l);var f=i*(1-(l*k));var e=i*(1-(l*(1-k)));switch(c){case 1:a=f;b=i;j=g;break;case 2:a=g;b=i;j=e;break;case 3:a=g;b=f;j=i;break;case 4:a=e;b=g;j=i;break;case 5:a=i;b=g;j=f;break;case 6:case 0:a=i;b=e;j=g;break}}return[Math.floor(a),Math.floor(b),Math.floor(j)]};goog.color.rgbToHsv=function(a,b,h){var f=Math.max(Math.max(a,b),h);var c=Math.min(Math.min(a,b),h);var e;var d;var g=f;if(c==f){e=0;d=0}else{var i=(f-c);d=i/f;if(a==f){e=(b-h)/i}else{if(b==f){e=2+((h-a)/i)}else{e=4+((a-b)/i)}}e*=60;if(e<0){e+=360}if(e>360){e-=360}}return[e,d,g]};goog.color.rgbArrayToHsv=function(a){return goog.color.rgbToHsv(a[0],a[1],a[2])};goog.color.hsvArrayToRgb=function(a){return goog.color.hsvToRgb(a[0],a[1],a[2])};goog.color.hexToHsl=function(b){var a=goog.color.hexToRgb(b);return goog.color.rgbToHsl(a[0],a[1],a[2])};goog.color.hslToHex=function(c,b,a){return goog.color.rgbArrayToHex(goog.color.hslToRgb(c,b,a))};goog.color.hslArrayToHex=function(a){return goog.color.rgbArrayToHex(goog.color.hslToRgb(a[0],a[1],a[2]))};goog.color.hexToHsv=function(a){return goog.color.rgbArrayToHsv(goog.color.hexToRgb(a))};goog.color.hsvToHex=function(c,b,a){return goog.color.rgbArrayToHex(goog.color.hsvToRgb(c,b,a))};goog.color.hsvArrayToHex=function(a){return goog.color.hsvToHex(a[0],a[1],a[2])};goog.color.hslDistance=function(g,f){var c,a;if(g[2]<=0.5){c=g[1]*g[2]}else{c=g[1]*(1-g[2])}if(f[2]<=0.5){a=f[1]*f[2]}else{a=f[1]*(1-f[2])}var d=g[0]/360;var b=f[0]/360;var e=(d-b)*2*Math.PI;return(g[2]-f[2])*(g[2]-f[2])+c*c+a*a-2*c*a*Math.cos(e)};goog.color.blend=function(c,b,a){a=goog.math.clamp(a,0,1);return[Math.round(a*c[0]+(1-a)*b[0]),Math.round(a*c[1]+(1-a)*b[1]),Math.round(a*c[2]+(1-a)*b[2])]};goog.color.darken=function(a,b){var c=[0,0,0];return goog.color.blend(c,a,b)};goog.color.lighten=function(b,c){var a=[255,255,255];return goog.color.blend(a,b,c)};goog.color.highContrast=function(d,a){var c=[];for(var b=0;b<a.length;b++){c.push({color:a[b],diff:goog.color.yiqBrightnessDiff_(a[b],d)+goog.color.colorDiff_(a[b],d)})}c.sort(function(f,e){return e.diff-f.diff});return c[0].color};goog.color.yiqBrightness_=function(a){return Math.round((a[0]*299+a[1]*587+a[2]*114)/1000)};goog.color.yiqBrightnessDiff_=function(b,a){return Math.abs(goog.color.yiqBrightness_(b)-goog.color.yiqBrightness_(a))};goog.color.colorDiff_=function(b,a){return Math.abs(b[0]-a[0])+Math.abs(b[1]-a[1])+Math.abs(b[2]-a[2])};goog.provide("goog.fx.dom");goog.provide("goog.fx.dom.BgColorTransform");goog.provide("goog.fx.dom.ColorTransform");goog.provide("goog.fx.dom.Fade");goog.provide("goog.fx.dom.FadeIn");goog.provide("goog.fx.dom.FadeInAndShow");goog.provide("goog.fx.dom.FadeOut");goog.provide("goog.fx.dom.FadeOutAndHide");goog.provide("goog.fx.dom.PredefinedEffect");goog.provide("goog.fx.dom.Resize");goog.provide("goog.fx.dom.ResizeHeight");goog.provide("goog.fx.dom.ResizeWidth");goog.provide("goog.fx.dom.Scroll");goog.provide("goog.fx.dom.Slide");goog.provide("goog.fx.dom.SlideFrom");goog.provide("goog.fx.dom.Swipe");goog.require("goog.color");goog.require("goog.events");goog.require("goog.fx.Animation");goog.require("goog.fx.Transition");goog.require("goog.style");goog.require("goog.style.bidi");goog.fx.dom.PredefinedEffect=function(b,e,a,d,c){goog.fx.Animation.call(this,e,a,d,c);this.element=b;this.rightToLeft_};goog.inherits(goog.fx.dom.PredefinedEffect,goog.fx.Animation);goog.fx.dom.PredefinedEffect.prototype.updateStyle=goog.nullFunction;goog.fx.dom.PredefinedEffect.prototype.isRightToLeft=function(){if(!goog.isDef(this.rightToLeft_)){this.rightToLeft_=goog.style.isRightToLeft(this.element)}return this.rightToLeft_};goog.fx.dom.PredefinedEffect.prototype.onAnimate=function(){this.updateStyle();goog.fx.dom.PredefinedEffect.superClass_.onAnimate.call(this)};goog.fx.dom.PredefinedEffect.prototype.onEnd=function(){this.updateStyle();goog.fx.dom.PredefinedEffect.superClass_.onEnd.call(this)};goog.fx.dom.PredefinedEffect.prototype.onBegin=function(){this.updateStyle();goog.fx.dom.PredefinedEffect.superClass_.onBegin.call(this)};goog.fx.dom.Slide=function(b,e,a,d,c){if(e.length!=2||a.length!=2){throw Error("Start and end points must be 2D")}goog.fx.dom.PredefinedEffect.apply(this,arguments)};goog.inherits(goog.fx.dom.Slide,goog.fx.dom.PredefinedEffect);goog.fx.dom.Slide.prototype.updateStyle=function(){var a=(this.isRightPositioningForRtlEnabled()&&this.isRightToLeft())?"right":"left";this.element.style[a]=Math.round(this.coords[0])+"px";this.element.style.top=Math.round(this.coords[1])+"px"};goog.fx.dom.SlideFrom=function(b,a,e,c){var d=this.isRightPositioningForRtlEnabled()?goog.style.bidi.getOffsetStart(b):b.offsetLeft;var f=[d,b.offsetTop];goog.fx.dom.Slide.call(this,b,f,a,e,c)};goog.inherits(goog.fx.dom.SlideFrom,goog.fx.dom.Slide);goog.fx.dom.SlideFrom.prototype.onBegin=function(){var a=this.isRightPositioningForRtlEnabled()?goog.style.bidi.getOffsetStart(this.element):this.element.offsetLeft;this.startPoint=[a,this.element.offsetTop];goog.fx.dom.SlideFrom.superClass_.onBegin.call(this)};goog.fx.dom.Swipe=function(b,e,a,d,c){if(e.length!=2||a.length!=2){throw Error("Start and end points must be 2D")}goog.fx.dom.PredefinedEffect.apply(this,arguments);this.maxWidth_=Math.max(this.endPoint[0],this.startPoint[0]);this.maxHeight_=Math.max(this.endPoint[1],this.startPoint[1])};goog.inherits(goog.fx.dom.Swipe,goog.fx.dom.PredefinedEffect);goog.fx.dom.Swipe.prototype.updateStyle=function(){var a=this.coords[0];var c=this.coords[1];this.clip_(Math.round(a),Math.round(c),this.maxWidth_,this.maxHeight_);this.element.style.width=Math.round(a)+"px";var b=(this.isRightPositioningForRtlEnabled()&&this.isRightToLeft())?"marginRight":"marginLeft";this.element.style[b]=Math.round(a)-this.maxWidth_+"px";this.element.style.marginTop=Math.round(c)-this.maxHeight_+"px"};goog.fx.dom.Swipe.prototype.clip_=function(a,d,b,c){this.element.style.clip="rect("+(c-d)+"px "+b+"px "+c+"px "+(b-a)+"px)"};goog.fx.dom.Scroll=function(b,e,a,d,c){if(e.length!=2||a.length!=2){throw Error("Start and end points must be 2D")}goog.fx.dom.PredefinedEffect.apply(this,arguments)};goog.inherits(goog.fx.dom.Scroll,goog.fx.dom.PredefinedEffect);goog.fx.dom.Scroll.prototype.updateStyle=function(){if(this.isRightPositioningForRtlEnabled()){goog.style.bidi.setScrollOffset(this.element,Math.round(this.coords[0]))}else{this.element.scrollLeft=Math.round(this.coords[0])}this.element.scrollTop=Math.round(this.coords[1])};goog.fx.dom.Resize=function(b,e,a,d,c){if(e.length!=2||a.length!=2){throw Error("Start and end points must be 2D")}goog.fx.dom.PredefinedEffect.apply(this,arguments)};goog.inherits(goog.fx.dom.Resize,goog.fx.dom.PredefinedEffect);goog.fx.dom.Resize.prototype.updateStyle=function(){this.element.style.width=Math.round(this.coords[0])+"px";this.element.style.height=Math.round(this.coords[1])+"px"};goog.fx.dom.ResizeWidth=function(b,e,a,d,c){goog.fx.dom.PredefinedEffect.call(this,b,[e],[a],d,c)};goog.inherits(goog.fx.dom.ResizeWidth,goog.fx.dom.PredefinedEffect);goog.fx.dom.ResizeWidth.prototype.updateStyle=function(){this.element.style.width=Math.round(this.coords[0])+"px"};goog.fx.dom.ResizeHeight=function(b,e,a,d,c){goog.fx.dom.PredefinedEffect.call(this,b,[e],[a],d,c)};goog.inherits(goog.fx.dom.ResizeHeight,goog.fx.dom.PredefinedEffect);goog.fx.dom.ResizeHeight.prototype.updateStyle=function(){this.element.style.height=Math.round(this.coords[0])+"px"};goog.fx.dom.Fade=function(b,e,a,d,c){if(goog.isNumber(e)){e=[e]}if(goog.isNumber(a)){a=[a]}goog.fx.dom.Fade.base(this,"constructor",b,e,a,d,c);if(e.length!=1||a.length!=1){throw Error("Start and end points must be 1D")}this.lastOpacityUpdate_=goog.fx.dom.Fade.OPACITY_UNSET_};goog.inherits(goog.fx.dom.Fade,goog.fx.dom.PredefinedEffect);goog.fx.dom.Fade.TOLERANCE_=1/1024;goog.fx.dom.Fade.OPACITY_UNSET_=-1;goog.fx.dom.Fade.prototype.updateStyle=function(){var a=this.coords[0];var b=Math.abs(a-this.lastOpacityUpdate_);if(b>=goog.fx.dom.Fade.TOLERANCE_){goog.style.setOpacity(this.element,a);this.lastOpacityUpdate_=a}};goog.fx.dom.Fade.prototype.onBegin=function(){this.lastOpacityUpdate_=goog.fx.dom.Fade.OPACITY_UNSET_;goog.fx.dom.Fade.base(this,"onBegin")};goog.fx.dom.Fade.prototype.onEnd=function(){this.lastOpacityUpdate_=goog.fx.dom.Fade.OPACITY_UNSET_;goog.fx.dom.Fade.base(this,"onEnd")};goog.fx.dom.Fade.prototype.show=function(){this.element.style.display=""};goog.fx.dom.Fade.prototype.hide=function(){this.element.style.display="none"};goog.fx.dom.FadeOut=function(a,c,b){goog.fx.dom.Fade.call(this,a,1,0,c,b)};goog.inherits(goog.fx.dom.FadeOut,goog.fx.dom.Fade);goog.fx.dom.FadeIn=function(a,c,b){goog.fx.dom.Fade.call(this,a,0,1,c,b)};goog.inherits(goog.fx.dom.FadeIn,goog.fx.dom.Fade);goog.fx.dom.FadeOutAndHide=function(a,c,b){goog.fx.dom.Fade.call(this,a,1,0,c,b)};goog.inherits(goog.fx.dom.FadeOutAndHide,goog.fx.dom.Fade);goog.fx.dom.FadeOutAndHide.prototype.onBegin=function(){this.show();goog.fx.dom.FadeOutAndHide.superClass_.onBegin.call(this)};goog.fx.dom.FadeOutAndHide.prototype.onEnd=function(){this.hide();goog.fx.dom.FadeOutAndHide.superClass_.onEnd.call(this)};goog.fx.dom.FadeInAndShow=function(a,c,b){goog.fx.dom.Fade.call(this,a,0,1,c,b)};goog.inherits(goog.fx.dom.FadeInAndShow,goog.fx.dom.Fade);goog.fx.dom.FadeInAndShow.prototype.onBegin=function(){this.show();goog.fx.dom.FadeInAndShow.superClass_.onBegin.call(this)};goog.fx.dom.BgColorTransform=function(b,e,a,d,c){if(e.length!=3||a.length!=3){throw Error("Start and end points must be 3D")}goog.fx.dom.PredefinedEffect.apply(this,arguments)};goog.inherits(goog.fx.dom.BgColorTransform,goog.fx.dom.PredefinedEffect);goog.fx.dom.BgColorTransform.prototype.setColor=function(){var c=[];for(var b=0;b<this.coords.length;b++){c[b]=Math.round(this.coords[b])}var a="rgb("+c.join(",")+")";this.element.style.backgroundColor=a};goog.fx.dom.BgColorTransform.prototype.updateStyle=function(){this.setColor()};goog.fx.dom.bgColorFadeIn=function(g,b,d,h){var c=g.style.backgroundColor||"";var a=goog.style.getBackgroundColor(g);var f;if(a&&a!="transparent"&&a!="rgba(0, 0, 0, 0)"){f=goog.color.hexToRgb(goog.color.parse(a).hex)}else{f=[255,255,255]}var e=new goog.fx.dom.BgColorTransform(g,b,f,d);function i(){g.style.backgroundColor=c}if(h){h.listen(e,goog.fx.Transition.EventType.END,i)}else{goog.events.listen(e,goog.fx.Transition.EventType.END,i)}e.play()};goog.fx.dom.ColorTransform=function(b,e,a,d,c){if(e.length!=3||a.length!=3){throw Error("Start and end points must be 3D")}goog.fx.dom.PredefinedEffect.apply(this,arguments)};goog.inherits(goog.fx.dom.ColorTransform,goog.fx.dom.PredefinedEffect);goog.fx.dom.ColorTransform.prototype.updateStyle=function(){var c=[];for(var b=0;b<this.coords.length;b++){c[b]=Math.round(this.coords[b])}var a="rgb("+c.join(",")+")";this.element.style.color=a};goog.provide("goog.fx.AnimationParallelQueue");goog.provide("goog.fx.AnimationQueue");goog.provide("goog.fx.AnimationSerialQueue");goog.require("goog.array");goog.require("goog.asserts");goog.require("goog.events");goog.require("goog.fx.Transition");goog.require("goog.fx.TransitionBase");goog.fx.AnimationQueue=function(){goog.fx.AnimationQueue.base(this,"constructor");this.queue=[]};goog.inherits(goog.fx.AnimationQueue,goog.fx.TransitionBase);goog.fx.AnimationQueue.prototype.add=function(a){goog.asserts.assert(this.isStopped(),"Not allowed to add animations to a running animation queue.");if(goog.array.contains(this.queue,a)){return}this.queue.push(a);goog.events.listen(a,goog.fx.Transition.EventType.FINISH,this.onAnimationFinish,false,this)};goog.fx.AnimationQueue.prototype.remove=function(a){goog.asserts.assert(this.isStopped(),"Not allowed to remove animations from a running animation queue.");if(goog.array.remove(this.queue,a)){goog.events.unlisten(a,goog.fx.Transition.EventType.FINISH,this.onAnimationFinish,false,this)}};goog.fx.AnimationQueue.prototype.onAnimationFinish=goog.abstractMethod;goog.fx.AnimationQueue.prototype.disposeInternal=function(){goog.array.forEach(this.queue,function(a){a.dispose()});this.queue.length=0;goog.fx.AnimationQueue.base(this,"disposeInternal")};goog.fx.AnimationParallelQueue=function(){goog.fx.AnimationParallelQueue.base(this,"constructor");this.finishedCounter_=0};goog.inherits(goog.fx.AnimationParallelQueue,goog.fx.AnimationQueue);goog.fx.AnimationParallelQueue.prototype.play=function(b){if(this.queue.length==0){return false}if(b||this.isStopped()){this.finishedCounter_=0;this.onBegin()}else{if(this.isPlaying()){return false}}this.onPlay();if(this.isPaused()){this.onResume()}var a=this.isPaused()&&!b;this.startTime=goog.now();this.endTime=null;this.setStatePlaying();goog.array.forEach(this.queue,function(c){if(!a||c.isPaused()){c.play(b)}});return true};goog.fx.AnimationParallelQueue.prototype.pause=function(){if(this.isPlaying()){goog.array.forEach(this.queue,function(a){if(a.isPlaying()){a.pause()}});this.setStatePaused();this.onPause()}};goog.fx.AnimationParallelQueue.prototype.stop=function(a){goog.array.forEach(this.queue,function(b){if(!b.isStopped()){b.stop(a)}});this.setStateStopped();this.endTime=goog.now();this.onStop();this.onEnd()};goog.fx.AnimationParallelQueue.prototype.onAnimationFinish=function(a){this.finishedCounter_++;if(this.finishedCounter_==this.queue.length){this.endTime=goog.now();this.setStateStopped();this.onFinish();this.onEnd()}};goog.fx.AnimationSerialQueue=function(){goog.fx.AnimationSerialQueue.base(this,"constructor");this.current_=0};goog.inherits(goog.fx.AnimationSerialQueue,goog.fx.AnimationQueue);goog.fx.AnimationSerialQueue.prototype.play=function(a){if(this.queue.length==0){return false}if(a||this.isStopped()){if(this.current_<this.queue.length&&!this.queue[this.current_].isStopped()){this.queue[this.current_].stop(false)}this.current_=0;this.onBegin()}else{if(this.isPlaying()){return false}}this.onPlay();if(this.isPaused()){this.onResume()}this.startTime=goog.now();this.endTime=null;this.setStatePlaying();this.queue[this.current_].play(a);return true};goog.fx.AnimationSerialQueue.prototype.pause=function(){if(this.isPlaying()){this.queue[this.current_].pause();this.setStatePaused();this.onPause()}};goog.fx.AnimationSerialQueue.prototype.stop=function(c){this.setStateStopped();this.endTime=goog.now();if(c){for(var a=this.current_;a<this.queue.length;++a){var b=this.queue[a];if(b.isStopped()){b.play()}if(!b.isStopped()){b.stop(true)}}}else{if(this.current_<this.queue.length){this.queue[this.current_].stop(false)}}this.onStop();this.onEnd()};goog.fx.AnimationSerialQueue.prototype.onAnimationFinish=function(a){if(this.isPlaying()){this.current_++;if(this.current_<this.queue.length){this.queue[this.current_].play()}else{this.endTime=goog.now();this.setStateStopped();this.onFinish();this.onEnd()}}};goog.provide("goog.events.MouseWheelEvent");goog.provide("goog.events.MouseWheelHandler");goog.provide("goog.events.MouseWheelHandler.EventType");goog.require("goog.dom");goog.require("goog.events");goog.require("goog.events.BrowserEvent");goog.require("goog.events.EventTarget");goog.require("goog.math");goog.require("goog.style");goog.require("goog.userAgent");goog.events.MouseWheelHandler=function(a,c){goog.events.EventTarget.call(this);this.element_=a;var d=goog.dom.isElement(this.element_)?(this.element_):(this.element_?(this.element_).body:null);this.isRtl_=!!d&&goog.style.isRightToLeft(d);var b=goog.userAgent.GECKO?"DOMMouseScroll":"mousewheel";this.listenKey_=goog.events.listen(this.element_,b,this,c)};goog.inherits(goog.events.MouseWheelHandler,goog.events.EventTarget);goog.events.MouseWheelHandler.EventType={MOUSEWHEEL:"mousewheel"};goog.events.MouseWheelHandler.prototype.maxDeltaX_;goog.events.MouseWheelHandler.prototype.maxDeltaY_;goog.events.MouseWheelHandler.prototype.setMaxDeltaX=function(a){this.maxDeltaX_=a};goog.events.MouseWheelHandler.prototype.setMaxDeltaY=function(a){this.maxDeltaY_=a};goog.events.MouseWheelHandler.prototype.handleEvent=function(h){var b=0;var a=0;var d=0;var f=h.getBrowserEvent();if(f.type=="mousewheel"){var c=1;if(goog.userAgent.IE||goog.userAgent.WEBKIT&&(goog.userAgent.WINDOWS||goog.userAgent.isVersionOrHigher("532.0"))){c=40}d=goog.events.MouseWheelHandler.smartScale_(-f.wheelDelta,c);if(goog.isDef(f.wheelDeltaX)){b=goog.events.MouseWheelHandler.smartScale_(-f.wheelDeltaX,c);a=goog.events.MouseWheelHandler.smartScale_(-f.wheelDeltaY,c)}else{a=d}}else{d=f.detail;if(d>100){d=3}else{if(d<-100){d=-3}}if(goog.isDef(f.axis)&&f.axis===f.HORIZONTAL_AXIS){b=d}else{a=d}}if(goog.isNumber(this.maxDeltaX_)){b=goog.math.clamp(b,-this.maxDeltaX_,this.maxDeltaX_)}if(goog.isNumber(this.maxDeltaY_)){a=goog.math.clamp(a,-this.maxDeltaY_,this.maxDeltaY_)}if(this.isRtl_){b=-b}var g=new goog.events.MouseWheelEvent(d,f,b,a);this.dispatchEvent(g)};goog.events.MouseWheelHandler.smartScale_=function(a,b){if(goog.userAgent.WEBKIT&&(goog.userAgent.MAC||goog.userAgent.LINUX)&&(a%b)!=0){return a}else{return a/b}};goog.events.MouseWheelHandler.prototype.disposeInternal=function(){goog.events.MouseWheelHandler.superClass_.disposeInternal.call(this);goog.events.unlistenByKey(this.listenKey_);this.listenKey_=null};goog.events.MouseWheelEvent=function(c,d,b,a){goog.events.BrowserEvent.call(this,d);this.type=goog.events.MouseWheelHandler.EventType.MOUSEWHEEL;this.detail=c;this.deltaX=b;this.deltaY=a};goog.inherits(goog.events.MouseWheelEvent,goog.events.BrowserEvent);goog.provide("goog.ui.SliderBase");goog.provide("goog.ui.SliderBase.AnimationFactory");goog.provide("goog.ui.SliderBase.Orientation");goog.require("goog.Timer");goog.require("goog.a11y.aria");goog.require("goog.a11y.aria.Role");goog.require("goog.a11y.aria.State");goog.require("goog.array");goog.require("goog.asserts");goog.require("goog.dom");goog.require("goog.dom.classlist");goog.require("goog.events");goog.require("goog.events.EventType");goog.require("goog.events.KeyCodes");goog.require("goog.events.KeyHandler");goog.require("goog.events.MouseWheelHandler");goog.require("goog.functions");goog.require("goog.fx.AnimationParallelQueue");goog.require("goog.fx.Dragger");goog.require("goog.fx.Transition");goog.require("goog.fx.dom.ResizeHeight");goog.require("goog.fx.dom.ResizeWidth");goog.require("goog.fx.dom.Slide");goog.require("goog.math");goog.require("goog.math.Coordinate");goog.require("goog.style");goog.require("goog.style.bidi");goog.require("goog.ui.Component");goog.require("goog.ui.RangeModel");goog.ui.SliderBase=function(a,b){goog.ui.Component.call(this,a);this.additionalAnimations_=null;this.rangeModel=new goog.ui.RangeModel;this.labelFn_=b||goog.functions.NULL;goog.events.listen(this.rangeModel,goog.ui.Component.EventType.CHANGE,this.handleRangeModelChange,false,this)};goog.inherits(goog.ui.SliderBase,goog.ui.Component);goog.tagUnsealableClass(goog.ui.SliderBase);goog.ui.SliderBase.EventType={DRAG_VALUE_START:goog.events.getUniqueId("dragvaluestart"),DRAG_VALUE_END:goog.events.getUniqueId("dragvalueend"),DRAG_EXTENT_START:goog.events.getUniqueId("dragextentstart"),DRAG_EXTENT_END:goog.events.getUniqueId("dragextentend"),DRAG_START:goog.events.getUniqueId("dragstart"),DRAG_END:goog.events.getUniqueId("dragend")};goog.ui.SliderBase.Orientation={VERTICAL:"vertical",HORIZONTAL:"horizontal"};goog.ui.SliderBase.prototype.orientation_=goog.ui.SliderBase.Orientation.HORIZONTAL;goog.ui.SliderBase.prototype.currentAnimation_;goog.ui.SliderBase.prototype.incTimer_;goog.ui.SliderBase.prototype.incrementing_;goog.ui.SliderBase.prototype.lastMousePosition_;goog.ui.SliderBase.MOUSE_DOWN_INCREMENT_INTERVAL_=200;goog.ui.SliderBase.ANIMATION_INTERVAL_=100;goog.ui.SliderBase.prototype.rangeModel;goog.ui.SliderBase.prototype.valueThumb;goog.ui.SliderBase.prototype.extentThumb;goog.ui.SliderBase.prototype.rangeHighlight;goog.ui.SliderBase.prototype.thumbToMove_;goog.ui.SliderBase.prototype.keyHandler_;goog.ui.SliderBase.prototype.mouseWheelHandler_;goog.ui.SliderBase.prototype.valueDragger_;goog.ui.SliderBase.prototype.extentDragger_;goog.ui.SliderBase.prototype.isAnimating_=false;goog.ui.SliderBase.prototype.moveToPointEnabled_=false;goog.ui.SliderBase.prototype.blockIncrement_=10;goog.ui.SliderBase.prototype.minExtent_=0;goog.ui.SliderBase.prototype.isHandleMouseWheel_=true;goog.ui.SliderBase.prototype.mouseDownTime_=0;goog.ui.SliderBase.prototype.MOUSE_DOWN_DELAY_=1000;goog.ui.SliderBase.prototype.enabled_=true;goog.ui.SliderBase.prototype.flipForRtl_=false;goog.ui.SliderBase.prototype.enableFlipForRtl=function(a){this.flipForRtl_=a};goog.ui.SliderBase.prototype.getCssClass=goog.abstractMethod;goog.ui.SliderBase.prototype.createDom=function(){goog.ui.SliderBase.superClass_.createDom.call(this);var a=this.getDomHelper().createDom("div",this.getCssClass(this.orientation_));this.decorateInternal(a)};goog.ui.SliderBase.prototype.createThumbs=goog.abstractMethod;goog.ui.SliderBase.SLIDER_DRAGGING_CSS_CLASS_=goog.getCssName("goog-slider-dragging");goog.ui.SliderBase.THUMB_DRAGGING_CSS_CLASS_=goog.getCssName("goog-slider-thumb-dragging");goog.ui.SliderBase.DISABLED_CSS_CLASS_=goog.getCssName("goog-slider-disabled");goog.ui.SliderBase.prototype.decorateInternal=function(a){goog.ui.SliderBase.superClass_.decorateInternal.call(this,a);goog.asserts.assert(a);goog.dom.classlist.add(a,this.getCssClass(this.orientation_));this.createThumbs();this.setAriaRoles()};goog.ui.SliderBase.prototype.enterDocument=function(){goog.ui.SliderBase.superClass_.enterDocument.call(this);this.valueDragger_=new goog.fx.Dragger(this.valueThumb);this.extentDragger_=new goog.fx.Dragger(this.extentThumb);this.valueDragger_.enableRightPositioningForRtl(this.flipForRtl_);this.extentDragger_.enableRightPositioningForRtl(this.flipForRtl_);this.valueDragger_.defaultAction=this.extentDragger_.defaultAction=goog.nullFunction;this.keyHandler_=new goog.events.KeyHandler(this.getElement());this.enableEventHandlers_(true);this.getElement().tabIndex=0;this.updateUi_()};goog.ui.SliderBase.prototype.enableEventHandlers_=function(a){if(a){this.getHandler().listen(this.valueDragger_,goog.fx.Dragger.EventType.BEFOREDRAG,this.handleBeforeDrag_).listen(this.extentDragger_,goog.fx.Dragger.EventType.BEFOREDRAG,this.handleBeforeDrag_).listen(this.valueDragger_,[goog.fx.Dragger.EventType.START,goog.fx.Dragger.EventType.END],this.handleThumbDragStartEnd_).listen(this.extentDragger_,[goog.fx.Dragger.EventType.START,goog.fx.Dragger.EventType.END],this.handleThumbDragStartEnd_).listen(this.keyHandler_,goog.events.KeyHandler.EventType.KEY,this.handleKeyDown_).listen(this.getElement(),goog.events.EventType.CLICK,this.handleMouseDownAndClick_).listen(this.getElement(),goog.events.EventType.MOUSEDOWN,this.handleMouseDownAndClick_);if(this.isHandleMouseWheel()){this.enableMouseWheelHandling_(true)}}else{this.getHandler().unlisten(this.valueDragger_,goog.fx.Dragger.EventType.BEFOREDRAG,this.handleBeforeDrag_).unlisten(this.extentDragger_,goog.fx.Dragger.EventType.BEFOREDRAG,this.handleBeforeDrag_).unlisten(this.valueDragger_,[goog.fx.Dragger.EventType.START,goog.fx.Dragger.EventType.END],this.handleThumbDragStartEnd_).unlisten(this.extentDragger_,[goog.fx.Dragger.EventType.START,goog.fx.Dragger.EventType.END],this.handleThumbDragStartEnd_).unlisten(this.keyHandler_,goog.events.KeyHandler.EventType.KEY,this.handleKeyDown_).unlisten(this.getElement(),goog.events.EventType.CLICK,this.handleMouseDownAndClick_).unlisten(this.getElement(),goog.events.EventType.MOUSEDOWN,this.handleMouseDownAndClick_);if(this.isHandleMouseWheel()){this.enableMouseWheelHandling_(false)}}};goog.ui.SliderBase.prototype.exitDocument=function(){goog.ui.SliderBase.base(this,"exitDocument");goog.disposeAll(this.valueDragger_,this.extentDragger_,this.keyHandler_,this.mouseWheelHandler_)};goog.ui.SliderBase.prototype.handleBeforeDrag_=function(d){var b=d.dragger==this.valueDragger_?this.valueThumb:this.extentThumb;var c;if(this.orientation_==goog.ui.SliderBase.Orientation.VERTICAL){var a=this.getElement().clientHeight-b.offsetHeight;c=(a-d.top)/a*(this.getMaximum()-this.getMinimum())+this.getMinimum()}else{var f=this.getElement().clientWidth-b.offsetWidth;c=(d.left/f)*(this.getMaximum()-this.getMinimum())+this.getMinimum()}if(d.dragger==this.valueDragger_){c=Math.min(Math.max(c,this.getMinimum()),this.getValue()+this.getExtent())}else{c=Math.min(Math.max(c,this.getValue()),this.getMaximum())}this.setThumbPosition_(b,c)};goog.ui.SliderBase.prototype.handleThumbDragStartEnd_=function(c){var b=c.type==goog.fx.Dragger.EventType.START;goog.dom.classlist.enable(goog.asserts.assertElement(this.getElement()),goog.ui.SliderBase.SLIDER_DRAGGING_CSS_CLASS_,b);goog.dom.classlist.enable(goog.asserts.assertElement(c.target.handle),goog.ui.SliderBase.THUMB_DRAGGING_CSS_CLASS_,b);var a=c.dragger==this.valueDragger_;if(b){this.dispatchEvent(goog.ui.SliderBase.EventType.DRAG_START);this.dispatchEvent(a?goog.ui.SliderBase.EventType.DRAG_VALUE_START:goog.ui.SliderBase.EventType.DRAG_EXTENT_START)}else{this.dispatchEvent(goog.ui.SliderBase.EventType.DRAG_END);this.dispatchEvent(a?goog.ui.SliderBase.EventType.DRAG_VALUE_END:goog.ui.SliderBase.EventType.DRAG_EXTENT_END)}};goog.ui.SliderBase.prototype.handleKeyDown_=function(c){var b=true;switch(c.keyCode){case goog.events.KeyCodes.HOME:this.animatedSetValue(this.getMinimum());break;case goog.events.KeyCodes.END:this.animatedSetValue(this.getMaximum());break;case goog.events.KeyCodes.PAGE_UP:this.moveThumbs(this.getBlockIncrement());break;case goog.events.KeyCodes.PAGE_DOWN:this.moveThumbs(-this.getBlockIncrement());break;case goog.events.KeyCodes.LEFT:var a=this.flipForRtl_&&this.isRightToLeft()?1:-1;this.moveThumbs(c.shiftKey?a*this.getBlockIncrement():a*this.getUnitIncrement());break;case goog.events.KeyCodes.DOWN:this.moveThumbs(c.shiftKey?-this.getBlockIncrement():-this.getUnitIncrement());break;case goog.events.KeyCodes.RIGHT:var a=this.flipForRtl_&&this.isRightToLeft()?-1:1;this.moveThumbs(c.shiftKey?a*this.getBlockIncrement():a*this.getUnitIncrement());break;case goog.events.KeyCodes.UP:this.moveThumbs(c.shiftKey?this.getBlockIncrement():this.getUnitIncrement());break;default:b=false}if(b){c.preventDefault()}};goog.ui.SliderBase.prototype.handleMouseDownAndClick_=function(c){if(this.getElement().focus){this.getElement().focus()}var b=(c.target);if(!goog.dom.contains(this.valueThumb,b)&&!goog.dom.contains(this.extentThumb,b)){var a=c.type==goog.events.EventType.CLICK;if(a&&goog.now()<this.mouseDownTime_+this.MOUSE_DOWN_DELAY_){return}if(!a){this.mouseDownTime_=goog.now()}if(this.moveToPointEnabled_){this.animatedSetValue(this.getValueFromMousePosition(c))}else{this.startBlockIncrementing_(c)}}};goog.ui.SliderBase.prototype.handleMouseWheel_=function(b){var a=b.detail>0?-1:1;this.moveThumbs(a*this.getUnitIncrement());b.preventDefault()};goog.ui.SliderBase.prototype.startBlockIncrementing_=function(b){this.storeMousePos_(b);this.thumbToMove_=this.getClosestThumb_(this.getValueFromMousePosition(b));if(this.orientation_==goog.ui.SliderBase.Orientation.VERTICAL){this.incrementing_=this.lastMousePosition_<this.thumbToMove_.offsetTop}else{this.incrementing_=this.lastMousePosition_>this.getOffsetStart_(this.thumbToMove_)+this.thumbToMove_.offsetWidth}var a=goog.dom.getOwnerDocument(this.getElement());this.getHandler().listen(a,goog.events.EventType.MOUSEUP,this.stopBlockIncrementing_,true).listen(this.getElement(),goog.events.EventType.MOUSEMOVE,this.storeMousePos_);if(!this.incTimer_){this.incTimer_=new goog.Timer(goog.ui.SliderBase.MOUSE_DOWN_INCREMENT_INTERVAL_);this.getHandler().listen(this.incTimer_,goog.Timer.TICK,this.handleTimerTick_)}this.handleTimerTick_();this.incTimer_.start()};goog.ui.SliderBase.prototype.handleTimerTick_=function(){var g;if(this.orientation_==goog.ui.SliderBase.Orientation.VERTICAL){var b=this.lastMousePosition_;var d=this.thumbToMove_.offsetTop;if(this.incrementing_){if(b<d){g=this.getThumbPosition_(this.thumbToMove_)+this.getBlockIncrement()}}else{var a=this.thumbToMove_.offsetHeight;if(b>d+a){g=this.getThumbPosition_(this.thumbToMove_)-this.getBlockIncrement()}}}else{var c=this.lastMousePosition_;var e=this.getOffsetStart_(this.thumbToMove_);if(this.incrementing_){var f=this.thumbToMove_.offsetWidth;if(c>e+f){g=this.getThumbPosition_(this.thumbToMove_)+this.getBlockIncrement()}}else{if(c<e){g=this.getThumbPosition_(this.thumbToMove_)-this.getBlockIncrement()}}}if(goog.isDef(g)){this.setThumbPosition_(this.thumbToMove_,g)}};goog.ui.SliderBase.prototype.stopBlockIncrementing_=function(){if(this.incTimer_){this.incTimer_.stop()}var a=goog.dom.getOwnerDocument(this.getElement());this.getHandler().unlisten(a,goog.events.EventType.MOUSEUP,this.stopBlockIncrementing_,true).unlisten(this.getElement(),goog.events.EventType.MOUSEMOVE,this.storeMousePos_)};goog.ui.SliderBase.prototype.getRelativeMousePos_=function(a){var b=goog.style.getRelativePosition(a,this.getElement());if(this.orientation_==goog.ui.SliderBase.Orientation.VERTICAL){return b.y}else{if(this.flipForRtl_&&this.isRightToLeft()){return this.getElement().clientWidth-b.x}else{return b.x}}};goog.ui.SliderBase.prototype.storeMousePos_=function(a){this.lastMousePosition_=this.getRelativeMousePos_(a)};goog.ui.SliderBase.prototype.getValueFromMousePosition=function(d){var b=this.getMinimum();var h=this.getMaximum();if(this.orientation_==goog.ui.SliderBase.Orientation.VERTICAL){var c=this.valueThumb.offsetHeight;var a=this.getElement().clientHeight-c;var g=this.getRelativeMousePos_(d)-c/2;return(h-b)*(a-g)/a+b}else{var j=this.valueThumb.offsetWidth;var f=this.getElement().clientWidth-j;var i=this.getRelativeMousePos_(d)-j/2;return(h-b)*i/f+b}};goog.ui.SliderBase.prototype.getThumbPosition_=function(a){if(a==this.valueThumb){return this.rangeModel.getValue()}else{if(a==this.extentThumb){return this.rangeModel.getValue()+this.rangeModel.getExtent()}else{throw Error("Illegal thumb element. Neither minThumb nor maxThumb")}}};goog.ui.SliderBase.prototype.isDragging=function(){return this.valueDragger_.isDragging()||this.extentDragger_.isDragging()};goog.ui.SliderBase.prototype.moveThumbs=function(c){if(Math.abs(c)<this.getStep()){c=goog.math.sign(c)*this.getStep()}var b=this.getThumbPosition_(this.valueThumb)+c;var a=this.getThumbPosition_(this.extentThumb)+c;b=goog.math.clamp(b,this.getMinimum(),this.getMaximum()-this.minExtent_);a=goog.math.clamp(a,this.getMinimum()+this.minExtent_,this.getMaximum());this.setValueAndExtent(b,a-b)};goog.ui.SliderBase.prototype.setThumbPosition_=function(c,a){var d=this.rangeModel.roundToStepWithMin(a);var e=c==this.valueThumb?d:this.rangeModel.getValue();var b=c==this.extentThumb?d:this.rangeModel.getValue()+this.rangeModel.getExtent();if(e>=this.getMinimum()&&b>=e+this.minExtent_&&this.getMaximum()>=b){this.setValueAndExtent(e,b-e)}};goog.ui.SliderBase.prototype.setValueAndExtent=function(b,a){if(this.getMinimum()<=b&&b<=this.getMaximum()-a&&this.minExtent_<=a&&a<=this.getMaximum()-b){if(b==this.getValue()&&a==this.getExtent()){return}this.rangeModel.setMute(true);this.rangeModel.setExtent(0);this.rangeModel.setValue(b);this.rangeModel.setExtent(a);this.rangeModel.setMute(false);this.handleRangeModelChange(null)}};goog.ui.SliderBase.prototype.getMinimum=function(){return this.rangeModel.getMinimum()};goog.ui.SliderBase.prototype.setMinimum=function(a){this.rangeModel.setMinimum(a)};goog.ui.SliderBase.prototype.getMaximum=function(){return this.rangeModel.getMaximum()};goog.ui.SliderBase.prototype.setMaximum=function(a){this.rangeModel.setMaximum(a)};goog.ui.SliderBase.prototype.getValueThumb=function(){return this.valueThumb};goog.ui.SliderBase.prototype.getExtentThumb=function(){return this.extentThumb};goog.ui.SliderBase.prototype.getClosestThumb_=function(a){if(a<=(this.rangeModel.getValue()+this.rangeModel.getExtent()/2)){return this.valueThumb}else{return this.extentThumb}};goog.ui.SliderBase.prototype.handleRangeModelChange=function(a){this.updateUi_();this.updateAriaStates();this.dispatchEvent(goog.ui.Component.EventType.CHANGE)};goog.ui.SliderBase.prototype.updateUi_=function(){if(this.valueThumb&&!this.isAnimating_){var d=this.getThumbCoordinateForValue(this.getThumbPosition_(this.valueThumb));var b=this.getThumbCoordinateForValue(this.getThumbPosition_(this.extentThumb));if(this.orientation_==goog.ui.SliderBase.Orientation.VERTICAL){this.valueThumb.style.top=d.y+"px";this.extentThumb.style.top=b.y+"px";if(this.rangeHighlight){var a=this.calculateRangeHighlightPositioning_(b.y,d.y,this.valueThumb.offsetHeight);this.rangeHighlight.style.top=a.offset+"px";this.rangeHighlight.style.height=a.size+"px"}}else{var c=(this.flipForRtl_&&this.isRightToLeft())?"right":"left";this.valueThumb.style[c]=d.x+"px";this.extentThumb.style[c]=b.x+"px";if(this.rangeHighlight){var a=this.calculateRangeHighlightPositioning_(d.x,b.x,this.valueThumb.offsetWidth);this.rangeHighlight.style[c]=a.offset+"px";this.rangeHighlight.style.width=a.size+"px"}}}};goog.ui.SliderBase.prototype.calculateRangeHighlightPositioning_=function(c,b,a){var e=Math.ceil(a/2);var d=b-c+a-2*e;return{offset:c+e,size:Math.max(d,0)}};goog.ui.SliderBase.prototype.getThumbCoordinateForValue=function(b){var g=new goog.math.Coordinate;if(this.valueThumb){var d=this.getMinimum();var j=this.getMaximum();var i=(b==d&&d==j)?0:(b-d)/(j-d);if(this.orientation_==goog.ui.SliderBase.Orientation.VERTICAL){var f=this.valueThumb.offsetHeight;var e=this.getElement().clientHeight-f;var a=Math.round(i*e);g.x=this.getOffsetStart_(this.valueThumb);g.y=e-a}else{var k=this.getElement().clientWidth-this.valueThumb.offsetWidth;var c=Math.round(i*k);g.x=c;g.y=this.valueThumb.offsetTop}}return g};goog.ui.SliderBase.prototype.animatedSetValue=function(k){k=goog.math.clamp(k,this.getMinimum(),this.getMaximum());if(this.isAnimating_){this.currentAnimation_.stop(true)}var m=new goog.fx.AnimationParallelQueue();var f;var b=this.getClosestThumb_(k);var d=this.getValue();var e=this.getExtent();var c=this.getThumbPosition_(b);var a=this.getThumbCoordinateForValue(c);var i=this.getStep();if(Math.abs(k-c)<i){var j=k>c?i:-i;k=c+j;k=goog.math.clamp(k,this.getMinimum(),this.getMaximum())}this.setThumbPosition_(b,k);var h=this.getThumbCoordinateForValue(this.getThumbPosition_(b));if(this.orientation_==goog.ui.SliderBase.Orientation.VERTICAL){f=[this.getOffsetStart_(b),h.y]}else{f=[h.x,b.offsetTop]}var g=new goog.fx.dom.Slide(b,[a.x,a.y],f,goog.ui.SliderBase.ANIMATION_INTERVAL_);g.enableRightPositioningForRtl(this.flipForRtl_);m.add(g);if(this.rangeHighlight){this.addRangeHighlightAnimations_(b,d,e,h,m)}if(this.additionalAnimations_){var l=this.additionalAnimations_.createAnimations(d,k,goog.ui.SliderBase.ANIMATION_INTERVAL_);goog.array.forEach(l,function(n){m.add(n)})}this.currentAnimation_=m;this.getHandler().listen(m,goog.fx.Transition.EventType.END,this.endAnimation_);this.isAnimating_=true;m.play(false)};goog.ui.SliderBase.prototype.isAnimating=function(){return this.isAnimating_};goog.ui.SliderBase.prototype.setAdditionalAnimations=function(a){this.additionalAnimations_=a};goog.ui.SliderBase.prototype.addRangeHighlightAnimations_=function(a,g,h,m,n){var f=this.getThumbCoordinateForValue(g);var b=this.getThumbCoordinateForValue(g+h);var j=f;var e=b;if(a==this.valueThumb){j=m}else{e=m}if(this.orientation_==goog.ui.SliderBase.Orientation.VERTICAL){var d=this.calculateRangeHighlightPositioning_(b.y,f.y,this.valueThumb.offsetHeight);var k=this.calculateRangeHighlightPositioning_(e.y,j.y,this.valueThumb.offsetHeight);var i=new goog.fx.dom.Slide(this.rangeHighlight,[this.getOffsetStart_(this.rangeHighlight),d.offset],[this.getOffsetStart_(this.rangeHighlight),k.offset],goog.ui.SliderBase.ANIMATION_INTERVAL_);var c=new goog.fx.dom.ResizeHeight(this.rangeHighlight,d.size,k.size,goog.ui.SliderBase.ANIMATION_INTERVAL_);i.enableRightPositioningForRtl(this.flipForRtl_);c.enableRightPositioningForRtl(this.flipForRtl_);n.add(i);n.add(c)}else{var d=this.calculateRangeHighlightPositioning_(f.x,b.x,this.valueThumb.offsetWidth);var k=this.calculateRangeHighlightPositioning_(j.x,e.x,this.valueThumb.offsetWidth);var i=new goog.fx.dom.Slide(this.rangeHighlight,[d.offset,this.rangeHighlight.offsetTop],[k.offset,this.rangeHighlight.offsetTop],goog.ui.SliderBase.ANIMATION_INTERVAL_);var l=new goog.fx.dom.ResizeWidth(this.rangeHighlight,d.size,k.size,goog.ui.SliderBase.ANIMATION_INTERVAL_);i.enableRightPositioningForRtl(this.flipForRtl_);l.enableRightPositioningForRtl(this.flipForRtl_);n.add(i);n.add(l)}};goog.ui.SliderBase.prototype.endAnimation_=function(a){this.isAnimating_=false};goog.ui.SliderBase.prototype.setOrientation=function(a){if(this.orientation_!=a){var b=this.getCssClass(this.orientation_);var c=this.getCssClass(a);this.orientation_=a;if(this.getElement()){goog.dom.classlist.swap(goog.asserts.assert(this.getElement()),b,c);var d=(this.flipForRtl_&&this.isRightToLeft())?"right":"left";this.valueThumb.style[d]=this.valueThumb.style.top="";this.extentThumb.style[d]=this.extentThumb.style.top="";if(this.rangeHighlight){this.rangeHighlight.style[d]=this.rangeHighlight.style.top="";this.rangeHighlight.style.width=this.rangeHighlight.style.height=""}this.updateUi_()}}};goog.ui.SliderBase.prototype.getOrientation=function(){return this.orientation_};goog.ui.SliderBase.prototype.disposeInternal=function(){goog.ui.SliderBase.superClass_.disposeInternal.call(this);if(this.incTimer_){this.incTimer_.dispose()}delete this.incTimer_;if(this.currentAnimation_){this.currentAnimation_.dispose()}delete this.currentAnimation_;delete this.valueThumb;delete this.extentThumb;if(this.rangeHighlight){delete this.rangeHighlight}this.rangeModel.dispose();delete this.rangeModel;if(this.keyHandler_){this.keyHandler_.dispose();delete this.keyHandler_}if(this.mouseWheelHandler_){this.mouseWheelHandler_.dispose();delete this.mouseWheelHandler_}if(this.valueDragger_){this.valueDragger_.dispose();delete this.valueDragger_}if(this.extentDragger_){this.extentDragger_.dispose();delete this.extentDragger_}};goog.ui.SliderBase.prototype.getBlockIncrement=function(){return this.blockIncrement_};goog.ui.SliderBase.prototype.setBlockIncrement=function(a){this.blockIncrement_=a};goog.ui.SliderBase.prototype.setMinExtent=function(a){this.minExtent_=a};goog.ui.SliderBase.prototype.unitIncrement_=1;goog.ui.SliderBase.prototype.getUnitIncrement=function(){return this.unitIncrement_};goog.ui.SliderBase.prototype.setUnitIncrement=function(a){this.unitIncrement_=a};goog.ui.SliderBase.prototype.getStep=function(){return this.rangeModel.getStep()};goog.ui.SliderBase.prototype.setStep=function(a){this.rangeModel.setStep(a)};goog.ui.SliderBase.prototype.getMoveToPointEnabled=function(){return this.moveToPointEnabled_};goog.ui.SliderBase.prototype.setMoveToPointEnabled=function(a){this.moveToPointEnabled_=a};goog.ui.SliderBase.prototype.getValue=function(){return this.rangeModel.getValue()};goog.ui.SliderBase.prototype.setValue=function(a){this.setThumbPosition_(this.valueThumb,a)};goog.ui.SliderBase.prototype.getExtent=function(){return this.rangeModel.getExtent()};goog.ui.SliderBase.prototype.setExtent=function(a){this.setThumbPosition_(this.extentThumb,(this.rangeModel.getValue()+a))};goog.ui.SliderBase.prototype.setVisible=function(a){goog.style.setElementShown(this.getElement(),a);if(a){this.updateUi_()}};goog.ui.SliderBase.prototype.setAriaRoles=function(){var a=this.getElement();goog.asserts.assert(a,"The DOM element for the slider base cannot be null.");goog.a11y.aria.setRole(a,goog.a11y.aria.Role.SLIDER);this.updateAriaStates()};goog.ui.SliderBase.prototype.updateAriaStates=function(){var a=this.getElement();if(a){goog.a11y.aria.setState(a,goog.a11y.aria.State.VALUEMIN,this.getMinimum());goog.a11y.aria.setState(a,goog.a11y.aria.State.VALUEMAX,this.getMaximum());goog.a11y.aria.setState(a,goog.a11y.aria.State.VALUENOW,this.getValue());goog.a11y.aria.setState(a,goog.a11y.aria.State.VALUETEXT,this.getTextValue()||"")}};goog.ui.SliderBase.prototype.setHandleMouseWheel=function(a){if(this.isInDocument()&&a!=this.isHandleMouseWheel()){this.enableMouseWheelHandling_(a)}this.isHandleMouseWheel_=a};goog.ui.SliderBase.prototype.isHandleMouseWheel=function(){return this.isHandleMouseWheel_};goog.ui.SliderBase.prototype.enableMouseWheelHandling_=function(a){if(a){if(!this.mouseWheelHandler_){this.mouseWheelHandler_=new goog.events.MouseWheelHandler(this.getElement())}this.getHandler().listen(this.mouseWheelHandler_,goog.events.MouseWheelHandler.EventType.MOUSEWHEEL,this.handleMouseWheel_)}else{this.getHandler().unlisten(this.mouseWheelHandler_,goog.events.MouseWheelHandler.EventType.MOUSEWHEEL,this.handleMouseWheel_)}};goog.ui.SliderBase.prototype.setEnabled=function(a){if(this.enabled_==a){return}var b=a?goog.ui.Component.EventType.ENABLE:goog.ui.Component.EventType.DISABLE;if(this.dispatchEvent(b)){this.enabled_=a;this.enableEventHandlers_(a);if(!a){this.stopBlockIncrementing_()}goog.dom.classlist.enable(goog.asserts.assert(this.getElement()),goog.ui.SliderBase.DISABLED_CSS_CLASS_,!a)}};goog.ui.SliderBase.prototype.isEnabled=function(){return this.enabled_};goog.ui.SliderBase.prototype.getOffsetStart_=function(a){return this.flipForRtl_?goog.style.bidi.getOffsetStart(a):a.offsetLeft};goog.ui.SliderBase.prototype.getTextValue=function(){return this.labelFn_(this.getValue())};goog.ui.SliderBase.AnimationFactory=function(){};goog.ui.SliderBase.AnimationFactory.prototype.createAnimations;goog.provide("goog.ui.Slider");goog.provide("goog.ui.Slider.Orientation");goog.require("goog.a11y.aria");goog.require("goog.a11y.aria.Role");goog.require("goog.dom");goog.require("goog.ui.SliderBase");goog.ui.Slider=function(a,b){goog.ui.SliderBase.call(this,a,b);this.rangeModel.setExtent(0)};goog.inherits(goog.ui.Slider,goog.ui.SliderBase);goog.tagUnsealableClass(goog.ui.Slider);goog.ui.Slider.Orientation=goog.ui.SliderBase.Orientation;goog.ui.Slider.CSS_CLASS_PREFIX=goog.getCssName("goog-slider");goog.ui.Slider.THUMB_CSS_CLASS=goog.getCssName(goog.ui.Slider.CSS_CLASS_PREFIX,"thumb");goog.ui.Slider.prototype.getCssClass=function(a){return a==goog.ui.SliderBase.Orientation.VERTICAL?goog.getCssName(goog.ui.Slider.CSS_CLASS_PREFIX,"vertical"):goog.getCssName(goog.ui.Slider.CSS_CLASS_PREFIX,"horizontal")};goog.ui.Slider.prototype.createThumbs=function(){var b=this.getElement();var a=goog.dom.getElementsByTagNameAndClass(null,goog.ui.Slider.THUMB_CSS_CLASS,b)[0];if(!a){a=this.createThumb_();b.appendChild(a)}this.valueThumb=this.extentThumb=a};goog.ui.Slider.prototype.createThumb_=function(){var a=this.getDomHelper().createDom("div",goog.ui.Slider.THUMB_CSS_CLASS);goog.a11y.aria.setRole(a,goog.a11y.aria.Role.BUTTON);return(a)};goog.provide("goog.graphics.AffineTransform");goog.require("goog.math");goog.graphics.AffineTransform=function(d,f,b,e,a,c){if(arguments.length==6){this.setTransform((d),(f),(b),(e),(a),(c))}else{if(arguments.length!=0){throw Error("Insufficient matrix parameters")}else{this.m00_=this.m11_=1;this.m10_=this.m01_=this.m02_=this.m12_=0}}};goog.graphics.AffineTransform.prototype.isIdentity=function(){return this.m00_==1&&this.m10_==0&&this.m01_==0&&this.m11_==1&&this.m02_==0&&this.m12_==0};goog.graphics.AffineTransform.prototype.clone=function(){return new goog.graphics.AffineTransform(this.m00_,this.m10_,this.m01_,this.m11_,this.m02_,this.m12_)};goog.graphics.AffineTransform.prototype.setTransform=function(d,f,b,e,a,c){if(!goog.isNumber(d)||!goog.isNumber(f)||!goog.isNumber(b)||!goog.isNumber(e)||!goog.isNumber(a)||!goog.isNumber(c)){throw Error("Invalid transform parameters")}this.m00_=d;this.m10_=f;this.m01_=b;this.m11_=e;this.m02_=a;this.m12_=c;return this};goog.graphics.AffineTransform.prototype.copyFrom=function(a){this.m00_=a.m00_;this.m10_=a.m10_;this.m01_=a.m01_;this.m11_=a.m11_;this.m02_=a.m02_;this.m12_=a.m12_;return this};goog.graphics.AffineTransform.prototype.scale=function(b,a){this.m00_*=b;this.m10_*=b;this.m01_*=a;this.m11_*=a;return this};goog.graphics.AffineTransform.prototype.preScale=function(b,a){this.m00_*=b;this.m01_*=b;this.m02_*=b;this.m10_*=a;this.m11_*=a;this.m12_*=a;return this};goog.graphics.AffineTransform.prototype.translate=function(b,a){this.m02_+=b*this.m00_+a*this.m01_;this.m12_+=b*this.m10_+a*this.m11_;return this};goog.graphics.AffineTransform.prototype.preTranslate=function(b,a){this.m02_+=b;this.m12_+=a;return this};goog.graphics.AffineTransform.prototype.rotate=function(b,a,c){return this.concatenate(goog.graphics.AffineTransform.getRotateInstance(b,a,c))};goog.graphics.AffineTransform.prototype.preRotate=function(b,a,c){return this.preConcatenate(goog.graphics.AffineTransform.getRotateInstance(b,a,c))};goog.graphics.AffineTransform.prototype.shear=function(b,a){var c=this.m00_;var d=this.m10_;this.m00_+=a*this.m01_;this.m10_+=a*this.m11_;this.m01_+=b*c;this.m11_+=b*d;return this};goog.graphics.AffineTransform.prototype.preShear=function(b,a){var e=this.m00_;var d=this.m01_;var c=this.m02_;this.m00_+=b*this.m10_;this.m01_+=b*this.m11_;this.m02_+=b*this.m12_;this.m10_+=a*e;this.m11_+=a*d;this.m12_+=a*c;return this};goog.graphics.AffineTransform.prototype.toString=function(){return"matrix("+[this.m00_,this.m10_,this.m01_,this.m11_,this.m02_,this.m12_].join(",")+")"};goog.graphics.AffineTransform.prototype.getScaleX=function(){return this.m00_};goog.graphics.AffineTransform.prototype.getScaleY=function(){return this.m11_};goog.graphics.AffineTransform.prototype.getTranslateX=function(){return this.m02_};goog.graphics.AffineTransform.prototype.getTranslateY=function(){return this.m12_};goog.graphics.AffineTransform.prototype.getShearX=function(){return this.m01_};goog.graphics.AffineTransform.prototype.getShearY=function(){return this.m10_};goog.graphics.AffineTransform.prototype.concatenate=function(a){var c=this.m00_;var b=this.m01_;this.m00_=a.m00_*c+a.m10_*b;this.m01_=a.m01_*c+a.m11_*b;this.m02_+=a.m02_*c+a.m12_*b;c=this.m10_;b=this.m11_;this.m10_=a.m00_*c+a.m10_*b;this.m11_=a.m01_*c+a.m11_*b;this.m12_+=a.m02_*c+a.m12_*b;return this};goog.graphics.AffineTransform.prototype.preConcatenate=function(a){var c=this.m00_;var b=this.m10_;this.m00_=a.m00_*c+a.m01_*b;this.m10_=a.m10_*c+a.m11_*b;c=this.m01_;b=this.m11_;this.m01_=a.m00_*c+a.m01_*b;this.m11_=a.m10_*c+a.m11_*b;c=this.m02_;b=this.m12_;this.m02_=a.m00_*c+a.m01_*b+a.m02_;this.m12_=a.m10_*c+a.m11_*b+a.m12_;return this};goog.graphics.AffineTransform.prototype.transform=function(a,k,e,f,b){var d=k;var c=f;var l=k+2*b;while(d<l){var h=a[d++];var g=a[d++];e[c++]=h*this.m00_+g*this.m01_+this.m02_;e[c++]=h*this.m10_+g*this.m11_+this.m12_}};goog.graphics.AffineTransform.prototype.getDeterminant=function(){return this.m00_*this.m11_-this.m01_*this.m10_};goog.graphics.AffineTransform.prototype.isInvertible=function(){var a=this.getDeterminant();return goog.math.isFiniteNumber(a)&&goog.math.isFiniteNumber(this.m02_)&&goog.math.isFiniteNumber(this.m12_)&&a!=0};goog.graphics.AffineTransform.prototype.createInverse=function(){var a=this.getDeterminant();return new goog.graphics.AffineTransform(this.m11_/a,-this.m10_/a,-this.m01_/a,this.m00_/a,(this.m01_*this.m12_-this.m11_*this.m02_)/a,(this.m10_*this.m02_-this.m00_*this.m12_)/a)};goog.graphics.AffineTransform.getScaleInstance=function(b,a){return new goog.graphics.AffineTransform().setToScale(b,a)};goog.graphics.AffineTransform.getTranslateInstance=function(b,a){return new goog.graphics.AffineTransform().setToTranslation(b,a)};goog.graphics.AffineTransform.getShearInstance=function(b,a){return new goog.graphics.AffineTransform().setToShear(b,a)};goog.graphics.AffineTransform.getRotateInstance=function(b,a,c){return new goog.graphics.AffineTransform().setToRotation(b,a,c)};goog.graphics.AffineTransform.prototype.setToScale=function(b,a){return this.setTransform(b,0,0,a,0,0)};goog.graphics.AffineTransform.prototype.setToTranslation=function(b,a){return this.setTransform(1,0,0,1,b,a)};goog.graphics.AffineTransform.prototype.setToShear=function(b,a){return this.setTransform(1,a,b,1,0,0)};goog.graphics.AffineTransform.prototype.setToRotation=function(c,a,e){var d=Math.cos(c);var b=Math.sin(c);return this.setTransform(d,b,-b,d,a-a*d+e*b,e-a*b-e*d)};goog.graphics.AffineTransform.prototype.equals=function(a){if(this==a){return true}if(!a){return false}return this.m00_==a.m00_&&this.m01_==a.m01_&&this.m02_==a.m02_&&this.m10_==a.m10_&&this.m11_==a.m11_&&this.m12_==a.m12_};goog.provide("au.upldr.imaging.Transform");goog.provide("au.upldr.imaging.Bounds");goog.provide("au.upldr.imaging.TracerItem");goog.provide("au.upldr.imaging.Point");goog.provide("au.upldr.imaging.dictionary");goog.provide("au.upldr.imaging.tools");goog.require("goog.graphics.AffineTransform");au.upldr.imaging.Transform=function(b,h,g,d,a,f,c,e){this.x=b;this.y=h;this.width=d;this.height=a;this.scale=g;this.angle=f;this.scaledWidth=c;this.scaledHeight=e};au.upldr.imaging.Bounds=function(d,c,b,a){this.top=Math.floor(d);this.left=Math.floor(c);this.width=Math.floor(b);this.height=Math.floor(a)};au.upldr.imaging.Bounds.prototype.toString=function(){return[this.top,this.left,this.width,this.height].join(",")};au.upldr.imaging.Bounds.prototype.rotateAt=function(g,a,h){if(g==0){return this}var b=[this.left,this.top];var c=goog.graphics.AffineTransform.getRotateInstance(goog.math.toRadians(g),a,h);var f=new goog.graphics.AffineTransform();goog.graphics.AffineTransform.getTranslateInstance(this.width/2,this.height/2).transform(b,0,b,0,b.length/2);c.transform(b,0,b,0,b.length/2);var e,d;if(/90|270/.test(g)){e=this.height;d=this.width;f.preTranslate(h-a,a-h)}else{e=this.width;d=this.height}f.preTranslate(-e/2,-d/2);f.transform(b,0,b,0,b.length/2);return new au.upldr.imaging.Bounds(Math.round(b[1]),Math.round(b[0]),e,d)};au.upldr.imaging.Point=function(a,b){this.x=a;this.y=b};au.upldr.imaging.Point.prototype.transform=function(b){var a=Math.round((this.x-b.x)/b.scale);var c=Math.round((this.y-b.y)/b.scale);return new au.upldr.imaging.Point(a,c)};au.upldr.imaging.Point.prototype.rotateAt=function(e,a,f){if(e==0){return this}var b=[this.x,this.y];var c=goog.graphics.AffineTransform.getRotateInstance(goog.math.toRadians(e),a,f);var d=new goog.graphics.AffineTransform();c.transform(b,0,b,0,b.length/2);if(/90|270/.test(e)){d.preTranslate(f-a,a-f)}d.transform(b,0,b,0,b.length/2);return new au.upldr.imaging.Point(Math.round(b[0]),Math.round(b[1]))};au.upldr.imaging.TracerItem=function(d,b,a,c){this.type=d;this.size=b;this.color=a;this.points=c};au.upldr.imaging.dictionary={PENCIL:"pencil",ERASER:"eraser",CROP_AREA:"cropArea",NONE:"none"};au.upldr.imaging.tools={DRAW:"draw",CROP:"crop"};goog.provide("goog.ui.ToolbarSeparatorRenderer");goog.require("goog.asserts");goog.require("goog.dom.classlist");goog.require("goog.ui.INLINE_BLOCK_CLASSNAME");goog.require("goog.ui.MenuSeparatorRenderer");goog.ui.ToolbarSeparatorRenderer=function(){goog.ui.MenuSeparatorRenderer.call(this)};goog.inherits(goog.ui.ToolbarSeparatorRenderer,goog.ui.MenuSeparatorRenderer);goog.addSingletonGetter(goog.ui.ToolbarSeparatorRenderer);goog.ui.ToolbarSeparatorRenderer.CSS_CLASS=goog.getCssName("goog-toolbar-separator");goog.ui.ToolbarSeparatorRenderer.prototype.createDom=function(a){return a.getDomHelper().createDom("div",this.getClassNames(a).join(" ")+" "+goog.ui.INLINE_BLOCK_CLASSNAME,"\u00A0")};goog.ui.ToolbarSeparatorRenderer.prototype.decorate=function(b,a){a=goog.ui.ToolbarSeparatorRenderer.superClass_.decorate.call(this,b,a);goog.asserts.assert(a);goog.dom.classlist.add(a,goog.ui.INLINE_BLOCK_CLASSNAME);return a};goog.ui.ToolbarSeparatorRenderer.prototype.getCssClass=function(){return goog.ui.ToolbarSeparatorRenderer.CSS_CLASS};goog.provide("goog.ui.ToolbarRenderer");goog.require("goog.a11y.aria.Role");goog.require("goog.ui.Container");goog.require("goog.ui.ContainerRenderer");goog.require("goog.ui.Separator");goog.require("goog.ui.ToolbarSeparatorRenderer");goog.ui.ToolbarRenderer=function(){goog.ui.ContainerRenderer.call(this,goog.a11y.aria.Role.TOOLBAR)};goog.inherits(goog.ui.ToolbarRenderer,goog.ui.ContainerRenderer);goog.addSingletonGetter(goog.ui.ToolbarRenderer);goog.ui.ToolbarRenderer.CSS_CLASS=goog.getCssName("goog-toolbar");goog.ui.ToolbarRenderer.prototype.getDecoratorForChild=function(a){return a.tagName=="HR"?new goog.ui.Separator(goog.ui.ToolbarSeparatorRenderer.getInstance()):goog.ui.ToolbarRenderer.superClass_.getDecoratorForChild.call(this,a)};goog.ui.ToolbarRenderer.prototype.getCssClass=function(){return goog.ui.ToolbarRenderer.CSS_CLASS};goog.ui.ToolbarRenderer.prototype.getDefaultOrientation=function(){return goog.ui.Container.Orientation.HORIZONTAL};goog.provide("goog.ui.Toolbar");goog.require("goog.ui.Container");goog.require("goog.ui.ToolbarRenderer");goog.ui.Toolbar=function(c,b,a){goog.ui.Container.call(this,b,c||goog.ui.ToolbarRenderer.getInstance(),a)};goog.inherits(goog.ui.Toolbar,goog.ui.Container);goog.ui.Toolbar.prototype.handleFocus=function(a){goog.ui.Toolbar.base(this,"handleFocus",a);if(!this.isMouseButtonPressed()){this.highlightFirst()}};goog.provide("goog.positioning.AbsolutePosition");goog.require("goog.math.Coordinate");goog.require("goog.positioning");goog.require("goog.positioning.AbstractPosition");goog.positioning.AbsolutePosition=function(a,b){this.coordinate=a instanceof goog.math.Coordinate?a:new goog.math.Coordinate((a),b)};goog.inherits(goog.positioning.AbsolutePosition,goog.positioning.AbstractPosition);goog.positioning.AbsolutePosition.prototype.reposition=function(a,d,b,c){goog.positioning.positionAtCoordinate(this.coordinate,a,d,b,null,null,c)};goog.provide("goog.positioning.ViewportPosition");goog.require("goog.math.Coordinate");goog.require("goog.positioning");goog.require("goog.positioning.AbstractPosition");goog.require("goog.positioning.Corner");goog.require("goog.style");goog.positioning.ViewportPosition=function(a,b){this.coordinate=a instanceof goog.math.Coordinate?a:new goog.math.Coordinate((a),b)};goog.inherits(goog.positioning.ViewportPosition,goog.positioning.AbstractPosition);goog.positioning.ViewportPosition.prototype.reposition=function(c,b,a,d){goog.positioning.positionAtAnchor(goog.style.getClientViewportElement(c),goog.positioning.Corner.TOP_LEFT,c,b,this.coordinate,a,null,d)};goog.provide("goog.ui.Popup");goog.provide("goog.ui.Popup.AbsolutePosition");goog.provide("goog.ui.Popup.AnchoredPosition");goog.provide("goog.ui.Popup.AnchoredViewPortPosition");goog.provide("goog.ui.Popup.ClientPosition");goog.provide("goog.ui.Popup.Overflow");goog.provide("goog.ui.Popup.ViewPortClientPosition");goog.provide("goog.ui.Popup.ViewPortPosition");goog.require("goog.math.Box");goog.require("goog.positioning.AbsolutePosition");goog.require("goog.positioning.AnchoredPosition");goog.require("goog.positioning.AnchoredViewportPosition");goog.require("goog.positioning.ClientPosition");goog.require("goog.positioning.Corner");goog.require("goog.positioning.Overflow");goog.require("goog.positioning.ViewportClientPosition");goog.require("goog.positioning.ViewportPosition");goog.require("goog.style");goog.require("goog.ui.PopupBase");goog.ui.Popup=function(b,a){this.popupCorner_=goog.positioning.Corner.TOP_START;this.position_=a||undefined;goog.ui.PopupBase.call(this,b)};goog.inherits(goog.ui.Popup,goog.ui.PopupBase);goog.tagUnsealableClass(goog.ui.Popup);goog.ui.Popup.Overflow=goog.positioning.Overflow;goog.ui.Popup.prototype.margin_;goog.ui.Popup.prototype.getPinnedCorner=function(){return this.popupCorner_};goog.ui.Popup.prototype.setPinnedCorner=function(a){this.popupCorner_=a;if(this.isVisible()){this.reposition()}};goog.ui.Popup.prototype.getPosition=function(){return this.position_||null};goog.ui.Popup.prototype.setPosition=function(a){this.position_=a||undefined;if(this.isVisible()){this.reposition()}};goog.ui.Popup.prototype.getMargin=function(){return this.margin_||null};goog.ui.Popup.prototype.setMargin=function(a,d,c,b){if(a==null||a instanceof goog.math.Box){this.margin_=a}else{this.margin_=new goog.math.Box(a,(d),(c),(b))}if(this.isVisible()){this.reposition()}};goog.ui.Popup.prototype.reposition=function(){if(!this.position_){return}var b=!this.isVisible()&&this.getType()!=goog.ui.PopupBase.Type.MOVE_OFFSCREEN;var a=this.getElement();if(b){a.style.visibility="hidden";goog.style.setElementShown(a,true)}this.position_.reposition(a,this.popupCorner_,this.margin_);if(b){goog.style.setElementShown(a,false)}};goog.ui.Popup.AnchoredPosition=goog.positioning.AnchoredPosition;goog.ui.Popup.AnchoredViewPortPosition=goog.positioning.AnchoredViewportPosition;goog.ui.Popup.AbsolutePosition=goog.positioning.AbsolutePosition;goog.ui.Popup.ViewPortPosition=goog.positioning.ViewportPosition;goog.ui.Popup.ClientPosition=goog.positioning.ClientPosition;goog.ui.Popup.ViewPortClientPosition=goog.positioning.ViewportClientPosition;goog.provide("goog.ui.SelectionModel");goog.require("goog.array");goog.require("goog.events.EventTarget");goog.require("goog.events.EventType");goog.ui.SelectionModel=function(a){goog.events.EventTarget.call(this);this.items_=[];this.addItems(a)};goog.inherits(goog.ui.SelectionModel,goog.events.EventTarget);goog.tagUnsealableClass(goog.ui.SelectionModel);goog.ui.SelectionModel.prototype.selectedItem_=null;goog.ui.SelectionModel.prototype.selectionHandler_=null;goog.ui.SelectionModel.prototype.getSelectionHandler=function(){return this.selectionHandler_};goog.ui.SelectionModel.prototype.setSelectionHandler=function(a){this.selectionHandler_=a};goog.ui.SelectionModel.prototype.getItemCount=function(){return this.items_.length};goog.ui.SelectionModel.prototype.indexOfItem=function(a){return a?goog.array.indexOf(this.items_,a):-1};goog.ui.SelectionModel.prototype.getFirst=function(){return this.items_[0]};goog.ui.SelectionModel.prototype.getLast=function(){return this.items_[this.items_.length-1]};goog.ui.SelectionModel.prototype.getItemAt=function(a){return this.items_[a]||null};goog.ui.SelectionModel.prototype.addItems=function(a){if(a){goog.array.forEach(a,function(b){this.selectItem_(b,false)},this);goog.array.extend(this.items_,a)}};goog.ui.SelectionModel.prototype.addItem=function(a){this.addItemAt(a,this.getItemCount())};goog.ui.SelectionModel.prototype.addItemAt=function(b,a){if(b){this.selectItem_(b,false);goog.array.insertAt(this.items_,b,a)}};goog.ui.SelectionModel.prototype.removeItem=function(a){if(a&&goog.array.remove(this.items_,a)){if(a==this.selectedItem_){this.selectedItem_=null;this.dispatchEvent(goog.events.EventType.SELECT)}}};goog.ui.SelectionModel.prototype.removeItemAt=function(a){this.removeItem(this.getItemAt(a))};goog.ui.SelectionModel.prototype.getSelectedItem=function(){return this.selectedItem_};goog.ui.SelectionModel.prototype.getItems=function(){return goog.array.clone(this.items_)};goog.ui.SelectionModel.prototype.setSelectedItem=function(a){if(a!=this.selectedItem_){this.selectItem_(this.selectedItem_,false);this.selectedItem_=a;this.selectItem_(a,true)}this.dispatchEvent(goog.events.EventType.SELECT)};goog.ui.SelectionModel.prototype.getSelectedIndex=function(){return this.indexOfItem(this.selectedItem_)};goog.ui.SelectionModel.prototype.setSelectedIndex=function(a){this.setSelectedItem(this.getItemAt(a))};goog.ui.SelectionModel.prototype.clear=function(){goog.array.clear(this.items_);this.selectedItem_=null};goog.ui.SelectionModel.prototype.disposeInternal=function(){goog.ui.SelectionModel.superClass_.disposeInternal.call(this);delete this.items_;this.selectedItem_=null};goog.ui.SelectionModel.prototype.selectItem_=function(b,a){if(b){if(typeof this.selectionHandler_=="function"){this.selectionHandler_(b,a)}else{if(typeof b.setSelected=="function"){b.setSelected(a)}}}};goog.provide("goog.dom.TagIterator");goog.provide("goog.dom.TagWalkType");goog.require("goog.dom");goog.require("goog.dom.NodeType");goog.require("goog.iter.Iterator");goog.require("goog.iter.StopIteration");goog.dom.TagWalkType={START_TAG:1,OTHER:0,END_TAG:-1};goog.dom.TagIterator=function(e,a,c,d,b){this.reversed=!!a;if(e){this.setPosition(e,d)}this.depth=b!=undefined?b:this.tagType||0;if(this.reversed){this.depth*=-1}this.constrained=!c};goog.inherits(goog.dom.TagIterator,goog.iter.Iterator);goog.dom.TagIterator.prototype.node=null;goog.dom.TagIterator.prototype.tagType=goog.dom.TagWalkType.OTHER;goog.dom.TagIterator.prototype.depth;goog.dom.TagIterator.prototype.reversed;goog.dom.TagIterator.prototype.constrained;goog.dom.TagIterator.prototype.started_=false;goog.dom.TagIterator.prototype.setPosition=function(b,c,a){this.node=b;if(b){if(goog.isNumber(c)){this.tagType=c}else{this.tagType=this.node.nodeType!=goog.dom.NodeType.ELEMENT?goog.dom.TagWalkType.OTHER:this.reversed?goog.dom.TagWalkType.END_TAG:goog.dom.TagWalkType.START_TAG}}if(goog.isNumber(a)){this.depth=a}};goog.dom.TagIterator.prototype.copyFrom=function(a){this.node=a.node;this.tagType=a.tagType;this.depth=a.depth;this.reversed=a.reversed;this.constrained=a.constrained};goog.dom.TagIterator.prototype.clone=function(){return new goog.dom.TagIterator(this.node,this.reversed,!this.constrained,this.tagType,this.depth)};goog.dom.TagIterator.prototype.skipTag=function(){var a=this.reversed?goog.dom.TagWalkType.END_TAG:goog.dom.TagWalkType.START_TAG;if(this.tagType==a){this.tagType=(a*-1);this.depth+=this.tagType*(this.reversed?-1:1)}};goog.dom.TagIterator.prototype.restartTag=function(){var a=this.reversed?goog.dom.TagWalkType.START_TAG:goog.dom.TagWalkType.END_TAG;if(this.tagType==a){this.tagType=(a*-1);this.depth+=this.tagType*(this.reversed?-1:1)}};goog.dom.TagIterator.prototype.next=function(){var c;if(this.started_){if(!this.node||this.constrained&&this.depth==0){throw goog.iter.StopIteration}c=this.node;var a=this.reversed?goog.dom.TagWalkType.END_TAG:goog.dom.TagWalkType.START_TAG;if(this.tagType==a){var d=this.reversed?c.lastChild:c.firstChild;if(d){this.setPosition(d)}else{this.setPosition(c,(a*-1))}}else{var b=this.reversed?c.previousSibling:c.nextSibling;if(b){this.setPosition(b)}else{this.setPosition(c.parentNode,(a*-1))}}this.depth+=this.tagType*(this.reversed?-1:1)}else{this.started_=true}c=this.node;if(!this.node){throw goog.iter.StopIteration}return c};goog.dom.TagIterator.prototype.isStarted=function(){return this.started_};goog.dom.TagIterator.prototype.isStartTag=function(){return this.tagType==goog.dom.TagWalkType.START_TAG};goog.dom.TagIterator.prototype.isEndTag=function(){return this.tagType==goog.dom.TagWalkType.END_TAG};goog.dom.TagIterator.prototype.isNonElement=function(){return this.tagType==goog.dom.TagWalkType.OTHER};goog.dom.TagIterator.prototype.equals=function(a){return a.node==this.node&&(!this.node||a.tagType==this.tagType)};goog.dom.TagIterator.prototype.splice=function(d){var c=this.node;this.restartTag();this.reversed=!this.reversed;goog.dom.TagIterator.prototype.next.call(this);this.reversed=!this.reversed;var a=goog.isArrayLike(arguments[0])?arguments[0]:arguments;for(var b=a.length-1;b>=0;b--){goog.dom.insertSiblingAfter(a[b],c)}goog.dom.removeNode(c)};goog.provide("goog.dom.NodeIterator");goog.require("goog.dom.TagIterator");goog.dom.NodeIterator=function(d,a,c,b){goog.dom.TagIterator.call(this,d,a,c,null,b)};goog.inherits(goog.dom.NodeIterator,goog.dom.TagIterator);goog.dom.NodeIterator.prototype.next=function(){do{goog.dom.NodeIterator.superClass_.next.call(this)}while(this.isEndTag());return this.node};goog.provide("goog.ui.PaletteRenderer");goog.require("goog.a11y.aria");goog.require("goog.a11y.aria.Role");goog.require("goog.a11y.aria.State");goog.require("goog.array");goog.require("goog.asserts");goog.require("goog.dom");goog.require("goog.dom.NodeIterator");goog.require("goog.dom.NodeType");goog.require("goog.dom.TagName");goog.require("goog.dom.classlist");goog.require("goog.iter");goog.require("goog.style");goog.require("goog.ui.ControlRenderer");goog.require("goog.userAgent");goog.ui.PaletteRenderer=function(){goog.ui.ControlRenderer.call(this)};goog.inherits(goog.ui.PaletteRenderer,goog.ui.ControlRenderer);goog.addSingletonGetter(goog.ui.PaletteRenderer);goog.ui.PaletteRenderer.cellId_=0;goog.ui.PaletteRenderer.CSS_CLASS=goog.getCssName("goog-palette");goog.ui.PaletteRenderer.prototype.createDom=function(a){var c=this.getClassNames(a);var b=a.getDomHelper().createDom(goog.dom.TagName.DIV,c?c.join(" "):null,this.createGrid((a.getContent()),a.getSize(),a.getDomHelper()));goog.a11y.aria.setRole(b,goog.a11y.aria.Role.GRID);return b};goog.ui.PaletteRenderer.prototype.createGrid=function(d,i,b){var h=[];for(var g=0,c=0;g<i.height;g++){var f=[];for(var a=0;a<i.width;a++){var e=d&&d[c++];f.push(this.createCell(e,b))}h.push(this.createRow(f,b))}return this.createTable(h,b)};goog.ui.PaletteRenderer.prototype.createTable=function(b,c){var a=c.createDom(goog.dom.TagName.TABLE,goog.getCssName(this.getCssClass(),"table"),c.createDom(goog.dom.TagName.TBODY,goog.getCssName(this.getCssClass(),"body"),b));a.cellSpacing=0;a.cellPadding=0;return a};goog.ui.PaletteRenderer.prototype.createRow=function(a,c){var b=c.createDom(goog.dom.TagName.TR,goog.getCssName(this.getCssClass(),"row"),a);goog.a11y.aria.setRole(b,goog.a11y.aria.Role.ROW);return b};goog.ui.PaletteRenderer.prototype.createCell=function(b,d){var a=d.createDom(goog.dom.TagName.TD,{"class":goog.getCssName(this.getCssClass(),"cell"),id:goog.getCssName(this.getCssClass(),"cell-")+goog.ui.PaletteRenderer.cellId_++},b);goog.a11y.aria.setRole(a,goog.a11y.aria.Role.GRIDCELL);goog.a11y.aria.setState(a,goog.a11y.aria.State.SELECTED,false);if(!goog.dom.getTextContent(a)&&!goog.a11y.aria.getLabel(a)){var c=this.findAriaLabelForCell_(a);if(c){goog.a11y.aria.setLabel(a,c)}}return a};goog.ui.PaletteRenderer.prototype.findAriaLabelForCell_=function(a){var b=new goog.dom.NodeIterator(a);var c="";var d;while(!c&&(d=goog.iter.nextOrValue(b,null))){if(d.nodeType==goog.dom.NodeType.ELEMENT){c=goog.a11y.aria.getLabel((d))||d.title}}return c};goog.ui.PaletteRenderer.prototype.canDecorate=function(a){return false};goog.ui.PaletteRenderer.prototype.decorate=function(a,b){return null};goog.ui.PaletteRenderer.prototype.setContent=function(c,f){var g=(f);if(c){var d=goog.dom.getElementsByTagNameAndClass(goog.dom.TagName.TBODY,goog.getCssName(this.getCssClass(),"body"),c)[0];if(d){var e=0;goog.array.forEach(d.rows,function(k){goog.array.forEach(k.cells,function(l){goog.dom.removeChildren(l);if(g){var m=g[e++];if(m){goog.dom.appendChild(l,m)}}})});if(e<g.length){var i=[];var b=goog.dom.getDomHelper(c);var a=d.rows[0].cells.length;while(e<g.length){var h=g[e++];i.push(this.createCell(h,b));if(i.length==a){var j=this.createRow(i,b);goog.dom.appendChild(d,j);i.length=0}}if(i.length>0){while(i.length<a){i.push(this.createCell("",b))}var j=this.createRow(i,b);goog.dom.appendChild(d,j)}}}goog.style.setUnselectable(c,true,goog.userAgent.GECKO)}};goog.ui.PaletteRenderer.prototype.getContainingItem=function(b,c){var a=b.getElement();while(c&&c.nodeType==goog.dom.NodeType.ELEMENT&&c!=a){if(c.tagName==goog.dom.TagName.TD&&goog.dom.classlist.contains((c),goog.getCssName(this.getCssClass(),"cell"))){return c.firstChild}c=c.parentNode}return null};goog.ui.PaletteRenderer.prototype.highlightCell=function(b,d,c){if(d){var a=this.getCellForItem(d);goog.asserts.assert(a);goog.dom.classlist.enable(a,goog.getCssName(this.getCssClass(),"cell-hover"),c);if(c){goog.a11y.aria.setState(b.getElementStrict(),goog.a11y.aria.State.ACTIVEDESCENDANT,a.id)}else{if(a.id==goog.a11y.aria.getState(b.getElementStrict(),goog.a11y.aria.State.ACTIVEDESCENDANT)){goog.a11y.aria.removeState(b.getElementStrict(),goog.a11y.aria.State.ACTIVEDESCENDANT)}}}};goog.ui.PaletteRenderer.prototype.getCellForItem=function(a){return(a?a.parentNode:null)};goog.ui.PaletteRenderer.prototype.selectCell=function(c,d,b){if(d){var a=(d.parentNode);goog.dom.classlist.enable(a,goog.getCssName(this.getCssClass(),"cell-selected"),b);goog.a11y.aria.setState(a,goog.a11y.aria.State.SELECTED,b)}};goog.ui.PaletteRenderer.prototype.getCssClass=function(){return goog.ui.PaletteRenderer.CSS_CLASS};goog.provide("goog.ui.Palette");goog.require("goog.array");goog.require("goog.dom");goog.require("goog.events");goog.require("goog.events.EventType");goog.require("goog.events.KeyCodes");goog.require("goog.math.Size");goog.require("goog.ui.Component");goog.require("goog.ui.Control");goog.require("goog.ui.PaletteRenderer");goog.require("goog.ui.SelectionModel");goog.ui.Palette=function(a,c,b){goog.ui.Palette.base(this,"constructor",a,c||goog.ui.PaletteRenderer.getInstance(),b);this.setAutoStates(goog.ui.Component.State.CHECKED|goog.ui.Component.State.SELECTED|goog.ui.Component.State.OPENED,false);this.currentCellControl_=new goog.ui.Palette.CurrentCell_();this.currentCellControl_.setParentEventTarget(this);this.lastHighlightedIndex_=-1};goog.inherits(goog.ui.Palette,goog.ui.Control);goog.tagUnsealableClass(goog.ui.Palette);goog.ui.Palette.EventType={AFTER_HIGHLIGHT:goog.events.getUniqueId("afterhighlight")};goog.ui.Palette.prototype.size_=null;goog.ui.Palette.prototype.highlightedIndex_=-1;goog.ui.Palette.prototype.selectionModel_=null;goog.ui.Palette.prototype.disposeInternal=function(){goog.ui.Palette.superClass_.disposeInternal.call(this);if(this.selectionModel_){this.selectionModel_.dispose();this.selectionModel_=null}this.size_=null;this.currentCellControl_.dispose()};goog.ui.Palette.prototype.setContentInternal=function(b){var a=(b);goog.ui.Palette.superClass_.setContentInternal.call(this,a);this.adjustSize_();if(this.selectionModel_){this.selectionModel_.clear();this.selectionModel_.addItems(a)}else{this.selectionModel_=new goog.ui.SelectionModel(a);this.selectionModel_.setSelectionHandler(goog.bind(this.selectItem_,this));this.getHandler().listen(this.selectionModel_,goog.events.EventType.SELECT,this.handleSelectionChange)}this.highlightedIndex_=-1};goog.ui.Palette.prototype.getCaption=function(){return""};goog.ui.Palette.prototype.setCaption=function(a){};goog.ui.Palette.prototype.handleMouseOver=function(b){goog.ui.Palette.superClass_.handleMouseOver.call(this,b);var a=this.getRenderer().getContainingItem(this,b.target);if(a&&b.relatedTarget&&goog.dom.contains(a,b.relatedTarget)){return}if(a!=this.getHighlightedItem()){this.setHighlightedItem(a)}};goog.ui.Palette.prototype.handleMouseDown=function(b){goog.ui.Palette.superClass_.handleMouseDown.call(this,b);if(this.isActive()){var a=this.getRenderer().getContainingItem(this,b.target);if(a!=this.getHighlightedItem()){this.setHighlightedItem(a)}}};goog.ui.Palette.prototype.performActionInternal=function(b){var a=this.getHighlightedItem();if(a){this.setSelectedItem(a);return goog.ui.Palette.base(this,"performActionInternal",b)}return false};goog.ui.Palette.prototype.handleKeyEvent=function(f){var b=this.getContent();var d=b?b.length:0;var c=this.size_.width;if(d==0||!this.isEnabled()){return false}if(f.keyCode==goog.events.KeyCodes.ENTER||f.keyCode==goog.events.KeyCodes.SPACE){return this.performActionInternal(f)}if(f.keyCode==goog.events.KeyCodes.HOME){this.setHighlightedIndex(0);return true}else{if(f.keyCode==goog.events.KeyCodes.END){this.setHighlightedIndex(d-1);return true}}var a=this.highlightedIndex_<0?this.getSelectedIndex():this.highlightedIndex_;switch(f.keyCode){case goog.events.KeyCodes.LEFT:if(a==-1||a==0){a=d}this.setHighlightedIndex(a-1);f.preventDefault();return true;break;case goog.events.KeyCodes.RIGHT:if(a==d-1){a=-1}this.setHighlightedIndex(a+1);f.preventDefault();return true;break;case goog.events.KeyCodes.UP:if(a==-1){a=d+c-1}if(a>=c){this.setHighlightedIndex(a-c);f.preventDefault();return true}break;case goog.events.KeyCodes.DOWN:if(a==-1){a=-c}if(a<d-c){this.setHighlightedIndex(a+c);f.preventDefault();return true}break}return false};goog.ui.Palette.prototype.handleSelectionChange=function(a){};goog.ui.Palette.prototype.getSize=function(){return this.size_};goog.ui.Palette.prototype.setSize=function(b,a){if(this.getElement()){throw Error(goog.ui.Component.Error.ALREADY_RENDERED)}this.size_=goog.isNumber(b)?new goog.math.Size(b,(a)):b;this.adjustSize_()};goog.ui.Palette.prototype.getHighlightedIndex=function(){return this.highlightedIndex_};goog.ui.Palette.prototype.getHighlightedItem=function(){var a=this.getContent();return a&&a[this.highlightedIndex_]};goog.ui.Palette.prototype.getHighlightedCellElement_=function(){return this.getRenderer().getCellForItem(this.getHighlightedItem())};goog.ui.Palette.prototype.setHighlightedIndex=function(a){if(a!=this.highlightedIndex_){this.highlightIndex_(this.highlightedIndex_,false);this.lastHighlightedIndex_=this.highlightedIndex_;this.highlightedIndex_=a;this.highlightIndex_(a,true);this.dispatchEvent(goog.ui.Palette.EventType.AFTER_HIGHLIGHT)}};goog.ui.Palette.prototype.setHighlightedItem=function(b){var a=(this.getContent());this.setHighlightedIndex(a?goog.array.indexOf(a,b):-1)};goog.ui.Palette.prototype.getSelectedIndex=function(){return this.selectionModel_?this.selectionModel_.getSelectedIndex():-1};goog.ui.Palette.prototype.getSelectedItem=function(){return this.selectionModel_?(this.selectionModel_.getSelectedItem()):null};goog.ui.Palette.prototype.setSelectedIndex=function(a){if(this.selectionModel_){this.selectionModel_.setSelectedIndex(a)}};goog.ui.Palette.prototype.setSelectedItem=function(a){if(this.selectionModel_){this.selectionModel_.setSelectedItem(a)}};goog.ui.Palette.prototype.highlightIndex_=function(d,c){if(this.getElement()){var b=this.getContent();if(b&&d>=0&&d<b.length){var a=this.getHighlightedCellElement_();if(this.currentCellControl_.getElement()!=a){this.currentCellControl_.setElementInternal(a)}if(this.currentCellControl_.tryHighlight(c)){this.getRenderer().highlightCell(this,b[d],c)}}}};goog.ui.Palette.prototype.setHighlighted=function(a){if(a&&this.highlightedIndex_==-1){this.setHighlightedIndex(this.lastHighlightedIndex_>-1?this.lastHighlightedIndex_:0)}else{if(!a){this.setHighlightedIndex(-1)}}goog.ui.Palette.base(this,"setHighlighted",a)};goog.ui.Palette.prototype.selectItem_=function(b,a){if(this.getElement()){this.getRenderer().selectCell(this,b,a)}};goog.ui.Palette.prototype.adjustSize_=function(){var b=this.getContent();if(b){if(this.size_&&this.size_.width){var a=Math.ceil(b.length/this.size_.width);if(!goog.isNumber(this.size_.height)||this.size_.height<a){this.size_.height=a}}else{var c=Math.ceil(Math.sqrt(b.length));this.size_=new goog.math.Size(c,c)}}else{this.size_=new goog.math.Size(0,0)}};goog.ui.Palette.CurrentCell_=function(){goog.ui.Palette.CurrentCell_.base(this,"constructor",null);this.setDispatchTransitionEvents(goog.ui.Component.State.HOVER,true)};goog.inherits(goog.ui.Palette.CurrentCell_,goog.ui.Control);goog.ui.Palette.CurrentCell_.prototype.tryHighlight=function(a){this.setHighlighted(a);return this.isHighlighted()==a};goog.provide("goog.ui.ColorPalette");goog.require("goog.array");goog.require("goog.color");goog.require("goog.style");goog.require("goog.ui.Palette");goog.require("goog.ui.PaletteRenderer");goog.ui.ColorPalette=function(b,c,a){this.colors_=b||[];goog.ui.Palette.call(this,null,c||goog.ui.PaletteRenderer.getInstance(),a);this.setColors(this.colors_)};goog.inherits(goog.ui.ColorPalette,goog.ui.Palette);goog.tagUnsealableClass(goog.ui.ColorPalette);goog.ui.ColorPalette.prototype.normalizedColors_=null;goog.ui.ColorPalette.prototype.labels_=null;goog.ui.ColorPalette.prototype.getColors=function(){return this.colors_};goog.ui.ColorPalette.prototype.setColors=function(a,b){this.colors_=a;this.labels_=b||null;this.normalizedColors_=null;this.setContent(this.createColorNodes())};goog.ui.ColorPalette.prototype.getSelectedColor=function(){var b=(this.getSelectedItem());if(b){var a=goog.style.getStyle(b,"background-color");return goog.ui.ColorPalette.parseColor_(a)}else{return null}};goog.ui.ColorPalette.prototype.setSelectedColor=function(a){var b=goog.ui.ColorPalette.parseColor_(a);if(!this.normalizedColors_){this.normalizedColors_=goog.array.map(this.colors_,function(c){return goog.ui.ColorPalette.parseColor_(c)})}this.setSelectedIndex(b?goog.array.indexOf(this.normalizedColors_,b):-1)};goog.ui.ColorPalette.prototype.createColorNodes=function(){return goog.array.map(this.colors_,function(a,b){var c=this.getDomHelper().createDom("div",{"class":goog.getCssName(this.getRenderer().getCssClass(),"colorswatch"),style:"background-color:"+a});if(this.labels_&&this.labels_[b]){c.title=this.labels_[b]}else{c.title=a.charAt(0)=="#"?"RGB ("+goog.color.hexToRgb(a).join(", ")+")":a}return c},this)};goog.ui.ColorPalette.parseColor_=function(a){if(a){try{return goog.color.parse(a).hex}catch(b){}}return null};goog.provide("goog.ui.ColorPicker");goog.provide("goog.ui.ColorPicker.EventType");goog.require("goog.ui.ColorPalette");goog.require("goog.ui.Component");goog.ui.ColorPicker=function(a,b){goog.ui.Component.call(this,a);this.colorPalette_=b||null;this.getHandler().listen(this,goog.ui.Component.EventType.ACTION,this.onColorPaletteAction_)};goog.inherits(goog.ui.ColorPicker,goog.ui.Component);goog.ui.ColorPicker.DEFAULT_NUM_COLS=5;goog.ui.ColorPicker.EventType={CHANGE:"change"};goog.ui.ColorPicker.prototype.focusable_=true;goog.ui.ColorPicker.prototype.getColors=function(){return this.colorPalette_?this.colorPalette_.getColors():null};goog.ui.ColorPicker.prototype.setColors=function(a){if(!this.colorPalette_){this.createColorPalette_(a)}else{this.colorPalette_.setColors(a)}};goog.ui.ColorPicker.prototype.addColors=function(a){this.setColors(a)};goog.ui.ColorPicker.prototype.setSize=function(a){if(!this.colorPalette_){this.createColorPalette_([])}this.colorPalette_.setSize(a)};goog.ui.ColorPicker.prototype.getSize=function(){return this.colorPalette_?this.colorPalette_.getSize():null};goog.ui.ColorPicker.prototype.setColumnCount=function(a){this.setSize(a)};goog.ui.ColorPicker.prototype.getSelectedIndex=function(){return this.colorPalette_?this.colorPalette_.getSelectedIndex():-1};goog.ui.ColorPicker.prototype.setSelectedIndex=function(a){if(this.colorPalette_){this.colorPalette_.setSelectedIndex(a)}};goog.ui.ColorPicker.prototype.getSelectedColor=function(){return this.colorPalette_?this.colorPalette_.getSelectedColor():null};goog.ui.ColorPicker.prototype.setSelectedColor=function(a){if(this.colorPalette_){this.colorPalette_.setSelectedColor(a)}};goog.ui.ColorPicker.prototype.isFocusable=function(){return this.focusable_};goog.ui.ColorPicker.prototype.setFocusable=function(a){this.focusable_=a;if(this.colorPalette_){this.colorPalette_.setSupportedState(goog.ui.Component.State.FOCUSED,a)}};goog.ui.ColorPicker.prototype.canDecorate=function(a){return false};goog.ui.ColorPicker.prototype.enterDocument=function(){goog.ui.ColorPicker.superClass_.enterDocument.call(this);if(this.colorPalette_){this.colorPalette_.render(this.getElement())}this.getElement().unselectable="on"};goog.ui.ColorPicker.prototype.disposeInternal=function(){goog.ui.ColorPicker.superClass_.disposeInternal.call(this);if(this.colorPalette_){this.colorPalette_.dispose();this.colorPalette_=null}};goog.ui.ColorPicker.prototype.focus=function(){if(this.colorPalette_){this.colorPalette_.getElement().focus()}};goog.ui.ColorPicker.prototype.onColorPaletteAction_=function(a){a.stopPropagation();this.dispatchEvent(goog.ui.ColorPicker.EventType.CHANGE)};goog.ui.ColorPicker.prototype.createColorPalette_=function(a){var b=new goog.ui.ColorPalette(a,null,this.getDomHelper());b.setSize(goog.ui.ColorPicker.DEFAULT_NUM_COLS);b.setSupportedState(goog.ui.Component.State.FOCUSED,this.focusable_);this.addChild(b);this.colorPalette_=b;if(this.isInDocument()){this.colorPalette_.render(this.getElement())}};goog.ui.ColorPicker.createSimpleColorGrid=function(a){var b=new goog.ui.ColorPicker(a);b.setSize(7);b.setColors(goog.ui.ColorPicker.SIMPLE_GRID_COLORS);return b};goog.ui.ColorPicker.SIMPLE_GRID_COLORS=["#ffffff","#cccccc","#c0c0c0","#999999","#666666","#333333","#000000","#ffcccc","#ff6666","#ff0000","#cc0000","#990000","#660000","#330000","#ffcc99","#ff9966","#ff9900","#ff6600","#cc6600","#993300","#663300","#ffff99","#ffff66","#ffcc66","#ffcc33","#cc9933","#996633","#663333","#ffffcc","#ffff33","#ffff00","#ffcc00","#999900","#666600","#333300","#99ff99","#66ff99","#33ff33","#33cc00","#009900","#006600","#003300","#99ffff","#33ffff","#66cccc","#00cccc","#339999","#336666","#003333","#ccffff","#66ffff","#33ccff","#3366ff","#3333ff","#000099","#000066","#ccccff","#9999ff","#6666cc","#6633ff","#6600cc","#333399","#330099","#ffccff","#ff99ff","#cc66cc","#cc33cc","#993399","#663366","#330033"];goog.provide("goog.ui.PopupColorPicker");goog.require("goog.asserts");goog.require("goog.dom.classlist");goog.require("goog.events.EventType");goog.require("goog.positioning.AnchoredPosition");goog.require("goog.positioning.Corner");goog.require("goog.ui.ColorPicker");goog.require("goog.ui.Component");goog.require("goog.ui.Popup");goog.ui.PopupColorPicker=function(a,b){goog.ui.Component.call(this,a);if(b){this.colorPicker_=b}};goog.inherits(goog.ui.PopupColorPicker,goog.ui.Component);goog.tagUnsealableClass(goog.ui.PopupColorPicker);goog.ui.PopupColorPicker.prototype.initialized_=false;goog.ui.PopupColorPicker.prototype.colorPicker_=null;goog.ui.PopupColorPicker.prototype.popup_=null;goog.ui.PopupColorPicker.prototype.pinnedCorner_=goog.positioning.Corner.TOP_START;goog.ui.PopupColorPicker.prototype.popupCorner_=goog.positioning.Corner.BOTTOM_START;goog.ui.PopupColorPicker.prototype.lastTarget_=null;goog.ui.PopupColorPicker.prototype.rememberSelection_;goog.ui.PopupColorPicker.prototype.allowAutoFocus_=true;goog.ui.PopupColorPicker.prototype.focusable_=true;goog.ui.PopupColorPicker.prototype.toggleMode_=true;goog.ui.PopupColorPicker.prototype.showOnHover_=false;goog.ui.PopupColorPicker.prototype.createDom=function(){goog.ui.PopupColorPicker.superClass_.createDom.call(this);this.popup_=new goog.ui.Popup(this.getElement());this.popup_.setPinnedCorner(this.pinnedCorner_);goog.dom.classlist.set(goog.asserts.assert(this.getElement()),goog.getCssName("goog-popupcolorpicker"));this.getElement().unselectable="on"};goog.ui.PopupColorPicker.prototype.disposeInternal=function(){goog.ui.PopupColorPicker.superClass_.disposeInternal.call(this);this.colorPicker_=null;this.lastTarget_=null;this.initialized_=false;if(this.popup_){this.popup_.dispose();this.popup_=null}};goog.ui.PopupColorPicker.prototype.canDecorate=function(a){return false};goog.ui.PopupColorPicker.prototype.getColorPicker=function(){return this.colorPicker_};goog.ui.PopupColorPicker.prototype.getAutoHide=function(){return !!this.popup_&&this.popup_.getAutoHide()};goog.ui.PopupColorPicker.prototype.setAutoHide=function(a){if(this.popup_){this.popup_.setAutoHide(a)}};goog.ui.PopupColorPicker.prototype.getAutoHideRegion=function(){return this.popup_&&this.popup_.getAutoHideRegion()};goog.ui.PopupColorPicker.prototype.setAutoHideRegion=function(a){if(this.popup_){this.popup_.setAutoHideRegion(a)}};goog.ui.PopupColorPicker.prototype.getPopup=function(){return this.popup_};goog.ui.PopupColorPicker.prototype.getLastTarget=function(){return this.lastTarget_};goog.ui.PopupColorPicker.prototype.attach=function(a){if(this.showOnHover_){this.getHandler().listen(a,goog.events.EventType.MOUSEOVER,this.show_)}else{this.getHandler().listen(a,goog.events.EventType.MOUSEDOWN,this.show_)}};goog.ui.PopupColorPicker.prototype.detach=function(a){if(this.showOnHover_){this.getHandler().unlisten(a,goog.events.EventType.MOUSEOVER,this.show_)}else{this.getHandler().unlisten(a,goog.events.EventType.MOUSEOVER,this.show_)}};goog.ui.PopupColorPicker.prototype.getSelectedColor=function(){return this.colorPicker_.getSelectedColor()};goog.ui.PopupColorPicker.prototype.setFocusable=function(a){this.focusable_=a;if(this.colorPicker_){this.colorPicker_.setFocusable(a)}};goog.ui.PopupColorPicker.prototype.setAllowAutoFocus=function(a){this.allowAutoFocus_=a};goog.ui.PopupColorPicker.prototype.getAllowAutoFocus=function(){return this.allowAutoFocus_};goog.ui.PopupColorPicker.prototype.setToggleMode=function(a){this.toggleMode_=a};goog.ui.PopupColorPicker.prototype.getToggleMode=function(){return this.toggleMode_};goog.ui.PopupColorPicker.prototype.setRememberSelection=function(a){this.rememberSelection_=a};goog.ui.PopupColorPicker.prototype.getRememberSelection=function(){return this.rememberSelection_};goog.ui.PopupColorPicker.prototype.addColors=function(a){};goog.ui.PopupColorPicker.prototype.clearColors=function(){};goog.ui.PopupColorPicker.prototype.setPinnedCorner=function(a){this.pinnedCorner_=a;if(this.popup_){this.popup_.setPinnedCorner(this.pinnedCorner_)}};goog.ui.PopupColorPicker.prototype.setPopupCorner=function(a){this.popupCorner_=a};goog.ui.PopupColorPicker.prototype.setShowOnHover=function(a){this.showOnHover_=a};goog.ui.PopupColorPicker.prototype.show_=function(a){if(!this.initialized_){this.colorPicker_=this.colorPicker_||goog.ui.ColorPicker.createSimpleColorGrid(this.getDomHelper());this.colorPicker_.setFocusable(this.focusable_);this.addChild(this.colorPicker_,true);this.getHandler().listen(this.colorPicker_,goog.ui.ColorPicker.EventType.CHANGE,this.onColorPicked_);this.initialized_=true}if(this.popup_.isOrWasRecentlyVisible()&&this.toggleMode_&&this.lastTarget_==a.currentTarget){this.popup_.setVisible(false);return}this.lastTarget_=(a.currentTarget);this.popup_.setPosition(new goog.positioning.AnchoredPosition(this.lastTarget_,this.popupCorner_));if(!this.rememberSelection_){this.colorPicker_.setSelectedIndex(-1)}this.popup_.setVisible(true);if(this.allowAutoFocus_){this.colorPicker_.focus()}};goog.ui.PopupColorPicker.prototype.onColorPicked_=function(a){if(this.colorPicker_.getSelectedIndex()==-1){a.stopPropagation();return}this.popup_.setVisible(false);if(this.allowAutoFocus_){this.lastTarget_.focus()}};goog.provide("au.upldr.imaging.imageEditor.DrawPenBase");goog.require("au.upldr.imaging.TracerItem");goog.require("au.upldr.imaging.Transform");goog.require("au.upldr.imaging.Bounds");goog.require("au.upldr.imaging.TracerItem");goog.require("au.upldr.imaging.Point");au.upldr.imaging.imageEditor.DrawPenBase=function(){this.tracer_=null;this.points_={};this.context_=null;this.brushSize_=0;this.brushColor_="";this.transform_=new au.upldr.imaging.Transform(0,0,1,100,100,0,100,100);this.pointerCanvasContext_=goog.dom.createDom("canvas").getContext("2d");this.drawing_=false};au.upldr.imaging.imageEditor.DrawPenBase.prototype.getType=function(){throw"not implemented"};au.upldr.imaging.imageEditor.DrawPenBase.prototype.getPointerCanvasContext=function(){return this.pointerCanvasContext_};au.upldr.imaging.imageEditor.DrawPenBase.prototype.updatePointer=function(){this.context_.canvas.style.cursor="url("+this.getPointerCanvasContext().canvas.toDataURL()+")"+this.getSize()/2+" "+this.getSize()/2+",default"};au.upldr.imaging.imageEditor.DrawPenBase.prototype.getSize=function(){return this.brushSize_};au.upldr.imaging.imageEditor.DrawPenBase.prototype.setSize=function(a){this.brushSize_=a};au.upldr.imaging.imageEditor.DrawPenBase.prototype.getColor=function(){return this.brushColor_};au.upldr.imaging.imageEditor.DrawPenBase.prototype.setColor=function(a){this.brushColor_=a};au.upldr.imaging.imageEditor.DrawPenBase.prototype.getContext=function(){return this.context_};au.upldr.imaging.imageEditor.DrawPenBase.prototype.setContext=function(a){this.context_=a};au.upldr.imaging.imageEditor.DrawPenBase.prototype.move=function(a,b){};au.upldr.imaging.imageEditor.DrawPenBase.prototype.isDrawing=function(){return this.drawing_};au.upldr.imaging.imageEditor.DrawPenBase.prototype.start=function(a,b){this.drawing_=true};au.upldr.imaging.imageEditor.DrawPenBase.prototype.stop=function(a,b){this.drawing_=false};au.upldr.imaging.imageEditor.DrawPenBase.prototype.click=function(a,b){};au.upldr.imaging.imageEditor.DrawPenBase.prototype.attachTracer=function(a){this.tracer_=a};au.upldr.imaging.imageEditor.DrawPenBase.prototype.trace=function(b,g){if(this.tracer_){var f=Math.round((this.transform_.scale*b)+this.transform_.x);var e=Math.round((this.transform_.scale*g)+this.transform_.y);var c=/90|270/.test(this.transform_.angle)?this.transform_.scaledHeight:this.transform_.scaledWidth;var d=/90|270/.test(this.transform_.angle)?this.transform_.scaledWidth:this.transform_.scaledHeight;var a=new au.upldr.imaging.Point(f,e).rotateAt(-this.transform_.angle,c/2,d/2);this.points_[a.x+"_"+a.y]=a}};au.upldr.imaging.imageEditor.DrawPenBase.prototype.isSingleClickTraced=function(){return Object.keys((this.points_)).length==1||Object.keys((this.points_)).length==2};au.upldr.imaging.imageEditor.DrawPenBase.prototype.traceStop=function(){if(this.tracer_){var a=Object.keys((this.points_)).map(function(b){return this.points_[b]}.bind(this));this.tracer_.push(new au.upldr.imaging.TracerItem(this.getType(),Math.round(this.brushSize_*this.transform_.scale),this.brushColor_,a));this.points_={}}};au.upldr.imaging.imageEditor.DrawPenBase.prototype.setTransform=function(a){this.transform_=a};goog.provide("au.upldr.imaging.imageEditor.Pencil");goog.require("au.upldr.imaging.imageEditor.DrawPenBase");goog.require("au.upldr.imaging.Transform");goog.require("au.upldr.imaging.Bounds");goog.require("au.upldr.imaging.TracerItem");goog.require("au.upldr.imaging.Point");au.upldr.imaging.imageEditor.Pencil=function(){goog.base(this)};goog.inherits(au.upldr.imaging.imageEditor.Pencil,au.upldr.imaging.imageEditor.DrawPenBase);au.upldr.imaging.imageEditor.Pencil.prototype.getType=function(){return au.upldr.imaging.dictionary.PENCIL};au.upldr.imaging.imageEditor.Pencil.prototype.updatePointer=function(){var c=this.getSize();var b=c/2;var a=this.getPointerCanvasContext();a.canvas.width=c;a.canvas.height=c;this.drawCircle_(a,b,b,b);goog.base(this,"updatePointer")};au.upldr.imaging.imageEditor.Pencil.prototype.drawCircle_=function(b,a,d,c){this.getContext().closePath();this.getContext().beginPath();b.strokeStyle=this.getColor();b.fillStyle=this.getColor();b.arc(a,d,c,0,2*Math.PI,false);b.fill()};au.upldr.imaging.imageEditor.Pencil.prototype.move=function(a,b){if(this.isDrawing()){goog.base(this,"move",a,b);this.getContext().lineTo(a,b);this.getContext().stroke();this.trace(a,b)}};au.upldr.imaging.imageEditor.Pencil.prototype.start=function(a,b){goog.base(this,"start",a,b);this.getContext().closePath();this.getContext().globalCompositeOperation="source-over";this.getContext().strokeStyle=this.getColor();this.getContext().lineWidth=this.getSize();this.getContext().lineCap="round";this.getContext().lineJoin="round";this.getContext().moveTo(a,b);this.getContext().beginPath();this.trace(a,b)};au.upldr.imaging.imageEditor.Pencil.prototype.stop=function(a,b){goog.base(this,"stop",a,b);if(this.isSingleClickTraced()){this.click(a,b)}else{this.move(a,b)}this.getContext().closePath();this.traceStop()};au.upldr.imaging.imageEditor.Pencil.prototype.click=function(a,b){goog.base(this,"click",a,b);this.getContext().globalCompositeOperation="source-over";this.drawCircle_(this.getContext(),a,b,this.getSize()/2)};goog.provide("au.upldr.imaging.imageEditor.Eraser");goog.require("au.upldr.imaging.imageEditor.DrawPenBase");goog.require("au.upldr.imaging.Transform");goog.require("au.upldr.imaging.Bounds");goog.require("au.upldr.imaging.TracerItem");goog.require("au.upldr.imaging.Point");au.upldr.imaging.imageEditor.Eraser=function(){goog.base(this)};goog.inherits(au.upldr.imaging.imageEditor.Eraser,au.upldr.imaging.imageEditor.DrawPenBase);au.upldr.imaging.imageEditor.Eraser.prototype.getType=function(){return au.upldr.imaging.dictionary.ERASER};au.upldr.imaging.imageEditor.Eraser.prototype.updatePointer=function(){var c=this.getSize();var a=this.getPointerCanvasContext();var b=this.getPointerCanvasContext().canvas;b.width=c;b.height=c;a.fillStyle="white";a.lineWidth=5;a.strokeStyle="black";a.beginPath();a.rect(0,0,c,c);a.fill();a.stroke();goog.base(this,"updatePointer")};au.upldr.imaging.imageEditor.Eraser.prototype.draw=function(a,b){this.getContext().globalCompositeOperation="destination-out";this.getContext().fillRect(a-this.brushSize_/2,b-this.brushSize_/2,this.brushSize_,this.brushSize_)};au.upldr.imaging.imageEditor.Eraser.prototype.move=function(a,b){goog.base(this,"move",a,b);this.draw(a,b);this.trace(a,b)};au.upldr.imaging.imageEditor.Eraser.prototype.start=function(a,b){goog.base(this,"start",a,b);this.draw(a,b)};au.upldr.imaging.imageEditor.Eraser.prototype.stop=function(a,b){goog.base(this,"stop",a,b);this.draw(a,b);this.trace(a,b);this.traceStop()};au.upldr.imaging.imageEditor.Eraser.prototype.click=function(a,b){goog.base(this,"click",a,b)};goog.provide("au.upldr.imaging.CanvasUtil");goog.require("au.upldr.imaging.Transform");goog.require("au.upldr.imaging.Bounds");goog.require("au.upldr.imaging.TracerItem");goog.require("au.upldr.imaging.Point");goog.require("au.upldr.imaging.imageEditor.Pencil");goog.require("au.upldr.imaging.imageEditor.Eraser");au.upldr.imaging.CanvasUtil=function(){};au.upldr.imaging.CanvasUtil.imageToRotatedCanvas=function(f,g){if(g){var c=(goog.dom.createElement("canvas"));var d=c.getContext("2d");var b=!(g%180);d.save();g=g*Math.PI/180;var e=b?f.width:f.height;var a=b?f.height:f.width;c.width=e;c.height=a;d.translate(c.width/2,c.height/2);d.rotate(g);d.drawImage(f,-f.width/2,-f.height/2);d.restore();return c}return f};au.upldr.imaging.CanvasUtil.cropImage=function(c,i,f,j,d){var b=goog.dom.createElement("canvas");b.width=j;b.height=d;var a=b.getContext("2d");var g=b.width/2-j/2;var e=b.height/2-d/2;a.drawImage(c,i,f,j,d,g,e,j,d);return b};au.upldr.imaging.CanvasUtil.drawImageScaled=function(d,b,c,a){if(d.width>c||d.height>a){return au.upldr.imaging.CanvasUtil.downScaleImage(d,b,c,a)}else{return au.upldr.imaging.CanvasUtil.upScaleImage(d,b,c,a)}};au.upldr.imaging.CanvasUtil.drawBg=function(c,b){if(b!=null){var a=c.getContext("2d");a.save();a.fillStyle=au.upldr.utils.numberToHexColor(b);a.fillRect(0,0,c.width,c.height);a.restore()}};au.upldr.imaging.CanvasUtil.drawImageScaledForCrop=function(h,d,f,a,c){var b=d.getContext("2d");if(h.width>f||h.width>f){var g=au.upldr.imaging.CanvasUtil.generateCanvasContext(f,a).canvas;au.upldr.imaging.CanvasUtil.createFromImage(h,au.upldr.image.FitMode.FIT,f,a,null,0,g);au.upldr.imaging.CanvasUtil.drawBg(d,c);b.drawImage(g,(d.width-g.width)/2,(d.height-g.height)/2)}else{var e=Math.min(h.width/h.height,h.height/h.width);if(f<a){d.height=a;d.width=a*e}else{d.height=f*e;d.width=f}au.upldr.imaging.CanvasUtil.drawBg(d,c);b.drawImage(h,(d.width-h.width)/2,(d.height-h.height)/2)}return 1};au.upldr.imaging.CanvasUtil.downScaleImage=function(g,b,e,a){b.getContext("2d").clearRect(0,0,b.width,b.height);au.upldr.imaging.CanvasUtil.createFromImage(g,au.upldr.image.FitMode.FIT,e,a,null,0,b);var f=g.width/b.width;var d=g.height/b.height;var c=Math.min(f,d);return c};au.upldr.imaging.CanvasUtil.upScaleImage=function(h,c,f,a){var g=f/h.width;var e=a/h.height;var d=Math.min(g,e);c.width=h.width*d;c.height=h.height*d;var b=c.getContext("2d");b.clearRect(0,0,c.width,c.height);b.drawImage(h,0,0,h.width,h.height,0,0,c.width,c.height);return d};au.upldr.imaging.CanvasUtil.detectSubsampling=function(f){if(!au.upldr.imaging.CanvasUtil.isMobileSafari()){return false}var c=f.naturalWidth,e=f.naturalHeight;if(c*e<1024*1024){return false}var d=document.createElement("canvas");d.width=d.height=1;var b=d.getContext("2d");b.drawImage(f,-c+1,0);var a=b.getImageData(0,0,1,1).data[3]===0;goog.dom.removeNode(d);return a};au.upldr.imaging.CanvasUtil.isMobileSafari=function(){return !!(navigator.userAgent.match(/(iPod|iPhone|iPad)/)&&navigator.userAgent.match(/AppleWebKit/))};au.upldr.imaging.CanvasUtil.generateCanvasContext=function(c,a){var b=document.createElement("canvas");b.width=c;b.height=a;return b.getContext("2d")};au.upldr.imaging.CanvasUtil.createFromImage=function(r,s,t,o,j,z,f){f=f||(goog.dom.createElement("canvas"));if(r.width>0&&r.height>0){if((r instanceof Image||r instanceof HTMLImageElement)&&au.upldr.imaging.CanvasUtil.detectSubsampling(r)){return null}var c=(au.upldr.image.getThumbnailSize(r.width,r.height,t,o,z,s));f.width=Math.round(c.width);f.height=Math.round(c.height);var d;var b;var u;try{u=f.getContext("2d");var n=r,q=n.width,A=n.height;var y=au.upldr.image.getThumbnailSize(q,A,t,o,0,s);d=document.createElement("canvas");b=document.createElement("canvas");var v=2;while((q=Math.floor(q/v))>Math.round(y.width)&&(A=Math.floor(A/v))>Math.round(y.height)){d.width=q;d.height=A;d.getContext("2d").drawImage(n,0,0,q,A);n=d;d=b;b=n}if(j!=null){u.save();u.fillStyle=au.upldr.utils.numberToHexColor(j);u.fillRect(0,0,c.width,c.height);u.restore()}var i=!(z%180);z=z*Math.PI/180;var a=Math.sin(z);var e=Math.cos(z);u.setTransform(e,a,-a,e,c.width/2,c.height/2);var m=i?c.width:c.height;var x=i?c.height:c.width;u.drawImage(n,-m/2,-x/2,m,x);var l=document.createElement("canvas");l.width=f.width;l.height=f.height;l.getContext("2d").drawImage(f,0,0);return l}catch(g){}finally{u=null;goog.dom.removeNode((d));goog.dom.removeNode((b));d=null;b=null}}return null};au.upldr.imaging.CanvasUtil.drawTracerPoints=function(a,c,b){a.forEach(function(d){au.upldr.imaging.CanvasUtil.drawTracerData_(d,c,b)})};au.upldr.imaging.CanvasUtil.drawTracerData_=function(a,d,c){var e=null;switch(a.type){case au.upldr.imaging.imageEditor.Pencil.prototype.getType():e=new au.upldr.imaging.imageEditor.Pencil();break;case au.upldr.imaging.imageEditor.Eraser.prototype.getType():e=new au.upldr.imaging.imageEditor.Eraser();break}if(e!=null){e.setContext((d.getContext("2d")));e.setColor(a.color);e.setSize(a.size/c.scale);var b;a.points.forEach(function(g,f,h){b=g.rotateAt(c.angle,c.scaledWidth/2,c.scaledHeight/2).transform(c);if(h.length==1||h.length==2){e.click(b.x,b.y)}if(f==0){e.start(b.x,b.y)}else{if(f==h.length-1){e.stop(b.x,b.y)}else{e.move(b.x,b.y)}}})}};au.upldr.imaging.CanvasUtil.fitImage=function(e,b,k,l,d,a){if(e&&e.width<=0&&e.height<=0){return null}if(a&&(a.width<=1||a.height<=1)){return null}var j,i,c,h=e.width,g=e.height;e=au.upldr.imaging.CanvasUtil.imageToRotatedCanvas(e,d);if(a){var f=au.upldr.imaging.CanvasUtil.cropImage(e,a.left,a.top,a.width,a.height);au.upldr.imaging.CanvasUtil.drawImageScaled(f,b,k,l);c=Math.min(a.width/b.width,a.height/b.height);j=a.left;i=a.top}else{c=au.upldr.imaging.CanvasUtil.drawImageScaled(e,b,k,l);c=e.width<k||e.height<l?1/c:c;j=0;i=0}return new au.upldr.imaging.Transform(j,i,c,b.width,b.height,d,h,g)};au.upldr.imaging.CanvasUtil.getImage=function(i,d,a,g,c,f,e,b,h){if(e==au.upldr.image.FitMode.CROP){return au.upldr.imaging.CanvasUtil.getImageForFitmodeCrop(i,d,a,g,c,f,h)}else{return au.upldr.imaging.CanvasUtil.getEditedImage(i,d,a,g,c,f,e,b,h)}};au.upldr.imaging.CanvasUtil.getEditedImage=function(m,f,b,k,e,j,g,c,l){l=typeof l=="undefined"?true:l;c=typeof c=="undefined"?true:c;var a=m.getCropBounds();if(!c||!a){a=new au.upldr.imaging.Bounds(0,0,f.width,f.height)}a=a.rotateAt(e,f.width/2,f.height/2);var o=(au.upldr.image.getThumbnailSize(a.width,a.height,b,k,e,g));var i=au.upldr.imaging.CanvasUtil.generateCanvasContext(o.width,o.height);var d=au.upldr.imaging.CanvasUtil.fitImage(f,i.canvas,o.width,o.height,e,a);var h=au.upldr.imaging.CanvasUtil.generateCanvasContext(i.canvas.width,i.canvas.height);var n=au.upldr.imaging.CanvasUtil.generateCanvasContext(i.canvas.width,i.canvas.height);if(l){au.upldr.imaging.CanvasUtil.drawTracerPoints(m.getDrawingPoints(),h.canvas,d)}if(j!=null){n.save();n.fillStyle=au.upldr.utils.numberToHexColor(j);n.fillRect(0,0,n.width,n.height);n.restore()}n.drawImage(i.canvas,0,0);if(l){n.drawImage(h.canvas,0,0)}return n.canvas};au.upldr.imaging.CanvasUtil.getImageForFitmodeCrop=function(k,f,c,i,e,h,j){j=typeof j=="undefined"?true:j;h=h||0;f=au.upldr.imaging.CanvasUtil.imageToRotatedCanvas(f,e);var m=(au.upldr.image.getThumbnailSize(f.width,f.height,c,i,0,au.upldr.image.FitMode.CROP));var a=new au.upldr.imaging.Bounds(Math.abs(f.height-m.height)/2,Math.abs(f.width-m.width)/2,m.width,m.height);var b=au.upldr.imaging.CanvasUtil.cropImage(f,a.left,a.top,a.width,a.height);if(j){var d=new au.upldr.imaging.Transform(a.left,a.top,1,b.width,b.height,e,f.width,f.height);var g=au.upldr.imaging.CanvasUtil.generateCanvasContext(b.width,b.height);au.upldr.imaging.CanvasUtil.drawTracerPoints(k.getDrawingPoints(),g.canvas,d);b.getContext("2d").drawImage(g.canvas,0,0)}var l=au.upldr.imaging.CanvasUtil.generateCanvasContext(c,i);au.upldr.imaging.CanvasUtil.drawImageScaledForCrop(b,l.canvas,c,i,h);return l.canvas};au.upldr.imaging.CanvasUtil.updateCanvasAngle=function(d,f){var e=["-webkit-transform","-moz-transform","-ms-transform","-o-transform","transform"];var a=["webkitTransform","mozTransform","msTransform","oTransform","transform"];goog.array.forEach(e,function(g){goog.style.setStyle(d,g,"")});var b="";for(var c=0;c<a.length;c++){b=goog.style.getComputedStyle(d,a[c]);b=b?b:"";if(b&&b!=""){break}}b+=" rotate("+f+"deg)";goog.array.forEach(e,function(g){goog.style.setStyle(d,g,b)})};goog.provide("au.upldr.imaging.imageEditor.CropArea");goog.provide("au.upldr.imaging.imageEditor.CropArea.EventType");goog.require("goog.functions");goog.require("goog.log");goog.require("goog.ui.Component");goog.require("goog.style");goog.require("goog.ui.PopupBase");goog.require("goog.positioning.Corner");goog.require("goog.ui.Button");goog.require("goog.ui.Css3ButtonRenderer");goog.require("goog.ui.Component.EventType");goog.require("goog.ui.ProgressBar");goog.require("au.upldr.Properties");goog.require("au.upldr.ui.ClassNames");goog.require("au.upldr.ui.ClassNamesCompat");goog.require("au.upldr.imaging.CanvasUtil");goog.require("au.upldr.imaging.Transform");goog.require("au.upldr.imaging.Bounds");goog.require("au.upldr.imaging.TracerItem");goog.require("au.upldr.imaging.Point");goog.require("au.upldr.ui.ClassNamesImaging");au.upldr.imaging.imageEditor.CropArea=function(c,b,d,a){goog.base(this);this.propertyHolder_=c.getPropertyHolder();this.image_=new Image();this.canvas_=b;this.width_=d;this.height_=a;this.currentViewPortBounds_=null;this.angle_=0;this.refresh_=false;this.isCropFrameVisible_=(this.propertyHolder_.getProperty(au.upldr.Properties.IMAGE_EDITOR_ENABLE_CROP));this.setModel(c)};goog.inherits(au.upldr.imaging.imageEditor.CropArea,goog.ui.Component);au.upldr.imaging.imageEditor.CropArea.CSS_CLASS=au.upldr.ui.ClassNames.CROP_AREA;au.upldr.imaging.imageEditor.CropArea.prototype.getCssClass=function(){return au.upldr.imaging.imageEditor.CropArea.CSS_CLASS};au.upldr.imaging.imageEditor.CropArea.prototype.setImage=function(a){this.image_=a};au.upldr.imaging.imageEditor.CropArea.prototype.getImage=function(){return this.image_};au.upldr.imaging.imageEditor.CropArea.prototype.setEnabled=function(a){goog.style.setElementShown(this.selFrame_,a);this.unlistenMouseEvent_();if(a){this.listenMouseEvent_()}this.isCropFrameVisible_=a};au.upldr.imaging.imageEditor.CropArea.prototype.isEnabled=function(){return this.isCropFrameVisible_};au.upldr.imaging.imageEditor.CropArea.prototype.initVars_=function(){this.reInitVars_(0,0);this.innerMargin_=0;this.minSize_=this.propertyHolder_.getProperty(au.upldr.Properties.IMAGE_EDITOR_CROP_MIN_SIZE);this.propertyHolder_.observe(au.upldr.Properties.IMAGE_EDITOR_CROP_MIN_SIZE,function(){this.minSize_=this.propertyHolder_.getProperty(au.upldr.Properties.IMAGE_EDITOR_CROP_MIN_SIZE)}.bind(this));this.propertyHolder_.observe(au.upldr.Properties.IMAGE_EDITOR_CROP_RATIO,function(){this.parseRatio_()}.bind(this));this.isProcessing_=false};au.upldr.imaging.imageEditor.CropArea.prototype.parseRatio_=function(){var ratioStr=""+this.propertyHolder_.getProperty(au.upldr.Properties.IMAGE_EDITOR_CROP_RATIO);this.isOrientationFixed_=/fixed/i.test(ratioStr);var isRatioOriginal=/orig/i.test(ratioStr);var cleanedRatio=ratioStr.replace(/:+/g,"/").replace(/,+/g,".").replace(/[^\d/\.]+/g,"");var defaultRatio=(this.image_.width/this.image_.height);if(isRatioOriginal){this.isWithAspectRatio_=true;this.ratio_=defaultRatio}else{if(cleanedRatio!=""){this.isWithAspectRatio_=true;this.ratio_=(eval(cleanedRatio));if(this.ratio_==null||this.ratio_==0){this.ratio_=defaultRatio;return}if(/90|270/.test(this.angle_)){defaultRatio=1/defaultRatio}if((this.ratio_>1&&defaultRatio<1||this.ratio_<1&&defaultRatio>1)&&!this.isOrientationFixed_){this.ratio_=1/this.ratio_}}else{this.isWithAspectRatio_=false;this.ratio_=defaultRatio}}};au.upldr.imaging.imageEditor.CropArea.prototype.reInitVars_=function(a,b){this.lastX_=a;this.lastY_=b;this.isMove_=false;this.isResize_=false;this.resizeDirection_=""};au.upldr.imaging.imageEditor.CropArea.prototype.onMouseDown_=function(a){a.preventDefault();this.reInitVars_(a.clientX,a.clientY);this.listenDragEvent_()};au.upldr.imaging.imageEditor.CropArea.prototype.onMouseUp_=function(a){a.preventDefault();if(this.isMove_){this.dispatchEvent(new goog.events.Event(au.upldr.imaging.imageEditor.CropArea.EventType.MOVE_DONE))}else{if(this.isResize_){this.dispatchEvent(new goog.events.Event(au.upldr.imaging.imageEditor.CropArea.EventType.RESIZE_DONE))}}this.reInitVars_(a.clientX,a.clientY);this.unlistenDragEvent_()};au.upldr.imaging.imageEditor.CropArea.prototype.onMouseMove_=function(a){if(this.isProcessing_){return}this.isProcessing_=true;window.setTimeout(function(){var b=a.target.className;if(!this.isMove_&&!this.isResize_){this.isMove_=b.indexOf(au.upldr.ui.ClassNamesImaging.BORDER)>-1;this.isResize_=b.indexOf(au.upldr.ui.ClassNamesImaging.HANDLE)>-1}if(this.isMove_){this.isResize_=false;this.onElementMove_(a.clientX,a.clientY);this.dispatchEvent(new goog.events.Event(au.upldr.imaging.imageEditor.CropArea.EventType.MOVE))}else{if(this.isResize_){this.isMove_=false;this.resizeDirection_=this.resizeDirection_||b;this.onResize_(this.resizeDirection_,a.clientX,a.clientY);this.dispatchEvent(new goog.events.Event(au.upldr.imaging.imageEditor.CropArea.EventType.RESIZE))}}this.isProcessing_=false}.bind(this),10)};au.upldr.imaging.imageEditor.CropArea.prototype.onElementMove_=function(c,b){var f=this.getSelFrameBounds_();var a=f.left+c-this.lastX_;var e=f.top+b-this.lastY_;a=a<this.innerMargin_?this.innerMargin_:a;e=e<this.innerMargin_?this.innerMargin_:e;this.lastX_=c;this.lastY_=b;var d=this.selArea_.getBoundingClientRect();f.top=Math.max(this.innerMargin_,Math.min(d.height-f.height-this.innerMargin_,e));f.left=Math.max(this.innerMargin_,Math.min(d.width-f.width-this.innerMargin_,a));this.setSelFrameBounds_(f)};au.upldr.imaging.imageEditor.CropArea.prototype.onResize_=function(e,a,f){var c=Math.round(a-this.lastX_);var b=Math.round(f-this.lastY_);this.lastX_=a;this.lastY_=f;var d=this.getNewBounds_(e,c,b);this.setSelFrameBounds_(d)};au.upldr.imaging.imageEditor.CropArea.prototype.multiplyOnRatio_=function(e,d,b){var a,c;if(b){a=e.width;c=e.width/d}else{a=e.height*d;c=e.height}return new au.upldr.imaging.Bounds(e.top,e.left,a,c)};au.upldr.imaging.imageEditor.CropArea.prototype.dimensionCorrector_=function(c,d,b){b=!!b;var a=new au.upldr.imaging.Bounds(c.top,c.left,c.width,c.height);this.applyMinSizeLimit_(a);if(a.top<0){a.height+=a.top;a.top=0}if(a.left<0){a.width+=a.left;a.left=0}if(a.top+a.height>this.canvas_.height){a.height=this.canvas_.height-a.top}if(a.left+c.width>this.canvas_.width){a.width=this.canvas_.width-a.left}if(d){a=this.multiplyOnRatio_(a,this.ratio_,b)}return this.inscribeRect((this.canvas_.width-a.left),(this.canvas_.height-a.top),a)};au.upldr.imaging.imageEditor.CropArea.prototype.inscribeRect=function(c,a,f){var e=c/f.width;var b=a/f.height;var d=Math.min(e,b);if(d<1){return new au.upldr.imaging.Bounds(f.top,f.left,f.width*d,f.height*d)}return f};au.upldr.imaging.imageEditor.CropArea.prototype.applyPointerPositionDelta_=function(c,d,b,a){switch(d){case au.upldr.ui.ClassNamesImaging.HANDLE_TOP_LEFT:c.top+=a;c.left+=b;c.width-=b;c.height-=a;break;case au.upldr.ui.ClassNamesImaging.HANDLE_BOTTOM_LEFT:c.left+=b;c.width-=b;c.height+=a;break;case au.upldr.ui.ClassNamesImaging.HANDLE_TOP_RIGHT:c.top+=a;c.width+=b;c.height-=a;break;case au.upldr.ui.ClassNamesImaging.HANDLE_BOTTOM_RIGHT:c.width+=b;c.height+=a;break;case au.upldr.ui.ClassNamesImaging.HANDLE_TOP_CENTER:c.top+=a;c.height-=a;break;case au.upldr.ui.ClassNamesImaging.HANDLE_LEFT_CENTER:c.left+=b;c.width-=b;break;case au.upldr.ui.ClassNamesImaging.HANDLE_RIGHT_CENTER:c.width+=b;break;case au.upldr.ui.ClassNamesImaging.HANDLE_BOTTOM_CENTER:c.height+=a;break}};au.upldr.imaging.imageEditor.CropArea.prototype.applyMinSizeLimit_=function(d){var e=this.resizeDirection_;var b=this.getSelFrameBounds_();if(d.width<0||d.height<0){var f=this.selFrame_.getBoundingClientRect();if(b.width<0){var c=!/right/.test(e);if(c){this.lastX_=f.left+f.width;b.left=b.width+b.left}else{this.lastX_=f.left}b.width=0}if(b.height<0){var a=!/bottom/.test(e);if(a){this.lastY_=f.top+f.height;d.top=b.top+b.height}else{this.lastY_=f.top}b.height=0}this.resizeDirection_=this.oppositeHandlersDictionary[e](d.width,d.height);d.top=b.top;d.left=b.left;d.width=b.width;d.height=b.height}};au.upldr.imaging.imageEditor.CropArea.prototype.getNewBounds_=function(e,c,b){var d=this.getSelFrameBounds_();var a=this.getSelFrameBounds_();this.applyPointerPositionDelta_(d,e,c,b);if(this.minSize_>0&&(d.width<=this.minSize_||d.height<=this.minSize_)){return a}d=this.dimensionCorrector_(d,this.isWithAspectRatio_,c!=0);return this.inscribeRectAfterAll(a,d)};au.upldr.imaging.imageEditor.CropArea.prototype.inscribeRectTopLeft=function(d){var c=(d.left+d.width)/d.width;var a=(d.top+d.height)/d.height;var b=Math.min(c,a);if(b<1){return new au.upldr.imaging.Bounds(d.top<0?0:d.top,d.left<0?0:d.left,d.width*b,d.height*b)}return d};au.upldr.imaging.imageEditor.CropArea.prototype.inscribeRectAfterAll=function(c,e){var g=(c.height+c.top)-(e.height+e.top);var d=(c.width+c.left)-(e.width+e.left);var b=c.top-e.top;var f=c.left-e.left;var a=new au.upldr.imaging.Bounds(e.top,e.left,e.width,e.height);switch(this.resizeDirection_){case au.upldr.ui.ClassNamesImaging.HANDLE_TOP_LEFT:a.top+=g;a.left+=d;break;case au.upldr.ui.ClassNamesImaging.HANDLE_TOP_RIGHT:a.top+=g;a.left+=f;break;case au.upldr.ui.ClassNamesImaging.HANDLE_BOTTOM_LEFT:a.left+=d;a.top+=b;break;case au.upldr.ui.ClassNamesImaging.HANDLE_TOP_CENTER:if(this.isWithAspectRatio_&&(a.left+a.width)==this.canvas_.width){a.top=c.top}break}return this.inscribeRectTopLeft(a)};au.upldr.imaging.imageEditor.CropArea.prototype.oppositeHandlersDictionary=(function(){var a=({});a[au.upldr.ui.ClassNamesImaging.HANDLE_TOP_LEFT]=function(c,b){if(c<=0&&b<=0){return au.upldr.ui.ClassNamesImaging.HANDLE_BOTTOM_RIGHT}if(c<=0){return au.upldr.ui.ClassNamesImaging.HANDLE_TOP_RIGHT}if(b<=0){return au.upldr.ui.ClassNamesImaging.HANDLE_BOTTOM_LEFT}};a[au.upldr.ui.ClassNamesImaging.HANDLE_BOTTOM_LEFT]=function(c,b){if(c<=0&&b<=0){return au.upldr.ui.ClassNamesImaging.HANDLE_TOP_RIGHT}if(c<=0){return au.upldr.ui.ClassNamesImaging.HANDLE_BOTTOM_RIGHT}if(b<=0){return au.upldr.ui.ClassNamesImaging.HANDLE_TOP_LEFT}};a[au.upldr.ui.ClassNamesImaging.HANDLE_TOP_RIGHT]=function(c,b){if(c<=0&&b<=0){return au.upldr.ui.ClassNamesImaging.HANDLE_BOTTOM_LEFT}if(c<=0){return au.upldr.ui.ClassNamesImaging.HANDLE_TOP_LEFT}if(b<=0){return au.upldr.ui.ClassNamesImaging.HANDLE_BOTTOM_RIGHT}};a[au.upldr.ui.ClassNamesImaging.HANDLE_BOTTOM_RIGHT]=function(c,b){if(c<=0&&b<=0){return au.upldr.ui.ClassNamesImaging.HANDLE_TOP_LEFT}if(c<=0){return au.upldr.ui.ClassNamesImaging.HANDLE_BOTTOM_LEFT}if(b<=0){return au.upldr.ui.ClassNamesImaging.HANDLE_TOP_RIGHT}};a[au.upldr.ui.ClassNamesImaging.HANDLE_TOP_CENTER]=function(c,b){return au.upldr.ui.ClassNamesImaging.HANDLE_BOTTOM_CENTER};a[au.upldr.ui.ClassNamesImaging.HANDLE_LEFT_CENTER]=function(c,b){return au.upldr.ui.ClassNamesImaging.HANDLE_RIGHT_CENTER};a[au.upldr.ui.ClassNamesImaging.HANDLE_RIGHT_CENTER]=function(c,b){return au.upldr.ui.ClassNamesImaging.HANDLE_LEFT_CENTER};a[au.upldr.ui.ClassNamesImaging.HANDLE_BOTTOM_CENTER]=function(c,b){return au.upldr.ui.ClassNamesImaging.HANDLE_TOP_CENTER};return a})();au.upldr.imaging.imageEditor.CropArea.prototype.changeOrientation_=function(a){if(a||!this.isOrientationFixed_){this.toggleOrientation()}};au.upldr.imaging.imageEditor.CropArea.prototype.init=function(b,a,c){this.setImage(b);this.setAngle(c);this.parseRatio_();this.setViewPort(a)};au.upldr.imaging.imageEditor.CropArea.prototype.reinitSelFrame=function(){var a=new au.upldr.imaging.Bounds(0,0,Math.max(this.canvas_.width,this.canvas_.height),Math.max(this.canvas_.width,this.canvas_.height));a=this.dimensionCorrector_(a,this.isWithAspectRatio_);a.left=(this.canvas_.width-a.width)/2;a.top=(this.canvas_.height-a.height)/2;this.setSelFrameBounds_(a)};au.upldr.imaging.imageEditor.CropArea.prototype.toggleOrientation=function(){var b=this.getSelFrameBounds_();var a=new au.upldr.imaging.Bounds(b.top,b.left,b.height,b.width);this.ratio_=1/this.ratio_;this.setSelFrameBounds_(this.dimensionCorrector_(a,this.isWithAspectRatio_))};au.upldr.imaging.imageEditor.CropArea.prototype.getSelFrameBounds_=function(){var c=window.getComputedStyle(this.selFrame_);var b=+c.width.replace("px","");var a=+c.height.replace("px","");var e=+c.top.replace("px","");var d=+c.left.replace("px","");return new au.upldr.imaging.Bounds(e,d,b,a)};au.upldr.imaging.imageEditor.CropArea.prototype.setSelFrameBounds_=function(a){goog.style.setPosition(this.selFrame_,a.left,a.top);goog.style.setSize(this.selFrame_,a.width,a.height)};au.upldr.imaging.imageEditor.CropArea.prototype.setViewPortTransform=function(a){this.viewPortTransform_=a};au.upldr.imaging.imageEditor.CropArea.prototype.getViewPortTransform=function(){return this.viewPortTransform_};au.upldr.imaging.imageEditor.CropArea.prototype.setViewPortSize=function(b,a){this.width_=b;this.height_=a;this.setViewPort(this.currentViewPortBounds_)};au.upldr.imaging.imageEditor.CropArea.prototype.getViewPortSize=function(){return new goog.math.Size(this.canvas_.width,this.canvas_.height)};au.upldr.imaging.imageEditor.CropArea.prototype.initAreaEvents_=function(){this.onMouseDownHandler_=this.onMouseDown_.bind(this);this.changeOrientationHandler_=function(){this.changeOrientation_(false)}.bind(this);this.onMouseUpHandler_=this.onMouseUp_.bind(this);this.onMouseMoveHandler_=this.onMouseMove_.bind(this)};au.upldr.imaging.imageEditor.CropArea.prototype.listenMouseEvent_=function(){this.getHandler().listen(this.selFrame_,goog.events.EventType.MOUSEDOWN,this.onMouseDownHandler_).listen(this.selFrame_,goog.events.EventType.DBLCLICK,this.changeOrientationHandler_)};au.upldr.imaging.imageEditor.CropArea.prototype.unlistenMouseEvent_=function(){this.getHandler().unlisten(this.selFrame_,goog.events.EventType.MOUSEDOWN,this.onMouseDownHandler_).unlisten(this.selFrame_,goog.events.EventType.DBLCLICK,this.changeOrientationHandler_)};au.upldr.imaging.imageEditor.CropArea.prototype.listenDragEvent_=function(){this.getHandler().listen(document,goog.events.EventType.MOUSEUP,this.onMouseUpHandler_).listen(document,goog.events.EventType.MOUSEMOVE,this.onMouseMoveHandler_)};au.upldr.imaging.imageEditor.CropArea.prototype.unlistenDragEvent_=function(){this.getHandler().unlisten(document,goog.events.EventType.MOUSEUP,this.onMouseUpHandler_).unlisten(document,goog.events.EventType.MOUSEMOVE,this.onMouseMoveHandler_)};au.upldr.imaging.imageEditor.CropArea.prototype.createDom=function(){var a=[au.upldr.ui.ClassNamesImaging.HANDLE_TOP_LEFT,au.upldr.ui.ClassNamesImaging.HANDLE_TOP_CENTER,au.upldr.ui.ClassNamesImaging.HANDLE_TOP_RIGHT,au.upldr.ui.ClassNamesImaging.HANDLE_BOTTOM_LEFT,au.upldr.ui.ClassNamesImaging.HANDLE_BOTTOM_CENTER,au.upldr.ui.ClassNamesImaging.HANDLE_BOTTOM_RIGHT,au.upldr.ui.ClassNamesImaging.HANDLE_LEFT_CENTER,au.upldr.ui.ClassNamesImaging.HANDLE_RIGHT_CENTER,au.upldr.ui.ClassNamesImaging.GUID_LINE_HORIZONTAL_ONE,au.upldr.ui.ClassNamesImaging.GUID_LINE_HORIZONTAL_TWO,au.upldr.ui.ClassNamesImaging.GUID_LINE_VERTICAL_ONE,au.upldr.ui.ClassNamesImaging.GUID_LINE_VERTICAL_TWO,au.upldr.ui.ClassNamesImaging.GUID_LINE_BOTTOM,au.upldr.ui.ClassNamesImaging.GUID_LINE_TOP,au.upldr.ui.ClassNamesImaging.GUID_LINE_LEFT,au.upldr.ui.ClassNamesImaging.GUID_LINE_RIGHT];this.setElementInternal(this.selFrame_=goog.dom.createDom("div",au.upldr.ui.ClassNamesImaging.BORDER));goog.array.forEach(a,function(b){goog.dom.appendChild(this.selFrame_,goog.dom.createDom("div",b))},this);this.selArea_=this.getParent().getElement();this.setViewPort()};au.upldr.imaging.imageEditor.CropArea.prototype.enterDocument=function(){goog.base(this,"enterDocument");this.initVars_();this.initAreaEvents_();this.setEnabled(this.isCropFrameVisible_)};au.upldr.imaging.imageEditor.CropArea.prototype.getAngle=function(){return this.angle_};au.upldr.imaging.imageEditor.CropArea.prototype.setAngle=function(a){this.angle_=a;this.setViewPort(this.getViewPort())};au.upldr.imaging.imageEditor.CropArea.prototype.setViewPort=function(b){if(b){this.currentViewPortBounds_=b;b=b.rotateAt(this.angle_,this.image_.width/2,this.image_.height/2)}else{this.currentViewPortBounds_=null}var a=au.upldr.imaging.CanvasUtil.fitImage(this.image_,this.canvas_,this.width_,this.height_,this.angle_,b);if(!a){a=new au.upldr.imaging.Transform(0,0,1,this.canvas_.width,this.canvas_.height,this.angle_,this.image_.width,this.image_.height)}this.setViewPortTransform(a);goog.style.setSize(this.selArea_,this.canvas_.width,this.canvas_.height);this.reinitSelFrame();this.dispatchViewPortChanged_()};au.upldr.imaging.imageEditor.CropArea.prototype.dispatchViewPortChanged_=function(){var a=new goog.events.Event(au.upldr.imaging.imageEditor.CropArea.EventType.VIEW_PORT_CHANGED);this.dispatchEvent(a)};au.upldr.imaging.imageEditor.CropArea.prototype.getSelectedBounds=function(){var b=this.getViewPortTransform();var d=this.getSelFrameBounds_();this.applyRatioToSize_(d,b.scale);this.applyOffsetToPosition_(d,b.x,b.y);if(this.isWithAspectRatio_){d=this.multiplyOnRatio_(d,this.ratio_,d.width<d.height)}var a=/90|270/.test(b.angle)?this.image_.height:this.image_.width;var c=/90|270/.test(b.angle)?this.image_.width:this.image_.height;return d.rotateAt(-b.angle,a/2,c/2)};au.upldr.imaging.imageEditor.CropArea.prototype.getViewPort=function(){return this.currentViewPortBounds_};au.upldr.imaging.imageEditor.CropArea.prototype.applyRatioToSize_=function(b,a){b.top=Math.round(b.top*a);b.left=Math.round(b.left*a);b.width=Math.round(b.width*a);b.height=Math.round(b.height*a)};au.upldr.imaging.imageEditor.CropArea.prototype.applyOffsetToPosition_=function(b,a,c){b.top=Math.round(b.top+c);b.left=Math.round(b.left+a)};au.upldr.imaging.imageEditor.CropArea.prototype.clean=function(){this.canvas_.getContext("2d").clearRect(-this.canvas_.width,-this.canvas_.height,this.canvas_.width*2,this.canvas_.height*2)};au.upldr.imaging.imageEditor.CropArea.EventType={MOVE:"move",RESIZE:"resize",MOVE_DONE:"moveDone",RESIZE_DONE:"resizeDone",VIEW_PORT_CHANGED:"viewPortChanged"};goog.provide("au.upldr.imaging.imageEditor.DrawArea");goog.require("goog.functions");goog.require("goog.log");goog.require("goog.ui.Component");goog.require("goog.style");goog.require("goog.ui.PopupBase");goog.require("goog.positioning.Corner");goog.require("goog.ui.Button");goog.require("goog.ui.Css3ButtonRenderer");goog.require("goog.ui.Component.EventType");goog.require("goog.ui.ProgressBar");goog.require("au.upldr.Properties");goog.require("au.upldr.ui.ClassNames");goog.require("au.upldr.ui.ClassNamesCompat");goog.require("au.upldr.imaging.CanvasUtil");goog.require("au.upldr.imaging.Transform");goog.require("au.upldr.imaging.Bounds");goog.require("au.upldr.imaging.TracerItem");goog.require("au.upldr.imaging.Point");goog.require("au.upldr.imaging.imageEditor.DrawPenBase");goog.require("au.upldr.ui.ClassNamesImaging");au.upldr.imaging.imageEditor.DrawArea=function(b,c,a){goog.base(this);this.propertyHolder_=b.getPropertyHolder();this.drawing_=false;this.brushColor_="red";this.brushSize_=1;this.transform_=new au.upldr.imaging.Transform(0,0,1,100,100,0,100,100);this.penTool_=new au.upldr.imaging.imageEditor.Pencil();this.eraseTool_=new au.upldr.imaging.imageEditor.Eraser();this.tracer_=new Array();this.width_=c;this.height_=a;this.pen_=au.upldr.imaging.imageEditor.DrawArea.ToolType.PENCIL;this.angle_=0;this.isNeedRedrawPointer_=true;this.isDrawEnabled_=false;this.setModel(b)};goog.inherits(au.upldr.imaging.imageEditor.DrawArea,goog.ui.Component);au.upldr.imaging.imageEditor.DrawArea.CSS_CLASS=au.upldr.ui.ClassNames.DRAW_AREA;au.upldr.imaging.imageEditor.DrawArea.ToolType={PENCIL:(au.upldr.imaging.dictionary.PENCIL),ERASER:(au.upldr.imaging.dictionary.ERASER)};au.upldr.imaging.imageEditor.DrawArea.prototype.getCssClass=function(){return au.upldr.imaging.imageEditor.ImageEditor.CSS_CLASS};au.upldr.imaging.imageEditor.DrawArea.prototype.createDom=function(){this.canvas_=goog.dom.createDom("canvas",au.upldr.ui.ClassNamesImaging.DRAWING_CANVAS);this.context_=this.canvas_.getContext("2d");this.setElementInternal(this.canvas_)};au.upldr.imaging.imageEditor.DrawArea.prototype.setTransform=function(a){this.transform_=a};au.upldr.imaging.imageEditor.DrawArea.prototype.getTransform=function(){return this.transform_};au.upldr.imaging.imageEditor.DrawArea.prototype.setSize=function(b,a){this.canvas_.width=b;this.canvas_.height=a};au.upldr.imaging.imageEditor.DrawArea.prototype.setBrushSize=function(a){this.brushSize_=a;this.isNeedRedrawPointer_=true};au.upldr.imaging.imageEditor.DrawArea.prototype.getBrushSize=function(){return this.brushSize_};au.upldr.imaging.imageEditor.DrawArea.prototype.setPen=function(a){this.pen_=a;this.isNeedRedrawPointer_=true};au.upldr.imaging.imageEditor.DrawArea.prototype.setBrushColor=function(a){this.brushColor_=a;this.isNeedRedrawPointer_=true};au.upldr.imaging.imageEditor.DrawArea.prototype.getBrushColor=function(){return this.brushColor_};au.upldr.imaging.imageEditor.DrawArea.prototype.adjust=function(){this.setSize(this.transform_.width,this.transform_.height);au.upldr.imaging.CanvasUtil.drawTracerPoints(this.getTracer(),this.canvas_,this.transform_)};au.upldr.imaging.imageEditor.DrawArea.prototype.getTracer=function(){return this.tracer_};au.upldr.imaging.imageEditor.DrawArea.prototype.setTracer=function(a){this.tracer_=a};au.upldr.imaging.imageEditor.DrawArea.prototype.getAngle=function(){return this.angle_};au.upldr.imaging.imageEditor.DrawArea.prototype.setAngle=function(a){this.angle_=a};au.upldr.imaging.imageEditor.DrawArea.prototype.setEnabled=function(a){this.unlistenDrawEvents_();if(a){this.listenDrawEvents_()}else{this.canvas_.style.cursor="default"}this.isDrawEnabled_=a};au.upldr.imaging.imageEditor.DrawArea.prototype.isEnabled=function(){return this.isDrawEnabled_};au.upldr.imaging.imageEditor.DrawArea.prototype.enterDocument=function(){goog.base(this,"enterDocument");this.mouseUpHandler_=this.mouseUp_.bind(this);this.mouseMoveHandler_=this.mouseMove_.bind(this);this.mouseDownHandler_=this.mouseDown_.bind(this);this.mouseOverHandler_=this.mouseOver_.bind(this);this.mouseOutHandler_=this.mouseOut_.bind(this);this.clickHandler_=this.mouseClick_.bind(this);this.dragHandler_=this.dragStart_.bind(this);if(this.isEnabled()){this.listenDrawEvents_()}};au.upldr.imaging.imageEditor.DrawArea.prototype.listenDrawEvents_=function(){var a=this.getParent().getElement();this.getHandler().listen(document,goog.events.EventType.MOUSEUP,this.mouseUpHandler_).listen(a,goog.events.EventType.MOUSEDOWN,this.mouseDownHandler_).listen(a,goog.events.EventType.MOUSEMOVE,this.mouseMoveHandler_).listen(a,goog.events.EventType.MOUSEOVER,this.mouseOverHandler_).listen(a,goog.events.EventType.MOUSEOUT,this.mouseOutHandler_).listen(a,goog.events.EventType.DRAGSTART,this.dragHandler_,true).listen(a,goog.events.EventType.CLICK,this.clickHandler_)};au.upldr.imaging.imageEditor.DrawArea.prototype.unlistenDrawEvents_=function(){var a=this.getParent().getElement();this.getHandler().unlisten(document,goog.events.EventType.MOUSEUP,this.mouseUpHandler_).unlisten(a,goog.events.EventType.MOUSEDOWN,this.mouseDownHandler_).unlisten(a,goog.events.EventType.MOUSEMOVE,this.mouseMoveHandler_).unlisten(a,goog.events.EventType.MOUSEOVER,this.mouseOverHandler_).unlisten(a,goog.events.EventType.CLICK,this.clickHandler_).unlisten(a,goog.events.EventType.CLICK,this.dragHandler_,true)};au.upldr.imaging.imageEditor.DrawArea.prototype.mouseOver_=function(a){if(this.isNeedRedrawPointer_){this.drawingToolFactory_().updatePointer();this.isNeedRedrawPointer_=false}};au.upldr.imaging.imageEditor.DrawArea.prototype.mouseOut_=function(a){};au.upldr.imaging.imageEditor.DrawArea.prototype.dragStart_=function(a){a.preventDefault();a.stopPropagation()};au.upldr.imaging.imageEditor.DrawArea.prototype.mouseUp_=function(b){if(this.drawing_){var a=typeof b.event_.offsetX=="undefined"?b.event_.layerX:b.event_.offsetX;var c=typeof b.event_.offsetY=="undefined"?b.event_.layerY:b.event_.offsetY;this.drawingToolFactory_().stop(a,c);this.drawing_=false}};au.upldr.imaging.imageEditor.DrawArea.prototype.mouseDown_=function(b){alert(0);var a=typeof b.event_.offsetX=="undefined"?b.event_.layerX:b.event_.offsetX;var c=typeof b.event_.offsetY=="undefined"?b.event_.layerY:b.event_.offsetY;this.drawingToolFactory_().start(a,c);this.drawing_=true};au.upldr.imaging.imageEditor.DrawArea.prototype.mouseMove_=function(b){if(this.drawing_){var a=typeof b.event_.offsetX=="undefined"?b.event_.layerX:b.event_.offsetX;var c=typeof b.event_.offsetY=="undefined"?b.event_.layerY:b.event_.offsetY;this.drawingToolFactory_().move(a,c)}};au.upldr.imaging.imageEditor.DrawArea.prototype.mouseClick_=function(a){};au.upldr.imaging.imageEditor.DrawArea.prototype.drawingToolFactory_=function(){var a;switch(this.pen_){case au.upldr.imaging.imageEditor.DrawArea.ToolType.PENCIL:a=this.penTool_;break;case au.upldr.imaging.imageEditor.DrawArea.ToolType.ERASER:a=this.eraseTool_;break;default:a=this.penTool_}a.setTransform(this.transform_);a.setContext(this.context_);a.setColor(this.brushColor_);a.setSize(this.brushSize_);a.attachTracer(this.tracer_);return a};au.upldr.imaging.imageEditor.DrawArea.prototype.clean=function(){this.tracer_=[];this.canvas_.getContext("2d").clearRect(0,0,this.canvas_.width,this.canvas_.height)};goog.provide("au.upldr.imaging.imageEditor.ImageEditor");goog.require("goog.functions");goog.require("goog.log");goog.require("goog.ui.Component");goog.require("goog.style");goog.require("goog.ui.PopupBase");goog.require("goog.positioning.Corner");goog.require("goog.ui.Button");goog.require("goog.ui.Css3ButtonRenderer");goog.require("goog.ui.Component.EventType");goog.require("goog.ui.ProgressBar");goog.require("goog.math.Size");goog.require("au.upldr.Properties");goog.require("au.upldr.ui.ClassNames");goog.require("au.upldr.ui.ClassNamesCompat");goog.require("au.upldr.imaging.CanvasUtil");goog.require("au.upldr.imaging.Transform");goog.require("au.upldr.imaging.Bounds");goog.require("au.upldr.imaging.TracerItem");goog.require("au.upldr.imaging.Point");goog.require("au.upldr.imaging.imageEditor.CropArea");goog.require("au.upldr.imaging.imageEditor.DrawArea");goog.require("au.upldr.ui.ClassNamesImaging");au.upldr.imaging.imageEditor.ImageEditor=function(a){goog.base(this);this.image_=new Image();this.canvas_=null;this.width_=400;this.height_=250;this.angle_=0;this.handler_=this.getHandler();this.drawArea_=null;this.cropArea_=null;this.setModel(a)};goog.inherits(au.upldr.imaging.imageEditor.ImageEditor,goog.ui.Component);au.upldr.imaging.imageEditor.ImageEditor.CSS_CLASS=au.upldr.ui.ClassNames.IMAGE_EDITOR;au.upldr.imaging.imageEditor.ImageEditor.ToolType={PENCIL:(au.upldr.imaging.dictionary.PENCIL),ERASER:(au.upldr.imaging.dictionary.ERASER),CROP_AREA:(au.upldr.imaging.dictionary.CROP_AREA),NONE:(au.upldr.imaging.dictionary.NONE)};au.upldr.imaging.imageEditor.ImageEditor.prototype.getCssClass=function(){return au.upldr.imaging.imageEditor.ImageEditor.CSS_CLASS};au.upldr.imaging.imageEditor.ImageEditor.prototype.crop=function(){this.cropArea_.setViewPort(this.cropArea_.getSelectedBounds())};au.upldr.imaging.imageEditor.ImageEditor.prototype.reset=function(){this.cropArea_.setViewPort();this.drawArea_.clean()};au.upldr.imaging.imageEditor.ImageEditor.prototype.getCropBounds=function(){return this.cropArea_.getViewPort()};au.upldr.imaging.imageEditor.ImageEditor.prototype.setCropBounds=function(a){return this.cropArea_.setViewPort(a)};au.upldr.imaging.imageEditor.ImageEditor.prototype.getAngle=function(){return this.angle_};au.upldr.imaging.imageEditor.ImageEditor.prototype.setAngle=function(a){this.angle_=au.upldr.utils.normalizeAngle(a);this.cropArea_.setAngle(a);this.drawArea_.setAngle(a)};au.upldr.imaging.imageEditor.ImageEditor.prototype.init=function(c,b,d,a){this.setTracer(a);this.setAngle(d);this.cropArea_.init(c,b,this.getAngle())};au.upldr.imaging.imageEditor.ImageEditor.prototype.setPen=function(a){switch(a){case au.upldr.imaging.imageEditor.ImageEditor.ToolType.PENCIL:this.drawArea_.setPen(au.upldr.imaging.imageEditor.DrawArea.ToolType.PENCIL);break;case au.upldr.imaging.imageEditor.ImageEditor.ToolType.ERASER:this.drawArea_.setPen(au.upldr.imaging.imageEditor.DrawArea.ToolType.ERASER);break;default:this.drawArea_.setPen(au.upldr.imaging.imageEditor.DrawArea.ToolType.PENCIL)}};au.upldr.imaging.imageEditor.ImageEditor.prototype.setCropEnabled=function(a){this.cropArea_.setEnabled(a)};au.upldr.imaging.imageEditor.ImageEditor.prototype.isCropEnabled=function(){return this.cropArea_.isEnabled()};au.upldr.imaging.imageEditor.ImageEditor.prototype.setDrawEnabled=function(a){this.drawArea_.setEnabled(a)};au.upldr.imaging.imageEditor.ImageEditor.prototype.isDrawEnabled=function(){return this.drawArea_.isEnabled()};au.upldr.imaging.imageEditor.ImageEditor.prototype.setBrushSize=function(a){this.drawArea_.setBrushSize(a)};au.upldr.imaging.imageEditor.ImageEditor.prototype.getBrushSize=function(){return this.drawArea_.getBrushSize()};au.upldr.imaging.imageEditor.ImageEditor.prototype.setBrushColor=function(a){this.drawArea_.setBrushColor(a)};au.upldr.imaging.imageEditor.ImageEditor.prototype.getBrushColor=function(){return this.drawArea_.getBrushColor()};au.upldr.imaging.imageEditor.ImageEditor.prototype.clean=function(){this.drawArea_.clean();this.cropArea_.clean()};au.upldr.imaging.imageEditor.ImageEditor.prototype.getTracer=function(){return this.drawArea_.getTracer()};au.upldr.imaging.imageEditor.ImageEditor.prototype.setTracer=function(a){return this.drawArea_.setTracer(a)};au.upldr.imaging.imageEditor.ImageEditor.prototype.enableLoading=function(a){goog.dom.classlist.enable(this.rootElement_,"loading",a)};au.upldr.imaging.imageEditor.ImageEditor.prototype.createDom=function(){this.rootElement_=goog.dom.createDom("div",au.upldr.ui.ClassNamesImaging.TRUE_AREA);this.createEditArea_(this.rootElement_);this.drawArea_=new au.upldr.imaging.imageEditor.DrawArea((this.getModel()),this.width_,this.height_);this.addChild(this.drawArea_,true);this.cropArea_=new au.upldr.imaging.imageEditor.CropArea((this.getModel()),this.canvas_,this.width_,this.height_);this.handler_.listen(this.cropArea_,au.upldr.imaging.imageEditor.CropArea.EventType.VIEW_PORT_CHANGED,this.onViewPortChanged_.bind(this));this.addChild(this.cropArea_,true)};au.upldr.imaging.imageEditor.ImageEditor.prototype.onViewPortChanged_=function(){this.drawArea_.setTransform(this.cropArea_.getViewPortTransform());this.drawArea_.adjust()};au.upldr.imaging.imageEditor.ImageEditor.prototype.createEditArea_=function(b){var c=this.getDomHelper();goog.style.setSize(b,this.width_,this.height_);var a=c.createElement("div");c.appendChild(b,a);c.appendChild(a,this.selArea_=goog.dom.createDom("div",au.upldr.ui.ClassNamesImaging.CANVAS_AREA));this.canvas_=(goog.dom.createDom("canvas",au.upldr.ui.ClassNamesImaging.CANVAS));c.appendChild(this.selArea_,this.canvas_);this.setElementInternal(this.selArea_)};au.upldr.imaging.imageEditor.ImageEditor.prototype.render_=function(b,a){if(this.inDocument_){throw Error(goog.ui.Component.Error.ALREADY_RENDERED)}if(!this.element_){this.createDom()}if(b){b.insertBefore(this.rootElement_,a||null)}else{this.dom_.getDocument().body.appendChild(this.rootElement_)}if(!this.parent_||this.parent_.isInDocument()){this.enterDocument()}};goog.provide("goog.ui.ToolbarSeparator");goog.require("goog.ui.Separator");goog.require("goog.ui.ToolbarSeparatorRenderer");goog.require("goog.ui.registry");goog.ui.ToolbarSeparator=function(b,a){goog.ui.Separator.call(this,b||goog.ui.ToolbarSeparatorRenderer.getInstance(),a)};goog.inherits(goog.ui.ToolbarSeparator,goog.ui.Separator);goog.ui.registry.setDecoratorByClassName(goog.ui.ToolbarSeparatorRenderer.CSS_CLASS,function(){return new goog.ui.ToolbarSeparator()});goog.provide("goog.ui.CustomButtonRenderer");goog.require("goog.a11y.aria.Role");goog.require("goog.asserts");goog.require("goog.dom.NodeType");goog.require("goog.dom.classlist");goog.require("goog.string");goog.require("goog.ui.ButtonRenderer");goog.require("goog.ui.INLINE_BLOCK_CLASSNAME");goog.ui.CustomButtonRenderer=function(){goog.ui.ButtonRenderer.call(this)};goog.inherits(goog.ui.CustomButtonRenderer,goog.ui.ButtonRenderer);goog.addSingletonGetter(goog.ui.CustomButtonRenderer);goog.ui.CustomButtonRenderer.CSS_CLASS=goog.getCssName("goog-custom-button");goog.ui.CustomButtonRenderer.prototype.createDom=function(c){var b=(c);var e=this.getClassNames(b);var a={"class":goog.ui.INLINE_BLOCK_CLASSNAME+" "+e.join(" ")};var d=b.getDomHelper().createDom("div",a,this.createButton(b.getContent(),b.getDomHelper()));this.setTooltip(d,(b.getTooltip()));return d};goog.ui.CustomButtonRenderer.prototype.getAriaRole=function(){return goog.a11y.aria.Role.BUTTON};goog.ui.CustomButtonRenderer.prototype.getContentElement=function(a){return a&&a.firstChild&&(a.firstChild.firstChild)};goog.ui.CustomButtonRenderer.prototype.createButton=function(a,b){return b.createDom("div",goog.ui.INLINE_BLOCK_CLASSNAME+" "+goog.getCssName(this.getCssClass(),"outer-box"),b.createDom("div",goog.ui.INLINE_BLOCK_CLASSNAME+" "+goog.getCssName(this.getCssClass(),"inner-box"),a))};goog.ui.CustomButtonRenderer.prototype.canDecorate=function(a){return a.tagName=="DIV"};goog.ui.CustomButtonRenderer.prototype.hasBoxStructure=function(d,c){var b=d.getDomHelper().getFirstElementChild(c);var f=goog.getCssName(this.getCssClass(),"outer-box");if(b&&goog.dom.classlist.contains(b,f)){var a=d.getDomHelper().getFirstElementChild(b);var e=goog.getCssName(this.getCssClass(),"inner-box");if(a&&goog.dom.classlist.contains(a,e)){return true}}return false};goog.ui.CustomButtonRenderer.prototype.decorate=function(c,b){goog.asserts.assert(b);var a=(c);goog.ui.CustomButtonRenderer.trimTextNodes_(b,true);goog.ui.CustomButtonRenderer.trimTextNodes_(b,false);if(!this.hasBoxStructure(a,b)){b.appendChild(this.createButton(b.childNodes,a.getDomHelper()))}goog.dom.classlist.addAll(b,[goog.ui.INLINE_BLOCK_CLASSNAME,this.getCssClass()]);return goog.ui.CustomButtonRenderer.superClass_.decorate.call(this,a,b)};goog.ui.CustomButtonRenderer.prototype.getCssClass=function(){return goog.ui.CustomButtonRenderer.CSS_CLASS};goog.ui.CustomButtonRenderer.trimTextNodes_=function(b,a){if(b){var d=a?b.firstChild:b.lastChild,c;while(d&&d.parentNode==b){c=a?d.nextSibling:d.previousSibling;if(d.nodeType==goog.dom.NodeType.TEXT){var e=d.nodeValue;if(goog.string.trim(e)==""){b.removeChild(d)}else{d.nodeValue=a?goog.string.trimLeft(e):goog.string.trimRight(e);break}}else{break}d=c}}};goog.provide("goog.ui.ToolbarButtonRenderer");goog.require("goog.ui.CustomButtonRenderer");goog.ui.ToolbarButtonRenderer=function(){goog.ui.CustomButtonRenderer.call(this)};goog.inherits(goog.ui.ToolbarButtonRenderer,goog.ui.CustomButtonRenderer);goog.addSingletonGetter(goog.ui.ToolbarButtonRenderer);goog.ui.ToolbarButtonRenderer.CSS_CLASS=goog.getCssName("goog-toolbar-button");goog.ui.ToolbarButtonRenderer.prototype.getCssClass=function(){return goog.ui.ToolbarButtonRenderer.CSS_CLASS};goog.provide("goog.ui.ToolbarButton");goog.require("goog.ui.Button");goog.require("goog.ui.ToolbarButtonRenderer");goog.require("goog.ui.registry");goog.ui.ToolbarButton=function(b,c,a){goog.ui.Button.call(this,b,c||goog.ui.ToolbarButtonRenderer.getInstance(),a)};goog.inherits(goog.ui.ToolbarButton,goog.ui.Button);goog.ui.registry.setDecoratorByClassName(goog.ui.ToolbarButtonRenderer.CSS_CLASS,function(){return new goog.ui.ToolbarButton(null)});goog.provide("au.upldr.imaging.imageEditor.CustomPopupMenu");goog.require("goog.ui.PopupMenu");au.upldr.imaging.imageEditor.CustomPopupMenu=function(a,b){goog.ui.PopupMenu.call(this,a,b)};goog.inherits(au.upldr.imaging.imageEditor.CustomPopupMenu,goog.ui.PopupMenu);au.upldr.imaging.imageEditor.CustomPopupMenu.prototype.onAction_=function(a){};au.upldr.imaging.imageEditor.CustomPopupMenu.prototype.onTargetClick_=function(d){if(!this.wasRecentlyHidden()){var b=this.targets_.getKeys();for(var a=0;a<b.length;a++){var c=(this.targets_.get(b[a]));if(c.element_==d.currentTarget){this.showMenu(c,(d.clientX),(d.clientY));d.preventDefault();d.stopPropagation();return}}}};au.upldr.imaging.imageEditor.CustomPopupMenu.prototype.handleBlur=function(a){};goog.provide("au.upldr.imaging.imageEditor.ImageEditorDialog");goog.provide("au.upldr.imaging.imageEditor.ImageEditorDialog.EventType");goog.require("goog.functions");goog.require("goog.log");goog.require("goog.ui.Component");goog.require("goog.style");goog.require("goog.ui.PopupBase");goog.require("goog.positioning.Corner");goog.require("goog.ui.Button");goog.require("goog.ui.Css3ButtonRenderer");goog.require("goog.ui.Component.EventType");goog.require("goog.ui.ProgressBar");goog.require("goog.math.Size");goog.require("au.upldr.Properties");goog.require("au.upldr.ui.ClassNames");goog.require("au.upldr.ui.ClassNamesCompat");goog.require("au.upldr.imaging.CanvasUtil");goog.require("au.upldr.imaging.imageEditor.ImageEditor");goog.require("au.upldr.imaging.imageEditor.DrawArea");goog.require("goog.ui.Slider");goog.require("goog.ui.PopupColorPicker");goog.require("goog.ui.ToolbarButton");goog.require("goog.ui.Toolbar");goog.require("goog.ui.ToolbarSeparator");goog.require("au.upldr.imaging.Transform");goog.require("au.upldr.imaging.Bounds");goog.require("au.upldr.imaging.TracerItem");goog.require("au.upldr.imaging.Point");goog.require("au.upldr.imaging.imageEditor.DrawAreaConfig");goog.require("au.upldr.imaging.imageEditor.CustomPopupMenu");goog.require("goog.ui.PopupMenu");au.upldr.imaging.imageEditor.ImageEditorDialog=function(a){goog.base(this);this.popup_;this.image_=new Image();this.item_=null;this.propertyHolder_=a.getPropertyHolder();this.drawTool_=(this.propertyHolder_.getProperty(au.upldr.Properties.IMAGE_EDITOR_DRAW_TOOL));this.propertyHolder_.observe(au.upldr.Properties.IMAGE_EDITOR_DRAW_TOOL,function(){this.drawTool_=(this.propertyHolder_.getProperty(au.upldr.Properties.IMAGE_EDITOR_DRAW_TOOL));this.refreshControlsDueDrawTool_();this.updateControlsVisibility()}.bind(this));this.setModel(a)};goog.inherits(au.upldr.imaging.imageEditor.ImageEditorDialog,goog.ui.Component);au.upldr.imaging.imageEditor.ImageEditorDialog.CSS_CLASS=au.upldr.ui.ClassNames.IMAGE_EDIT_DIALOG;au.upldr.imaging.imageEditor.ImageEditorDialog.prototype.getCssClass=function(){return au.upldr.imaging.imageEditor.ImageEditorDialog.CSS_CLASS};au.upldr.imaging.imageEditor.ImageEditorDialog.prototype.setItem=function(a){this.item_=a;if(a.getFile()&&a.isImage()){this.editorArea_.enableLoading(true);au.upldr.utils.fileUtils.blobToImgDef((a.getFile())).addCallback(function(b){this.image_=b;this.editorArea_.init(b,a.getCropBounds(),a.getAngle(),a.getDrawingPoints());this.editorArea_.enableLoading(false)}.bind(this))}};au.upldr.imaging.imageEditor.ImageEditorDialog.prototype.getImage=function(){return this.image_};au.upldr.imaging.imageEditor.ImageEditorDialog.prototype.createDom=function(){var j=this.getDomHelper();var g=j.createDom("div",this.getCssClass());this.setElementInternal(g);goog.style.setElementShown(g,false);var k=au.upldr.ui.Css3ToolbarButtonRenderer.getInstance();var i=goog.ui.Css3ButtonRenderer.getInstance();this.closeButton_=new goog.ui.Button("",i);this.addChild(this.closeButton_,true);goog.dom.classlist.addAll(this.closeButton_.getElement(),au.upldr.ui.ClassNames.CLOSE.replace(/\s+/g," ").split(" "));var d=this.popup_=new goog.ui.PopupBase(g);d.setVisible(false);d.setHideOnEscape(false);d.setAutoHide(false);this.editorArea_=new au.upldr.imaging.imageEditor.ImageEditor(this.getModel());this.addChild(this.editorArea_,true);var e=new goog.ui.Toolbar();this.addChild(e,true);this.showSel_=new goog.ui.ToolbarButton(goog.dom.createDom("div",[au.upldr.ui.ClassNames.BUTTON,au.upldr.ui.ClassNames.CROP_AREA_BUTTON].join(" ")),k);e.addChild(this.showSel_,true);this.btnRotate_=new goog.ui.ToolbarButton(goog.dom.createDom("div",[au.upldr.ui.ClassNames.BUTTON,au.upldr.ui.ClassNames.ROTATE_BUTTON].join(" ")),k);e.addChild(this.btnRotate_,true);this.btnRotate_.setVisible((this.propertyHolder_.getProperty(au.upldr.Properties.ENABLE_ROTATION)));this.propertyHolder_.observe(au.upldr.Properties.ENABLE_ROTATION,function(){this.btnRotate_.setVisible((this.propertyHolder_.getProperty(au.upldr.Properties.ENABLE_ROTATION)))}.bind(this));this.btnPencil_=new goog.ui.ToolbarButton(goog.dom.createDom("div",[au.upldr.ui.ClassNames.BUTTON,au.upldr.ui.ClassNames.BRUSH_BUTTON].join(" ")),k);e.addChild(this.btnPencil_,true);this.btnEraser_=new goog.ui.ToolbarButton(goog.dom.createDom("div",[au.upldr.ui.ClassNames.BUTTON,au.upldr.ui.ClassNames.ERASER_BUTTON].join(" ")),k);e.addChild(this.btnEraser_,true);this.btnReset_=new goog.ui.ToolbarButton(goog.dom.createDom("div",[au.upldr.ui.ClassNames.BUTTON,au.upldr.ui.ClassNames.CLEAN_BUTTON].join(" ")),k);e.addChild(this.btnReset_,true);var h=this.toolSelectModel_=new goog.ui.SelectionModel();h.setSelectionHandler(function(m,l){if(m){m.setChecked(l)}});goog.array.forEach([this.showSel_,this.btnEraser_,this.btnPencil_],function(l){l.setSupportedState(goog.ui.Component.State.CHECKED,true);l.setAutoStates(goog.ui.Component.State.CHECKED,false);h.addItem(l);this.getHandler().listen(l.getElement(),goog.events.EventType.CLICK,function(m){h.setSelectedItem(l)})},this);this.sizeSlider_=new goog.ui.Slider();this.sizeSlider_.setOrientation(goog.ui.SliderBase.Orientation.VERTICAL);this.sizeSlider_.render(e.getElement());goog.dom.classlist.add(this.sizeSlider_.getElement(),"goog-inline-block");var f=this.sliderMenu_=new au.upldr.imaging.imageEditor.CustomPopupMenu();var b=new goog.ui.MenuItem(this.sizeSlider_.getElement());b.setSupportedState(goog.ui.Component.State.HOVER,false);f.addChild(b,true);f.render(document.body);goog.dom.classlist.add(b.getElement(),au.upldr.ui.ClassNames.DRAWING_WIDTH_MENU_ITEM);var a=this.slideMenuButton_=new goog.ui.ToolbarButton(goog.dom.createDom("div",[au.upldr.ui.ClassNames.BUTTON,au.upldr.ui.ClassNames.DRAWING_WIDTH_BUTTON].join(" ")));e.addChild(a,true);f.attach(a.getElement(),goog.positioning.Corner.BOTTOM_LEFT);goog.dom.classlist.add(b.getElement(),au.upldr.ui.ClassNames.DRAWING_WIDTH_MENU_ITEM);e.addChild(new goog.ui.ToolbarSeparator(),true);this.refreshControlsDueDrawTool_();this.cropButton_=new goog.ui.ToolbarButton(goog.dom.createDom("div",[au.upldr.ui.ClassNames.BUTTON,au.upldr.ui.ClassNames.CROP_APPLY_BUTTON].join(" ")),k);e.addChild(this.cropButton_,true);this.btnColorColorElement_=goog.dom.createDom("div",au.upldr.ui.ClassNames.PALETTE_BUTTON_COLOR);this.btnColor_=new goog.ui.ToolbarButton([goog.dom.createDom("div",[au.upldr.ui.ClassNames.BUTTON,au.upldr.ui.ClassNames.PALETTE_BUTTON].join(" ")),this.btnColorColorElement_],k);e.addChild(this.btnColor_,true);var c=this.colorPicker_=new goog.ui.PopupColorPicker();c.setFocusable(false);c.render(e.getElement());c.attach(this.btnColor_.getElement());goog.style.setStyle(this.btnColorColorElement_,"background-color",this.drawTool_.color);this.okBtn_=new goog.ui.Button((this.propertyHolder_.getProperty(au.upldr.Properties.COMMON_DIALOG_OK_BUTTON_TEXT)),i);this.propertyHolder_.observe(au.upldr.Properties.COMMON_DIALOG_OK_BUTTON_TEXT,function(){this.okBtn_.setValue((this.propertyHolder_.getProperty(au.upldr.Properties.COMMON_DIALOG_OK_BUTTON_TEXT)))},this);this.addChild(this.okBtn_,true)};au.upldr.imaging.imageEditor.ImageEditorDialog.prototype.refreshControlsDueDrawTool_=function(){this.sizeSlider_.setMinimum(this.drawTool_.minWidth);this.sizeSlider_.setMaximum(this.drawTool_.maxWidth);this.editorArea_.setBrushSize(this.drawTool_.width);this.editorArea_.setBrushColor(this.drawTool_.color);this.sizeSlider_.getElement().parentNode.setAttribute("data-min",this.drawTool_.minWidth);this.sizeSlider_.getElement().parentNode.setAttribute("data-max",this.drawTool_.maxWidth);if(this.btnColorColorElement_){goog.style.setStyle(this.btnColorColorElement_,"background-color",this.drawTool_.color)}};au.upldr.imaging.imageEditor.ImageEditorDialog.prototype.getInvertedWidth=function(a){return this.drawTool_.maxWidth+this.drawTool_.minWidth-(a)};au.upldr.imaging.imageEditor.ImageEditorDialog.prototype.onSizeChange_=function(){this.editorArea_.setBrushSize(this.getInvertedWidth(this.sizeSlider_.getValue()))};au.upldr.imaging.imageEditor.ImageEditorDialog.prototype.onColorChange_=function(){this.editorArea_.setBrushColor((this.colorPicker_.getSelectedColor()));goog.style.setStyle(this.btnColorColorElement_,"background-color",this.colorPicker_.getSelectedColor())};au.upldr.imaging.imageEditor.ImageEditorDialog.prototype.onCrop_=function(){if(this.editorArea_.isCropEnabled()){this.editorArea_.crop()}};au.upldr.imaging.imageEditor.ImageEditorDialog.prototype.onKeyDown_=function(a){if(a.keyCode==goog.events.KeyCodes.ENTER||goog.userAgent.WEBKIT&&a.keyCode==goog.events.KeyCodes.MAC_ENTER){this.onOk_()}else{if(a.keyCode==goog.events.KeyCodes.ESC){this.onCancel_()}}};au.upldr.imaging.imageEditor.ImageEditorDialog.prototype.onOk_=function(){if(this.editorArea_.isCropEnabled()){this.editorArea_.crop()}this.item_.setCropBounds(this.editorArea_.getCropBounds());this.item_.setDrawingPoints(this.editorArea_.getTracer());this.item_.setCropBounds(this.editorArea_.getCropBounds(),true);this.item_.setAngle(this.editorArea_.getAngle());this.onClose_("ok")};au.upldr.imaging.imageEditor.ImageEditorDialog.prototype.onCancel_=function(){this.onClose_("cancel")};au.upldr.imaging.imageEditor.ImageEditorDialog.prototype.onClose_=function(a){this.hide();this.editorArea_.clean();var c=new goog.events.Event(au.upldr.imaging.imageEditor.ImageEditorDialog.EventType.CLOSE);c.result=a;c.index=this.getModel().getItems().toArray().indexOf(this.item_);c.guid=this.item_.getGuid();if(a=="ok"){var b=(this.propertyHolder_.getProperty(au.upldr.Properties.UPLOAD_PANE_THUMBNAIL_PREVIEW_SIZE));this.item_.setThumbnailPreview(au.upldr.imaging.CanvasUtil.getImage(this.item_,this.image_,b,b,0,null,au.upldr.image.FitMode.FIT));var d=(this.propertyHolder_.getProperty(au.upldr.Properties.UPLOAD_PANE_TILE_PREVIEW_SIZE));this.item_.setTilePreview(au.upldr.imaging.CanvasUtil.getImage(this.item_,this.image_,d,d,0,null,au.upldr.image.FitMode.FIT))}this.dispatchEvent(c)};au.upldr.imaging.imageEditor.ImageEditorDialog.prototype.switchPen_=function(a){if(a.target==this.btnPencil_.getElement()){this.editorArea_.setPen(au.upldr.imaging.imageEditor.ImageEditor.ToolType.PENCIL)}else{if(a.target==this.btnEraser_.getElement()){this.editorArea_.setPen(au.upldr.imaging.imageEditor.ImageEditor.ToolType.ERASER)}}};au.upldr.imaging.imageEditor.ImageEditorDialog.prototype.toolSelected_=function(b){var a=b.target.selectedItem_;if(a==this.btnPencil_){this.switchTool(au.upldr.imaging.imageEditor.ImageEditor.ToolType.PENCIL)}else{if(a==this.btnEraser_){this.switchTool(au.upldr.imaging.imageEditor.ImageEditor.ToolType.ERASER)}else{if(a==this.showSel_){this.switchTool(au.upldr.imaging.imageEditor.ImageEditor.ToolType.CROP_AREA)}}}};au.upldr.imaging.imageEditor.ImageEditorDialog.prototype.switchTool=function(a){this.showSel_.setChecked(false);this.btnEraser_.setChecked(false);this.btnPencil_.setChecked(false);this.btnEraser_.setVisible(this.drawTool_.enableEraser&&(this.propertyHolder_.getProperty(au.upldr.Properties.IMAGE_EDITOR_ENABLE_DRAW_TOOL)));if(a==au.upldr.imaging.imageEditor.ImageEditor.ToolType.PENCIL||a==au.upldr.imaging.imageEditor.ImageEditor.ToolType.ERASER){this.editorArea_.setDrawEnabled(true);this.editorArea_.setCropEnabled(false);this.cropButton_.setVisible(false);if(a==au.upldr.imaging.imageEditor.ImageEditor.ToolType.PENCIL){this.btnColor_.setVisible(this.drawTool_.enableColorPicker);this.slideMenuButton_.setVisible(this.drawTool_.enableWidthSlider);this.btnPencil_.setChecked(true);this.editorArea_.setPen(au.upldr.imaging.imageEditor.ImageEditor.ToolType.PENCIL)}else{if(a==au.upldr.imaging.imageEditor.ImageEditor.ToolType.ERASER&&this.drawTool_.enableEraser&&(this.propertyHolder_.getProperty(au.upldr.Properties.IMAGE_EDITOR_ENABLE_DRAW_TOOL))){this.btnColor_.setVisible(false);this.slideMenuButton_.setVisible(true);this.btnEraser_.setChecked(true);this.editorArea_.setPen(au.upldr.imaging.imageEditor.ImageEditor.ToolType.ERASER)}}}else{if(a==au.upldr.imaging.imageEditor.ImageEditor.ToolType.CROP_AREA){this.editorArea_.setCropEnabled(true);this.editorArea_.setDrawEnabled(false);this.cropButton_.setVisible(true);this.btnColor_.setVisible(false);this.slideMenuButton_.setVisible(false);this.showSel_.setChecked(true)}else{if(a==au.upldr.imaging.imageEditor.ImageEditor.ToolType.NONE){this.editorArea_.setCropEnabled(false);this.editorArea_.setDrawEnabled(false);this.cropButton_.setVisible(false);this.btnColor_.setVisible(false);this.slideMenuButton_.setVisible(false);this.showSel_.setChecked(false)}}}};au.upldr.imaging.imageEditor.ImageEditorDialog.prototype.enableCrop_=function(a){this.showSel_.setVisible(a)};au.upldr.imaging.imageEditor.ImageEditorDialog.prototype.enableDrawing_=function(a){this.btnEraser_.setVisible(a);this.btnPencil_.setVisible(a)};au.upldr.imaging.imageEditor.ImageEditorDialog.prototype.onReset_=function(){this.editorArea_.setAngle(this.item_.getAngle());this.editorArea_.reset()};au.upldr.imaging.imageEditor.ImageEditorDialog.prototype.onRotate_=function(){this.editorArea_.setAngle(this.editorArea_.getAngle()+90)};au.upldr.imaging.imageEditor.ImageEditorDialog.prototype.enterDocument=function(){goog.base(this,"enterDocument");this.getHandler().listen(this.popup_,goog.ui.PopupBase.EventType.HIDE,this.popup_hideHandler_).listen(this.popup_,goog.ui.PopupBase.EventType.SHOW,this.popup_showHandler_).listen(this.sizeSlider_,goog.ui.Component.EventType.CHANGE,this.onSizeChange_).listen(this.colorPicker_,goog.ui.ColorPicker.EventType.CHANGE,this.onColorChange_).listen(this.sliderMenu_,goog.ui.Component.EventType.SHOW,function(){this.sizeSlider_.setValue(this.getInvertedWidth(this.editorArea_.getBrushSize()))}).listen(this.btnEraser_.getElement(),goog.events.EventType.CLICK,this.switchPen_).listen(this.btnPencil_.getElement(),goog.events.EventType.CLICK,this.switchPen_).listen(this.toolSelectModel_,goog.events.EventType.SELECT,this.toolSelected_).listen(this.cropButton_.getElement(),goog.events.EventType.CLICK,this.onCrop_).listen(this.btnReset_.getElement(),goog.events.EventType.CLICK,this.onReset_).listen(this.okBtn_.getElement(),goog.events.EventType.CLICK,this.onOk_).listen(this.closeButton_.getElement(),goog.events.EventType.CLICK,this.onCancel_).listen(this.btnRotate_.getElement(),goog.events.EventType.CLICK,this.onRotate_).listen(this,[goog.ui.Component.EventType.SHOW,goog.ui.Component.EventType.HIDE],function(a){if(a.target!=this){a.stopPropagation()}},true)};au.upldr.imaging.imageEditor.ImageEditorDialog.prototype.updateControlsVisibility=function(){var c=(this.propertyHolder_.getProperty(au.upldr.Properties.IMAGE_EDITOR_ENABLE_DRAW_TOOL));var a=(this.propertyHolder_.getProperty(au.upldr.Properties.IMAGE_EDITOR_ENABLE_CROP));var b=(this.propertyHolder_.getProperty(au.upldr.Properties.IMAGE_EDITOR_DEFAULT_TOOL));this.enableDrawing_(c);this.enableCrop_(a);if(c&&b==au.upldr.imaging.tools.DRAW){this.switchTool(au.upldr.imaging.imageEditor.ImageEditor.ToolType.PENCIL)}else{if(a&&b==au.upldr.imaging.tools.CROP){this.switchTool(au.upldr.imaging.imageEditor.ImageEditor.ToolType.CROP_AREA)}else{this.switchTool(au.upldr.imaging.imageEditor.ImageEditor.ToolType.NONE)}}};au.upldr.imaging.imageEditor.ImageEditorDialog.prototype.show=function(){goog.events.listen(document,goog.events.EventType.KEYDOWN,this.onKeyDown_,false,this);this.popup_.setVisible(true);this.updateControlsVisibility();this.propertyHolder_.unObserve(au.upldr.Properties.IMAGE_EDITOR_ENABLE_DRAW_TOOL,this.updateControlsVisibility,this);this.propertyHolder_.unObserve(au.upldr.Properties.IMAGE_EDITOR_ENABLE_CROP,this.updateControlsVisibility,this);this.propertyHolder_.observe(au.upldr.Properties.IMAGE_EDITOR_ENABLE_DRAW_TOOL,this.updateControlsVisibility,this);this.propertyHolder_.observe(au.upldr.Properties.IMAGE_EDITOR_ENABLE_CROP,this.updateControlsVisibility,this)};au.upldr.imaging.imageEditor.ImageEditorDialog.prototype.hide=function(){goog.events.unlisten(document,goog.events.EventType.KEYDOWN,this.onKeyDown_,false,this);this.popup_.setVisible(false)};au.upldr.imaging.imageEditor.ImageEditorDialog.prototype.popup_hideHandler_=function(a){this.dispatchEvent(au.upldr.imaging.imageEditor.ImageEditorDialog.EventType.HIDE)};au.upldr.imaging.imageEditor.ImageEditorDialog.prototype.popup_showHandler_=function(a){this.dispatchEvent(au.upldr.imaging.imageEditor.ImageEditorDialog.EventType.SHOW)};au.upldr.imaging.imageEditor.ImageEditorDialog.prototype.dispatchCancelEvent_=function(){this.dispatchEvent(au.upldr.imaging.imageEditor.ImageEditorDialog.EventType.CANCEL)};au.upldr.imaging.imageEditor.ImageEditorDialog.prototype.canDecorate=goog.functions.FALSE;au.upldr.imaging.imageEditor.ImageEditorDialog.prototype.logger=goog.log.getLogger("au.upldr.imaging.imageEditor.ImageEditorDialog");au.upldr.imaging.imageEditor.ImageEditorDialog.prototype.getModel;au.upldr.imaging.imageEditor.ImageEditorDialog.EventType={SHOW:goog.ui.PopupBase.EventType.SHOW,HIDE:goog.ui.PopupBase.EventType.HIDE,CANCEL:"cancel",CLOSE:"close"};goog.provide("au.upldr.ui.InformationBar");goog.require("goog.functions");goog.require("goog.style");goog.require("goog.log");goog.require("goog.ui.Component");goog.require("goog.ui.Button");goog.require("goog.ui.Css3ButtonRenderer");goog.require("au.upldr.events.CollectionEvent");goog.require("au.upldr.events.CollectionEventKind");goog.require("au.upldr.ui.Label");goog.require("au.upldr.utils");goog.require("au.upldr.ui.ClassNames");goog.require("au.upldr.ui.ClassNamesCompat");au.upldr.ui.InformationBar=function(b,a){goog.base(this,a);this.setModel(b);this.closeButton_=new goog.ui.Button("X",goog.ui.Css3ButtonRenderer.getInstance());this.addChild(this.closeButton_);this.label_=new au.upldr.ui.Label();this.addChild(this.label_);this.getHandler().listen(this.closeButton_,goog.ui.Component.EventType.ACTION,this.hide).listen(b.getNotificationCollection(),au.upldr.events.CollectionEvent.COLLECTION_CHANGED,this.notificationsChangedHandler_);this.defaultHeight_;this.visible_=true;this.timeout_=10000;this.timer_};goog.inherits(au.upldr.ui.InformationBar,goog.ui.Component);au.upldr.ui.InformationBar.CSS_CLASS=au.upldr.ui.ClassNames.INFORMATION_BAR;au.upldr.ui.InformationBar.prototype.getCssClass=function(){return au.upldr.ui.InformationBar.CSS_CLASS};au.upldr.ui.InformationBar.prototype.createDom=function(){var b=this.getDomHelper();var c="div";var a=b.createDom(c,this.getCssClass());goog.dom.classlist.addAll(a,au.upldr.ui.ClassNamesCompat.INFORMATION_BAR.replace(/\s+/," ").split(" "));this.setElementInternal(a);this.closeButton_.render(a);goog.dom.classlist.addAll(this.closeButton_.getElement(),au.upldr.ui.ClassNamesCompat.INFORMATION_BAR_CLOSE_BUTTON.replace(/\s+/," ").split(" "));this.label_.render(a);goog.dom.classlist.addAll(this.label_.getElement(),au.upldr.ui.ClassNamesCompat.INFORMATION_BAR_TEXT.replace(/\s+/," ").split(" "));this.hide()};au.upldr.ui.InformationBar.prototype.enterDocument=function(){goog.base(this,"enterDocument");this.defaultHeight_=goog.style.getSize(this.getElement()).height};au.upldr.ui.InformationBar.prototype.getModel;au.upldr.ui.InformationBar.prototype.canDecorate=goog.functions.FALSE;au.upldr.ui.InformationBar.prototype.hide=function(){if(this.timer_){clearTimeout(this.timer_);delete this.timer_}this.visible_=false;if(this.getElement()){goog.dom.classlist.addAll(this.getElement(),au.upldr.ui.ClassNames.INFORMATION_BAR_COLLAPSED.replace(/\s+/," ").split(" "))}var a=this.getNextMessage_();if(a!=null){au.upldr.utils.setTimeout(goog.bind(this.show,this,a),100)}};au.upldr.ui.InformationBar.prototype.show=function(a){if(a!=null&&(a=a+"")!==""){this.logger.fine('Show message: "'+a+'"');this.visible_=true;this.label_.setLabelText(a);if(this.getElement()){goog.dom.classlist.removeAll(this.getElement(),au.upldr.ui.ClassNames.INFORMATION_BAR_COLLAPSED.replace(/\s+/," ").split(" "))}this.timer_=au.upldr.utils.setTimeout(this.hide,this.timeout_,this)}};au.upldr.ui.InformationBar.prototype.notificationsChangedHandler_=function(b){if(!this.visible_&&b.getKind()==au.upldr.events.CollectionEventKind.ADD){this.logger.fine("New notifications added: ["+this.getModel().getNotificationCollection().getCount()+"]");var a=this.getNextMessage_();this.show(a)}};au.upldr.ui.InformationBar.prototype.getNextMessage_=function(){var b=this.getModel().getNotificationCollection(),a;if(b.getCount()>0){a=b.getItem(0);b.removeAt(0)}return(a)};au.upldr.ui.InformationBar.prototype.logger=goog.log.getLogger("au.upldr.ui.InformationBar");goog.provide("au.upldr.ui.DescriptionEditor");goog.provide("au.upldr.ui.DescriptionEditor.EventType");goog.require("goog.functions");goog.require("goog.log");goog.require("goog.ui.Component");goog.require("goog.style");goog.require("goog.ui.Popup");goog.require("goog.positioning.Corner");goog.require("goog.ui.Button");goog.require("goog.ui.Css3ButtonRenderer");goog.require("goog.ui.Component.EventType");goog.require("goog.events.EventType");goog.require("au.upldr.Properties");goog.require("au.upldr.ui.ClassNames");goog.require("au.upldr.ui.ClassNamesCompat");au.upldr.ui.DescriptionEditor=function(b,a){goog.base(this,a);this.popup_;this.item_=null;this.textarea_;this.okButton_;this.cancelButton_;this.setModel(b)};goog.inherits(au.upldr.ui.DescriptionEditor,goog.ui.Component);au.upldr.ui.DescriptionEditor.CSS_CLASS=au.upldr.ui.ClassNames.DESCRIPTION_EDITOR;au.upldr.ui.DescriptionEditor.prototype.getCssClass=function(){return au.upldr.ui.DescriptionEditor.CSS_CLASS};au.upldr.ui.DescriptionEditor.prototype.createDom=function(){var b=this.getModel();var f=au.upldr.Properties;var h=this.getDomHelper();this.textarea_=(h.createDom("textarea",{rows:3,cols:25}));goog.dom.classlist.addAll(this.textarea_,au.upldr.ui.ClassNamesCompat.DESCRIPTION_EDITOR_TEXTBOX.replace(/\s+/," ").split(" "));var g=h.createDom("div",this.getCssClass(),this.textarea_);goog.dom.classlist.addAll(g,au.upldr.ui.ClassNamesCompat.DESCRIPTION_EDITOR_WINDOW.replace(/\s+/," ").split(" "));this.setElementInternal(g);goog.style.setElementShown(g,false);var c=this.popup_=new goog.ui.Popup(g);c.setVisible(false);c.setHideOnEscape(true);c.setPinnedCorner(goog.positioning.Corner.TOP_LEFT);var d=h.createElement("div");h.appendChild(g,d);var a=goog.ui.Css3ButtonRenderer.getInstance();var e=this.okButton_=new goog.ui.Button((b.getProperty(f.DESCRIPTION_EDITOR_OK_BUTTON_TEXT)),a);this.addChild(e,false);e.render(d);b.observe(f.DESCRIPTION_EDITOR_OK_BUTTON_TEXT,function(){this.okButton_.setCaption((b.getProperty(f.DESCRIPTION_EDITOR_OK_BUTTON_TEXT)))},this);e=this.cancelButton_=new goog.ui.Button((b.getProperty(f.DESCRIPTION_EDITOR_CANCEL_BUTTON_TEXT)),a);this.addChild(e,false);e.render(d);b.observe(f.DESCRIPTION_EDITOR_CANCEL_BUTTON_TEXT,function(){this.cancelButton_.setCaption((b.getProperty(f.DESCRIPTION_EDITOR_CANCEL_BUTTON_TEXT)))},this)};au.upldr.ui.DescriptionEditor.prototype.enterDocument=function(){goog.base(this,"enterDocument");this.getHandler().listen(this.popup_,goog.ui.PopupBase.EventType.HIDE,this.popup_hideHandler_).listen(this.popup_,goog.ui.PopupBase.EventType.SHOW,this.popup_showHandler_).listen(this.cancelButton_,goog.ui.Component.EventType.ACTION,this.hide).listen(this.okButton_,goog.ui.Component.EventType.ACTION,this.saveDescription_).listen(this.okButton_,goog.ui.Component.EventType.ACTION,this.hide).listen(this.textarea_,goog.events.EventType.KEYDOWN,this.textarea_keyHandler_)};au.upldr.ui.DescriptionEditor.prototype.show=function(c,b){this.item_=c;this.textarea_.value=c.getDescription();var a=this.popup_;a.setPosition(new goog.positioning.AnchoredViewportPosition(b,goog.positioning.Corner.BOTTOM_LEFT,true));a.setVisible(true)};au.upldr.ui.DescriptionEditor.prototype.hide=function(){this.popup_.setVisible(false)};au.upldr.ui.DescriptionEditor.prototype.textarea_keyHandler_=function(a){if(a.keyCode===goog.events.KeyCodes.ENTER&&!(a.shiftKey||a.altKey||a.metaKey||a.ctrlKey)){a.preventDefault();this.saveDescription_();this.hide()}};au.upldr.ui.DescriptionEditor.prototype.saveDescription_=function(){this.item_.setDescription(this.textarea_.value)};au.upldr.ui.DescriptionEditor.prototype.popup_hideHandler_=function(a){this.item_=null;this.textarea_.value="";this.dispatchEvent(au.upldr.ui.DescriptionEditor.EventType.HIDE)};au.upldr.ui.DescriptionEditor.prototype.popup_showHandler_=function(b){if(this.textarea_.value){this.textarea_.focus()}else{var a=this.okButton_.getElement();this.getHandler().listenOnce(a,goog.events.EventType.KEYDOWN,function(c){this.textarea_.focus()});a.focus()}this.dispatchEvent(au.upldr.ui.DescriptionEditor.EventType.SHOW)};au.upldr.ui.DescriptionEditor.prototype.canDecorate=goog.functions.FALSE;au.upldr.ui.DescriptionEditor.prototype.logger=goog.log.getLogger("au.upldr.ui.DescriptionEditor");au.upldr.ui.DescriptionEditor.prototype.getModel;au.upldr.ui.DescriptionEditor.EventType={SHOW:goog.ui.PopupBase.EventType.SHOW,HIDE:goog.ui.PopupBase.EventType.HIDE};goog.provide("au.upldr.IUploader");au.upldr.IUploader=function(){};au.upldr.IUploader.prototype.getPropertyHolder=function(){};au.upldr.IUploader.prototype.getItems=function(){};au.upldr.IUploader.prototype.getNotificationCollection=function(){};au.upldr.IUploader.prototype.addFiles=function(a){};au.upldr.IUploader.prototype.removeAllFiles=function(){};au.upldr.IUploader.prototype.upload=function(){};au.upldr.IUploader.prototype.cancelUploadByButton=function(a){};goog.provide("goog.events.FileDropHandler");goog.provide("goog.events.FileDropHandler.EventType");goog.require("goog.array");goog.require("goog.dom");goog.require("goog.events.BrowserEvent");goog.require("goog.events.EventHandler");goog.require("goog.events.EventTarget");goog.require("goog.events.EventType");goog.require("goog.log");goog.require("goog.log.Level");goog.events.FileDropHandler=function(b,a){goog.events.EventTarget.call(this);this.eventHandler_=new goog.events.EventHandler(this);var c=b;if(a){c=goog.dom.getOwnerDocument(b)}this.eventHandler_.listen(c,goog.events.EventType.DRAGENTER,this.onDocDragEnter_);if(c!=b){this.eventHandler_.listen(c,goog.events.EventType.DRAGOVER,this.onDocDragOver_)}this.eventHandler_.listen(b,goog.events.EventType.DRAGOVER,this.onElemDragOver_);this.eventHandler_.listen(b,goog.events.EventType.DROP,this.onElemDrop_)};goog.inherits(goog.events.FileDropHandler,goog.events.EventTarget);goog.events.FileDropHandler.prototype.dndContainsFiles_=false;goog.events.FileDropHandler.prototype.logger_=goog.log.getLogger("goog.events.FileDropHandler");goog.events.FileDropHandler.EventType={DROP:goog.events.EventType.DROP};goog.events.FileDropHandler.prototype.disposeInternal=function(){goog.events.FileDropHandler.superClass_.disposeInternal.call(this);this.eventHandler_.dispose()};goog.events.FileDropHandler.prototype.dispatch_=function(b){goog.log.fine(this.logger_,"Firing DROP event...");var a=new goog.events.BrowserEvent(b.getBrowserEvent());a.type=goog.events.FileDropHandler.EventType.DROP;this.dispatchEvent(a)};goog.events.FileDropHandler.prototype.onDocDragEnter_=function(b){goog.log.log(this.logger_,goog.log.Level.FINER,'"'+b.target.id+'" ('+b.target+") dispatched: "+b.type);var a=b.getBrowserEvent().dataTransfer;this.dndContainsFiles_=!!(a&&((a.types&&(goog.array.contains(a.types,"Files")||goog.array.contains(a.types,"public.file-url")))||(a.files&&a.files.length>0)));if(this.dndContainsFiles_){b.preventDefault()}goog.log.log(this.logger_,goog.log.Level.FINER,"dndContainsFiles_: "+this.dndContainsFiles_)};goog.events.FileDropHandler.prototype.onDocDragOver_=function(b){goog.log.log(this.logger_,goog.log.Level.FINEST,'"'+b.target.id+'" ('+b.target+") dispatched: "+b.type);if(this.dndContainsFiles_){b.preventDefault();var a=b.getBrowserEvent().dataTransfer;a.dropEffect="none"}};goog.events.FileDropHandler.prototype.onElemDragOver_=function(c){goog.log.log(this.logger_,goog.log.Level.FINEST,'"'+c.target.id+'" ('+c.target+") dispatched: "+c.type);if(this.dndContainsFiles_){c.preventDefault();c.stopPropagation();var b=c.getBrowserEvent().dataTransfer;try{b.effectAllowed="all";b.dropEffect="copy"}catch(a){}}};goog.events.FileDropHandler.prototype.onElemDrop_=function(a){goog.log.log(this.logger_,goog.log.Level.FINER,'"'+a.target.id+'" ('+a.target+") dispatched: "+a.type);if(this.dndContainsFiles_){a.preventDefault();a.stopPropagation();this.dispatch_(a)}};goog.provide("au.upldr.ui.RectangleSelection");goog.require("goog.events.EventType");goog.require("goog.events.EventHandler");goog.require("goog.math.Coordinate");goog.require("goog.math.Rect");au.upldr.ui.RectangleSelection=function(a){this.parent_=a||null;this.container_=null;this.element_=null;this.rectElement_=null;this.maskElement_=null;this.rectVisible_=false;this.elementOffset_=null;this.elementSize_=null;this.startPoint_=null;this.itemRectArr_=null;this.handler_=new goog.events.EventHandler(this)};au.upldr.ui.RectangleSelection.prototype.attach=function(a){if(this.container_){this.detach()}if(!a.isInDocument()){au.upldr.utils.error("Container is not rendered.")}this.container_=a;this.element_=a.getElement();this.handler_.listen(this.element_,goog.events.EventType.MOUSEDOWN,this.element_mouseDownHandler_)};au.upldr.ui.RectangleSelection.prototype.detach=function(){this.handler_.unlisten(this.element_,goog.events.EventType.MOUSEDOWN,this.element_mouseDownHandler_);this.container_=null};au.upldr.ui.RectangleSelection.prototype.element_mouseDownHandler_=function(c){var a=this.element_;if(c.target!=a||!c.isMouseActionButton()){return}this.elementOffset_=goog.style.getPageOffset(a);var d=c.getBrowserEvent();var b=this.toLocalCoordinate_(new goog.math.Coordinate(d.pageX,d.pageY));if(b.x<a.clientWidth&&b.y<a.scrollHeight){this.handler_.listen(document,goog.events.EventType.MOUSEMOVE,this.document_mouseMoveHandler_,true).listen(document,goog.events.EventType.MOUSEUP,this.document_mouseUpHandler_,false);this.elementSize_=new goog.math.Size(a.clientWidth,a.scrollHeight);this.startPoint_=b;this.updateChildrenAreas_();c.preventDefault()}};au.upldr.ui.RectangleSelection.prototype.updateChildrenAreas_=function(){var a=[];this.container_.forEachChild(function(d,b){var c=d.getElement();a[b]=new goog.math.Rect(c.offsetLeft,c.offsetTop,c.offsetWidth,c.offsetHeight)});this.itemRectArr_=a};au.upldr.ui.RectangleSelection.prototype.toLocalCoordinate_=function(c){var b=this.element_;if(!this.elementOffset_){this.elementOffset_=goog.style.getPageOffset(b)}var a=goog.math.Coordinate.difference(c,this.elementOffset_);a.x+=b.scrollLeft;a.y+=b.scrollTop;return a};au.upldr.ui.RectangleSelection.prototype.createRectElement_=function(b){if(!this.maskElement_){var a=this.maskElement_=goog.dom.createDom("div","au-upldr-rectselection-bg");goog.events.listenOnce(a,goog.events.EventType.CLICK,function(c){goog.dom.removeNode(a)});goog.dom.appendChild(window.document.body,a)}if(!this.rectElement_){this.rectElement_=goog.dom.createDom("li","au-upldr-rectselection")}goog.style.setElementShown(this.rectElement_,false);this.rectVisible_=false;goog.style.setPosition(this.rectElement_,b.x,b.y);goog.dom.appendChild(this.parent_||window.document.body,this.rectElement_)};au.upldr.ui.RectangleSelection.prototype.document_mouseMoveHandler_=function(d){var h=this.rectElement_;if(!h){this.createRectElement_(this.startPoint_);h=this.rectElement_}var b=this.element_;var k=this.startPoint_;var j=d.getBrowserEvent();var g=this.toLocalCoordinate_(new goog.math.Coordinate(j.pageX,j.pageY));var c=Math.min(k.x,g.x);var f=Math.min(k.y,g.y);var a=goog.math.clamp(Math.abs(g.x-k.x),1,this.elementSize_.width-c-4);var i=goog.math.clamp(Math.abs(g.y-k.y),1,this.elementSize_.height-f-4);goog.style.setPosition(h,c,f);goog.style.setSize(h,a,i);this.scrollToVisible_(g.y);if(!this.rectVisible_&&(a>5||i>5)){this.rectVisible_=true;goog.style.setElementShown(h,true)}this.selectListItems_(new goog.math.Rect(c,f,a,i));d.preventDefault();d.stopPropagation()};au.upldr.ui.RectangleSelection.prototype.selectListItems_=function(a){this.container_.forEachChild(function(d,b){var c=d.isSelected();if(c^goog.math.Rect.intersects(this.itemRectArr_[b],a)){this.container_.selectItem(b,!c)}},this)};au.upldr.ui.RectangleSelection.prototype.scrollToVisible_=function(b){var a=this.element_;if(b-a.scrollTop<0){a.scrollTop=b}else{if(b-a.scrollTop>a.clientHeight){a.scrollTop=b-a.clientHeight}}};au.upldr.ui.RectangleSelection.prototype.document_mouseUpHandler_=function(a){this.handler_.unlisten(document,goog.events.EventType.MOUSEMOVE,this.document_mouseMoveHandler_,true).unlisten(document,goog.events.EventType.MOUSEUP,this.document_mouseUpHandler_,false);if(this.rectElement_){goog.dom.removeNode(this.rectElement_);this.rectElement_=null}if(this.maskElement_){goog.dom.removeNode(this.maskElement_);this.maskElement_=null}this.startPoint_=null};goog.provide("au.upldr.events.AddFileEvent");goog.require("goog.events.Event");goog.require("au.upldr.events.EventType");au.upldr.events.AddFileEvent=function(a){goog.base(this,au.upldr.events.EventType.ADD_FILE);this.files_=a};goog.inherits(au.upldr.events.AddFileEvent,goog.events.Event);au.upldr.events.AddFileEvent.prototype.getFiles=function(){return this.files_};goog.provide("au.upldr.ui.toolbar.Action");au.upldr.ui.toolbar.Action={EDIT_DESCRIPTION:1,ROTATE:2,REMOVE:3,EDIT:4};goog.provide("goog.html.legacyconversions");goog.require("goog.html.SafeHtml");goog.require("goog.html.SafeStyle");goog.require("goog.html.SafeUrl");goog.require("goog.html.TrustedResourceUrl");goog.define("goog.html.legacyconversions.ALLOW_LEGACY_CONVERSIONS",true);goog.html.legacyconversions.safeHtmlFromString=function(a){goog.html.legacyconversions.throwIfConversionsDisallowed();return goog.html.SafeHtml.createSafeHtmlSecurityPrivateDoNotAccessOrElse(a,null)};goog.html.legacyconversions.safeStyleFromString=function(a){goog.html.legacyconversions.throwIfConversionsDisallowed();return goog.html.SafeStyle.createSafeStyleSecurityPrivateDoNotAccessOrElse(a)};goog.html.legacyconversions.trustedResourceUrlFromString=function(a){goog.html.legacyconversions.throwIfConversionsDisallowed();return goog.html.TrustedResourceUrl.createTrustedResourceUrlSecurityPrivateDoNotAccessOrElse(a)};goog.html.legacyconversions.safeUrlFromString=function(a){goog.html.legacyconversions.throwIfConversionsDisallowed();return goog.html.SafeUrl.createSafeUrlSecurityPrivateDoNotAccessOrElse(a)};goog.html.legacyconversions.reportCallback_=goog.nullFunction;goog.html.legacyconversions.setReportCallback=function(a){goog.html.legacyconversions.reportCallback_=a};goog.html.legacyconversions.throwIfConversionsDisallowed=function(){if(!goog.html.legacyconversions.ALLOW_LEGACY_CONVERSIONS){throw Error("Error: Legacy conversion from string to goog.html types is disabled")}goog.html.legacyconversions.reportCallback_()};goog.provide("goog.ui.Tooltip");goog.provide("goog.ui.Tooltip.CursorTooltipPosition");goog.provide("goog.ui.Tooltip.ElementTooltipPosition");goog.provide("goog.ui.Tooltip.State");goog.require("goog.Timer");goog.require("goog.array");goog.require("goog.dom");goog.require("goog.dom.safe");goog.require("goog.events");goog.require("goog.events.EventType");goog.require("goog.html.legacyconversions");goog.require("goog.math.Box");goog.require("goog.math.Coordinate");goog.require("goog.positioning");goog.require("goog.positioning.AnchoredPosition");goog.require("goog.positioning.Corner");goog.require("goog.positioning.Overflow");goog.require("goog.positioning.OverflowStatus");goog.require("goog.positioning.ViewportPosition");goog.require("goog.structs.Set");goog.require("goog.style");goog.require("goog.ui.Popup");goog.require("goog.ui.PopupBase");goog.ui.Tooltip=function(b,c,a){this.dom_=a||(b?goog.dom.getDomHelper(goog.dom.getElement(b)):goog.dom.getDomHelper());goog.ui.Popup.call(this,this.dom_.createDom("div",{style:"position:absolute;display:none;"}));this.cursorPosition=new goog.math.Coordinate(1,1);this.elements_=new goog.structs.Set();if(b){this.attach(b)}if(c!=null){this.setText(c)}};goog.inherits(goog.ui.Tooltip,goog.ui.Popup);goog.tagUnsealableClass(goog.ui.Tooltip);goog.ui.Tooltip.activeInstances_=[];goog.ui.Tooltip.prototype.activeEl_=null;goog.ui.Tooltip.prototype.className=goog.getCssName("goog-tooltip");goog.ui.Tooltip.prototype.showDelayMs_=500;goog.ui.Tooltip.prototype.showTimer;goog.ui.Tooltip.prototype.hideDelayMs_=0;goog.ui.Tooltip.prototype.hideTimer;goog.ui.Tooltip.prototype.anchor;goog.ui.Tooltip.State={INACTIVE:0,WAITING_TO_SHOW:1,SHOWING:2,WAITING_TO_HIDE:3,UPDATING:4};goog.ui.Tooltip.Activation={CURSOR:0,FOCUS:1};goog.ui.Tooltip.prototype.seenInteraction_;goog.ui.Tooltip.prototype.requireInteraction_;goog.ui.Tooltip.prototype.childTooltip_;goog.ui.Tooltip.prototype.parentTooltip_;goog.ui.Tooltip.prototype.getDomHelper=function(){return this.dom_};goog.ui.Tooltip.prototype.getChildTooltip=function(){return this.childTooltip_};goog.ui.Tooltip.prototype.attach=function(a){a=goog.dom.getElement(a);this.elements_.add(a);goog.events.listen(a,goog.events.EventType.MOUSEOVER,this.handleMouseOver,false,this);goog.events.listen(a,goog.events.EventType.MOUSEOUT,this.handleMouseOutAndBlur,false,this);goog.events.listen(a,goog.events.EventType.MOUSEMOVE,this.handleMouseMove,false,this);goog.events.listen(a,goog.events.EventType.FOCUS,this.handleFocus,false,this);goog.events.listen(a,goog.events.EventType.BLUR,this.handleMouseOutAndBlur,false,this)};goog.ui.Tooltip.prototype.detach=function(e){if(e){var d=goog.dom.getElement(e);this.detachElement_(d);this.elements_.remove(d)}else{var b=this.elements_.getValues();for(var d,c=0;d=b[c];c++){this.detachElement_(d)}this.elements_.clear()}};goog.ui.Tooltip.prototype.detachElement_=function(a){goog.events.unlisten(a,goog.events.EventType.MOUSEOVER,this.handleMouseOver,false,this);goog.events.unlisten(a,goog.events.EventType.MOUSEOUT,this.handleMouseOutAndBlur,false,this);goog.events.unlisten(a,goog.events.EventType.MOUSEMOVE,this.handleMouseMove,false,this);goog.events.unlisten(a,goog.events.EventType.FOCUS,this.handleFocus,false,this);goog.events.unlisten(a,goog.events.EventType.BLUR,this.handleMouseOutAndBlur,false,this)};goog.ui.Tooltip.prototype.setShowDelayMs=function(a){this.showDelayMs_=a};goog.ui.Tooltip.prototype.getShowDelayMs=function(){return this.showDelayMs_};goog.ui.Tooltip.prototype.setHideDelayMs=function(a){this.hideDelayMs_=a};goog.ui.Tooltip.prototype.getHideDelayMs=function(){return this.hideDelayMs_};goog.ui.Tooltip.prototype.setText=function(a){goog.dom.setTextContent(this.getElement(),a)};goog.ui.Tooltip.prototype.setHtml=function(a){this.setSafeHtml(goog.html.legacyconversions.safeHtmlFromString(a))};goog.ui.Tooltip.prototype.setSafeHtml=function(b){var a=this.getElement();if(a){goog.dom.safe.setInnerHtml(a,b)}};goog.ui.Tooltip.prototype.setElement=function(c){var b=this.getElement();if(b){goog.dom.removeNode(b)}goog.ui.Tooltip.superClass_.setElement.call(this,c);if(c){var a=this.dom_.getDocument().body;a.insertBefore(c,a.lastChild)}};goog.ui.Tooltip.prototype.getText=function(){return goog.dom.getTextContent(this.getElement())};goog.ui.Tooltip.prototype.getHtml=function(){return this.getElement().innerHTML};goog.ui.Tooltip.prototype.getState=function(){return this.showTimer?(this.isVisible()?goog.ui.Tooltip.State.UPDATING:goog.ui.Tooltip.State.WAITING_TO_SHOW):this.hideTimer?goog.ui.Tooltip.State.WAITING_TO_HIDE:this.isVisible()?goog.ui.Tooltip.State.SHOWING:goog.ui.Tooltip.State.INACTIVE};goog.ui.Tooltip.prototype.setRequireInteraction=function(a){this.requireInteraction_=a};goog.ui.Tooltip.prototype.isCoordinateInTooltip=function(c){if(!this.isVisible()){return false}var b=goog.style.getPageOffset(this.getElement());var a=goog.style.getSize(this.getElement());return b.x<=c.x&&c.x<=b.x+a.width&&b.y<=c.y&&c.y<=b.y+a.height};goog.ui.Tooltip.prototype.onBeforeShow=function(){if(!goog.ui.PopupBase.prototype.onBeforeShow.call(this)){return false}if(this.anchor){for(var c,b=0;c=goog.ui.Tooltip.activeInstances_[b];b++){if(!goog.dom.contains(c.getElement(),this.anchor)){c.setVisible(false)}}}goog.array.insert(goog.ui.Tooltip.activeInstances_,this);var a=this.getElement();a.className=this.className;this.clearHideTimer();goog.events.listen(a,goog.events.EventType.MOUSEOVER,this.handleTooltipMouseOver,false,this);goog.events.listen(a,goog.events.EventType.MOUSEOUT,this.handleTooltipMouseOut,false,this);this.clearShowTimer();return true};goog.ui.Tooltip.prototype.onHide_=function(){goog.array.remove(goog.ui.Tooltip.activeInstances_,this);var b=this.getElement();for(var c,a=0;c=goog.ui.Tooltip.activeInstances_[a];a++){if(c.anchor&&goog.dom.contains(b,c.anchor)){c.setVisible(false)}}if(this.parentTooltip_){this.parentTooltip_.startHideTimer()}goog.events.unlisten(b,goog.events.EventType.MOUSEOVER,this.handleTooltipMouseOver,false,this);goog.events.unlisten(b,goog.events.EventType.MOUSEOUT,this.handleTooltipMouseOut,false,this);this.anchor=undefined;if(this.getState()==goog.ui.Tooltip.State.INACTIVE){this.seenInteraction_=false}goog.ui.PopupBase.prototype.onHide_.call(this)};goog.ui.Tooltip.prototype.maybeShow=function(a,b){if(this.anchor==a&&this.elements_.contains(this.anchor)){if(this.seenInteraction_||!this.requireInteraction_){this.setVisible(false);if(!this.isVisible()){this.positionAndShow_(a,b)}}else{this.anchor=undefined}}this.showTimer=undefined};goog.ui.Tooltip.prototype.getElements=function(){return this.elements_};goog.ui.Tooltip.prototype.getActiveElement=function(){return this.activeEl_};goog.ui.Tooltip.prototype.setActiveElement=function(a){this.activeEl_=a};goog.ui.Tooltip.prototype.showForElement=function(a,b){this.attach(a);this.activeEl_=a;this.positionAndShow_(a,b)};goog.ui.Tooltip.prototype.positionAndShow_=function(a,b){this.anchor=a;this.setPosition(b||this.getPositioningStrategy(goog.ui.Tooltip.Activation.CURSOR));this.setVisible(true)};goog.ui.Tooltip.prototype.maybeHide=function(a){this.hideTimer=undefined;if(a==this.anchor){if((this.activeEl_==null||(this.activeEl_!=this.getElement()&&!this.elements_.contains(this.activeEl_)))&&!this.hasActiveChild()){this.setVisible(false)}}};goog.ui.Tooltip.prototype.hasActiveChild=function(){return !!(this.childTooltip_&&this.childTooltip_.activeEl_)};goog.ui.Tooltip.prototype.saveCursorPosition_=function(b){var a=this.dom_.getDocumentScroll();this.cursorPosition.x=b.clientX+a.x;this.cursorPosition.y=b.clientY+a.y};goog.ui.Tooltip.prototype.handleMouseOver=function(b){var a=this.getAnchorFromElement((b.target));this.activeEl_=(a);this.clearHideTimer();if(a!=this.anchor){this.anchor=a;this.startShowTimer((a));this.checkForParentTooltip_();this.saveCursorPosition_(b)}};goog.ui.Tooltip.prototype.getAnchorFromElement=function(a){try{while(a&&!this.elements_.contains(a)){a=(a.parentNode)}return a}catch(b){return null}};goog.ui.Tooltip.prototype.handleMouseMove=function(a){this.saveCursorPosition_(a);this.seenInteraction_=true};goog.ui.Tooltip.prototype.handleFocus=function(b){var a=this.getAnchorFromElement((b.target));this.activeEl_=a;this.seenInteraction_=true;if(this.anchor!=a){this.anchor=a;var c=this.getPositioningStrategy(goog.ui.Tooltip.Activation.FOCUS);this.clearHideTimer();this.startShowTimer((a),c);this.checkForParentTooltip_()}};goog.ui.Tooltip.prototype.getPositioningStrategy=function(a){if(a==goog.ui.Tooltip.Activation.CURSOR){var b=this.cursorPosition.clone();return new goog.ui.Tooltip.CursorTooltipPosition(b)}return new goog.ui.Tooltip.ElementTooltipPosition(this.activeEl_)};goog.ui.Tooltip.prototype.checkForParentTooltip_=function(){if(this.anchor){for(var b,a=0;b=goog.ui.Tooltip.activeInstances_[a];a++){if(goog.dom.contains(b.getElement(),this.anchor)){b.childTooltip_=this;this.parentTooltip_=b}}}};goog.ui.Tooltip.prototype.handleMouseOutAndBlur=function(c){var b=this.getAnchorFromElement((c.target));var a=this.getAnchorFromElement((c.relatedTarget));if(b==a){return}if(b==this.activeEl_){this.activeEl_=null}this.clearShowTimer();this.seenInteraction_=false;if(this.isVisible()&&(!c.relatedTarget||!goog.dom.contains(this.getElement(),c.relatedTarget))){this.startHideTimer()}else{this.anchor=undefined}};goog.ui.Tooltip.prototype.handleTooltipMouseOver=function(b){var a=this.getElement();if(this.activeEl_!=a){this.clearHideTimer();this.activeEl_=a}};goog.ui.Tooltip.prototype.handleTooltipMouseOut=function(b){var a=this.getElement();if(this.activeEl_==a&&(!b.relatedTarget||!goog.dom.contains(a,b.relatedTarget))){this.activeEl_=null;this.startHideTimer()}};goog.ui.Tooltip.prototype.startShowTimer=function(a,b){if(!this.showTimer){this.showTimer=goog.Timer.callOnce(goog.bind(this.maybeShow,this,a,b),this.showDelayMs_)}};goog.ui.Tooltip.prototype.clearShowTimer=function(){if(this.showTimer){goog.Timer.clear(this.showTimer);this.showTimer=undefined}};goog.ui.Tooltip.prototype.startHideTimer=function(){if(this.getState()==goog.ui.Tooltip.State.SHOWING){this.hideTimer=goog.Timer.callOnce(goog.bind(this.maybeHide,this,this.anchor),this.getHideDelayMs())}};goog.ui.Tooltip.prototype.clearHideTimer=function(){if(this.hideTimer){goog.Timer.clear(this.hideTimer);this.hideTimer=undefined}};goog.ui.Tooltip.prototype.disposeInternal=function(){this.setVisible(false);this.clearShowTimer();this.detach();if(this.getElement()){goog.dom.removeNode(this.getElement())}this.activeEl_=null;delete this.dom_;goog.ui.Tooltip.superClass_.disposeInternal.call(this)};goog.ui.Tooltip.CursorTooltipPosition=function(a,b){goog.positioning.ViewportPosition.call(this,a,b)};goog.inherits(goog.ui.Tooltip.CursorTooltipPosition,goog.positioning.ViewportPosition);goog.ui.Tooltip.CursorTooltipPosition.prototype.reposition=function(d,c,b){var e=goog.style.getClientViewportElement(d);var a=goog.style.getVisibleRectForElement(e);var f=b?new goog.math.Box(b.top+10,b.right,b.bottom,b.left+10):new goog.math.Box(10,0,0,10);if(goog.positioning.positionAtCoordinate(this.coordinate,d,goog.positioning.Corner.TOP_START,f,a,goog.positioning.Overflow.ADJUST_X|goog.positioning.Overflow.FAIL_Y)&goog.positioning.OverflowStatus.FAILED){goog.positioning.positionAtCoordinate(this.coordinate,d,goog.positioning.Corner.TOP_START,f,a,goog.positioning.Overflow.ADJUST_X|goog.positioning.Overflow.ADJUST_Y)}};goog.ui.Tooltip.ElementTooltipPosition=function(a){goog.positioning.AnchoredPosition.call(this,a,goog.positioning.Corner.BOTTOM_RIGHT)};goog.inherits(goog.ui.Tooltip.ElementTooltipPosition,goog.positioning.AnchoredPosition);goog.ui.Tooltip.ElementTooltipPosition.prototype.reposition=function(c,b,a){var d=new goog.math.Coordinate(10,0);if(goog.positioning.positionAtAnchor(this.element,this.corner,c,b,d,a,goog.positioning.Overflow.ADJUST_X|goog.positioning.Overflow.FAIL_Y)&goog.positioning.OverflowStatus.FAILED){goog.positioning.positionAtAnchor(this.element,goog.positioning.Corner.TOP_RIGHT,c,goog.positioning.Corner.BOTTOM_LEFT,d,a,goog.positioning.Overflow.ADJUST_X|goog.positioning.Overflow.ADJUST_Y)}};goog.provide("au.upldr.ui.Css3ToolbarButtonRenderer");goog.require("goog.ui.Css3ButtonRenderer");goog.require("au.upldr.ui.ClassNames");au.upldr.ui.Css3ToolbarButtonRenderer=function(){goog.base(this)};goog.inherits(au.upldr.ui.Css3ToolbarButtonRenderer,goog.ui.Css3ButtonRenderer);goog.addSingletonGetter(au.upldr.ui.Css3ToolbarButtonRenderer);au.upldr.ui.Css3ToolbarButtonRenderer.CSS_CLASS=au.upldr.ui.ClassNames.CSS3_TOOLBAR_BUTTON;au.upldr.ui.Css3ToolbarButtonRenderer.prototype.getCssClass=function(){return au.upldr.ui.Css3ToolbarButtonRenderer.CSS_CLASS};goog.provide("au.upldr.ui.ItemRenderer");goog.require("goog.ui.ControlRenderer");goog.require("goog.ui.Toolbar");goog.require("goog.ui.Tooltip");goog.require("goog.ui.IdGenerator");goog.require("au.upldr.utils");goog.require("au.upldr.ui.ClassNames");goog.require("au.upldr.ui.ClassNamesCompat");au.upldr.ui.ItemRenderer=function(){goog.base(this);this._imageEditorButton=null;this._toolBar=null};goog.inherits(au.upldr.ui.ItemRenderer,goog.ui.ControlRenderer);au.upldr.ui.ItemRenderer.CSS_CLASS=au.upldr.ui.ClassNames.LIST_ITEM;au.upldr.ui.ItemRenderer.prototype.getCssClass=function(){return au.upldr.ui.ItemRenderer.CSS_CLASS};au.upldr.ui.ItemRenderer.prototype.createDom=function(c){var d=c.getDomHelper();var b=d.createDom("li",au.upldr.ui.ItemRenderer.CSS_CLASS+" "+this.getClassNames(c).join(" "));d.setProperties(b,{draggable:"true"});var a=this.getItemWidthInternal(c);if(a>0){b.style.width=a+"px"}c.setElementInternal(b);this.createContentDomInternal(c);b.id=c.getId();return b};au.upldr.ui.ItemRenderer.prototype.getItemWidthInternal=function(a){return 0};au.upldr.ui.ItemRenderer.prototype.createContentDomInternal=function(d){var e=d.getDomHelper();var b=d.getContentElement();e.appendChild(b,this.createPreviewInternal(d));var c=this.createToolbarInternal(d);d.setToolbar(c);d.addChild(c,true);goog.dom.classlist.addAll(c.getElement(),au.upldr.ui.ClassNamesCompat.ICONS_BAR.replace(/\s+/," ").split(" "));e.appendChild(b,this.createCaptionInternal(d));var a=this.createDescriptionIconInternal(d);e.appendChild(b,a)};au.upldr.ui.ItemRenderer.prototype.createDescriptionIconInternal=function(c){var b=c.getModel().getDescription();var e=c.getDomHelper();var a=e.createDom("div",{"class":au.upldr.ui.ClassNames.DESCRIPTION_ICON,id:c.makeId(au.upldr.ui.ListItem.DESCRIPTION_ICON)});goog.style.setElementShown(a,!!b);var d=c.getDescriptionTooltip();if(d){d.dispose()}d=new goog.ui.Tooltip(a);if(b!=null){d.setHtml(au.upldr.utils.insertBR(b,true))}c.setDescriptionTooltip(d);return a};au.upldr.ui.ItemRenderer.prototype.createPreviewInternal=function(b){var a=b.getDomHelper().createDom("div",{"class":b.getModel().getIconCssClass(),id:b.makeId(au.upldr.ui.ListItem.PREVIEW)});return a};au.upldr.ui.ItemRenderer.prototype.createToolbarInternal=function(a){this._toolBar=new goog.ui.Toolbar();this._toolBar.setFocusable(false);this._toolBar.setId(goog.ui.IdGenerator.getInstance().getNextUniqueId());this.createImageEditorButton(a);this.createDescriptionButton(a);this.createRotateButton(a);this.createRemoveButton(a);return this._toolBar};au.upldr.ui.ItemRenderer.prototype.createRotateButton=function(c){var e=c.getUploader().getPropertyHolder();var a=au.upldr.ui.Css3ToolbarButtonRenderer.getInstance();var b=new goog.ui.ToolbarButton(goog.dom.createDom("div",[au.upldr.ui.ClassNames.BUTTON,au.upldr.ui.ClassNames.ROTATE_BUTTON].join(" ")),a);b.setValue(au.upldr.ui.toolbar.Action.ROTATE);var d=(e.getProperty(au.upldr.Properties.ROTATE_BUTTON_TOOLTIP));b.setTooltip(d);b.setId(this._toolBar.makeId(au.upldr.ui.toolbar.Action.ROTATE.toString(36)));b.setVisible(e.getProperty(au.upldr.Properties.ENABLE_ROTATION));this._toolBar.addChild(b,true)};au.upldr.ui.ItemRenderer.prototype.createRemoveButton=function(c){var e=c.getUploader().getPropertyHolder();var a=au.upldr.ui.Css3ToolbarButtonRenderer.getInstance();var b=new goog.ui.ToolbarButton(goog.dom.createDom("div",[au.upldr.ui.ClassNames.BUTTON,au.upldr.ui.ClassNames.REMOVE_BUTTON].join(" ")),a);b.setValue(au.upldr.ui.toolbar.Action.REMOVE);var d=(e.getProperty(au.upldr.Properties.REMOVE_BUTTON_TOOLTIP));b.setTooltip(d);b.setId(this._toolBar.makeId(au.upldr.ui.toolbar.Action.REMOVE.toString(36)));this._toolBar.addChild(b,true)};au.upldr.ui.ItemRenderer.prototype.createDescriptionButton=function(c){var e=c.getUploader().getPropertyHolder();var a=au.upldr.ui.Css3ToolbarButtonRenderer.getInstance();var b=new goog.ui.ToolbarButton(goog.dom.createDom("div",[au.upldr.ui.ClassNames.BUTTON,au.upldr.ui.ClassNames.EDIT_DESCRIPTION_BUTTON].join(" ")),a);b.setValue(au.upldr.ui.toolbar.Action.EDIT_DESCRIPTION);var d=(e.getProperty(au.upldr.Properties.EDIT_DESCRIPTION_BUTTON_TOOLTIP));b.setTooltip(d);b.setId(this._toolBar.makeId(au.upldr.ui.toolbar.Action.EDIT_DESCRIPTION.toString(36)));b.setVisible(e.getProperty(au.upldr.Properties.ENABLE_DESCRIPTION_EDITOR));this._toolBar.addChild(b,true)};au.upldr.ui.ItemRenderer.prototype.getImageEditorButtonClass=function(d){var b=(d.getProperty(au.upldr.Properties.IMAGE_EDITOR_ENABLE_CROP));var a=(d.getProperty(au.upldr.Properties.IMAGE_EDITOR_ENABLE_DRAW_TOOL));var c=(d.getProperty(au.upldr.Properties.IMAGE_EDITOR_DEFAULT_TOOL));if(a&&c==au.upldr.imaging.tools.DRAW){return[au.upldr.ui.ClassNames.BUTTON,au.upldr.ui.ClassNames.BRUSH_BUTTON].join(" ")}if(b&&c==au.upldr.imaging.tools.CROP){return[au.upldr.ui.ClassNames.BUTTON,au.upldr.ui.ClassNames.CROP_AREA_BUTTON].join(" ")}return[au.upldr.ui.ClassNames.BUTTON,au.upldr.ui.ClassNames.CROP_AREA_BUTTON].join(" ")};au.upldr.ui.ItemRenderer.prototype.createImageEditorButton=function(c){var e=c.getUploader();var f=e.getPropertyHolder();var a=goog.dom.createDom("div",this.getImageEditorButtonClass(f));var b=new goog.ui.ToolbarButton(a,au.upldr.ui.Css3ToolbarButtonRenderer.getInstance());f.observe(au.upldr.Properties.IMAGE_EDITOR_ENABLE_CROP,function(){goog.dom.classlist.set(a,this.getImageEditorButtonClass(f))},this);f.observe(au.upldr.Properties.IMAGE_EDITOR_DEFAULT_TOOL,function(){goog.dom.classlist.set(a,this.getImageEditorButtonClass(f))},this);f.observe(au.upldr.Properties.BRUSH_BUTTON,function(){goog.dom.classlist.set(a,this.getImageEditorButtonClass(f))},this);b.setValue(au.upldr.ui.toolbar.Action.EDIT);var d=(f.getProperty(au.upldr.Properties.EDIT_BUTTON_TOOLTIP));b.setTooltip(d);b.setVisible(f.getProperty(au.upldr.Properties.ENABLE_DESCRIPTION_EDITOR));this._toolBar.addChild(b,true)};au.upldr.ui.ItemRenderer.prototype.createCaptionInternal=function(a){return a.getDomHelper().createDom("div",au.upldr.ui.ClassNames.ITEM_CONTENT)};au.upldr.ui.ItemRenderer.prototype.getAriaRole=function(){return goog.a11y.aria.Role.LISTITEM};goog.provide("au.upldr.ui.TileItemRenderer");goog.require("goog.ui.ToolbarButton");goog.require("goog.dom.classlist");goog.require("au.upldr.ui.ItemRenderer");goog.require("au.upldr.ui.Label");goog.require("au.upldr.ui.toolbar.Action");goog.require("au.upldr.ui.Css3ToolbarButtonRenderer");au.upldr.ui.TileItemRenderer=function(){goog.base(this)};goog.inherits(au.upldr.ui.TileItemRenderer,au.upldr.ui.ItemRenderer);goog.addSingletonGetter(au.upldr.ui.TileItemRenderer);au.upldr.ui.TileItemRenderer.CSS_CLASS=au.upldr.ui.ClassNames.TILE_LIST_ITEM;au.upldr.ui.TileItemRenderer.prototype.getCssClass=function(){return au.upldr.ui.TileItemRenderer.CSS_CLASS};au.upldr.ui.TileItemRenderer.prototype.getItemWidthInternal=function(a){return(a.getUploader().getPropertyHolder().getProperty(au.upldr.Properties.UPLOAD_PANE_TILE_ITEM_WIDTH))};au.upldr.ui.TileItemRenderer.prototype.createPreviewInternal=function(b){var d=goog.base(this,"createPreviewInternal",b);var a=(b.getUploader().getPropertyHolder().getProperty(au.upldr.Properties.UPLOAD_PANE_TILE_PREVIEW_SIZE));if(a>0){d.style.fontSize=d.style.width=d.style.height=a+"px"}var c=b.getModel().getTilePreview();if(c){if(!goog.array.contains(goog.dom.classlist.get(c),au.upldr.ui.ClassNames.CANVAS_EMPTY)){goog.dom.classlist.addAll(d,au.upldr.ui.ClassNames.BACKGROUND_EMPTY.replace(/\s+/," ").split(" "))}goog.dom.appendChild(d,c)}return d};au.upldr.ui.TileItemRenderer.prototype.createCaptionInternal=function(e){var f=e.getDomHelper();var c=e.getModel();var b=goog.base(this,"createCaptionInternal",e);var d=f.createDom("div",au.upldr.ui.ClassNames.FILE_NAME,c.getName());goog.dom.classlist.addAll(d,au.upldr.ui.ClassNamesCompat.TILE_ITEM_FILE_NAME_TEXT.replace(/\s+/," ").split(" "));f.appendChild(b,d);d=f.createDom("div",au.upldr.ui.ClassNames.FILE_SIZE,c.getFormattedSize());goog.dom.classlist.addAll(d,au.upldr.ui.ClassNamesCompat.TILE_ITEM_PARAM_TEXT.replace(/\s+/," ").split(" "));f.appendChild(b,d);if(c.isImage()){var a=new au.upldr.ui.Label("");a.setId(e.makeId("dimension"));e.addChild(a);a.render(d)}return b};goog.provide("au.upldr.ui.ListItem");goog.require("goog.array");goog.require("goog.style");goog.require("goog.dom.classlist");goog.require("goog.ui.Component.EventType");goog.require("goog.ui.Component.State");goog.require("goog.ui.Control");goog.require("goog.ui.Tooltip");goog.require("au.upldr.ItemHolder.Properties");goog.require("au.upldr.utils");goog.require("au.upldr.Properties");goog.require("au.upldr.ui.TileItemRenderer");goog.require("au.upldr.ui.toolbar.Action");au.upldr.ui.ListItem=function(a,c,b){goog.base(this,null,b);this.setAllowTextSelection(true);this.setSupportedState(goog.ui.Component.State.SELECTED,true);this.setAutoStates(goog.ui.Component.State.SELECTED,false);this.setModel(a);this.uploader_=c;this.tooltip_=new goog.ui.Tooltip();this.updateTooltip_();this.descriptionTooltip_;this.toolbar_=null;this.getHandler().listen(a,au.upldr.events.EventType.PROPERTY_CHANGE,this.onModelPropertyChange_)};goog.inherits(au.upldr.ui.ListItem,goog.ui.Control);au.upldr.ui.ListItem.PREVIEW="preview";au.upldr.ui.ListItem.DESCRIPTION_ICON="descriptionicon";au.upldr.ui.ListItem.getDimensionHtml=function(b,a){return", "+b+"x"+a};au.upldr.ui.ListItem.prototype.setToolbar=function(a){this.toolbar_=a};au.upldr.ui.ListItem.prototype.getToolbar=function(){return this.toolbar_};au.upldr.ui.ListItem.prototype.getDescriptionTooltip=function(){return this.descriptionTooltip_};au.upldr.ui.ListItem.prototype.setDescriptionTooltip=function(a){this.descriptionTooltip_=a};au.upldr.ui.ListItem.prototype.onModelPropertyChange_=function(b){var a=b.getPropertyName();if(a==au.upldr.ItemHolder.Properties.IMAGE_WIDTH||a==au.upldr.ItemHolder.Properties.IMAGE_HEIGHT){this.updateDimensionLabel_();this.updateTooltip_()}else{if(a==au.upldr.ItemHolder.Properties.ANGLE){this.updateImagePreview_()}else{if(a==au.upldr.ItemHolder.Properties.DESCRIPTION){this.updateDescriptionIcon_()}else{if(a==au.upldr.ItemHolder.Properties.SELECTED){this.updateSelection_()}}}}};au.upldr.ui.ListItem.prototype.updateTooltip_=function(){var e=this.getModel();var f=e.isImage();var d=f?e.getImageWidth():0;var a=f?e.getImageHeight():0;f=d>0&&a>0;var b=f?au.upldr.Properties.IMAGE_TOOLTIP:au.upldr.Properties.ITEM_TOOLTIP;b=(this.getUploader().getPropertyHolder().getProperty(b));var c=b.replace(/[,\u3001]\s*\n.*[:\uff1a]\s*\{2\}$/g,"");if(c!=b){b=c.replace(/\{3\}/g,"{2}")}b=au.upldr.utils.format((b),e.getName(),e.getFormattedSize(),d+"x"+a);b=au.upldr.utils.insertBR(b,true);if(b.match(/^\s*$/)){this.tooltip_.detach(this.getElement())}else{this.tooltip_.setHtml(b)}};au.upldr.ui.ListItem.prototype.updateDimensionLabel_=function(){var d=this.getChild(this.makeId("dimension"));if(d){var b=this.getModel();var c=b.getImageWidth();var a=b.getImageHeight();if(c>0&&a>0){d.setLabelText(au.upldr.ui.ListItem.getDimensionHtml(c,a))}}};au.upldr.ui.ListItem.prototype.updateImagePreview_=function(){this.getModel().updateCanvasAngle()};au.upldr.ui.ListItem.prototype.getId=function(){return"item_"+this.getModel().getGuid()};au.upldr.ui.ListItem.prototype.updateDescriptionIcon_=function(){var a=this.getModel();var c=a.getDescription()+"";var b=goog.dom.getElement(this.makeId(au.upldr.ui.ListItem.DESCRIPTION_ICON));var d=this.getDescriptionTooltip();d.setHtml(au.upldr.utils.insertBR(c,true));goog.style.setElementShown(b,!!c)};au.upldr.ui.ListItem.prototype.onToolbarButtonClick_=function(d){if(d.target instanceof goog.ui.ToolbarButton){var b=(d.target.getValue());switch(b){case au.upldr.ui.toolbar.Action.EDIT_DESCRIPTION:this.getUploader().showDescriptionEditor(this,true);break;case au.upldr.ui.toolbar.Action.REMOVE:var c=this.getUploader();if(this.isSelected()){var a=[];this.getParent().forEachChild(function(f,e){if(f.isSelected()){a.unshift(e)}});c.removeFile(a)}else{c.removeFile(this.getModel().getGuid())}break;case au.upldr.ui.toolbar.Action.ROTATE:if(this.isSelected()){this.getParent().forEachChild(function(f,e){if(f.isSelected()){f.rotate_()}})}else{this.rotate_()}break;case au.upldr.ui.toolbar.Action.EDIT:this.getUploader().showImageEditor(this.getModel(),true);break}}d.stopPropagation()};au.upldr.ui.ListItem.prototype.showSharedButtons=function(){var b=this.uploader_.getPropertyHolder().getProperty(au.upldr.Properties.PANE_ITEM_TOOLBAR_ALWAYS_VISIBLE);var e=this,f=e.getParent();var g=(this.getUploader().getPropertyHolder());var a=g.getProperty(au.upldr.Properties.ENABLE_DESCRIPTION_EDITOR);var d=g.getProperty(au.upldr.Properties.ENABLE_ROTATION);var c=g.getProperty(au.upldr.Properties.ENABLE_IMAGE_EDITOR);f.forEachChild(function(k){var h=k.isSelected();if(h||b){var j=k.getModel().isImage();var i=e==k;k.getToolbar().forEachChild(function(m){var l=m.getValue();if(l==au.upldr.ui.toolbar.Action.EDIT_DESCRIPTION){m.setVisible((i||b)&&a)}else{if(l==au.upldr.ui.toolbar.Action.ROTATE){m.setVisible((h||b)&&d&&j)}else{if(l==au.upldr.ui.toolbar.Action.REMOVE){m.setVisible(true)}else{if(l==au.upldr.ui.toolbar.Action.EDIT){m.setVisible((i||b)&&j&&c)}}}}})}k.showToolbar(h||b)})};au.upldr.ui.ListItem.prototype.showToolbar=function(a){if(this.uploader_.getPropertyHolder().getProperty(au.upldr.Properties.PANE_ITEM_TOOLBAR_ALWAYS_VISIBLE)){a=true}this.getToolbar().setVisible(a)};au.upldr.ui.ListItem.prototype.rotate_=function(){var a=this.getModel();var b=a.getAngle()||0;a.setAngle(b+90)};au.upldr.ui.ListItem.prototype.setSelected=function(a){goog.base(this,"setSelected",a);this.getModel().setSelected(a);this.dispatchSelectionChangeEvent_(a)};au.upldr.ui.ListItem.prototype.updateSelection_=function(){this.setSelected(this.getModel().isSelected())};au.upldr.ui.ListItem.prototype.dispatchSelectionChangeEvent_=function(a){var b=new goog.events.Event(goog.events.EventType.SELECT);b.select=a;try{this.dispatchEvent(b)}catch(c){}};au.upldr.ui.ListItem.prototype.enterDocument=function(){goog.base(this,"enterDocument");var b=this.getElement();this.tooltip_.attach(b);var a=null;var c=(this.getUploader().getPropertyHolder());this.getHandler().listen(this,[goog.ui.Component.EventType.HIGHLIGHT,goog.ui.Component.EventType.UNHIGHLIGHT],function(d){if(d.target==this&&!this.isSelected()){window.clearTimeout(a);a=window.setTimeout(function(){if(d.target==this&&!this.isSelected()&&this.getModel()){if(!c.getProperty(au.upldr.Properties.PANE_ITEM_TOOLBAR_ALWAYS_VISIBLE)){var h=this.getToolbar();var j=this.getModel().isImage();var i=(d.type==goog.ui.Component.EventType.HIGHLIGHT);var e=c.getProperty(au.upldr.Properties.ENABLE_DESCRIPTION_EDITOR);var g=c.getProperty(au.upldr.Properties.ENABLE_ROTATION);var f=c.getProperty(au.upldr.Properties.ENABLE_IMAGE_EDITOR);h.setVisible(i);h.forEachChild(function(l){var k=l.getValue();if(k==au.upldr.ui.toolbar.Action.EDIT_DESCRIPTION){l.setVisible(i&&e)}else{if(k==au.upldr.ui.toolbar.Action.ROTATE){l.setVisible(i&&j&&g)}else{if(k==au.upldr.ui.toolbar.Action.REMOVE){l.setVisible(i)}else{if(k==au.upldr.ui.toolbar.Action.EDIT){l.setVisible(i&&j&&f)}}}}})}}}.bind(this),200)}}).listen(this.toolbar_,goog.ui.Component.EventType.ACTION,this.onToolbarButtonClick_).listen(this.toolbar_.getElement(),[goog.events.EventType.MOUSEUP,goog.events.EventType.DBLCLICK],function(d){d.stopPropagation()}).listen(b,goog.events.EventType.DRAGSTART,this.onDragStart_).listen(b,goog.events.EventType.DRAGOVER,this.onDragOver_).listen(b,goog.events.EventType.DRAGLEAVE,this.onDragLeave_).listen(b,goog.events.EventType.DROP,this.onDrop_).listen(b,goog.events.EventType.DBLCLICK,this.showImagePreview_);this.showToolbar(false);this.updateDimensionLabel_()};au.upldr.ui.ListItem.prototype.onDragStart_=function(b){var d=b.getBrowserEvent();try{d.dataTransfer.effectAllowed="move"}catch(a){}var c=d.currentTarget.id;d.dataTransfer.setData("text",c+"|"+goog.getUid(this.getModel()))};au.upldr.ui.ListItem.prototype.onDragOver_=function(a){if(!this.hasFile_(a.event_.dataTransfer)){goog.dom.classlist.add(a.currentTarget,"dragover")}};au.upldr.ui.ListItem.prototype.onDragLeave_=function(a){if(!this.hasFile_(a.event_.dataTransfer)){goog.dom.classlist.remove(a.currentTarget,"dragover")}};au.upldr.ui.ListItem.prototype.onDrop_=function(k){var b=k.event_.dataTransfer;if(!this.hasFile_(b)){var d=k.currentTarget;var o=b.getData("text").split("|");var j=o[0];if(d.id!=j){var f=this.getDomHelper();var h=+o[1];var c=goog.getUid(this.getModel());var n=document.getElementById(j);var a=k.currentTarget;var l=a.parentNode.childNodes;var m=-1;var q=-1;for(var g=0;g<l.length-1;g++){if(l[g]==n){m=g}if(l[g]==a){q=g}}if(m<q){f.insertSiblingAfter(n,a);this.uploader_.items_.insertItemAfter(c,h)}else{f.insertSiblingBefore(n,a);this.uploader_.items_.insertItemBefore(h,c)}}goog.dom.classlist.remove(k.currentTarget,"dragover")}};au.upldr.ui.ListItem.prototype.hasFile_=function(a){return(goog.isDefAndNotNull(a)&&((goog.isDefAndNotNull(a.types)&&(goog.array.contains(a.types,"Files")||goog.array.contains(a.types,"public.file-url")))||(goog.isDefAndNotNull(a.files)&&a.files.length>0)))};au.upldr.ui.ListItem.prototype.showImagePreview_=function(){this.uploader_.showImagePreview(this.getModel(),true)};au.upldr.ui.ListItem.prototype.exitDocument=function(){goog.base(this,"exitDocument");if(this.tooltip_){this.tooltip_.detach(this.getElement())}};au.upldr.ui.ListItem.prototype.getModel;au.upldr.ui.ListItem.prototype.getUploader=function(){return this.uploader_};au.upldr.ui.ListItem.prototype.disposeInternal=function(){this.tooltip_.dispose();delete this.tooltip_;this.descriptionTooltip_.dispose();delete this.descriptionTooltip_;goog.base(this,"disposeInternal")};au.upldr.ui.ListItem.prototype.canDecorate=goog.functions.FALSE;goog.ui.registry.setDefaultRenderer(au.upldr.ui.ListItem,au.upldr.ui.TileItemRenderer);goog.provide("au.upldr.ui.ThumbnailItemRenderer");goog.require("goog.dom.classlist");goog.require("goog.ui.ToolbarButton");goog.require("au.upldr.Properties");goog.require("au.upldr.ui.ItemRenderer");goog.require("au.upldr.ui.toolbar.Action");goog.require("au.upldr.ui.Css3ToolbarButtonRenderer");goog.require("au.upldr.ui.ClassNames");goog.require("au.upldr.ui.ClassNamesCompat");au.upldr.ui.ThumbnailItemRenderer=function(){goog.base(this)};goog.inherits(au.upldr.ui.ThumbnailItemRenderer,au.upldr.ui.ItemRenderer);goog.addSingletonGetter(au.upldr.ui.ThumbnailItemRenderer);au.upldr.ui.ThumbnailItemRenderer.CSS_CLASS=au.upldr.ui.ClassNames.THUMBNAIL_LIST_ITEM;au.upldr.ui.ThumbnailItemRenderer.prototype.getCssClass=function(){return au.upldr.ui.ThumbnailItemRenderer.CSS_CLASS};au.upldr.ui.ThumbnailItemRenderer.prototype.createPreviewInternal=function(b){var d=goog.base(this,"createPreviewInternal",b);var a=(b.getUploader().getPropertyHolder().getProperty(au.upldr.Properties.UPLOAD_PANE_THUMBNAIL_PREVIEW_SIZE));if(a>0){d.style.fontSize=d.style.width=d.style.height=a+"px"}var c=b.getModel().getThumbnailPreview();if(c){if(!goog.array.contains(goog.dom.classlist.get(c),au.upldr.ui.ClassNames.CANVAS_EMPTY)){goog.dom.classlist.addAll(d,au.upldr.ui.ClassNames.BACKGROUND_EMPTY.replace(/\s+/," ").split(" "))}goog.dom.appendChild(d,c)}return d};au.upldr.ui.ThumbnailItemRenderer.prototype.createContentDomInternal=function(e){var f=e.getDomHelper();var c=e.getContentElement();f.appendChild(c,this.createPreviewInternal(e));var b=f.createDom("div",au.upldr.ui.ClassNames.TOOLBAR_OUTER);f.appendChild(c,b);var d=this.createToolbarInternal(e);e.setToolbar(d);e.addChild(d,false);d.render(b);goog.dom.classlist.addAll(d.getElement(),au.upldr.ui.ClassNamesCompat.ICONS_BAR.replace(/\s+/," ").split(" "));f.appendChild(c,this.createCaptionInternal(e));var a=this.createDescriptionIconInternal(e);f.appendChild(c,a)};goog.provide("au.upldr.ui.IconItemRenderer");goog.require("goog.ui.ToolbarButton");goog.require("au.upldr.Properties");goog.require("au.upldr.ui.ItemRenderer");goog.require("au.upldr.ui.toolbar.Action");goog.require("au.upldr.ui.Css3ToolbarButtonRenderer");goog.require("au.upldr.ui.ClassNames");goog.require("au.upldr.ui.ClassNamesCompat");au.upldr.ui.IconItemRenderer=function(){goog.base(this)};goog.inherits(au.upldr.ui.IconItemRenderer,au.upldr.ui.ItemRenderer);goog.addSingletonGetter(au.upldr.ui.IconItemRenderer);au.upldr.ui.IconItemRenderer.CSS_CLASS=au.upldr.ui.ClassNames.ICON_LIST_ITEM;au.upldr.ui.IconItemRenderer.prototype.getCssClass=function(){return au.upldr.ui.IconItemRenderer.CSS_CLASS};au.upldr.ui.IconItemRenderer.prototype.getItemWidthInternal=function(a){return(a.getUploader().getPropertyHolder().getProperty(au.upldr.Properties.UPLOAD_PANE_ICON_ITEM_WIDTH))};au.upldr.ui.IconItemRenderer.prototype.createToolbarInternal=function(c){this._toolBar=new goog.ui.Toolbar();this._toolBar.setFocusable(false);this._toolBar.setId(goog.ui.IdGenerator.getInstance().getNextUniqueId());var a=au.upldr.ui.Css3ToolbarButtonRenderer.getInstance();var b=new goog.ui.ToolbarButton(goog.dom.createDom("div",[au.upldr.ui.ClassNames.BUTTON,au.upldr.ui.ClassNames.REMOVE_BUTTON].join(" ")),a);b.setValue(au.upldr.ui.toolbar.Action.REMOVE);var d=(c.getUploader().getPropertyHolder().getProperty(au.upldr.Properties.REMOVE_BUTTON_TOOLTIP));b.setTooltip(d);b.setId(this._toolBar.makeId(au.upldr.ui.toolbar.Action.REMOVE.toString(36)));this._toolBar.addChild(b,true);return this._toolBar};au.upldr.ui.IconItemRenderer.prototype.createPreviewInternal=function(b){var c=goog.base(this,"createPreviewInternal",b);var a=(b.getUploader().getPropertyHolder().getProperty(au.upldr.Properties.UPLOAD_PANE_ICON_SIZE));if(a>0){c.style.fontSize=c.style.width=c.style.height=a+"px"}return c};au.upldr.ui.IconItemRenderer.prototype.createCaptionInternal=function(b){var a=goog.base(this,"createCaptionInternal",b);b.getDomHelper().setTextContent(a,b.getModel().getName());goog.dom.classlist.addAll(a,au.upldr.ui.ClassNamesCompat.ICON_ITEM_FILE_NAME_TEXT.replace(/\s+/," ").split(" "));return a};goog.provide("au.upldr.ui.FileButtonRenderer");goog.require("goog.ui.Css3ButtonRenderer");goog.require("au.upldr.events.AddFileEvent");au.upldr.ui.FileButtonRenderer=function(){goog.base(this)};goog.inherits(au.upldr.ui.FileButtonRenderer,goog.ui.Css3ButtonRenderer);au.upldr.ui.FileButtonRenderer.prototype.createDom=function(c){var f=this.getClassNames(c);var a={"class":goog.ui.INLINE_BLOCK_CLASSNAME+" au-upldr-file-button "+f.join(" "),title:c.getTooltip()||""};var b=c.getDomHelper();var e=b.createDom("input",{type:"file",multiple:"multiple"});var d=b.createDom("div",a,e,b.createDom("div",null,c.getContent()));return d};au.upldr.ui.FileButtonRenderer.prototype.getContentElement=function(a){return goog.dom.getLastElementChild(a)};goog.addSingletonGetter(au.upldr.ui.FileButtonRenderer);goog.provide("au.upldr.ui.FileButton");goog.require("goog.ui.Button");goog.require("au.upldr.events.AddFileEvent");goog.require("au.upldr.ui.FileButtonRenderer");au.upldr.ui.FileButton=function(b,c,a){goog.base(this,b,c||au.upldr.ui.FileButtonRenderer.getInstance(),a);this.fileInput_=null};goog.inherits(au.upldr.ui.FileButton,goog.ui.Button);au.upldr.ui.FileButton.prototype.enterDocument=function(){goog.base(this,"enterDocument");var a=this.getElement();this.fileInput_=(goog.dom.getFirstElementChild(a));if(this.fileInput_){this.getHandler().listen(this.fileInput_,goog.events.EventType.CHANGE,this.fileInputChanged_,false)}};au.upldr.ui.FileButton.prototype.getFileInput=function(){return this.fileInput_};au.upldr.ui.FileButton.prototype.exitDocument=function(){goog.base(this,"exitDocument");if(this.fileInput_){this.getHandler().unlisten(this.fileInput_,goog.events.EventType.CHANGE,this.fileInputChanged_,false)}this.fileInput_=null};au.upldr.ui.FileButton.prototype.fileInputChanged_=function(c){var b=(c.target);var a=new au.upldr.events.AddFileEvent(b.files);try{this.dispatchEvent(a)}finally{b.value=""}};goog.provide("au.upldr.ui.ButtonListItem");goog.require("goog.ui.Control");goog.require("goog.a11y.aria");goog.require("goog.ui.Button");goog.require("goog.ui.Css3ButtonRenderer");goog.require("goog.userAgent");goog.require("au.upldr.ui.FileButton");goog.require("au.upldr.Properties");goog.require("au.upldr.ui.ClassNames");goog.require("au.upldr.ui.ClassNamesCompat");au.upldr.ui.ButtonListItem=function(a,c,b){goog.base(this,null);this.className_=b;this.uploader_=c;this.setModel(a);this.propertyholder_=a;this.setSupportedState(goog.ui.Component.State.FOCUSED,false)};goog.inherits(au.upldr.ui.ButtonListItem,goog.ui.Control);au.upldr.ui.ButtonListItem.CSS_CLASS=au.upldr.ui.ClassNames.BUTTON_LIST_ITEM;au.upldr.ui.ButtonListItem.prototype.getCssClass=function(){return au.upldr.ui.ButtonListItem.CSS_CLASS+" "+this.className_};au.upldr.ui.ButtonListItem.prototype.setCssClass=function(a){this.className_=a;goog.dom.classlist.set(this.getElement(),this.getCssClass())};au.upldr.ui.ButtonListItem.prototype.getButtonCaption=function(){return(this.isFolderUpload_()?this.propertyholder_.getProperty(au.upldr.Properties.ADD_FOLDER_BUTTON_TEXT):this.propertyholder_.getProperty(au.upldr.Properties.ADD_FILES_BUTTON_TEXT))};au.upldr.ui.ButtonListItem.prototype.createDom=function(){var f=this.getDomHelper();var c=f.createDom("li",this.getCssClass());goog.a11y.aria.setRole(c,goog.a11y.aria.Role.LISTITEM);this.setElementInternal(c);var e=this.propertyholder_;var d=goog.dom.createElement("span");goog.dom.setTextContent(d,this.getButtonCaption());e.observe(au.upldr.Properties.FOLDER_PROCESSING_MODE,function(){goog.dom.setTextContent(d,this.getButtonCaption())}.bind(this));goog.dom.classlist.addAll(d,au.upldr.ui.ClassNamesCompat.ADD_FILES_BUTTON_TEXT_CLASS.replace(/\s+/," ").split(" "));var b=new goog.ui.Button(d,goog.ui.Css3ButtonRenderer.getInstance());b.setSupportedState(goog.ui.Component.State.FOCUSED,false);this.addChild(b,true);var a=function(){if(this.getButtonCaption()==""){this.setVisible(false)}else{goog.dom.setTextContent(d,this.getButtonCaption());this.setVisible((e.getProperty(au.upldr.Properties.IS_VISIBLE_ADDING_FILES)))}}.bind(this);a();e.observe(au.upldr.Properties.ADD_FILES_BUTTON_TEXT,a);e.observe(au.upldr.Properties.ADD_FOLDER_BUTTON_TEXT,a);e.observe(au.upldr.Properties.IS_VISIBLE_ADDING_FILES,a);b.setEnabled((e.getProperty(au.upldr.Properties.ENABLE_ADDING_FILES)));e.observe(au.upldr.Properties.ENABLE_ADDING_FILES,function(){b.setEnabled((e.getProperty(au.upldr.Properties.ENABLE_ADDING_FILES)))});goog.dom.classlist.addAll(b.getElement(),au.upldr.ui.ClassNamesCompat.ADD_FILES_BUTTON.replace(/\s+/," ").split(" "))};au.upldr.ui.ButtonListItem.prototype.enterDocument=function(){goog.base(this,"enterDocument");var a=this.getChildAt(0);this.getHandler().listen(a,goog.ui.Component.EventType.ACTION,this.button_actionHandler_)};au.upldr.ui.ButtonListItem.prototype.button_actionHandler_=function(){this.uploader_.addFiles(this.isFolderUpload_())};au.upldr.ui.ButtonListItem.prototype.isFolderUpload_=function(){return this.propertyholder_.getProperty(au.upldr.Properties.FOLDER_PROCESSING_MODE)==au.upldr.FolderProcessingModeEnum.FOLDER};au.upldr.ui.ButtonListItem.prototype.fileButton_actionHandler_=function(a){this.uploader_.addFilesFromEvent_(a);a.stopPropagation()};au.upldr.ui.ButtonListItem.prototype.getModel;goog.provide("au.upldr.ui.ListRenderer");goog.require("goog.array");goog.require("goog.ui.ContainerRenderer");goog.require("au.upldr.Properties");goog.require("au.upldr.ui.ListItem");goog.require("au.upldr.ui.ButtonListItem");goog.require("au.upldr.ui.ClassNames");goog.require("goog.events");au.upldr.ui.ListRenderer=function(){goog.base(this);this.list_=null};goog.inherits(au.upldr.ui.ListRenderer,goog.ui.ContainerRenderer);goog.addSingletonGetter(au.upldr.ui.ListRenderer);au.upldr.ui.ListRenderer.CSS_CLASS=au.upldr.ui.ClassNames.LIST;au.upldr.ui.ListRenderer.prototype.getCssClass=function(){return au.upldr.ui.ListRenderer.CSS_CLASS};au.upldr.ui.ListRenderer.prototype.createDom=function(d){var c=d.getDomHelper().createDom("ul",this.getClassNames(d).join(" "));d.setElementInternal(c);this.list_=d;goog.dom.classlist.addAll(c,au.upldr.ui.ClassNamesCompat.TILE_LIST.replace(/\s+/," ").split(" "));var b=d.getModel();var a=b.getPropertyHolder();a.observe(au.upldr.Properties.VIEW_MODE,goog.bind(this.redrawAll,this));this.createChildren();return c};au.upldr.ui.ListRenderer.prototype.getAriaRole=function(){return goog.a11y.aria.Role.LIST};au.upldr.ui.ListRenderer.prototype.redrawAll=function(){while(this.list_.hasChildren()){var a=this.list_.removeChildAt(0,true);if(a){a.dispose()}}this.createChildren()};au.upldr.ui.ListRenderer.prototype.createChildren=function(){var d=this.list_.getModel();var a=d.getPropertyHolder();var b=(d.getItems());var f=this.list_.getItemRenderer();this.list_.stopRender();this.list_.redrawItems(b);this.list_.startRender();var e="";if(f instanceof au.upldr.ui.TileItemRenderer){e=au.upldr.ui.TileItemRenderer.CSS_CLASS}else{if(f instanceof au.upldr.ui.ThumbnailItemRenderer){e=au.upldr.ui.ThumbnailItemRenderer.CSS_CLASS}else{if(f instanceof au.upldr.ui.IconItemRenderer){e=au.upldr.ui.IconItemRenderer.CSS_CLASS}}}if(this.list_.getAddButtonListItem()==null){var c=new au.upldr.ui.ButtonListItem(a,d,e);this.list_.setAddButtonListItem(c);c.render(this.list_.getContentElement())}else{this.list_.getAddButtonListItem().setCssClass(e)}};goog.provide("au.upldr.ui.List");goog.require("goog.array");goog.require("goog.events");goog.require("goog.functions");goog.require("goog.style");goog.require("goog.ui.Container");goog.require("goog.ui.Container.Orientation");goog.require("goog.ui.registry");goog.require("goog.log");goog.require("goog.math");goog.require("goog.async.Deferred");goog.require("au.upldr.Properties");goog.require("au.upldr.events.CollectionEvent");goog.require("au.upldr.events.CollectionEventKind");goog.require("au.upldr.ui.ListItem");goog.require("au.upldr.ui.ListRenderer");goog.require("au.upldr.ui.IconItemRenderer");goog.require("au.upldr.ui.TileItemRenderer");goog.require("au.upldr.ui.ThumbnailItemRenderer");goog.require("goog.events.EventTarget");au.upldr.ui.List=function(a){goog.base(this,goog.ui.Container.Orientation.HORIZONTAL,new au.upldr.ui.ListRenderer());this.setModel(a);this.activeItemIndex_=-1;this.startItemIndex_=0;this.addButtonListItem_=null;this.itemsTorenderList_=[];this.canRender_=true;this.lastYScrollPosition_=0;this.lastXScrollPosition_=0};goog.inherits(au.upldr.ui.List,goog.ui.Container);au.upldr.ui.List.prototype.onFileCountChangeInternal_=function(a){if(a.cause==au.upldr.events.CollectionEventKind.ADD){this.getHandler().listenOnce(this.getModel(),[au.upldr.events.EventType.UPLOAD_LIST_CHANGED],function(){var b=this.getElement();b.scrollTop=b.scrollHeight}.bind(this))}};au.upldr.ui.List.prototype.setAddButtonListItem=function(a){this.addButtonListItem_=a};au.upldr.ui.List.prototype.isUploadingMode=function(){return this.getModel().getState()==au.upldr.UploaderState.UPLOADING};au.upldr.ui.List.prototype.getAddButtonListItem=function(){return this.addButtonListItem_};au.upldr.ui.List.prototype.enterDocument=function(){goog.base(this,"enterDocument");var d=this.getModel();var c=d.getItems();var b=this;var e=this.getElement();this.timeOut=null;this.isNeedFireScrollEvent=true;var f=function(){if(b.isNeedFireScrollEvent){window.clearTimeout(b.timeOut);b.isNeedFireScrollEvent=false;b.timeOut=window.setTimeout(function(){b.dispatchListScrollEvent();b.isNeedFireScrollEvent=true},1000)}}.bind(this);var a=function(){b.dispatchListScrollEvent()};this.getHandler().listen(c,au.upldr.events.CollectionEvent.COLLECTION_CHANGED,this.itemsCollectionChanged_).listen(this,goog.ui.Component.EventType.ACTION,this.onItemClick_).listen(e,goog.events.EventType.CLICK,this.element_clickHandler_).listen(e,goog.events.EventType.SCROLL,f).listen(window,goog.events.EventType.SCROLL,this.reinitScrollPosition.bind(this)).listen(window,goog.events.EventType.RESIZE,a).listen(this.getModel(),au.upldr.events.EventType.FILE_COUNT_CHANGE,this.onFileCountChangeInternal_)};au.upldr.ui.List.prototype.fixScrollPosition=function(){window.scrollTo(this.lastXScrollPosition_,this.lastYScrollPosition_)};au.upldr.ui.List.prototype.reinitScrollPosition=function(){this.lastYScrollPosition_=window.pageYOffset;this.lastXScrollPosition_=window.pageXOffset};au.upldr.ui.List.prototype.getShownNodeIndexes=function(){var a=this.getElement();var d=goog.style.getBoundingClientRect_(a);var c=[];var f,b;for(var e=0;e<a.childNodes.length;e++){f=a.childNodes[e];b=goog.style.getBoundingClientRect_(f);if(goog.array.contains(goog.dom.classlist.get(f),au.upldr.ui.ClassNames.LIST_ITEM)&&b.bottom>d.top&&b.bottom<=(d.bottom+b.height)){c.push(e)}}return c};au.upldr.ui.List.prototype.dispatchListEvent_=function(b){var a=new goog.events.Event(b);a.shownElementIndexes=this.getShownNodeIndexes();try{goog.events.dispatchEvent(this.getModel(),a)}catch(c){}};au.upldr.ui.List.prototype.dispatchListScrollEvent=function(){this.dispatchListEvent_(au.upldr.events.EventType.UPLOAD_LIST_SCROLL)};au.upldr.ui.List.prototype.dispatchListChangedEvent=function(){this.dispatchListEvent_(au.upldr.events.EventType.UPLOAD_LIST_CHANGED)};au.upldr.ui.List.prototype.dispatchSelectionChangeEvent_=function(a){var b=new goog.events.Event(goog.events.EventType.SELECT);b.select=a;try{this.dispatchEvent(b)}catch(c){}};au.upldr.ui.List.prototype.element_clickHandler_=function(a){if(a.target==this.getElement()){this.deselectAll()}};au.upldr.ui.List.prototype.onItemClick_=function(c){var b=c.target;if(b instanceof au.upldr.ui.ListItem){if(b.isSelected()){b.setSelected(false)}else{var a=this.indexOfChild(b);this.selectHelper(a,1,true)}b.showSharedButtons();c.stopPropagation()}};au.upldr.ui.List.prototype.quedExec_=function(a){return window.setTimeout(function(){a.bind(this)()}.bind(this),0)};au.upldr.ui.List.prototype.redrawItems=function(a){if(a instanceof au.upldr.ItemHolderCollection){a=a.toArray()}var b=this.getItemRenderer();var c=this.getModel();goog.array.forEach(a,function(d){this.itemsTorenderList_.push(new au.upldr.ui.ListItem(d,c,b))},this)};au.upldr.ui.List.prototype.itemsCollectionChanged_=function(d){var b=d.getKind();var c;if(b==au.upldr.events.CollectionEventKind.ADD){this.redrawItems(d.getItems())}else{if(b==au.upldr.events.CollectionEventKind.ADD_RANGE){goog.array.forEach(d.getItems(),function(e){this.redrawItems(e)},this)}else{if(b==au.upldr.events.CollectionEventKind.REMOVE){var a=d.getItems();goog.array.forEach(this.itemsTorenderList_,function(f,e){if(goog.array.contains(a,this.itemsTorenderList_[e].getModel())){delete this.itemsTorenderList_[e]}}.bind(this));this.forEachChild(function(e){if(goog.array.contains(a,e.getModel())){this.removeChild(e,true);e.dispose()}},this);this.dispatchListChangedEvent();this.deselectAll()}else{if(b==au.upldr.events.CollectionEventKind.RESET){while(this.hasChildren()){c=this.removeChildAt(0,true);if(c){c.dispose()}}this.deselectAll()}}}}if(this.isUploadingMode()){this.renderOnlyVisible()}else{if(b==au.upldr.events.CollectionEventKind.ADD_RANGE||b==au.upldr.events.CollectionEventKind.ADD){this.startRender()}}};au.upldr.ui.List.prototype.stopRender=function(){this.canRender_=false;this.itemsTorenderList_=[]};au.upldr.ui.List.prototype.renderOnlyVisible=function(){var a=this.getMaxVisibleItemsCount();var c=this.getShownNodeIndexes().length;var b=this.itemsTorenderList_.length;if(c<a&&b>0){this.startRender()}else{this.pauseRender()}};au.upldr.ui.List.prototype.pauseRender=function(){this.canRender_=false};au.upldr.ui.List.prototype.startRender=function(){this.canRender_=true;this.renderJob_()};au.upldr.ui.List.prototype.renderJob_=function(){this.renderNext_().addCallback(function(a){if(a&&this.canRender_){this.renderJob_()}if(!a){this.quedExec_(this.dispatchListChangedEvent)}}.bind(this))};au.upldr.ui.List.prototype.renderNext_=function(){var a=new goog.async.Deferred();var b=this.getHandler();var c;this.quedExec_(function(){if(this.itemsTorenderList_.length>0){c=this.itemsTorenderList_.shift();if(c&&c.getModel().getFile()){this.addChild(c,true);b.listen(c,au.upldr.events.EventType.SELECTION_CHANGE,function(d){this.dispatchSelectionChangeEvent_(d.select)}.bind(this))}}a.callback(this.itemsTorenderList_.length>0)});return a};au.upldr.ui.List.prototype.getChildAt=function(a){if(a===this.getChildCount()){return this.addButtonListItem_}else{return goog.base(this,"getChildAt",a)}};au.upldr.ui.List.prototype.getItemRenderer=function(){var a=this.getModel().getPropertyHolder().getProperty(au.upldr.Properties.VIEW_MODE);if(a==au.upldr.ViewMode.TILES){return au.upldr.ui.TileItemRenderer.getInstance()}else{if(a==au.upldr.ViewMode.THUMBNAILS){return au.upldr.ui.ThumbnailItemRenderer.getInstance()}else{if(a==au.upldr.ViewMode.ICONS){return au.upldr.ui.IconItemRenderer.getInstance()}}}return au.upldr.ui.TileItemRenderer.getInstance()};au.upldr.ui.List.prototype.handleKeyEventInternal=function(c){var b=this.getHighlighted();if(b&&typeof b.handleKeyEvent=="function"&&b.handleKeyEvent(c)){return true}if(c.ctrlKey||c.metaKey||c.altKey){return false}var a=c.shiftKey;switch(c.keyCode){case goog.events.KeyCodes.ESC:this.deselectAll();break;case goog.events.KeyCodes.HOME:this.selectFirst(a);break;case goog.events.KeyCodes.END:this.selectLast(a);break;case goog.events.KeyCodes.UP:this.selectUp(a);break;case goog.events.KeyCodes.DOWN:this.selectDown(a);break;case goog.events.KeyCodes.LEFT:if(this.isRightToLeft()){this.selectNext(a)}else{this.selectPrevious(a)}break;case goog.events.KeyCodes.RIGHT:if(this.isRightToLeft()){this.selectPrevious(a)}else{this.selectNext(a)}break;case goog.events.KeyCodes.DELETE:this.removeSelected();this.selectHelper(this.activeItemIndex_,1,false);break;default:return false}return true};au.upldr.ui.List.prototype.removeSelected=function(){var b=this.getModel();var a=[];this.forEachChild(function(d,c){if(d.isSelected()){a.unshift(c)}});goog.array.forEach(a,function(c){b.removeFile(c)})};au.upldr.ui.List.prototype.getFirstVisible=function(){var k=this.getChildAt(0);if(k){var b=k.getElement();var c=goog.style.getMarginBox(b);var i=b.offsetWidth+c.right+c.left;var d=b.offsetHeight+c.top+c.bottom;var e=this.getElement();var g=e.clientWidth;var j=e.scrollTop;var a=Math.floor(j/d);var f=Math.floor(g/i);return Math.min(this.getChildCount()-2,a*f)}return 0};au.upldr.ui.List.prototype.getMaxVisibleItemsCount=function(){var i=this.getChildAt(0);if(i){var a=i.getElement();var b=goog.style.getMarginBox(a);var g=a.offsetWidth+b.right+b.left;var c=a.offsetHeight+b.top+b.bottom;var d=this.getElement();var f=d.clientWidth;var k=d.clientHeight;var j=Math.floor(k/c);var e=Math.floor(f/g);return e*j}return 10};au.upldr.ui.List.prototype.deselectAll=function(){this.forEachChild(function(a){a.setSelected(false)});this.activeItemIndex_=-1;this.startItemIndex_=0;if(!this.getModel().getPropertyHolder().getProperty(au.upldr.Properties.PANE_ITEM_TOOLBAR_ALWAYS_VISIBLE)){this.forEachChild(function(a){if(a.getToolbar()!=null){a.getToolbar().forEachChild(function(b){b.setVisible(false)});a.showToolbar(false)}})}};au.upldr.ui.List.prototype.selectUp=function(a){var b=this.getItemsPerRow_();if(b>0){var g;var e;var f;if(a){g=this.startItemIndex_;f=goog.math.clamp(this.activeItemIndex_-b,0,this.getChildCount()-1);e=f-g;e+=e>0?1:-1}else{f=g=goog.math.clamp(this.activeItemIndex_-b,0,this.getChildCount()-1);e=1}var c=this.getChildAt(this.activeItemIndex_).getElement();var d=this.getChildAt(f).getElement();if(c.offsetTop!==d.offsetTop){this.selectHelper(g,e,false)}}};au.upldr.ui.List.prototype.selectDown=function(a){var b=this.getItemsPerRow_();if(b>0){var g;var e;var f;if(a){g=this.startItemIndex_;f=goog.math.clamp(this.activeItemIndex_+b,0,this.getChildCount()-1);e=f-g;e+=e>0?1:-1}else{f=g=goog.math.clamp(this.activeItemIndex_+b,0,this.getChildCount()-1);e=1}var c=this.getChildAt(this.activeItemIndex_).getElement();var d=this.getChildAt(f).getElement();if(c.offsetTop!==d.offsetTop){this.selectHelper(g,e,false)}}};au.upldr.ui.List.prototype.getItemsPerRow_=function(){if(this.getChildCount()>0){var a=this.getChildAt(0).getElement();var e=this.getElement();var d=e.clientWidth;var c=a.offsetWidth;var b=goog.style.getMarginBox(a);c+=b.left+b.right;return Math.floor(d/c)}return 0};au.upldr.ui.List.prototype.selectFirst=function(a){var c;var b;if(a&&this.startItemIndex_>0){c=this.startItemIndex_;b=-1-c}else{c=0;b=1}this.selectHelper(c,b,false)};au.upldr.ui.List.prototype.selectLast=function(b){var d;var c;var a=this.getChildCount();if(b){d=this.startItemIndex_;c=a-d}else{d=a-1;c=1}this.selectHelper(d,c,false)};au.upldr.ui.List.prototype.selectNext=function(a){var d;var b;if(a){d=this.startItemIndex_;var c=goog.math.clamp(this.activeItemIndex_+1,0,this.getChildCount()-1);b=c-d;b+=b>0?1:-1}else{d=this.activeItemIndex_+1;b=1}this.selectHelper(d,b,false)};au.upldr.ui.List.prototype.selectPrevious=function(a){var d;var b;if(a){d=this.startItemIndex_;var c=goog.math.clamp(this.activeItemIndex_-1,0,this.getChildCount()-1);b=c-d;b+=b>0?1:-1}else{d=this.activeItemIndex_>=0?this.activeItemIndex_-1:this.getChildCount()-1;b=1}this.selectHelper(d,b,false)};au.upldr.ui.List.prototype.selectItem=function(b,a){var c=this.getChildAt(b);c.setSelected(a);c.showSharedButtons()};au.upldr.ui.List.prototype.selectHelper=function(c,f,a){var b=this.getChildCount();if(b>0){c=goog.math.clamp(c,0,b-1);if(!a){this.forEachChild(function(i,h){i.setSelected(false)})}var e,d=goog.math.clamp(c+f,-1,b),g;if(f>=0){for(e=c;e<d;e++){this.getChildAt(e).setSelected(true);g=e}}else{for(e=c;e>d;e--){this.getChildAt(e).setSelected(true);g=e}}this.startItemIndex_=c;if(goog.isDef(g)){this.activeItemIndex_=g;this.ensureItemVisible_(g)}return true}return false};au.upldr.ui.List.prototype.ensureItemVisible_=function(a){var b=this.getChildAt(a).getElement();if(b){goog.style.scrollIntoContainerView(b,this.getElement())}};au.upldr.ui.List.prototype.getModel;au.upldr.ui.List.prototype.canDecorate=goog.functions.FALSE;au.upldr.ui.List.prototype.logger=goog.log.getLogger("au.upldr.ui.List");goog.ui.registry.setDefaultRenderer(au.upldr.ui.List,au.upldr.ui.ListRenderer);goog.provide("au.upldr.ui.UploadPane");goog.require("goog.events.FileDropHandler");goog.require("goog.events.FileDropHandler.EventType");goog.require("goog.ui.Component");goog.require("goog.functions");goog.require("goog.style");goog.require("goog.array");goog.require("goog.async.Deferred");goog.require("goog.events.Event");goog.require("au.upldr.events.AddFileEvent");goog.require("au.upldr.ui.List");goog.require("au.upldr.UploaderState");goog.require("goog.dom.classlist");goog.require("au.upldr.ui.ClassNamesCompat");goog.require("au.upldr.ui.RectangleSelection");goog.require("au.upldr.upload.ExtendedFile");goog.require("au.upldr.utils");au.upldr.ui.UploadPane=function(b,a){goog.base(this,a);this.rectangleSelection_=null;this.bgEl_;this.maximumFolderFileDndLimit_=100;this.clipBoardFileIncrement_=0;this.setModel(b);this.folderReadCheckIntervalArray_=[];this.folderReadCheckTimeoutArray_=[];this.folderReadStateArray_=[];this.fileReadStateArray_=[];this.cancel_=false;this.dropHereElement_=goog.dom.createDom("div","centerElement");this.propertyHolder_=this.getModel().getPropertyHolder();this.propertyHolder_.observe(au.upldr.Properties.DROP_FILES_HERE_TEXT,this.updateDropHereText_,this)};goog.inherits(au.upldr.ui.UploadPane,goog.ui.Component);au.upldr.ui.UploadPane.CSS_CLASS=au.upldr.ui.ClassNames.UPLOAD_PANE;au.upldr.ui.UploadPane.prototype.getCssClass=function(){return au.upldr.ui.UploadPane.CSS_CLASS};au.upldr.ui.UploadPane.prototype.enterDocument=function(){goog.base(this,"enterDocument");var b=this.getElement();var a=this.getHandler();a.listen(b,goog.events.FileDropHandler.EventType.DROP,this.fileCatchHandler_);a.listen(document,goog.events.EventType.PASTE,this.fileCatchHandler_);a.listen(b,goog.events.EventType.DRAGOVER,function(f){if(this.getModel().getState()!=au.upldr.UploaderState.UPLOADING&&this.hasFile_(f.event_.dataTransfer)){this.setDragOver(true)}});a.listen(b,goog.events.EventType.DRAGLEAVE,function(f){this.setDragOver(false)});var c=(this.getList());this.rectangleSelection_.attach(c);var d=this.propertyHolder_;d.observe(au.upldr.InternalProperties.UPLOADER_STATE,this.uploaderState_ChangeHandler_,this);this.getElement().appendChild(this.dropHereElement_);this.updateDropHereText_();a.listen((this.getModel()),au.upldr.events.EventType.FILE_COUNT_CHANGE,this.updateDropHereText_.bind(this));a.listen((this.getModel()),au.upldr.events.EventType.ADDING_FILES,this.updateDropHereText_.bind(this));a.listen((this.getModel()),au.upldr.events.EventType.AFTER_UPLOAD,this.updateDropHereText_.bind(this))};au.upldr.ui.UploadPane.prototype.convertToDetachedJsElement_=function(b){if(typeof b=="undefined"||b==null){return null}if(typeof window.jQuery!="undefined"&&b instanceof window.jQuery&&b.length>0){b=b[0]}else{if(typeof b=="string"){var a=null;try{a=document.querySelector(b)}catch(c){}if(a){b=a}}}if(typeof b!="string"&&b&&b.parentNode){b=b.parentNode.removeChild(b)}return b};au.upldr.ui.UploadPane.prototype.updateDropHereText_=function(){var b=this.getModel();var a=b.items_.getCount()==0&&!b.isAddingFiles();this.dropHereElement_.innerHTML="";if(a&&!goog.userAgent.MOBILE){var c=this.convertToDetachedJsElement_((this.propertyHolder_.getProperty(au.upldr.Properties.DROP_FILES_HERE_TEXT)));if(typeof c!="string"&&c!=null){this.dropHereElement_.appendChild(c)}else{if(typeof c=="string"){this.dropHereElement_.innerHTML=c}}}};au.upldr.ui.UploadPane.prototype.exitDocument=function(){goog.base(this,"exitDocument");this.rectangleSelection_.detach()};au.upldr.ui.UploadPane.prototype.hasFile_=function(a){return goog.isDefAndNotNull(a)&&((goog.isDefAndNotNull(a.types)&&(goog.array.contains(a.types,"Files")||goog.array.contains(a.types,"public.file-url")))||(goog.isDefAndNotNull(a.files)&&a.files.length>0))};au.upldr.ui.UploadPane.prototype.createDom=function(){var f=this.getDomHelper();var e=f.createElement("div"),c=f.createElement("div");this.setElementInternal(c);goog.dom.appendChild(c,e);var a=this.getModel();goog.dom.classlist.addAll(c,this.getCssClass().replace(/\s+/," ").split(" "));goog.dom.classlist.addAll(c,au.upldr.ui.ClassNamesCompat.UPLOAD_PANE_BAR.replace(/\s+/," ").split(" "));var d=new au.upldr.ui.List(a);this.addChild(d,true);var b=this.bgEl_=f.createDom("div",goog.getCssName(this.getCssClass(),"bg"));goog.style.setElementShown(b,false);goog.dom.appendChild(c.firstChild,b);this.rectangleSelection_=new au.upldr.ui.RectangleSelection(d.getElement())};au.upldr.ui.UploadPane.prototype.getList=function(){return(this.getChildAt(0))};au.upldr.ui.UploadPane.prototype.getContentElement=function(){return goog.dom.getFirstElementChild(this.getElement())};au.upldr.ui.UploadPane.prototype.cancel=function(){this.cancel_=true;this.fileReadStateArray_=[];this.folderReadStateArray_=[];goog.array.forEach(this.folderReadCheckIntervalArray_,function(a){window.clearInterval(a)});goog.array.forEach(this.folderReadCheckTimeoutArray_,function(a){window.clearTimeout(a)});this.folderReadCheckIntervalArray_=[];this.folderReadCheckTimeoutArray_=[]};au.upldr.ui.UploadPane.prototype.isClipBoardEvent_=function(a){if(window.ClipboardEvent){return a.getBrowserEvent() instanceof window.ClipboardEvent}return false};au.upldr.ui.UploadPane.prototype.getProperDataTransfer_=function(a){if(this.isClipBoardEvent_(a)){return(a.getBrowserEvent().clipboardData)}else{return a.getBrowserEvent().dataTransfer}};au.upldr.ui.UploadPane.prototype.fileCatchHandler_=function(h){this.cancel_=false;var g=this.getProperDataTransfer_(h);if(this.getModel().getState()!=au.upldr.UploaderState.UPLOADING&&this.hasFile_(g)){if(!this.isClipBoardEvent_(h)){this.setDragOver(false)}var b;var i=this.getModel().getPropertyHolder().getProperty(au.upldr.Properties.FOLDER_PROCESSING_MODE);this.dispatchInitFileEvent_(0,0);if(this.isClipBoardEvent_(h)){var d,f,c=(this.propertyHolder_.getProperty(au.upldr.Properties.CLIP_BOARD_FILE_NAME));var a=goog.array.map(g.items,function(e){if(e.getAsFile){d=e.getAsFile();f=au.upldr.utils.mimeMapping.getExtentionByMime(d.type).replace("*","");this.clipBoardFileIncrement_++;return new au.upldr.upload.ExtendedFile(d,"",au.upldr.utils.format(c,this.clipBoardFileIncrement_)+f)}else{return null}},this);b=new au.upldr.events.AddFileEvent(a);this.dispatchEvent(b)}else{if(i==au.upldr.FolderProcessingModeEnum.FOLDER||i==au.upldr.FolderProcessingModeEnum.MIXED){this.getFolderFilesDef_((g.items)).addCallback(function(e){b=new au.upldr.events.AddFileEvent(e);this.dispatchEvent(b)}.bind(this))}else{b=new au.upldr.events.AddFileEvent(g.files);this.dispatchEvent(b)}}}};au.upldr.ui.UploadPane.prototype.dispatchInitFileEvent_=function(c,b){var a=new goog.events.Event(au.upldr.events.EventType.INIT_FILE);a.currentIndex=c;a.totalCount=b;try{this.dispatchEvent(a)}catch(d){}};au.upldr.ui.UploadPane.prototype.dispatchDndLimitEvent_=function(c){var a=new goog.events.Event(au.upldr.events.EventType.DND_FOLDER_FILE_LIMIT);a.folderName=c;try{this.dispatchEvent(a)}catch(b){}};au.upldr.ui.UploadPane.prototype.traverseFileTree_=function(e,d,f){if(this.cancel_){return}var a=this;f=f||"";var c=function(g){if(window.console){window.console.error(g)}};if(d.isFile){if(a.cancel_){return}a.fileReadStateArray_.push(true);d.file(function(g){a.fileReadStateArray_.shift();e.push(new au.upldr.upload.ExtendedFile(g,f+g.name))},c)}else{if(d.isDirectory){a.folderReadStateArray_.push(true);var b=d.createReader();b.readEntries(function(g){a.folderReadStateArray_.shift();var k=goog.array.map(g,function(i){return i.isFile});if(k.length==a.maximumFolderFileDndLimit_&&!a.cancel_){var h=window.setTimeout(function(){a.dispatchDndLimitEvent_(f+d.name)},0);a.folderReadCheckTimeoutArray_.push(h)}for(var j=0;j<g.length;j++){if(a.cancel_){break}a.traverseFileTree_(e,g[j],f+d.name+"/")}},c)}}};au.upldr.ui.UploadPane.prototype.getFolderFilesDef_=function(d){var e=[];var a=new goog.async.Deferred();var c=this;var b=window.setInterval(function(){if(c.fileReadStateArray_.length===0&&c.folderReadStateArray_.length===0){window.clearInterval(b);a.callback(e)}},10);this.folderReadCheckIntervalArray_.push(b);goog.array.forEach(d,function(f){this.traverseFileTree_(e,f.webkitGetAsEntry()||f.webkitGetAsEntry())},this);return a};au.upldr.ui.UploadPane.prototype.setDragOver=function(a){var b=goog.getCssName(this.getCssClass(),"dragover").replace(/\s+/," ").split(" ");if(a){goog.dom.classlist.addAll(this.getElement(),b)}else{goog.dom.classlist.removeAll(this.getElement(),b)}};au.upldr.ui.UploadPane.prototype.uploaderState_ChangeHandler_=function(){var a=this.getModel().getState();goog.style.setElementShown(this.bgEl_,a==au.upldr.UploaderState.UPLOADING)};au.upldr.ui.UploadPane.prototype.getModel;au.upldr.ui.UploadPane.prototype.canDecorate=goog.functions.FALSE;goog.provide("au.upldr.ui.ImagePreview");goog.provide("au.upldr.ui.ImagePreview.EventType");goog.require("goog.functions");goog.require("goog.log");goog.require("goog.ui.Component");goog.require("goog.style");goog.require("goog.ui.Popup");goog.require("goog.fs");goog.require("au.upldr.Properties");goog.require("au.upldr.ui.Label");goog.require("au.upldr.ui.ClassNames");goog.require("au.upldr.ui.ClassNamesCompat");au.upldr.ui.ImagePreview=function(b,a){goog.base(this,a);this.popup_;this.item_=null;this.caption_;this.image_;this.setModel(b)};goog.inherits(au.upldr.ui.ImagePreview,goog.ui.Component);au.upldr.ui.ImagePreview.CSS_CLASS=au.upldr.ui.ClassNames.IMAGE_PREVIEW;au.upldr.ui.ImagePreview.prototype.getCssClass=function(){return au.upldr.ui.ImagePreview.CSS_CLASS};au.upldr.ui.ImagePreview.prototype.createDom=function(){var a=this.getModel();var e=this.getDomHelper();this.image_=(e.createElement("img"));this.caption_=new au.upldr.ui.Label();var f,d=e.createDom("div",this.getCssClass(),e.createDom("div",null,this.image_,f=e.createElement("div")));d.title=(a.getProperty(au.upldr.Properties.CLOSE_PREVIEW_TOOLTIP));a.observe(au.upldr.Properties.CLOSE_PREVIEW_TOOLTIP,this.updateTooltip_,this);this.caption_.render(f);goog.dom.classlist.addAll(this.caption_.getElement(),au.upldr.ui.ClassNamesCompat.PREVIEW_FILE_NAME_LABEL_TEXT.replace(/\s+/," ").split(" "));this.setElementInternal(d);goog.style.setElementShown(d,false);var b=this.popup_=new goog.ui.Popup(d);b.setVisible(false);b.setHideOnEscape(true)};au.upldr.ui.ImagePreview.prototype.updateTooltip_=function(){this.getElement().title=(this.getModel().getProperty(au.upldr.Properties.CLOSE_PREVIEW_TOOLTIP))};au.upldr.ui.ImagePreview.prototype.enterDocument=function(){goog.base(this,"enterDocument");this.getHandler().listen(this.popup_,goog.ui.PopupBase.EventType.HIDE,this.popup_hideHandler_).listen(this.popup_,goog.ui.PopupBase.EventType.SHOW,this.popup_showHandler_).listen(this.image_,[goog.events.EventType.LOAD,goog.events.EventType.ERROR],this.image_loadHandler_).listen(this.getElement(),goog.events.EventType.CLICK,this.hide)};au.upldr.ui.ImagePreview.prototype.show=function(r){if(!r.isImage()||r.getFile()==null){return}this.item_=r;var j=r.getName();this.image_.alt=j;this.caption_.setLabelText(j);var a=goog.fs.createObjectUrl((r.getFile()));this.image_.src=a;var f=r.getAngle();var o=r.getImageWidth();var l=r.getImageHeight();var s=goog.style.getSize(((this.getElement().parentNode)));var g={width:s.width,height:s.height};var b=this.getElement().style;var n;var e=!!(f%180);s.width-=20;s.height-=20+40;if(s.width<o||s.height<l){s=au.upldr.image.getThumbnailSize(o,l,s.width,s.height,f);if(e){s={width:s.height,height:s.width}}}else{s={width:o,height:l}}b.top=Math.floor((g.height-s.height-60)/2)+"px";var d=Math.max(s.width,goog.style.getSize((this.getElement())).width);b.left=Math.floor((g.width-d-20)/2)+"px";b=this.image_.style;b.maxWidth=s.width+"px";b.maxHeight=s.height+"px";if(e){n=Math.floor((s.width-s.height)/2)+"px"}else{n=0}var q="rotate("+f+"deg)";var m=["Webkit","Moz","O","ms"];if("transform" in b){b.transform=q}var k=0;while(m[k]){var c=m[k]+"Transform";if(c in b){b[c]=q}++k}this.caption_.getElement().parentNode.style.marginTop=n;this.popup_.setVisible(true)};au.upldr.ui.ImagePreview.prototype.hide=function(){this.popup_.setVisible(false)};au.upldr.ui.ImagePreview.prototype.image_loadHandler_=function(){goog.fs.revokeObjectUrl(this.image_.src)};au.upldr.ui.ImagePreview.prototype.popup_hideHandler_=function(a){this.item_=null;goog.fs.revokeObjectUrl(this.image_.src);this.image_.src="";this.caption_.setLabelText("");this.dispatchEvent(au.upldr.ui.ImagePreview.EventType.HIDE)};au.upldr.ui.ImagePreview.prototype.popup_showHandler_=function(a){this.dispatchEvent(au.upldr.ui.ImagePreview.EventType.SHOW)};au.upldr.ui.ImagePreview.prototype.canDecorate=goog.functions.FALSE;au.upldr.ui.ImagePreview.prototype.logger=goog.log.getLogger("au.upldr.ui.ImagePreview");au.upldr.ui.ImagePreview.prototype.getModel;au.upldr.ui.ImagePreview.EventType={SHOW:goog.ui.PopupBase.EventType.SHOW,HIDE:goog.ui.PopupBase.EventType.HIDE};goog.provide("goog.ui.FlatButtonRenderer");goog.require("goog.a11y.aria.Role");goog.require("goog.asserts");goog.require("goog.dom.classlist");goog.require("goog.ui.Button");goog.require("goog.ui.ButtonRenderer");goog.require("goog.ui.INLINE_BLOCK_CLASSNAME");goog.require("goog.ui.registry");goog.ui.FlatButtonRenderer=function(){goog.ui.ButtonRenderer.call(this)};goog.inherits(goog.ui.FlatButtonRenderer,goog.ui.ButtonRenderer);goog.addSingletonGetter(goog.ui.FlatButtonRenderer);goog.ui.FlatButtonRenderer.CSS_CLASS=goog.getCssName("goog-flat-button");goog.ui.FlatButtonRenderer.prototype.createDom=function(c){var d=this.getClassNames(c);var a={"class":goog.ui.INLINE_BLOCK_CLASSNAME+" "+d.join(" ")};var b=c.getDomHelper().createDom("div",a,c.getContent());this.setTooltip(b,c.getTooltip());return b};goog.ui.FlatButtonRenderer.prototype.getAriaRole=function(){return goog.a11y.aria.Role.BUTTON};goog.ui.FlatButtonRenderer.prototype.canDecorate=function(a){return a.tagName=="DIV"};goog.ui.FlatButtonRenderer.prototype.decorate=function(b,a){goog.asserts.assert(a);goog.dom.classlist.add(a,goog.ui.INLINE_BLOCK_CLASSNAME);return goog.ui.FlatButtonRenderer.superClass_.decorate.call(this,b,a)};goog.ui.FlatButtonRenderer.prototype.getValue=function(a){return""};goog.ui.FlatButtonRenderer.prototype.getCssClass=function(){return goog.ui.FlatButtonRenderer.CSS_CLASS};goog.ui.registry.setDecoratorByClassName(goog.ui.FlatButtonRenderer.CSS_CLASS,function(){return new goog.ui.Button(null,goog.ui.FlatButtonRenderer.getInstance())});goog.provide("goog.ui.LinkButtonRenderer");goog.require("goog.ui.Button");goog.require("goog.ui.FlatButtonRenderer");goog.require("goog.ui.registry");goog.ui.LinkButtonRenderer=function(){goog.ui.FlatButtonRenderer.call(this)};goog.inherits(goog.ui.LinkButtonRenderer,goog.ui.FlatButtonRenderer);goog.addSingletonGetter(goog.ui.LinkButtonRenderer);goog.ui.LinkButtonRenderer.CSS_CLASS=goog.getCssName("goog-link-button");goog.ui.LinkButtonRenderer.prototype.getCssClass=function(){return goog.ui.LinkButtonRenderer.CSS_CLASS};goog.ui.registry.setDecoratorByClassName(goog.ui.LinkButtonRenderer.CSS_CLASS,function(){return new goog.ui.Button(null,goog.ui.LinkButtonRenderer.getInstance())});goog.provide("goog.ui.MenuButtonRenderer");goog.require("goog.dom");goog.require("goog.style");goog.require("goog.ui.CustomButtonRenderer");goog.require("goog.ui.INLINE_BLOCK_CLASSNAME");goog.require("goog.ui.Menu");goog.require("goog.ui.MenuRenderer");goog.ui.MenuButtonRenderer=function(){goog.ui.CustomButtonRenderer.call(this)};goog.inherits(goog.ui.MenuButtonRenderer,goog.ui.CustomButtonRenderer);goog.addSingletonGetter(goog.ui.MenuButtonRenderer);goog.ui.MenuButtonRenderer.CSS_CLASS=goog.getCssName("goog-menu-button");goog.ui.MenuButtonRenderer.prototype.getContentElement=function(a){return goog.ui.MenuButtonRenderer.superClass_.getContentElement.call(this,(a&&a.firstChild))};goog.ui.MenuButtonRenderer.prototype.decorate=function(d,b){var a=(d);var c=goog.dom.getElementsByTagNameAndClass("*",goog.ui.MenuRenderer.CSS_CLASS,b)[0];if(c){goog.style.setElementShown(c,false);goog.dom.appendChild(goog.dom.getOwnerDocument(c).body,c);var e=new goog.ui.Menu();e.decorate(c);a.setMenu(e)}return goog.ui.MenuButtonRenderer.superClass_.decorate.call(this,a,b)};goog.ui.MenuButtonRenderer.prototype.createButton=function(a,b){return goog.ui.MenuButtonRenderer.superClass_.createButton.call(this,[this.createCaption(a,b),this.createDropdown(b)],b)};goog.ui.MenuButtonRenderer.prototype.createCaption=function(a,b){return goog.ui.MenuButtonRenderer.wrapCaption(a,this.getCssClass(),b)};goog.ui.MenuButtonRenderer.wrapCaption=function(b,a,c){return c.createDom("div",goog.ui.INLINE_BLOCK_CLASSNAME+" "+goog.getCssName(a,"caption"),b)};goog.ui.MenuButtonRenderer.prototype.createDropdown=function(a){return a.createDom("div",goog.ui.INLINE_BLOCK_CLASSNAME+" "+goog.getCssName(this.getCssClass(),"dropdown"),"\u00A0")};goog.ui.MenuButtonRenderer.prototype.getCssClass=function(){return goog.ui.MenuButtonRenderer.CSS_CLASS};goog.provide("goog.ui.MenuButton");goog.require("goog.Timer");goog.require("goog.a11y.aria");goog.require("goog.a11y.aria.State");goog.require("goog.asserts");goog.require("goog.dom");goog.require("goog.events.EventType");goog.require("goog.events.KeyCodes");goog.require("goog.events.KeyHandler");goog.require("goog.math.Box");goog.require("goog.math.Rect");goog.require("goog.positioning");goog.require("goog.positioning.Corner");goog.require("goog.positioning.MenuAnchoredPosition");goog.require("goog.positioning.Overflow");goog.require("goog.style");goog.require("goog.ui.Button");goog.require("goog.ui.Component");goog.require("goog.ui.IdGenerator");goog.require("goog.ui.Menu");goog.require("goog.ui.MenuButtonRenderer");goog.require("goog.ui.MenuItem");goog.require("goog.ui.MenuRenderer");goog.require("goog.ui.registry");goog.require("goog.userAgent");goog.require("goog.userAgent.product");goog.ui.MenuButton=function(e,a,d,b,c){goog.ui.Button.call(this,e,d||goog.ui.MenuButtonRenderer.getInstance(),b);this.setSupportedState(goog.ui.Component.State.OPENED,true);this.menuPosition_=new goog.positioning.MenuAnchoredPosition(null,goog.positioning.Corner.BOTTOM_START);if(a){this.setMenu(a)}this.menuMargin_=null;this.timer_=new goog.Timer(500);if((goog.userAgent.product.IPHONE||goog.userAgent.product.IPAD)&&!goog.userAgent.isVersionOrHigher("533.17.9")){this.setFocusablePopupMenu(true)}this.menuRenderer_=c||goog.ui.MenuRenderer.getInstance()};goog.inherits(goog.ui.MenuButton,goog.ui.Button);goog.tagUnsealableClass(goog.ui.MenuButton);goog.ui.MenuButton.prototype.menu_;goog.ui.MenuButton.prototype.positionElement_;goog.ui.MenuButton.prototype.menuMargin_;goog.ui.MenuButton.prototype.isFocusablePopupMenu_=false;goog.ui.MenuButton.prototype.timer_;goog.ui.MenuButton.prototype.buttonRect_;goog.ui.MenuButton.prototype.viewportBox_;goog.ui.MenuButton.prototype.originalSize_;goog.ui.MenuButton.prototype.renderMenuAsSibling_=false;goog.ui.MenuButton.prototype.selectFirstOnEnterOrSpace_=false;goog.ui.MenuButton.prototype.enterDocument=function(){goog.ui.MenuButton.superClass_.enterDocument.call(this);this.attachKeyDownEventListener_(true);if(this.menu_){this.attachMenuEventListeners_(this.menu_,true)}goog.a11y.aria.setState(this.getElementStrict(),goog.a11y.aria.State.HASPOPUP,!!this.menu_)};goog.ui.MenuButton.prototype.exitDocument=function(){goog.ui.MenuButton.superClass_.exitDocument.call(this);this.attachKeyDownEventListener_(false);if(this.menu_){this.setOpen(false);this.menu_.exitDocument();this.attachMenuEventListeners_(this.menu_,false);var a=this.menu_.getElement();if(a){goog.dom.removeNode(a)}}};goog.ui.MenuButton.prototype.disposeInternal=function(){goog.ui.MenuButton.superClass_.disposeInternal.call(this);if(this.menu_){this.menu_.dispose();delete this.menu_}delete this.positionElement_;this.timer_.dispose()};goog.ui.MenuButton.prototype.handleMouseDown=function(a){goog.ui.MenuButton.superClass_.handleMouseDown.call(this,a);if(this.isActive()){this.setOpen(!this.isOpen(),a);if(this.menu_){this.menu_.setMouseButtonPressed(this.isOpen())}}};goog.ui.MenuButton.prototype.handleMouseUp=function(a){goog.ui.MenuButton.superClass_.handleMouseUp.call(this,a);if(this.menu_&&!this.isActive()){this.menu_.setMouseButtonPressed(false)}};goog.ui.MenuButton.prototype.performActionInternal=function(a){this.setActive(false);return true};goog.ui.MenuButton.prototype.handleDocumentMouseDown=function(a){if(this.menu_&&this.menu_.isVisible()&&!this.containsElement((a.target))){this.setOpen(false)}};goog.ui.MenuButton.prototype.containsElement=function(a){return a&&goog.dom.contains(this.getElement(),a)||this.menu_&&this.menu_.containsElement(a)||false};goog.ui.MenuButton.prototype.handleKeyEventInternal=function(c){if(c.keyCode==goog.events.KeyCodes.SPACE){c.preventDefault();if(c.type!=goog.events.EventType.KEYUP){return true}}else{if(c.type!=goog.events.KeyHandler.EventType.KEY){return false}}if(this.menu_&&this.menu_.isVisible()){var a=c.keyCode==goog.events.KeyCodes.ENTER||c.keyCode==goog.events.KeyCodes.SPACE;var b=this.menu_.handleKeyEvent(c);if(c.keyCode==goog.events.KeyCodes.ESC||a){this.setOpen(false);return true}return b}if(c.keyCode==goog.events.KeyCodes.DOWN||c.keyCode==goog.events.KeyCodes.UP||c.keyCode==goog.events.KeyCodes.SPACE||c.keyCode==goog.events.KeyCodes.ENTER){this.setOpen(true,c);return true}return false};goog.ui.MenuButton.prototype.handleMenuAction=function(a){this.setOpen(false)};goog.ui.MenuButton.prototype.handleMenuBlur=function(a){if(!this.isActive()){this.setOpen(false)}};goog.ui.MenuButton.prototype.handleBlur=function(a){if(!this.isFocusablePopupMenu()){this.setOpen(false)}goog.ui.MenuButton.superClass_.handleBlur.call(this,a)};goog.ui.MenuButton.prototype.getMenu=function(){if(!this.menu_){this.setMenu(new goog.ui.Menu(this.getDomHelper(),this.menuRenderer_))}return this.menu_||null};goog.ui.MenuButton.prototype.setMenu=function(b){var a=this.menu_;if(b!=a){if(a){this.setOpen(false);if(this.isInDocument()){this.attachMenuEventListeners_(a,false)}delete this.menu_}if(this.isInDocument()){goog.a11y.aria.setState(this.getElementStrict(),goog.a11y.aria.State.HASPOPUP,!!b)}if(b){this.menu_=b;b.setParent(this);b.setVisible(false);b.setAllowAutoFocus(this.isFocusablePopupMenu());if(this.isInDocument()){this.attachMenuEventListeners_(b,true)}}}return a};goog.ui.MenuButton.prototype.setMenuPosition=function(a){if(a){this.menuPosition_=a;this.positionElement_=a.element}};goog.ui.MenuButton.prototype.setPositionElement=function(a){this.positionElement_=a;this.positionMenu()};goog.ui.MenuButton.prototype.setMenuMargin=function(a){this.menuMargin_=a};goog.ui.MenuButton.prototype.setSelectFirstOnEnterOrSpace=function(a){this.selectFirstOnEnterOrSpace_=a};goog.ui.MenuButton.prototype.addItem=function(a){this.getMenu().addChild(a,true)};goog.ui.MenuButton.prototype.addItemAt=function(b,a){this.getMenu().addChildAt(b,a,true)};goog.ui.MenuButton.prototype.removeItem=function(a){var b=this.getMenu().removeChild(a,true);if(b){b.dispose()}};goog.ui.MenuButton.prototype.removeItemAt=function(a){var b=this.getMenu().removeChildAt(a,true);if(b){b.dispose()}};goog.ui.MenuButton.prototype.getItemAt=function(a){return this.menu_?(this.menu_.getChildAt(a)):null};goog.ui.MenuButton.prototype.getItemCount=function(){return this.menu_?this.menu_.getChildCount():0};goog.ui.MenuButton.prototype.setVisible=function(c,b){var a=goog.ui.MenuButton.superClass_.setVisible.call(this,c,b);if(a&&!this.isVisible()){this.setOpen(false)}return a};goog.ui.MenuButton.prototype.setEnabled=function(a){goog.ui.MenuButton.superClass_.setEnabled.call(this,a);if(!this.isEnabled()){this.setOpen(false)}};goog.ui.MenuButton.prototype.isAlignMenuToStart=function(){var a=this.menuPosition_.corner;return a==goog.positioning.Corner.BOTTOM_START||a==goog.positioning.Corner.TOP_START};goog.ui.MenuButton.prototype.setAlignMenuToStart=function(a){this.menuPosition_.corner=a?goog.positioning.Corner.BOTTOM_START:goog.positioning.Corner.BOTTOM_END};goog.ui.MenuButton.prototype.setScrollOnOverflow=function(c){if(this.menuPosition_.setLastResortOverflow){var b=goog.positioning.Overflow.ADJUST_X;var a=c?goog.positioning.Overflow.RESIZE_HEIGHT:goog.positioning.Overflow.ADJUST_Y;this.menuPosition_.setLastResortOverflow(b|a)}};goog.ui.MenuButton.prototype.isScrollOnOverflow=function(){return this.menuPosition_.getLastResortOverflow&&!!(this.menuPosition_.getLastResortOverflow()&goog.positioning.Overflow.RESIZE_HEIGHT)};goog.ui.MenuButton.prototype.isFocusablePopupMenu=function(){return this.isFocusablePopupMenu_};goog.ui.MenuButton.prototype.setFocusablePopupMenu=function(a){this.isFocusablePopupMenu_=a};goog.ui.MenuButton.prototype.setRenderMenuAsSibling=function(a){this.renderMenuAsSibling_=a};goog.ui.MenuButton.prototype.showMenu=function(){this.setOpen(true)};goog.ui.MenuButton.prototype.hideMenu=function(){this.setOpen(false)};goog.ui.MenuButton.prototype.setOpen=function(c,h){goog.ui.MenuButton.superClass_.setOpen.call(this,c);if(this.menu_&&this.hasState(goog.ui.Component.State.OPENED)==c){if(c){if(!this.menu_.isInDocument()){if(this.renderMenuAsSibling_){var g=goog.dom.getNextElementSibling(this.getElement());if(g){this.menu_.renderBefore(g)}else{this.menu_.render((this.getElement().parentNode))}}else{this.menu_.render()}}this.viewportBox_=goog.style.getVisibleRectForElement(this.getElement());this.buttonRect_=goog.style.getBounds(this.getElement());this.positionMenu();var f=!!h&&(h.keyCode==goog.events.KeyCodes.ENTER||h.keyCode==goog.events.KeyCodes.SPACE);var b=!!h&&(h.keyCode==goog.events.KeyCodes.DOWN||h.keyCode==goog.events.KeyCodes.UP);var a=b||(f&&this.selectFirstOnEnterOrSpace_);if(a){this.menu_.highlightFirst()}else{this.menu_.setHighlightedIndex(-1)}}else{this.setActive(false);this.menu_.setMouseButtonPressed(false);var d=this.getElement();if(d){goog.a11y.aria.setState(d,goog.a11y.aria.State.ACTIVEDESCENDANT,"");goog.a11y.aria.setState(d,goog.a11y.aria.State.OWNS,"")}if(goog.isDefAndNotNull(this.originalSize_)){this.originalSize_=undefined;var e=this.menu_.getElement();if(e){goog.style.setSize(e,"","")}}}this.menu_.setVisible(c,false,h);if(!this.isDisposed()){this.attachPopupListeners_(c)}}if(this.menu_&&this.menu_.getElement()){goog.a11y.aria.removeState(this.menu_.getElementStrict(),goog.a11y.aria.State.HIDDEN)}};goog.ui.MenuButton.prototype.invalidateMenuSize=function(){this.originalSize_=undefined};goog.ui.MenuButton.prototype.positionMenu=function(){if(!this.menu_.isInDocument()){return}var d=this.positionElement_||this.getElement();var a=this.menuPosition_;this.menuPosition_.element=d;var c=this.menu_.getElement();if(!this.menu_.isVisible()){c.style.visibility="hidden";goog.style.setElementShown(c,true)}if(!this.originalSize_&&this.isScrollOnOverflow()){this.originalSize_=goog.style.getSize(c)}var b=goog.positioning.flipCornerVertical(a.corner);a.reposition(c,b,this.menuMargin_,this.originalSize_);if(!this.menu_.isVisible()){goog.style.setElementShown(c,false);c.style.visibility="visible"}};goog.ui.MenuButton.prototype.onTick_=function(c){var a=goog.style.getBounds(this.getElement());var b=goog.style.getVisibleRectForElement(this.getElement());if(!goog.math.Rect.equals(this.buttonRect_,a)||!goog.math.Box.equals(this.viewportBox_,b)){this.buttonRect_=a;this.viewportBox_=b;this.positionMenu()}};goog.ui.MenuButton.prototype.attachMenuEventListeners_=function(c,a){var b=this.getHandler();var d=a?b.listen:b.unlisten;d.call(b,c,goog.ui.Component.EventType.ACTION,this.handleMenuAction);d.call(b,c,goog.ui.Component.EventType.CLOSE,this.handleCloseItem);d.call(b,c,goog.ui.Component.EventType.HIGHLIGHT,this.handleHighlightItem);d.call(b,c,goog.ui.Component.EventType.UNHIGHLIGHT,this.handleUnHighlightItem)};goog.ui.MenuButton.prototype.attachKeyDownEventListener_=function(a){var b=this.getHandler();var c=a?b.listen:b.unlisten;c.call(b,this.getElement(),goog.events.EventType.KEYDOWN,this.handleKeyDownEvent_)};goog.ui.MenuButton.prototype.handleHighlightItem=function(a){var b=a.target.getElement();if(b){this.setAriaActiveDescendant_(b)}};goog.ui.MenuButton.prototype.handleKeyDownEvent_=function(a){if(this.isSupportedState(goog.ui.Component.State.FOCUSED)&&this.getKeyEventTarget()&&this.menu_&&this.menu_.isVisible()){a.stopPropagation()}};goog.ui.MenuButton.prototype.handleUnHighlightItem=function(b){if(!this.menu_.getHighlighted()){var a=this.getElement();goog.asserts.assert(a,"The menu button DOM element cannot be null.");goog.a11y.aria.setState(a,goog.a11y.aria.State.ACTIVEDESCENDANT,"");goog.a11y.aria.setState(a,goog.a11y.aria.State.OWNS,"")}};goog.ui.MenuButton.prototype.handleCloseItem=function(c){if(this.isOpen()&&c.target instanceof goog.ui.MenuItem){var b=(c.target);var a=b.getElement();if(b.isVisible()&&b.isHighlighted()&&a!=null){this.setAriaActiveDescendant_(a)}}};goog.ui.MenuButton.prototype.setAriaActiveDescendant_=function(d){var b=this.getElement();goog.asserts.assert(b,"The menu button DOM element cannot be null.");var a=goog.a11y.aria.getActiveDescendant(d);var c=a||d;if(!c.id){var e=goog.ui.IdGenerator.getInstance();c.id=e.getNextUniqueId()}goog.a11y.aria.setActiveDescendant(b,c);goog.a11y.aria.setState(b,goog.a11y.aria.State.OWNS,c.id)};goog.ui.MenuButton.prototype.attachPopupListeners_=function(a){var b=this.getHandler();var c=a?b.listen:b.unlisten;c.call(b,this.getDomHelper().getDocument(),goog.events.EventType.MOUSEDOWN,this.handleDocumentMouseDown,true);if(this.isFocusablePopupMenu()){c.call(b,(this.menu_),goog.ui.Component.EventType.BLUR,this.handleMenuBlur)}c.call(b,this.timer_,goog.Timer.TICK,this.onTick_);if(a){this.timer_.start()}else{this.timer_.stop()}};goog.ui.registry.setDecoratorByClassName(goog.ui.MenuButtonRenderer.CSS_CLASS,function(){return new goog.ui.MenuButton(null)});goog.provide("goog.ui.Select");goog.require("goog.a11y.aria");goog.require("goog.a11y.aria.Role");goog.require("goog.a11y.aria.State");goog.require("goog.array");goog.require("goog.events.EventType");goog.require("goog.ui.Component");goog.require("goog.ui.IdGenerator");goog.require("goog.ui.MenuButton");goog.require("goog.ui.MenuItem");goog.require("goog.ui.MenuRenderer");goog.require("goog.ui.SelectionModel");goog.require("goog.ui.registry");goog.ui.Select=function(c,a,e,b,d){goog.ui.Select.base(this,"constructor",c,a,e,b,d||new goog.ui.MenuRenderer(goog.a11y.aria.Role.LISTBOX));this.defaultCaption_=this.getContent();this.initialAriaLabel_=null;this.setPreferredAriaRole(goog.a11y.aria.Role.LISTBOX)};goog.inherits(goog.ui.Select,goog.ui.MenuButton);goog.tagUnsealableClass(goog.ui.Select);goog.ui.Select.prototype.selectionModel_=null;goog.ui.Select.prototype.enterDocument=function(){goog.ui.Select.superClass_.enterDocument.call(this);this.updateCaption();this.listenToSelectionModelEvents_()};goog.ui.Select.prototype.decorateInternal=function(b){goog.ui.Select.superClass_.decorateInternal.call(this,b);var a=this.getCaption();if(a){this.setDefaultCaption(a)}else{if(!this.getSelectedItem()){this.setSelectedIndex(0)}}};goog.ui.Select.prototype.disposeInternal=function(){goog.ui.Select.superClass_.disposeInternal.call(this);if(this.selectionModel_){this.selectionModel_.dispose();this.selectionModel_=null}this.defaultCaption_=null};goog.ui.Select.prototype.handleMenuAction=function(a){this.setSelectedItem((a.target));goog.ui.Select.base(this,"handleMenuAction",a);a.stopPropagation();this.dispatchEvent(goog.ui.Component.EventType.ACTION)};goog.ui.Select.prototype.handleSelectionChange=function(b){var a=this.getSelectedItem();goog.ui.Select.superClass_.setValue.call(this,a&&a.getValue());this.updateCaption()};goog.ui.Select.prototype.setMenu=function(b){var a=goog.ui.Select.superClass_.setMenu.call(this,b);if(b!=a){if(this.selectionModel_){this.selectionModel_.clear()}if(b){if(this.selectionModel_){b.forEachChild(function(d,c){this.setCorrectAriaRole_((d));this.selectionModel_.addItem(d)},this)}else{this.createSelectionModel_(b)}}}return a};goog.ui.Select.prototype.getDefaultCaption=function(){return this.defaultCaption_};goog.ui.Select.prototype.setDefaultCaption=function(a){this.defaultCaption_=a;this.updateCaption()};goog.ui.Select.prototype.addItem=function(a){this.setCorrectAriaRole_((a));goog.ui.Select.superClass_.addItem.call(this,a);if(this.selectionModel_){this.selectionModel_.addItem(a)}else{this.createSelectionModel_(this.getMenu())}this.updateAriaActiveDescendant_()};goog.ui.Select.prototype.addItemAt=function(b,a){this.setCorrectAriaRole_((b));goog.ui.Select.superClass_.addItemAt.call(this,b,a);if(this.selectionModel_){this.selectionModel_.addItemAt(b,a)}else{this.createSelectionModel_(this.getMenu())}};goog.ui.Select.prototype.removeItem=function(a){goog.ui.Select.superClass_.removeItem.call(this,a);if(this.selectionModel_){this.selectionModel_.removeItem(a)}};goog.ui.Select.prototype.removeItemAt=function(a){goog.ui.Select.superClass_.removeItemAt.call(this,a);if(this.selectionModel_){this.selectionModel_.removeItemAt(a)}};goog.ui.Select.prototype.setSelectedItem=function(b){if(this.selectionModel_){var a=this.getSelectedItem();this.selectionModel_.setSelectedItem(b);if(b!=a){this.dispatchEvent(goog.ui.Component.EventType.CHANGE)}}};goog.ui.Select.prototype.setSelectedIndex=function(a){if(this.selectionModel_){this.setSelectedItem((this.selectionModel_.getItemAt(a)))}};goog.ui.Select.prototype.setValue=function(c){if(goog.isDefAndNotNull(c)&&this.selectionModel_){for(var a=0,b;b=this.selectionModel_.getItemAt(a);a++){if(b&&typeof b.getValue=="function"&&b.getValue()==c){this.setSelectedItem((b));return}}}this.setSelectedItem(null)};goog.ui.Select.prototype.getValue=function(){var a=this.getSelectedItem();return a?a.getValue():null};goog.ui.Select.prototype.getSelectedItem=function(){return this.selectionModel_?(this.selectionModel_.getSelectedItem()):null};goog.ui.Select.prototype.getSelectedIndex=function(){return this.selectionModel_?this.selectionModel_.getSelectedIndex():-1};goog.ui.Select.prototype.getSelectionModel=function(){return this.selectionModel_};goog.ui.Select.prototype.createSelectionModel_=function(a){this.selectionModel_=new goog.ui.SelectionModel();if(a){a.forEachChild(function(c,b){this.setCorrectAriaRole_((c));this.selectionModel_.addItem(c)},this)}this.listenToSelectionModelEvents_()};goog.ui.Select.prototype.listenToSelectionModelEvents_=function(){if(this.selectionModel_){this.getHandler().listen(this.selectionModel_,goog.events.EventType.SELECT,this.handleSelectionChange)}};goog.ui.Select.prototype.updateCaption=function(){var b=this.getSelectedItem();this.setContent(b?b.getCaption():this.defaultCaption_);var c=this.getRenderer().getContentElement(this.getElement());if(c&&this.getDomHelper().isElement(c)){if(this.initialAriaLabel_==null){this.initialAriaLabel_=goog.a11y.aria.getLabel(c)}var a=b?b.getElement():null;goog.a11y.aria.setLabel(c,a?goog.a11y.aria.getLabel(a):this.initialAriaLabel_);this.updateAriaActiveDescendant_()}};goog.ui.Select.prototype.updateAriaActiveDescendant_=function(){var c=this.getRenderer();if(c){var d=c.getContentElement(this.getElement());if(d){var e=this.getElementStrict();if(!d.id){d.id=goog.ui.IdGenerator.getInstance().getNextUniqueId()}goog.a11y.aria.setRole(d,goog.a11y.aria.Role.OPTION);goog.a11y.aria.setState(e,goog.a11y.aria.State.ACTIVEDESCENDANT,d.id);if(this.selectionModel_){var a=this.selectionModel_.getItems();var b=goog.array.count(a,function(f){return f instanceof goog.ui.MenuItem});goog.a11y.aria.setState(d,goog.a11y.aria.State.SETSIZE,b);goog.a11y.aria.setState(d,goog.a11y.aria.State.POSINSET,1+this.selectionModel_.getSelectedIndex())}}}};goog.ui.Select.prototype.setCorrectAriaRole_=function(a){a.setPreferredAriaRole(a instanceof goog.ui.MenuItem?goog.a11y.aria.Role.OPTION:goog.a11y.aria.Role.SEPARATOR)};goog.ui.Select.prototype.setOpen=function(a,b){goog.ui.Select.superClass_.setOpen.call(this,a,b);if(this.isOpen()){this.getMenu().setHighlightedIndex(this.getSelectedIndex())}else{this.updateAriaActiveDescendant_()}};goog.ui.registry.setDecoratorByClassName(goog.getCssName("goog-select"),function(){return new goog.ui.Select(null)});goog.provide("goog.ui.Option");goog.require("goog.ui.Component");goog.require("goog.ui.MenuItem");goog.require("goog.ui.registry");goog.ui.Option=function(b,c,a){goog.ui.MenuItem.call(this,b,c,a);this.setSelectable(true)};goog.inherits(goog.ui.Option,goog.ui.MenuItem);goog.ui.Option.prototype.performActionInternal=function(a){return this.dispatchEvent(goog.ui.Component.EventType.ACTION)};goog.ui.registry.setDecoratorByClassName(goog.getCssName("goog-option"),function(){return new goog.ui.Option(null)});goog.provide("goog.ui.FlatMenuButtonRenderer");goog.require("goog.dom");goog.require("goog.style");goog.require("goog.ui.FlatButtonRenderer");goog.require("goog.ui.INLINE_BLOCK_CLASSNAME");goog.require("goog.ui.Menu");goog.require("goog.ui.MenuButton");goog.require("goog.ui.MenuRenderer");goog.require("goog.ui.registry");goog.ui.FlatMenuButtonRenderer=function(){goog.ui.FlatButtonRenderer.call(this)};goog.inherits(goog.ui.FlatMenuButtonRenderer,goog.ui.FlatButtonRenderer);goog.addSingletonGetter(goog.ui.FlatMenuButtonRenderer);goog.ui.FlatMenuButtonRenderer.CSS_CLASS=goog.getCssName("goog-flat-menu-button");goog.ui.FlatMenuButtonRenderer.prototype.createDom=function(d){var c=(d);var e=this.getClassNames(c);var a={"class":goog.ui.INLINE_BLOCK_CLASSNAME+" "+e.join(" ")};var b=c.getDomHelper().createDom("div",a,[this.createCaption(c.getContent(),c.getDomHelper()),this.createDropdown(c.getDomHelper())]);this.setTooltip(b,(c.getTooltip()));return b};goog.ui.FlatMenuButtonRenderer.prototype.getContentElement=function(a){return a&&(a.firstChild)};goog.ui.FlatMenuButtonRenderer.prototype.decorate=function(b,a){var c=goog.dom.getElementsByTagNameAndClass("*",goog.ui.MenuRenderer.CSS_CLASS,a)[0];if(c){goog.style.setElementShown(c,false);b.getDomHelper().getDocument().body.appendChild(c);var e=new goog.ui.Menu();e.decorate(c);b.setMenu(e)}var d=goog.dom.getElementsByTagNameAndClass("*",goog.getCssName(this.getCssClass(),"caption"),a)[0];if(!d){a.appendChild(this.createCaption(a.childNodes,b.getDomHelper()))}var f=goog.dom.getElementsByTagNameAndClass("*",goog.getCssName(this.getCssClass(),"dropdown"),a)[0];if(!f){a.appendChild(this.createDropdown(b.getDomHelper()))}return goog.ui.FlatMenuButtonRenderer.superClass_.decorate.call(this,b,a)};goog.ui.FlatMenuButtonRenderer.prototype.createCaption=function(a,b){return b.createDom("div",goog.ui.INLINE_BLOCK_CLASSNAME+" "+goog.getCssName(this.getCssClass(),"caption"),a)};goog.ui.FlatMenuButtonRenderer.prototype.createDropdown=function(a){return a.createDom("div",{"class":goog.ui.INLINE_BLOCK_CLASSNAME+" "+goog.getCssName(this.getCssClass(),"dropdown"),"aria-hidden":true},"\u00A0")};goog.ui.FlatMenuButtonRenderer.prototype.getCssClass=function(){return goog.ui.FlatMenuButtonRenderer.CSS_CLASS};goog.ui.registry.setDecoratorByClassName(goog.ui.FlatMenuButtonRenderer.CSS_CLASS,function(){return new goog.ui.MenuButton(null,null,goog.ui.FlatMenuButtonRenderer.getInstance())});goog.provide("au.upldr.ui.TopPaneRenderer");goog.require("goog.ui.Button");goog.require("goog.ui.ControlRenderer");goog.require("goog.ui.FlatMenuButtonRenderer");goog.require("goog.ui.LinkButtonRenderer");goog.require("goog.ui.Option");goog.require("goog.ui.Select");goog.require("goog.userAgent");goog.require("au.upldr.Properties");goog.require("au.upldr.ui.Label");goog.require("au.upldr.ViewMode");goog.require("au.upldr.ui.ClassNames");goog.require("au.upldr.ui.ClassNamesCompat");goog.require("au.upldr.ui.FileButton");au.upldr.ui.TopPaneRenderer=function(){goog.base(this)};goog.inherits(au.upldr.ui.TopPaneRenderer,goog.ui.ControlRenderer);goog.addSingletonGetter(au.upldr.ui.TopPaneRenderer);au.upldr.ui.TopPaneRenderer.CSS_CLASS=au.upldr.ui.ClassNames.TOP_PANE;au.upldr.ui.TopPaneRenderer.prototype.getCssClass=function(){return au.upldr.ui.TopPaneRenderer.CSS_CLASS};au.upldr.ui.TopPaneRenderer.prototype.toggleDueFolderMode=function(g,b,a){if(typeof a!="undefined"&&!a){goog.style.setElementShown(g.getChildAt(1).getContentElement(),a);goog.style.setElementShown(g.getChildAt(2).getContentElement(),a);goog.style.setElementShown(g.getChildAt(3).getContentElement(),a);goog.style.setElementShown(g.getChildAt(4).getContentElement(),a)}else{var f=b.getProperty(au.upldr.Properties.FOLDER_PROCESSING_MODE);var e=f==au.upldr.FolderProcessingModeEnum.MIXED;var c=f==au.upldr.FolderProcessingModeEnum.FOLDER;var d=f==au.upldr.FolderProcessingModeEnum.NONE;goog.style.setElementShown(g.getChildAt(1).getContentElement(),e||d);goog.style.setElementShown(g.getChildAt(2).getContentElement(),e);goog.style.setElementShown(g.getChildAt(3).getContentElement(),c||e);goog.style.setElementShown(g.getChildAt(4).getContentElement(),true)}};au.upldr.ui.TopPaneRenderer.prototype.createDom=function(l){var c=(l.getDomHelper().createDom("div",this.getClassNames(l).join(" ")));l.setElementInternal(c);var h=l.getModel().getPropertyHolder();var d=goog.ui.LinkButtonRenderer.getInstance();var e=goog.ui.Button;var g=au.upldr.ui.Label;var j=au.upldr.Properties;var b=goog.dom.createDom("div",au.upldr.ui.ClassNames.TITLE);goog.dom.classlist.addAll(b,au.upldr.ui.ClassNamesCompat.TITLE_TEXT.replace(/\s+/," ").split(" "));goog.dom.appendChild(c,b);var k=new g((h.getProperty(j.TITLE_TEXT)));h.observe(j.TITLE_TEXT,function(){k.setLabelText((h.getProperty(j.TITLE_TEXT)))});l.addChild(k,false);k.render(b);var m=[new e((h.getProperty(j.ADD_FILES_LINK_TEXT)),d),new g(",\u00a0"),new e((h.getProperty(j.ADD_FOLDER_LINK_TEXT)),d),new g(("\u00a0"+h.getProperty(j.OR_LABEL_TEXT)+"\u00a0")),new e((h.getProperty(j.REMOVE_ALL_FILES_LINK_TEXT)),d)];m[0].setEnabled((h.getProperty(j.ENABLE_ADDING_FILES)));m[0].setVisible((h.getProperty(j.IS_VISIBLE_ADDING_FILES)));m[4].setEnabled(false);h.observe(j.ADD_FILES_LINK_TEXT,function(){m[0].setCaption((h.getProperty(j.ADD_FILES_LINK_TEXT)))});h.observe(j.ENABLE_ADDING_FILES,function(){m[0].setEnabled((h.getProperty(j.ENABLE_ADDING_FILES)));m[2].setEnabled((h.getProperty(j.ENABLE_ADDING_FILES)))});h.observe(j.IS_VISIBLE_ADDING_FILES,function(){var o=(h.getProperty(j.IS_VISIBLE_ADDING_FILES));this.toggleDueFolderMode(l,h,o)}.bind(this));h.observe(j.ADD_FOLDER_LINK_TEXT,function(){m[2].setCaption((h.getProperty(j.ADD_FOLDER_LINK_TEXT)))});h.observe(j.FOLDER_PROCESSING_MODE,function(){this.toggleDueFolderMode(l,h)}.bind(this));h.observe(j.OR_LABEL_TEXT,function(){m[3].setLabelText(("\u00a0"+h.getProperty(j.OR_LABEL_TEXT)+"\u00a0"))});h.observe(j.REMOVE_ALL_FILES_LINK_TEXT,function(){m[4].setCaption((h.getProperty(j.REMOVE_ALL_FILES_LINK_TEXT)))});goog.array.forEach(m,function(q,o,r){l.addChild(q,true)});this.toggleDueFolderMode(l,h);goog.dom.classlist.addAll(m[0].getElement(),au.upldr.ui.ClassNamesCompat.HTML_LINK.replace(/\s+/," ").split(" "));goog.dom.classlist.addAll(m[2].getElement(),au.upldr.ui.ClassNamesCompat.HTML_LINK.replace(/\s+/," ").split(" "));goog.dom.classlist.addAll(m[3].getElement(),au.upldr.ui.ClassNamesCompat.UPLOAD_PANEL_OR_TEXT.replace(/\s+/," ").split(" "));goog.dom.classlist.addAll(m[4].getElement(),au.upldr.ui.ClassNamesCompat.HTML_LINK.replace(/\s+/," ").split(" "));var n=(h.getProperty(j.VIEW_COMBOBOX_TEXT));var i=new goog.ui.Select(null,null,goog.ui.FlatMenuButtonRenderer.getInstance());i.addItem(new goog.ui.MenuItem(n[0],au.upldr.ViewMode.TILES));i.addItem(new goog.ui.MenuItem(n[1],au.upldr.ViewMode.THUMBNAILS));i.addItem(new goog.ui.MenuItem(n[2],au.upldr.ViewMode.ICONS));i.setValue((h.getProperty(j.VIEW_MODE)));i.setRenderMenuAsSibling(true);h.observe(j.VIEW_COMBOBOX_TEXT,function(){var o=(h.getProperty(j.VIEW_COMBOBOX_TEXT));for(var q=0;q<3;q++){i.getItemAt(q).setCaption(o[q])}i.setSelectedIndex(i.getSelectedIndex())});h.observe(j.VIEW_MODE,function(){i.setValue((h.getProperty(j.VIEW_MODE)))});b=goog.dom.createDom("div",au.upldr.ui.ClassNames.CHANGE_VIEW);goog.dom.insertChildAt(c,b,0);var f=[new g((h.getProperty(j.VIEW_COMBOBOX_LABEL_TEXT))),i];h.observe(j.VIEW_COMBOBOX_LABEL_TEXT,function(){f[0].setLabelText((h.getProperty(j.VIEW_COMBOBOX_LABEL_TEXT)))});goog.array.forEach(f,function(q,o,r){if(o>0){goog.dom.append(c,"\u00a0")}l.addChild(q,false);q.render(b)});goog.dom.classlist.addAll(f[0].getElement(),au.upldr.ui.ClassNamesCompat.PANEL_TEXT.replace(/\s+/," ").split(" "));goog.dom.classlist.addAll(f[1].getElement(),au.upldr.ui.ClassNamesCompat.VIEW_COMBOBOX.replace(/\s+/," ").split(" "));var a=b;goog.style.setElementShown(a,h.getProperty(au.upldr.Properties.SHOW_VIEW_COMBOBOX));h.observe(au.upldr.Properties.SHOW_VIEW_COMBOBOX,function(){goog.style.setElementShown(a,h.getProperty(au.upldr.Properties.SHOW_VIEW_COMBOBOX))});return c};goog.provide("au.upldr.ui.TopPane");goog.require("goog.functions");goog.require("goog.ui.Component.EventType");goog.require("goog.ui.Control");goog.require("goog.userAgent");goog.require("au.upldr.events.CollectionEvent");goog.require("au.upldr.ui.TopPaneRenderer");goog.require("au.upldr.events.EventType");goog.require("au.upldr.Properties");au.upldr.ui.TopPane=function(b,a){goog.base(this,null,a);this.setModel(b);this.setSupportedState(goog.ui.Component.State.ALL,false)};goog.inherits(au.upldr.ui.TopPane,goog.ui.Control);au.upldr.ui.TopPane.prototype.enterDocument=function(){goog.base(this,"enterDocument");var i=this.getHandler();var a=this.getChildAt(1);i.listen(a,goog.ui.Component.EventType.ACTION,this.onAddFilesButtonClick_);var h=this.getChildAt(3);i.listen(h,goog.ui.Component.EventType.ACTION,this.onAddFolderButtonClick_);var e=this.getChildAt(5);i.listen(e,goog.ui.Component.EventType.ACTION,this.onRemoveFilesButtonClick_);var g=this.getChildAt(7);i.listen(g,goog.ui.Component.EventType.ACTION,this.onViewComboBoxChanged_);var b;var c=g.getMenu().isInDocument();if(!c){b=g.getMenu().getElement();goog.dom.appendChild(g.getElement().parentNode,b)}var j=goog.style.getSize(b);if(!c){goog.dom.removeNode(b)}if(j.width>0){b=g.getElement();var f=goog.style.getPaddingBox(b);goog.style.setWidth(b,j.width-f.left-f.right)}i.listen(this.getModel().getItems(),au.upldr.events.CollectionEvent.COLLECTION_CHANGED,this.itemsCollectionChanged_);var d=this.getModel().getPropertyHolder();d.observe(au.upldr.InternalProperties.UPLOADER_STATE,this.uploaderState_ChangeHandler_,this);this.setVisible((d.getProperty(au.upldr.Properties.TOP_PANE_VISIBILITY)));d.observe(au.upldr.Properties.TOP_PANE_VISIBILITY,function(){this.setVisible(d.getProperty(au.upldr.Properties.TOP_PANE_VISIBILITY))},this)};au.upldr.ui.TopPane.prototype.getAddFilesLink=function(){return this.getChildAt(1)};au.upldr.ui.TopPane.prototype.uploaderState_ChangeHandler_=function(){var a=this.getChildAt(4);var b=this.getChildAt(5);var c=this.getModel().getState();goog.style.setElementShown(a.getContentElement(),c!=au.upldr.UploaderState.UPLOADING);goog.style.setElementShown(b.getContentElement(),c!=au.upldr.UploaderState.UPLOADING);this.getRenderer().toggleDueFolderMode(this,this.getModel().getPropertyHolder(),c!=au.upldr.UploaderState.UPLOADING)};au.upldr.ui.TopPane.prototype.onFileButtonClick_=function(a){this.getModel().addFilesFromEvent_(a);a.stopPropagation()};au.upldr.ui.TopPane.prototype.onAddFilesButtonClick_=function(a){this.getModel().addFiles()};au.upldr.ui.TopPane.prototype.onAddFolderButtonClick_=function(a){this.getModel().addFiles(true)};au.upldr.ui.TopPane.prototype.onRemoveFilesButtonClick_=function(b){var a=this.getModel();a.removeAllFiles()};au.upldr.ui.TopPane.prototype.onViewComboBoxChanged_=function(b){var a=b.target.getValue();this.getModel().getPropertyHolder().setProperty(au.upldr.Properties.VIEW_MODE,a)};au.upldr.ui.TopPane.prototype.itemsCollectionChanged_=function(c){var b=this.getChildAt(5);var a=(c.target);b.setEnabled(a.getCount()>0)};au.upldr.ui.TopPane.prototype.getModel;au.upldr.ui.TopPane.prototype.canDecorate=goog.functions.FALSE;au.upldr.ui.TopPane.prototype.isHandleMouseEvents=goog.functions.FALSE;goog.ui.registry.setDefaultRenderer(au.upldr.ui.TopPane,au.upldr.ui.TopPaneRenderer);goog.provide("au.upldr.ui.Uploader");goog.require("goog.functions");goog.require("goog.ui.Component");goog.require("goog.string.StringBuffer");goog.require("au.upldr.IUploader");goog.require("au.upldr.ui.InformationBar");goog.require("au.upldr.ui.StatusPane");goog.require("au.upldr.ui.TopPane");goog.require("au.upldr.ui.UploadPane");goog.require("au.upldr.ui.DescriptionEditor");goog.require("au.upldr.ui.DescriptionEditor.EventType");goog.require("au.upldr.utils");goog.require("au.upldr.ui.ProgressDialog");goog.require("au.upldr.imaging.imageEditor.ImageEditorDialog");goog.require("au.upldr.ui.ProgressDialog.EventType");goog.require("au.upldr.ui.ImagePreview");goog.require("goog.dom.classlist");goog.require("au.upldr.events.EventType");au.upldr.ui.Uploader=function(b,a){goog.base(this,a);this.setModel(b);this.descriptionEditor_;this.bgEl_;this.showTimer_;this.progressDialog_;this.imagePreview_;this.uploadPane_;this.imageEditorDialog_};goog.inherits(au.upldr.ui.Uploader,goog.ui.Component);au.upldr.ui.Uploader.CSS_CLASS=au.upldr.ui.ClassNames.UPLOADER;au.upldr.ui.Uploader.prototype.getCssClass=function(){return au.upldr.ui.Uploader.CSS_CLASS};au.upldr.ui.Uploader.prototype.getFirstVisible=function(){var a=(this.getChildAt(2));var b=a.getList();return b.getFirstVisible()};au.upldr.ui.Uploader.prototype.createDom=function(){var g=this.getModel();var k=g.getPropertyHolder();var m=au.upldr.Properties;var a=new goog.string.StringBuffer();a.append("width:");var n=(k.getProperty(m.WIDTH));a.append(n);a.append(";height:");var f=(k.getProperty(m.HEIGHT));a.append(f);var d=this.getDomHelper();var o=[d.createDom("div",null),d.createDom("div",null),d.createDom("div",null),d.createDom("div",null)];var c=d.createDom("div",goog.getCssName(this.getCssClass(),"panes"),o[0],o[1],o[2],o[3],o[4]);if("-ms-flex" in c.style){goog.dom.classlist.add(c,"flexbox")}c=d.createDom("div",{className:this.getCssClass(),id:k.getProperty(m.ID),style:a.toString()},c);this.setElementInternal(c);this.uploadPane_=new au.upldr.ui.UploadPane(g);this.topPane_=new au.upldr.ui.TopPane(g);this.statusPane_=new au.upldr.ui.StatusPane(g);this.informationBar_=new au.upldr.ui.InformationBar(g);var b=[this.topPane_,this.informationBar_,this.uploadPane_,this.statusPane_];for(var e=0;e<b.length;e++){if(b[e]){this.addChild(b[e],false);b[e].render(o[e])}}this.bgEl_=d.createDom("div",goog.getCssName(this.getCssClass(),"bg"));goog.style.setElementShown(this.bgEl_,false);goog.dom.appendChild(c,this.bgEl_);var j=this.descriptionEditor_=new au.upldr.ui.DescriptionEditor(k);j.render(c);var l=this.progressDialog_=new au.upldr.ui.ProgressDialog(g);l.render(c);this.imageEditorDialog_=new au.upldr.imaging.imageEditor.ImageEditorDialog(g);this.imageEditorDialog_.render(c);this.imagePreview_=new au.upldr.ui.ImagePreview(k);this.imagePreview_.render(c)};au.upldr.ui.Uploader.prototype.enterDocument=function(){goog.base(this,"enterDocument");this.getHandler().listen(this.descriptionEditor_,[au.upldr.ui.DescriptionEditor.EventType.HIDE,au.upldr.ui.DescriptionEditor.EventType.SHOW],this.descriptionEditor_showHandler_).listen(this.progressDialog_,[au.upldr.ui.ProgressDialog.EventType.HIDE,au.upldr.ui.ProgressDialog.EventType.SHOW],this.descriptionEditor_showHandler_).listen(this.imagePreview_,[au.upldr.ui.ImagePreview.EventType.HIDE,au.upldr.ui.ImagePreview.EventType.SHOW],this.descriptionEditor_showHandler_).listen(this.imageEditorDialog_,[au.upldr.imaging.imageEditor.ImageEditorDialog.EventType.HIDE,au.upldr.imaging.imageEditor.ImageEditorDialog.EventType.SHOW],this.descriptionEditor_showHandler_)};au.upldr.ui.Uploader.prototype.getImageEditor=function(){return this.imageEditorDialog_};au.upldr.ui.Uploader.prototype.getDescriptionEditor=function(){return this.descriptionEditor_};au.upldr.ui.Uploader.prototype.getProgressDialog=function(){return this.progressDialog_};au.upldr.ui.Uploader.prototype.getUploadPane=function(){return this.uploadPane_};au.upldr.ui.Uploader.prototype.getTopPane=function(){return this.topPane_};au.upldr.ui.Uploader.prototype.getInformationBar=function(){return this.informationBar_};goog.exportProperty(au.upldr.ui.Uploader.prototype,"getTopPane",au.upldr.ui.Uploader.prototype.getTopPane);au.upldr.ui.Uploader.prototype.getStatusPane=function(){return this.statusPane_};goog.exportProperty(au.upldr.ui.Uploader.prototype,"getStatusPane",au.upldr.ui.Uploader.prototype.getStatusPane);au.upldr.ui.Uploader.prototype.getImagePreview=function(){return this.imagePreview_};au.upldr.ui.Uploader.prototype.setEnable=function(c,a){if(this.showTimer_){clearTimeout(this.showTimer_);delete this.showTimer_}if(a>0){this.showTimer_=au.upldr.utils.setTimeout(goog.bind(this.setEnable,this,c),a)}else{var b=this.getUploadPane();if(b&&(b=b.getList())){b.setEnabled(c)}goog.style.setElementShown(this.bgEl_,!c)}};au.upldr.ui.Uploader.prototype.descriptionEditor_showHandler_=function(a){this.setEnable(a.type===au.upldr.ui.DescriptionEditor.EventType.HIDE)};au.upldr.ui.Uploader.prototype.getModel;au.upldr.ui.Uploader.prototype.canDecorate=goog.functions.FALSE;goog.provide("au.upldr.ui.FileDialog");goog.require("goog.dom");goog.require("goog.events");goog.require("goog.events.EventTarget");goog.require("goog.events.EventType");goog.require("goog.array");goog.require("au.upldr.utils.mimeMapping");goog.require("au.upldr.events.AddFileEvent");au.upldr.ui.FileDialog=function(a,b){goog.base(this);this.fileInput_=null;this.fileMask_=b||"";this.parentElement_=a||null;this.directoryAttrs_=["directory","webkitdirectory"];this.reInitInput()};goog.inherits(au.upldr.ui.FileDialog,goog.events.EventTarget);au.upldr.ui.FileDialog.prototype.open=function(a){this.toggleDirectoryAttrs_(!!a);this.fileInput_.click()};au.upldr.ui.FileDialog.prototype.reInitInput=function(){if(this.fileInput_&&this.fileInput_.parentNode){this.fileInput_.parentNode.removeChild(this.fileInput_)}this.fileInput_=goog.dom.createDom("input",{type:"file",multiple:"multiple",accept:au.upldr.utils.mimeMapping.getInputFileAcceptString(this.fileMask_),style:"position:absolute;visibility:hidden;top:-100px;width:1px;height:1px"});goog.dom.appendChild(this.parentElement_||goog.dom.getDocument().body,this.fileInput_);goog.events.listen(this.fileInput_,goog.events.EventType.CHANGE,this.fileInputChanged_,false,this)};au.upldr.ui.FileDialog.prototype.getFileInput=function(){return this.fileInput_};au.upldr.ui.FileDialog.prototype.toggleDirectoryAttrs_=function(a){goog.array.forEach(this.directoryAttrs_,function(b){if(a){this.fileInput_.setAttribute(b,"")}else{this.fileInput_.removeAttribute(b)}},this)};au.upldr.ui.FileDialog.prototype.toggleMultiple=function(b){var a="multiple";var c=this.fileInput_.hasAttribute(a);if(b&&!c){this.fileInput_.setAttribute(a,"")}else{if(!b&&c){this.fileInput_.removeAttribute(a)}}};au.upldr.ui.FileDialog.prototype.fileInputChanged_=function(){var a=new au.upldr.events.AddFileEvent(this.fileInput_.files);this.dispatchEvent(a);if(goog.userAgent.IE){this.reInitInput()}else{this.fileInput_.value=""}};au.upldr.ui.FileDialog.prototype.disposeInternal=function(){goog.base(this,"disposeInternal");goog.events.removeAll(this.fileInput_);goog.dom.removeNode(this.fileInput_);delete this.fileInput_};goog.provide("goog.structs.SimplePool");goog.require("goog.Disposable");goog.structs.SimplePool=function(b,a){goog.Disposable.call(this);this.createObjectFn_=null;this.disposeObjectFn_=null;this.maxCount_=a;this.freeQueue_=[];this.createInitial_(b)};goog.inherits(goog.structs.SimplePool,goog.Disposable);goog.structs.SimplePool.prototype.setCreateObjectFn=function(a){this.createObjectFn_=a};goog.structs.SimplePool.prototype.setDisposeObjectFn=function(a){this.disposeObjectFn_=a};goog.structs.SimplePool.prototype.getObject=function(){if(this.freeQueue_.length){return this.freeQueue_.pop()}return this.createObject()};goog.structs.SimplePool.prototype.releaseObject=function(a){if(this.freeQueue_.length<this.maxCount_){this.freeQueue_.push(a)}else{this.disposeObject(a)}};goog.structs.SimplePool.prototype.createInitial_=function(b){if(b>this.maxCount_){throw Error("[goog.structs.SimplePool] Initial cannot be greater than max")}for(var a=0;a<b;a++){this.freeQueue_.push(this.createObject())}};goog.structs.SimplePool.prototype.createObject=function(){if(this.createObjectFn_){return this.createObjectFn_()}else{return{}}};goog.structs.SimplePool.prototype.disposeObject=function(b){if(this.disposeObjectFn_){this.disposeObjectFn_(b)}else{if(goog.isObject(b)){if(goog.isFunction(b.dispose)){b.dispose()}else{for(var a in b){delete b[a]}}}}};goog.structs.SimplePool.prototype.disposeInternal=function(){goog.structs.SimplePool.superClass_.disposeInternal.call(this);var a=this.freeQueue_;while(a.length){this.disposeObject(a.pop())}delete this.freeQueue_};goog.provide("goog.debug.Trace");goog.require("goog.array");goog.require("goog.debug.Logger");goog.require("goog.iter");goog.require("goog.log");goog.require("goog.structs.Map");goog.require("goog.structs.SimplePool");goog.debug.Trace_=function(){this.events_=[];this.outstandingEvents_=new goog.structs.Map();this.startTime_=0;this.tracerOverheadStart_=0;this.tracerOverheadEnd_=0;this.tracerOverheadComment_=0;this.stats_=new goog.structs.Map();this.tracerCount_=0;this.commentCount_=0;this.nextId_=1;this.eventPool_=new goog.structs.SimplePool(0,4000);this.eventPool_.createObject=function(){return new goog.debug.Trace_.Event_()};this.statPool_=new goog.structs.SimplePool(0,50);this.statPool_.createObject=function(){return new goog.debug.Trace_.Stat_()};var a=this;this.idPool_=new goog.structs.SimplePool(0,2000);this.idPool_.createObject=function(){return String(a.nextId_++)};this.idPool_.disposeObject=function(b){};this.defaultThreshold_=3};goog.debug.Trace_.prototype.logger_=goog.log.getLogger("goog.debug.Trace");goog.debug.Trace_.prototype.MAX_TRACE_SIZE=1000;goog.debug.Trace_.EventType={START:0,STOP:1,COMMENT:2};goog.debug.Trace_.Stat_=function(){this.count=0;this.time=0;this.varAlloc=0};goog.debug.Trace_.Stat_.prototype.type;goog.debug.Trace_.Stat_.prototype.toString=function(){var a=[];a.push(this.type," ",this.count," (",Math.round(this.time*10)/10," ms)");if(this.varAlloc){a.push(" [VarAlloc = ",this.varAlloc,"]")}return a.join("")};goog.debug.Trace_.Event_=function(){};goog.debug.Trace_.Event_.prototype.type;goog.debug.Trace_.Event_.prototype.toTraceString=function(c,b,a){var e=[];if(b==-1){e.push("    ")}else{e.push(goog.debug.Trace_.longToPaddedString_(this.eventTime-b))}e.push(" ",goog.debug.Trace_.formatTime_(this.eventTime-c));if(this.eventType==goog.debug.Trace_.EventType.START){e.push(" Start        ")}else{if(this.eventType==goog.debug.Trace_.EventType.STOP){e.push(" Done ");var d=this.stopTime-this.startTime;e.push(goog.debug.Trace_.longToPaddedString_(d)," ms ")}else{e.push(" Comment      ")}}e.push(a,this);if(this.totalVarAlloc>0){e.push("[VarAlloc ",this.totalVarAlloc,"] ")}return e.join("")};goog.debug.Trace_.Event_.prototype.toString=function(){if(this.type==null){return this.comment}else{return"["+this.type+"] "+this.comment}};goog.debug.Trace_.prototype.setStartTime=function(a){this.startTime_=a};goog.debug.Trace_.prototype.initCurrentTrace=function(a){this.reset(a)};goog.debug.Trace_.prototype.clearCurrentTrace=function(){this.reset(0)};goog.debug.Trace_.prototype.reset=function(e){this.defaultThreshold_=e;for(var b=0;b<this.events_.length;b++){var f=(this.eventPool_).id;if(f){this.idPool_.releaseObject(f)}this.eventPool_.releaseObject(this.events_[b])}this.events_.length=0;this.outstandingEvents_.clear();this.startTime_=goog.debug.Trace_.now();this.tracerOverheadStart_=0;this.tracerOverheadEnd_=0;this.tracerOverheadComment_=0;this.tracerCount_=0;this.commentCount_=0;var d=this.stats_.getKeys();for(var b=0;b<d.length;b++){var a=d[b];var c=this.stats_.get(a);c.count=0;c.time=0;c.varAlloc=0;this.statPool_.releaseObject((c))}this.stats_.clear()};goog.debug.Trace_.prototype.startTracer=function(h,g){var a=goog.debug.Trace_.now();var e=this.getTotalVarAlloc();var f=this.outstandingEvents_.getCount();if(this.events_.length+f>this.MAX_TRACE_SIZE){goog.log.warning(this.logger_,"Giant thread trace. Clearing to avoid memory leak.");if(this.events_.length>this.MAX_TRACE_SIZE/2){for(var c=0;c<this.events_.length;c++){var d=this.events_[c];if(d.id){this.idPool_.releaseObject(d.id)}this.eventPool_.releaseObject(d)}this.events_.length=0}if(f>this.MAX_TRACE_SIZE/2){this.outstandingEvents_.clear()}}goog.debug.Logger.logToProfilers("Start : "+h);var d=(this.eventPool_.getObject());d.totalVarAlloc=e;d.eventType=goog.debug.Trace_.EventType.START;d.id=Number(this.idPool_.getObject());d.comment=h;d.type=g;this.events_.push(d);this.outstandingEvents_.set(String(d.id),d);this.tracerCount_++;var b=goog.debug.Trace_.now();d.startTime=d.eventTime=b;this.tracerOverheadStart_+=b-a;return d.id};goog.debug.Trace_.prototype.stopTracer=function(a,k){var b=goog.debug.Trace_.now();var e;if(k===0){e=0}else{if(k){e=k}else{e=this.defaultThreshold_}}var f=this.outstandingEvents_.get(String(a));if(f==null){return null}this.outstandingEvents_.remove(String(a));var d;var m=b-f.startTime;if(m<e){var j=this.events_.length;for(var h=j-1;h>=0;h--){var n=this.events_[h];if(n==f){this.events_.splice(h,1);this.idPool_.releaseObject(f.id);this.eventPool_.releaseObject((f));break}}}else{d=(this.eventPool_.getObject());d.eventType=goog.debug.Trace_.EventType.STOP;d.startTime=f.startTime;d.comment=f.comment;d.type=f.type;d.stopTime=d.eventTime=b;this.events_.push(d)}var l=f.type;var g=null;if(l){g=this.getStat_(l);g.count++;g.time+=m}if(d){goog.debug.Logger.logToProfilers("Stop : "+d.comment);d.totalVarAlloc=this.getTotalVarAlloc();if(g){g.varAlloc+=(d.totalVarAlloc-f.totalVarAlloc)}}var c=goog.debug.Trace_.now();this.tracerOverheadEnd_+=c-b;return m};goog.debug.Trace_.prototype.setGcTracer=function(a){this.gcTracer_=a};goog.debug.Trace_.prototype.getTotalVarAlloc=function(){var a=this.gcTracer_;if(a&&a.isTracing()){return a.totalVarAlloc}return -1};goog.debug.Trace_.prototype.addComment=function(g,k,c){var b=goog.debug.Trace_.now();var d=c?c:b;var l=(this.eventPool_.getObject());l.eventType=goog.debug.Trace_.EventType.COMMENT;l.eventTime=d;l.type=k;l.comment=g;l.totalVarAlloc=this.getTotalVarAlloc();this.commentCount_++;if(c){var m=this.events_.length;for(var f=0;f<m;f++){var a=this.events_[f];var j=a.eventTime;if(j>d){goog.array.insertAt(this.events_,l,f);break}}if(f==m){this.events_.push(l)}}else{this.events_.push(l)}var h=l.type;if(h){var e=this.getStat_(h);e.count++}this.tracerOverheadComment_+=goog.debug.Trace_.now()-b};goog.debug.Trace_.prototype.getStat_=function(b){var a=this.stats_.get(b);if(!a){a=(this.statPool_.getObject());a.type=b;this.stats_.set(b,a)}return(a)};goog.debug.Trace_.prototype.getFormattedTrace=function(){return this.toString()};goog.debug.Trace_.prototype.toString=function(){var j=[];var h=-1;var a=[];for(var c=0;c<this.events_.length;c++){var g=this.events_[c];if(g.eventType==goog.debug.Trace_.EventType.STOP){a.pop()}j.push(" ",g.toTraceString(this.startTime_,h,a.join("")));h=g.eventTime;j.push("\n");if(g.eventType==goog.debug.Trace_.EventType.START){a.push("|  ")}}if(this.outstandingEvents_.getCount()!=0){var b=goog.debug.Trace_.now();j.push(" Unstopped timers:\n");goog.iter.forEach(this.outstandingEvents_,function(e){j.push("  ",e," (",b-e.startTime," ms, started at ",goog.debug.Trace_.formatTime_(e.startTime),")\n")})}var f=this.stats_.getKeys();for(var c=0;c<f.length;c++){var d=this.stats_.get(f[c]);if(d.count>1){j.push(" TOTAL ",d,"\n")}}j.push("Total tracers created ",this.tracerCount_,"\n","Total comments created ",this.commentCount_,"\n","Overhead start: ",this.tracerOverheadStart_," ms\n","Overhead end: ",this.tracerOverheadEnd_," ms\n","Overhead comment: ",this.tracerOverheadComment_," ms\n");return j.join("")};goog.debug.Trace_.longToPaddedString_=function(a){a=Math.round(a);var b="";if(a<1000){b=" "}if(a<100){b="  "}if(a<10){b="   "}return b+a};goog.debug.Trace_.formatTime_=function(c){c=Math.round(c);var b=(c/1000)%60;var a=c%1000;return String(100+b).substring(1,3)+"."+String(1000+a).substring(1,4)};goog.debug.Trace_.now=function(){return goog.now()};goog.debug.Trace=new goog.debug.Trace_();goog.provide("goog.debug.ErrorHandler");goog.provide("goog.debug.ErrorHandler.ProtectedFunctionError");goog.require("goog.Disposable");goog.require("goog.asserts");goog.require("goog.debug");goog.require("goog.debug.EntryPointMonitor");goog.require("goog.debug.Error");goog.require("goog.debug.Trace");goog.debug.ErrorHandler=function(a){goog.debug.ErrorHandler.base(this,"constructor");this.errorHandlerFn_=a;this.wrapErrors_=true;this.prefixErrorMessages_=false};goog.inherits(goog.debug.ErrorHandler,goog.Disposable);goog.debug.ErrorHandler.prototype.addTracersToProtectedFunctions_=false;goog.debug.ErrorHandler.prototype.setAddTracersToProtectedFunctions=function(a){this.addTracersToProtectedFunctions_=a};goog.debug.ErrorHandler.prototype.wrap=function(a){return this.protectEntryPoint(goog.asserts.assertFunction(a))};goog.debug.ErrorHandler.prototype.unwrap=function(a){goog.asserts.assertFunction(a);return a[this.getFunctionIndex_(false)]||a};goog.debug.ErrorHandler.prototype.getStackTraceHolder_=function(a){var b=[];b.push("##PE_STACK_START##");b.push(a.replace(/(\r\n|\r|\n)/g,"##STACK_BR##"));b.push("##PE_STACK_END##");return b.join("")};goog.debug.ErrorHandler.prototype.getFunctionIndex_=function(a){return(a?"__wrapper_":"__protected_")+goog.getUid(this)+"__"};goog.debug.ErrorHandler.prototype.protectEntryPoint=function(b){var a=this.getFunctionIndex_(true);if(!b[a]){var c=b[a]=this.getProtectedFunction(b);c[this.getFunctionIndex_(false)]=b}return b[a]};goog.debug.ErrorHandler.prototype.getProtectedFunction=function(c){var e=this;var b=this.addTracersToProtectedFunctions_;if(b){var a=goog.debug.getStacktraceSimple(15)}var d=function(){if(e.isDisposed()){return c.apply(this,arguments)}if(b){var f=goog.debug.Trace.startTracer("protectedEntryPoint: "+e.getStackTraceHolder_(a))}try{return c.apply(this,arguments)}catch(g){e.errorHandlerFn_(g);if(!e.wrapErrors_){if(e.prefixErrorMessages_){if(typeof g==="object"){g.message=goog.debug.ErrorHandler.ProtectedFunctionError.MESSAGE_PREFIX+g.message}else{g=goog.debug.ErrorHandler.ProtectedFunctionError.MESSAGE_PREFIX+g}}if(goog.DEBUG){if(g&&g.stack&&Error.captureStackTrace&&goog.global.console){goog.global.console["error"](g.message,g.stack)}}throw g}throw new goog.debug.ErrorHandler.ProtectedFunctionError(g)}finally{if(b){goog.debug.Trace.stopTracer(f)}}};d[this.getFunctionIndex_(false)]=c;return d};goog.debug.ErrorHandler.prototype.protectWindowSetTimeout=function(){this.protectWindowFunctionsHelper_("setTimeout")};goog.debug.ErrorHandler.prototype.protectWindowSetInterval=function(){this.protectWindowFunctionsHelper_("setInterval")};goog.debug.ErrorHandler.prototype.protectWindowRequestAnimationFrame=function(){var c=goog.getObjectByName("window");var b=["requestAnimationFrame","mozRequestAnimationFrame","webkitAnimationFrame","msRequestAnimationFrame"];for(var a=0;a<b.length;a++){var d=b[a];if(b[a] in c){this.protectWindowFunctionsHelper_(d)}}};goog.debug.ErrorHandler.prototype.protectWindowFunctionsHelper_=function(d){var c=goog.getObjectByName("window");var b=c[d];var a=this;c[d]=function(e,f){if(goog.isString(e)){e=goog.partial(goog.globalEval,e)}e=a.protectEntryPoint(e);if(b.call){return b.call(this,e,f)}else{return b(e,f)}};c[d][this.getFunctionIndex_(false)]=b};goog.debug.ErrorHandler.prototype.setWrapErrors=function(a){this.wrapErrors_=a};goog.debug.ErrorHandler.prototype.setPrefixErrorMessages=function(a){this.prefixErrorMessages_=a};goog.debug.ErrorHandler.prototype.disposeInternal=function(){var a=goog.getObjectByName("window");a.setTimeout=this.unwrap(a.setTimeout);a.setInterval=this.unwrap(a.setInterval);goog.debug.ErrorHandler.base(this,"disposeInternal")};goog.debug.ErrorHandler.ProtectedFunctionError=function(c){var b=goog.debug.ErrorHandler.ProtectedFunctionError.MESSAGE_PREFIX+(c&&c.message?String(c.message):String(c));goog.debug.ErrorHandler.ProtectedFunctionError.base(this,"constructor",b);this.cause=c;var a=c&&c.stack;if(a&&goog.isString(a)){this.stack=(a)}};goog.inherits(goog.debug.ErrorHandler.ProtectedFunctionError,goog.debug.Error);goog.debug.ErrorHandler.ProtectedFunctionError.MESSAGE_PREFIX="Error in protected function: ";goog.provide("au.upldr.image.PreviewGenerator");goog.require("goog.events.EventHandler");goog.require("goog.events.EventType");goog.require("goog.async.DeferredList");goog.require("goog.log");goog.require("goog.fs");goog.require("goog.events.EventTarget");goog.require("goog.asserts");goog.require("goog.dom.classlist");goog.require("au.upldr.ui.ClassNames");goog.require("au.upldr.image.FitMode");goog.require("au.upldr.image.ThumbnailCreator");goog.require("au.upldr.image.ImageLoader");goog.require("au.upldr.support");goog.require("au.upldr.ItemHolder.State");au.upldr.image.PreviewGenerator=function(){goog.base(this);this.handler_=new goog.events.EventHandler(this);this.queue_=[];this.currentItem_=null;this.enableExifPreview_=false};goog.inherits(au.upldr.image.PreviewGenerator,goog.events.EventTarget);goog.addSingletonGetter(au.upldr.image.PreviewGenerator);au.upldr.image.PreviewGenerator.Item;au.upldr.image.PreviewGenerator.prototype.create=function(b,a){goog.asserts.assert(au.upldr.support.isThumbnailCreationSupported(),"The browser does not support thumbnails creation.");this.logger.fine("Enqueue new item to preview generation");this.queue_.push({item:b,size:a});if(!this.currentItem_){this.processNext_()}};au.upldr.image.PreviewGenerator.createDeferred=function(f,e,b,d){goog.asserts.assert(au.upldr.support.isThumbnailCreationSupported(),"The browser does not support thumbnails creation.");var a=new goog.async.Deferred();var c=au.upldr.image.PreviewGenerator.loadImageDef(f,d);c.addCallback(function(g){a.callback(au.upldr.imaging.CanvasUtil.getImage(f,g,e,b,0,null,au.upldr.image.FitMode.FIT,true,true))});return a};au.upldr.image.PreviewGenerator.prototype.setEnableExifPreview=function(a){this.enableExifPreview_=a};au.upldr.image.PreviewGenerator.prototype.isQueued=function(a){return !!goog.array.find(this.queue_,function(b){return b.item.getGuid()==a.getGuid()},this)};au.upldr.image.PreviewGenerator.prototype.reset=function(){this.currentItem_=null;this.queue_=[]};au.upldr.image.PreviewGenerator.prototype.remove=function(b){if(this.queue_.length==0){return}var c;for(var a=0;a<this.queue_.length;a++){c=(this.queue_[a].item);if(b==c){goog.array.removeAt(this.queue_,a);au.upldr.image.ImageLoader.remove((c.getFile()));if(this.currentItem_.item==b){this.dispatchEvent(au.upldr.events.EventType.COMPLETE);this.currentItem_=null;this.processNext_()}}}};au.upldr.image.PreviewGenerator.loadImageDef=function(d,c){var a=new goog.async.Deferred();var b=d.getFile();if(c&&!!b&&!d.getCropBounds()){au.upldr.image.DataReader.getInstance().getThumbnailFromFileDef(b).addCallback(function(f){if(f){var g=au.upldr.image.getImageSizeDef(b);var e=au.upldr.image.getImageSizeDef(f);var h=new goog.async.DeferredList([g,e]);h.addCallback(function(i){var m=b;var k=i.length==2&&(i[0]&&i[0].length==2&&i[0][0])&&(i[1]&&i[1].length==2&&i[1][0]);if(k){var l=i[0][1],j=i[1][1];if(((l.width-l.height)*(j.width-j.height))>=0){m=f}d.setImageWidth(l.width);d.setImageHeight(l.height)}au.upldr.image.ImageLoader.loadDeferred(m).chainDeferred(a)})}else{au.upldr.image.ImageLoader.loadDeferred(b).chainDeferred(a)}})}else{au.upldr.image.ImageLoader.loadDeferred(b).chainDeferred(a)}return a};au.upldr.image.PreviewGenerator.prototype.processNext_=function(){if(this.currentItem_||this.queue_.length==0){return}this.currentItem_=this.queue_.shift();au.upldr.image.PreviewGenerator.loadImageDef(this.currentItem_.item,this.enableExifPreview_).addCallback(this.imageLoader_loadHandler_.bind(this))};au.upldr.image.PreviewGenerator.prototype.dispatchCompleteChanged_=function(){var a=new goog.events.Event(au.upldr.events.EventType.COMPLETE);a.item=this.currentItem_.item;this.dispatchEvent(a)};au.upldr.image.PreviewGenerator.prototype.drawCanvas=function(b,d){var c=this.currentItem_.size;var a=au.upldr.imaging.CanvasUtil.getImage(this.currentItem_.item,d,c[b].width,c[b].height,0,null,au.upldr.image.FitMode.FIT,true,true);if(b==0){this.currentItem_.item.setTilePreview(a)}else{if(b==1){this.currentItem_.item.setThumbnailPreview(a)}}if(a){goog.dom.classlist.remove(a,au.upldr.ui.ClassNames.CANVAS_EMPTY);if(a.parentElement){goog.dom.classlist.add(a.parentElement,au.upldr.ui.ClassNames.BACKGROUND_EMPTY)}}};au.upldr.image.PreviewGenerator.prototype.imageLoader_loadHandler_=function(b){var a=this.currentItem_;if(a.item.getImageWidth()==0&&a.item.getImageHeight()==0){a.item.setImageWidth(b.width);a.item.setImageHeight(b.height)}a.item.setState(au.upldr.ItemHolder.State.LOADED);this.drawCanvas(0,b);a.item.setState(au.upldr.ItemHolder.State.LOADED);this.drawCanvas(0,b);this.drawCanvas(1,b);this.dispatchEvent(au.upldr.events.EventType.COMPLETE);this.currentItem_=null;this.processNext_()};au.upldr.image.PreviewGenerator.prototype.logger=goog.log.getLogger("au.upldr.image.PreviewGenerator");goog.provide("goog.debug.RelativeTimeProvider");goog.debug.RelativeTimeProvider=function(){this.relativeTimeStart_=goog.now()};goog.debug.RelativeTimeProvider.defaultInstance_=new goog.debug.RelativeTimeProvider();goog.debug.RelativeTimeProvider.prototype.set=function(a){this.relativeTimeStart_=a};goog.debug.RelativeTimeProvider.prototype.reset=function(){this.set(goog.now())};goog.debug.RelativeTimeProvider.prototype.get=function(){return this.relativeTimeStart_};goog.debug.RelativeTimeProvider.getDefaultInstance=function(){return goog.debug.RelativeTimeProvider.defaultInstance_};goog.provide("goog.debug.Formatter");goog.provide("goog.debug.HtmlFormatter");goog.provide("goog.debug.TextFormatter");goog.require("goog.debug");goog.require("goog.debug.Logger");goog.require("goog.debug.RelativeTimeProvider");goog.require("goog.html.SafeHtml");goog.debug.Formatter=function(a){this.prefix_=a||"";this.startTimeProvider_=goog.debug.RelativeTimeProvider.getDefaultInstance()};goog.debug.Formatter.prototype.appendNewline=true;goog.debug.Formatter.prototype.showAbsoluteTime=true;goog.debug.Formatter.prototype.showRelativeTime=true;goog.debug.Formatter.prototype.showLoggerName=true;goog.debug.Formatter.prototype.showExceptionText=false;goog.debug.Formatter.prototype.showSeverityLevel=false;goog.debug.Formatter.prototype.formatRecord=goog.abstractMethod;goog.debug.Formatter.prototype.formatRecordAsHtml=goog.abstractMethod;goog.debug.Formatter.prototype.setStartTimeProvider=function(a){this.startTimeProvider_=a};goog.debug.Formatter.prototype.getStartTimeProvider=function(){return this.startTimeProvider_};goog.debug.Formatter.prototype.resetRelativeTimeStart=function(){this.startTimeProvider_.reset()};goog.debug.Formatter.getDateTimeStamp_=function(b){var a=new Date(b.getMillis());return goog.debug.Formatter.getTwoDigitString_((a.getFullYear()-2000))+goog.debug.Formatter.getTwoDigitString_((a.getMonth()+1))+goog.debug.Formatter.getTwoDigitString_(a.getDate())+" "+goog.debug.Formatter.getTwoDigitString_(a.getHours())+":"+goog.debug.Formatter.getTwoDigitString_(a.getMinutes())+":"+goog.debug.Formatter.getTwoDigitString_(a.getSeconds())+"."+goog.debug.Formatter.getTwoDigitString_(Math.floor(a.getMilliseconds()/10))};goog.debug.Formatter.getTwoDigitString_=function(a){if(a<10){return"0"+a}return String(a)};goog.debug.Formatter.getRelativeTime_=function(f,a){var c=f.getMillis()-a;var d=c/1000;var e=d.toFixed(3);var b=0;if(d<1){b=2}else{while(d<100){b++;d*=10}}while(b-->0){e=" "+e}return e};goog.debug.HtmlFormatter=function(a){goog.debug.Formatter.call(this,a)};goog.inherits(goog.debug.HtmlFormatter,goog.debug.Formatter);goog.debug.HtmlFormatter.prototype.showExceptionText=true;goog.debug.HtmlFormatter.prototype.formatRecord=function(a){if(!a){return""}return this.formatRecordAsHtml(a).getTypedStringValue()};goog.debug.HtmlFormatter.prototype.formatRecordAsHtml=function(g){if(!g){return goog.html.SafeHtml.EMPTY}var f;switch(g.getLevel().value){case goog.debug.Logger.Level.SHOUT.value:f="dbg-sh";break;case goog.debug.Logger.Level.SEVERE.value:f="dbg-sev";break;case goog.debug.Logger.Level.WARNING.value:f="dbg-w";break;case goog.debug.Logger.Level.INFO.value:f="dbg-i";break;case goog.debug.Logger.Level.FINE.value:default:f="dbg-f";break}var h=[];h.push(this.prefix_," ");if(this.showAbsoluteTime){h.push("[",goog.debug.Formatter.getDateTimeStamp_(g),"] ")}if(this.showRelativeTime){h.push("[",goog.debug.Formatter.getRelativeTime_(g,this.startTimeProvider_.get()),"s] ")}if(this.showLoggerName){h.push("[",g.getLoggerName(),"] ")}if(this.showSeverityLevel){h.push("[",g.getLevel().name,"] ")}var b=goog.html.SafeHtml.htmlEscapePreservingNewlinesAndSpaces(h.join(""));var e=goog.html.SafeHtml.EMPTY;if(this.showExceptionText&&g.getException()){e=goog.html.SafeHtml.concat(goog.html.SafeHtml.create("br"),goog.debug.exposeExceptionAsHtml(g.getException()))}var a=goog.html.SafeHtml.htmlEscapePreservingNewlinesAndSpaces(g.getMessage());var c=goog.html.SafeHtml.create("span",{"class":f},goog.html.SafeHtml.concat(a,e));var d;if(this.appendNewline){d=goog.html.SafeHtml.concat(b,c,goog.html.SafeHtml.create("br"))}else{d=goog.html.SafeHtml.concat(b,c)}return d};goog.debug.TextFormatter=function(a){goog.debug.Formatter.call(this,a)};goog.inherits(goog.debug.TextFormatter,goog.debug.Formatter);goog.debug.TextFormatter.prototype.formatRecord=function(b){var d=[];d.push(this.prefix_," ");if(this.showAbsoluteTime){d.push("[",goog.debug.Formatter.getDateTimeStamp_(b),"] ")}if(this.showRelativeTime){d.push("[",goog.debug.Formatter.getRelativeTime_(b,this.startTimeProvider_.get()),"s] ")}if(this.showLoggerName){d.push("[",b.getLoggerName(),"] ")}if(this.showSeverityLevel){d.push("[",b.getLevel().name,"] ")}d.push(b.getMessage());if(this.showExceptionText){var a=b.getException();if(a){var c=a instanceof Error?a.message:a.toString();d.push("\n",c)}}if(this.appendNewline){d.push("\n")}return d.join("")};goog.debug.TextFormatter.prototype.formatRecordAsHtml=function(a){return goog.html.SafeHtml.htmlEscapePreservingNewlinesAndSpaces(goog.debug.TextFormatter.prototype.formatRecord(a))};goog.provide("au.upldr.LogTarget");goog.require("goog.debug.LogManager");goog.require("goog.log.Level");goog.require("goog.debug.TextFormatter");goog.require("goog.events.EventTarget");au.upldr.LogTarget=function(){goog.base(this);this.publishHandler_=goog.bind(this.addLogRecord,this);this.formatter_=new goog.debug.TextFormatter(this.prefix_);this.formatter_.showAbsoluteTime=false;this.formatter_.showExceptionText=true;this.formatter_.showSeverityLevel=true;this.formatter_.showRelativeTime=false;this.formatter_.showLoggerName=false;this.isCapturing_=false};goog.inherits(au.upldr.LogTarget,goog.events.EventTarget);goog.addSingletonGetter(au.upldr.LogTarget);au.upldr.LogTarget.prototype.prefix_="[htmluploader_trace]";au.upldr.LogTarget.prototype.getFormatter=function(){return this.formatter_};au.upldr.LogTarget.prototype.setCapturing=function(a){if(a==this.isCapturing_){return}var b=goog.debug.LogManager.getRoot();if(a){b.addHandler(this.publishHandler_)}else{b.removeHandler(this.publishHandler_)}this.isCapturing_=a};au.upldr.LogTarget.prototype.addLogRecord=function(c){var b=this.formatter_.formatRecord(c);var a=new goog.events.Event(au.upldr.events.EventType.TRACE);a.log=b;this.dispatchEvent(a)};goog.log.getLogger("au.upldr").setLevel(goog.log.Level.INFO);goog.log.logToProfilers=function(a){};goog.provide("au.upldr.ItemHolderCollection");goog.require("goog.array");goog.require("goog.events.EventTarget");goog.require("goog.structs.Collection");goog.require("au.upldr.events.CollectionEvent");goog.require("au.upldr.events.CollectionEventKind");au.upldr.ItemHolderCollection=function(){goog.base(this);this.collection_=[]};goog.inherits(au.upldr.ItemHolderCollection,goog.events.EventTarget);au.upldr.ItemHolderCollection.prototype.add_=function(c,b){if(!goog.array.contains(this.collection_,c)){goog.array.insert(this.collection_,c);if(!b){var a=new au.upldr.events.CollectionEvent(au.upldr.events.CollectionEvent.COLLECTION_CHANGED,au.upldr.events.CollectionEventKind.ADD,[c]);try{this.dispatchEvent(a)}catch(d){}}return true}return false};au.upldr.ItemHolderCollection.prototype.add=function(d){var a=true;var c=this;if(goog.isArray(d)){goog.array.forEach(d,function(e){a&=c.add_(e,true)});var b=new au.upldr.events.CollectionEvent(au.upldr.events.CollectionEvent.COLLECTION_CHANGED,au.upldr.events.CollectionEventKind.ADD_RANGE,[d]);try{this.dispatchEvent(b)}catch(f){}}else{a=c.add_(d)}return a};au.upldr.ItemHolderCollection.prototype.disposeValue=function(a){if(a&&typeof a.disposeInternal=="function"){a.disposeInternal()}};au.upldr.ItemHolderCollection.prototype.remove=function(f){var a=false;if(goog.isArray(f)){var c,d=0;while(c=f[d++]){this.disposeValue(c);a|=goog.array.remove(this.collection_,c)}}else{this.disposeValue(f);a=goog.array.remove(this.collection_,f)}var b=new au.upldr.events.CollectionEvent(au.upldr.events.CollectionEvent.COLLECTION_CHANGED,au.upldr.events.CollectionEventKind.REMOVE,[f]);try{this.dispatchEvent(b)}catch(g){}return a};au.upldr.ItemHolderCollection.prototype.removeAt=function(a){return this.remove(this.getItem(a))};au.upldr.ItemHolderCollection.prototype.getItem=function(a){if(goog.isString(a)){return this.getItemByGuid((a))}return this.collection_[a]};au.upldr.ItemHolderCollection.prototype.getItemByGuid=function(a){return this.collection_[this.getItemIndexByUid(a)]};au.upldr.ItemHolderCollection.prototype.swap=function(b,c){if(b<this.collection_.length&&c>this.collection_.length){var a=this.collection_[b];this.collection_.splice(b,1);this.collection_.splice(c,0,a)}};au.upldr.ItemHolderCollection.prototype.getItemIndex=function(a){return this.getItemIndexByUid(a.getGuid())};au.upldr.ItemHolderCollection.prototype.getItemIndexByUid=function(b){for(var a=0;a<this.collection_.length;a++){if(b==this.collection_[a].getGuid()){return a}}return -1};au.upldr.ItemHolderCollection.prototype.getItemByUid=function(b){for(var a=0;a<this.collection_.length;a++){if(b==goog.getUid(this.collection_[a])){return this.collection_[a]}}return null};au.upldr.ItemHolderCollection.prototype.insertItemAfter=function(f,e){var b=this.getItemByUid(f);var a=this.getItemByUid(e);if(b!=null&&a!=null){var d=goog.array.indexOf(this.collection_,b);var c=goog.array.indexOf(this.collection_,a);this.collection_.splice(d,1);goog.array.insertAt(this.collection_,b,c)}};au.upldr.ItemHolderCollection.prototype.insertItemBefore=function(e,d){var b=this.getItemByUid(e);var a=this.getItemByUid(d);if(b!=null&&a!=null){var c=goog.array.indexOf(this.collection_,b);this.collection_.splice(c,1);goog.array.insertBefore(this.collection_,b,a)}};au.upldr.ItemHolderCollection.prototype.clear=function(){if(this.collection_.length>0){this.collection_=[];var a=new au.upldr.events.CollectionEvent(au.upldr.events.CollectionEvent.COLLECTION_CHANGED,au.upldr.events.CollectionEventKind.RESET,[]);try{this.dispatchEvent(a)}catch(b){}}};au.upldr.ItemHolderCollection.prototype.contains=function(a){return goog.array.contains(this.collection_,a)};au.upldr.ItemHolderCollection.prototype.forEach=function(a,b){goog.array.forEach(this.collection_,function(d,c,e){a.call(b,d,c,this)},this)};au.upldr.ItemHolderCollection.prototype.getCount=function(){return this.collection_.length};au.upldr.ItemHolderCollection.prototype.toArray=function(){return this.collection_.slice()};goog.provide("au.upldr.PropertyHolder");goog.require("goog.array");goog.require("goog.log");goog.require("goog.events");goog.require("goog.events.EventTarget");au.upldr.PropertyHolder=function(){goog.base(this)};goog.inherits(au.upldr.PropertyHolder,goog.events.EventTarget);au.upldr.PropertyHolder.prototype.getProperty=function(a){return this.getProperty_(a)};au.upldr.PropertyHolder.prototype.setProperty=function(a,b){this.setProperty_(a,b)};au.upldr.PropertyHolder.prototype.observe=function(b,c,a){return(goog.events.listen(this,this.getPropertyChangedEventName(b),c,false,a))};au.upldr.PropertyHolder.prototype.unObserve=function(b,c,a){return !!goog.events.unlisten(this,this.getPropertyChangedEventName(b),c,false,a)};au.upldr.PropertyHolder.prototype.getProperty_=function(a){return this[this.getPrivateFieldName(a)]};au.upldr.PropertyHolder.prototype.setProperty_=function(a,b){var d=this.getPrivateFieldName(a);var c=this[d];if(b!==c){this[d]=b;this.dispatchEvent(this.getPropertyChangedEventName(a))}};au.upldr.PropertyHolder.prototype.getPropertyChangedEventName=function(a){return a+"Changed"};au.upldr.PropertyHolder.prototype.getPrivateFieldName=function(a){return a+"_"};au.upldr.PropertyHolder.prototype.logger=goog.log.getLogger("au.upldr.PropertyHolder");goog.provide("au.upldr.Converters");goog.require("goog.array");goog.require("goog.log");goog.require("au.upldr.upload.Converter");au.upldr.Converters=function(){this.items_=[]};au.upldr.Converters.prototype.add=function(d){var g=this.items_.length;if(!(d instanceof au.upldr.upload.Converter)){if(!d){d={}}else{if(goog.isString(d)){d={mode:d}}}var f=(d.mode||"*.*=SourceFile");var c=(d.thumbnailWidth);var j=(d.thumbnailHeight);var e=(d.thumbnailFitMode);var k=(d.thumbnailBgColor);var i=(d.thumbnailJpegQuality);var l=(d.thumbnailCopyExif);var a=(d.thumbnailWatermark?new au.upldr.imaging.watermark.WatermarkConfig(d.thumbnailWatermark):null);var h=(d.thumbnailApplyCrop);var b=(d.thumbnailApplyDrawTool);d=new au.upldr.upload.Converter(g,f,c,j,e,k,i,l,a,h,b)}this.items_.push(d);return g};au.upldr.Converters.prototype.removeAt=function(a){if(this.items_.length>a){return goog.array.removeAt(this.items_,a)}else{return false}};au.upldr.Converters.prototype.getItem=function(a){return this.items_[a]};au.upldr.Converters.prototype.getCount=function(){return this.items_.length};au.upldr.Converters.prototype.toArray=function(){return this.items_.slice()};au.upldr.Converters.prototype.logger=goog.log.getLogger("au.upldr.Converters");goog.provide("au.upldr.BaseUploader");goog.require("goog.events");goog.require("goog.events.EventHandler");goog.require("goog.ui.IdGenerator");goog.require("goog.array");goog.require("goog.object");goog.require("goog.positioning.AnchoredViewportPosition");goog.require("goog.format");goog.require("goog.async.Deferred");goog.require("goog.async.DeferredList");goog.require("goog.object");goog.require("goog.dom.classlist");goog.require("goog.debug.ErrorHandler");goog.require("au.upldr.ObservableCollection");goog.require("au.upldr.ItemHolderCollection");goog.require("au.upldr.ItemHolder");goog.require("au.upldr.events.EventType");goog.require("au.upldr.ui.Uploader");goog.require("au.upldr.ui.FileDialog");goog.require("au.upldr.PropertyHolder");goog.require("au.upldr.Properties");goog.require("au.upldr.DefaultValues");goog.require("au.upldr.InternalDefaultValues");goog.require("au.upldr.events.CollectionEvent");goog.require("au.upldr.UploadProgress.Stage");goog.require("au.upldr.image.PreviewGenerator");goog.require("au.upldr.upload.Packager");goog.require("au.upldr.upload.UploadManager");goog.require("au.upldr.upload.Converter");goog.require("au.upldr.ItemHolderInitializer");goog.require("au.upldr.ItemHolderInitializer.EventType");goog.require("au.upldr.RestrictionVerifier");goog.require("au.upldr.VerifyCode");goog.require("au.upldr.RestrictionErrorCodes");goog.require("au.upldr.errorHelper");goog.require("au.upldr.ErrorCodes");goog.require("au.upldr.utils");goog.require("au.upldr.Converters");goog.require("au.upldr.LogTarget");goog.require("au.upldr.support");goog.require("au.upldr.validate");goog.require("au.upldr.exif.ExifIO");goog.require("au.upldr.upload.Fields");goog.require("au.upldr.ViewMode");goog.require("au.upldr.ui.ClassNames");var AU_MAX_ERROR_MSG_COUNT=4;au.upldr.BaseUploader=function(a){goog.base(this);this.handler_=new goog.events.EventHandler(this);this.initLogger_();if(!au.upldr.support.isHtmlUploaderSupported()){var c="HTML5 Uploader is not supported in this browser.";this.logger.warning(c);window.alert(c)}var b=goog.object.clone(au.upldr.DefaultValues);if(goog.isObject(a)){goog.object.extend(b,a)}this.items_=new au.upldr.ItemHolderCollection();this.ui_=new au.upldr.ui.Uploader(this);this.propertyHolder_=new au.upldr.PropertyHolder();this.uploadManager_;this.converters_=new au.upldr.Converters();this.notificationCollection_=new au.upldr.ObservableCollection();this.initializer_=new au.upldr.ItemHolderInitializer();this.handler_.listen(this.initializer_,au.upldr.ItemHolderInitializer.EventType.INITIALIZED,this.initializer_initializedHandler_).listen(this.initializer_,au.upldr.ItemHolderInitializer.EventType.COMPLETE,this.initializer_completeHandler_).listen(this.initializer_,au.upldr.ItemHolderInitializer.EventType.FILE_SKIPPED,this.initializer_fileSkippedHandler_).listen(this.initializer_,au.upldr.events.EventType.INIT_FILE,this.initFilesHandler_);this.skippedFileCount_;this.skipedFileMessages_;this.customFields_={};this.rendered_;this.itemsToCreatePreview_={};this.renderedItems_={};this.addingFiles_=false;this.initializeProperties_(b);this.previewGenerator_=au.upldr.image.PreviewGenerator.getInstance();this.previewGenerator_.setEnableExifPreview((this.propertyHolder_.getProperty(au.upldr.Properties.ENABLE_EXIF_PREVIEW)));this.propertyHolder_.observe(au.upldr.Properties.ENABLE_EXIF_PREVIEW,function(){this.previewGenerator_.setEnableExifPreview((this.propertyHolder_.getProperty(au.upldr.Properties.ENABLE_EXIF_PREVIEW)))},this);this.handler_.listen(this.previewGenerator_,au.upldr.events.EventType.COMPLETE,function(d){if(d.item){this.renderedItems_[d.item.getGuid()]=1;delete this.itemsToCreatePreview_[d.item.getGuid()]}}.bind(this));this.handler_.listen(this,au.upldr.events.EventType.INIT_COMPLETE,this.initViewModeObserver_.bind(this));this.handler_.listen(this,au.upldr.events.EventType.INIT_COMPLETE,function(){this.handler_.listen(this.ui_.getProgressDialog(),au.upldr.ui.ProgressDialog.EventType.CANCEL,this.cancelAddFiles_)}.bind(this));this.viewModeObserving_=false;this.handler_.listen(this,[au.upldr.events.EventType.UPLOAD_LIST_SCROLL,au.upldr.events.EventType.UPLOAD_LIST_CHANGED],goog.bind(this.generatePriviewForVisibleItems_,this));this.handler_.listen(this,au.upldr.events.EventType.FILE_COUNT_CHANGE,goog.bind(this.onFileCountChangeInternal_,this))};goog.inherits(au.upldr.BaseUploader,goog.events.EventTarget);au.upldr.BaseUploader.prototype.getUi=function(){return this.ui_};au.upldr.BaseUploader.prototype.isAddingFiles=function(){return this.addingFiles_};au.upldr.BaseUploader.prototype.setAddingFiles=function(a){this.addingFiles_=a};au.upldr.BaseUploader.prototype.getFileList=function(){var a=this.ui_.getChildAt(2);return a==null?null:(a.getList())};au.upldr.BaseUploader.prototype.addFiles=function(a){this.beforeAddFiles_();this.fileDialog_.open(a)};au.upldr.BaseUploader.prototype.dispatchFileCountEvent_=function(b){var a=new goog.events.Event(au.upldr.events.EventType.FILE_COUNT_CHANGE);a.cause=b;this.dispatchEvent(a)};au.upldr.BaseUploader.prototype.dispatchAddingFilesEvent_=function(){var a=new goog.events.Event(au.upldr.events.EventType.ADDING_FILES);this.dispatchEvent(a)};au.upldr.BaseUploader.prototype.dispatchSelectionChangeEvent_=function(a){var b=new goog.events.Event(au.upldr.events.EventType.SELECTION_CHANGE);b.select=a;this.dispatchEvent(b)};au.upldr.BaseUploader.prototype.onFileCountChangeInternal_=function(c){var b=this.items_.getCount();var d=(this.propertyHolder_.getProperty(au.upldr.Properties.RESTRICTIONS_MAX_FILE_COUNT));var a=b==d&&b!=0;this.propertyHolder_.setProperty(au.upldr.Properties.IS_VISIBLE_ADDING_FILES,!a)};au.upldr.BaseUploader.prototype.beforeAddFiles_=function(){var c=this.items_.getCount();var d=(this.propertyHolder_.getProperty(au.upldr.Properties.RESTRICTIONS_MAX_FILE_COUNT));var a=d-c;var b=!(a==1);this.fileDialog_.toggleMultiple(b)};au.upldr.BaseUploader.prototype.removeItemsPreviewMeta_=function(b){if(b){var a=b.getGuid();if(!goog.object.isEmpty(this.itemsToCreatePreview_)&&this.itemsToCreatePreview_[a]){delete this.itemsToCreatePreview_[a]}if(!goog.object.isEmpty(this.renderedItems_)&&this.renderedItems_[a]){delete this.renderedItems_[a]}this.previewGenerator_.remove(b)}};au.upldr.BaseUploader.prototype.removeFile=function(d){var a=true;var b=this;if(goog.isArray(d)){var c=goog.array.map(d,function(e){return b.items_.getItem(e)});goog.array.forEach(c,function(e){b.removeItemsPreviewMeta_(e);a&=b.removeFile_(e.getGuid())})}else{if(goog.isNumber(d)||goog.isString(d)){b.removeItemsPreviewMeta_(b.items_.getItem(d));a=b.removeFile_(d)}else{a=false}}this.createPreview_();this.dispatchFileCountEvent_(au.upldr.events.CollectionEventKind.REMOVE);return a};au.upldr.BaseUploader.prototype.removeFile_=function(a){this.logger.fine("Remove file at "+a+" position");var c=this.items_.removeAt(a);var b=this.items_.getCount();if(c){if(b>0){this.setState(au.upldr.UploaderState.READY)}else{this.setState(au.upldr.UploaderState.IDLE)}}return c};au.upldr.BaseUploader.prototype.removeAllFiles=function(){this.initializer_.reset();this.itemsToCreatePreview_={};var a=this.getFileList();if(a!=null){a.stopRender()}this.items_.clear();this.previewGenerator_.reset();this.setState(au.upldr.UploaderState.IDLE);this.dispatchFileCountEvent_(au.upldr.events.CollectionEventKind.RESET);this.dispatchSelectionChangeEvent_(false)};au.upldr.BaseUploader.prototype.getPropertyHolder=function(){return this.propertyHolder_};au.upldr.BaseUploader.prototype.getNotificationCollection=function(){return this.notificationCollection_};au.upldr.BaseUploader.prototype.showDescriptionEditor=function(b,c){var a=this.ui_.getDescriptionEditor();if(c){a.show(b.getModel(),b.getToolbar().getElement())}else{a.hide()}};au.upldr.BaseUploader.prototype.showImageEditor=function(b,c){var a=this.ui_.getImageEditor();if(b&&typeof c!="undefined"){if(c){a.setItem(b);a.show()}else{a.hide()}}};au.upldr.BaseUploader.prototype.showImageEditorById=function(a){this.showImageEditor(this.getItems().getItem(a),true)};au.upldr.BaseUploader.prototype.showImagePreview=function(a,c){var b=this.ui_.getImagePreview();if(c){b.show(a)}else{b.hide()}};au.upldr.BaseUploader.prototype.render=function(a){if(!au.upldr.support.isHtmlUploaderSupported()){var c="HTML5 Uploader is not supported in this browser.";this.logger.warning(c);return}if(this.rendered_){au.upldr.utils.error("Uploader already rendered")}this.ui_.render(a);this.handler_.listen(this.ui_,au.upldr.events.EventType.ADD_FILE,this.addFilesFromEvent_);this.handler_.listen(this.ui_,au.upldr.events.EventType.INIT_FILE,this.initFilesHandler_);this.handler_.listen(this.ui_,au.upldr.events.EventType.DND_FOLDER_FILE_LIMIT,this.dndFolderLimitHandler_);this.handler_.listen(this.getFileList(),goog.events.EventType.SELECT,function(d){this.dispatchSelectionChangeEvent_(d.select)}.bind(this));var b=au.upldr.RestrictionVerifier.parseFileMask((this.propertyHolder_.getProperty(au.upldr.Properties.RESTRICTIONS_FILE_MASK)));this.fileDialog_=new au.upldr.ui.FileDialog(a,b);this.handler_.listen(this.fileDialog_,au.upldr.events.EventType.ADD_FILE,this.addFilesFromEvent_);this.handler_.listen(this.ui_.getImageEditor(),au.upldr.imaging.imageEditor.ImageEditorDialog.EventType.CLOSE,function(d){d.type=au.upldr.events.EventType.IMAGE_EDITOR_CLOSE;this.dispatchEvent(d)});this.rendered_=true;this.logger.info("Version: "+au.upldr.VERSION+"; Build date: "+au.upldr.BUILD_DATE);au.upldr.utils.setTimeout(this.dispatchInitCompleteEvent_,0,this)};au.upldr.BaseUploader.prototype.dispatchInitCompleteEvent_=function(){try{this.dispatchEvent(au.upldr.events.EventType.INIT_COMPLETE)}catch(a){this.logger.warning('Error in "'+au.upldr.events.EventType.INIT_COMPLETE+'" event: '+a.message)}};au.upldr.BaseUploader.prototype.addFilesAsFile=function(a){this.logger.fine("Adding files...");this.setAddingFiles(true);this.dispatchAddingFilesEvent_();var b=(goog.array.map(a,function(c){if(c instanceof File||c instanceof Blob){return new au.upldr.upload.ExtendedFile(c)}else{if(c instanceof au.upldr.upload.ExtendedFile){return c}else{return null}}}));b=(goog.array.filter(b,function(c){return !!c}));this.addFilesInternal(b);this.setAddingFiles(false)};au.upldr.BaseUploader.prototype.addFilesAsBase64=function(b){var g,a,d,c,e;var f=(goog.array.map(b,function(h){if(h.length==2){c=h[0];a=h[1];e=au.upldr.utils.getExt(c);e=e==""?"*.*":"*."+e;g=au.upldr.utils.mimeMapping.getMimeMapping(e);d=au.upldr.utils.fileUtils.base64ToBlob(a,g);return new au.upldr.upload.ExtendedFile(d,"",c)}else{return null}}));if(f){this.addFilesAsFile(f)}};au.upldr.BaseUploader.prototype.addFilesAsBlob=function(a){var b,c;var d=(goog.array.map(a,function(e){if(e.length==2){c=(e[0]);b=(e[1]);return new au.upldr.upload.ExtendedFile(b,"",c)}else{return null}}));this.addFilesAsFile(d)};au.upldr.BaseUploader.prototype.addFilesFromEvent_=function(a){if(a.getFiles()){this.addFilesAsFile(a.getFiles())}};au.upldr.BaseUploader.prototype.initFilesHandler_=function(a){this.progressDialogChangeState(a.currentIndex,a.totalCount)};au.upldr.BaseUploader.prototype.dndFolderLimitHandler_=function(b){this.skipedFileMessages_=this.skipedFileMessages_||[];var a=au.upldr.utils.format((this.propertyHolder_.getProperty(au.upldr.Properties.DND_FOLDER_FILE_LIMIT_EXCEEDED_MSG)),(b.folderName));this.skipedFileMessages_.push(a);this.dispatchRestrictionFailedEvent_(au.upldr.VerifyCode.DND_FOLDER_FILE_LIMIT)};au.upldr.BaseUploader.prototype.progressDialogChangeState=function(b,a){if(b==0&&a==0){this.ui_.getProgressDialog().setMaximum(100);this.ui_.getProgressDialog().setValue(0);this.ui_.getProgressDialog().show();this.ui_.getProgressDialog().toggleInfinitLoader(true)}else{if(b==a){this.ui_.getProgressDialog().setMaximum(0);this.ui_.getProgressDialog().setValue(0);this.ui_.getProgressDialog().hide()}else{this.ui_.getProgressDialog().setMaximum(a);this.ui_.getProgressDialog().setValue(b);this.ui_.getProgressDialog().show();this.ui_.getProgressDialog().toggleInfinitLoader(false)}}};au.upldr.BaseUploader.prototype.cancelAddFiles_=function(){this.ui_.getUploadPane().cancel();this.initializer_.reset()};au.upldr.BaseUploader.prototype.addFilesInternal=function(g){if(g.length>0){var c=this.items_;var f=c.getCount();var e=0;for(var d=0;d<f;++d){e+=c.getItem(d).getSize()}this.skippedFileCount_=0;this.skipedFileMessages_=this.skipedFileMessages_||[];var b=this.propertyHolder_;var a=new au.upldr.RestrictionVerifier((b.getProperty(au.upldr.Properties.RESTRICTIONS_FILE_MASK)),(b.getProperty(au.upldr.Properties.RESTRICTIONS_DENIED_FILE_MASK)),(b.getProperty(au.upldr.Properties.RESTRICTIONS_MAX_FILE_COUNT)),(b.getProperty(au.upldr.Properties.RESTRICTIONS_MAX_TOTAL_FILE_SIZE)),(b.getProperty(au.upldr.Properties.RESTRICTIONS_MAX_FILE_SIZE)),(b.getProperty(au.upldr.Properties.RESTRICTIONS_MIN_FILE_SIZE)),(b.getProperty(au.upldr.Properties.RESTRICTIONS_MAX_IMAGE_WIDTH)),(b.getProperty(au.upldr.Properties.RESTRICTIONS_MIN_IMAGE_WIDTH)),(b.getProperty(au.upldr.Properties.RESTRICTIONS_MAX_IMAGE_HEIGHT)),(b.getProperty(au.upldr.Properties.RESTRICTIONS_MIN_IMAGE_HEIGHT)));this.initializer_.initialize(g,f,e,a,this.getEnableAutoRotation())}else{this.initializer_.dispatchCompleteEvent()}};au.upldr.BaseUploader.prototype.initLogger_=function(){var a=au.upldr.LogTarget.getInstance();a.setCapturing(true);this.handler_.listen(a,au.upldr.events.EventType.TRACE,this.logger_traceHandler_)};au.upldr.BaseUploader.prototype.logger_traceHandler_=function(c){var a=new goog.events.Event(au.upldr.events.EventType.TRACE);a.log=c.log;try{this.dispatchEvent(a)}catch(b){}};au.upldr.BaseUploader.prototype.initItemsToCreatePreview=function(a){this.itemsToCreatePreview_=this.itemsToCreatePreview_||{};for(var c=0,b=a.length;c<b;++c){var d=a[c];if(d.isImage()&&!this.itemsToCreatePreview_.hasOwnProperty(d.getGuid())){this.itemsToCreatePreview_[d.getGuid()]=1}}};au.upldr.BaseUploader.prototype.getItemsToShow_=function(){var g=this.getPreviewedItemIndexes();var d=[];var b=this.items_.toArray();var f=[];var e=[];var c;for(c in this.renderedItems_){if(this.renderedItems_.hasOwnProperty(c)){f.push(goog.array.find(b,function(h){return h.getGuid()==c},this))}}for(c in this.itemsToCreatePreview_){if(this.itemsToCreatePreview_.hasOwnProperty(c)){e.push(goog.array.find(b,function(h){return h.getGuid()==c},this))}}var a=goog.array.map(goog.array.join(f,e),function(h){return b.indexOf(h)},this);if(a.length==0){d=g}else{d=goog.array.filter(g,function(h){return a.indexOf(h)<0},this)}return goog.array.map(d,function(h){return b[h]},this)};au.upldr.BaseUploader.prototype.initializer_initializedHandler_=function(b){var a=(b.items);this.items_.add(a);this.setState(this.items_.getCount()>0?au.upldr.UploaderState.READY:au.upldr.UploaderState.IDLE)};au.upldr.BaseUploader.prototype.getTilePreviewSize_=function(){var a=(this.propertyHolder_.getProperty(au.upldr.Properties.UPLOAD_PANE_TILE_PREVIEW_SIZE));return{width:a,height:a}};au.upldr.BaseUploader.prototype.getThumbnailPreviewSize_=function(){var a=(this.propertyHolder_.getProperty(au.upldr.Properties.UPLOAD_PANE_THUMBNAIL_PREVIEW_SIZE));return{width:a,height:a}};au.upldr.BaseUploader.prototype.initializer_fileSkippedHandler_=function(g){var j=(g.item);var b=(g.code);var i=(g.totalCount);this.logger.fine('File "'+j.getName()+'" skipped ('+b+")");this.skippedFileCount_++;var f,h=-1;var c=j.getName();var d=this.propertyHolder_;var a=au.upldr.Properties;switch(b){case au.upldr.VerifyCode.FILE_MASK:f=au.upldr.utils.format((d.getProperty(a.FILE_NAME_NOT_ALLOWED_MSG)),c);h=au.upldr.RestrictionErrorCodes.SELECTED_FILE_HAS_NOT_ALLOWED_NAME;break;case au.upldr.VerifyCode.MAX_FILE_COUNT:f=au.upldr.utils.format((d.getProperty(a.TOO_MANY_FILES_MSG)),(d.getProperty(a.RESTRICTIONS_MAX_FILE_COUNT)));h=au.upldr.RestrictionErrorCodes.NUMBER_OF_SELECTED_FILES_EXCEEDS_MAX_FILE_COUNT;break;case au.upldr.VerifyCode.MAX_TOTAL_FILE_SIZE:f=au.upldr.utils.format((d.getProperty(a.MAX_TOTAL_FILE_SIZE_EXCEEDED_MSG)),goog.format.numBytesToString((d.getProperty(a.RESTRICTIONS_MAX_TOTAL_FILE_SIZE)),0));h=au.upldr.RestrictionErrorCodes.TOTAL_SIZE_OF_SELECTED_FILES_EXCEEDS_MAX_TOTAL_FILE_SIZE;break;case au.upldr.VerifyCode.MAX_FILE_SIZE:f=au.upldr.utils.format((d.getProperty(a.FILE_SIZE_TOO_LARGE_MSG)),c,goog.format.numBytesToString((d.getProperty(a.RESTRICTIONS_MAX_FILE_SIZE)),0));h=au.upldr.RestrictionErrorCodes.SIZE_OF_SELECTED_FILE_EXCEEDS_MAX_FILE_SIZE;break;case au.upldr.VerifyCode.MIN_FILE_SIZE:f=au.upldr.utils.format((d.getProperty(a.FILE_SIZE_TOO_SMALL_MSG)),c,goog.format.numBytesToString((d.getProperty(a.RESTRICTIONS_MIN_FILE_SIZE)),0));h=au.upldr.RestrictionErrorCodes.SIZE_OF_SELECTED_FILES_LESS_THEN_MIN_FILE_SIZE;break;case au.upldr.VerifyCode.MAX_IMAGE_HEIGHT:case au.upldr.VerifyCode.MAX_IMAGE_WIDTH:f=au.upldr.utils.format((d.getProperty(a.DIMENSIONS_TOO_LARGE_MSG)),c,(d.getProperty(a.RESTRICTIONS_MAX_IMAGE_WIDTH)),(d.getProperty(a.RESTRICTIONS_MAX_IMAGE_HEIGHT)));h=au.upldr.RestrictionErrorCodes.IMAGE_DIMENSIONS_ARE_TOO_LARGE;break;case au.upldr.VerifyCode.MIN_IMAGE_HEIGHT:case au.upldr.VerifyCode.MIN_IMAGE_WIDTH:f=au.upldr.utils.format((d.getProperty(a.DIMENSIONS_TOO_SMALL_MSG)),c,(d.getProperty(a.RESTRICTIONS_MIN_IMAGE_WIDTH)),(d.getProperty(a.RESTRICTIONS_MIN_IMAGE_HEIGHT)));h=au.upldr.RestrictionErrorCodes.IMAGE_DIMENSIONS_ARE_TOO_SMALL;break}this.progressDialogChangeState(this.ui_.getProgressDialog().getValue()+1,i-1);if(f){this.skipedFileMessages_.push(f)}if(h>-1){this.dispatchRestrictionFailedEvent_(h)}};au.upldr.BaseUploader.prototype.dispatchRestrictionFailedEvent_=function(c){var a=new goog.events.Event(au.upldr.events.EventType.RESTRICTION_FAILED);a.code=c;try{this.dispatchEvent(a)}catch(b){this.logger.warning('Error in "'+au.upldr.events.EventType.RESTRICTION_FAILED+'" event: '+b.message)}};au.upldr.BaseUploader.prototype.initializer_completeHandler_=function(d){this.logger.fine("Files added.");var c=this.skipedFileMessages_||[];for(var b=0,a=c.length;b<a;++b){this.showInformationBar(c[b])}this.skipedFileMessages_=[];this.skippedFileCount_=0;this.dispatchFileCountEvent_(au.upldr.events.CollectionEventKind.ADD);this.instantUpload_();this.ui_.getProgressDialog().hide()};au.upldr.BaseUploader.prototype.instantUpload_=function(){if(this.propertyHolder_.getProperty(au.upldr.Properties.INSTANT_UPLOAD)&&this.getState()!=au.upldr.UploaderState.UPLOADING){this.upload()}};au.upldr.BaseUploader.prototype.createPreview_=function(){var g=this.propertyHolder_.getProperty(au.upldr.Properties.VIEW_MODE);if(g==au.upldr.ViewMode.ICONS){return}if(!au.upldr.support.isBlobUrlSupported()){this.itemsToCreatePreview_={};this.logger.warning("The browser doesn't support Blob URI. Preview wouldn't be created.");return}this.clearInvisiblePreview();var b=this.getItemsToShow_();if(b.length==0){return}this.initItemsToCreatePreview(b);var f=this.getTilePreviewSize_();var e=this.getThumbnailPreviewSize_();var d;var a=this;for(var c=0;c<b.length;c++){d=b[c];if(d){d.setCanAutoRotate(this.getEnableAutoRotation());if(this.itemsToCreatePreview_[d.getGuid()]){d.updateAngleFromExif().addCallback(function(h){a.previewGenerator_.create(h,[f,e]);h.observe(function(i){if(i.getPropertyName()==au.upldr.ItemHolder.Properties.CROP_BOUNDS){a.previewGenerator_.create(h,[f,e])}})})}}}};au.upldr.BaseUploader.prototype.initViewModeObserver_=function(){var a=this;if(!a.viewModeObserving_){a.propertyHolder_.observe(au.upldr.Properties.VIEW_MODE,a.createPreview_.bind(a));this.viewModeObserving_=true;this.createPreview_()}};au.upldr.BaseUploader.prototype.clearInvisiblePreview=function(){var c=this.items_;var d=this.getPreviewedItemIndexes();var b=d[0];var g=d[d.length-1]+1;var f,e,a;for(e=0,a=b;e<a;e++){f=c.getItem(e);if(f){f.clearPreview();this.removeItemsPreviewMeta_(f)}}for(e=g,a=c.getCount();e<a;e++){f=c.getItem(e);if(f){f.clearPreview();this.removeItemsPreviewMeta_(f)}}};au.upldr.BaseUploader.prototype.generatePriviewForVisibleItems_=function(a){window.setTimeout(function(){this.createPreview_.bind(this)()}.bind(this),0)};au.upldr.BaseUploader.prototype.getPreviewedItemIndexes=function(){var a=this.getFileList();return a==null?[]:a.getShownNodeIndexes()};au.upldr.BaseUploader.prototype.getItems=function(){return this.items_};au.upldr.BaseUploader.prototype.initializeProperties_=function(a){var b=this.propertyHolder_;goog.object.forEach(au.upldr.InternalDefaultValues,function(e,c,d){this.setProperty(c,e)},b);goog.array.forEach(goog.object.getValues(au.upldr.Properties),function(e,d,c){this["set"+e](a[e])},this)};au.upldr.BaseUploader.prototype.getState=function(){return(this.propertyHolder_.getProperty(au.upldr.InternalProperties.UPLOADER_STATE))};au.upldr.BaseUploader.prototype.setState=function(a){this.propertyHolder_.setProperty(au.upldr.InternalProperties.UPLOADER_STATE,a)};au.upldr.BaseUploader.prototype.disposeInternal=function(){goog.base(this,"disposeInternal");this.ui_.dispose();delete this.ui_;if(this.fileDialog_){this.fileDialog_.dispose();delete this.fileDialog_}this.propertyHolder_.dispose();delete this.propertyHolder_;this.items_.forEach(function(a){a.dispose()});delete this.items_;this.disposeUploadManager_()};au.upldr.BaseUploader.prototype.upload=function(){if(this.getState()!=au.upldr.UploaderState.UPLOADING){var h=this.getFileList();if(h!=null){h.pauseRender()}if(!this.checkMinFileCount_()){var d=(this.propertyHolder_.getProperty(au.upldr.Properties.TOO_FEW_FILES_MSG));d=au.upldr.utils.format(d,(this.propertyHolder_.getProperty(au.upldr.Properties.RESTRICTIONS_MIN_FILE_COUNT)));this.showInformationBar(d);this.dispatchErrorEvent_(au.upldr.ErrorCodes.NUMBER_OF_SELECTED_FILES_LESS_THEN_ALLOWED,-1,"",d);return}this.logger.fine("Dispatch BeforeUpload event");var g;try{g=this.dispatchEvent(au.upldr.events.EventType.BEFORE_UPLOAD)}catch(f){this.logger.warning('Error in "'+au.upldr.events.EventType.BEFORE_UPLOAD+'" event: '+f.message)}if(g){this.logger.fine("Start upload");this.setState(au.upldr.UploaderState.UPLOADING);this.updateProgress_(au.upldr.UploadProgress.Stage.START,0,0,this.getItems().getCount(),0,0);var b=(this.propertyHolder_.getProperty(au.upldr.Properties.ENABLE_ALL_STANDART_FIELDS));var a=this.uploadManager_=new au.upldr.upload.UploadManager(undefined,undefined,(this.propertyHolder_.getProperty(au.upldr.Properties.PROGRESS_BYTES_MODE)),b);this.configureUploadManagerListeners_(a);var e=(this.propertyHolder_.getProperty(au.upldr.Properties.ACTION_URL));if(b){this.addCustomField(au.upldr.upload.Fields.CONTROL_ID,this.propertyHolder_.getProperty(au.upldr.Properties.ID))}var c=this.getItems().toArray();if(c.length==0){c.push(new au.upldr.ItemHolder(null))}a.startUpload(c,this.converters_.toArray(),e,this.customFields_,this.parseExifTags_(),(this.propertyHolder_.getProperty(au.upldr.Properties.FILE_NAMES_URL_ENCODED)))}}};au.upldr.BaseUploader.prototype.parseExifTags_=function(){var b=this.getExtractExif();if(goog.isDefAndNotNull(b)&&b!=""&&b.length>2){var a=this.getMetadataValueSeparator();return b.split(a)}else{return[]}};au.upldr.BaseUploader.prototype.checkMinFileCount_=function(){var b=this.items_.getCount();var a=(this.propertyHolder_.getProperty(au.upldr.Properties.RESTRICTIONS_MIN_FILE_COUNT));return b>=a};au.upldr.BaseUploader.prototype.configureUploadManagerListeners_=function(a){this.handler_.listen(a,au.upldr.events.EventType.BEFORE_PACKAGE_UPLOAD,this.uploadManager_beforePackageUploadHandler_).listen(a,au.upldr.events.EventType.AFTER_PACKAGE_UPLOAD,this.uploadManager_afterPackageUploadHandler_).listen(a,au.upldr.events.EventType.COMPLETE,this.uploadManager_completeHandler_).listen(a,au.upldr.events.EventType.PROGRESS,this.uploadManager_progressHandler_).listen(a,au.upldr.events.EventType.ERROR,this.uploadManager_errorHandler_)};au.upldr.BaseUploader.prototype.uploadManager_beforePackageUploadHandler_=function(c){this.logger.fine("BeforePackageUpload event: "+c.packageIndex);var a=new goog.events.Event(au.upldr.events.EventType.BEFORE_PACKAGE_UPLOAD);a.index=c.packageIndex;try{this.dispatchEvent(a)}catch(b){this.logger.warning('Error in "'+au.upldr.events.EventType.BEFORE_PACKAGE_UPLOAD+'" event: '+b.message)}};au.upldr.BaseUploader.prototype.uploadManager_afterPackageUploadHandler_=function(d){this.logger.fine("AfterPackageUpload event: "+d.packageIndex+", httpStatus: "+d.httpStatus);var a=new goog.events.Event(au.upldr.events.EventType.AFTER_PACKAGE_UPLOAD);a.index=d.packageIndex;a.response=d.response;var f;try{f=!this.dispatchEvent(a)}catch(c){this.logger.warning('Error in "'+au.upldr.events.EventType.AFTER_PACKAGE_UPLOAD+'" event: '+c.message)}if(f){if(this.cancelUploadInternal()){var b=(this.propertyHolder_.getProperty(au.upldr.Properties.UPLOAD_CANCELLED_FROM_AFTER_PACKAGE_UPLOAD_EVENT_METHOD_MSG));this.dispatchErrorEvent_(au.upldr.ErrorCodes.UPLOAD_ABORTED_BY_PACKAGE_COMPLETE_EVENT_HANDLER,-1,"",b)}}else{this.getItems().removeAt(0)}};au.upldr.BaseUploader.prototype.uploadManager_completeHandler_=function(c){this.logger.fine("Upload complete: { httpStatus: "+c.httpStatus+', response: "'+c.response+'", errorMessage: "'+c.errorMessage+'" }');this.disposeUploadManager_();this.setState(this.getItems().getCount()>0?au.upldr.UploaderState.READY:au.upldr.UploaderState.IDLE);this.propertyHolder_.setProperty(au.upldr.Properties.IS_VISIBLE_ADDING_FILES,true);au.upldr.image.ImageLoader.reset();var a=new goog.events.Event(au.upldr.events.EventType.AFTER_UPLOAD);a.response=c.response;try{this.dispatchEvent(a)}catch(b){this.logger.warning('Error in "'+au.upldr.events.EventType.AFTER_UPLOAD+'" event: '+b.message)}};au.upldr.BaseUploader.prototype.uploadManager_progressHandler_=function(b){var a=(b.state);this.updateProgress_(a.stage,a.percent,a.loadedFiles,a.totalFiles,a.loadedBytes,a.totalBytes);this.dispatchProgressEvent_(a.percent,a.loadedFiles,a.totalFiles,a.loadedBytes,a.totalBytes)};au.upldr.BaseUploader.prototype.dispatchProgressEvent_=function(f,a,c,e,g){var b=new goog.events.Event(au.upldr.events.EventType.PROGRESS);b.percent=f;b.uploadedFiles=a;b.totalFiles=c;b.uploadedBytes=e;b.totalBytes=g;try{this.dispatchEvent(b)}catch(d){this.logger.warning('Error in "'+au.upldr.events.EventType.PROGRESS+'" event: '+d.message)}};au.upldr.BaseUploader.prototype.uploadManager_errorHandler_=function(c){this.logger.fine(c.errorMessage);var b=au.upldr.errorHelper.getErrorCodeByHttpStatus(c.httpStatus);var a=au.upldr.errorHelper.getErrorMessageByCode(b,this.propertyHolder_);this.cancelUploadInternal(a);this.dispatchErrorEvent_(b,c.httpStatus,c.response,a)};au.upldr.BaseUploader.prototype.dispatchErrorEvent_=function(f,c,b,d){var a=new goog.events.Event(au.upldr.events.EventType.ERROR);a.errorCode=f;a.httpStatus=c;a.response=b;a.additionalInfo=d;try{this.dispatchEvent(a)}catch(e){this.logger.warning('Error in "'+au.upldr.events.EventType.ERROR+'" event: '+e.message)}};au.upldr.BaseUploader.prototype.updateProgress_=function(e,a,g,b,c,f){var d=(this.propertyHolder_.getProperty(au.upldr.InternalProperties.UPLOAD_PROGRESS));d=d.clone();d.stage=e;d.percents=a;d.loadedFiles=g;d.totalFiles=b;d.loadedBytes=c;d.totalBytes=f;this.propertyHolder_.setProperty(au.upldr.InternalProperties.UPLOAD_PROGRESS,d)};au.upldr.BaseUploader.prototype.cancelUploadByButton=function(b){if(this.cancelUploadInternal(b)){var a=(this.propertyHolder_.getProperty(au.upldr.Properties.UPLOAD_CANCELLED_BY_USER_MSG));this.dispatchErrorEvent_(au.upldr.ErrorCodes.UPLOAD_ABORTED_BY_USER,-1,"",a)}};au.upldr.BaseUploader.prototype.cancelUploadInternal=function(a){if(this.getState()==au.upldr.UploaderState.UPLOADING){this.logger.fine("Cancel upload: "+a);if(this.uploadManager_){this.uploadManager_.cancelUpload()}this.disposeUploadManager_();this.setState(this.getItems().getCount()>0?au.upldr.UploaderState.READY:au.upldr.UploaderState.IDLE);if(a){this.notificationCollection_.add(a)}var b=this.getFileList();if(b!=null){b.startRender()}this.propertyHolder_.setProperty(au.upldr.Properties.IS_VISIBLE_ADDING_FILES,true);return true}else{return false}};au.upldr.BaseUploader.prototype.disposeUploadManager_=function(){var a=this.uploadManager_;if(a){this.clearUploadManagerListeners_(a);a.dispose();delete this.uploadManager_}};au.upldr.BaseUploader.prototype.clearUploadManagerListeners_=function(a){this.handler_.unlisten(a,au.upldr.events.EventType.BEFORE_PACKAGE_UPLOAD,this.uploadManager_beforePackageUploadHandler_).unlisten(a,au.upldr.events.EventType.AFTER_PACKAGE_UPLOAD,this.uploadManager_afterPackageUploadHandler_).unlisten(a,au.upldr.events.EventType.COMPLETE,this.uploadManager_completeHandler_).unlisten(a,au.upldr.events.EventType.PROGRESS,this.uploadManager_progressHandler_)};au.upldr.BaseUploader.prototype.getPropertyInternal=function(a){return this.propertyHolder_.getProperty(a)};au.upldr.BaseUploader.prototype.setPropertyInternal=function(a,b){if(au.upldr.validate[a]){b=au.upldr.validate[a](b,this)}this.propertyHolder_.setProperty(a,b)};au.upldr.BaseUploader.prototype.logger=goog.log.getLogger("au.upldr.BaseUploader");goog.provide("au.upldr.Uploader");goog.require("goog.userAgent");goog.require("au.upldr.VERSION");goog.require("au.upldr.BUILD_DATE");goog.require("au.upldr.Properties");goog.require("au.upldr.DefaultValues");goog.require("au.upldr.ErrorCodes");goog.require("au.upldr.BaseUploader");goog.require("au.upldr.support");goog.require("au.upldr.Properties");goog.require("au.upldr.RestrictionVerifier");goog.require("au.upldr.utils.mimeMapping");goog.require("au.upldr.image.DataReader");goog.require("au.upldr.imaging.imageEditor.DrawAreaConfig");au.upldr.Uploader=function(a){goog.base(this,a);goog.events.listen(document.getElementsByTagName("body")[0],[goog.events.EventType.DROP,goog.events.EventType.DRAGOVER],function(b){b.preventDefault()});this._extractExif="";this._metadataValueSeparator=";";this._enableAutoRotation=false};goog.inherits(au.upldr.Uploader,au.upldr.BaseUploader);au.upldr.BaseUploader.prototype.setFileMask=function(b){this.setPropertyInternal(au.upldr.Properties.RESTRICTIONS_FILE_MASK,b);if(this.rendered_&&this.fileDialog_&&this.fileDialog_.getFileInput()&&this.propertyHolder_){var a=au.upldr.RestrictionVerifier.parseFileMask((this.propertyHolder_.getProperty(au.upldr.Properties.RESTRICTIONS_FILE_MASK)));this.fileDialog_.getFileInput().accept=au.upldr.utils.mimeMapping.getInputFileAcceptString(a)}};au.upldr.BaseUploader.prototype.setFolderProcessingMode=function(c){c=c.toLowerCase();var a,b=(!!window.chrome||!!window.opera)&&goog.userAgent.WEBKIT;switch(c){case au.upldr.FolderProcessingModeEnum.FOLDER:a=b?au.upldr.FolderProcessingModeEnum.FOLDER:au.upldr.FolderProcessingModeEnum.NONE;break;case au.upldr.FolderProcessingModeEnum.UPLOAD:case au.upldr.FolderProcessingModeEnum.SHOW:case au.upldr.FolderProcessingModeEnum.MIXED:a=b?au.upldr.FolderProcessingModeEnum.MIXED:au.upldr.FolderProcessingModeEnum.NONE;break;case au.upldr.FolderProcessingModeEnum.SKIP:default:a=au.upldr.FolderProcessingModeEnum.NONE;break}this.setPropertyInternal(au.upldr.Properties.FOLDER_PROCESSING_MODE,a)};au.upldr.Uploader.prototype.addConverter=function(a){return this.converters_.add(a)};au.upldr.Uploader.prototype.removeConverter=function(a){return this.converters_.removeAt(a)};au.upldr.Uploader.prototype.getConverterCount=function(){return this.converters_.getCount()};au.upldr.Uploader.prototype.getConverterMode=function(a){var b=this.converters_.getItem(a);if(b){return b.getMode()}};au.upldr.Uploader.prototype.setConverterMode=function(a,c){var b=this.converters_.getItem(a);if(b){b.setMode(c);return true}else{return false}};au.upldr.Uploader.prototype.getConverterThumbnailBgColor=function(a){var b=this.converters_.getItem(a);if(b){return b.getThumbnailBgColor()}};au.upldr.Uploader.prototype.setConverterThumbnailBgColor=function(a,c){var b=this.converters_.getItem(a);if(b){b.setThumbnailBgColor(c);return true}else{return false}};au.upldr.Uploader.prototype.getConverterThumbnailFitMode=function(a){var b=this.converters_.getItem(a);if(b){return b.getThumbnailFitMode()}};au.upldr.Uploader.prototype.setConverterThumbnailFitMode=function(a,c){var b=this.converters_.getItem(a);if(b){b.setThumbnailFitMode((c));return true}else{return false}};au.upldr.Uploader.prototype.getConverterThumbnailHeight=function(a){var b=this.converters_.getItem(a);if(b){return b.getThumbnailHeight()}};au.upldr.Uploader.prototype.setConverterThumbnailHeight=function(a,c){var b=this.converters_.getItem(a);if(b){b.setThumbnailHeight(c);return true}else{return false}};au.upldr.Uploader.prototype.getConverterThumbnailWidth=function(a){var b=this.converters_.getItem(a);if(b){return b.getThumbnailWidth()}};au.upldr.Uploader.prototype.setConverterThumbnailWidth=function(a,c){var b=this.converters_.getItem(a);if(b){b.setThumbnailWidth(c);return true}else{return false}};au.upldr.Uploader.prototype.getConverterThumbnailJpegQuality=function(a){var b=this.converters_.getItem(a);if(b){return b.getThumbnailJpegQuality()}};au.upldr.Uploader.prototype.setConverterThumbnailJpegQuality=function(a,c){var b=this.converters_.getItem(a);if(b){b.setThumbnailJpegQuality(c);return true}else{return false}};au.upldr.Uploader.prototype.getConverterThumbnailCopyExif=function(a){var b=this.converters_.getItem(a);if(b){return b.getThumbnailCopyExif()}return false};au.upldr.Uploader.prototype.setConverterThumbnailCopyExif=function(a,c){var b=this.converters_.getItem(a);if(b){b.setThumbnailCopyExif(c)}};au.upldr.Uploader.prototype.getConverterThumbnailCopyIptc=function(a){this.logger.warning("Not implemented.");return 0};au.upldr.Uploader.prototype.setConverterThumbnailCopyIptc=function(a,b){this.logger.warning("Not implemented.");return false};au.upldr.Uploader.prototype.getConverterThumbnailApplyDrawTool=function(a){var b=this.converters_.getItem(a);if(b){return b.getThumbnailApplyDrawTool()}return false};au.upldr.Uploader.prototype.setConverterThumbnailApplyDrawTool=function(a,c){var b=this.converters_.getItem(a);if(b){b.setThumbnailApplyDrawTool(c)}};au.upldr.Uploader.prototype.getConverterThumbnailApplyCrop=function(a){var b=this.converters_.getItem(a);if(b){return b.getThumbnailApplyCrop()}return false};au.upldr.Uploader.prototype.setConverterThumbnailApplyCrop=function(a,c){var b=this.converters_.getItem(a);if(b){b.setThumbnailApplyCrop(c)}};au.upldr.Uploader.prototype.getConverterThumbnailWatermark=function(a){var b=this.converters_.getItem(a);if(b){return b.getThumbnailWatermark()}return null};au.upldr.Uploader.prototype.setConverterThumbnailWatermark=function(a,c){var b=this.converters_.getItem(a);if(b){b.setThumbnailWatermark(c)}};au.upldr.Uploader.prototype.getConverterThumbnailWatermarkPreview=function(a,c){var b=this.converters_.getItem(a);if(b&&c&&c.image&&c.callback){b.getWatermarkPreview(c.image,c.callback)}};au.upldr.Uploader.prototype.getUploadFileCount=function(){return this.items_.getCount()};au.upldr.Uploader.prototype.uploadFileRemoveAt=function(a){return this.removeFile(a)};au.upldr.Uploader.prototype.uploadFileRemoveAll=function(a){this.removeAllFiles()};au.upldr.Uploader.prototype.getUploadFileAngle=function(a){var b=this.items_.getItem(a);if(b){return b.getAngle()}};au.upldr.Uploader.prototype.setUploadFileAngle=function(a,c){var b=this.items_.getItem(a);if(b){b.setAngle(c);return true}else{return false}};au.upldr.Uploader.prototype.getUploadFileDescription=function(a){var b=this.items_.getItem(a);if(b){return b.getDescription()}};au.upldr.Uploader.prototype.setUploadFileDescription=function(a,c){var b=this.items_.getItem(a);if(b){b.setDescription(c);return true}else{return false}};au.upldr.Uploader.prototype.getUploadFileCropBounds=function(a){var c=this.items_.getItem(a);if(c){var b=c.getCropBounds(true);if(b){return[b.left,b.top,b.width,b.height]}else{return[]}}return[]};au.upldr.Uploader.prototype.setUploadFileCropBounds=function(a,c){var b=this.items_.getItem(a);if(b&&c&&c.length==4){b.setCropBounds(new au.upldr.imaging.Bounds(c[1],c[0],c[2],c[3]));return true}else{return false}};au.upldr.Uploader.prototype.getUploadFileHeight=function(a){var b=this.items_.getItem(a);if(b){return b.getImageHeight()}};au.upldr.Uploader.prototype.getUploadFileName=function(a){var b=this.items_.getItem(a);if(b){return b.getName()}};au.upldr.Uploader.prototype.getUploadFileGuid=function(b){var c=this.items_.getItem(b);var a="";if(c){a=c.getGuid()}return a};au.upldr.Uploader.prototype.getUploadFileSize=function(a){var b=this.items_.getItem(a);if(b){return b.getSize()}};au.upldr.Uploader.prototype.getUploadFileWidth=function(a){var b=this.items_.getItem(a);if(b){return b.getImageWidth()}};au.upldr.Uploader.prototype.getUploadFileSelectionAt=function(a){var b=this.items_.getItem(a);if(b){return b.isSelected()}return false};au.upldr.Uploader.prototype.setUploadFileSelectionAt=function(a,b){var c=this.items_.getItem(a);if(c){c.setSelected(b)}};au.upldr.Uploader.prototype.getUploadFileIconCssClassAt=function(a){var b=this.items_.getItem(a);if(b){return b.getIconCssClass()}return""};au.upldr.Uploader.prototype.getUploadFilePreviewSrcAt=function(a,f,c){var d=this.items_.getItem(a);if(d){var b=(this.getPropertyHolder().getProperty(au.upldr.Properties.ENABLE_EXIF_PREVIEW));var e=(this.getPropertyHolder().getProperty(au.upldr.Properties.UPLOAD_PANE_THUMBNAIL_PREVIEW_SIZE));d.getPreview(f,b,(c||e))}};au.upldr.Uploader.prototype.uploadFileOnUpdateAt=function(a,c){var b=this.items_.getItem(a);if(b){b.onUpdate(c)}};au.upldr.Uploader.prototype.getUploadFileTagAt=function(a){var b=this.items_.getItem(a);if(b){return b.getTag()}};au.upldr.Uploader.prototype.setUploadFileTagAt=function(a,c){var b=this.items_.getItem(a);if(b){b.setTag(c);return true}else{return false}};au.upldr.Uploader.prototype.addCustomField=function(a,c,b){if(this.customFields_[a]&&b){this.customFields_[a].push(c)}else{this.customFields_[a]=[c]}return true};au.upldr.Uploader.prototype.removeCustomField=function(a){if(this.customFields_.hasOwnProperty(a)){delete this.customFields_[a];return true}else{return false}};au.upldr.Uploader.prototype.getExtractExif=function(){return this._extractExif};au.upldr.Uploader.prototype.setExtractExif=function(a){this._extractExif=a};au.upldr.Uploader.prototype.getExtractIptc=function(){this.logger.warning("Not implemented.");return false};au.upldr.Uploader.prototype.setExtractIptc=function(a){this.logger.warning("Not implemented.");return false};au.upldr.Uploader.prototype.getMetadataValueSeparator=function(){return this._metadataValueSeparator};au.upldr.Uploader.prototype.setMetadataValueSeparator=function(a){this._metadataValueSeparator=a};au.upldr.Uploader.prototype.getEnableAutoRotation=function(){return this._enableAutoRotation};au.upldr.Uploader.prototype.setEnableAutoRotation=function(a){this._enableAutoRotation=a};au.upldr.Uploader.prototype.showInformationBar=function(a){if(a!=null&&(a=a+"")!=""){this.notificationCollection_.add(((a)))}};au.upldr.Uploader.prototype.getImageEditorDrawTool=function(){return(this.getPropertyInternal(au.upldr.Properties.IMAGE_EDITOR_DRAW_TOOL))};au.upldr.Uploader.prototype.setImageEditorDrawTool=function(b){if(b){if(b instanceof au.upldr.imaging.imageEditor.DrawAreaConfig){this.setPropertyInternal(au.upldr.Properties.IMAGE_EDITOR_DRAW_TOOL,b)}else{var a=this.getImageEditorDrawTool();if(a){a.parse(b);this.propertyHolder_.dispatchEvent(this.propertyHolder_.getPropertyChangedEventName(au.upldr.Properties.IMAGE_EDITOR_DRAW_TOOL))}else{a=new au.upldr.imaging.imageEditor.DrawAreaConfig();this.setPropertyInternal(au.upldr.Properties.IMAGE_EDITOR_DRAW_TOOL,a)}}}};au.upldr.Uploader.prototype.cancelUpload=function(b){if(this.cancelUploadInternal(b)){var a=(this.propertyHolder_.getProperty(au.upldr.Properties.UPLOAD_CANCELLED_BY_CANCEL_METHOD_MSG));this.dispatchErrorEvent_(au.upldr.ErrorCodes.UPLOAD_ABORTED_BY_SCRIPT,-1,"",a)}};au.upldr.Uploader.prototype.getVersion=function(){return au.upldr.VERSION};au.upldr.Uploader.prototype.getBuildDate=function(){return au.upldr.BUILD_DATE};goog.array.forEach(goog.object.getValues(au.upldr.Properties),function(c,b,a){if(typeof au.upldr.Uploader.prototype["get"+c]!="function"){au.upldr.Uploader.prototype["get"+c]=function(){return this.getPropertyInternal(c)}}if(typeof au.upldr.Uploader.prototype["set"+c]!="function"){au.upldr.Uploader.prototype["set"+c]=function(d){this.setPropertyInternal(c,d)}}});au.upldr.Uploader.prototype.logger=goog.log.getLogger("au.upldr.Uploader");goog.exportSymbol("Aurigma.ImageUploaderFlash.Control.Uploader",au.upldr.Uploader);var p={addFiles:au.upldr.Uploader.prototype.addFiles,removeFile:au.upldr.Uploader.prototype.removeFile,render:au.upldr.Uploader.prototype.render,upload:au.upldr.Uploader.prototype.upload,cancelUpload:au.upldr.Uploader.prototype.cancelUpload,addEventListener:au.upldr.Uploader.prototype.addEventListener,removeEventListener:au.upldr.Uploader.prototype.removeEventListener,addCustomField:au.upldr.Uploader.prototype.addCustomField,removeCustomField:au.upldr.Uploader.prototype.removeCustomField,showInformationBar:au.upldr.Uploader.prototype.showInformationBar,getExtractExif:au.upldr.Uploader.prototype.getExtractExif,setExtractExif:au.upldr.Uploader.prototype.setExtractExif,getExtractIptc:au.upldr.Uploader.prototype.getExtractIptc,setExtractIptc:au.upldr.Uploader.prototype.setExtractIptc,getMetadataValueSeparator:au.upldr.Uploader.prototype.getMetadataValueSeparator,setMetaDataValueSeparator:au.upldr.Uploader.prototype.setMetadataValueSeparator,setEnableAutoRotation:au.upldr.Uploader.prototype.setEnableAutoRotation,getEnableAutoRotation:au.upldr.Uploader.prototype.getEnableAutoRotation,setFolderProcessingMode:au.upldr.Uploader.prototype.setFolderProcessingMode,setFileMask:au.upldr.Uploader.prototype.setFileMask,getVersion:au.upldr.Uploader.prototype.getVersion,getBuildDate:au.upldr.Uploader.prototype.getBuildDate,addConverter:au.upldr.Uploader.prototype.addConverter,removeConverter:au.upldr.Uploader.prototype.removeConverter,getConverterCount:au.upldr.Uploader.prototype.getConverterCount,getConverterMode:au.upldr.Uploader.prototype.getConverterMode,setConverterMode:au.upldr.Uploader.prototype.setConverterMode,getConverterThumbnailBgColor:au.upldr.Uploader.prototype.getConverterThumbnailBgColor,setConverterThumbnailBgColor:au.upldr.Uploader.prototype.setConverterThumbnailBgColor,getConverterThumbnailFitMode:au.upldr.Uploader.prototype.getConverterThumbnailFitMode,setConverterThumbnailFitMode:au.upldr.Uploader.prototype.setConverterThumbnailFitMode,getConverterThumbnailHeight:au.upldr.Uploader.prototype.getConverterThumbnailHeight,setConverterThumbnailHeight:au.upldr.Uploader.prototype.setConverterThumbnailHeight,getConverterThumbnailWidth:au.upldr.Uploader.prototype.getConverterThumbnailWidth,setConverterThumbnailWidth:au.upldr.Uploader.prototype.setConverterThumbnailWidth,getConverterThumbnailJpegQuality:au.upldr.Uploader.prototype.getConverterThumbnailJpegQuality,setConverterThumbnailJpegQuality:au.upldr.Uploader.prototype.setConverterThumbnailJpegQuality,getConverterThumbnailCopyExif:au.upldr.Uploader.prototype.setConverterThumbnailCopyExif,setConverterThumbnailCopyExif:au.upldr.Uploader.prototype.setConverterThumbnailCopyExif,getConverterThumbnailCopyIptc:au.upldr.Uploader.prototype.getConverterThumbnailCopyIptc,setConverterThumbnailCopyIptc:au.upldr.Uploader.prototype.setConverterThumbnailCopyIptc,setConverterThumbnailWatermark:au.upldr.Uploader.prototype.setConverterThumbnailWatermark,getConverterThumbnailWatermark:au.upldr.Uploader.prototype.getConverterThumbnailWatermark,setConverterThumbnailApplyCrop:au.upldr.Uploader.prototype.setConverterThumbnailApplyCrop,getConverterThumbnailApplyCrop:au.upldr.Uploader.prototype.getConverterThumbnailApplyCrop,setConverterThumbnailApplyDrawTool:au.upldr.Uploader.prototype.setConverterThumbnailApplyDrawTool,getConverterThumbnailApplyDrawTool:au.upldr.Uploader.prototype.getConverterThumbnailApplyDrawTool,getUi:au.upldr.Uploader.prototype.getUi,getUploadFileCount:au.upldr.Uploader.prototype.getUploadFileCount,uploadFileRemoveAt:au.upldr.Uploader.prototype.uploadFileRemoveAt,uploadFileRemoveAll:au.upldr.Uploader.prototype.uploadFileRemoveAll,getUploadFileAngle:au.upldr.Uploader.prototype.getUploadFileAngle,setUploadFileAngle:au.upldr.Uploader.prototype.setUploadFileAngle,getUploadFileDescription:au.upldr.Uploader.prototype.getUploadFileDescription,setUploadFileDescription:au.upldr.Uploader.prototype.setUploadFileDescription,getUploadFileHeight:au.upldr.Uploader.prototype.getUploadFileHeight,getUploadFileName:au.upldr.Uploader.prototype.getUploadFileName,getUploadFileSize:au.upldr.Uploader.prototype.getUploadFileSize,getUploadFileWidth:au.upldr.Uploader.prototype.getUploadFileWidth,getUploadFileGuid:au.upldr.Uploader.prototype.getUploadFileGuid,getUploadFileSelectionAt:au.upldr.Uploader.prototype.getUploadFileSelectionAt,setUploadFileSelectionAt:au.upldr.Uploader.prototype.setUploadFileSelectionAt,getUploadFilePreviewSrcAt:au.upldr.Uploader.prototype.getUploadFilePreviewSrcAt,getUploadFileIconCssClassAt:au.upldr.Uploader.prototype.getUploadFileIconCssClassAt,uploadFileOnUpdateAt:au.upldr.Uploader.prototype.uploadFileOnUpdateAt,getUploadFileTagAt:au.upldr.Uploader.prototype.getUploadFileTagAt,setUploadFileTagAt:au.upldr.Uploader.prototype.setUploadFileTagAt,getUploadFileCropBounds:au.upldr.Uploader.prototype.getUploadFileCropBounds,setUploadFileCropBounds:au.upldr.Uploader.prototype.setUploadFileCropBounds,showImageEditorById:au.upldr.Uploader.prototype.showImageEditorById,getImageEditorDrawTool:au.upldr.Uploader.prototype.getImageEditorDrawTool,setImageEditorDrawTool:au.upldr.Uploader.prototype.setImageEditorDrawTool,addUploadFilesAsBase64:au.upldr.Uploader.prototype.addFilesAsBase64,addUploadFilesAsBlob:au.upldr.Uploader.prototype.addFilesAsBlob};for(var name in p){if(p.hasOwnProperty(name)){goog.exportProperty(au.upldr.Uploader.prototype,name,p[name])}};(function(a,b){a.Stream.extend("modules.membercenter.collection.ContributionTiles")}(ox,modules));(function(a,b){a.Stream.extend("modules.membercenter.collection.MemberContributionList");b.membercenter.collection.MemberContributionList.extend("modules.membercenter.collection.Reviews");b.membercenter.collection.MemberContributionList.extend("modules.membercenter.collection.Ratings");b.membercenter.collection.MemberContributionList.extend("modules.membercenter.collection.Photos");b.membercenter.collection.MemberContributionList.extend("modules.membercenter.collection.Videos");b.membercenter.collection.MemberContributionList.extend("modules.membercenter.collection.Forums");b.membercenter.collection.MemberContributionList.extend("modules.membercenter.collection.TravelerArticles");b.membercenter.collection.MemberContributionList.extend("modules.membercenter.collection.TripLists")}(ox,modules));(function(a,b){a.App.extend("modules.membercenter.CityPageApp",{events:{"click .contributionsTile .bubbles":function(d,c,e){if(this.context.get("features.mc_civ_city_page_ratings.enabled")){var f=e.context.get("tile").get("loc");this.getSubview("modules.common.CityPageRatings").removeRating(f)}},"click .contributionViewOption":function(){this.formatCityPage()},"click .sign-in":function(){this.record("FBCRMOverlay_sign-in");var d=ta.retrieve("fbcOverlay.returnToUrl");var c={module:this.name,action:"FBCRMOverlay_complete"};ta.support.Facebook.login(null,function(){ta.util.action.record(c.module+"_"+c.action,null,c)},null,null,"FBC_NAVIGATE",true,{url:d})},"click .no-thanks":function(){this.record("FBCRMOverlay_no-thanks");if(this.fbcOverlay){this.fbcOverlay.hide()}}},contextEvents:{},messages:{},initialize:function(){this.formatCityPage();if(ta.retrieve("crm.friend_update_referral")){this.record("FBCRM_referral")}this.fbcOverlay=this.element.getElement("#FBC_WRAPPER");if(this.fbcOverlay){this.record("FBCRMOverlay_show")}},formatCityPage:function(){var d=this.context.get("MemberCenter_ContributionTiles");var g=this.context.get("MemberCenter_CityPageView");var f=this.element.getElement(".gridViewModules");var c=this.element.getElement("#cityContributionTiles");if(d&&f&&g){if(d.length==0&&c&&g.get("view")==1){f.setStyle("height",c.getStyle("height"));var e=c.getStyle("right");c.setStyle("float","left");c.setStyle("left",e)}else{f.setStyle("height","auto")}}}})}(ox,modules));(function(a,b){a.View.extend("modules.membercenter.ContributionTiles",{autoRender:false,source:"MODULE_CITYPAGE",events:{"scroll window":function(){this.loadTiles()},"click .toggleReview":function(d,c,e){var f=!e.context.get("tile.showSnippet");e.context.get("tile").set("showSnippet",f);e.render();this.dynamicGrid.formatTiles(true);if(f){this.record("read-less")}else{this.record("read-more")}},"click .contributionLink":function(d,c,e){if(e.context.get("tile.type")=="PHOTO"){this.record("view-photo");window.open(e.context.get("tile.userMedia.contributionLink"))}else{if(e.context.get("tile.type")=="VIDEO"){this.record("view-video");return showProfileGalleryPopup(e.context.get("tile.userMedia.contributionLink"))}else{if(e.context.get("tile.type")=="RATING"){window.open(e.context.get("tile.loc.url"))}else{if(e.context.get("tile.type")=="REVIEW"){this.record("view-review");window.open(e.context.get("tile.review.url")+"#REVIEWS")}else{this.record("view-location");window.open(e.context.get("tile.loc.url"))}}}}},"click .userPhotoLink":function(d,c,e){this.record("view-photo")},"click .userVideoLink":function(d,c,e){this.record("view-video")},"click .placeName":function(d,c,e){this.record("view-rating-location");window.open(e.context.get("tile.loc.url"))},"click .reviewCTA":function(f,d,h){var e="/UserReviewEdit-g"+h.context.get("tile.cityGeoId")+"-d"+h.context.get("tile.loc.id");var g=h.context.get("tile.type")+"-add-review";var c=this.getSliceTestName(d);this.record(g,c);ta.util.cookie.setPIDCookie(36385);window.open(e)},"click .photoCTA":function(c,g,h){ta.util.cookie.setPIDCookie(36386);var k=h.context.get("tile.cityGeoId");var f=h.context.get("tile.loc.id");var j=this.context.get("Config.locale");var i=h.context.get("tile.addPhotoUrl");ta.media.uploader.show(c,this,{oldPhotoUploadURL:i,oldPhotoUploadPID:459,locationId:k,detailId:f,locale:j,flashReplacementType:"",noFlash:""},"war");var e=h.context.get("tile.type")+"-add-photo";var d=this.getSliceTestName(g);this.record(e,d)},"click .active .bubble":function(e,i,l){var g=i.getParent();var j=g.getElements(".bubble");var f=j.indexOf(i)+1;var n=l.context.get("tile").get("loc");var k=this.context.get("Member.data.isLoggedInMember")?36384:36387;var m={locationId:n.get("id"),url:n.get("url"),value:f,source:"MODULE_CITYPAGE",type:"QUICKRATE",pid:k};g.addClass("rate"+f);if(g.parentElement.hasClass("publicCTA")){l.element.getElement(".visitInfo").removeClass("active");g.parentElement.parentElement.removeClass("active")}else{if(!g.parentElement.hasClass("publicCTA")){this.animateRating(g.getParent())}}this.record("rating_added");var d=this.context.get("CompleteContributionCounts.ratings");this.context.get("CompleteContributionCounts").set("ratings",d+1);var h=this.context.get("MemberCenter_FullContributionCounts.ratings");this.context.get("MemberCenter_FullContributionCounts").set("ratings",h+1);var c=this.context.get("MemberCenter_FullContributionCounts.total");this.context.get("MemberCenter_FullContributionCounts").set("total",c+1);b.common.entity.Rating.save(m,true).success(function(){b.common.entity.Rating.ogPublish(m)})},"mouseover .active .bubble":function(e,d,f){var c=d.getParent().getElements(".bubble");var g=c.indexOf(d);c.each(function(h,j){$$(h)[g>=j?"addClass":"removeClass"]("filled")},this)},"mouseout .active .bubbles":function(g,f,h){var c=f.getElements(".bubble");var e=0;for(var d=1;d<=5;d++){if(f.hasClass("rate"+d)){e=d}}c.each(function(j,k){$$(j)[e>k?"addClass":"removeClass"]("filled")},this)},"mouseover .active .flag-icon":function(d,c){["been","want","fave"].some(function(e){if(c.hasClass("sprite-"+e+"Unset")){c.removeClass("sprite-"+e+"Unset").addClass("sprite-"+e+"Set");return true}})},"mouseout .active .flag-icon":function(d,c,e){["been","want","fave"].some(function(f){if(!~e.context.get("tile.loggedInPin.flags").indexOf(f)&&c.hasClass("sprite-"+f+"Set")){c.removeClass("sprite-"+f+"Set").addClass("sprite-"+f+"Unset");return true}})},"click .active .flag-icon":function(h,f,i){var c=f.hasClass("been")?"been":f.hasClass("want")?"want":f.hasClass("fave")?"fave":null;var e=this.context.get("Member.data.isLoggedInMember")?"modules.membercenter.YourContributionTiles":"modules.membercenter.PublicContributionTiles";i.context.get("tile.loggedInPin").toggleFlag(c,this.source,e,this.context.get("features.module_publish_to_og.enabled"));if(c=="been"){var j=f.getParent().getParent();var d=j.getElement(".rating");var g=j.getElement(".want");if(f.hasClass("clicked")){f.removeClass("clicked");f.getParent().getElement(".visitText").removeClass("selectedText");j.addClass("viBeenWant").removeClass("viRate");d.addClass("hidden");g.removeClass("hidden")}else{f.addClass("clicked");f.getParent().getElement(".visitText").addClass("selectedText");j.removeClass("viBeenWant").addClass("viRate");d.removeClass("hidden");g.addClass("hidden")}}else{if(c=="want"){if(f.hasClass("clicked")){f.removeClass("clicked");f.getParent().getElement(".visitText").removeClass("selectedText")}else{f.addClass("clicked");f.getParent().getElement(".visitText").addClass("selectedText")}}}}},contextEvents:{"add MemberCenter_ContributionTiles":function(d){var c=this.context.get("MemberCenter_ContributionTiles");if(c.length%this.context.get("MemberCenter_CityPageView.itemsPerPage")){c.setParam("limit",Math.max(c.length+1,this.context.get("MemberCenter_CityPageView.itemsPerPage")))}else{this.hasAll=false}this.element.removeClass("hidden");setTimeout(function(){this.dynamicGrid.formatTiles(true)}.bind(this),0)},"remove MemberCenter_ContributionTiles":function(c){this.render()},"change MemberCenter_ContributionTiles":function(d){var c=window.getScroll();this.render();this.dynamicGrid.formatTiles(true);window.scrollTo(c.x,c.y)},"change MemberCenter_ContributionTiles[].facebookMember *":function(){if(this.tileFacebookMemberChange){return}this.tileFacebookMemberChange=true;this.render();setTimeout(function(){this.tileFacebookMemberChange=false}.bind(this),0)},"change MemberCenter_CityPageView.sort":function(c){this.context.get("MemberCenter_ContributionTiles").fetch({sortOrderId:+c.properties.sort,limit:this.context.get("MemberCenter_CityPageView.itemsPerPage"),offset:0,requestedTile:null})},"change MemberCenter_CityPageView.view":function(c){this.render()}},initialize:function(){if(this.context.get("MemberCenter_ContributionTiles").length==0){this.element.addClass("hidden")}var c=[0,0];if($$(".cityContributionTile")[0]){c.push(ta.id("cityContributionTiles").getHeight())}else{c.push(0)}this.dynamicGrid=new b.component.DynamicGrid("placeTiles",".contributionsTile",c,[320]);this.$loading=$(this.element).getElement(".loading");this._loading=false;this._hasAll=false;if(this.getSubview("eachTile")){this.getSubview("eachTile").enableAutoSize({add:a.domutil.transition.fadeIn})}},animateRating:function(c){c.set("tween",{duration:350,property:"opacity"}).tween(0);setTimeout(function(){c.addClass("hidden")}.bind(this),400)},loadTiles:function(){if(this.context.get("MemberCenter_CityPageView.view")==1){var h=this;var e=this.context.get("MemberCenter_CityPageView.itemsPerPage");var i=this.context.get("MemberCenter_ContributionTiles");var g=window.getScroll().y+window.getSize().y;var d=ta.id("placeTiles").getCoordinates().bottom+50;var j=i.length;if(this._loading||this._hasAll||g<d){return this}this._loading=true;this.$loading.removeClass("hidden");var f=e-j%e;if(this.context.get("features.city_page_add_review_tile.enabled")){var c=$(this.element).getElement(".addReviewTile");if(c){f--;if(f<=0){f=e}}}i.fetch({limit:f,offset:j}).always(function(){if(i.length%e){i.setParam("limit",Math.max(i.length+1,e))}else{i.setParam("limit",Math.max(i.length,e))}h.$loading.addClass("hidden");if(j==i.length){h._hasAll=true}setTimeout(function(){h._loading=false;if(window.getScroll().y+window.getSize().y>d){h.loadTiles()}},1000)});return this}},getSliceTestName:function(e){var d="style0";if(e){var f=e.getParent(".tileCTAs");if(f){var c=f.get("class").match(/ctaStyle([0-9][a-z])/);if(c){d="style"+c[1]}}}return d},record:function(e,d){var c=this.context.get("Member.data.isLoggedInMember")?"modules.membercenter.YourContributionTiles":"modules.membercenter.PublicContributionTiles";return ta.util.action.record(c+"_"+e,null,{module:c,action:e,context:d})}})}(ox,modules));(function(a,b){a.View.extend("modules.membercenter.CityPageHeader",{autoRender:false,source:"MODULE_CITYPAGE",events:{"click .active.been":function(){this.context.get("TravelMap_Pin.data").toggleFlag("been",this.source,this.name)},"click .active.want":function(){this.context.get("TravelMap_Pin.data").toggleFlag("want",this.source,this.name)},"click .active.fave":function(){this.context.get("TravelMap_Pin.data").toggleFlag("fave",this.source,this.name)},"click .viewAllCities":function(d,c){this.record("view-all-cities")},"mouseover .active .flag-icon":function(d,c){["been","want","fave"].some(function(e){if(c.hasClass("sprite-"+e+"Unset")){c.removeClass("sprite-"+e+"Unset").addClass("sprite-"+e+"Set");return true}}.bind(this))},"mouseout .active .flag-icon":function(d,c){["been","want","fave"].some(function(e){if(!~this.context.get("TravelMap_Pin.data.flags").indexOf(e)&&c.hasClass("sprite-"+e+"Set")){c.removeClass("sprite-"+e+"Set").addClass("sprite-"+e+"Unset");return true}}.bind(this))},"mouseover .picture":function(g,f){var e=f.getParent().getElements(".friendName");if(e[0]){e.removeClass("hidden");var j=e.getSize()[0].x;var d=f.getParent().getElement(".picture").getSize().x;var i=e.getStyle("padding")[0].toInt();var c=e.getStyle("border-radius")[0];if(c){c=c.toInt()}else{c=0}var h=-1*(j+d)/2;e.setStyle("margin-left",h);e.setStyle("margin-right",h)}},"mouseout .picture":function(e,d){var c=d.getParent().getElements(".friendName");if(c){c.addClass("hidden")}},"click .clickablePicture":function(d,c,e){this.record("YourAvatarClick");window.location=this.context.get("LoggedInMember.data.cityPageLink")},"click .friend.clickable":function(d,c,e){this.record("FriendAvatarClick");window.location=e.context.get("friend.cityPageUrl")+"?offset="+this.context.get("Social_FriendCarouselModel.begin")},"click .leftCarouselArrow.enable":function(d,c){this.record("FriendCarouselLeftArrow");this.context.get("Social_FriendCarouselModel").previous()},"click .rightCarouselArrow.enable":function(d,c){this.record("FriendCarouselRightArrow");this.context.get("Social_FriendCarouselModel").next()}},contextEvents:{"add TravelMap_Pin.data.flags":function(){this.render()},"remove TravelMap_Pin.data.flags":function(){this.render()},"change MemberCenter_FullContributionCounts.total":function(){this.render()},"change MemberCenter_FullContributionCounts.ratings":function(){this.render()},"change Social_FriendCarouselModel *":function(){var d=this.context.get("MemberCenter_FriendsInLocation").getOffset();var c=this.context.get("MemberCenter_FriendsInLocation").length;if(d>this.context.get("Social_FriendCarouselModel.begin")||d+c<=this.context.get("Social_FriendCarouselModel.begin")){this.context.get("MemberCenter_FriendsInLocation").fetch({memberId:this.context.get("Member.data.id"),locationId:this.context.get("TravelMap_Pin.data.location.id"),offset:this.context.get("Social_FriendCarouselModel.begin")})}else{this.render()}},"add MemberCenter_FriendsInLocation":function(){this.render()},"change MemberCenter_FriendsInLocationCount.data":function(){this.render()},"change Social_SocialUser.data":function(){this.render()}},initialize:function(){},record:function(d){var c=(this.context.get("Member.data.isLoggedInMember"))?"modules.membercenter.YourCityPageHeader":"modules.membercenter.PublicCityPageHeader";return ta.util.action.record(c+"_"+d,null,{module:c,action:d})}})}(ox,modules));(function(a,b){a.Stream.extend("modules.membercenter.collection.FriendsInLocation")}(ox,modules));(function(a,b){a.View.extend("modules.membercenter.CityPageView",{autoRender:true,events:{"click .dropdown":function(e,d,g){var c=true;var f=d.getElement(".dropdownOptions");if(!f.hasClass("hidden")){c=false}this.closeDropdowns();if(c){this.openDropdown(d)}e.stopPropagation()},"click .dropdownSelection":function(e,d,f){var c=this.context.get("MemberCenter_CityPageView.view");if(c==1){this.context.get("MemberCenter_CityPageView").set("sort",d.get("name"));this.record(d.get("name")=="1"?"DatePosted":d.get("name")=="2"?"ReviewsFirst":d.get("name")=="4"?"Alphabetical":"")}else{if(c==2){this.context.get("MemberCenter_CityPageView").set("contentType",d.get("name"));this.context.get("MemberCenter_CityPageView").set("sort",1);this.record(d.get("name")=="1"?"Reviews":d.get("name")=="2"?"Ratings":d.get("name")=="3"?"Photos":d.get("name")=="4"?"Videos":d.get("name")=="5"?"ForumPosts":d.get("name")=="6"?"Articles":d.get("name")=="7"?"TripLists":"")}}},"click window":function(d,c){this.closeDropdowns()},"click .contributionViewOption":function(d,c,e){if(c.hasClass("selected")){return}this.context.get("MemberCenter_CityPageView").set({contentType:this.determineContentType(),sort:1,view:c.get("name")});this.record(c.get("name")=="1"?"gridView":c.get("name")=="2"?"listView":"mapView")}},contextEvents:{"change MemberCenter_CityPageView.view":function(){this.render()},"change MemberCenter_ContributionTiles":function(d,c,e){if(this.context.get("MemberCenter_ContributionTiles").length>0){this.render()}}},initialize:function(){},determineContentType:function(){if(this.context.get("MemberCenter_Reviews").length!=0){return 1}else{if(this.context.get("MemberCenter_Ratings").length!=0){return 2}else{if(this.context.get("MemberCenter_Photos").length!=0){return 3}else{if(this.context.get("MemberCenter_Videos").length!=0){return 4}else{if(this.context.get("MemberCenter_Forums").length!=0){return 5}else{if(this.context.get("MemberCenter_TravelerArticles").length!=0){return 6}else{if(this.context.get("MemberCenter_TripLists").length!=0){return 7}else{return 0}}}}}}}},record:function(e){var c=this.context.get("MemberCenter_CityPageView.view")=="1"?"GridView":"ListView";var d=(this.context.get("Member.data.isLoggedInMember"))?"modules.membercenter.YourCityPageView":"modules.membercenter.PublicCityPageView";return ta.util.action.record(d+"_"+e,null,{module:d,action:e,context:c})},openDropdowns:[],openDropdown:function(c){c.getElement(".dropdownOptions").removeClass("hidden");this.openDropdowns.combine([c])},closeDropdown:function(c){c.getElement(".dropdownOptions").addClass("hidden");this.openDropdowns.erase(c)},closeDropdowns:function(){this.openDropdowns.each(function(c){this.closeDropdown(c)},this)}})}(ox,modules));(function(a,b){a.View.extend("modules.membercenter.CityContributions",{autoRender:false,events:{"click .viewPost":function(d,c,e){this.record("view-post")},"click .viewForumsList":function(d,c,e){this.context.get("MemberCenter_CityPageView").set("contentType",5);this.context.get("MemberCenter_CityPageView").set("view",2);this.record("view-all-forum-posts")},"click .viewArticlesList":function(d,c,e){this.context.get("MemberCenter_CityPageView").set("contentType",6);this.context.get("MemberCenter_CityPageView").set("view",2);this.record("view-all-articles")},"click .viewArticle":function(d,c,e){this.record("view-traveler-article")},"click .viewTripList":function(d,c,e){this.record("view-trip-list")},"click .viewTripListsList":function(d,c,e){this.context.get("MemberCenter_CityPageView").set("contentType",7);this.context.get("MemberCenter_CityPageView").set("view",2);this.record("view-all-trip-lists")}},contextEvents:{"change MemberCenter_FullContributionCounts.ratings":function(c){if(ta.id("cityContributionTiles")&&ta.id("cityContributionTiles").getStyle("float")=="left"){$$(".gridViewModules").setStyle("height","auto");ta.id("cityContributionTiles").setStyle("float","right")}},"change MemberCenter_CityContributions":function(c){if(!c.targetPath){this.render()}},"change MemberCenter_CityPageView.view":function(c){this.render()}},initialize:function(){},record:function(d){var c=(this.context.get("Member.data.isLoggedInMember"))?"modules.membercenter.YourCityContributions":"modules.membercenter.PublicCityContributions";return ta.util.action.record(c+"_"+d,null,{module:c,action:d})}})}(ox,modules));(function(a,b){a.View.extend("modules.membercenter.MemberContributionList",{autoRender:false,events:{"scroll window":function(){this.loadTiles()},"click .deleteList":function(d,c,e){if(confirm(c.get("name"))){window.location=e.context.get("contribution.deleteUrl")}},"click .viewReview":function(d,c,e){this.record("view-review")},"click .viewLocation":function(d,c,e){this.record("view-location")},"click .viewArticle":function(d,c,e){this.record("view-article")},"click .viewRecentEdit":function(d,c,e){this.record("view-most-recent-edit")},"click .viewTripList":function(d,c,e){this.record("view-trip-list")},"click .viewForum":function(d,c,e){this.record("view-forum-topic")},"click .viewVideo":function(d,c,e){this.record("view-video")},"click .viewPhoto":function(d,c,e){this.record("view-photo")}},contextEvents:{"change MemberCenter_CityPageView.view":function(){this.render()},"change MemberCenter_CityPageView.contentType":function(){this.render()},"add MemberCenter_Ratings":function(){this.render()},"add MemberCenter_Reviews":function(){this.render()},"add MemberCenter_Photos":function(){this.render()},"add MemberCenter_Videos":function(){this.render()},"add MemberCenter_TravelerArticles":function(){this.render()},"add MemberCenter_Forums":function(){this.render()},"add MemberCenter_TripLists":function(){this.render()}},initialize:function(){this.$loading=this.element.getElement(".loading");this._loading=false;this._hasAll=false;this.setAnimations()},loadTiles:function(){var f=this;var d=this.context.get("MemberCenter_CityPageView.itemsPerPage");var e=window.getScroll().y+window.getSize().y;var c=this.element.getCoordinates().bottom+10;var g=this.context.get("MemberCenter_CityPageView.view")=="1"?true:false;var i=this.determineContributions(+this.context.get("MemberCenter_CityPageView.contentType"));if(!i||this._loading||this._hasAll||e<c||g){return this}var h=i.length;this._loading=true;if(!this.$loading){this.$loading=this.element.getElement(".loading")}if(this.$loading){this.$loading.removeClass("hidden")}i.fetch({limit:d-h%d,offset:h}).always(function(){if(f.$loading){f.$loading.addClass("hidden")}f.setAnimations();if(h==i.length){f._hasAll=true}setTimeout(function(){f._loading=false;if(window.getScroll().y+window.getSize().y>c){f.loadTiles()}},1000)});return this},record:function(d){var c=(this.context.get("Member.data.isLoggedInMember"))?this.name+"Own":this.name+"Public";return ta.util.action.record(c+"_"+d,null,{module:c,action:d})},setAnimations:function(){if(this.getSubview("eachContribution")){this.getSubview("eachContribution").children.each(function(c){if(c.getSubview("eachAttraction")){c.getSubview("eachAttraction").enableAutoSize({add:a.domutil.transition.fadeIn,remove:a.domutil.transition.fadeOut})}})}},determineContributions:function(c){switch(c){case 2:if(this.context.has("MemberCenter_Ratings")){return this.context.get("MemberCenter_Ratings")}return null;case 3:if(this.context.has("MemberCenter_Photos")){return this.context.get("MemberCenter_Photos")}return null;case 4:if(this.context.has("MemberCenter_Videos")){return this.context.get("MemberCenter_Videos")}return null;case 5:if(this.context.has("MemberCenter_Forums")){return this.context.get("MemberCenter_Forums")}return null;case 6:if(this.context.has("MemberCenter_TravelerArticles")){return this.context.get("MemberCenter_TravelerArticles")}return null;case 7:if(this.context.has("MemberCenter_TripLists")){return this.context.get("MemberCenter_TripLists")}return null;default:if(this.context.has("MemberCenter_Reviews")){return this.context.get("MemberCenter_Reviews")}return null}}});b.membercenter.MemberContributionList.extend("modules.membercenter.ReviewsList");b.membercenter.MemberContributionList.extend("modules.membercenter.RatingsList");b.membercenter.MemberContributionList.extend("modules.membercenter.PhotosList");b.membercenter.MemberContributionList.extend("modules.membercenter.VideosList");b.membercenter.MemberContributionList.extend("modules.membercenter.ForumsList");b.membercenter.MemberContributionList.extend("modules.membercenter.TravelerArticlesList");b.membercenter.MemberContributionList.extend("modules.membercenter.TripListsList")}(ox,modules));(function(a,b){a.View.extend("modules.common.CityPageRatings",{autoRender:false,events:{"click .bubble":function(e,i,l){if(l.element.hasClass("ratingBlock")){this.record("rating_added");var o=l.context.get("attraction");this.removeRating(o);var d=this.context.get("CompleteContributionCounts.ratings");this.context.get("CompleteContributionCounts").set("ratings",d+1);var f=this.context.get("MemberCenter_FullContributionCounts.ratings");this.context.get("MemberCenter_FullContributionCounts").set("ratings",f+1);var h=this.context.get("MemberCenter_FullContributionCounts.total");this.context.get("MemberCenter_FullContributionCounts").set("total",h+1);var k=this.context.get("Social_ContributionCounts.ratings");this.context.get("Social_ContributionCounts").set("ratings",k+1);if(this.context.get("MemberCenter_ContributionCounts")){var n=this.context.get("MemberCenter_ContributionCounts.ratings");var c=this.context.get("MemberCenter_ContributionCounts.total");this.context.get("MemberCenter_ContributionCounts").set("ratings",n+1);this.context.get("MemberCenter_ContributionCounts").set("total",c+1)}var g=i.getParent().getElements(".bubble");var j=g.indexOf(i)+1;ta.util.cookie.setPIDCookie(36383);var m={locationId:l.context.get("attraction").id,url:l.context.get("attraction").get("url"),redistributable:l.context.get("attraction").get("redistributable"),value:j,source:"MODULE_CITYPAGERATINGS",type:this.context.get("features.civ_module_redesign.enabled")?"QUICKRATECIV":"QUICKRATE",pid:36383};b.common.entity.Rating.save(m).success(function(){b.common.entity.Rating.ogPublish(m)})}},"click .ratingBlock .close":function(e,d,f){if(f.element.hasClass("ratingBlock")){this.record("ratingClose");var c=f.context.get("attraction");this.removeRating(c)}},"click .hideLink":function(e,d,f){this.record("hide");var c=this.element.getElement(".ratingBlockContainer");c.toggleClass("hidden");this.element.getElement(".showLink").toggleClass("hidden");this.element.getElement(".hideLink").toggleClass("hidden")},"click .showLink":function(e,d,f){this.record("show");var c=this.element.getElement(".ratingBlockContainer");c.toggleClass("hidden");this.element.getElement(".showLink").toggleClass("hidden");this.element.getElement(".hideLink").toggleClass("hidden")},"mouseover .bubble":function(f,e,g){var c=e.getParent().getElements(".bubble");var d=c.indexOf(e);c.each(function(h,j){$$(h)[d>=j?"addClass":"removeClass"]("filled")},this)},"mouseout .bubbles":function(e,d,f){var c=d.getElements(".bubble");c.each(function(g){g.removeClass("filled")})}},contextEvents:{"change CityPageRatings":function(){this.render()},"add MemberCenter_ContributionTiles":function(e,c,f){var d=this.element.getElement(".strip");if(d){d.removeClass("hidden")}if(!this.context.get("MemberCenter_ContributionTiles").length){d.addClass("hidden")}}},initialize:function(){var c=this.context.get("MemberCenter_ContributionTiles");if(c){if(!this.context.get("MemberCenter_ContributionTiles").length){var d=this.element.getElement(".strip");if(d){d.addClass("hidden")}}this.setAnimations();this.resizeOrHide()}if(Browser.ie8){var e=this.element.getElement(".hideLink");if(e){e.addClass("hidden")}}},setAnimations:function(){if(this.getSubview("eachColumn")){this.getSubview("eachColumn").children.each(function(c){if(c.getSubview("eachAttraction")){c.getSubview("eachAttraction").enableAutoSize({add:function(e,d){e.setStyle("opacity",0);d();e.set("tween",{duration:350,property:"opacity"}).tween(1)},remove:function(e,d){e.set("tween",{duration:350,property:"opacity",onComplete:d}).tween(0)}})}})}},resizeOrHide:function(){var d=[];var c=0;if(this.getSubview("eachColumn")){this.getSubview("eachColumn").children.each(function(f){d.push(f.getSubview("eachAttraction").children.length)});for(var e=0;e<d.length;e++){c+=d[e]}setTimeout(function(){if(c==0){this.element.addClass("hidden")}else{if(c<=6){var g=Math.ceil(c/3);var f=g*66;this.element.getElement(".ratingBlockContainer").setStyle("height",f)}}}.bind(this),400)}},reOrder:function(){if(!Browser.ie8){setTimeout(function(){var c=[];if(this.getSubview("eachColumn")){this.getSubview("eachColumn").children.each(function(g){c.push(g.element.getChildren().length)});for(var d=0;d<c.length;d++){if(c[d-1]&&c[d]+1<c[d-1]){this.grabAndMove(d,d-1,c)}else{if(c[d+1]&&c[d]<c[d+1]){this.grabAndMove(d,d+1,c)}}}if(c[c.length-1]+1<c[0]){var f=c[0]>c[1]?0:1;var e=c.length-1;this.grabAndMove(e,f,c)}}}.bind(this),475)}},grabAndMove:function(f,g,c){var d=this.element.getElement(".RatingColumn"+f);var e=this.element.getElement(".RatingColumn"+g);d.adopt(e.getLast());c[f]++;c[g]--},removeRating:function(c){var d=c.id;if(this.getSubview("eachColumn")){this.getSubview("eachColumn").children.each(function(g){var h=g.getSubview("eachAttraction").context.get("column.attractions");for(var f=0;f<h.length;f++){var e=h.get(f);if(e.id==d){h.remove(e);break}}}.bind(this))}this.resizeOrHide();this.reOrder()}})}(ox,modules));Fx.implement({getTransition:function(){var a=this.options.transition||Fx.Transitions.Sine.easeInOut;if(typeof a=="string"){var b=a.split(":");a=Fx.Transitions;a=a[b[0]]||a[b[0].capitalize()];if(b[1]){a=a["ease"+b[1].capitalize()+(b[2]?b[2].capitalize():"")]}}return a}});Fx.Transition=function(b,a){a=Array.from(a);return Object.append(b,{easeIn:function(c){return b(c,a)},easeOut:function(c){return 1-b(1-c,a)},easeInOut:function(c){return(c<=0.5)?b(2*c,a)/2:(2-b(2*(1-c),a))/2}})};Fx.Transitions={linear:function(a){return a}};Fx.Transitions.extend=function(a){for(var b in a){Fx.Transitions[b]=new Fx.Transition(a[b])}};Fx.Transitions.extend({Pow:function(b,a){return Math.pow(b,a&&a[0]||6)},Expo:function(a){return Math.pow(2,8*(a-1))},Circ:function(a){return 1-Math.sin(Math.acos(a))},Sine:function(a){return 1-Math.sin((1-a)*Math.PI/2)},Back:function(b,a){a=a&&a[0]||1.618;return Math.pow(b,2)*((a+1)*b-a)},Bounce:function(f){var e;for(var d=0,c=1;1;d+=c,c/=2){if(f>=(7-4*d)/11){e=c*c-Math.pow((11-6*d-11*f)/4,2);break}}return e},Elastic:function(b,a){return Math.pow(2,10*--b)*Math.cos(20*b*Math.PI*(a&&a[0]||1)/3)}});["Quad","Cubic","Quart","Quint"].each(function(b,a){Fx.Transitions[b]=new Fx.Transition(function(c){return Math.pow(c,[a+2])})});(function(){var a=function(d,c){var e=[];Object.each(c,function(f){Object.each(f,function(g){d.each(function(h){e.push(h+"-"+g+(h=="border"?"-width":""))})})});return e};var b=function(e,d){var c=0;Object.each(d,function(g,f){if(f.test(e)){c=c+g.toInt()}});return c};Element.implement({measure:function(h,j){var d=function(k){return !!(!k||k.offsetHeight||k.offsetWidth)};if(!j&&d(this)){return h.apply(this)}var g=this.getParent(),i=[],e=[];while(!d(g)&&g!=document.body){e.push(g.expose(j));g=g.getParent()}var f=this.expose(j);var c=h.apply(this);f();e.each(function(k){k()});return c},expose:function(d){if(!d&&this.getStyle("display")!="none"){return function(){}}var c=this.style.cssText;this.setStyles({display:"block",position:"absolute",visibility:"hidden","max-height":"none"});return function(){this.style.cssText=c}.bind(this)},getDimensions:function(c){c=Object.merge({computeSize:false},c);var h={x:0,y:0};var g=function(i,e){return(e.computeSize)?i.getComputedSize(e):i.getSize()};var d=this.getParent("body");if(d&&this.getStyle("display")=="none"){h=this.measure(function(){return g(this,c)})}else{if(d){try{h=g(this,c)}catch(f){}}}return Object.append(h,(h.x||h.x===0)?{width:h.x,height:h.y}:{x:h.width,y:h.height})},getComputedSize:function(c){c=Object.merge({styles:["padding","border"],planes:{height:["top","bottom"],width:["left","right"]},mode:"both"},c);var e={},d={width:0,height:0};if(c.mode=="vertical"){delete d.width;delete c.planes.width}else{if(c.mode=="horizontal"){delete d.height;delete c.planes.height}}a(c.styles,c.planes).each(function(f){e[f]=this.getStyle(f).toInt()},this);Object.each(c.planes,function(g,f){var h=f.capitalize();e[f]=this.getStyle(f).toInt();d["total"+h]=e[f];g.each(function(j){var i=b(j,e);d["computed"+j.capitalize()]=i;d["total"+h]+=i})},this);return Object.append(d,e)}})})();(function(){var a=false,b=false;var c=function(){var d=new Element("div").setStyles({position:"fixed",top:0,right:0}).inject(document.body);a=(d.offsetTop===0);d.dispose();b=true};Element.implement({pin:function(h,f){if(!b){c()}if(this.getStyle("display")=="none"){return this}var j,k=window.getScroll();if(h!==false){j=this.getPosition(a?document.body:this.getOffsetParent());if(!this.retrieve("pin:_pinned")){var g={top:j.y-k.y,left:j.x-k.x};if(a&&!f){this.setStyle("position","fixed").setStyles(g)}else{var l=this.getOffsetParent(),i=this.getPosition(l),m=this.getStyles("left","top");if(l&&m.left=="auto"||m.top=="auto"){this.setPosition(i)}if(this.getStyle("position")=="static"){this.setStyle("position","absolute")}i={x:m.left.toInt()-k.x,y:m.top.toInt()-k.y};var e=function(){if(!this.retrieve("pin:_pinned")){return}var n=window.getScroll();this.setStyles({left:i.x+n.x,top:i.y+n.y})}.bind(this);this.store("pin:_scrollFixer",e);window.addEvent("scroll",e)}this.store("pin:_pinned",true)}}else{if(!this.retrieve("pin:_pinned")){return this}var l=this.getParent(),d=(l.getComputedStyle("position")!="static"?l:l.getOffsetParent());j=this.getPosition(d);this.store("pin:_pinned",false);var e=this.retrieve("pin:_scrollFixer");if(!e){this.setStyles({position:"absolute",top:j.y+k.y,left:j.x+k.x})}else{this.store("pin:_scrollFixer",null);window.removeEvent("scroll",e)}this.removeClass("isPinned")}return this},unpin:function(){return this.pin(false)},togglepin:function(){return this.pin(!this.retrieve("pin:_pinned"))}})})();(function(){var a=Element.prototype.position;Element.implement({position:function(g){if(g&&(g.x!=null||g.y!=null)){return a?a.apply(this,arguments):this}Object.each(g||{},function(u,t){if(u==null){delete g[t]}});g=Object.merge({relativeTo:document.body,position:{x:"center",y:"center"},offset:{x:0,y:0}},g);var r={x:0,y:0},e=false;var c=this.measure(function(){return document.id(this.getOffsetParent())});if(c&&c!=this.getDocument().body){r=c.measure(function(){return this.getPosition()});e=c!=document.id(g.relativeTo);g.offset.x=g.offset.x-r.x;g.offset.y=g.offset.y-r.y}var s=function(t){if(typeOf(t)!="string"){return t}t=t.toLowerCase();var u={};if(t.test("left")){u.x="left"}else{if(t.test("right")){u.x="right"}else{u.x="center"}}if(t.test("upper")||t.test("top")){u.y="top"}else{if(t.test("bottom")){u.y="bottom"}else{u.y="center"}}return u};g.edge=s(g.edge);g.position=s(g.position);if(!g.edge){if(g.position.x=="center"&&g.position.y=="center"){g.edge={x:"center",y:"center"}}else{g.edge={x:"left",y:"top"}}}this.setStyle("position","absolute");var f=document.id(g.relativeTo)||document.body,d=f==document.body?window.getScroll():f.getPosition(),l=d.y,h=d.x;var n=this.getDimensions({computeSize:true,styles:["padding","border","margin"]});var j={},o=g.offset.y,q=g.offset.x,k=window.getSize();switch(g.position.x){case"left":j.x=h+q;break;case"right":j.x=h+q+f.offsetWidth;break;default:j.x=h+((f==document.body?k.x:f.offsetWidth)/2)+q;break}switch(g.position.y){case"top":j.y=l+o;break;case"bottom":j.y=l+o+f.offsetHeight;break;default:j.y=l+((f==document.body?k.y:f.offsetHeight)/2)+o;break}if(g.edge){var b={};switch(g.edge.x){case"left":b.x=0;break;case"right":b.x=-n.x-n.computedRight-n.computedLeft;break;default:b.x=-(n.totalWidth/2);break}switch(g.edge.y){case"top":b.y=0;break;case"bottom":b.y=-n.y-n.computedTop-n.computedBottom;break;default:b.y=-(n.totalHeight/2);break}j.x+=b.x;j.y+=b.y}j={left:((j.x>=0||e||g.allowNegative)?j.x:0).toInt(),top:((j.y>=0||e||g.allowNegative)?j.y:0).toInt()};var i={left:"x",top:"y"};["minimum","maximum"].each(function(t){["left","top"].each(function(u){var v=g[t]?g[t][i[u]]:null;if(v!=null&&((t=="minimum")?j[u]<v:j[u]>v)){j[u]=v}})});if(f.getStyle("position")=="fixed"||g.relFixedPosition){var m=window.getScroll();j.top+=m.y;j.left+=m.x}if(g.ignoreScroll){var p=f.getScroll();j.top-=p.y;j.left-=p.x}if(g.ignoreMargins){j.left+=(g.edge.x=="right"?n["margin-right"]:g.edge.x=="center"?-n["margin-left"]+((n["margin-right"]+n["margin-left"])/2):-n["margin-left"]);j.top+=(g.edge.y=="bottom"?n["margin-bottom"]:g.edge.y=="center"?-n["margin-top"]+((n["margin-bottom"]+n["margin-top"])/2):-n["margin-top"])}j.left=Math.ceil(j.left);j.top=Math.ceil(j.top);if(g.returnPos){return j}else{this.setStyles(j)}return this}})})();var Drag=new Class({Implements:[Events,Options],options:{snap:6,unit:"px",grid:false,style:true,limit:false,handle:false,invert:false,preventDefault:false,stopPropagation:false,modifiers:{x:"left",y:"top"}},initialize:function(){var b=Array.link(arguments,{options:Type.isObject,element:function(c){return c!=null}});this.element=document.id(b.element);this.document=this.element.getDocument();this.setOptions(b.options||{});var a=typeOf(this.options.handle);this.handles=((a=="array"||a=="collection")?$$(this.options.handle):document.id(this.options.handle))||this.element;this.mouse={now:{},pos:{}};this.value={start:{},now:{}};this.selection=(Browser.ie)?"selectstart":"mousedown";if(Browser.ie&&!Drag.ondragstartFixed){document.ondragstart=Function.from(false);Drag.ondragstartFixed=true}this.bound={start:this.start.bind(this),check:this.check.bind(this),drag:this.drag.bind(this),stop:this.stop.bind(this),cancel:this.cancel.bind(this),eventStop:Function.from(false)};this.attach()},attach:function(){this.handles.addEvent("mousedown",this.bound.start);return this},detach:function(){this.handles.removeEvent("mousedown",this.bound.start);return this},start:function(a){var k=this.options;if(a.rightClick){return}if(k.preventDefault){a.preventDefault()}if(k.stopPropagation){a.stopPropagation()}this.mouse.start=a.page;this.fireEvent("beforeStart",this.element);var c=k.limit;this.limit={x:[],y:[]};var j=this.element.getStyles("left","right","top","bottom");this._invert={x:k.modifiers.x=="left"&&j.left=="auto"&&!isNaN(j.right.toInt())&&(k.modifiers.x="right"),y:k.modifiers.y=="top"&&j.top=="auto"&&!isNaN(j.bottom.toInt())&&(k.modifiers.y="bottom")};var e,g;for(e in k.modifiers){if(!k.modifiers[e]){continue}var b=this.element.getStyle(k.modifiers[e]);if(b&&!b.match(/px$/)){if(!g){g=this.element.getCoordinates(this.element.getOffsetParent())}b=g[k.modifiers[e]]}if(k.style){this.value.now[e]=(b||0).toInt()}else{this.value.now[e]=this.element[k.modifiers[e]]}if(k.invert){this.value.now[e]*=-1}if(this._invert[e]){this.value.now[e]*=-1}this.mouse.pos[e]=a.page[e]-this.value.now[e];if(c&&c[e]){var d=2;while(d--){var f=c[e][d];if(f||f===0){this.limit[e][d]=(typeof f=="function")?f():f}}}}if(typeOf(this.options.grid)=="number"){this.options.grid={x:this.options.grid,y:this.options.grid}}var h={mousemove:this.bound.check,mouseup:this.bound.cancel};h[this.selection]=this.bound.eventStop;this.document.addEvents(h)},check:function(a){if(this.options.preventDefault){a.preventDefault()}var b=Math.round(Math.sqrt(Math.pow(a.page.x-this.mouse.start.x,2)+Math.pow(a.page.y-this.mouse.start.y,2)));if(b>this.options.snap){this.cancel();this.document.addEvents({mousemove:this.bound.drag,mouseup:this.bound.stop});this.fireEvent("start",[this.element,a]).fireEvent("snap",this.element)}},drag:function(b){var a=this.options;if(a.preventDefault){b.preventDefault()}this.mouse.now=b.page;for(var c in a.modifiers){if(!a.modifiers[c]){continue}this.value.now[c]=this.mouse.now[c]-this.mouse.pos[c];if(a.invert){this.value.now[c]*=-1}if(this._invert[c]){this.value.now[c]*=-1}if(a.limit&&this.limit[c]){if((this.limit[c][1]||this.limit[c][1]===0)&&(this.value.now[c]>this.limit[c][1])){this.value.now[c]=this.limit[c][1]}else{if((this.limit[c][0]||this.limit[c][0]===0)&&(this.value.now[c]<this.limit[c][0])){this.value.now[c]=this.limit[c][0]}}}if(a.grid[c]){this.value.now[c]-=((this.value.now[c]-(this.limit[c][0]||0))%a.grid[c])}if(a.style){this.element.setStyle(a.modifiers[c],this.value.now[c]+a.unit)}else{this.element[a.modifiers[c]]=this.value.now[c]}}this.fireEvent("drag",[this.element,b])},cancel:function(a){this.document.removeEvents({mousemove:this.bound.check,mouseup:this.bound.cancel});if(a){this.document.removeEvent(this.selection,this.bound.eventStop);this.fireEvent("cancel",this.element)}},stop:function(b){var a={mousemove:this.bound.drag,mouseup:this.bound.stop};a[this.selection]=this.bound.eventStop;this.document.removeEvents(a);if(b){this.fireEvent("complete",[this.element,b])}}});Element.implement({makeResizable:function(a){var b=new Drag(this,Object.merge({modifiers:{x:"width",y:"height"}},a));this.store("resizer",b);return b.addEvent("drag",function(){this.fireEvent("resize",b)}.bind(this))}});Drag.Move=new Class({Extends:Drag,options:{droppables:[],container:false,precalculate:false,includeMargins:true,checkDroppables:true},initialize:function(b,a){this.parent(b,a);b=this.element;this.droppables=$$(this.options.droppables);this.container=document.id(this.options.container);if(this.container&&typeOf(this.container)!="element"){this.container=document.id(this.container.getDocument().body)}if(this.options.style){if(this.options.modifiers.x=="left"&&this.options.modifiers.y=="top"){var e,c=b.getOffsetParent();var d=b.getStyles("left","top");if(c&&(d.left=="auto"||d.top=="auto")){b.setPosition(b.getPosition(c))}}if(b.getStyle("position")=="static"){b.setStyle("position","absolute")}}this.addEvent("start",this.checkDroppables,true);this.overed=null},start:function(a){if(this.container){this.options.limit=this.calculateLimit()}if(this.options.precalculate){this.positions=this.droppables.map(function(b){return b.getCoordinates()})}this.parent(a)},calculateLimit:function(){var j=this.element,e=this.container,d=document.id(j.getOffsetParent())||document.body,h=e.getCoordinates(d),c={},b={},k={},g={},m={};["top","right","bottom","left"].each(function(q){c[q]=j.getStyle("margin-"+q).toInt();b[q]=j.getStyle("border-"+q).toInt();k[q]=e.getStyle("margin-"+q).toInt();g[q]=e.getStyle("border-"+q).toInt();m[q]=d.getStyle("padding-"+q).toInt()},this);var f=j.offsetWidth+c.left+c.right,p=j.offsetHeight+c.top+c.bottom,i=0,l=0,o=h.right-g.right-f,a=h.bottom-g.bottom-p;if(this.options.includeMargins){i+=c.left;l+=c.top}else{o+=c.right;a+=c.bottom}if(j.getStyle("position")=="relative"){var n=j.getCoordinates(d);n.left-=j.getStyle("left").toInt();n.top-=j.getStyle("top").toInt();i-=n.left;l-=n.top;if(e.getStyle("position")!="relative"){i+=g.left;l+=g.top}o+=c.left-n.left;a+=c.top-n.top;if(e!=d){i+=k.left+m.left;l+=((Browser.ie6||Browser.ie7)?0:k.top)+m.top}}else{i-=c.left;l-=c.top;if(e!=d){i+=h.left+g.left;l+=h.top+g.top}}return{x:[i,o],y:[l,a]}},checkDroppables:function(){var a=this.droppables.filter(function(d,c){d=this.positions?this.positions[c]:d.getCoordinates();var b=this.mouse.now;return(b.x>d.left&&b.x<d.right&&b.y<d.bottom&&b.y>d.top)},this).getLast();if(this.overed!=a){if(this.overed){this.fireEvent("leave",[this.element,this.overed])}if(a){this.fireEvent("enter",[this.element,a])}this.overed=a}},drag:function(a){this.parent(a);if(this.options.checkDroppables&&this.droppables.length){this.checkDroppables()}},stop:function(a){this.checkDroppables();this.fireEvent("drop",[this.element,this.overed,a]);this.overed=null;return this.parent(a)}});Element.implement({makeDraggable:function(a){var b=new Drag.Move(this,a);this.store("dragger",b);return b}});(function(){Fx.Scroll=new Class({Extends:Fx,options:{offset:{x:0,y:0},wheelStops:true},initialize:function(c,b){this.element=this.subject=document.id(c);this.parent(b);if(typeOf(this.element)!="element"){this.element=document.id(this.element.getDocument().body)}if(this.options.wheelStops){var d=this.element,e=this.cancel.pass(false,this);this.addEvent("start",function(){d.addEvent("mousewheel",e)},true);this.addEvent("complete",function(){d.removeEvent("mousewheel",e)},true)}},set:function(){var b=Array.flatten(arguments);if(Browser.firefox){b=[Math.round(b[0]),Math.round(b[1])]}this.element.scrollTo(b[0],b[1])},compute:function(d,c,b){return[0,1].map(function(e){return Fx.compute(d[e],c[e],b)})},start:function(c,d){if(!this.check(c,d)){return this}var b=this.element.getScroll();return this.parent([b.x,b.y],[c,d])},calculateScroll:function(g,f){var d=this.element,b=d.getScrollSize(),h=d.getScroll(),j=d.getSize(),c=this.options.offset,i={x:g,y:f};for(var e in i){if(!i[e]&&i[e]!==0){i[e]=h[e]}if(typeOf(i[e])!="number"){i[e]=b[e]-j[e]}i[e]+=c[e]}return[i.x,i.y]},toTop:function(){return this.start.apply(this,this.calculateScroll(false,0))},toLeft:function(){return this.start.apply(this,this.calculateScroll(0,false))},toRight:function(){return this.start.apply(this,this.calculateScroll("right",false))},toBottom:function(){return this.start.apply(this,this.calculateScroll(false,"bottom"))},toElement:function(d){var c=document.id(d).getPosition(this.element),b=a(this.element)?{x:0,y:0}:this.element.getScroll();return this.start.apply(this,this.calculateScroll(c.x+b.x,c.y+b.y))},scrollIntoView:function(d,g,e){g=g?Array.from(g):["x","y"];d=document.id(d);var i={},f=d.getPosition(this.element),j=d.getSize(),h=this.element.getScroll(),b=this.element.getSize(),c={x:f.x+j.x,y:f.y+j.y};["x","y"].each(function(k){if(g.contains(k)){if(c[k]>h[k]+b[k]){i[k]=c[k]-b[k]}if(f[k]<h[k]){i[k]=f[k]}}if(i[k]==null){i[k]=h[k]}if(e&&e[k]){i[k]=i[k]+e[k]}},this);if(i.x!=h.x||i.y!=h.y){this.start(i.x,i.y)}return this},scrollToCenter:function(e,f,h){f=f?Array.from(f):["x","y"];e=document.id(e);var i={},c=e.getPosition(this.element),d=e.getSize(),b=this.element.getScroll(),g=this.element.getSize();["x","y"].each(function(j){if(f.contains(j)){i[j]=c[j]-(g[j]-d[j])/2}if(i[j]==null){i[j]=b[j]}if(h&&h[j]){i[j]=i[j]+h[j]}},this);if(i.x!=b.x||i.y!=b.y){this.start(i.x,i.y)}return this}});function a(b){return(/^(?:body|html)$/i).test(b.tagName)}})();